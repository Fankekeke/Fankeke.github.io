<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="一块小饼干(Cookie)的故事-下篇"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>一块小饼干(Cookie)的故事-下篇 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/01f99uqnk2g4/",
				"appid": "1613049289050283", 
				"title": "一块小饼干(Cookie)的故事-下篇 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-14T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/p0pk7ie4p3i/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/kg1sn3e657l/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f01f99uqnk2g4%2f&text=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8b%e7%af%87"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f01f99uqnk2g4%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f01f99uqnk2g4%2f&text=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8b%e7%af%87"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f01f99uqnk2g4%2f&title=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8b%e7%af%87"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f01f99uqnk2g4%2f&is_video=false&description=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8b%e7%af%87"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8b%e7%af%87&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f01f99uqnk2g4%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f01f99uqnk2g4%2f&title=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8b%e7%af%87"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f01f99uqnk2g4%2f&title=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8b%e7%af%87"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f01f99uqnk2g4%2f&title=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8b%e7%af%87"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f01f99uqnk2g4%2f&title=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8b%e7%af%87"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">一块小饼干(Cookie)的故事-下篇</h1><div class="meta"><div class="postdate"><time datetime="2018-12-14" itemprop="datePublished">2018-12-14</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e上篇介绍了注册的基本流程，下篇简单的讲讲登录的流程以及Cookie的出现\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e实现登录的小功能\x3c\/h2\x3e\n\x3cp\x3e当你在浏览器的输入框里输入\x3ccode\x3elocalhost:8080\/sign_in\x3c\/code\x3e的时候，会发起\x3ccode\x3eGET\x3c\/code\x3e请求，去访问\x3ccode\x3esign_in.html\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (path === \x27\/sign_up\x27 \x26amp;\x26amp; method === \x27GET\x27) {\n  let string = fs.readFileSync(\x27.\/sign_up.html\x27, \x27utf8\x27)\n  response.statusCode = 200\n  response.setHeader(\x27Content-Type\x27, \x27text\/html;charset=utf-8\x27)\n  response.write(string)\n  response.end()\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (path === \x3cspan class=\x22hljs-string\x22\x3e\x27\/sign_up\x27\x3c\/span\x3e \x26amp;\x26amp; method === \x3cspan class=\x22hljs-string\x22\x3e\x27GET\x27\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e string = fs.readFileSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/sign_up.html\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27utf8\x27\x3c\/span\x3e)\n  response.statusCode = \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e\n  response.setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27text\/html;charset=utf-8\x27\x3c\/span\x3e)\n  response.write(string)\n  response.end()\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eCSS布局与上篇的布局基本一样，略去不表～\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e比对用户的信息与数据库里面的信息是否匹配\x3c\/h3\x3e\n\x3cp\x3e依然是上篇的套路，获得用户formdata后，分析数据，和数据库里面的比对\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var users = fs.readFileSync(\x27.\/db\/users\x27, \x27utf8\x27)\ntry {\n    users = JSON.parse(users) \/\/[] JSON也支持数组\n} catch (exception) {\n    users = []\n}\n\nlet found \nfor (let i = 0; i \x3c users.length; i\x2b\x2b) {\nif (users[i].email === email \x26amp;\x26amp; users[i].password === password) {\n  found = true\n  break\n  }\n}\nif (found) {\n  response.setHeader(\x27Set-Cookie\x27, `sign_in_email=${email};HTTPOnly`)\n  response.statusCode = 200\n} else {\n  response.statusCode = 401\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e users = fs.readFileSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/db\/users\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27utf8\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n    users = \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.parse(users) \x3cspan class=\x22hljs-comment\x22\x3e\/\/[] JSON也支持数组\x3c\/span\x3e\n} \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (exception) {\n    users = []\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e found \n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; users.length; i\x2b\x2b) {\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (users[i].email === email \x26amp;\x26amp; users[i].password === password) {\n  found = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e\n  }\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (found) {\n  response.setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27Set-Cookie\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e`sign_in_email=\x3cspan class=\x22hljs-subst\x22\x3e${email}\x3c\/span\x3e;HTTPOnly`\x3c\/span\x3e)\n  response.statusCode = \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n  response.statusCode = \x3cspan class=\x22hljs-number\x22\x3e401\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e不同的是引入了一个\x3ccode\x3eheader\x3c\/code\x3e，也就是今天的主角--\x3cstrong\x3eCookie\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e其实这和平常上网的情形类似的，有时候我们访问一些购物网站，并没有登录，但是你在购物车里面添加东西了，当你逛了以后再回来的时候，发现购物车里面有你的记录，帮你做这个事的也是cookie。\x3c\/p\x3e\n\x3cblockquote\x3e因为\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/HTTP\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHTTP协议\x3c\/a\x3e是无状态的，即\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/%E6%9C%8D%E5%8A%A1%E5%99%A8\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e服务器\x3c\/a\x3e不知道用户上一次做了什么，这严重阻碍了\x3ca href=\x22https:\/\/zh.wikipedia.org\/w\/index.php?title=%E4%BA%A4%E4%BA%92%E5%BC%8FWeb%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F\x26amp;action=edit\x26amp;redlink=1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e交互式Web应用程序\x3c\/a\x3e的实现。在典型的网上购物场景中，用户浏览了几个页面，买了一盒饼干和两瓶饮料。最后结帐时，由于HTTP的无状态性，不通过额外的手段，服务器并不知道用户到底买了什么，所以Cookie就是用来绕开HTTP的无状态性的“额外手段”之一。服务器可以设置或读取Cookies中包含信息，借此维护用户跟服务器\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/%E4%BC%9A%E8%AF%9D_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e会话\x3c\/a\x3e)中的状态。\x3c\/blockquote\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013249517\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013249517\x22 alt=\x22设置头\x22 title=\x22设置头\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以看出，当你在sign_in发起\x3ccode\x3eGET\x3c\/code\x3e请求并设置了\x3ccode\x3eSet-Cookie\x3c\/code\x3e之后，其他的同源的页面，又都会带上\x3ccode\x3eCookie\x3c\/code\x3e，也就能保证同源的网页向服务器发起请求的时候，服务器能够明白，你己经是登录的用户了，与那些没有拿到cookie的页面区别开来。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3eCookie的入门\x3c\/h2\x3e\n\x3cp\x3e为什么要在cookie里面写上\x3ccode\x3eHttpOnly\x3c\/code\x3e呢，因为这个可以防止有些牛人使用\x3ccode\x3eJS\x3c\/code\x3e修改Cookie的内容。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e如果不写这个的话，可以使用\x3ccode\x3ejs\x3c\/code\x3e修改的\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013249518\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013249518\x22 alt=\x22js修改cookie\x22 title=\x22js修改cookie\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e写了\x3ccode\x3eHttpOnly\x3c\/code\x3e之后将无法修改\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013249519?w=739\x26amp;h=190\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013249519?w=739\x26amp;h=190\x22 alt=\x22无法修改\x22 title=\x22无法修改\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e_ga是啥\x3c\/h3\x3e\n\x3cp\x3e这个是Chrome的功能，用于分析cookie的\x3c\/p\x3e\n\x3cp\x3e每一部分的作用详见\x3ca href=\x22https:\/\/stackoverflow.com\/questions\/16102436\/what-are-the-values-in-ga-cookie\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3eCookie的特点\x3c\/h3\x3e\n\x3cp\x3e通过上述的例子，可以总结几点重要的特点\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e服务器通过 Set-Cookie 响应头设置 Cookie\x3c\/li\x3e\n\x3cli\x3e浏览器得到 Cookie 之后，每次请求都要带上 Cookie\x3c\/li\x3e\n\x3cli\x3e服务器读取 Cookie 就知道登录用户的信息（email）\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e当然了，还有几个问题需要解答一下。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3eCookie 存在哪\x3cbr\x3e存在硬盘的一个文件里面\x3c\/li\x3e\n\x3cli\x3eCookie会被用户篡改吗？\x3cbr\x3e可以，也就是说它并不安全的。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013249520?w=1052\x26amp;h=664\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013249520?w=1052\x26amp;h=664\x22 alt=\x22不安全\x22 title=\x22不安全\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3col\x3e\x3cli\x3eCookie 有效期吗？\x3c\/li\x3e\x3c\/ol\x3e\n\x3cp\x3e默认有效期20分钟左右，不同浏览器策略不同\x3cbr\x3e后端可以强制设置有效期\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Set-Cookie: \x3ccookie-name\x3e=\x3ccookie-value\x3e; Expires=\x3cdate\x3e\nSet-Cookie: \x3ccookie-name\x3e=\x3ccookie-value\x3e; Max-Age=\x3cnon-zero-digit\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3eSet\x3c\/span\x3e-Cookie: \x26lt;cookie-name\x26gt;=\x26lt;cookie-value\x26gt;; Expires=\x26lt;date\x26gt;\nSet-Cookie: \x26lt;cookie-name\x26gt;=\x26lt;cookie-value\x26gt;; Max-Age=\x26lt;non-zero-digit\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e具体语法看 \x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Headers\/Set-Cookie\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSet-Cookie\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e用户登录后，首页显示不同\x3c\/h3\x3e\n\x3cp\x3e既然你成功登录，理应跳转到首页，并显示相应的界面。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$.post(\x27\/sign_in\x27, hash)\n.then((response) =\x3e {\n  window.location.href = \x27\/\x27\n}, \n(request) =\x3e {\n  alert(\x27邮箱与密码不匹配\x27)\n  }\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/sign_in\x27\x3c\/span\x3e, hash)\n.then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e\n}, \n(request) =\x26gt; {\n  alert(\x3cspan class=\x22hljs-string\x22\x3e\x27邮箱与密码不匹配\x27\x3c\/span\x3e)\n  }\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后首页的信息应该根据用户信息做出相应的变化\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let cookies = request.headers.cookie.split(\x27; \x27) \/\/[\x27email=..@..\x27, \x27a=1\x27]\nlet hash = {}\ncookies.forEach((cookie) =\x3e {\n  let parts = cookie.split(\x27=\x27)\n  let key = parts[0]\n  let value = parts[1]\n  hash[key] = value\n})\nlet email = hash.sign_in_email\nlet users = fs.readFileSync(\x27.\/db\/users\x27, \x27utf8\x27)\nusers = JSON.parse(users)\nlet foundUser\nfor (let i = 0; i \x3c users.length; i\x2b\x2b) {\n  if (users[i].email === email) {\n    foundUser = users[i]\n    break\n  }\n}\nif (foundUser) {\n  string = string.replace(\x27email\x27, foundUser.email)\n} else {\n  string = string.replace(\x27恭喜，email你已成功登录\x27, \x27没有该用户\x27)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e cookies = request.headers.cookie.split(\x3cspan class=\x22hljs-string\x22\x3e\x27; \x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/[\x27email=..@..\x27, \x27a=1\x27]\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e hash = {}\ncookies.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ecookie\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e parts = cookie.split(\x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key = parts[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value = parts[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n  hash[key] = value\n})\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e email = hash.sign_in_email\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e users = fs.readFileSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/db\/users\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27utf8\x27\x3c\/span\x3e)\nusers = \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.parse(users)\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e foundUser\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; users.length; i\x2b\x2b) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (users[i].email === email) {\n    foundUser = users[i]\n    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e\n  }\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (foundUser) {\n  string = string.replace(\x3cspan class=\x22hljs-string\x22\x3e\x27email\x27\x3c\/span\x3e, foundUser.email)\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n  string = string.replace(\x3cspan class=\x22hljs-string\x22\x3e\x27恭喜，email你已成功登录\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27没有该用户\x27\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里的代码逻辑与上篇的基本一致，唯一的不同在于第一行代码\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3elet cookies = request.headers.cookie.split(\x27; \x27) \/\/[\x27email=..@..\x27, \x27a=1\x27]\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e为什么用\x3ccode\x3e； \x3c\/code\x3e字符来分割呢，这是因为可以有多个cookie\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013249521?w=807\x26amp;h=214\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013249521?w=807\x26amp;h=214\x22 alt=\x22多个cookie\x22 title=\x22多个cookie\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eCookie的两个作用\x3c\/h3\x3e\n\x3cp\x3e一般来说常见的作用有如下两个：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e识别用户的身份。当用户A去访问\x3ccode\x3elocalhost:8080\x3c\/code\x3e的时候，服务器会给A一个独一无二的\x3ccode\x3eid=00A\x3c\/code\x3e(这就是cookie)，当用户A访问\x3ccode\x3elocalhost:8080\x3c\/code\x3e的其他网页的时候，都会带着那个独一无二的id。当B用户来访问\x3ccode\x3elocalhost:8080\x3c\/code\x3e的时候，服务器发现他没有任何标识，也会给他一个独一无二的\x3ccode\x3eid=00B\x3c\/code\x3e，所以借助cookie服务器端就能够分清楚谁是谁了。\x3c\/li\x3e\n\x3cli\x3e记录你的浏览历史。最常见的需求就是你去逛购物网站，你添加到购物车里面的东西过几天一定会在，而不会凭空消失了。例如A用户去\x3ccode\x3etaobao.com\x3c\/code\x3e去买点东西，添加了一个热水壶、一部小米手机到购物车里面，那么服务器端可以改写你上面的cookie使之具体化「id=00A; cart=A1,A2」，表示你购物车里面买了俩东西。你过几天想起来了，去购物车里面看，热水壶、小米手机还在里面。浏览器并不会删除你存到硬盘上的cookie。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e一张图总结注册登录的过程\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013249522?w=997\x26amp;h=740\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013249522?w=997\x26amp;h=740\x22 alt=\x22登录注册的过程\x22 title=\x22登录注册的过程\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e接下来可以去搞一搞其他的，像什么\x3ccode\x3esession\x3c\/code\x3e \x3ccode\x3eLocalStorage\x3c\/code\x3e……(\x3cem\x3e@ο@\x3c\/em\x3e) 哇～\x3c\/p\x3e\n\x3cp\x3e代码链接\x3ca href=\x22https:\/\/github.com\/codevvvv9\/AJAXDemo_nodeJsServer\/blob\/master\/sign_in.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esign_in.html\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/codevvvv9\/AJAXDemo_nodeJsServer\/blob\/master\/server.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eserver.js\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>一块小饼干(Cookie)的故事-下篇</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013249512">https://segmentfault.com/a/1190000013249512</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/01f99uqnk2g4/" target="_blank">https://alili.tech/archive/01f99uqnk2g4/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>