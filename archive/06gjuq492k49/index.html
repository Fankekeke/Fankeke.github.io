<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="【Geek议题】合理的VueSPA架构讨论（上）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>【Geek议题】合理的VueSPA架构讨论（上） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/06gjuq492k49/",
				"appid": "1613049289050283", 
				"title": "【Geek议题】合理的VueSPA架构讨论（上） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-08T02:30:30"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/87kj87jmt38/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/42ml7q7htu6/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f06gjuq492k49%2f&text=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%90%88%e7%90%86%e7%9a%84VueSPA%e6%9e%b6%e6%9e%84%e8%ae%a8%e8%ae%ba%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f06gjuq492k49%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f06gjuq492k49%2f&text=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%90%88%e7%90%86%e7%9a%84VueSPA%e6%9e%b6%e6%9e%84%e8%ae%a8%e8%ae%ba%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f06gjuq492k49%2f&title=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%90%88%e7%90%86%e7%9a%84VueSPA%e6%9e%b6%e6%9e%84%e8%ae%a8%e8%ae%ba%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f06gjuq492k49%2f&is_video=false&description=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%90%88%e7%90%86%e7%9a%84VueSPA%e6%9e%b6%e6%9e%84%e8%ae%a8%e8%ae%ba%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%90%88%e7%90%86%e7%9a%84VueSPA%e6%9e%b6%e6%9e%84%e8%ae%a8%e8%ae%ba%ef%bc%88%e4%b8%8a%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f06gjuq492k49%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f06gjuq492k49%2f&title=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%90%88%e7%90%86%e7%9a%84VueSPA%e6%9e%b6%e6%9e%84%e8%ae%a8%e8%ae%ba%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f06gjuq492k49%2f&title=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%90%88%e7%90%86%e7%9a%84VueSPA%e6%9e%b6%e6%9e%84%e8%ae%a8%e8%ae%ba%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f06gjuq492k49%2f&title=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%90%88%e7%90%86%e7%9a%84VueSPA%e6%9e%b6%e6%9e%84%e8%ae%a8%e8%ae%ba%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f06gjuq492k49%2f&title=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%90%88%e7%90%86%e7%9a%84VueSPA%e6%9e%b6%e6%9e%84%e8%ae%a8%e8%ae%ba%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">【Geek议题】合理的VueSPA架构讨论（上）</h1><div class="meta"><div class="postdate"><time datetime="2018-12-08" itemprop="datePublished">2018-12-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3eweb前端发展到现代，已经不再是严格意义上的后端MVC的V层，它越来越向类似客户端开发的方向发展，已独立拥有了自己的MVVM设计模型。前后端的分离也使前端人员拥有更大的自由，可以独立设计客户端部分的架构。\x3c\/p\x3e\n\x3cblockquote\x3e【科普】MVVM是Model-View-ViewModel的简写。它本质上就是MVC 的改进版。MVVM 就是将其中的View 的状态和行为抽象化，让我们将视图 UI 和业务逻辑分开。当然这些事 ViewModel 已经帮我们做了，它可以取出 Model 的数据同时帮忙处理 View 中由于需要展示内容而涉及的业务逻辑。\x3c\/blockquote\x3e\n\x3cp\x3eVue作为现在流行的MVVM框架，也是本人平常业务中用得最多的框架。如何才能更合理、优雅的写VueSPA，是本人一直研究的课题，经过一年左右的思考和实践总结出本文。  \x3cbr\x3e本文属于中高级实践讨论，不适合新手。  \x3cbr\x3e本人个人的观点，不代表是最佳实践，欢迎大牛一起讨论，批评指正。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e工程搭建\x3c\/h2\x3e\n\x3cp\x3e秉着不重复造轮子的原则（其实就是懒），工程直接使用Vue2.0官方脚手架生成，使用最新webpack模板。与标准模板的主要差异：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e增加了Sass预编译器\x3c\/li\x3e\n\x3cli\x3e增加了Vuex状态管理\x3c\/li\x3e\n\x3cli\x3e增加了Axios基础Ajax工具库\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e新增部分的安装请参考他们各自的文档，这里不赘述。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e项目结构\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e模拟需求\x3c\/h3\x3e\n\x3cp\x3e讨论架构前我们需要一个项目需求，这里简单模拟一个。  \x3cbr\x3e需求点:3个一级页面，2个二级页面，底部的tabbar只在一级页面出现，首页、个人中心和登录页面是未登录也可以进入；财务和编辑个人信息是只有登录用户可见，简单原型如下：  \x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV7gDD?w=1330\x26amp;h=1250\x22 src=\x22https:\/\/static.alili.tech\/img\/bV7gDD?w=1330\x26amp;h=1250\x22 alt=\x22原型\x22 title=\x22原型\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e开发目录\x3c\/h3\x3e\n\x3cp\x3e下面不讨论脚手架生成的部分目录，只聚焦src开发目录，依据原型我们可以大致规划出下面的目录：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22├── build\n├── config\n├── dist\n├── src  开发目录\n│   ├── api  公共api集\n│   │   ├── axiosConfig.js  axios实例配置\n|   |   └── index.js  公共api集入口\n│   ├── assets  资源目录\n│   │   ├── images  图片\n│   │   ├── scripts  第三方脚本\n|   |   └── styles  基础样式库\n│   ├── components  公共组件\n│   │   ├── common  一般通用组件\n│   │   ├── form  表单通用组件\n│   │   └── popup  弹出类通用组件\n│   │── config  项目配置\n│   │   ├── dev.env.js  开发模式配置\n│   │   ├── env.js  一般配置\n│   │   ├── modules.js  模块配置\n│   │   └── prod.env.js  生产模式配置\n│   │── mixin  用于vue文件混合的模板\n│   │── modules  模块\n│   │   ├── finance  财务模块\n│   │   │   ├── components  财务模块私有组件\n│   │   │   │   └── FinanceIndexItem.vue  财务模块首页里的条目项\n│   │   │   ├── pages  财务模块页面\n│   │   │   │   └── FinanceIndex.vue  财务模块首页\n│   │   │   ├── api.js  模块api集\n│   │   │   ├── index.js  模块入口\n│   │   │   ├── Layout.vue  模块承载页\n│   │   │   └── router.js  模块内路由\n│   │   ├── home  首页模块（子目录同上）\n│   │   └── user  用户模块（子目录同上）\n│   │── pages  公共页面\n│   │   ├── Success.vue  公共状态管理模块\n│   │   └── NotFound.vue  用户模块（子目录同上）\n│   ├── router  路由管理\n│   ├── store  公共状态管理\n│   │   ├── modules  公共状态管理模块\n│   │   │   ├── com.js  通用状态\n│   │   │   └── user.js  用户状态\n│   │   └── index.js  公共状态管理入口\n│   └── utils  基础工具\n└── static\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mipsasm\x22\x3e\x3ccode\x3e├── \x3cspan class=\x22hljs-keyword\x22\x3ebuild\n\x3c\/span\x3e├── \x3cspan class=\x22hljs-built_in\x22\x3econfig\x3c\/span\x3e\n├── \x3cspan class=\x22hljs-keyword\x22\x3edist\n\x3c\/span\x3e├── src  开发目录\n│   ├── api  公共api集\n│   │   ├── axiosConfig.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e axios实例配置\n\x3cspan class=\x22hljs-title\x22\x3e|   |\x3c\/span\x3e   └── index.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 公共api集入口\n│   ├── assets  资源目录\n│   │   ├── images  图片\n│   │   ├── \x3cspan class=\x22hljs-keyword\x22\x3escripts \x3c\/span\x3e 第三方脚本\n\x3cspan class=\x22hljs-title\x22\x3e|   |\x3c\/span\x3e   └── styles  基础样式库\n│   ├── components  公共组件\n│   │   ├── common  一般通用组件\n│   │   ├── form  表单通用组件\n│   │   └── popup  弹出类通用组件\n│   │── \x3cspan class=\x22hljs-built_in\x22\x3econfig\x3c\/span\x3e  项目配置\n│   │   ├── dev.env.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 开发模式配置\n│   │   ├── env.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 一般配置\n│   │   ├── modules.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 模块配置\n│   │   └── prod.env.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 生产模式配置\n│   │── mixin  用于vue文件混合的模板\n│   │── modules  模块\n│   │   ├── finance  财务模块\n│   │   │   ├── components  财务模块私有组件\n│   │   │   │   └── FinanceIndexItem.vue  财务模块首页里的条目项\n│   │   │   ├── pages  财务模块页面\n│   │   │   │   └── FinanceIndex.vue  财务模块首页\n│   │   │   ├── api.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 模块api集\n│   │   │   ├── index.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 模块入口\n│   │   │   ├── Layout.vue  模块承载页\n│   │   │   └── router.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 模块内路由\n│   │   ├── home  首页模块（子目录同上）\n│   │   └── user  用户模块（子目录同上）\n│   │── pages  公共页面\n│   │   ├── Success.vue  公共状态管理模块\n│   │   └── NotFound.vue  用户模块（子目录同上）\n│   ├── router  路由管理\n│   ├── store  公共状态管理\n│   │   ├── modules  公共状态管理模块\n│   │   │   ├── com.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 通用状态\n│   │   │   └── user.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 用户状态\n│   │   └── index.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e 公共状态管理入口\n│   └── utils  基础工具\n└── static\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e一些规范约定\x3c\/h3\x3e\n\x3cp\x3e根据本人个人开发经验总结的规范，不代表必须这么做。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e所有vue组件都以大写字面开头的驼峰命名法命名，这样保持到模板代码上，可以便于区分开html的原生标签；\x3c\/li\x3e\n\x3cli\x3e人为划分vue组件为“页面”和“页面上的组件”，原则上“页面上的组件”不发请求，不改变公共状态，全部通过事件交由“页面”完成，本人更倾向用˙集中管理。（其实vue中并没有页面概念）；\x3c\/li\x3e\n\x3cli\x3e各个模块，包括路由管理、公共状态管理、接口集等都在目录下有个index.js的入口文件，方便引用；\x3c\/li\x3e\n\x3cli\x3e基础工具内的工具使用函数式编程，做到可移植，不要对本项目产生依赖；\x3c\/li\x3e\n\x3cli\x3e资源图片只在项目中保留小图（就是会被webpack处理成base64那些），大图应使用cdn，可以动态获取也可以把地址写到一个脚本里；\x3c\/li\x3e\n\x3cli\x3e使用eslint使js代码符合Airbnb规范。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e低耦合模块化开发\x3c\/h2\x3e\n\x3cp\x3e项目过程中常遇到要把原来的项目分开部署，或是组件间耦合、或是多人开发时组件冲突等问题。本人提出的解决办法是将项目细分成模块进行开发，每个模块由若干相关“页面”组成，拥有私有组件、路由、api等，如示例所示：划分了三个模块，首页模块、财务模块、用户模块。\x3c\/p\x3e\n\x3cblockquote\x3e【小结】这种方案的核心就是要将太过零散的组件（页面）聚合成模块，每个模块都有一定迁移性，互不耦合，实现按需打包，并且在代码分割上比单纯的分页面加载更加灵活可控。\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eLayout模块承载页\x3c\/h3\x3e\n\x3cp\x3e这个是为了让开发这个模块的程序员有类似根组件\x3ccode\x3e\x26lt;App\x26gt;\x3c\/code\x3e的公共空间。从路由的角度来说，所有的模块内页面都是它的子路由，这样隔离了对全局路由的影响，至少路径定义可以随意些。  \x3cbr\x3e一般来说它只是个空的路由跳转页，当然你把模块的公共数据放这里也可以的，在子路由就能\x3ccode\x3ethis.$parent\x3c\/code\x3e拿到数据，可以当成子路由间的bus使用，如下以示例的user模块为例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ctemplate\x3e\n  \x3crouter-view\/\x3e\n\x3c\/template\x3e\n\x3cscript\x3e\nexport default {\n  name: \x27user\x27,\n  data(){\n    return {\n      name: \x27大白\x27,\n      age: 12,\n    };\n  },\n};\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3erouter-view\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e,\n  data(){\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27大白\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e,\n    };\n  },\n};\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e模块内路由\x3c\/h3\x3e\n\x3cp\x3e模块内路由最后都会被导入总路由中，不要以为只是简单合并了文件，这里的设计也跟Layout模块承载页有关，\x3cbr\x3e下面以user模块为例，我们把个人中心、登录和修改个人信息这三个页面归为user模块，路由规划如下。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e个人中心：\x3ccode\x3e\/user\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e登录：\x3ccode\x3e\/user\/login\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e修改个人信息：\x3ccode\x3e\/user\/userInfo\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e其中由于“个人中心”是一级页面，需求要求底部有tabBar，所以使它只能是一级路由。  \x3cbr\x3e接下来你会发现Layout模块承载页的路由路劲也是\x27\/user\x27，这里不用担心会乱，因为路由管理是按顺序匹配的，至于为什么要路径一样，这只是为了满足路由规划，让路径好看而已。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 通用的tabbar\nimport IndexTabBar from \x27@\/components\/common\/IndexTabBar\x27;\n\/\/ 模块内的页面\nimport UserIndex from \x27.\/pages\/UserIndex\x27;\nimport UserLogin from \x27.\/pages\/UserLogin\x27;\nimport UserInfo from \x27.\/pages\/UserInfo\x27;\n\nexport default [\n  \/\/ 一级路由\n  {\n    name: \x27userIndex\x27,\n    path: \x27\/user\x27,\n    meta: {\n      title: \x27个人中心\x27,\n    },\n    components: {\n      default: UserIndex,\n      footer: IndexTabBar,\n    },\n  },\n  {\n    path: \x27\/user\x27,\n    \/\/ 这里分割子路由\n    component: () =\x3e import(\x27.\/layout.vue\x27),  \n    children: [\n      \/\/ 二级路由\n      {\n        name: \x27userLogin\x27,\n        path: \x27login\x27,\n        meta: {\n          title: \x27登录\x27,\n        },\n        component: UserLogin,\n      },\n      {\n        name: \x27userInfo\x27,\n        path: \x27info\x27,\n        meta: {\n          title: \x27修改个人信息\x27,\n          requiresAuth: true,\n        },\n        component: UserInfo,\n      },\n    ],\n  },\n];\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通用的tabbar\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e IndexTabBar \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@\/components\/common\/IndexTabBar\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模块内的页面\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e UserIndex \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/pages\/UserIndex\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e UserLogin \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/pages\/UserLogin\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e UserInfo \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/pages\/UserInfo\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e [\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 一级路由\x3c\/span\x3e\n  {\n    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27userIndex\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/user\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3emeta\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27个人中心\x27\x3c\/span\x3e,\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3ecomponents\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3edefault\x3c\/span\x3e: UserIndex,\n      \x3cspan class=\x22hljs-attr\x22\x3efooter\x3c\/span\x3e: IndexTabBar,\n    },\n  },\n  {\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/user\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里分割子路由\x3c\/span\x3e\n    component: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/layout.vue\x27\x3c\/span\x3e),  \n    \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: [\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 二级路由\x3c\/span\x3e\n      {\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27userLogin\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27login\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3emeta\x3c\/span\x3e: {\n          \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27登录\x27\x3c\/span\x3e,\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: UserLogin,\n      },\n      {\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27userInfo\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3emeta\x3c\/span\x3e: {\n          \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27修改个人信息\x27\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3erequiresAuth\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: UserInfo,\n      },\n    ],\n  },\n];\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e模块承载页以懒加载的形式\x3ccode\x3ecomponent: () =\x26gt; import(\x27.\/layout.vue\x27)\x3c\/code\x3e引入，这会使webpack在此处分割代码，也就是说进入模块内是需要再此请求的，可以减少首次加载的数据量，提高速度。  \x3cbr\x3e\x3ca href=\x22https:\/\/router.vuejs.org\/zh-cn\/advanced\/lazy-loading.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e官方关于懒加载的文档\x3c\/a\x3e  \x3cbr\x3e这里你会发现后续的子路由，又是以直接引入的方式加载，也就是说整个模块会一起加载，实现了\x3cstrong\x3e分模块加载\x3c\/strong\x3e。  \x3cbr\x3e这与简单的分页面加载不同，分页面加载一直有个难点，就是分割的量比较难把握（太多会增加请求次数，太少又降低了速度），而分模块可以将相关页面一起加载（跟提高缓存命中率很像），可以更灵活的规划我们的加载，最终效果：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e用户进入应用，首页的三个页面（有tabbar的）就已经加载完毕，这时点击哪个tabbar按钮都能流畅；\x3c\/li\x3e\n\x3cli\x3e当用户进入某个页面内的子页面，会产生一次请求；\x3c\/li\x3e\n\x3cli\x3e这时整个模块的页面都加载完（不一定要全部），用户在这个模块内又能流畅访问。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e模块api集\x3c\/h3\x3e\n\x3cp\x3e这个设计跟模块内路由类似，目的也是为了按需加载和隔离全局。  \x3cbr\x3e下面也是以user模块的模块api集为例，可以发现和路由有一些不同就是这里为了防止模块跟全局耦合，运用函数式编程思想（类似于依赖注入），将全局的axios实例作为函数参数传入，再返回出一个包含api的对象，这个导出的对象将会被\x3cstrong\x3e以模块名命名\x3c\/strong\x3e，合并到全局的api集中。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default function (axios) {\n  return {\n    postHeadImg(token, userId, data) {\n      const options = {\n        method: \x27post\x27,\n        name: \x27换头像\x27,\n        url: \x27\/data\/user\/updateHeadImg\x27,\n        headers: {\n          token,\n          userId,\n        },\n        data,\n      };\n      return axios(options);\n    },\n    postProduct(token, userId, data) {\n      const options = {\n        method: \x27post\x27,\n        name: \x27提交产品选择\x27,\n        url: \x27\/product\/opt\x27,\n        headers: {\n          token,\n          userId,\n        },\n        data,\n      };\n      return axios(options);\n    },\n  };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eaxios\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    postHeadImg(token, userId, data) {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e options = {\n        \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27post\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27换头像\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/data\/user\/updateHeadImg\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: {\n          token,\n          userId,\n        },\n        data,\n      };\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e axios(options);\n    },\n    postProduct(token, userId, data) {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e options = {\n        \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27post\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27提交产品选择\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/product\/opt\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: {\n          token,\n          userId,\n        },\n        data,\n      };\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e axios(options);\n    },\n  };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e模块入口\x3c\/h3\x3e\n\x3cp\x3e为了方便引用，每个模块目录下都有一个index.js，引入模块的时候可以省略，node会自动读这个文件。  \x3cbr\x3e还是以user模块为例，这里主要是引入模块专属api和模块内路由，并定义了模块的名字，这个名字是后面挂载专属api是时候用的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import api from \x27.\/api\x27;\nimport router from \x27.\/router\x27;\n\nexport default {\n  name: \x27user\x27,\n  api,\n  router,\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e api \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/api\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e router \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/router\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e,\n  api,\n  router,\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e按需打包\x3c\/h3\x3e\n\x3cp\x3e示例中config目录下有个modules.js文件是指定打包需要的模块，测试一下打包不同数量的模块，会发现产品文件大小会改变，这就证明了已经实现按需打包。\x3cbr\x3e至于路由和api集的子模块整合实现，后面会提到。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import home from \x27@\/modules\/home\x27;\nimport finance from \x27@\/modules\/finance\x27;\nimport user from \x27@\/modules\/user\x27;\n\nexport default [\n  home,\n  finance,\n  user\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e home \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@\/modules\/home\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e finance \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@\/modules\/finance\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e user \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@\/modules\/user\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e [\n  home,\n  finance,\n  user\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3eapi集的配置\x3c\/h2\x3e\n\x3cblockquote\x3e【背景】示例项目模拟常见的接口约定，服务器与应用交互有两个自定义头部：token和userId。token是权限标识符，几乎全部api都需要带上，为了防CSRF；userId是登录状态标识符，有些需要登录状态才能使用的接口才需要带上，这两个标识符都有有效期。本示例暂不考虑自动续期的机制。\x3c\/blockquote\x3e\n\x3cp\x3e在api管理方面本人比较喜欢集中管理接口和配置，但发起请求和请求回调倾向与每个接口单独处理。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e导出axios实例\x3c\/h3\x3e\n\x3cp\x3eaxios是比较流行的ajax的promise封装。\x3ca href=\x22https:\/\/github.com\/axios\/axios\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eaxios官方文档\x3c\/a\x3e  \x3cbr\x3e本人推荐在全局保留唯一的axios实例，所有的请求都使用这个公共实例发起，实现配置的统一。  \x3cbr\x3e示例项目的在api文件夹下的axiosConfig.js就是axios的配置，主要是导出一个符合项目设置的实例，并进行一些拦截器设置。\x3c\/p\x3e\n\x3cblockquote\x3e【PS】至于为什么到导出实例而不是直接修改axios默认值？  \x3cbr\x3e这是为了预防某些特例情况下公共实例无法满足需求，需要单独配置axios的情况，所以为了不污染原始的axios默认值，不推荐修改默认值。\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 引入axios包\nimport axios from \x27axios\x27;\n\/\/ 引入环境配置\nimport env from \x27..\/config\/env\x27;\n\/\/ 引入公共状态管理\nimport store from \x27..\/store\/index\x27;\n\n\/\/ 全局默认配置\nconst myAxios = axios.create({\n  \/\/ 跨域带cookie\n  withCredentials: true,\n  \/\/ 基础url\n  baseURL: `${env.apiUrl}\/${env.apiVersion}`,\n  \/\/ 超时时间\n  timeout: 12000,\n});\n\n\/\/ 请求发起前拦截器\nmyAxios.interceptors.request.use((_config) =\x3e {\n  \/\/ ...\n  return config;\n}, () =\x3e {\n  \/\/ 异常处理\n});\n\n\/\/ 响应拦截器\nmyAxios.interceptors.response.use((response) =\x3e {\n  \/\/ ...\n}, (error) =\x3e {\n  \/\/ 异常处理\n  return Promise.reject(error);\n});\n\nexport default myAxios;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 引入axios包\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e axios \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27axios\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 引入环境配置\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e env \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/config\/env\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 引入公共状态管理\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e store \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/store\/index\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 全局默认配置\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e myAxios = axios.create({\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 跨域带cookie\x3c\/span\x3e\n  withCredentials: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 基础url\x3c\/span\x3e\n  baseURL: \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${env.apiUrl}\x3c\/span\x3e\/\x3cspan class=\x22hljs-subst\x22\x3e${env.apiVersion}\x3c\/span\x3e`\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 超时时间\x3c\/span\x3e\n  timeout: \x3cspan class=\x22hljs-number\x22\x3e12000\x3c\/span\x3e,\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 请求发起前拦截器\x3c\/span\x3e\nmyAxios.interceptors.request.use(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e_config\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e config;\n}, () =\x26gt; {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 异常处理\x3c\/span\x3e\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 响应拦截器\x3c\/span\x3e\nmyAxios.interceptors.response.use(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n}, (error) =\x26gt; {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 异常处理\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(error);\n});\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e myAxios;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e公共api集\x3c\/h3\x3e\n\x3cp\x3e项目的所有公共api都会编写到这里，实现集中化管理，最后公共api集会挂载到vue根实例下，使用\x3ccode\x3ethis.$api\x3c\/code\x3e就可以方便的访问。  \x3cbr\x3e由于token和userId不是必须头部，这里我推荐每个接口函数都单独处理，按需传入，这样api函数也能更加清晰。\x3cbr\x3e给每个接口起名字，是为了后续取消请求所设计的。  \x3cbr\x3e整体思路：\x3cstrong\x3e先定义公共api，再将模块内api（按需）挂载进来\x3c\/strong\x3e，最后导出api集。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 引入已经配置好的axios实例\nimport axios from \x27.\/axiosConfig\x27;\n\/\/ 引入模块\nimport modules from \x27..\/config\/modules\x27;\n\nconst apiList = {\n  \/\/ 获取token不需要\n  getToken() {\n    const options = {\n      method: \x27post\x27,\n      name: \x27获取token\x27,\n      url: \x27\/token\/get\x27,\n    };\n    return axios(options);\n  },\n  loginWithName(token, data) {\n    const options = {\n      method: \x27post\x27,\n      name: \x27用户名密码登录\x27,\n      url: \x27\/data\/user\/login4up\x27,\n      headers: {\n        token,\n      },\n      data,\n    };\n    return axios(options);\n  },\n  postHeadImg(token, userId, data) {\n    const options = {\n      method: \x27post\x27,\n      name: \x27换头像\x27,\n      url: \x27\/data\/user\/updateHeadImg\x27,\n      headers: {\n        token,\n        userId,\n      },\n      data,\n    };\n    return axios(options);\n  },\n};\n\/\/ 使每个模块里的api集挂载到以模块名为名的命名空间下\nmodules.forEach((i) =\x3e {\n  Object.assign(apiList, {\n    [i.name]: i.api(axios),\n  });\n});\n\nexport default apiList;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 引入已经配置好的axios实例\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e axios \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/axiosConfig\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 引入模块\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e modules \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/config\/modules\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e apiList = {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取token不需要\x3c\/span\x3e\n  getToken() {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e options = {\n      \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27post\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27获取token\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/token\/get\x27\x3c\/span\x3e,\n    };\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e axios(options);\n  },\n  loginWithName(token, data) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e options = {\n      \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27post\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27用户名密码登录\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/data\/user\/login4up\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: {\n        token,\n      },\n      data,\n    };\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e axios(options);\n  },\n  postHeadImg(token, userId, data) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e options = {\n      \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27post\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27换头像\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/data\/user\/updateHeadImg\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: {\n        token,\n        userId,\n      },\n      data,\n    };\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e axios(options);\n  },\n};\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使每个模块里的api集挂载到以模块名为名的命名空间下\x3c\/span\x3e\nmodules.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ei\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign(apiList, {\n    [i.name]: i.api(axios),\n  });\n});\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e apiList;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader15\x22\x3e路由管理配置\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3e导入模块内路由\x3c\/h3\x3e\n\x3cp\x3e使用示例中用router文件夹下的index.js配置全局路由，api集类似实现集中化管理，导出路由实例会挂载到vue根实例下，使用\x3ccode\x3ethis.$router\x3c\/code\x3e就可以方便的访问。  \x3cbr\x3e配置参考官方文档，这里主要提的一点是，模块内路由的整合，见实例代码段。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Vue.use(Router);\n\/\/ 路由配置\nconst routerConfig = {\n  routes: [\n    {\n      path: \x27\/\x27,\n      meta: {\n        title: env.appName,\n      },\n      redirect: { name: \x27home\x27 },\n    },\n    {\n      name: \x27success\x27,\n      path: \x27\/success\x27,\n      meta: {\n        title: \x27成功\x27,\n      },\n      component: Success,\n    },\n    {\n      path: \x27*\x27,\n      component: NotFound,\n    },\n  ],\n};\n\/\/ 将模块内的路由拼接到全局\nmodules.forEach((i) =\x3e {\n  routerConfig.routes = routerConfig.routes.concat(i.router);\n});\nconst router = new Router(routerConfig);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eVue.use(Router);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 路由配置\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e routerConfig = {\n  \x3cspan class=\x22hljs-attr\x22\x3eroutes\x3c\/span\x3e: [\n    {\n      \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3emeta\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: env.appName,\n      },\n      \x3cspan class=\x22hljs-attr\x22\x3eredirect\x3c\/span\x3e: { \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27home\x27\x3c\/span\x3e },\n    },\n    {\n      \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27success\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/success\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3emeta\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27成功\x27\x3c\/span\x3e,\n      },\n      \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Success,\n    },\n    {\n      \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: NotFound,\n    },\n  ],\n};\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将模块内的路由拼接到全局\x3c\/span\x3e\nmodules.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ei\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  routerConfig.routes = routerConfig.routes.concat(i.router);\n});\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e router = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Router(routerConfig);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3e在路由钩子函数中处理标题和权限\x3c\/h3\x3e\n\x3cp\x3e路由的钩子函数有很多妙用，这里列举了一些例子。  \x3cbr\x3e路由元信息meta可以自定义需要的数据，相当于给路由一个标记，然后在router.afterEach钩子函数中可以读取到并进行处理。  \x3cbr\x3e回顾上面示例的模块内路由，meta中定义了title（标题）和requiresAuth（是否要登录状态），这就会在这里体现出用处。把登录权限设置在这里判断是为了防止用户进入某些需要权限的“页面”。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22router.beforeEach((to, from, next) =\x3e {\n  \/\/ 关闭公共弹框\n  if (window.loading) {\n    window.loading.close();\n  }\n  \/\/ 设置微信分享（如果有）\n  wxShare({\n    title: \x27哇哈哈\x27,\n    desc: \x27在路由钩子函数中处理标题和权限\x27,\n    link: env.shareBaseUrl,\n    imgUrl: env.shareBaseUrl \x2b \x27\/images\/shareLogo.png\x27\n  });\n  \/\/ 设置标题\n  document.title = to.meta.title ? to.meta.title : \x27示例\x27;\n  \/\/ 检查登录状态\n  if (to.meta.requiresAuth) {\n    \/\/ 目标路由需要登录状态\n    \/\/ ...\n  }\n  next();\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3erouter.beforeEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eto, \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e, next\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 关闭公共弹框\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.loading) {\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.loading.close();\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置微信分享（如果有）\x3c\/span\x3e\n  wxShare({\n    \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27哇哈哈\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3edesc\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27在路由钩子函数中处理标题和权限\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3elink\x3c\/span\x3e: env.shareBaseUrl,\n    \x3cspan class=\x22hljs-attr\x22\x3eimgUrl\x3c\/span\x3e: env.shareBaseUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/images\/shareLogo.png\x27\x3c\/span\x3e\n  });\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置标题\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.title = to.meta.title ? to.meta.title : \x3cspan class=\x22hljs-string\x22\x3e\x27示例\x27\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 检查登录状态\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (to.meta.requiresAuth) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 目标路由需要登录状态\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n  }\n  next();\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader18\x22\x3e自动化管理权限标识符（token）\x3c\/h2\x3e\n\x3cp\x3e权限标识符的特点就是几乎每个链接都要带上，需要维护有效期，为了不浪费服务器资源还需要持久化并保证请求唯一。  \x3cbr\x3e本人比较推荐使用\x3cstrong\x3e公共状态管理vuex进行自动化管理\x3c\/strong\x3e，减少代码编写时的顾虑。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader19\x22\x3e妙用公共状态管理获取token\x3c\/h3\x3e\n\x3cp\x3e示例中公共状态中的com模块里有tokenObj和waitToken两个字段，其中tokenObj包含了token和过期时间，waitToken是一个标记是否当前在获取token的布尔值。\x3c\/p\x3e\n\x3cblockquote\x3e【PS】为什么要token保证唯一一次请求？  \x3cbr\x3e常见的场景：当用户进入应用，这时候token要么没有要么已过期，这时页面需要并发两个ajax请求，由于都没有token，不唯一化处理的话，会同时先发起两个token请求，这样首先是浪费了请求资源，其次由于是异步请求，不能保证两次token的顺序，如果服务器对token管理较严格则会出问题。\x3c\/blockquote\x3e\n\x3cp\x3e由于获取token是异步操作，所以getToken写在actions中，把主要过程包裹成立即执行函数，并通过waitToken判断是否要等待，如果要等待就隔一段时间再检查，这样就保证了并发请求时，token能唯一。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const actions = {\n  \/\/ needToRegain是为了特殊条件下强制获取使用\n  getToken({ commit, state: _state }, needToRegain) {\n    return new Promise((resolve, reject) =\x3e {\n      (function main() {\n        \/\/ 如果waitToken为真即表示发起了请求但还未回应\n        if (_state.waitToken) {\n          console.log(\x27等待token\x27);\n          setTimeout(() =\x3e {\n            main();\n          }, 1000);\n          return;\n        }\n        \/\/ 是否过期标记\n        let isExpire = false;\n        \/\/ 提取现有的tokenObj\n        let tokenObj = {\n          ..._state.tokenObj,\n        };\n        \/\/ 如果没有token就从本地存储中读取\n        if (!tokenObj.token) {\n          tokenObj = JSON.parse(localStorage.getItem(\x27tokenObj\x27));\n          \/\/ 如果本地有tokenObj会顺便添加到状态管理\n          if (tokenObj) {\n            commit(\x27setTokenObj\x27, tokenObj);\n          }\n        }\n        \/\/ token是否过时\n        if (tokenObj \x26amp;\x26amp; tokenObj.token) {\n          isExpire = new Date().getTime() - tokenObj.expireTime \x3e -10000;\n        }\n        \/\/ 综合判断是否需要获取token\n        if (!tokenObj || !tokenObj.token || isExpire || needToRegain) {\n          commit(\x27setWaitToken\x27, true);\n          api.getToken().then((res) =\x3e {\n            \/\/ 检查返回的数据\n            const checkedData = connect.dataCheck(res);\n            if (checkedData.isDataReady) {\n              const newTokenObj = {\n                token: checkedData.data.token,\n                expireTime: new Date().getTime() \x2b (checkedData.data.expire_time * 1000),\n              };\n              \/\/ 设置TokenObj会顺便保留一份到本地存储\n              commit(\x27setTokenObj\x27, newTokenObj);\n              commit(\x27setWaitToken\x27, false);\n              console.log(\x27获取token成功\x27);\n              resolve(newTokenObj.token);\n            } else {\n              commit(\x27setWaitToken\x27, false);\n              console.error(\x27获取token失败\x27);\n              reject(checkedData.msg);\n            }\n          }).catch((err) =\x3e {\n            window.toast(\x27网络错误\x27);\n            commit(\x27setWaitToken\x27, false);\n            reject(err);\n          });\n        } else {\n          console.log(\x27token已存在，直接返回\x27);\n          resolve(tokenObj.token);\n        }\n      }());\n    });\n  },\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e actions = {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ needToRegain是为了特殊条件下强制获取使用\x3c\/span\x3e\n  getToken({ commit, \x3cspan class=\x22hljs-attr\x22\x3estate\x3c\/span\x3e: _state }, needToRegain) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      (\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emain\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果waitToken为真即表示发起了请求但还未回应\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (_state.waitToken) {\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27等待token\x27\x3c\/span\x3e);\n          setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            main();\n          }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 是否过期标记\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e isExpire = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 提取现有的tokenObj\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e tokenObj = {\n          ..._state.tokenObj,\n        };\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果没有token就从本地存储中读取\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!tokenObj.token) {\n          tokenObj = \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.parse(localStorage.getItem(\x3cspan class=\x22hljs-string\x22\x3e\x27tokenObj\x27\x3c\/span\x3e));\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果本地有tokenObj会顺便添加到状态管理\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (tokenObj) {\n            commit(\x3cspan class=\x22hljs-string\x22\x3e\x27setTokenObj\x27\x3c\/span\x3e, tokenObj);\n          }\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ token是否过时\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (tokenObj \x26amp;\x26amp; tokenObj.token) {\n          isExpire = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime() - tokenObj.expireTime \x26gt; \x3cspan class=\x22hljs-number\x22\x3e-10000\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 综合判断是否需要获取token\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!tokenObj || !tokenObj.token || isExpire || needToRegain) {\n          commit(\x3cspan class=\x22hljs-string\x22\x3e\x27setWaitToken\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n          api.getToken().then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 检查返回的数据\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e checkedData = connect.dataCheck(res);\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (checkedData.isDataReady) {\n              \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e newTokenObj = {\n                \x3cspan class=\x22hljs-attr\x22\x3etoken\x3c\/span\x3e: checkedData.data.token,\n                \x3cspan class=\x22hljs-attr\x22\x3eexpireTime\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime() \x2b (checkedData.data.expire_time * \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e),\n              };\n              \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置TokenObj会顺便保留一份到本地存储\x3c\/span\x3e\n              commit(\x3cspan class=\x22hljs-string\x22\x3e\x27setTokenObj\x27\x3c\/span\x3e, newTokenObj);\n              commit(\x3cspan class=\x22hljs-string\x22\x3e\x27setWaitToken\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n              \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27获取token成功\x27\x3c\/span\x3e);\n              resolve(newTokenObj.token);\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n              commit(\x3cspan class=\x22hljs-string\x22\x3e\x27setWaitToken\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n              \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(\x3cspan class=\x22hljs-string\x22\x3e\x27获取token失败\x27\x3c\/span\x3e);\n              reject(checkedData.msg);\n            }\n          }).catch(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.toast(\x3cspan class=\x22hljs-string\x22\x3e\x27网络错误\x27\x3c\/span\x3e);\n            commit(\x3cspan class=\x22hljs-string\x22\x3e\x27setWaitToken\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n            reject(err);\n          });\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27token已存在，直接返回\x27\x3c\/span\x3e);\n          resolve(tokenObj.token);\n        }\n      }());\n    });\n  },\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader20\x22\x3etoken在请求代码中使用\x3c\/h3\x3e\n\x3cp\x3e将需要token的api函数套在getToken的回调中，就能方便的使用，不用再担心token是否过期。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const sendData = {\n  mobile: this.formData1.mobile,\n};\nthis.$store.dispatch(\x27getToken\x27).then((token) =\x3e {\n  this.$api.sendSMS(token, sendData).then((res) =\x3e {\n    const checkedData = this.$connect.dataCheck(res);\n    if (checkedData.isDataReady) {\n      window.toast(\x27验证码已发送，请查收短信\x27);\n    } else {\n      window.toast(\x27验证码发送失败\x27);\n    }\n  }).catch(() =\x3e {\n    window.toast(\x27网络错误\x27);\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e sendData = {\n  \x3cspan class=\x22hljs-attr\x22\x3emobile\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.formData1.mobile,\n};\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$store.dispatch(\x3cspan class=\x22hljs-string\x22\x3e\x27getToken\x27\x3c\/span\x3e).then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3etoken\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$api.sendSMS(token, sendData).then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e checkedData = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$connect.dataCheck(res);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (checkedData.isDataReady) {\n      \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.toast(\x3cspan class=\x22hljs-string\x22\x3e\x27验证码已发送，请查收短信\x27\x3c\/span\x3e);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.toast(\x3cspan class=\x22hljs-string\x22\x3e\x27验证码发送失败\x27\x3c\/span\x3e);\n    }\n  }).catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.toast(\x3cspan class=\x22hljs-string\x22\x3e\x27网络错误\x27\x3c\/span\x3e);\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>【Geek议题】合理的VueSPA架构讨论（上）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014086261">https://segmentfault.com/a/1190000014086261</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/06gjuq492k49/" target="_blank">https://alili.tech/archive/06gjuq492k49/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>