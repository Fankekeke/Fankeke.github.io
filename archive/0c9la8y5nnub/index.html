<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="去哪儿网迷你React的研发心得"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>去哪儿网迷你React的研发心得 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/0c9la8y5nnub/",
				"appid": "1613049289050283", 
				"title": "去哪儿网迷你React的研发心得 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-31T02:30:29"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/df8a7ban3w/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/vfw7v6ghodq/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f0c9la8y5nnub%2f&text=%e5%8e%bb%e5%93%aa%e5%84%bf%e7%bd%91%e8%bf%b7%e4%bd%a0React%e7%9a%84%e7%a0%94%e5%8f%91%e5%bf%83%e5%be%97"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f0c9la8y5nnub%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f0c9la8y5nnub%2f&text=%e5%8e%bb%e5%93%aa%e5%84%bf%e7%bd%91%e8%bf%b7%e4%bd%a0React%e7%9a%84%e7%a0%94%e5%8f%91%e5%bf%83%e5%be%97"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f0c9la8y5nnub%2f&title=%e5%8e%bb%e5%93%aa%e5%84%bf%e7%bd%91%e8%bf%b7%e4%bd%a0React%e7%9a%84%e7%a0%94%e5%8f%91%e5%bf%83%e5%be%97"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f0c9la8y5nnub%2f&is_video=false&description=%e5%8e%bb%e5%93%aa%e5%84%bf%e7%bd%91%e8%bf%b7%e4%bd%a0React%e7%9a%84%e7%a0%94%e5%8f%91%e5%bf%83%e5%be%97"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%8e%bb%e5%93%aa%e5%84%bf%e7%bd%91%e8%bf%b7%e4%bd%a0React%e7%9a%84%e7%a0%94%e5%8f%91%e5%bf%83%e5%be%97&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f0c9la8y5nnub%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f0c9la8y5nnub%2f&title=%e5%8e%bb%e5%93%aa%e5%84%bf%e7%bd%91%e8%bf%b7%e4%bd%a0React%e7%9a%84%e7%a0%94%e5%8f%91%e5%bf%83%e5%be%97"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f0c9la8y5nnub%2f&title=%e5%8e%bb%e5%93%aa%e5%84%bf%e7%bd%91%e8%bf%b7%e4%bd%a0React%e7%9a%84%e7%a0%94%e5%8f%91%e5%bf%83%e5%be%97"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f0c9la8y5nnub%2f&title=%e5%8e%bb%e5%93%aa%e5%84%bf%e7%bd%91%e8%bf%b7%e4%bd%a0React%e7%9a%84%e7%a0%94%e5%8f%91%e5%bf%83%e5%be%97"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f0c9la8y5nnub%2f&title=%e5%8e%bb%e5%93%aa%e5%84%bf%e7%bd%91%e8%bf%b7%e4%bd%a0React%e7%9a%84%e7%a0%94%e5%8f%91%e5%bf%83%e5%be%97"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">去哪儿网迷你React的研发心得</h1><div class="meta"><div class="postdate"><time datetime="2018-12-31" itemprop="datePublished">2018-12-31</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cstrong\x3e去哪儿网迷你React\x3c\/strong\x3e是年初立项的新作品，在这前，去哪儿网已经深耕多年，拥有\x3cstrong\x3eQRN\x3c\/strong\x3e（react-native的公司制定版），\x3cstrong\x3eHY\x3c\/strong\x3e（基于React的hybird方案）， \x3cstrong\x3eyo\x3c\/strong\x3e(基于React的移动UI库)，\x3cstrong\x3eQRN-web\x3c\/strong\x3e(基于React的三端合一移植方案)，此外，像机票等部门也大规模将React用于前台页面，后台页面就更不在话下。\x3c\/p\x3e\n\x3cp\x3e如此广泛地应用React，我们熟晓其优缺点。优点是代码的可维护性大大提高，性能卓然！但缺点也明显，由于体积太大，React.js\x2bReact-DOM.js超过3万行，体量过3MB，已经加上immutable.js , redux, redux-react, react-router等全家桶，工程师一行代码没有写，已经好几MB了。这在过去绝对不可想象，要知道，体积意味着流量，流量代表着金钱，越大越烧钱，越大下载速度越慢，用户体验越差，用户就会流失。现在问题摆在我们面前，我们就得解决。虽然webpack官网有各种瘦身方案，但瘦死的大象也比马大。这是一个如此普遍存在的问题，因此外国人肯定也遇到过，思考过，提出什么新点子——所有这一切，都指向一个名词，“迷你React”。\x3c\/p\x3e\n\x3cp\x3e作为一个生态圈成熟的标志，一个库出名了，就各种偏门补丁，闪光效果往上加，库难免会膨胀，不爽的人就会推出迷你化方案。上一个世代是jQuery与zepto。React的迷你方案也有不少，preact, inferno, react-lite, dio, rax……\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjQA?w=459\x26amp;h=198\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjQA?w=459\x26amp;h=198\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e但问题不是简单到直接从github找一个迷你React库替换上就能搞定。之所以称为迷你，肯定有所欠缺，如果是内部实现的改良也罢，如果阉割了功能可不是闹着玩。恰恰他们就好这口，因此现有方案不能满足我们。我们需要一个能直接替换，或至少95％的业务代码不用动。这意味着这迷你框架，需要与React的接口完全一致，并且全面支持它的全家桶。当然细化一下来的需来就更多了，早期说只要支持移动，因此取名为react-mobile，后来连iE8也要支持，因此这活不能指望别人，我们自己动手撸了。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjQI?w=456\x26amp;h=156\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjQI?w=456\x26amp;h=156\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们先来一趟竞品分析。为了加快产出速度，能借鉴的尽可能借鉴。React推出以后，针对其性能研究衍生出不少库，针对其体积也诞生出大量仿品。它比jQuery更加缤纷多采。市面上竟然拥有100多个虚拟DOM库。虚拟DOM库，就是React出来后的一种新式库，以虚拟DOM与diff算法为核心，屏蔽DOM操作，操作数据即操作视图。这听起来有点像MVVM，MVVM也是屏蔽DOM操作，操作数据即操作视图，但它是以VM为核心。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjQK?w=526\x26amp;h=292\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjQK?w=526\x26amp;h=292\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eReact及其他虚拟DOM库已经将虚拟DOM的生成交由JSX与babel处理了，因此不同点是，虚拟DOM的结构与diff算法。虚拟DOM万宗不离其变是三大属性，type, props, children，当然也可以改一下别名，babel可以做相应配置。此外，虚拟DOM可以加入更多冗余标识，以帮diff算法的改良。\x3c\/p\x3e\n\x3cp\x3eReact最初推出时也不火，那时的招牌与现在性能不什么两样，也是高性能。但是JSX离经背道，与业界宣扬了多年的前后端分离，数据结构样式分离等教条差太远了，一直默默在角落里画圈。直到RN出来，解决原生编写界面的痛苦才一炮而红。大家才留意它的性能，它的性能背后的diff算法。最早研究React的diff算法是virtual-dom这个库，是基于经典的DFS算法。后来相应的算法就多起来。最后才是从接口进行模拟，就是所谓的React-like框架。因此虚拟DOM库是分为两大派系：算法派与拟态派。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjQR?w=492\x26amp;h=228\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjQR?w=492\x26amp;h=228\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e下面将从这两大派系进行扼要的描述。\x3c\/p\x3e\n\x3cp\x3e将前端回归到算法上的探索是前端框架史上的一个巨大进步。之前是MVVM将数据从繁复的DOM操作分离出来。正因为有了纯数据，并且数据结构可控，那么算法才有发挥的余地。\x3c\/p\x3e\n\x3cp\x3e最开始出现的是 virtual-dom这个库，是大家好奇React为什么这么快而搞鼓出来的。它的实现是非常学院风格，通过深度优先搜索与in-order tree来实现高效的diff。它与React后来公开出来的算法是很不一样。\x3c\/p\x3e\n\x3cp\x3e然后是cito.js的横空出世，它对今后所有虚拟DOM的算法都有重大影响。它采用两端同时进行比较的算法，将diff速度拉高到几个层次。\x3c\/p\x3e\n\x3cp\x3e紧随其后的是kivi.js，在cito.js的基出提出两项优化方案，使用key实现移动追踪及基于key的编辑长度矩离算法应用（算法复杂度 为O(n^2)）。\x3c\/p\x3e\n\x3cp\x3e但这样的diff算法太过复杂了，于是后来者snabbdom将kivi.js进行简化，去掉编辑长度矩离算法，调整两端比较算法。速度略有损失，但可读性大大提高。再之后，就是著名的vue2.0 把sanbbdom整个库整合掉了。\x3c\/p\x3e\n\x3cp\x3e当然算法派的老大是inferno，它使用多种优化方案将性能提至最高，因此其作者便邀请进react core team，负责react的性能优化了。这个我后面会详细。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjQW?w=473\x26amp;h=279\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjQW?w=473\x26amp;h=279\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e再看拟态派。React的接口并不多，但是其组件的实现是相当有难度。它的生命周期是如何运作，需要对源码有深刻的理解，因此它们出来得比较晚。我们的学习对象也就是它们几个。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjQ2?w=464\x26amp;h=237\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjQ2?w=464\x26amp;h=237\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e先说虚拟DOM。虚拟DOM就是一个普通的JS对象，通常拥有三个属性，type, props, children。但无状态组件出来后，children改放到props中。此外，有些元素还有ref属性，可以是字符串与函数。在数组里，为了提高diff速度，又多出了key属性。bable会将JSX这些属性转换为一个VNode对象。这是虚拟DOM的最小单元。所有虚拟DOM会组成一棵树，叫虚拟DOM树。\x3c\/p\x3e\n\x3cp\x3e为了防止每次都是整个树进行diff，需要形成子树的概念，于是出现组件了。组件有render方法，会返回一个虚拟DOM，这个虚拟DOM及其子孙，就形成一棵子树。但render方法不是虚拟DOM的东西，于是我们规定当虚拟DOM为一个函数时，如果这个函数继承于React.Component，这个方法的实例必须有render方法。于是我们就像虚拟DOM与组件统合起来了。或者衍生这两个称呼，原子虚拟DOM与组件虚拟DOM。原子虚拟DOM对应元素节点，而组件则是用来产出原子虚拟DOM。此外，原子虚拟DOM还能包含一些东西，字符串与数字与null。字符串与数字对应文本节点，null对应注释节点。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjQ4?w=440\x26amp;h=287\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjQ4?w=440\x26amp;h=287\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e一个组件虚拟DOM实例化为组件后，会返回原子虚拟DOM或另一个组件虚拟DOM。这就形成函数式编程上的高阶函数的机制，因此进行出无状态函数组件，就是虚拟DOM的type属性就是一个函数，不继承其他东西了。\x3c\/p\x3e\n\x3cp\x3e组件虚拟DOM的实例化过程是非常复杂，如果能简化这过程，简化其结构，这性能就上去了。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjQ6?w=399\x26amp;h=286\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjQ6?w=399\x26amp;h=286\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e此外组件的实例本身就巨耗性能，因此官方推荐页面的结构如下，通过最少量的有状态组件（smart component）控制无状态组件(dumb component)的变化，所有状态通过redux在路由进行分发。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjQ9?w=579\x26amp;h=506\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjQ9?w=579\x26amp;h=506\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e经过一番比较后，我们着手开发自己的迷你React。这个过程也比较坎坷，这还是有前人参照物的情况下，可想而知，当初facebook开发出React这样一个独行特立的框架时，是多么艰辛。我们在这半年总共搞了三个东西，第一还孵化失败。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjRb?w=513\x26amp;h=136\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjRb?w=513\x26amp;h=136\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e最初是基于react-lite，考虑时当时是我们母公司的人搞的，方便交流。但后来发现它的事件系统太鸡肋，难以扩展，最后放弃了。\x3c\/p\x3e\n\x3cp\x3e第二代是基于preact，代号qreact， 国内也有许多公司基于它做自己的迷你化方案，因为官方提供了一个preact-compat的模块。但是preact-compat是使用Object.defineProperty来实现一些属性名映射与同步的，因此不支持IE8，并且使用了Object.defineProperty会严重拖慢速度。preact本身也有不少BUG，最著名的有三个，生命周期的unmount钩子不能保证在mount之前执行，元素节点的重复利用没有清理样式会导致出错，同一组孩子下可能存在同名的key导致排序失败。这些我们都为官方提issue，并且在我们的版本中进行修复了。第二代也公司内部几个项目中试水落地，反映不错。\x3c\/p\x3e\n\x3cp\x3e第三代是我们团队独力开发，a内部代号anu，正式名称仍然是 QReact，不过演进到了 QReact 1.0 了  （现在的版本使用了 1.0 大版本，因为之前这个版本没被占用，所以没跳到 2.0）。在对preact缝缝补补的过程，掌握不少核心知识，新的框架是使用全新的算法，全新的结构。由于不使用高级API，理论上能支持到IE6，但我们公司只需支持到IE8。\x3c\/p\x3e\n\x3cp\x3eQreact1.0使用requestAnimationFrame来稳定它的运行帧数，保证在60帧每秒的流畅速度。由于bable会对type进行打补丁，内部统一用typeNumber代替type进行类型判定。使用列队保证生命周期钩子按顺序执行。使用__rerender标识一个组件在一次大的更新只会被render一次。凡此种种，经过大量测试，它们的接口与React别无二致，甚至React废弃的接口createClass, PropTypes，我们都有相应的polyfill。\x3c\/p\x3e\n\x3cp\x3e下面是Qreact1.0的测试数据。\x3cbr\x3e从性能上，直追preact。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjRe?w=652\x26amp;h=491\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjRe?w=652\x26amp;h=491\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e从体积上，是官方react的1\/4至1\/5之间。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjRl?w=1350\x26amp;h=270\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjRl?w=1350\x26amp;h=270\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这里透露一下React性能爆表的秘密，除了diff算法外，setState的合并操作也是一个关键。当组件没有插入到DOM树前，用户在componentWillMount方法多次执行setState，这些state是不会触发更新，而是存放到一个数组中，然后在render方法里进行合并与应用。当一个组件进行更新，可能是用户在componentDidMount或者事件回调执行setState，这时更新是即时的，同步的，但这之次再setState，它就不会更新了，它的state会进入列队。此外，如果用户在componentWillReceiveProps多次执行setState，也会产生延迟。React这种行为是保证页面的更新次数最少，同时用户不会察觉它没有更新。它只是将state进行了合并。Qreact1.0是完全遵循了这些规则，从而实现了高性能。\x3c\/p\x3e\n\x3cp\x3e而在体积上，则通过删除一些对线上没用的代码实现迷你化效果。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjRm?w=415\x26amp;h=250\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjRm?w=415\x26amp;h=250\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e但仅是这样不足以大吹特吹了。为了超越React的性能，从inferno与preact借签了不少手段。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjRt?w=477\x26amp;h=266\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjRt?w=477\x26amp;h=266\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e最值得一提的是hydrate机制，通过合并相邻字符串，从而减少文本节点的生成，从而减少diff次数。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjRB?w=846\x26amp;h=418\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjRB?w=846\x26amp;h=418\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e最后还有一个压轴大戏，不做测试不知道，原来高级API是如何耗性能。通过去掉Object.freeze, Object.defineProperty这些es5方法, 框架就有10帧的提升！\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjRF?w=463\x26amp;h=247\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjRF?w=463\x26amp;h=247\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e说了这么多，来些实际可运行的例子吧。目前，Qreact跑通内部几套测试，已经在金融与大搜的项目使用。它的第二版也在机票一个拥有820个模块的大项目中试水，在IE8下良好运行。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVVjRO?w=285\x26amp;h=283\x22 src=\x22https:\/\/static.alili.tech\/img\/bVVjRO?w=285\x26amp;h=283\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如果大家想在项目中使用qreact,可以在webpack或ykit的config中如下配置：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nresolve: {\n   alias: {\n      \x27react\x27: \x27anujs\x27,\n      \x27react-dom\x27: \x27anujs\x27,\n        \/\/ 若要兼容 IE 请使用以下配置\n        \/\/ \x27react\x27: \x27anujs\/dist\/ReactIE\x27,\n        \/\/ \x27react-dom\x27: \x27anujs\/dist\/ReactIE\x27,\n    \n        \/\/ 如果引用了 prop-types 或 create-react-class\n        \/\/ 需要添加如下别名\n        \x27prop-types\x27: \x27anujs\/lib\/ReactPropTypes\x27,\n        \x27create-react-class\x27: \x27anujs\/lib\/createClass\x27\n        \/\/如果你在移动端用到了onTouchTap事件\n        \x27react-tap-event-plugin\x27: \x27anujs\/lib\/injectTapEventPlugin\x27,  \n   }\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\nresolve: {\n   \x3cspan class=\x22hljs-attr\x22\x3ealias\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27anujs\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x27react-dom\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27anujs\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 若要兼容 IE 请使用以下配置\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x27react\x27: \x27anujs\/dist\/ReactIE\x27,\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x27react-dom\x27: \x27anujs\/dist\/ReactIE\x27,\x3c\/span\x3e\n    \n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果引用了 prop-types 或 create-react-class\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 需要添加如下别名\x3c\/span\x3e\n        \x3cspan class=\x22hljs-string\x22\x3e\x27prop-types\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27anujs\/lib\/ReactPropTypes\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-string\x22\x3e\x27create-react-class\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27anujs\/lib\/createClass\x27\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果你在移动端用到了onTouchTap事件\x3c\/span\x3e\n        \x3cspan class=\x22hljs-string\x22\x3e\x27react-tap-event-plugin\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27anujs\/lib\/injectTapEventPlugin\x27\x3c\/span\x3e,  \n   }\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果大家对qreact在感兴趣，欢迎与我联系，也欢迎大家为我的框架加星。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/RubyLouvre\/anu\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/RubyLouvre\/anu\/\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/YMFE\/qreact\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/YMFE\/qreact\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>去哪儿网迷你React的研发心得</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011235844">https://segmentfault.com/a/1190000011235844</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/0c9la8y5nnub/" target="_blank">https://alili.tech/archive/0c9la8y5nnub/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>