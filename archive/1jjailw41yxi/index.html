<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Vue 实现的音乐项目 music app 知识点总结分享"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Vue 实现的音乐项目 music app 知识点总结分享 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/1jjailw41yxi/",
				"appid": "1613049289050283", 
				"title": "Vue 实现的音乐项目 music app 知识点总结分享 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-13T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/h38iwy8ilyg/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/7o6hy0dpec/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f1jjailw41yxi%2f&text=Vue%20%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%9f%b3%e4%b9%90%e9%a1%b9%e7%9b%ae%20music%20app%20%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93%e5%88%86%e4%ba%ab"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f1jjailw41yxi%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f1jjailw41yxi%2f&text=Vue%20%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%9f%b3%e4%b9%90%e9%a1%b9%e7%9b%ae%20music%20app%20%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93%e5%88%86%e4%ba%ab"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f1jjailw41yxi%2f&title=Vue%20%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%9f%b3%e4%b9%90%e9%a1%b9%e7%9b%ae%20music%20app%20%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93%e5%88%86%e4%ba%ab"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f1jjailw41yxi%2f&is_video=false&description=Vue%20%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%9f%b3%e4%b9%90%e9%a1%b9%e7%9b%ae%20music%20app%20%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93%e5%88%86%e4%ba%ab"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Vue%20%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%9f%b3%e4%b9%90%e9%a1%b9%e7%9b%ae%20music%20app%20%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93%e5%88%86%e4%ba%ab&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f1jjailw41yxi%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f1jjailw41yxi%2f&title=Vue%20%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%9f%b3%e4%b9%90%e9%a1%b9%e7%9b%ae%20music%20app%20%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93%e5%88%86%e4%ba%ab"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f1jjailw41yxi%2f&title=Vue%20%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%9f%b3%e4%b9%90%e9%a1%b9%e7%9b%ae%20music%20app%20%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93%e5%88%86%e4%ba%ab"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f1jjailw41yxi%2f&title=Vue%20%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%9f%b3%e4%b9%90%e9%a1%b9%e7%9b%ae%20music%20app%20%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93%e5%88%86%e4%ba%ab"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f1jjailw41yxi%2f&title=Vue%20%e5%ae%9e%e7%8e%b0%e7%9a%84%e9%9f%b3%e4%b9%90%e9%a1%b9%e7%9b%ae%20music%20app%20%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93%e5%88%86%e4%ba%ab"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Vue 实现的音乐项目 music app 知识点总结分享</h1><div class="meta"><div class="postdate"><time datetime="2018-12-13" itemprop="datePublished">2018-12-13</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e项目总结\x3c\/h1\x3e\n\x3cp\x3e这是我第二个用 Vue 实现的项目，下面内容包括了在实现过程中所记录的知识点以及一些小技巧\x3c\/p\x3e\n\x3cp\x3e项目演示地址：\x3ca href=\x22https:\/\/music-vue.n-y.io\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/music-vue.n-y.io\x3c\/a\x3e\x3cbr\x3e源代码地址：\x3ca href=\x22https:\/\/github.com\/nanyang24\/music-vue\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/nanyang24\/...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e其他\x3c\/h3\x3e\n\x3cp\x3e此应用的全部数据来自 QQ音乐，利用 axios 结合 node.js 代理后端请求抓取\x3c\/p\x3e\n\x3cp\x3e全局通用的应用级状态使用 vuex 集中管理\x3c\/p\x3e\n\x3cp\x3e全局引入 fastclick 库，消除 click 移动浏览器 300ms 延迟\x3c\/p\x3e\n\x3cp\x3e页面是响应式的，适配常见的移动端屏幕，采用 flex 布局\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e疑难总结 \x26amp; 小技巧\x3c\/h1\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e关于 Vue 知识 \x26amp; 使用技巧\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3ev-html 可以转义字符，处理特定接口很有用\x3c\/h3\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3ewatch 对象可以观测 属性 的变化\x3c\/h3\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e像这种父组件传达子组件的参数通常都是在data()里面定义的，为什么这里要放到created()定义，两者有什么区别呢？\x3c\/h3\x3e\n\x3cp\x3e因为这个变量不需要观测它的变化，因此不用定义在 data 里，这样也会对性能有所优化\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e不明白什么时候要把变量放在data()里，什么时候又不需要放 ？\x3c\/h3\x3e\n\x3cp\x3e需要监测这个数据变化的时候，放在 data() 里，会给数据添加 getter 和 setter\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e生命周期 钩子函数\x3c\/h3\x3e\n\x3cp\x3e生命周期钩子函数，比如 mounted 是先触发子组件的 mounted，再会触发父组件的 mounted，但是对于 created 钩子，又会先触发父组件，再触发子组件。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e销毁计数器\x3c\/h3\x3e\n\x3cp\x3e如果组件有计数器，在组件销毁时期要记得清理，好习惯\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e对于 Vue 组件，this.$refs.xxx 拿到的是 Vue 实例，所以需要再通过 $el 拿到真实的 dom\x3c\/h3\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e关于 JS 知识 \x26amp; 技巧\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3esetTimeout(fn, 20)\x3c\/h3\x3e\n\x3cp\x3e一般来说 JS 线程执行完毕后一个 Tick 的时间约17ms内 DOM 就可以渲染完毕所以课程中 setTimeout(fn, 20) 是非常稳妥的写法\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e关于 webpack 知识 \x26amp; 技巧\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e\x22 ~ \x22 使 SCSS 可以使用 webpack 的相对路径\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@import \x26quot;~common\/scss\/mixin\x26quot;;\n@import \x26quot;~common\/scss\/variable\x26quot;;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e@\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22~common\/scss\/mixin\x22\x3c\/span\x3e;\n@\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22~common\/scss\/variable\x22\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3ebabel-runtime 会在编译阶段把 es6 语法编译的代码打包到业务代码中，所以要放在dependencies里。\x3c\/h3\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3eFast Click 是一个简单、易用的库，专为消除移动端浏览器从物理触摸到触发点击事件之间的300ms延时\x3c\/h3\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3e为什么会存在延迟呢？\x3c\/h3\x3e\n\x3cp\x3e从触摸按钮到触发点击事件，移动端浏览器会等待接近300ms，原因是浏览器会等待以确定你是否执行双击事件\x3c\/p\x3e\n\x3ch4\x3e何时不需要使用\x3c\/h4\x3e\n\x3col\x3e\n\x3cli\x3eFastClick 不会伴随监听任何桌面浏览器\x3c\/li\x3e\n\x3cli\x3eAndroid 系统中，在头部 meta 中设置 width=device-width 的Chrome32\x2b 浏览器不存在300ms 延时，所以，也不需要\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3ccode\x3e\x26lt;meta name=\x22viewport\x22 content=\x22width=device-width, initial-scale=1\x22\x26gt;\x3c\/code\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e同样的情况也适用于 Android设备（任何版本），在viewport 中设置 user-scalable=no，但这样就禁止缩放网页了\x3c\/li\x3e\n\x3cli\x3eIE11\x2b 浏览器中，你可以使用 touch-action: manipulation;  禁止通过双击来放大一些元素（比如：链接和按钮）。IE10可以使用 -ms-touch-action: manipulation\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader18\x22\x3e请求接口\x3c\/h2\x3e\n\x3cp\x3ejsonp:\x3c\/p\x3e\n\x3cp\x3eXHR:\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader19\x22\x3e手写轮播图\x3c\/h2\x3e\n\x3cp\x3e利用 BScroll\x3c\/p\x3e\n\x3cp\x3eBScroll 设置 loop 会自动 clone 两个轮播插在前后位置\x3c\/p\x3e\n\x3cp\x3e如果轮播循环播放，是前后各加一个轮播图保证无缝切换，所以需要再加两个宽度\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (this.loop) {\n  width \x2b= 2 * sliderWidth\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.loop) {\n  width \x2b= \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * sliderWidth\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e初始化 dots 要在 BScroll 克隆插入两个轮播图之前\x3c\/p\x3e\n\x3cp\x3edots active状态 是通过判断 currentIndex 与 index 是否相等\x3c\/p\x3e\n\x3cp\x3ecurrentIndex 更新是通过获取 scroll 当前 page，BScroll 提供了 api 方便调用\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.currentPageIndex = this.scroll.getCurrentPage().pageX\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentPageIndex = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.getCurrentPage().pageX\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了保证改变窗口大小依然正常轮播，监听窗口 resize 事件，重新渲染轮播图\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22window.addEventListener(\x27resize\x27, () =\x3e {\n  if (!this.scroll || !this.scroll.enabled) return\n\n  clearTimeout(this.resizeTimer)\n  this.resizeTimer = setTimeout(() =\x3e {\n    if (this.scroll.isInTransition) {\n      this._onScrollEnd()\n    } else {\n      if (this.autoPlay) {\n        this._play()\n      }\n    }\n    this.refresh()\n  }, 60)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27resize\x27\x3c\/span\x3e, () =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll || !\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.enabled) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n\n  clearTimeout(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.resizeTimer)\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.resizeTimer = setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.isInTransition) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onScrollEnd()\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.autoPlay) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._play()\n      }\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.refresh()\n  }, \x3cspan class=\x22hljs-number\x22\x3e60\x3c\/span\x3e)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在切换 tab 相当于 切换了 keep-alive 的组件\x3cbr\x3e轮播会出问题，需要手动帮助执行，利用了 activated , deactivated 钩子函数\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22activated() {\n  this.scroll.enable()\n  let pageIndex = this.scroll.getCurrentPage().pageX\n  this.scroll.goToPage(pageIndex, 0, 0)\n  this.currentPageIndex = pageIndex\n  if (this.autoPlay) {\n    this._play()\n  }\n},\ndeactivated() {\n  this.scroll.disable()\n  clearTimeout(this.timer)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eactivated() {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.enable()\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e pageIndex = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.getCurrentPage().pageX\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.goToPage(pageIndex, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentPageIndex = pageIndex\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.autoPlay) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._play()\n  }\n},\ndeactivated() {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.disable()\n  clearTimeout(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.timer)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e实测\x3c\/strong\x3e，首次打开网页并不会执行 activated，只有在之后切换 tab ，切回来才会执行\x3c\/p\x3e\n\x3cp\x3e在组件销毁之前  beforeDestroy 销毁定时器是好习惯，keep-alive 因为是将组件缓存了，所以不会触发\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22beforeDestroy() {\n  this.scroll.disable()\n  clearTimeout(this.timer)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3ebeforeDestroy() {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.disable()\n  clearTimeout(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.timer)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader20\x22\x3e后端接口代理\x3c\/h2\x3e\n\x3cp\x3e简单设置一下 Referer, Host，让别人直接通过浏览器抓到你的接口\x3cbr\x3e但是这种方式防不了后端代理的方式\x3c\/p\x3e\n\x3cp\x3e前端 XHR 会有跨域限制，后端发送 http 请求则没有限制，因此可以伪造请求\x3c\/p\x3e\n\x3cp\x3eaxios 可以在浏览器端发送 \x3ccode\x3eXMLHttpRequest\x3c\/code\x3e 请求，在服务器端发送 \x3ccode\x3ehttp\x3c\/code\x3e 请求\x3c\/p\x3e\n\x3cp\x3e（在项目编写阶段，可以将后端代理请求写在 webpack 的 dev 文件的 before 函数内）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22before(app) {\n  app.get(\x27\/api\/getDiscList\x27, function (req, res) {\n    const url = \x27https:\/\/c.y.qq.com\/splcloud\/fcgi-bin\/fcg_get_diss_by_tag.fcg\x27\n    axios.get(url, {\n      headers: {\n        referer: \x27https:\/\/c.y.qq.com\/\x27,\n        host: \x27c.y.qq.com\x27\n      },\n      params: req.query\n    }).then((response) =\x3e {\n      res.json(response.data) \/\/ axios 返回的数据在 response.data，要把数据透传到我们自定义的接口里面 res.json(response.data)\n    }).catch((e) =\x3e {\n      console.log(e)\n    })\n  });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3ebefore(app) {\n  app.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/api\/getDiscList\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ereq, res\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e url = \x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/c.y.qq.com\/splcloud\/fcgi-bin\/fcg_get_diss_by_tag.fcg\x27\x3c\/span\x3e\n    axios.get(url, {\n      \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3ereferer\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/c.y.qq.com\/\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27c.y.qq.com\x27\x3c\/span\x3e\n      },\n      \x3cspan class=\x22hljs-attr\x22\x3eparams\x3c\/span\x3e: req.query\n    }).then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      res.json(response.data) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ axios 返回的数据在 response.data，要把数据透传到我们自定义的接口里面 res.json(response.data)\x3c\/span\x3e\n    }).catch(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e)\n    })\n  });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e定义一个路由，get 到一个 \x3ccode\x3e\/api\/getDiscList\x3c\/code\x3e 接口，通过 axios 伪造 headers，发送给QQ音乐服务器一个 http 请求，还有 param 参数。\x3cbr\x3e得到服务端正确的响应，通过 \x3ccode\x3eres.json(response.data)\x3c\/code\x3e 返回到浏览器端\x3c\/p\x3e\n\x3cblockquote\x3e另外 因为是 http 请求数据，是ajax，所以 format 参数要将原本接口的 jsonp 改为 json\x3c\/blockquote\x3e\n\x3cp\x3e大公司怎么防止被恶意代理呢？当你的访问量大的时候，出口ip会被查到获取封禁，还有一种就是参数验签，也就是请求人家的数据必须带一个签名参数，然后这个签名参数是很难拿到的这个正确的签名，从而达到保护数据的目的\x3c\/p\x3e\n\x3cp\x3e当然，获取的数据并不能直接拿来用，需要做进一步的规格化，达到我们使用的要求，所以在这方面单独封装了一个 class 来处理这方面的数据，具体请看src\/common\/js\/song.js\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader21\x22\x3eflex 布局，热门歌单推荐\x3c\/h2\x3e\n\x3cp\x3e左侧 icon 固定大小，\x3ccode\x3eflex: 0 0 60px\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3eflex 属性是 \x3ccode\x3eflex-grow\x3c\/code\x3e , \x3ccode\x3eflex-shrink\x3c\/code\x3e 和 \x3ccode\x3eflex-basis\x3c\/code\x3e 的简写，默认值为 0 1 auto。后两个属性可选。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3ccode\x3eflex-grow\x3c\/code\x3e 属性定义项目的放大比例，默认为 0，即如果存在剩余空间，也不放大。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eflex-shrink\x3c\/code\x3e 属性定义了项目的缩小比例，默认为 1，即如果空间不足，该项目将缩小。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eflex-basis\x3c\/code\x3e 属性定义了在分配多余空间之前，项目占据的主轴空间（main size）。浏览器根据这个属性，计算主轴是否有多余空间。它的默认值为auto，即项目的本来大小。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e右侧 text 区块 自适应占据剩下的空间，并且内部也采用 flex，使用 \x3ccode\x3eflex-direction: column; justify-content: center;\x3c\/code\x3e 来达到纵向居中排列\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader22\x22\x3erecommend 页面 利用 BScroll 滚动\x3c\/h2\x3e\n\x3cp\x3eScroll 初始化但却没有滚动，是因为初始化时机不对，必须保证数据到来，DOM 成功渲染之后 再去进行初始化\x3cbr\x3e可以使用父组件 给 Scrol组件传 \x3ccode\x3e:data\x3c\/code\x3e 数据，Scroll 组件自己 \x3ccode\x3ewatch\x3c\/code\x3e 这个 data，有变化就立刻 refesh 滚动\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e新版本 BScroll 已经自己实现检测 DOM 变化，自动刷新，大部分场景下无需传 data 了\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e所以也就 无需监听 img 的 onload 事件 然后执行 滚动刷新 了\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cimg @load=\x26quot;loadImage\x26quot; class=\x26quot;needsclick\x26quot; :src=\x26quot;item.picUrl\x26quot;\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x26lt;img @load=\x3cspan class=\x22hljs-string\x22\x3e\x22loadImage\x22\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22needsclick\x22\x3c\/span\x3e :src=\x3cspan class=\x22hljs-string\x22\x3e\x22item.picUrl\x22\x3c\/span\x3e\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22loadImage() {\n  if (!this.checkloaded) {\n    this.checkloaded = true\n    this.$refs.scroll.refresh()\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eloadImage() {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.checkloaded) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.checkloaded = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.scroll.refresh()\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader23\x22\x3e歌手页面 数据重构\x3c\/h2\x3e\n\x3cp\x3e歌手页面的结构是 \x3ccode\x3e热门、 A-Z\x3c\/code\x3e 的顺序排列，但抓取的接口数据只是 100条常见的歌手，并且是乱序的，但我们可以利用接口的 Findex 进行数据的重构\x3c\/p\x3e\n\x3cp\x3e首先可以定义一个 map 结构\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let map = {\n  hot: {\n    title: HOT_NAME,\n    item: []\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e map = {\n  \x3cspan class=\x22hljs-attr\x22\x3ehot\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: HOT_NAME,\n    \x3cspan class=\x22hljs-attr\x22\x3eitem\x3c\/span\x3e: []\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接着遍历得到的数据，将前10条添加到热门 hot 里\x3cbr\x3e然后查看每条的 Findex ，如果 map[Findex] 没有，创建 map[Findex] push 进新条目，如果 map[Findex] 有，则向其 push 进新条目\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22list.forEach((item, index) =\x3e {\n  if (index \x3c HOT_SINGER_LEN) {\n    map.hot.item.push(new SingerFormat({\n      id: item.Fsinger_mid,\n      name: item.Fsinger_name,\n    }))\n  }\n  const key = item.Findex\n  if (!map[key]) {\n    map[key] = {\n      title: key,\n      items: []\n    }\n  }\n  map[key].items.push(new SingerFormat({\n    id: item.Fsinger_mid,\n    name: item.Fsinger_name\n  }))\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3elist.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem, index\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (index \x26lt; HOT_SINGER_LEN) {\n    map.hot.item.push(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e SingerFormat({\n      \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: item.Fsinger_mid,\n      \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: item.Fsinger_name,\n    }))\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e key = item.Findex\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!map[key]) {\n    map[key] = {\n      \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: key,\n      \x3cspan class=\x22hljs-attr\x22\x3eitems\x3c\/span\x3e: []\n    }\n  }\n  map[key].items.push(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e SingerFormat({\n    \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: item.Fsinger_mid,\n    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: item.Fsinger_name\n  }))\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样就得到了一个 符合我们基本预期的 map 结构，但是因为 map 是一个对象，数据是乱序的，Chrome 控制台在展示的时候会对 key 做排序，但实际上我们代码并没有做。\x3c\/p\x3e\n\x3cp\x3e所以还要将其进行排序，这里会用到 数组的 sort 方法，所以我们要先把 map对象 转为 数组\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let hot = []\nlet ret = []\nlet un = []\nfor (let key in map) {\n  let val = map[key]\n  if (val.title.match(\/[a-zA-z]\/)) {\n    ret.push(val)\n  } else if (val.title === HOT_NAME) {\n    hot.push(val)\n  } else {\n    un.push(val)\n  }\n}\nret.sort((a, b) =\x3e {\n  return a.title.charCodeAt(0) - b.title.charCodeAt(0)\n})\nreturn hot.concat(ret, un)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e hot = []\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ret = []\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e un = []\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e map) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e val = map[key]\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (val.title.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/[a-zA-z]\/\x3c\/span\x3e)) {\n    ret.push(val)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (val.title === HOT_NAME) {\n    hot.push(val)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    un.push(val)\n  }\n}\nret.sort(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ea, b\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e a.title.charCodeAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) - b.title.charCodeAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n})\n\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e hot.concat(ret, un)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e根据 title 字母的 Unicode 编码大小排序的（比如：\x27A\x27.charCodeAt(0)=65；\x27B\x27.charCodeAt(0)=66）然后就a,b,c,d...的顺序了\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader24\x22\x3e歌手页面\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader25\x22\x3eshortcut 定位\x3c\/h3\x3e\n\x3cp\x3e因为 shortcut 整体的高度是不确定的，所以采用的是 \x3ccode\x3etop:50%\x3c\/code\x3e 之后，\x3ccode\x3etransform: translateY(-50%);\x3c\/code\x3e 这样就能动态的根据内容高度而垂直居中\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader26\x22\x3e歌手页面 区块与锚点 的联动\x3c\/h3\x3e\n\x3ch3 id=\x22articleHeader27\x22\x3e点击或滑动 shortcut 不同的锚点 ，自动滚动至相应的标题列表\x3c\/h3\x3e\n\x3cp\x3e利用了 BScroll 的 api ，scrollToElement\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3escrollToElement 可以滚动至相应的 index 值的区块\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e第一次点击触碰 shortcut ，获取点击具体锚点的 index 值，记录触碰位置的 index ，利用 scrollToElement ，滚动至相应 index 的区块\x3cbr\x3e而之后，滑动锚点实现滚动是利用 touchmove 事件，将两次触碰的的位置计算值变成 delta 差值：变成改变后的锚点区块 index 值，再将首次触碰的 index 值 \x2b 改变的 delta 值，再利用 scrollToElement ，滚动至相应的区块\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22onShortcutTouchStart(e) {\n  let anchorIndex = getData(e.target, \x27index\x27)  \/\/ 获取 点击具体锚点的 index 值\n  let firstTouch = e.touches[0]   \/\/ 第一次触碰的位置\n  this.touch.y1 = firstTouch.pageY  \/\/ 保存 第一次触碰的位置的Y值\n  this.touch.anchorIndex = anchorIndex  \/\/ 保存 第一次触碰时的锚点 index 值\n  this._scrollTo(anchorIndex)\n},\nonShortcutTouchMove(e) {\n  let firstTouch = e.touches[0]\n  this.touch.y2 = firstTouch.pageY\n  let delta = (this.touch.y2 - this.touch.y1) \/ ANCHOR_HEIGHT | 0 \/\/ 两次触碰 Y 轴的偏移锚点值\n  let anchorIndex = \x2bthis.touch.anchorIndex \x2b delta  \/\/ 获取 偏移了多少 index 值  ，因为 anchorIndex 是字符串，所以要转成数字再相加\n  this._scrollTo(anchorIndex)\n},\n_scrollTo(index) {\n  this.$refs.listview.scrollToElement(this.$refs.listGroup[index], 200)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eonShortcutTouchStart(e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e anchorIndex = getData(e.target, \x3cspan class=\x22hljs-string\x22\x3e\x27index\x27\x3c\/span\x3e)  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取 点击具体锚点的 index 值\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e firstTouch = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 第一次触碰的位置\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.y1 = firstTouch.pageY  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存 第一次触碰的位置的Y值\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.anchorIndex = anchorIndex  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存 第一次触碰时的锚点 index 值\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._scrollTo(anchorIndex)\n},\nonShortcutTouchMove(e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e firstTouch = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.y2 = firstTouch.pageY\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e delta = (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.y2 - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.y1) \/ ANCHOR_HEIGHT | \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 两次触碰 Y 轴的偏移锚点值\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e anchorIndex = \x2b\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.anchorIndex \x2b delta  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取 偏移了多少 index 值  ，因为 anchorIndex 是字符串，所以要转成数字再相加\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._scrollTo(anchorIndex)\n},\n_scrollTo(index) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.listview.scrollToElement(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.listGroup[index], \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cScroll class=\x26quot;listview\x26quot; ref=\x26quot;listview\x26quot;\x3e\n    \x3c!--歌手列表--\x3e\n    \x3cul\x3e\n      \x3cli v-for=\x26quot;group in data\x26quot; class=\x26quot;list-group\x26quot; ref=\x26quot;listGroup\x26quot;\x3e\n        \x3ch2 class=\x26quot;list-group-title\x26quot;\x3e\x22{{\x22group.title\x22}}\x22\x3c\/h2\x3e\n        \x3c!--首字母条目--\x3e\n        \x3cul\x3e\n          \x3cli v-for=\x26quot;item in group.items\x26quot; class=\x26quot;list-group-item\x26quot;\x3e\n            \x3cimg :src=\x26quot;item.avatar\x26quot; class=\x26quot;avatar\x26quot;\x3e\n            \x3cspan class=\x26quot;name\x26quot;\x3e\x22{{\x22item.name\x22}}\x22\x3c\/span\x3e\n          \x3c\/li\x3e\n        \x3c\/ul\x3e\n      \x3c\/li\x3e\n    \x3c\/ul\x3e\n    \x3cdiv class=\x26quot;list-shortcut\x26quot; @touchstart=\x26quot;onShortcutTouchStart\x26quot; @touchmove.stop.prevent=\x26quot;onShortcutTouchMove\x26quot;\x3e\n      \x3cul\x3e\n        \x3cli v-for=\x26quot;(item, index) in shortcutlist\x26quot; :data-index=\x26quot;index\x26quot; class=\x26quot;item\x26quot;\x3e\n          \x22{{\x22item\x22}}\x22\n        \x3c\/li\x3e\n      \x3c\/ul\x3e\n    \x3c\/div\x3e\n\x3c\/Scroll\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eScroll\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22listview\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22listview\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!--歌手列表--\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-for\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22group in data\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22list-group\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22listGroup\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eh2\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22list-group-title\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x22{{\x22group.title\x22}}\x22\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eh2\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!--首字母条目--\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-for\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22item in group.items\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22list-group-item\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e:src\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22item.avatar\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22avatar\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x22{{\x22item.name\x22}}\x22\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22list-shortcut\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3etouchstart\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onShortcutTouchStart\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3etouchmove.stop.prevent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onShortcutTouchMove\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-for\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22(item, index) in shortcutlist\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e:data-index\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22index\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22item\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x22{{\x22item\x22}}\x22\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eScroll\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader28\x22\x3e滑动主列表，侧边 shortcut 自动高亮不同锚点\x3c\/h3\x3e\n\x3col\x3e\x3cli\x3e首先 BScroll 组件 监听滚动事件，并派发事件以供父组件监听，将 pos 值传出去\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (this.listenScroll) {\n  let self = this\n  this.scroll.on(\x27scroll\x27, (pos) =\x3e { \/\/ 实时监测滚动事件，派发事件：Y轴距离\n    self.$emit(\x27scroll\x27, pos)\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listenScroll) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.on(\x3cspan class=\x22hljs-string\x22\x3e\x27scroll\x27\x3c\/span\x3e, (pos) =\x26gt; { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实时监测滚动事件，派发事件：Y轴距离\x3c\/span\x3e\n    self.$emit(\x3cspan class=\x22hljs-string\x22\x3e\x27scroll\x27\x3c\/span\x3e, pos)\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\x3cli\x3e父组件监听到滚动派发的事件\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 @scroll=\x26quot;scroll\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e @scroll=\x3cspan class=\x22hljs-string\x22\x3e\x22scroll\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e将 pos.y 存在 this.scrollY\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22scroll(pos) {\n  this.scrollY = pos.y    \/\/ 实时获取 BScroll 滚动的 Y轴距离\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3escroll(pos) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scrollY = pos.y    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实时获取 BScroll 滚动的 Y轴距离\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\x3cli\x3e再用 watch 检测数据的变化，一旦变化，重新计算每个区块的高度列表。再判断当前滚动的 Y轴值 是否落在相应的 group 高度区间，然后更新 currentIndex ，使 shortcut 的锚点高亮\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22watch: {\n  data() {\n    \/\/ 延时，确保DOM渲染之后执行，通常是nextTick，这里用setTimeout是为了兼容更低\n    setTimeout(() =\x3e {\n      this._calculateHeight()\n    }, 20)\n  },\n  \n  \/\/ 这里的 scrollY 是当前组件上的，和 BScroll 的并不是一个\n  scrollY(newY) {\n  const listHeight = this.listHeight\n  \/\/ 1. 当滚动至顶部以上\n  if (newY \x3e 0) {\n    this.currentIndex = 0\n    return\n  }\n  \/\/ 2. 当在中间部分滚动，length之所以 -1 是因为 当初高度列表定义必须多一个\n  for (let i = 0; i \x3c listHeight.length - 1; i\x2b\x2b) {\n    let height1 = listHeight[i]\n    let height2 = listHeight[i \x2b 1]\n    if (-newY \x3e= height1 \x26amp;\x26amp; -newY \x3c height2) {\n      this.currentIndex = i\n      this.diff = height2 \x2b newY  \/\/ height 上限 - newY 的值\n      return\n    }\n  }\n  \/\/ 3. 当滚动至底部，且 newY 大于最后一个元素的上限\n  this.currentIndex = listHeight.length - 2\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3ewatch: {\n  data() {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 延时，确保DOM渲染之后执行，通常是nextTick，这里用setTimeout是为了兼容更低\x3c\/span\x3e\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._calculateHeight()\n    }, \x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e)\n  },\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里的 scrollY 是当前组件上的，和 BScroll 的并不是一个\x3c\/span\x3e\n  scrollY(newY) {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e listHeight = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listHeight\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1. 当滚动至顶部以上\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (newY \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentIndex = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 2. 当在中间部分滚动，length之所以 -1 是因为 当初高度列表定义必须多一个\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; listHeight.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e height1 = listHeight[i]\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e height2 = listHeight[i \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (-newY \x26gt;= height1 \x26amp;\x26amp; -newY \x26lt; height2) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentIndex = i\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.diff = height2 \x2b newY  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ height 上限 - newY 的值\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n    }\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 3. 当滚动至底部，且 newY 大于最后一个元素的上限\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentIndex = listHeight.length - \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e每个区块的高度列表是 通过 \x3ccode\x3e_calculateHeight\x3c\/code\x3e 函数实现的\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22_calculateHeight() {\n  this.listHeight = []\n  const list = this.$refs.listGroup\n  let height = 0\n  this.listHeight.push(height)\n  for (let i = 0; i \x3c list.length; i\x2b\x2b) {\n    let item = list[i]\n    height \x2b= item.clientHeight\n    this.listHeight.push(height)\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e_calculateHeight() {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listHeight = []\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e list = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.listGroup\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e height = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listHeight.push(height)\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; list.length; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e item = list[i]\n    height \x2b= item.clientHeight\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listHeight.push(height)\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\x3cli\x3e最后只要在 li 上绑定class就可以实现不同位置的锚点高亮了\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22:class=\x26quot;{\x27current\x27: currentIndex === index}\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e:\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22{\x27current\x27: currentIndex === index}\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e这里的 Vue 用法提示\x3c\/strong\x3e：\x3cbr\x3e\x3ccode\x3ewatch\x3c\/code\x3e 的 \x3ccode\x3escrollY(newY){}\x3c\/code\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e当我们在 Vue 里修改了在 data 里定义的变量，就会出发这个变量的 setter，经过一系列的处理，会触发 watch 的回调函数，也就是 scrollY(newY) {} 这里的函数会执行，同时，newY 就是我们修改后的值。\x3c\/li\x3e\n\x3cli\x3escrollY 是定义在 data 里的，列表滚动的时候，scroll 事件的回调函数里有修改 this.scrollY，所以能 watch 到它的变化。\x3c\/li\x3e\n\x3cli\x3ewatch 的回调函数的第一个参数表示变化的新值\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader29\x22\x3e滚动固定标题 效果实现\x3c\/h3\x3e\n\x3cp\x3e在中间部分滚动时，会不断设置 diff 值，每个区块的高度上限（也就是底部）减去 Y轴偏移的值\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 this.diff = height2 \x2b newY  \/\/ 就是 height 上限 - newY 的值\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.diff = height2 \x2b newY  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 就是 height 上限 - newY 的值\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ewatch 检测 diff 变化，判断如果 diff\x26gt;0 且 小于 title 块的高度，设为差值，否则为0\x3cbr\x3e再将 fixed 的 title 块 translate 偏移\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22diff(newVal) {\n  let fixedTop = (newVal \x3e 0 \x26amp;\x26amp; newVal \x3c TITLE_HEIGHT) ? newVal - TITLE_HEIGHT : 0\n  if (this.fixedTop === fixedTop) return   \/\/ 判断如果两个title区块没有碰到，是不会触发 DOM 操作的\n  this.fixedTop = fixedTop\n  this.$refs.fixed.style.transform = `translate3d(0,${fixedTop}px,0)`\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3ediff(newVal) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e fixedTop = (newVal \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x26amp;\x26amp; newVal \x26lt; TITLE_HEIGHT) ? newVal - TITLE_HEIGHT : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.fixedTop === fixedTop) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断如果两个title区块没有碰到，是不会触发 DOM 操作的\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.fixedTop = fixedTop\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.fixed.style.transform = \x3cspan class=\x22hljs-string\x22\x3e`translate3d(0,\x3cspan class=\x22hljs-subst\x22\x3e${fixedTop}\x3c\/span\x3epx,0)`\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader30\x22\x3e歌手详情页\x3c\/h2\x3e\n\x3cp\x3esinger page 页面 引入 singer-detail 二级路由\x3c\/p\x3e\n\x3cp\x3eindex.js 路由里配置\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  path: \x27\/singer\x27,\n  component: Singer,\n  children: [\n    {\n      path: \x27:id\x27, \/\/ 表示 id 为变量\n      component: SingerDetail\n    }\n  ]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/singer\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Singer,\n  \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: [\n    {\n      \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27:id\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 表示 id 为变量\x3c\/span\x3e\n      component: SingerDetail\n    }\n  ]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3esinger.vue 里设定跳转路由 \x3ccode\x3ethis.$router.push({})\x3c\/code\x3e\x3cbr\x3ehtml:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3crouter-view\x3e\x3c\/router-view\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3erouter-view\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3erouter-view\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ejs:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22selectSinger(singer){\n  this.$router.push({\n    path: `\/singer\/${singer.id}`\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eselectSinger(singer){\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$router.push({\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e`\/singer\/\x3cspan class=\x22hljs-subst\x22\x3e${singer.id}\x3c\/span\x3e`\x3c\/span\x3e\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader31\x22\x3eVuex\x3c\/h2\x3e\n\x3cp\x3eVuex 教程见：\x3ca href=\x22https:\/\/github.com\/nanyang24\/blog\/issues\/60\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVuex\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e通常的流程为：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e定义 state，考虑项目需要的原始数据（最好为底层数据）\x3c\/li\x3e\n\x3cli\x3egetters，就是对原始数据的一层映射，可以只为底层数据做一个访问代理，也可以根据底层数据映射为新的计算数据（相当于 vuex 的计算属性）\x3c\/li\x3e\n\x3cli\x3e修改数据：mutations，定义如何修改数据的逻辑（本质是函数）。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e在定义 mutations 之前 要先定义 mutation-types （通常为动词\x2b名词）\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eactions.js\x3c\/code\x3e 通常是两种操作\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e异步操作\x3c\/li\x3e\n\x3cli\x3e是对mutation的封装，比如一个动作需要触发多个mutation的时候，就可以把多个mutation封装到一个action中，达到调用一个action去修改多个mutation的目的。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader32\x22\x3e歌手页面，数据利用 vuex 传递\x3c\/h3\x3e\n\x3ch4\x3e1. 首先 listview.vue 检测点击事件，将具体点击的歌手派发出去，以供父组件 singer 监听\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22selectItem(item) {\n  this.$emit(\x27select\x27, item)\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eselectItem(item) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$emit(\x3cspan class=\x22hljs-string\x22\x3e\x27select\x27\x3c\/span\x3e, item)\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e2. 父组件监听事件执行 selectSinger(singer)\x3c\/h4\x3e\n\x3col\x3e\n\x3cli\x3e指向子路由，向地址栏加上 \x3ccode\x3esinger.id\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e向 mutation 提 \x3ccode\x3eSET_SINGER\x3c\/code\x3e 的 commit\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22selectSinger(singer) {\n  this.$router.push({\n    path: `\/singer\/${singer.id}`\n  })\n  this.setSinger(singer)\n},\n\n...mapMutations({ \/\/ 语法糖，\x27...\x27将多个对象注入当前对象\n  setSinger: \x27SET_SINGER\x27 \/\/ 将 this.setSinger() 映射为 this.$store.commit(\x27SET_SINGER\x27)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eselectSinger(singer) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$router.push({\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e`\/singer\/\x3cspan class=\x22hljs-subst\x22\x3e${singer.id}\x3c\/span\x3e`\x3c\/span\x3e\n  })\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setSinger(singer)\n},\n\n...mapMutations({ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 语法糖，\x27...\x27将多个对象注入当前对象\x3c\/span\x3e\n  setSinger: \x3cspan class=\x22hljs-string\x22\x3e\x27SET_SINGER\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将 this.setSinger() 映射为 this.$store.commit(\x27SET_SINGER\x27)\x3c\/span\x3e\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3emapMutations (语法糖) 映射 mutations ，\x3ccode\x3ethis.setSinger(singer)\x3c\/code\x3e 相当于执行 \x3ccode\x3ethis.$store.commit(\x27SET_SINGER\x27)\x3c\/code\x3e （singer 为 mutation 的第二个参数）\x3cbr\x3e而 mutations 内 \x3ccode\x3eSET_SINGER\x3c\/code\x3e 的逻辑为\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[types.SET_SINGER](state, singer) {\n  state.singer = singer\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e[types.SET_SINGER](state, singer) {\n  state.singer = singer\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e3. singer-detail 取 vuex 中存好的数据\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22computed: {\n  ...mapGetters([\n    \x27singer\x27\n  ])\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3ecomputed: {\n  ...mapGetters([\n    \x3cspan class=\x22hljs-string\x22\x3e\x27singer\x27\x3c\/span\x3e\n  ])\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3egetters 内 \x3ccode\x3esinger\x3c\/code\x3e 的逻辑为\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22singer = state =\x3e state.singer\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3esinger = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estate\x3c\/span\x3e =\x26gt;\x3c\/span\x3e state.singer\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader33\x22\x3emusiclist 与 songlist\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader34\x22\x3e滑动 songlist 与背景图的联动\x3c\/h3\x3e\n\x3cp\x3e主要是 监听滚动距离，根据不同的距离条件发生不同的效果\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22mounted() {\n  this.imageHeight = this.$refs.bgImage.clientHeight\n  this.$refs.list.$el.style.top = `${this.imageHeight}px` \/\/ 对于 Vue 组件，this.$refs.xxx 拿到的是 Vue 实例，所以需要再通过 $el 拿到真实的 dom\n  this.minTransalteY = -this.imageHeight \x2b RESERVED_HEIGHT\n},\n\nwatch: {\n  scrollY(newY) {\n    let translateY = Math.max(this.minTransalteY, newY)   \/\/ 最远滚动改变的距离就是 minTransalteY\n    let zIndex = 0\n    let scale = 1\n    const percent = Math.abs(newY \/ this.imageHeight)\n\n    this.$refs.layer.style.transform = `translate3d(0,${translateY}px,0)`\n    this.$refs.layer.style.webkitTransform = `translate3d(0,${translateY}px,0)`\n    if (newY \x3c this.minTransalteY) {\n      zIndex = 10\n      this.$refs.bgImage.style.paddingTop = 0\n      this.$refs.bgImage.style.height = `${RESERVED_HEIGHT}px`\n    } else {\n      this.$refs.bgImage.style.paddingTop = \x2770%\x27\n      this.$refs.bgImage.style.height = 0\n    }\n    if (newY \x3e 0) {\n      scale = 1 \x2b percent\n      zIndex = 10\n    }\n    this.$refs.bgImage.style.zIndex = zIndex\n    this.$refs.bgImage.style.transform = `scale(${scale})`\n    this.$refs.bgImage.style.webkitTransform = `scale(${scale})`\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3emounted() {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.imageHeight = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.bgImage.clientHeight\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.list.$el.style.top = \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.imageHeight}\x3c\/span\x3epx`\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对于 Vue 组件，this.$refs.xxx 拿到的是 Vue 实例，所以需要再通过 $el 拿到真实的 dom\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.minTransalteY = -\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.imageHeight \x2b RESERVED_HEIGHT\n},\n\n\x3cspan class=\x22hljs-attr\x22\x3ewatch\x3c\/span\x3e: {\n  scrollY(newY) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e translateY = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.max(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.minTransalteY, newY)   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 最远滚动改变的距离就是 minTransalteY\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e zIndex = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e scale = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e percent = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.abs(newY \/ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.imageHeight)\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.layer.style.transform = \x3cspan class=\x22hljs-string\x22\x3e`translate3d(0,\x3cspan class=\x22hljs-subst\x22\x3e${translateY}\x3c\/span\x3epx,0)`\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.layer.style.webkitTransform = \x3cspan class=\x22hljs-string\x22\x3e`translate3d(0,\x3cspan class=\x22hljs-subst\x22\x3e${translateY}\x3c\/span\x3epx,0)`\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (newY \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.minTransalteY) {\n      zIndex = \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.bgImage.style.paddingTop = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.bgImage.style.height = \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${RESERVED_HEIGHT}\x3c\/span\x3epx`\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.bgImage.style.paddingTop = \x3cspan class=\x22hljs-string\x22\x3e\x2770%\x27\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.bgImage.style.height = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (newY \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n      scale = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x2b percent\n      zIndex = \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.bgImage.style.zIndex = zIndex\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.bgImage.style.transform = \x3cspan class=\x22hljs-string\x22\x3e`scale(\x3cspan class=\x22hljs-subst\x22\x3e${scale}\x3c\/span\x3e)`\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.bgImage.style.webkitTransform = \x3cspan class=\x22hljs-string\x22\x3e`scale(\x3cspan class=\x22hljs-subst\x22\x3e${scale}\x3c\/span\x3e)`\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader35\x22\x3e自动判断浏览器加CSS兼容前缀 prefixStyle\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let elementStyle = document.createElement(\x27div\x27).style\n\nlet vendor = (() =\x3e {\n  let transformNames = {\n    webkit: \x27webkitTransform\x27,\n    Moz: \x27MozTransform\x27,\n    O: \x27OTransform\x27,\n    ms: \x27msTransform\x27,\n    standard: \x27transform\x27\n  }\n\n  for (let key in transformNames) {\n    if (elementStyle[transformNames[key]] !== undefined) return key\n  }\n  return false\n})()\n\nexport function prefixStyle(style) {\n  if (vendor === false) return false\n\n  if (vendor === \x27standard\x27) return style\n\n  return vendor \x2b style.charAt(0).toUpperCase() \x2b style.substr(1)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e elementStyle = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27div\x27\x3c\/span\x3e).style\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e vendor = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e(\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e transformNames = {\n    \x3cspan class=\x22hljs-attr\x22\x3ewebkit\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27webkitTransform\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eMoz\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27MozTransform\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eO\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27OTransform\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ems\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27msTransform\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3estandard\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27transform\x27\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e transformNames) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (elementStyle[transformNames[key]] !== \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e key\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n})()\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eprefixStyle\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estyle\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (vendor === \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (vendor === \x3cspan class=\x22hljs-string\x22\x3e\x27standard\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e style\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e vendor \x2b style.charAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e).toUpperCase() \x2b style.substr(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\n\x3cli\x3e首先生成基于用户浏览器的div样式\x3c\/li\x3e\n\x3cli\x3e根据 vendor 供应商定义的不同浏览器前缀，去测试用户浏览器。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e方法就是判断创建的 div 样式是否有相应的前缀样式，如果有，则返回前缀样式的key，也就是需要的 前缀\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e通过 prefixStyle 函数，参数为我们需要兼容的样式。如果需要加签注，返回的格式是 前缀 \x2b 首字母大写的样式（应为通常前缀样式为 \x3ccode\x3e-webkit-transform-origin\x3c\/code\x3e，JS操作时，不能写 \x3ccode\x3e-\x3c\/code\x3e，可以采用驼峰写法，也就是样式首字母大写）\x3c\/li\x3e\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader36\x22\x3e播放器 player\x3c\/h2\x3e\n\x3cp\x3e把播放器组件放在 App.vue 下，因为它是一个跟任何路由都不相关的东西。在任何路由下，它都可以去播放。切换路由并不会影响播放器的播放。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader37\x22\x3e播放器 vuex 设计\x3c\/h3\x3e\n\x3cp\x3e点击 歌手\/歌单 都会进入详情页，详情页 created() 会根据点击的歌手请求相应的数据，然后利用 _normalizeSongs 将数据整理，其中很重要的函数是 createSong ，生成自定义 song 类，方便以后读取\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader38\x22\x3e播放器 图片旋转\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3eanimation-play-state\x3c\/code\x3e \x3cbr\x3eanimation-play-state CSS 属性定义一个动画是否运行或者暂停。可以通过查询它来确定动画是否正在运行。另外，它的值可以被设置为暂停和恢复的动画的重放。\x3cbr\x3e恢复一个已暂停的动画，将从它开始暂停的时候，而不是从动画序列的起点开始在动画。\x3c\/p\x3e\n\x3cp\x3e修复BUG：ios下safari与chrome浏览器,animation-play-state样式失效 #60\x3cbr\x3e点击暂停播放的时候，歌曲的图片会继续转动，导致的原因是因为animation-play-state:paused这个样式失效了\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/ustbhuangyi\/vue-music\/commit\/9de934081be8353d872d23c4d72bfb77752ab5a1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e修复具体代码\x3c\/a\x3e\x3cbr\x3e核心代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 计算内层Image的transform，并同步到外层容器\n * @param wrapper\n * @param inner\n *\/\nsyncWrapperTransform(wrapper, inner) {\n  if (!this.$refs[wrapper]) return\n\n  let imageCdWrapper = this.$refs[wrapper]\n  let image = this.$refs[inner]\n  let wTransform = getComputedStyle(imageCdWrapper)[transform]\n  let iTransform = getComputedStyle(image)[transform]\n  imageCdWrapper.style[transform] = wTransform === \x27none\x27 ? iTransform : iTransform.concat(\x27 \x27, wTransform)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 计算内层Image的transform，并同步到外层容器\n * @param wrapper\n * @param inner\n *\/\x3c\/span\x3e\nsyncWrapperTransform(wrapper, inner) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[wrapper]) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e imageCdWrapper = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[wrapper]\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e image = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[inner]\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e wTransform = getComputedStyle(imageCdWrapper)[transform]\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e iTransform = getComputedStyle(image)[transform]\n  imageCdWrapper.style[transform] = wTransform === \x3cspan class=\x22hljs-string\x22\x3e\x27none\x27\x3c\/span\x3e ? iTransform : iTransform.concat(\x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e, wTransform)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader39\x22\x3e解决快速切换歌曲引发的错误\x3c\/h3\x3e\n\x3cp\x3e这个错误是由于切换的太快，歌曲并未获取到播放地址，而提前播放\x3c\/p\x3e\n\x3cp\x3e利用了H5新api： \x3ccode\x3ecanplay\x3c\/code\x3e\x3cbr\x3e当终端可以播放媒体文件时触发该canplay事件，估计加载足够的数据来播放媒体直到其结束，而不必停止以进一步缓冲内容。\x3cbr\x3e利用这个api，在audio上监听 canplay 派发的事件，做成标志位\x3c\/p\x3e\n\x3cblockquote\x3e后来 api 改至 \x3ccode\x3eplaying\x3c\/code\x3e\n\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader40\x22\x3e播放器 进度条 功能\x3c\/h3\x3e\n\x3ch4\x3enormal 的长形进度条\x3c\/h4\x3e\n\x3cp\x3e在 progress 上监听 \x3ccode\x3etouchstart\x3c\/code\x3e, \x3ccode\x3etouchmove\x3c\/code\x3e, \x3ccode\x3etouchend\x3c\/code\x3e 三个事件\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3etouchstart: 获取第一次点击的横坐标和已播放的进度条长度\x3c\/li\x3e\n\x3cli\x3etouchmove: 获取移动后的横坐标，并定义 delta 为 移动后坐标 - 第一次点击的横坐标\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e设置 偏移量 offsetWidth 为 已播放的进度条长度 \x2b delta\x3cbr\x3e在去设置 progress 和 progressBtn 的宽度和transform 量都为 offsetWidth\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3etouchend: 一些组件特有的逻辑，和进度条不太相关暂不赘述\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e而点击任意位置，移动进度按钮，则是通过为 progress 进度条添加点击事件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22progressClick(e) {\n  this._offset(e.offsetX - progressBtnWidth \/ 2)\n  this._triggerPercent()\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eprogressClick(e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._offset(e.offsetX - progressBtnWidth \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._triggerPercent()\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3emini 的圆形进度条\x3c\/h4\x3e\n\x3cp\x3e利用了 SVG 实现，其中有两个圆，一个是背景圆形，另一个为已播放的圆形进度\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv class=\x26quot;progress-circle\x26quot;\x3e\n  \x3csvg :width=\x26quot;radius\x26quot; :height=\x26quot;radius\x26quot; viewBox=\x26quot;0 0 100 100\x26quot; version=\x26quot;1.1\x26quot; xmlns=\x26quot;http:\/\/www.w3.org\/2000\/svg\x26quot;\x3e\n    \x3ccircle class=\x26quot;progress-background\x26quot; r=\x26quot;50\x26quot; cx=\x26quot;50\x26quot; cy=\x26quot;50\x26quot; fill=\x26quot;transparent\x26quot;\/\x3e\n    \x3ccircle class=\x26quot;progress-bar\x26quot; r=\x26quot;50\x26quot; cx=\x26quot;50\x26quot; cy=\x26quot;50\x26quot; fill=\x26quot;transparent\x26quot;    :stroke-dasharray=\x26quot;dashArray\x26quot;\n    :stroke-dashoffset=\x26quot;dashOffset\x26quot;\/\x3e\n  \x3c\/svg\x3e\n  \x3cslot\x3e\x3c\/slot\x3e\n\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x26lt;div \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22progress-circle\x22\x3c\/span\x3e\x26gt;\n  \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3esvg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e:width\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22radius\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e:height\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22radius\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eviewBox\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x220 0 100 100\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eversion\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x221.1\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3exmlns\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/www.w3.org\/2000\/svg\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ecircle\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22progress-background\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3er\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2250\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecx\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2250\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecy\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2250\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3efill\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22transparent\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ecircle\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22progress-bar\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3er\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2250\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecx\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2250\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecy\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2250\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3efill\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22transparent\x22\x3c\/span\x3e    \x3cspan class=\x22hljs-attr\x22\x3e:stroke-dasharray\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22dashArray\x22\x3c\/span\x3e\n    \x3cspan class=\x22hljs-attr\x22\x3e:stroke-dashoffset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22dashOffset\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3esvg\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eslot\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eslot\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e修复进度条的 BUG\x3c\/h4\x3e\n\x3cp\x3e迷你播放器暂停状态，进入全屏，按钮在进度条最左边\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e原因：当播放器最小化的时候，progress-bar 仍然在监听 percent 的变化，所以在不断计算进度条的位置，然而这个时候由于播放器隐藏，进度条的宽度 this.$refs.progressBar.clientWidth 计算为0，因此计算出来的 offset 也是不对的，导致再次最大化播放器的时候，由于播放器是暂停状态， percent 并不会变化，也不会重新计算这个 offset ，导致 Bug。\x3c\/li\x3e\n\x3cli\x3e解决方案：当播放器最大化的时候，手动去计算一次 offset，确保进度条的位置正确。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3eprogress-bar 组件要 watch 下 fullScreen，在进入全屏的时候调用一下 移动按钮函数\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader41\x22\x3e歌词 lyric\x3c\/h3\x3e\n\x3cp\x3e获取歌词，虽然我们约定返回数据是 json，但QQ音乐 返回的是依然是 jsonp，所以我们需要做一层数据的处理\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3econst reg = \/^\\w\x2b\\(({.\x2b})\\)$\/\x3c\/code\x3e\x3cbr\x3e就是将返回的jsonp格式摘取出我们需要的json字段\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eret = JSON.parse(matches[1])\x3c\/code\x3e\x3cbr\x3e将正则分组（就是正则括号内的内容）捕获的json字符串数据 转成 json 格式\x3c\/p\x3e\n\x3cp\x3e然后我们在 player 组件中监听 currentSong 的变化，获取 this.currentSong.getLyric()\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22axios.get(url, {\n  headers: {\n    referer: \x27https:\/\/c.y.qq.com\/\x27,\n    host: \x27c.y.qq.com\x27\n  },\n  params: req.query\n}).then((response) =\x3e {\n  let ret = response.data\n  if (typeof ret === \x27string\x27) {\n    const reg = \/^\\w\x2b\\(({.\x2b})\\)$\/\n    const matches = ret.match(reg)\n    if (matches) {\n      ret = JSON.parse(matches[1])\n    }\n  }\n  res.json(ret)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eaxios.get(url, {\n  \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3ereferer\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/c.y.qq.com\/\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27c.y.qq.com\x27\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eparams\x3c\/span\x3e: req.query\n}).then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ret = response.data\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e ret === \x3cspan class=\x22hljs-string\x22\x3e\x27string\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e reg = \x3cspan class=\x22hljs-regexp\x22\x3e\/^\\w\x2b\\(({.\x2b})\\)$\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e matches = ret.match(reg)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (matches) {\n      ret = \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.parse(matches[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e])\n    }\n  }\n  res.json(ret)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后我们得到的返回数据的是 base64 的字符串，需要解码，这里用到了第三方库: \x3ccode\x3ejs-base64\x3c\/code\x3e\x3cbr\x3e（我们这次用的是QQ音乐pc版的歌词，需要解码base64，而移动版的QQ音乐是不需要的）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.lyric = Base64.decode(res.lyric)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lyric = Base64.decode(res.lyric)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e之后利用第三方库: \x3ccode\x3ejs-lyric\x3c\/code\x3e ，解析我们的歌词，生成方便操作的对象\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22getLyric() {\n  this.currentSong.getLyric()\n    .then(lyric =\x3e {\n      this.currentLyric = new Lyric(lyric)\n    })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3egetLyric() {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentSong.getLyric()\n    .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3elyric\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentLyric = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Lyric(lyric)\n    })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e歌词滚动\x3c\/h4\x3e\n\x3cp\x3e当前歌曲的歌词高亮是利用 \x3ccode\x3ejs-lyric\x3c\/code\x3e 会派发的 handle 事件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 this.currentLyric = new Lyric(lyric, this.handleLyric)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentLyric = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Lyric(lyric, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleLyric)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ejs-lyric\x3c\/code\x3e 会在每次改变当前歌词时触发这个函数，函数的参数为 当前的 lineNum 和 txt\x3c\/p\x3e\n\x3ch4\x3e而 使当前高亮歌词保持最中间 是利用了 BScroll 滚动至高亮的歌词\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let middleLine = isIphoneX() ? 7 : 5  \/\/ 鉴于iphonex太长了，做个小优化\nif (lineNum \x3e middleLine) {\n  let lineEl = this.$refs.lyricLine[lineNum - middleLine]\n  this.$refs.lyricList.scrollToElement(lineEl, 1000)\n} else {\n  this.$refs.lyricList.scrollTo(0, 0, 1000)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e middleLine = isIphoneX() ? \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 鉴于iphonex太长了，做个小优化\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (lineNum \x26gt; middleLine) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e lineEl = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.lyricLine[lineNum - middleLine]\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.lyricList.scrollToElement(lineEl, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.lyricList.scrollTo(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader42\x22\x3ecd 与 歌词 之间滑动\x3c\/h3\x3e\n\x3cp\x3e通过监听 middle 的 三个 touch 事件\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eoffsetWidth\x3c\/code\x3e 是为了计算歌词列表的一个偏移量的，首先它的偏移量不能大于0，也不能小于 \x3ccode\x3e-window.innerWidth\x3c\/code\x3e。\x3cbr\x3eleft 是根据当前显示的是 cd 还是歌词列表初始化的位置，如果是 cd，那么 left 为 0 ，歌词是从右往左拖的，deltaX 是小于 0 的，所以最终它的偏移量就是 \x3ccode\x3e0\x2bdeltaX\x3c\/code\x3e；如果已经显示歌词了，那么 left 为 \x3ccode\x3e-window.innerWidth\x3c\/code\x3e，歌词是从左往右拖，deltaX 是大于 0 的，所以最终它的偏移量就是 \x3ccode\x3e-window.innerWidth \x2b deltaX\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22middleTouchStart(e) {\n  this.touch.initiated = true\n  this.touch.startX = e.touches[0].pageX\n  this.touch.startY = e.touches[0].pageY\n},\nmiddleTouchMove(e) {\n  if (!this.touch.initiated) return\n  const deltaX = e.touches[0].pageX - this.touch.startX\n  const deltaY = e.touches[0].pageY - this.touch.startY\n  if (Math.abs(deltaY) \x3e Math.abs(deltaX)) {\n    return\n  }\n  const left = this.currentShow === \x27cd\x27 ? 0 : -window.innerWidth\n  const offsetWidth = Math.min(0, Math.max(-window.innerWidth, left \x2b deltaX))\n  this.touch.percent = Math.abs(offsetWidth \/ window.innerWidth)\n  console.log(this.touch.percent)\n  this.$refs.lyricList.$el.style[transform] = `translate3d(${offsetWidth}px,0,0)`\n  this.$refs.lyricList.$el.style[transitionDuration] = 0\n  this.$refs.middleL.style.opacity = 1 - this.touch.percent\n  this.$refs.middleL.style[transitionDuration] = 0\n},\nmiddleTouchEnd() {\n  let offsetWidth, opacity\n  \/\/ 从右向左滑 的情况\n  if (this.currentShow === \x27cd\x27) {\n    if (this.touch.percent \x3e 0.1) {\n      offsetWidth = -window.innerWidth\n      opacity = 0\n      this.currentShow = \x27lyric\x27\n    } else {\n      offsetWidth = 0\n      opacity = 1\n    }\n  } else {\n    \/\/  从左向右滑 的情况\n    if (this.touch.percent \x3c 0.9) {\n      offsetWidth = 0\n      opacity = 1\n      this.currentShow = \x27cd\x27\n    } else {\n      offsetWidth = -window.innerWidth\n      opacity = 0\n    }\n  }\n  const durationTime = 300\n  this.$refs.lyricList.$el.style[transform] = `translate3d(${offsetWidth}px,0,0)`\n  this.$refs.lyricList.$el.style[transitionDuration] = `${durationTime}ms`\n  this.$refs.middleL.style.opacity = opacity\n  this.$refs.middleL.style[transitionDuration] = `${durationTime}ms`\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3emiddleTouchStart(e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.initiated = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.startX = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].pageX\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.startY = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].pageY\n},\nmiddleTouchMove(e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.initiated) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e deltaX = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].pageX - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.startX\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e deltaY = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].pageY - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.startY\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.abs(deltaY) \x26gt; \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.abs(deltaX)) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e left = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentShow === \x3cspan class=\x22hljs-string\x22\x3e\x27cd\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e : -\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.innerWidth\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e offsetWidth = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.min(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.max(-\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.innerWidth, left \x2b deltaX))\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.percent = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.abs(offsetWidth \/ \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.innerWidth)\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.percent)\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.lyricList.$el.style[transform] = \x3cspan class=\x22hljs-string\x22\x3e`translate3d(\x3cspan class=\x22hljs-subst\x22\x3e${offsetWidth}\x3c\/span\x3epx,0,0)`\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.lyricList.$el.style[transitionDuration] = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.middleL.style.opacity = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.percent\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.middleL.style[transitionDuration] = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n},\nmiddleTouchEnd() {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e offsetWidth, opacity\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 从右向左滑 的情况\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentShow === \x3cspan class=\x22hljs-string\x22\x3e\x27cd\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.percent \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0.1\x3c\/span\x3e) {\n      offsetWidth = -\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.innerWidth\n      opacity = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentShow = \x3cspan class=\x22hljs-string\x22\x3e\x27lyric\x27\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      offsetWidth = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n      opacity = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    }\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/  从左向右滑 的情况\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touch.percent \x26lt; \x3cspan class=\x22hljs-number\x22\x3e0.9\x3c\/span\x3e) {\n      offsetWidth = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n      opacity = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.currentShow = \x3cspan class=\x22hljs-string\x22\x3e\x27cd\x27\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      offsetWidth = -\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.innerWidth\n      opacity = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    }\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e durationTime = \x3cspan class=\x22hljs-number\x22\x3e300\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.lyricList.$el.style[transform] = \x3cspan class=\x22hljs-string\x22\x3e`translate3d(\x3cspan class=\x22hljs-subst\x22\x3e${offsetWidth}\x3c\/span\x3epx,0,0)`\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.lyricList.$el.style[transitionDuration] = \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${durationTime}\x3c\/span\x3ems`\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.middleL.style.opacity = opacity\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.middleL.style[transitionDuration] = \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${durationTime}\x3c\/span\x3ems`\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader43\x22\x3e优化\x3c\/h2\x3e\n\x3cp\x3eVue 按需加载路由：\x3c\/p\x3e\n\x3cp\x3e当打包构建应用时，Javascript 包会变得非常大，影响页面加载。如果我们能把不同路由对应的组件分割成不同的代码块，然后当路由被访问的时候才加载对应组件，这样就更加高效了。\x3c\/p\x3e\n\x3cp\x3e结合 \x3cstrong\x3eVue 的异步组件\x3c\/strong\x3e和 \x3cstrong\x3eWebpack 的代码分割功能\x3c\/strong\x3e，轻松实现路由组件的懒加载。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e首先，可以将异步组件定义为返回一个 Promise 的工厂函数 (该函数返回的 Promise 应该 resolve 组件本身)：\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3econst Foo = () =\x26gt; Promise.resolve({ \/* 组件定义对象 *\/ })\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e第二，在 Webpack 2 中，我们可以使用动态 import语法来定义代码分块点 (split point)：\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3eimport(\x27.\/Foo.vue\x27) \/\/ 返回 Promise\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e在我们的项目中的 router\/index.js 是这样定义的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ Vue 异步加载路由\n\/\/ 引入5个 一级路由组件\nconst Recommend = () =\x3e import(\x27components\/recommend\/recommend\x27)\nconst Singer = () =\x3e import(\x27components\/singer\/singer\x27)\nconst Rank = () =\x3e import(\x27components\/rank\/rank\x27)\nconst Search = () =\x3e import(\x27components\/search\/search\x27)\nconst UserCenter = () =\x3e import(\x27components\/user-center\/user-center\x27)\n\/\/ 二级路由组件\nconst SingerDetail = () =\x3e import(\x27components\/singer-detail\/singer-detail\x27)\nconst Disc = () =\x3e import(\x27components\/disc\/disc\x27)\nconst TopList = () =\x3e import(\x27components\/top-list\/top-list\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Vue 异步加载路由\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 引入5个 一级路由组件\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Recommend = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27components\/recommend\/recommend\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Singer = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27components\/singer\/singer\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Rank = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27components\/rank\/rank\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Search = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27components\/search\/search\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e UserCenter = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27components\/user-center\/user-center\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 二级路由组件\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e SingerDetail = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27components\/singer-detail\/singer-detail\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Disc = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27components\/disc\/disc\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e TopList = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27components\/top-list\/top-list\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e无需改动其他的代码\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader44\x22\x3e手机联调\x3c\/h2\x3e\n\x3cp\x3e电脑，手机 同一WIFI下\x3c\/p\x3e\n\x3cp\x3e配置 config 的 index.js 里的 host 为 \x270.0.0.0\x27，手机可以打开电脑的IP地址\x2b端口查看\x3c\/p\x3e\n\x3cp\x3emac下 ifconfig 查看ip\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader45\x22\x3e移动端调试工具\x3c\/h2\x3e\n\x3cp\x3e移动端console：vConsole\x3cbr\x3e移动端抓包工具：charles\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader46\x22\x3e结语\x3c\/h1\x3e\n\x3cp\x3e以上是在实现这个音乐 Vue 项目中遇到的难点以及一些使用技巧。在这里记录下来方便以后自己查阅，还能够给同样在前端这个小领域奋斗的大家提供一小些学习资料~\x3c\/p\x3e\n\x3cp\x3e我的 Github：\x3ca href=\x22https:\/\/github.com\/nanyang24\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/nanyang24\x3c\/a\x3e\x3cbr\x3e如果对你有帮助，欢迎 star 和 互粉 ~\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Vue 实现的音乐项目 music app 知识点总结分享</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013294187">https://segmentfault.com/a/1190000013294187</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/1jjailw41yxi/" target="_blank">https://alili.tech/archive/1jjailw41yxi/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>