<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="也来扯扯 Vue 单元测试"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>也来扯扯 Vue 单元测试 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/2r127ceofhl/",
				"appid": "1613049289050283", 
				"title": "也来扯扯 Vue 单元测试 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-07T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/qpgs5dzs7n/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/nr14p77zb/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f2r127ceofhl%2f&text=%e4%b9%9f%e6%9d%a5%e6%89%af%e6%89%af%20Vue%20%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f2r127ceofhl%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f2r127ceofhl%2f&text=%e4%b9%9f%e6%9d%a5%e6%89%af%e6%89%af%20Vue%20%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f2r127ceofhl%2f&title=%e4%b9%9f%e6%9d%a5%e6%89%af%e6%89%af%20Vue%20%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f2r127ceofhl%2f&is_video=false&description=%e4%b9%9f%e6%9d%a5%e6%89%af%e6%89%af%20Vue%20%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%b9%9f%e6%9d%a5%e6%89%af%e6%89%af%20Vue%20%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f2r127ceofhl%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f2r127ceofhl%2f&title=%e4%b9%9f%e6%9d%a5%e6%89%af%e6%89%af%20Vue%20%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2r127ceofhl%2f&title=%e4%b9%9f%e6%9d%a5%e6%89%af%e6%89%af%20Vue%20%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2r127ceofhl%2f&title=%e4%b9%9f%e6%9d%a5%e6%89%af%e6%89%af%20Vue%20%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2r127ceofhl%2f&title=%e4%b9%9f%e6%9d%a5%e6%89%af%e6%89%af%20Vue%20%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">也来扯扯 Vue 单元测试</h1><div class="meta"><div class="postdate"><time datetime="2018-12-07" itemprop="datePublished">2018-12-07</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014112450\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014112450\x22 alt=\x22file\x22 title=\x22file\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e从使用 Vue 写出第一个 \x3ccode\x3eHello world\x3c\/code\x3e 到现在已经有近两年时间了，期间利用业余时间折腾了一套组件 we-vue，起初是出于实践学到的新知识，更多的是玩的意思，不过后来维护的过程中渐渐积累了一些经验，并开始享受这种过程。\x3c\/p\x3e\n\x3cp\x3e在 we-vue 更新到 v2.0 的时候，开始全面地编写单元测试。起先使用 karma \x2b mocha \x2b chrome-headless 这种组合完成的行级覆盖率达到 96% 的测试。但最近，我又放弃了这种组合，转而使用 Jest。在这连番的折腾中，入过不少坑（当然，很多时候是自己挖坑自己跳），也解锁了不少新姿势。\x3c\/p\x3e\n\x3cp\x3e本文主要扯一扯自己在完成这些单元测试，以及迁移到 Jest 过程中的一些收获。文中并不会涉及非常具体的测试写法，因为这些教程官方文档已经做得很好了。希望文中的一些内容对于正准备做 Vue （其实也不仅限于 Vue） 单元测试的人能有所帮助。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e为什么要做单元测试\x3c\/h2\x3e\n\x3cp\x3e作为一个程序员，单元测试或许是一个绕不开的坎。我大致总结了一下当初决定做单元测试的原因：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e有单元测试的项目，显得更专业，更有 B 格。真的，认真回忆下，这确实是当初自己的首要动机，可能这算是动机不纯吧？ \x3cimg src=\x22https:\/\/static.alili.techundefined\x22 class=\x22emoji\x22 alt=\x22smile\x22 title=\x22smile\x22\x3e\n\x3c\/li\x3e\n\x3cli\x3e懒！受不了每次调整之后，得不断地检查代码，甚至查看页面源码是否符合预期。不断修改各种参数并刷新以测试不同情况下的结果。而这里面的一大部分工作其实可以让单元测试来完成。所以说，懒人让世界更美好！\x3c\/li\x3e\n\x3cli\x3e单元测试能避免出现一些代码运行结果与预期不符的错误，通常是一些比较低级但又难以发现的问题。\x3c\/li\x3e\n\x3cli\x3e单元测试能够避免在升级更新、修复 BUG 的时候引入一些意料之外的问题。\x3cstrong\x3e有时候自以为小修改小优化无大碍，其实不然！\x3c\/strong\x3e\n\x3c\/li\x3e\n\x3cli\x3e单元测试对提高代码质量很有帮助。因为，好的代码一般是便于测试的。如果在进行单元测试过程中发现自己的一些代码不方便进行测试，那么你可能需要重新审视这些代码，看是否有一些设计上不合理或者可以优化的地方。\x3cstrong\x3e当然，这也并不是说代码应该“迁就”于单元测试，如果这样就有点儿本末倒置了。\x3c\/strong\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e总之，单元测试能提高程序的可靠性，让开发者在发布时更有底气，让使用者更有安全感。虽然编写单元测试需要花费一些时间，但相比于它所带来的优势，这些时间和精力上的花费还是值得的。\x3c\/p\x3e\n\x3cp\x3e另外值得注意的是，单元测试并不能完全代替功能测试，因为程序本身设计的逻辑错误或者其它的一些环境因素所造成的影响，单元测试可能无能为力。所以，单元测试只是保证你想让程序模块输出一只猪，它不会整出一头驴来。至于进一步的功能测试或者说“肉测”，仍然是有必要的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e用到的一些工具（软件）\x3c\/h2\x3e\n\x3ch4\x3e趁手的家伙 -- WebStorm \/ Visual Studio Code\x3c\/h4\x3e\n\x3cp\x3e去打群架，得操个趁手的家伙，板砖极好，大木头棒子也不错。\x3c\/p\x3e\n\x3cp\x3e而写代码，一个好用的 IDE 或者编辑器，能让效率飞升。就我个人而言，做前端时大部分时间使用 WebStorm，其本身对 Vue.js 就有很好的支持（内置了相关的插件）同时也支持的各种测试框架，适当的配置之后，可以很方便的进行断点、查看规模之类的调试工作。\x3c\/p\x3e\n\x3cp\x3e此外，Visual Studio Code 也是个不错的选择，目前已不有少 Vue.js 开发和测试相关的插件了，只需要搜索加点击但可安装。\x3c\/p\x3e\n\x3cblockquote\x3e当然，这里我无意挑起各种 IDE 或者编辑器流派之争端，提到的两个只是自己个人喜好。大家可自行选择合适的，甚至只要自己喜欢且觉得方便，用记事本开干也没问题。\x3c\/blockquote\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014112451\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014112451\x22 alt=\x22file\x22 title=\x22file\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3e用成熟好用的测试工具库 -- vue-test-utils\x3c\/h4\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/vuejs\/vue-test-utils\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3evue-test-utils\x3c\/a\x3e 是 Vue 生态圈中的一个开源项目，其前身是 \x3ca href=\x22https:\/\/github.com\/eddyerburgh\/avoriaz\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eavoriaz\x3c\/a\x3e，avoriaz 也是一个不错的包，但其 README 中有说明，当 vue-test-utils 正式发布的时候， 它将会被废弃。\x3c\/p\x3e\n\x3cp\x3evue-test-utils 能极大地简化 Vue.js 单元测试。\x3c\/p\x3e\n\x3cp\x3e例如，网上一搜 Vue 单元测试，得到的例子一般是像下面这样的（包括 vue-cli 提供的模板里默认也是这样）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import Vue from \x27vue\x27\nimport HelloWorld from \x27@\/components\/HelloWorld\x27\n\ndescribe(\x27HelloWorld.vue\x27, () =\x3e {\n  it(\x27should render correct contents\x27, () =\x3e {\n    const Constructor = Vue.extend(HelloWorld)\n    const vm = new Constructor().$mount()\n    expect(vm.$el.querySelector(\x27.hello h1\x27).textContent)\n      .toEqual(\x27Welcome to Your Vue.js App\x27)\n  })\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Vue \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27vue\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e HelloWorld \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@\/components\/HelloWorld\x27\x3c\/span\x3e\n\ndescribe(\x3cspan class=\x22hljs-string\x22\x3e\x27HelloWorld.vue\x27\x3c\/span\x3e, () =\x26gt; {\n  it(\x3cspan class=\x22hljs-string\x22\x3e\x27should render correct contents\x27\x3c\/span\x3e, () =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Constructor = Vue.extend(HelloWorld)\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e vm = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Constructor().$mount()\n    expect(vm.$el.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.hello h1\x27\x3c\/span\x3e).textContent)\n      .toEqual(\x3cspan class=\x22hljs-string\x22\x3e\x27Welcome to Your Vue.js App\x27\x3c\/span\x3e)\n  })\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用 vue-test-utils 后，你可以像下面这样\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { shallow } from \x27@vue\/test-utils\x27\nimport HelloWorld from \x27@\/components\/HelloWorld\x27\n\ndescribe(\x27HelloWorld.vue\x27, () =\x3e {\n  it(\x27should render correct contents\x27, () =\x3e {\n    const wrapper = shallow(HelloWorld, {\n      attachToDocument: ture\n    })\n\n    expect(wrapper.find(\x27.hello h1\x27).text()).to.equal(\x27Welcome to Your Vue.js App\x27)\n  })\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { shallow } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@vue\/test-utils\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e HelloWorld \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@\/components\/HelloWorld\x27\x3c\/span\x3e\n\ndescribe(\x3cspan class=\x22hljs-string\x22\x3e\x27HelloWorld.vue\x27\x3c\/span\x3e, () =\x26gt; {\n  it(\x3cspan class=\x22hljs-string\x22\x3e\x27should render correct contents\x27\x3c\/span\x3e, () =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e wrapper = shallow(HelloWorld, {\n      \x3cspan class=\x22hljs-attr\x22\x3eattachToDocument\x3c\/span\x3e: ture\n    })\n\n    expect(wrapper.find(\x3cspan class=\x22hljs-string\x22\x3e\x27.hello h1\x27\x3c\/span\x3e).text()).to.equal(\x3cspan class=\x22hljs-string\x22\x3e\x27Welcome to Your Vue.js App\x27\x3c\/span\x3e)\n  })\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以看到代码更加简洁了。wrapper 内含许多有用的方法，上面的例子中所使用的 find() 其中最简单不过的一个。vue-test-utils 还有 createLocalVue() 等方法以及 stub 之类的功能，基本上可以完成绝大部分情况下的测试用例。\x3c\/p\x3e\n\x3cblockquote\x3e需要注意的是，截至日前（2018-03-21）仍然处于 Beta 阶段。在正式版发布之前可能会有大的更改，例如新增或废弃一些方法。同时也可能存在一些 BUG（自己就曾\x3ca href=\x22https:\/\/github.com\/vuejs\/vue-test-utils\/issues\/263\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e修复过一个\x3c\/a\x3e \x3cimg src=\x22https:\/\/static.alili.techundefined\x22 class=\x22emoji\x22 alt=\x22smile\x22 title=\x22smile\x22\x3e）。但目前总体来说已趋于稳定，推荐使用，需要留意其最新更改。\x3c\/blockquote\x3e\n\x3ch4\x3e选择一个好用的断言库\x3c\/h4\x3e\n\x3cp\x3e通常是 chai，有时候结合 sinon 一起使用。chai 是一个优秀的库，里面的方法十分完善。网上相关的教程更是不计其数，这也反映出它很受欢迎。\x3c\/p\x3e\n\x3cp\x3e不过个人并不太中意 chai 的语法，比如比较常用的 \x3ccode\x3eto.be.ok\x3c\/code\x3e,\x3ccode\x3eto.not.be.ok\x3c\/code\x3e,\x3ccode\x3eexpect({a: 1, b: 2}).to.be.an(\x27object\x27).that.has.all.keys(\x27a\x27, \x27b\x27)\x3c\/code\x3e，为啥要那么长？为啥要那么多句点？顺序忘了怎么弄？\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014112452\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014112452\x22 alt=\x22file\x22 title=\x22file\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e所以一开始我就选择了 expect.js (expect 是 Jest 的一部分，可以单独安装使用)，主要是它的语法更符合我的口味，这也为后期迁移到 Jest 省了不少事。\x3c\/p\x3e\n\x3ch4\x3e一个合适测试框架 -- Jest\x3c\/h4\x3e\n\x3cp\x3e这里只提到了 Jest，当然也是个人喜好而已，这也是自己最终决定的方案。当然此前使用的 karma \x2b mocha \x2b chai \x2b chrome... 那一套也有其适用场景和可取之处。后面将会提到 Jest 的一些优点和缺点。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e利用 CI 服务自动进行单元测试、构建以及发布\x3c\/h2\x3e\n\x3cp\x3e现在已经有不少平台提供 CI 服务，例如 TravisCI 和 CircleCI。对于开源的项目，能免费使用这些平台的服务持续集成一些日常构建、测试工作。\x3c\/p\x3e\n\x3cp\x3e自己目前使用 CircleCI，具体原因就不多说了，使用哪个取决于自身喜好和具体业务情况，甚至可以考虑自己搭建 CI 服务器。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e为自己的项目加入测试覆盖率徽标\x3c\/h2\x3e\n\x3cp\x3e在自己开源项目的 README 中加入一个显示单元测试覆盖率的徽标，会增进用户的第一印象。高覆盖率的徽标，会使项目显得更专业可靠，也能让用户进一步了解整个项目并最终选用。\x3c\/p\x3e\n\x3cp\x3eCodeCov 能提供这种服务，并可以结合前面提到的 CI 使用，通过 CI 在代码推送后自动执行单元测试，通过后将代码覆盖率相关数据发送给 CodeCov，这样，在 README 中加入的覆盖率徽标就能自动更新了。\x3c\/p\x3e\n\x3cp\x3e为此，你需要一个 codecov 账号（通常用 GitHub 账号登录即可）并安装 \x3ccode\x3ecodecov\x3c\/code\x3e 包\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ yarn add -D codecov\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dockerfile\x22\x3e\x3ccode class=\x22shell\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$ yarn \x3cspan class=\x22hljs-keyword\x22\x3eadd\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e -D codecov\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后在 CI 的任务配置里加入上传代码测试覆盖率数据的步骤，例如 CircleCI 配置如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22steps:\n    ## 前面部分任务省略\n\n    # run tests!\n    - run: yarn test\n\n    # update codecov stats\n    - run: .\/node_modules\/.bin\/codecov\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22yaml hljs\x22\x3e\x3ccode class=\x22yaml\x22\x3e\x3cspan class=\x22hljs-attr\x22\x3esteps:\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e## 前面部分任务省略\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e# run tests!\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    - run:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eyarn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3etest\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e# update codecov stats\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    - run:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e.\/node_modules\/.bin\/codecov\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后在 README 里加入微标图片就可以了,就像这样。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014112453\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014112453\x22 alt=\x22code cov\x22 title=\x22code cov\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3eJest 相对于 karma \x2b mocha \x2b Chrome 组合的优缺点\x3c\/h2\x3e\n\x3cp\x3e前面提到，我最终转向了使用 Jest，这并非一时脑热，而是经过多次权衡和尝试之后才作的决定。主要是由于 Jest 相对于之前的方案有着不少优势，一些特性让测试变得更轻松愉快，更有效率。\x3c\/p\x3e\n\x3cp\x3e我大致做了下对比，粗略总结如下：\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e优点\x3c\/h3\x3e\n\x3col\x3e\n\x3cli\x3e一站式的解决方案\x3cp\x3e在使用 Jest 之前，我需要一个测试框架（mocha），需要一个测试运行器（karma），需要一个断言库（chai），需要一个用来做 spies\/stubs\/mocks 的工具（sinon 以及 sinon-chai 插件），一个用于测试的浏览器环境（可以是 Chrome 浏览器，也可以用 PhantomJS）。\x3c\/p\x3e\n\x3cp\x3e而使用 Jest 后，只要安装它，全都搞定了。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e全面的官方文档，易于学习和使用\x3cp\x3eJest 的官方文档很完善，对着文档很快就能上手。而在之前，我需要学习好几个插件的用法，至少得知道 mocha 用处和原理吧 我得学会 karma 的配置和命令，chai 的各种断言方法……，经常得周旋于不同的文档站之间，其实是件很烦也很低效的事。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e配置简单方便\x3c\/li\x3e\n\x3cli\x3e更直观明确的测试信息提示\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e方便的命令行工具\x3c\/p\x3e\n\x3cp\x3e全局安装 Jest 后，可以在命令行执行单元测试，配合各种命令参数，可以方便地实现执行单个测试、监视文件变化并自动执行等功能。特别是对于监视文件变化并执行，它提供多种模式，可以只执行修改过的测试。记得初次读到这部分文档时，我不禁仰天长啸，竟然有这么骚气凌人的操作？\x3c\/p\x3e\n\x3cblockquote\x3eJest 甚至提供了 jest-codemods 这一工具，用来将使用其它包的测试迁移为使用 Jest\x3c\/blockquote\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e缺点\x3c\/h3\x3e\n\x3col\x3e\n\x3cli\x3ejsdom 的一些局限性\x3cp\x3e因为 Jest 是基于 jsdom 的，jsdom 毕竟不是真实的浏览器环境，它在测试过程中其实并不真正的“渲染”组件。这会导致一些问题，例如，如果组件代码中有一些根据实际渲染后的属性值进行计算（比如元素的 clientWidth）就可能出问题，因为 jsdom 中这些参数通常默认是 0.\x3c\/p\x3e\n\x3cp\x3e所以有些情况下，测试中可能要施以一些骚操作，比如自行 mock（实例上就是伪造，但合理地伪造）一些中间值，来满足测试用例。如果你的项目中这样的情况很多，还是建议使用 karma \x2b mocha \x2b chrome 这一组合。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e周边相关的包可能还不完善\x3cp\x3e例如 vue-jest，目前的版本并不能完全实现 vue-loader 的功能。比如，使用 sass，postcss 之类的功能，它会抛出警告信息。代码中直接 import 实际的 css 文件，则有可能报错，这时则需要使用 mock 来模拟 css 文件。这些问题，在使用 karma-mocha Chrome 的时候是没有的，因为测试运行于真实的浏览器环境中。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3eChromeHeadless vs. PhantomJS?\x3c\/h2\x3e\n\x3cp\x3e较新版本的 Chrome 支持以 headless 模式运行，这对于测试这种不需要显示界面的任务来说是很合适了（其实也可以使用常规模式，只不过执行测试的时候 Chrome 会弹出窗口）。\x3c\/p\x3e\n\x3cp\x3e而在 Chrome 推出 headless 模式功能之前。我们通常用 PhantomJS 的 headless WebKit 环境来进行测试，但它有着一些久未解决的问题，而且更新进度越来越慢。不欠前（2018-03-05），因为开发组内部意见不合，PhantomJS 项目已经封存了代码暂停开发了。\x3c\/p\x3e\n\x3cp\x3eChrome headless 对于 PhantomJS 来说算是一个致命的打击，特别是 \x3cbr\x3eChrome 官方推出的 puppeteer 在短时间内已经被广泛接受和使用。但其实 PhantomJS 还是有一些适用场景的，例如一些服务器并不支持 Chrome，这种情况下 PhantomJS 就有用武之地了。不过目前看来，对手的碾压以及自身维护团队的涣散，让我有理由放弃它了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e后记\x3c\/h2\x3e\n\x3cp\x3e实践总是最有效率的学习方式，不停地折腾才能不断的进步，特别是对于编程这事上，每天都有新的东西出现。\x3c\/p\x3e\n\x3cp\x3e编写单元测试可能比较枯燥，因为它并不像做新功能一样让人兴奋。但只要耐心调试，当全部测试用例都通过，当最后测试覆盖率慢慢提升时，那种成就感也不亚于开发出了新功能！\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e广告\x3c\/h2\x3e\n\x3cp\x3e最后，无耻地为自己的 we-vue 打个小广告 \x3cimg src=\x22https:\/\/static.alili.techundefined\x22 class=\x22emoji\x22 alt=\x22smile\x22 title=\x22smile\x22\x3e  ，虽然目前不成气候，也还有不少需要完善的地方。但自己会做下去，也希望能有更多的人支持和参与。里面可以看到一些觉的组件测试套路，目前组件部分的单元测试覆盖率已经超过 99%。\x3c\/p\x3e\n\x3cp\x3e项目地址: \x3ca href=\x22https:\/\/github.com\/tianyong90\/we-vue\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/tianyong90\/we-vue\x3c\/a\x3e  \x3cbr\x3e在线文档: \x3ca href=\x22https:\/\/wevue.org\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/wevue.org\x3c\/a\x3e  \x3cbr\x3e在线示例: \x3ca href=\x22https:\/\/demo.wevue.org\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/demo.wevue.org\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>也来扯扯 Vue 单元测试</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014112447">https://segmentfault.com/a/1190000014112447</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/2r127ceofhl/" target="_blank">https://alili.tech/archive/2r127ceofhl/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>