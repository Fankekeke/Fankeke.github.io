<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="读Zepto源码之Ajax模块"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>读Zepto源码之Ajax模块 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/2scu7p55bb9/",
				"appid": "1613049289050283", 
				"title": "读Zepto源码之Ajax模块 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-02T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/7v4r9y8iws6/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/vwmy6mmaw0k/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f2scu7p55bb9%2f&text=%e8%af%bbZepto%e6%ba%90%e7%a0%81%e4%b9%8bAjax%e6%a8%a1%e5%9d%97"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f2scu7p55bb9%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f2scu7p55bb9%2f&text=%e8%af%bbZepto%e6%ba%90%e7%a0%81%e4%b9%8bAjax%e6%a8%a1%e5%9d%97"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f2scu7p55bb9%2f&title=%e8%af%bbZepto%e6%ba%90%e7%a0%81%e4%b9%8bAjax%e6%a8%a1%e5%9d%97"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f2scu7p55bb9%2f&is_video=false&description=%e8%af%bbZepto%e6%ba%90%e7%a0%81%e4%b9%8bAjax%e6%a8%a1%e5%9d%97"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e8%af%bbZepto%e6%ba%90%e7%a0%81%e4%b9%8bAjax%e6%a8%a1%e5%9d%97&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f2scu7p55bb9%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f2scu7p55bb9%2f&title=%e8%af%bbZepto%e6%ba%90%e7%a0%81%e4%b9%8bAjax%e6%a8%a1%e5%9d%97"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2scu7p55bb9%2f&title=%e8%af%bbZepto%e6%ba%90%e7%a0%81%e4%b9%8bAjax%e6%a8%a1%e5%9d%97"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2scu7p55bb9%2f&title=%e8%af%bbZepto%e6%ba%90%e7%a0%81%e4%b9%8bAjax%e6%a8%a1%e5%9d%97"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2scu7p55bb9%2f&title=%e8%af%bbZepto%e6%ba%90%e7%a0%81%e4%b9%8bAjax%e6%a8%a1%e5%9d%97"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">读Zepto源码之Ajax模块</h1><div class="meta"><div class="postdate"><time datetime="2019-01-02" itemprop="datePublished">2019-01-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3ccode\x3eAjax\x3c\/code\x3e 模块也是经常会用到的模块，\x3ccode\x3eAjax\x3c\/code\x3e 模块中包含了 \x3ccode\x3ejsonp\x3c\/code\x3e 的现实，和 \x3ccode\x3eXMLHttpRequest\x3c\/code\x3e 的封装。 \x3c\/p\x3e\n\x3cp\x3e读 Zepto 源码系列文章已经放到了github上，欢迎star: \x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereading-zepto\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e源码版本\x3c\/h2\x3e\n\x3cp\x3e本文阅读的源码为 \x3ca href=\x22https:\/\/github.com\/madrobby\/zepto\/tree\/v1.2.0\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ezepto1.2.0\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eajax的事件触发顺序\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3ezepto\x3c\/code\x3e 针对 \x3ccode\x3eajax\x3c\/code\x3e 的发送过程，定义了以下几个事件，正常情况下的触发顺序如下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3ccode\x3eajaxstart\x3c\/code\x3e : \x3ccode\x3eXMLHttpRequest\x3c\/code\x3e 实例化前触发\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eajaxBeforeSend\x3c\/code\x3e： 发送 \x3ccode\x3eajax\x3c\/code\x3e 请求前触发\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eajaxSend\x3c\/code\x3e : 发送 \x3ccode\x3eajax\x3c\/code\x3e 请求时触发\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eajaxSuccess\x3c\/code\x3e \/ \x3ccode\x3eajaxError\x3c\/code\x3e : 请求成功\/失败时触发\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eajaxComplete\x3c\/code\x3e： 请求完成（无论成功还是失败）时触发\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eajaxStop\x3c\/code\x3e: 请求完成后触发，这个事件在 \x3ccode\x3eajaxComplete\x3c\/code\x3e 后触发。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3eajax 方法的参数解释\x3c\/h3\x3e\n\x3cp\x3e现在还没有讲到 \x3ccode\x3eajax\x3c\/code\x3e 方法，之所以要将参数提前，是因为后面的内容，不时会用到相关的参数，所以一开始先将参数解释清楚。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3etype\x3c\/code\x3e： \x3ccode\x3eHTTP\x3c\/code\x3e 请求的类型；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eurl\x3c\/code\x3e: 请求的路径；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3edata\x3c\/code\x3e： 请求参数；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eprocessData\x3c\/code\x3e: 是否需要将非 \x3ccode\x3eGET\x3c\/code\x3e 请求的参数转换成字符串，默认为 \x3ccode\x3etrue\x3c\/code\x3e ，即默认转换成字符串；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3econtentType\x3c\/code\x3e: 设置 \x3ccode\x3eContent-Type\x3c\/code\x3e 请求头；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3emineType\x3c\/code\x3e ： 覆盖响应的 \x3ccode\x3eMIME\x3c\/code\x3e 类型，可以是 \x3ccode\x3ejson\x3c\/code\x3e、 \x3ccode\x3ejsonp\x3c\/code\x3e、 \x3ccode\x3escript\x3c\/code\x3e、 \x3ccode\x3exml\x3c\/code\x3e、 \x3ccode\x3ehtml\x3c\/code\x3e、 或者 \x3ccode\x3etext\x3c\/code\x3e；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ejsonp\x3c\/code\x3e:  \x3ccode\x3ejsonp\x3c\/code\x3e 请求时，携带回调函数名的参数名，默认为 \x3ccode\x3ecallback\x3c\/code\x3e；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ejsonpCallback\x3c\/code\x3e： \x3ccode\x3ejsonp\x3c\/code\x3e 请求时，响应成功时，执行的回调函数名，默认由 \x3ccode\x3ezepto\x3c\/code\x3e 管理；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3etimeout\x3c\/code\x3e: 超时时间，默认为 \x3ccode\x3e0\x3c\/code\x3e；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eheaders\x3c\/code\x3e：设置 \x3ccode\x3eHTTP\x3c\/code\x3e 请求头；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3easync\x3c\/code\x3e： 是否为同步请求，默认为 \x3ccode\x3efalse\x3c\/code\x3e；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eglobal\x3c\/code\x3e： 是否触发全局 \x3ccode\x3eajax\x3c\/code\x3e 事件，默认为 \x3ccode\x3etrue\x3c\/code\x3e；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3econtext\x3c\/code\x3e： 执行回调时（如 \x3ccode\x3ejsonpCallbak\x3c\/code\x3e）时的上下文环境，默认为 \x3ccode\x3ewindow\x3c\/code\x3e。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3etraditional\x3c\/code\x3e: 是否使用传统的浅层序列化方式序列化 \x3ccode\x3edata\x3c\/code\x3e 参数，默认为 \x3ccode\x3efalse\x3c\/code\x3e，例如有 \x3ccode\x3edata\x3c\/code\x3e 为 \x3ccode\x3e{p1:\x27test1\x27, p2: {nested: \x27test2\x27}\x3c\/code\x3e ，在 \x3ccode\x3etraditional\x3c\/code\x3e 为 \x3ccode\x3efalse\x3c\/code\x3e 时，会序列化成 \x3ccode\x3ep1=test1\x26amp;p2[nested]=test2\x3c\/code\x3e， 在为 \x3ccode\x3etrue\x3c\/code\x3e 时，会序列化成 \x3ccode\x3ep1=test\x26amp;p2=[object\x2bobject]\x3c\/code\x3e；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3exhrFields\x3c\/code\x3e：\x3ccode\x3exhr\x3c\/code\x3e 的配置；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ecache\x3c\/code\x3e：是否允许浏览器缓存 \x3ccode\x3eGET\x3c\/code\x3e 请求，默认为 \x3ccode\x3efalse\x3c\/code\x3e；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eusername\x3c\/code\x3e：需要认证的 \x3ccode\x3eHTTP\x3c\/code\x3e 请求的用户名；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3epassword\x3c\/code\x3e： 需要认证的 \x3ccode\x3eHTTP\x3c\/code\x3e 请求的密码；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3edataFilter\x3c\/code\x3e： 对响应数据进行过滤；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3exhr\x3c\/code\x3e： \x3ccode\x3eXMLHttpRequest\x3c\/code\x3e 实例，默认用 \x3ccode\x3enew XMLHttpRequest()\x3c\/code\x3e 生成；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eaccepts\x3c\/code\x3e：从服务器请求的 \x3ccode\x3eMIME\x3c\/code\x3e 类型；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ebeforeSend\x3c\/code\x3e： 请求发出前调用的函数；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3esuccess\x3c\/code\x3e: 请求成功后调用的函数；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eerror\x3c\/code\x3e： 请求出错时调用的函数；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ecomplete\x3c\/code\x3e： 请求完成时调用的函数，无论请求是失败还是成功。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e内部方法\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3etriggerAndReturn\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function triggerAndReturn(context, eventName, data) {\n  var event = $.Event(eventName)\n  $(context).trigger(event, data)\n  return !event.isDefaultPrevented()\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etriggerAndReturn\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3econtext, eventName, data\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e event = $.Event(eventName)\n  $(context).trigger(event, data)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e !event.isDefaultPrevented()\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3etriggerAndReturn\x3c\/code\x3e 用来触发一个事件，并且如果该事件禁止浏览器默认事件时，返回 \x3ccode\x3efalse\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e参数 \x3ccode\x3econtext\x3c\/code\x3e 为上下文，\x3ccode\x3eeventName\x3c\/code\x3e 为事件名，\x3ccode\x3edata\x3c\/code\x3e 为数据。\x3c\/p\x3e\n\x3cp\x3e该方法内部调用了 \x3ccode\x3eEvent\x3c\/code\x3e 模块的 \x3ccode\x3etrigger\x3c\/code\x3e 方法，具体分析见《\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BEvent%E6%A8%A1%E5%9D%97.md#trigger\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之Event模块\x3c\/a\x3e》。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3etriggerGlobal\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function triggerGlobal(settings, context, eventName, data) {\n  if (settings.global) return triggerAndReturn(context || document, eventName, data)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etriggerGlobal\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esettings, context, eventName, data\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings.global) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e triggerAndReturn(context || \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e, eventName, data)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e触发全局事件\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3esettings\x3c\/code\x3e 为 \x3ccode\x3eajax\x3c\/code\x3e 配置，\x3ccode\x3econtext\x3c\/code\x3e 为指定的上下文对象，\x3ccode\x3eeventName\x3c\/code\x3e 为事件名，\x3ccode\x3edata\x3c\/code\x3e 为数据。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3etriggerGlobal\x3c\/code\x3e 内部调用的是 \x3ccode\x3etriggerAndReturn\x3c\/code\x3e 方法，如果有指定上下文对象，则在指定的上下文对象上触发，否则在 \x3ccode\x3edocument\x3c\/code\x3e 上触发。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eajaxStart\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function ajaxStart(settings) {\n  if (settings.global \x26amp;\x26amp; $.active\x2b\x2b === 0) triggerGlobal(settings, null, \x27ajaxStart\x27)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eajaxStart\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esettings\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings.global \x26amp;\x26amp; $.active\x2b\x2b === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) triggerGlobal(settings, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27ajaxStart\x27\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e触发全局的 \x3ccode\x3eajaxStart\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3eglobal\x3c\/code\x3e 设置为 \x3ccode\x3etrue\x3c\/code\x3e，则 \x3ccode\x3e$.active\x3c\/code\x3e 的值增加1。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3eglobal\x3c\/code\x3e 为 \x3ccode\x3etrue\x3c\/code\x3e ，并且 \x3ccode\x3e$.active\x3c\/code\x3e 在更新前的数量为 \x3ccode\x3e0\x3c\/code\x3e，则触发全局的 \x3ccode\x3eajaxStart\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eajaxStop\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function ajaxStop(settings) {\n  if (settings.global \x26amp;\x26amp; !(--$.active)) triggerGlobal(settings, null, \x27ajaxStop\x27)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eajaxStop\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esettings\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings.global \x26amp;\x26amp; !(--$.active)) triggerGlobal(settings, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27ajaxStop\x27\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e触发全局 \x3ccode\x3eajaxStop\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3eglobal\x3c\/code\x3e 为 \x3ccode\x3etrue\x3c\/code\x3e ，则将 \x3ccode\x3e$.active\x3c\/code\x3e 的数量减少 \x3ccode\x3e1\x3c\/code\x3e。如果 \x3ccode\x3e$.active\x3c\/code\x3e 的数量减少至 \x3ccode\x3e0\x3c\/code\x3e，即没有在执行中的 \x3ccode\x3eajax\x3c\/code\x3e 请求时，触发全局的 \x3ccode\x3eajaxStop\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3eajaxBeforeSend\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function ajaxBeforeSend(xhr, settings) {\n  var context = settings.context\n  if (settings.beforeSend.call(context, xhr, settings) === false ||\n      triggerGlobal(settings, context, \x27ajaxBeforeSend\x27, [xhr, settings]) === false)\n    return false\n\n  triggerGlobal(settings, context, \x27ajaxSend\x27, [xhr, settings])\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eajaxBeforeSend\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3exhr, settings\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e context = settings.context\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings.beforeSend.call(context, xhr, settings) === \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e ||\n      triggerGlobal(settings, context, \x3cspan class=\x22hljs-string\x22\x3e\x27ajaxBeforeSend\x27\x3c\/span\x3e, [xhr, settings]) === \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\n  triggerGlobal(settings, context, \x3cspan class=\x22hljs-string\x22\x3e\x27ajaxSend\x27\x3c\/span\x3e, [xhr, settings])\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eajaxBeforeSend\x3c\/code\x3e 方法，触发 \x3ccode\x3eajaxBeforeSend\x3c\/code\x3e 事件和 \x3ccode\x3eajaxSend\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3cp\x3e这两个事件很相似，只不过 \x3ccode\x3eajaxBeforedSend\x3c\/code\x3e 事件可以通过外界的配置来取消事件的触发。\x3c\/p\x3e\n\x3cp\x3e在触发 \x3ccode\x3eajaxBeforeSend\x3c\/code\x3e 事件之前，会调用配置中的 \x3ccode\x3ebeforeSend\x3c\/code\x3e 方法，如果 \x3ccode\x3ebefoeSend\x3c\/code\x3e 方法返回的为 \x3ccode\x3efalse\x3c\/code\x3e时，则取消触发 \x3ccode\x3eajaxBeforeSend\x3c\/code\x3e 事件，并且会取消后续 \x3ccode\x3eajax\x3c\/code\x3e 请求的发送，后面会讲到。\x3c\/p\x3e\n\x3cp\x3e否则触发 \x3ccode\x3eajaxBeforeSend\x3c\/code\x3e 事件，并且将 \x3ccode\x3exhr\x3c\/code\x3e 事件，和配置 \x3ccode\x3esettings\x3c\/code\x3e 作为事件携带的数据。\x3c\/p\x3e\n\x3cp\x3e注意这里很巧妙地使用了 \x3ccode\x3e||\x3c\/code\x3e 进行断路。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3ebeforeSend\x3c\/code\x3e 返回的为 \x3ccode\x3efalse\x3c\/code\x3e 或者触发\x3ccode\x3eajaxBeforeSend\x3c\/code\x3e 事件的方法 \x3ccode\x3etriggerGlobal\x3c\/code\x3e 返回的为 \x3ccode\x3efalse\x3c\/code\x3e，也即取消了浏览器的默认行为，则 \x3ccode\x3eajaxBeforeSend\x3c\/code\x3e 方法返回 \x3ccode\x3efalse\x3c\/code\x3e，中止后续的执行。\x3c\/p\x3e\n\x3cp\x3e否则在触发完 \x3ccode\x3eajaxBeforeSend\x3c\/code\x3e 事件后，触发 \x3ccode\x3eajaxSend\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3eajaxComplete\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function ajaxComplete(status, xhr, settings) {\n  var context = settings.context\n  settings.complete.call(context, xhr, status)\n  triggerGlobal(settings, context, \x27ajaxComplete\x27, [xhr, settings])\n  ajaxStop(settings)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eajaxComplete\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estatus, xhr, settings\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e context = settings.context\n  settings.complete.call(context, xhr, status)\n  triggerGlobal(settings, context, \x3cspan class=\x22hljs-string\x22\x3e\x27ajaxComplete\x27\x3c\/span\x3e, [xhr, settings])\n  ajaxStop(settings)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e触发 \x3ccode\x3eajaxComplete\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3cp\x3e在触发 \x3ccode\x3eajaxComplete\x3c\/code\x3e 事件前，调用配置中的 \x3ccode\x3ecomplete\x3c\/code\x3e 方法，将 \x3ccode\x3exhr\x3c\/code\x3e 实例和当前的状态 \x3ccode\x3estate\x3c\/code\x3e 作为回调函数的参数。在触发完 \x3ccode\x3eajaxComplete\x3c\/code\x3e 事件后，调用 \x3ccode\x3eajaxStop\x3c\/code\x3e 方法，触发 \x3ccode\x3eajaxStop\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3eajaxSuccess\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function ajaxSuccess(data, xhr, settings, deferred) {\n  var context = settings.context, status = \x27success\x27\n  settings.success.call(context, data, status, xhr)\n  if (deferred) deferred.resolveWith(context, [data, status, xhr])\n  triggerGlobal(settings, context, \x27ajaxSuccess\x27, [xhr, settings, data])\n  ajaxComplete(status, xhr, settings)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eajaxSuccess\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata, xhr, settings, deferred\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e context = settings.context, status = \x3cspan class=\x22hljs-string\x22\x3e\x27success\x27\x3c\/span\x3e\n  settings.success.call(context, data, status, xhr)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (deferred) deferred.resolveWith(context, [data, status, xhr])\n  triggerGlobal(settings, context, \x3cspan class=\x22hljs-string\x22\x3e\x27ajaxSuccess\x27\x3c\/span\x3e, [xhr, settings, data])\n  ajaxComplete(status, xhr, settings)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e触发 \x3ccode\x3eajaxSucess\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3cp\x3e在触发 \x3ccode\x3eajaxSuccess\x3c\/code\x3e 事件前，先调用配置中的 \x3ccode\x3esuccess\x3c\/code\x3e 方法，将 \x3ccode\x3eajax\x3c\/code\x3e 返回的数据 \x3ccode\x3edata\x3c\/code\x3e 和当前状态 \x3ccode\x3estatus\x3c\/code\x3e 及 \x3ccode\x3exhr\x3c\/code\x3e 作为回调函数的参数。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3edeferred\x3c\/code\x3e 存在，则调用 \x3ccode\x3eresoveWith\x3c\/code\x3e 的方法，因为 \x3ccode\x3edeferred\x3c\/code\x3e 对象，因此在使用 \x3ccode\x3eajax\x3c\/code\x3e 的时候，可以使用 \x3ccode\x3epromise\x3c\/code\x3e 风格的调用。关于 \x3ccode\x3edeferred\x3c\/code\x3e ，见 《\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BDeferred%E6%A8%A1%E5%9D%97.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之Deferred模块\x3c\/a\x3e》的分析。 \x3c\/p\x3e\n\x3cp\x3e在触发完 \x3ccode\x3eajaxSuccess\x3c\/code\x3e 事件后，继续调用 \x3ccode\x3eajaxComplete\x3c\/code\x3e 方法，触发 \x3ccode\x3eajaxComplete\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3eajaxError\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function ajaxError(error, type, xhr, settings, deferred) {\n  var context = settings.context\n  settings.error.call(context, xhr, type, error)\n  if (deferred) deferred.rejectWith(context, [xhr, type, error])\n  triggerGlobal(settings, context, \x27ajaxError\x27, [xhr, settings, error || type])\n  ajaxComplete(type, xhr, settings)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eajaxError\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror, type, xhr, settings, deferred\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e context = settings.context\n  settings.error.call(context, xhr, type, error)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (deferred) deferred.rejectWith(context, [xhr, type, error])\n  triggerGlobal(settings, context, \x3cspan class=\x22hljs-string\x22\x3e\x27ajaxError\x27\x3c\/span\x3e, [xhr, settings, error || type])\n  ajaxComplete(type, xhr, settings)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e触发 \x3ccode\x3eajaxError\x3c\/code\x3e 事件，错误的类型可以为 \x3ccode\x3etimeout\x3c\/code\x3e、\x3ccode\x3eerror\x3c\/code\x3e、 \x3ccode\x3eabort\x3c\/code\x3e、 \x3ccode\x3eparsererror\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e在触发事件前，调用配置中的 \x3ccode\x3eerror\x3c\/code\x3e 方法，将 \x3ccode\x3exhr\x3c\/code\x3e 实例，错误类型 \x3ccode\x3etype\x3c\/code\x3e 和 \x3ccode\x3eerror\x3c\/code\x3e 对象作为回调函数的参数。\x3c\/p\x3e\n\x3cp\x3e随后调用 \x3ccode\x3eajaxComplete\x3c\/code\x3e 方法，触发 \x3ccode\x3eajaxComplete\x3c\/code\x3e 事件。因此，\x3ccode\x3eajaxComplete\x3c\/code\x3e 事件无论成功还是失败都会触发。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3eempty\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function empty() {}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eempty\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e空函数，用来作为回调函数配置的初始值。这样的好处是在执行回调函数时，不需要每次都判断回调函数是否存在。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3eajaxDataFilter\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function ajaxDataFilter(data, type, settings) {\n  if (settings.dataFilter == empty) return data\n  var context = settings.context\n  return settings.dataFilter.call(context, data, type)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eajaxDataFilter\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata, type, settings\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings.dataFilter == empty) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e data\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e context = settings.context\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e settings.dataFilter.call(context, data, type)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e主要用来过滤请求成功后的响应数据。\x3c\/p\x3e\n\x3cp\x3e如果配置中的 \x3ccode\x3edataFilter\x3c\/code\x3e 属性为初始值 \x3ccode\x3eempty\x3c\/code\x3e，则将原始数据返回。\x3c\/p\x3e\n\x3cp\x3e如果有配置 \x3ccode\x3edataFilter\x3c\/code\x3e，则调用配置的回调方法，将数据 \x3ccode\x3edata\x3c\/code\x3e 和数据类型 \x3ccode\x3etype\x3c\/code\x3e 作为回调的参数，再将执行的结果返回。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3emimeToDataType\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var htmlType = \x27text\/html\x27,\n    jsonType = \x27application\/json\x27,\n    scriptTypeRE = \/^(?:text|application)\\\/javascript\/i,\n    xmlTypeRE = \/^(?:text|application)\\\/xml\/i,\nfunction mimeToDataType(mime) {\n  if (mime) mime = mime.split(\x27;\x27, 2)[0]\n  return mime \x26amp;\x26amp; ( mime == htmlType ? \x27html\x27 :\n                  mime == jsonType ? \x27json\x27 :\n                  scriptTypeRE.test(mime) ? \x27script\x27 :\n                  xmlTypeRE.test(mime) \x26amp;\x26amp; \x27xml\x27 ) || \x27text\x27\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e htmlType = \x3cspan class=\x22hljs-string\x22\x3e\x27text\/html\x27\x3c\/span\x3e,\n    jsonType = \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json\x27\x3c\/span\x3e,\n    scriptTypeRE = \x3cspan class=\x22hljs-regexp\x22\x3e\/^(?:text|application)\\\/javascript\/i\x3c\/span\x3e,\n    xmlTypeRE = \x3cspan class=\x22hljs-regexp\x22\x3e\/^(?:text|application)\\\/xml\/i\x3c\/span\x3e,\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emimeToDataType\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emime\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (mime) mime = mime.split(\x3cspan class=\x22hljs-string\x22\x3e\x27;\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e mime \x26amp;\x26amp; ( mime == htmlType ? \x3cspan class=\x22hljs-string\x22\x3e\x27html\x27\x3c\/span\x3e :\n                  mime == jsonType ? \x3cspan class=\x22hljs-string\x22\x3e\x27json\x27\x3c\/span\x3e :\n                  scriptTypeRE.test(mime) ? \x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e :\n                  xmlTypeRE.test(mime) \x26amp;\x26amp; \x3cspan class=\x22hljs-string\x22\x3e\x27xml\x27\x3c\/span\x3e ) || \x3cspan class=\x22hljs-string\x22\x3e\x27text\x27\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e返回 \x3ccode\x3edataType\x3c\/code\x3e 的类型。\x3c\/p\x3e\n\x3cp\x3e先看看这个函数中使用到的几个正则表达式，\x3ccode\x3escriptTypeRE\x3c\/code\x3e 匹配的是 \x3ccode\x3etext\/javascript\x3c\/code\x3e 或者 \x3ccode\x3eapplication\/javascript\x3c\/code\x3e， \x3ccode\x3exmlTypeRE\x3c\/code\x3e 匹配的是 \x3ccode\x3etext\/xml\x3c\/code\x3e 或者 \x3ccode\x3eapplication\/xml\x3c\/code\x3e， 都还比较简单，不作过多的解释。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eContent-Type\x3c\/code\x3e 的值的形式如下 \x3ccode\x3etext\/html; charset=utf-8\x3c\/code\x3e， 所以如果参数 \x3ccode\x3emime\x3c\/code\x3e 存在，则用 \x3ccode\x3e;\x3c\/code\x3e 分割，取第一项，这里是 \x3ccode\x3etext\/html\x3c\/code\x3e，即为包含类型的字符串。\x3c\/p\x3e\n\x3cp\x3e接下来是针对 \x3ccode\x3ehtml\x3c\/code\x3e 、\x3ccode\x3ejson\x3c\/code\x3e、 \x3ccode\x3escript\x3c\/code\x3e 和  \x3ccode\x3exml\x3c\/code\x3e 用对应的正则进行匹配，匹配成功，返回对应的类型值，如果都不匹配，则返回 \x3ccode\x3etext\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3eappendQuery\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function appendQuery(url, query) {\n  if (query == \x27\x27) return url\n  return (url \x2b \x27\x26amp;\x27 \x2b query).replace(\/[\x26amp;?]{1,2}\/, \x27?\x27)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eappendQuery\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, query\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (query == \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e url\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;\x27\x3c\/span\x3e \x2b query).replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/[\x26amp;?]{1,2}\/\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27?\x27\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e向 \x3ccode\x3eurl\x3c\/code\x3e 追加参数。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3equery\x3c\/code\x3e 为空，则将原 \x3ccode\x3eurl\x3c\/code\x3e 返回。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3equery\x3c\/code\x3e 不为空，则用 \x3ccode\x3e\x26amp;\x3c\/code\x3e 拼接 \x3ccode\x3equery\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e最后调用 \x3ccode\x3ereplace\x3c\/code\x3e，将 \x3ccode\x3e\x26amp;\x26amp;\x3c\/code\x3e 、 \x3ccode\x3e?\x26amp;\x3c\/code\x3e ，\x3ccode\x3e\x26amp;?\x3c\/code\x3e  或 \x3ccode\x3e??\x3c\/code\x3e 替换成 \x3ccode\x3e?\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e拼接出来的 \x3ccode\x3eurl\x3c\/code\x3e 的形式如 \x3ccode\x3eurl?key=value\x26amp;key2=value\x3c\/code\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3eparseArguments\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function parseArguments(url, data, success, dataType) {\n  if ($.isFunction(data)) dataType = success, success = data, data = undefined\n  if (!$.isFunction(success)) dataType = success, success = undefined\n  return {\n    url: url\n    , data: data\n    , success: success\n    , dataType: dataType\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eparseArguments\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, data, success, dataType\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($.isFunction(data)) dataType = success, success = data, data = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!$.isFunction(success)) dataType = success, success = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: url\n    , \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: data\n    , \x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: success\n    , \x3cspan class=\x22hljs-attr\x22\x3edataType\x3c\/span\x3e: dataType\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个方法是用来格式化参数的，\x3ccode\x3eAjax\x3c\/code\x3e 模块定义了一些便捷的调用方法，这些调用方法不需要传递 \x3ccode\x3eoption\x3c\/code\x3e，某些必填值已经采用了默认传递的方式，这些方法中有些参数是可以不需要传递的，这个方法就是来用判读那些参数有传递，那些没有传递，然后再将参数拼接成 \x3ccode\x3eajax\x3c\/code\x3e 所需要的 \x3ccode\x3eoptions\x3c\/code\x3e 对象。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3eserialize\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function serialize(params, obj, traditional, scope){\n  var type, array = $.isArray(obj), hash = $.isPlainObject(obj)\n  $.each(obj, function(key, value) {\n    type = $.type(value)\n    if (scope) key = traditional ? scope :\n    scope \x2b \x27[\x27 \x2b (hash || type == \x27object\x27 || type == \x27array\x27 ? key : \x27\x27) \x2b \x27]\x27\n    \/\/ handle data in serializeArray() format\n    if (!scope \x26amp;\x26amp; array) params.add(value.name, value.value)\n    \/\/ recurse into nested objects\n    else if (type == \x26quot;array\x26quot; || (!traditional \x26amp;\x26amp; type == \x26quot;object\x26quot;))\n      serialize(params, value, traditional, key)\n    else params.add(key, value)\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eserialize\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eparams, obj, traditional, scope\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e type, array = $.isArray(obj), hash = $.isPlainObject(obj)\n  $.each(obj, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ekey, value\x3c\/span\x3e) \x3c\/span\x3e{\n    type = $.type(value)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (scope) key = traditional ? scope :\n    scope \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27[\x27\x3c\/span\x3e \x2b (hash || type == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e || type == \x3cspan class=\x22hljs-string\x22\x3e\x27array\x27\x3c\/span\x3e ? key : \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27]\x27\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ handle data in serializeArray() format\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!scope \x26amp;\x26amp; array) params.add(value.name, value.value)\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ recurse into nested objects\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (type == \x3cspan class=\x22hljs-string\x22\x3e\x22array\x22\x3c\/span\x3e || (!traditional \x26amp;\x26amp; type == \x3cspan class=\x22hljs-string\x22\x3e\x22object\x22\x3c\/span\x3e))\n      serialize(params, value, traditional, key)\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e params.add(key, value)\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e序列化参数。\x3c\/p\x3e\n\x3cp\x3e要了解这个函数，需要了解 \x3ccode\x3etraditional\x3c\/code\x3e 参数的作用，这个参数表示是否开启以传统的浅层序列化方式来进行序列化，具体的示例见上文参数解释部分。\x3c\/p\x3e\n\x3cp\x3e如果参数 \x3ccode\x3eobj\x3c\/code\x3e 的为数组，则 \x3ccode\x3earray\x3c\/code\x3e 为 \x3ccode\x3etrue\x3c\/code\x3e， 如果为纯粹对象，则 \x3ccode\x3ehash\x3c\/code\x3e 为 \x3ccode\x3etrue\x3c\/code\x3e。 \x3ccode\x3e$.isArray\x3c\/code\x3e 和 \x3ccode\x3e$.isPlainObject\x3c\/code\x3e 的源码分析见《\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/456627c2e8199ac1d043af51177d6159fddd39bc\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E5%86%85%E9%83%A8%E6%96%B9%E6%B3%95.md#isplainobject\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之内部方法\x3c\/a\x3e》。\x3c\/p\x3e\n\x3cp\x3e遍历需要序列化的对象 \x3ccode\x3eobj\x3c\/code\x3e，判断 \x3ccode\x3evalue\x3c\/code\x3e 的类型 \x3ccode\x3etype\x3c\/code\x3e， 这个 \x3ccode\x3etype\x3c\/code\x3e 后面会用到。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3escope\x3c\/code\x3e 是记录深层嵌套时的 \x3ccode\x3ekey\x3c\/code\x3e 值，这个 \x3ccode\x3ekey\x3c\/code\x3e 值受 \x3ccode\x3etraditional\x3c\/code\x3e 的影响。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3etraditional\x3c\/code\x3e 为 \x3ccode\x3etrue\x3c\/code\x3e ，则 \x3ccode\x3ekey\x3c\/code\x3e 为原始的 \x3ccode\x3escope\x3c\/code\x3e 值，即对象第一层的 \x3ccode\x3ekey\x3c\/code\x3e 值。\x3c\/p\x3e\n\x3cp\x3e否则，用 \x3ccode\x3e[]\x3c\/code\x3e 拼接当前循环中的 \x3ccode\x3ekey\x3c\/code\x3e ，最终的 \x3ccode\x3ekey\x3c\/code\x3e 值会是这种形式 \x3ccode\x3escope[key][key2]...\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3eobj\x3c\/code\x3e 为数组，并且 \x3ccode\x3escope\x3c\/code\x3e 不存在，即为第一层，直接调用 \x3ccode\x3eparams.add\x3c\/code\x3e 方法，这个方法后面会分析到。\x3c\/p\x3e\n\x3cp\x3e否则如果  \x3ccode\x3evalue\x3c\/code\x3e 的类型为数组或者非传统序列化方式下为对象，则递归调用 \x3ccode\x3eserialize\x3c\/code\x3e 方法，用来处理 \x3ccode\x3ekey\x3c\/code\x3e 。\x3c\/p\x3e\n\x3cp\x3e其他情况调用 \x3ccode\x3eparams.add\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader18\x22\x3eserializeData\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function serializeData(options) {\n  if (options.processData \x26amp;\x26amp; options.data \x26amp;\x26amp; $.type(options.data) != \x26quot;string\x26quot;)\n    options.data = $.param(options.data, options.traditional)\n  if (options.data \x26amp;\x26amp; (!options.type || options.type.toUpperCase() == \x27GET\x27 || \x27jsonp\x27 == options.dataType))\n    options.url = appendQuery(options.url, options.data), options.data = undefined\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eserializeData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (options.processData \x26amp;\x26amp; options.data \x26amp;\x26amp; $.type(options.data) != \x3cspan class=\x22hljs-string\x22\x3e\x22string\x22\x3c\/span\x3e)\n    options.data = $.param(options.data, options.traditional)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (options.data \x26amp;\x26amp; (!options.type || options.type.toUpperCase() == \x3cspan class=\x22hljs-string\x22\x3e\x27GET\x27\x3c\/span\x3e || \x3cspan class=\x22hljs-string\x22\x3e\x27jsonp\x27\x3c\/span\x3e == options.dataType))\n    options.url = appendQuery(options.url, options.data), options.data = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e序列化参数。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3eprocessData\x3c\/code\x3e 为 \x3ccode\x3etrue\x3c\/code\x3e ，并且参数 \x3ccode\x3edata\x3c\/code\x3e 不为字符串，则调用 \x3ccode\x3e$.params\x3c\/code\x3e 方法序列化参数。 \x3ccode\x3e$.params\x3c\/code\x3e 方法后面会讲到。\x3c\/p\x3e\n\x3cp\x3e如果为 \x3ccode\x3eGET\x3c\/code\x3e 请求或者为 \x3ccode\x3ejsonp\x3c\/code\x3e ，则调用 \x3ccode\x3eappendQuery\x3c\/code\x3e ，将参数拼接到请求地址后面。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader19\x22\x3e对外接口\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader20\x22\x3e$.active\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$.active = 0\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$.active = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e正在请求的 \x3ccode\x3eajax\x3c\/code\x3e 数量，初始时为 \x3ccode\x3e0\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader21\x22\x3e$.ajaxSettings\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$.ajaxSettings = {\n  \/\/ Default type of request\n  type: \x27GET\x27,\n  \/\/ Callback that is executed before request\n  beforeSend: empty,\n  \/\/ Callback that is executed if the request succeeds\n  success: empty,\n  \/\/ Callback that is executed the the server drops error\n  error: empty,\n  \/\/ Callback that is executed on request complete (both: error and success)\n  complete: empty,\n  \/\/ The context for the callbacks\n  context: null,\n  \/\/ Whether to trigger \x26quot;global\x26quot; Ajax events\n  global: true,\n  \/\/ Transport\n  xhr: function () {\n    return new window.XMLHttpRequest()\n  },\n  \/\/ MIME types mapping\n  \/\/ IIS returns Javascript as \x26quot;application\/x-javascript\x26quot;\n  accepts: {\n    script: \x27text\/javascript, application\/javascript, application\/x-javascript\x27,\n    json:   jsonType,\n    xml:    \x27application\/xml, text\/xml\x27,\n    html:   htmlType,\n    text:   \x27text\/plain\x27\n  },\n  \/\/ Whether the request is to another domain\n  crossDomain: false,\n  \/\/ Default timeout\n  timeout: 0,\n  \/\/ Whether data should be serialized to string\n  processData: true,\n  \/\/ Whether the browser should be allowed to cache GET responses\n  cache: true,\n  \/\/Used to handle the raw response data of XMLHttpRequest.\n  \/\/This is a pre-filtering function to sanitize the response.\n  \/\/The sanitized response should be returned\n  dataFilter: empty\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$.ajaxSettings = {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Default type of request\x3c\/span\x3e\n  type: \x3cspan class=\x22hljs-string\x22\x3e\x27GET\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Callback that is executed before request\x3c\/span\x3e\n  beforeSend: empty,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Callback that is executed if the request succeeds\x3c\/span\x3e\n  success: empty,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Callback that is executed the the server drops error\x3c\/span\x3e\n  error: empty,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Callback that is executed on request complete (both: error and success)\x3c\/span\x3e\n  complete: empty,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ The context for the callbacks\x3c\/span\x3e\n  context: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Whether to trigger \x22global\x22 Ajax events\x3c\/span\x3e\n  global: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Transport\x3c\/span\x3e\n  xhr: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.XMLHttpRequest()\n  },\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ MIME types mapping\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ IIS returns Javascript as \x22application\/x-javascript\x22\x3c\/span\x3e\n  accepts: {\n    \x3cspan class=\x22hljs-attr\x22\x3escript\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27text\/javascript, application\/javascript, application\/x-javascript\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ejson\x3c\/span\x3e:   jsonType,\n    \x3cspan class=\x22hljs-attr\x22\x3exml\x3c\/span\x3e:    \x3cspan class=\x22hljs-string\x22\x3e\x27application\/xml, text\/xml\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ehtml\x3c\/span\x3e:   htmlType,\n    \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e:   \x3cspan class=\x22hljs-string\x22\x3e\x27text\/plain\x27\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Whether the request is to another domain\x3c\/span\x3e\n  crossDomain: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Default timeout\x3c\/span\x3e\n  timeout: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Whether data should be serialized to string\x3c\/span\x3e\n  processData: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Whether the browser should be allowed to cache GET responses\x3c\/span\x3e\n  cache: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/Used to handle the raw response data of XMLHttpRequest.\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/This is a pre-filtering function to sanitize the response.\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/The sanitized response should be returned\x3c\/span\x3e\n  dataFilter: empty\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eajax\x3c\/code\x3e 默认配置，这些是 \x3ccode\x3ezepto\x3c\/code\x3e 的默认值，在使用时，可以更改成自己需要的配置。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader22\x22\x3e$.param\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var escape = encodeURIComponent\n$.param = function(obj, traditional){\n  var params = []\n  params.add = function(key, value) {\n    if ($.isFunction(value)) value = value()\n    if (value == null) value = \x26quot;\x26quot;\n    this.push(escape(key) \x2b \x27=\x27 \x2b escape(value))\n  }\n  serialize(params, obj, traditional)\n  return params.join(\x27\x26amp;\x27).replace(\/%20\/g, \x27\x2b\x27)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eescape\x3c\/span\x3e = \x3cspan class=\x22hljs-built_in\x22\x3eencodeURIComponent\x3c\/span\x3e\n$.param = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj, traditional\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e params = []\n  params.add = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ekey, value\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($.isFunction(value)) value = value()\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (value == \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e) value = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.push(\x3cspan class=\x22hljs-built_in\x22\x3eescape\x3c\/span\x3e(key) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-built_in\x22\x3eescape\x3c\/span\x3e(value))\n  }\n  serialize(params, obj, traditional)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e params.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;\x27\x3c\/span\x3e).replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/%20\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x2b\x27\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eparam\x3c\/code\x3e 方法用来序列化参数，内部调用的是 \x3ccode\x3eserialize\x3c\/code\x3e 方法，并且在容器 \x3ccode\x3eparams\x3c\/code\x3e 上定义了一个 \x3ccode\x3eadd\x3c\/code\x3e 方法，供 \x3ccode\x3eserialize\x3c\/code\x3e 调用。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eadd\x3c\/code\x3e 方法比较简单，首先判断值 \x3ccode\x3evalue\x3c\/code\x3e 是否为 \x3ccode\x3efunction\x3c\/code\x3e ，如果是，则通过调用函数来取值，如果为 \x3ccode\x3enull\x3c\/code\x3e 或者 \x3ccode\x3eundefined\x3c\/code\x3e ，则 \x3ccode\x3evalue\x3c\/code\x3e 赋值为空字符串。\x3c\/p\x3e\n\x3cp\x3e然后将 \x3ccode\x3ekey\x3c\/code\x3e 和 \x3ccode\x3evalue\x3c\/code\x3e 用 \x3ccode\x3eencodeURIComponent\x3c\/code\x3e 编码，用 \x3ccode\x3e=\x3c\/code\x3e 号连接起来。\x3c\/p\x3e\n\x3cp\x3e接着便是简单的调用 \x3ccode\x3eserialize\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3cp\x3e最后将容器中的数据用 \x3ccode\x3e\x26amp;\x3c\/code\x3e 连接起来，并且将空格替换成 \x3ccode\x3e\x2b\x3c\/code\x3e 号。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader23\x22\x3e$.ajaxJSONP\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var jsonpID = \x2bnew Date()\n$.ajaxJSONP = function(options, deferred){\n  if (!(\x27type\x27 in options)) return $.ajax(options)\n\n  var _callbackName = options.jsonpCallback,\n      callbackName = ($.isFunction(_callbackName) ?\n                      _callbackName() : _callbackName) || (\x27Zepto\x27 \x2b (jsonpID\x2b\x2b)),\n      script = document.createElement(\x27script\x27),\n      originalCallback = window[callbackName],\n      responseData,\n      abort = function(errorType) {\n        $(script).triggerHandler(\x27error\x27, errorType || \x27abort\x27)\n      },\n      xhr = { abort: abort }, abortTimeout\n\n  if (deferred) deferred.promise(xhr)\n\n  $(script).on(\x27load error\x27, function(e, errorType){\n    clearTimeout(abortTimeout)\n    $(script).off().remove()\n\n    if (e.type == \x27error\x27 || !responseData) {\n      ajaxError(null, errorType || \x27error\x27, xhr, options, deferred)\n    } else {\n      ajaxSuccess(responseData[0], xhr, options, deferred)\n    }\n\n    window[callbackName] = originalCallback\n    if (responseData \x26amp;\x26amp; $.isFunction(originalCallback))\n      originalCallback(responseData[0])\n\n    originalCallback = responseData = undefined\n  })\n\n  if (ajaxBeforeSend(xhr, options) === false) {\n    abort(\x27abort\x27)\n    return xhr\n  }\n\n  window[callbackName] = function(){\n    responseData = arguments\n  }\n\n  script.src = options.url.replace(\/\\?(.\x2b)=\\?\/, \x27?$1=\x27 \x2b callbackName)\n  document.head.appendChild(script)\n\n  if (options.timeout \x3e 0) abortTimeout = setTimeout(function(){\n    abort(\x27timeout\x27)\n  }, options.timeout)\n\n  return xhr\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e jsonpID = \x2b\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e()\n$.ajaxJSONP = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions, deferred\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e options)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $.ajax(options)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _callbackName = options.jsonpCallback,\n      callbackName = ($.isFunction(_callbackName) ?\n                      _callbackName() : _callbackName) || (\x3cspan class=\x22hljs-string\x22\x3e\x27Zepto\x27\x3c\/span\x3e \x2b (jsonpID\x2b\x2b)),\n      script = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e),\n      originalCallback = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e[callbackName],\n      responseData,\n      abort = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerrorType\x3c\/span\x3e) \x3c\/span\x3e{\n        $(script).triggerHandler(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, errorType || \x3cspan class=\x22hljs-string\x22\x3e\x27abort\x27\x3c\/span\x3e)\n      },\n      xhr = { \x3cspan class=\x22hljs-attr\x22\x3eabort\x3c\/span\x3e: abort }, abortTimeout\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (deferred) deferred.promise(xhr)\n\n  $(script).on(\x3cspan class=\x22hljs-string\x22\x3e\x27load error\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee, errorType\x3c\/span\x3e)\x3c\/span\x3e{\n    clearTimeout(abortTimeout)\n    $(script).off().remove()\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (e.type == \x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e || !responseData) {\n      ajaxError(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, errorType || \x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, xhr, options, deferred)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      ajaxSuccess(responseData[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e], xhr, options, deferred)\n    }\n\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e[callbackName] = originalCallback\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (responseData \x26amp;\x26amp; $.isFunction(originalCallback))\n      originalCallback(responseData[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e])\n\n    originalCallback = responseData = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n  })\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (ajaxBeforeSend(xhr, options) === \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e) {\n    abort(\x3cspan class=\x22hljs-string\x22\x3e\x27abort\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e xhr\n  }\n\n  \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e[callbackName] = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    responseData = \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e\n  }\n\n  script.src = options.url.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\?(.\x2b)=\\?\/\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27?$1=\x27\x3c\/span\x3e \x2b callbackName)\n  \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.head.appendChild(script)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (options.timeout \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) abortTimeout = setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    abort(\x3cspan class=\x22hljs-string\x22\x3e\x27timeout\x27\x3c\/span\x3e)\n  }, options.timeout)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e xhr\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在分析源码之前，先了解一下 \x3ccode\x3ejsonp\x3c\/code\x3e 的原理。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ejsonp\x3c\/code\x3e 实现跨域其实是利用了 \x3ccode\x3escript\x3c\/code\x3e 可以请求跨域资源的特点，所以实现 \x3ccode\x3ejsonp\x3c\/code\x3e 的基本步骤就是向页面动态插入一个 \x3ccode\x3escript\x3c\/code\x3e 标签，在请求地址上带上需要传递的参数，后端再将数据返回，前端调用回调函数进行解释。\x3c\/p\x3e\n\x3cp\x3e所以 \x3ccode\x3ejsonp\x3c\/code\x3e 本质上是一个 \x3ccode\x3eGET\x3c\/code\x3e 请求，因为链接的长度有限制，因此请求所携带的参数的长度也会有限制。\x3c\/p\x3e\n\x3ch4\x3e一些变量的定义\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (!(\x27type\x27 in options)) return $.ajax(options)\n\nvar _callbackName = options.jsonpCallback,\n    callbackName = ($.isFunction(_callbackName) ?\n                    _callbackName() : _callbackName) || (\x27Zepto\x27 \x2b (jsonpID\x2b\x2b)),\n    script = document.createElement(\x27script\x27),\n    originalCallback = window[callbackName],\n    responseData,\n    abort = function(errorType) {\n      $(script).triggerHandler(\x27error\x27, errorType || \x27abort\x27)\n    },\n    xhr = { abort: abort }, abortTimeout\n\nif (deferred) deferred.promise(xhr)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e options)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $.ajax(options)\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _callbackName = options.jsonpCallback,\n    callbackName = ($.isFunction(_callbackName) ?\n                    _callbackName() : _callbackName) || (\x3cspan class=\x22hljs-string\x22\x3e\x27Zepto\x27\x3c\/span\x3e \x2b (jsonpID\x2b\x2b)),\n    script = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e),\n    originalCallback = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e[callbackName],\n    responseData,\n    abort = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerrorType\x3c\/span\x3e) \x3c\/span\x3e{\n      $(script).triggerHandler(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, errorType || \x3cspan class=\x22hljs-string\x22\x3e\x27abort\x27\x3c\/span\x3e)\n    },\n    xhr = { \x3cspan class=\x22hljs-attr\x22\x3eabort\x3c\/span\x3e: abort }, abortTimeout\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (deferred) deferred.promise(xhr)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果配置中的请求类型没有定义，则直接调用 \x3ccode\x3e$.ajax\x3c\/code\x3e 方法，这个方法是整个模块的核心，后面会讲到。 \x3ccode\x3ejsonp\x3c\/code\x3e 请求的 \x3ccode\x3etype\x3c\/code\x3e 必须为 \x3ccode\x3ejsonp\x3c\/code\x3e 。\x3c\/p\x3e\n\x3cp\x3e私有变量用来临时存放配置中的 \x3ccode\x3ejsonpCallback\x3c\/code\x3e ，即 \x3ccode\x3ejsonp\x3c\/code\x3e 请求成功后执行的回调函数名，该配置可以为 \x3ccode\x3efunction\x3c\/code\x3e 类型。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ecallbackName\x3c\/code\x3e 是根据配置得出的回调函数名。如果 \x3ccode\x3e_callbackName\x3c\/code\x3e 为 \x3ccode\x3efunction\x3c\/code\x3e ，则以执行的结果作为回调函数名，如果 \x3ccode\x3e_callbackName\x3c\/code\x3e 没有配置，则用 \x3ccode\x3eZepto\x3c\/code\x3e \x2b \x3ccode\x3e时间戳\x3c\/code\x3e 作为回调函数名，时间戳初始化后，采用自增的方式来实现函数名的唯一性。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3escript\x3c\/code\x3e 用来保存创建的 \x3ccode\x3escript\x3c\/code\x3e 节点。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eoriginalCallback\x3c\/code\x3e 用来储存原始的回调函数。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eresponseData\x3c\/code\x3e 为响应的数据。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eabort\x3c\/code\x3e 函数用来中止 \x3ccode\x3ejsonp\x3c\/code\x3e 请求，实质上是触发了 \x3ccode\x3eerror\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3exhr\x3c\/code\x3e 对象只有 \x3ccode\x3eabort\x3c\/code\x3e 方法，如果存在 \x3ccode\x3edeferred\x3c\/code\x3e 对象，则调用 \x3ccode\x3epromise\x3c\/code\x3e 方法在 \x3ccode\x3exhr\x3c\/code\x3e 对象的基础上生成一个 \x3ccode\x3epromise\x3c\/code\x3e 对象。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eabortTimeout\x3c\/code\x3e 用来指定超时时间。\x3c\/p\x3e\n\x3ch4\x3ebeforeSend\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (ajaxBeforeSend(xhr, options) === false) {\n  abort(\x27abort\x27)\n  return xhr\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (ajaxBeforeSend(xhr, options) === \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e) {\n  abort(\x3cspan class=\x22hljs-string\x22\x3e\x27abort\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e xhr\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在发送 \x3ccode\x3ejsonp\x3c\/code\x3e 请求前，会调用 \x3ccode\x3eajaxBeforeSend\x3c\/code\x3e 方法，如果返回的为 \x3ccode\x3efalse\x3c\/code\x3e，则中止 \x3ccode\x3ejsonp\x3c\/code\x3e 请求的发送。\x3c\/p\x3e\n\x3ch4\x3e发送请求\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22window[callbackName] = function(){\n  responseData = arguments\n}\n\nscript.src = options.url.replace(\/\\?(.\x2b)=\\?\/, \x27?$1=\x27 \x2b callbackName)\ndocument.head.appendChild(script)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e[callbackName] = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  responseData = \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e\n}\n\nscript.src = options.url.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\?(.\x2b)=\\?\/\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27?$1=\x27\x3c\/span\x3e \x2b callbackName)\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.head.appendChild(script)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e发送请求前，重写了 \x3ccode\x3ewindow[callbackName]\x3c\/code\x3e 函数，将 \x3ccode\x3earguments\x3c\/code\x3e 赋值给 \x3ccode\x3eresponseData\x3c\/code\x3e， 这个函数会在后端返回的 \x3ccode\x3ejs\x3c\/code\x3e 代码中执行，这样 \x3ccode\x3eresponseData\x3c\/code\x3e 就可以获取得到数据了。\x3c\/p\x3e\n\x3cp\x3e接下来，将 \x3ccode\x3eurl\x3c\/code\x3e 的\x3ccode\x3e=?\x3c\/code\x3e 占位符，替换成回调函数名，最后将 \x3ccode\x3escript\x3c\/code\x3e 插入到页面中，发送请求。\x3c\/p\x3e\n\x3ch4\x3e请求超时\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (options.timeout \x3e 0) abortTimeout = setTimeout(function(){\n  abort(\x27timeout\x27)\n}, options.timeout)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (options.timeout \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) abortTimeout = setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  abort(\x3cspan class=\x22hljs-string\x22\x3e\x27timeout\x27\x3c\/span\x3e)\n}, options.timeout)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果有设置超时时间，则在请求超时时，触发错误事件。\x3c\/p\x3e\n\x3ch4\x3e请求成功或失败\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$(script).on(\x27load error\x27, function(e, errorType){\n  clearTimeout(abortTimeout)\n  $(script).off().remove()\n\n  if (e.type == \x27error\x27 || !responseData) {\n    ajaxError(null, errorType || \x27error\x27, xhr, options, deferred)\n  } else {\n    ajaxSuccess(responseData[0], xhr, options, deferred)\n  }\n\n  window[callbackName] = originalCallback\n  if (responseData \x26amp;\x26amp; $.isFunction(originalCallback))\n    originalCallback(responseData[0])\n\n  originalCallback = responseData = undefined\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$(script).on(\x3cspan class=\x22hljs-string\x22\x3e\x27load error\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee, errorType\x3c\/span\x3e)\x3c\/span\x3e{\n  clearTimeout(abortTimeout)\n  $(script).off().remove()\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (e.type == \x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e || !responseData) {\n    ajaxError(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, errorType || \x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, xhr, options, deferred)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    ajaxSuccess(responseData[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e], xhr, options, deferred)\n  }\n\n  \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e[callbackName] = originalCallback\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (responseData \x26amp;\x26amp; $.isFunction(originalCallback))\n    originalCallback(responseData[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e])\n\n  originalCallback = responseData = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在请求成功或者失败时，先清除请求超时定时器，避免触发超时错误，再将插入页面的 \x3ccode\x3escript\x3c\/code\x3e 从页面上删除，因为数据已经获取到，不再需要这个 \x3ccode\x3escript\x3c\/code\x3e 了。注意在删除 \x3ccode\x3escript\x3c\/code\x3e 前，调用了 \x3ccode\x3eoff\x3c\/code\x3e 方法，将 \x3ccode\x3escript\x3c\/code\x3e 上的事件都移除了。\x3c\/p\x3e\n\x3cp\x3e如果请求出错，则调用 \x3ccode\x3eajaxError\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3cp\x3e如果请求成功，则调用 \x3ccode\x3eajaxSuccess\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3cp\x3e之前我们把 \x3ccode\x3ewindow[callbackName]\x3c\/code\x3e 重写掉了，目的是为了获取到数据，现在再重新将原来的回调函数赋值回去，在获取到数据后，如果 \x3ccode\x3eoriginalCallback\x3c\/code\x3e 有定义，并且为函数，则将数据作为参数传递进去，执行。\x3c\/p\x3e\n\x3cp\x3e最后将数据和临时函数 \x3ccode\x3eoriginalCallback\x3c\/code\x3e 清理。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader24\x22\x3e$.ajax\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3e$.ajax\x3c\/code\x3e 方法是整个模块的核心，代码太长，就不全部贴在这里了，下面一部分一部分来分析。\x3c\/p\x3e\n\x3ch4\x3e处理默认配置\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var settings = $.extend({}, options || {}),\n    deferred = $.Deferred \x26amp;\x26amp; $.Deferred(),\n    urlAnchor, hashIndex\nfor (key in $.ajaxSettings) if (settings[key] === undefined) settings[key] = $.ajaxSettings[key]\najaxStart(settings)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e settings = $.extend({}, options || {}),\n    deferred = $.Deferred \x26amp;\x26amp; $.Deferred(),\n    urlAnchor, hashIndex\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (key \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e $.ajaxSettings) \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings[key] === \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) settings[key] = $.ajaxSettings[key]\najaxStart(settings)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3esettings\x3c\/code\x3e 为所传递配置的副本。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3edeferred\x3c\/code\x3e 为 \x3ccode\x3edeferred\x3c\/code\x3e 对象。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eurlAnchor\x3c\/code\x3e 为浏览器解释的路径，会用来判断是否跨域，后面会讲到。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ehashIndex\x3c\/code\x3e 为路径中 \x3ccode\x3ehash\x3c\/code\x3e 的索引。\x3c\/p\x3e\n\x3cp\x3e用 \x3ccode\x3efor ... in\x3c\/code\x3e 去遍历 \x3ccode\x3e$.ajaxSettings\x3c\/code\x3e ，作为配置的默认值。\x3c\/p\x3e\n\x3cp\x3e配置处理完毕后，调用 \x3ccode\x3eajaxStart\x3c\/code\x3e 函数，触发 \x3ccode\x3eajaxStart\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3ch4\x3e判断是否跨域\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22originAnchor = document.createElement(\x27a\x27)\noriginAnchor.href = window.location.href\n\nif (!settings.crossDomain) {\n  urlAnchor = document.createElement(\x27a\x27)\n  urlAnchor.href = settings.url\n  \/\/ cleans up URL for .href (IE only), see https:\/\/github.com\/madrobby\/zepto\/pull\/1049\n  urlAnchor.href = urlAnchor.href\n  settings.crossDomain = (originAnchor.protocol \x2b \x27\/\/\x27 \x2b originAnchor.host) !== (urlAnchor.protocol \x2b \x27\/\/\x27 \x2b urlAnchor.host)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eoriginAnchor = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e)\noriginAnchor.href = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!settings.crossDomain) {\n  urlAnchor = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e)\n  urlAnchor.href = settings.url\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ cleans up URL for .href (IE only), see https:\/\/github.com\/madrobby\/zepto\/pull\/1049\x3c\/span\x3e\n  urlAnchor.href = urlAnchor.href\n  settings.crossDomain = (originAnchor.protocol \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\/\x27\x3c\/span\x3e \x2b originAnchor.host) !== (urlAnchor.protocol \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\/\x27\x3c\/span\x3e \x2b urlAnchor.host)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果跨域 \x3ccode\x3ecrossDomain\x3c\/code\x3e 没有设置，则需要检测请求的地址是否跨域。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eoriginAnchor\x3c\/code\x3e 是当前页面链接，整体思路是创建一个 \x3ccode\x3ea\x3c\/code\x3e 节点，将 \x3ccode\x3ehref\x3c\/code\x3e 属性设置为当前请求的地址，然后获取节点的 \x3ccode\x3eprotocol\x3c\/code\x3e 和 \x3ccode\x3ehost\x3c\/code\x3e，看跟当前页面的链接用同样方式拼接出来的地址是否一致。\x3c\/p\x3e\n\x3cp\x3e注意到这里的 \x3ccode\x3eurlAnchor\x3c\/code\x3e 进行了两次赋值，这是因为 \x3ccode\x3eie\x3c\/code\x3e 默认不会对链接 \x3ccode\x3ea\x3c\/code\x3e 添加端口号，但是会对 \x3ccode\x3ewindow.location.href\x3c\/code\x3e 添加端口号，如果端口号为 \x3ccode\x3e80\x3c\/code\x3e 时，会出现不一致的情况。具体见:\x3ca href=\x22https:\/\/github.com\/madrobby\/zepto\/pull\/1049\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epr#1049\x3c\/a\x3e\x3c\/p\x3e\n\x3ch4\x3e处理请求地址\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (!settings.url) settings.url = window.location.toString()\nif ((hashIndex = settings.url.indexOf(\x27#\x27)) \x3e -1) settings.url = settings.url.slice(0, hashIndex)\nserializeData(settings)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!settings.url) settings.url = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.toString()\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((hashIndex = settings.url.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27#\x27\x3c\/span\x3e)) \x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) settings.url = settings.url.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, hashIndex)\nserializeData(settings)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果没有配置 \x3ccode\x3eurl\x3c\/code\x3e ，则用当前页面的地址作为请求地址。\x3c\/p\x3e\n\x3cp\x3e如果请求的地址带有 \x3ccode\x3ehash\x3c\/code\x3e， 则将 \x3ccode\x3ehash\x3c\/code\x3e 去掉，因为 \x3ccode\x3ehash\x3c\/code\x3e 并不会传递给后端。\x3c\/p\x3e\n\x3cp\x3e然后调用 \x3ccode\x3eserializeData\x3c\/code\x3e 方法来序列化请求参数 \x3ccode\x3edata\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch4\x3e处理缓存\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var dataType = settings.dataType, hasPlaceholder = \/\\?.\x2b=\\?\/.test(settings.url)\nif (hasPlaceholder) dataType = \x27jsonp\x27\n\nif (settings.cache === false || (\n  (!options || options.cache !== true) \x26amp;\x26amp;\n  (\x27script\x27 == dataType || \x27jsonp\x27 == dataType)\n))\n  settings.url = appendQuery(settings.url, \x27_=\x27 \x2b Date.now())\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dataType = settings.dataType, hasPlaceholder = \x3cspan class=\x22hljs-regexp\x22\x3e\/\\?.\x2b=\\?\/\x3c\/span\x3e.test(settings.url)\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hasPlaceholder) dataType = \x3cspan class=\x22hljs-string\x22\x3e\x27jsonp\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings.cache === \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e || (\n  (!options || options.cache !== \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) \x26amp;\x26amp;\n  (\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e == dataType || \x3cspan class=\x22hljs-string\x22\x3e\x27jsonp\x27\x3c\/span\x3e == dataType)\n))\n  settings.url = appendQuery(settings.url, \x3cspan class=\x22hljs-string\x22\x3e\x27_=\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now())\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ehasPlaceholder\x3c\/code\x3e 的正则匹配规则跟上面分析到 \x3ccode\x3ejsonp\x3c\/code\x3e 的替换 \x3ccode\x3ecallbackName\x3c\/code\x3e 的正则一样，约定以这样的方式来替换 \x3ccode\x3eurl\x3c\/code\x3e 中的 \x3ccode\x3ecallbackName\x3c\/code\x3e。因此，也可以用这样的正则来判断是否为 \x3ccode\x3ejsonp\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3ecache\x3c\/code\x3e 的配置为 \x3ccode\x3efalse\x3c\/code\x3e ，或者在 \x3ccode\x3edataType\x3c\/code\x3e 为 \x3ccode\x3escript\x3c\/code\x3e 或者 \x3ccode\x3ejsonp\x3c\/code\x3e 的情况下， \x3ccode\x3ecache\x3c\/code\x3e 没有设置为 \x3ccode\x3etrue\x3c\/code\x3e 时，表示不需要缓存，清除浏览器缓存的方式也很简单，就是往请求地址的后面加上一个时间戳，这样每次请求的地址都不一样，浏览器自然就没有缓存了。\x3c\/p\x3e\n\x3ch4\x3e处理jsonp\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (\x27jsonp\x27 == dataType) {\n  if (!hasPlaceholder)\n    settings.url = appendQuery(settings.url,\n                               settings.jsonp ? (settings.jsonp \x2b \x27=?\x27) : settings.jsonp === false ? \x27\x27 : \x27callback=?\x27)\n  return $.ajaxJSONP(settings, deferred)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x27jsonp\x27\x3c\/span\x3e == dataType) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!hasPlaceholder)\n    settings.url = appendQuery(settings.url,\n                               settings.jsonp ? (settings.jsonp \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27=?\x27\x3c\/span\x3e) : settings.jsonp === \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27callback=?\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $.ajaxJSONP(settings, deferred)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e判断 \x3ccode\x3edataType\x3c\/code\x3e 的类型为 \x3ccode\x3ejsonp\x3c\/code\x3e 时，会对 \x3ccode\x3eurl\x3c\/code\x3e 进行一些处理。\x3c\/p\x3e\n\x3cp\x3e如果还没有 \x3ccode\x3e?=\x3c\/code\x3e 占位符，则向 \x3ccode\x3eurl\x3c\/code\x3e 中追加占位符。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3esettings.jsonp\x3c\/code\x3e 存在，则追加 \x3ccode\x3esettings.jsonp\x3c\/code\x3e  \x2b \x3ccode\x3e=?\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3esettings.jsonp\x3c\/code\x3e 为 \x3ccode\x3efalse\x3c\/code\x3e， 则不向 \x3ccode\x3eurl\x3c\/code\x3e 中追加东西。\x3c\/p\x3e\n\x3cp\x3e否则默认追加 \x3ccode\x3ecallback=?\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eurl\x3c\/code\x3e 拼接完毕后，调用 \x3ccode\x3e$.ajaxJSONP\x3c\/code\x3e 方法，发送 \x3ccode\x3ejsonp\x3c\/code\x3e 请求。\x3c\/p\x3e\n\x3ch4\x3e一些变量\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var mime = settings.accepts[dataType],\n    headers = { },\n    setHeader = function(name, value) { headers[name.toLowerCase()] = [name, value] },\n    protocol = \/^([\\w-]\x2b:)\\\/\\\/\/.test(settings.url) ? RegExp.$1 : window.location.protocol,\n    xhr = settings.xhr(),\n    nativeSetHeader = xhr.setRequestHeader,\n    abortTimeout\n\nif (deferred) deferred.promise(xhr)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e mime = settings.accepts[dataType],\n    headers = { },\n    setHeader = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ename, value\x3c\/span\x3e) \x3c\/span\x3e{ headers[name.toLowerCase()] = [name, value] },\n    protocol = \x3cspan class=\x22hljs-regexp\x22\x3e\/^([\\w-]\x2b:)\\\/\\\/\/\x3c\/span\x3e.test(settings.url) ? \x3cspan class=\x22hljs-built_in\x22\x3eRegExp\x3c\/span\x3e.$\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e : \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.protocol,\n    xhr = settings.xhr(),\n    nativeSetHeader = xhr.setRequestHeader,\n    abortTimeout\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (deferred) deferred.promise(xhr)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3emime\x3c\/code\x3e 获取数据的 \x3ccode\x3emime\x3c\/code\x3e 类型。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eheaders\x3c\/code\x3e 为请求头。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3esetHeader\x3c\/code\x3e 为设置请求头的方法，其实是往 \x3ccode\x3eheaders\x3c\/code\x3e 上增加对应的 \x3ccode\x3ekey\x3c\/code\x3e \x3ccode\x3evalue\x3c\/code\x3e 值。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eprotocol\x3c\/code\x3e 为协议，匹配一个或多个以字母、数字或者 \x3ccode\x3e-\x3c\/code\x3e 开头，并且后面为 \x3ccode\x3e:\/\/\x3c\/code\x3e 的字符串。优先从配置的 \x3ccode\x3eurl\x3c\/code\x3e 中获取，如果没有配置 \x3ccode\x3eurl\x3c\/code\x3e，则取 \x3ccode\x3ewindow.location.protocol\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3exhr\x3c\/code\x3e 为 \x3ccode\x3eXMLHttpRequest\x3c\/code\x3e 实例。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3enativeSetHeader\x3c\/code\x3e 为 \x3ccode\x3exhr\x3c\/code\x3e 实例上的 \x3ccode\x3esetRequestHeader\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eabortTimeout\x3c\/code\x3e 为超时定时器的 \x3ccode\x3eid\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3edeferred\x3c\/code\x3e 对象存在，则调用 \x3ccode\x3epromise\x3c\/code\x3e 方法，以 \x3ccode\x3exhr\x3c\/code\x3e 为基础生成一个 \x3ccode\x3epromise\x3c\/code\x3e 。\x3c\/p\x3e\n\x3ch4\x3e设置请求头\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (!settings.crossDomain) setHeader(\x27X-Requested-With\x27, \x27XMLHttpRequest\x27)\nsetHeader(\x27Accept\x27, mime || \x27*\/*\x27)\nif (mime = settings.mimeType || mime) {\n  if (mime.indexOf(\x27,\x27) \x3e -1) mime = mime.split(\x27,\x27, 2)[0]\n  xhr.overrideMimeType \x26amp;\x26amp; xhr.overrideMimeType(mime)\n}\nif (settings.contentType || (settings.contentType !== false \x26amp;\x26amp; settings.data \x26amp;\x26amp; settings.type.toUpperCase() != \x27GET\x27))\n  setHeader(\x27Content-Type\x27, settings.contentType || \x27application\/x-www-form-urlencoded\x27)\n\nif (settings.headers) for (name in settings.headers) setHeader(name, settings.headers[name])\nxhr.setRequestHeader = setHeader\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!settings.crossDomain) setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27X-Requested-With\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27XMLHttpRequest\x27\x3c\/span\x3e)\nsetHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27Accept\x27\x3c\/span\x3e, mime || \x3cspan class=\x22hljs-string\x22\x3e\x27*\/*\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (mime = settings.mimeType || mime) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (mime.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27,\x27\x3c\/span\x3e) \x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) mime = mime.split(\x3cspan class=\x22hljs-string\x22\x3e\x27,\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n  xhr.overrideMimeType \x26amp;\x26amp; xhr.overrideMimeType(mime)\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings.contentType || (settings.contentType !== \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e \x26amp;\x26amp; settings.data \x26amp;\x26amp; settings.type.toUpperCase() != \x3cspan class=\x22hljs-string\x22\x3e\x27GET\x27\x3c\/span\x3e))\n  setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e, settings.contentType || \x3cspan class=\x22hljs-string\x22\x3e\x27application\/x-www-form-urlencoded\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings.headers) \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (name \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e settings.headers) setHeader(name, settings.headers[name])\nxhr.setRequestHeader = setHeader\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果不是跨域请求时，设置请求头 \x3ccode\x3eX-Requested-With\x3c\/code\x3e 的值为 \x3ccode\x3eXMLHttpRequest\x3c\/code\x3e 。这个请求头的作用是告诉服务端，这个请求为 \x3ccode\x3eajax\x3c\/code\x3e 请求。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3esetHeader(\x27Accept\x27, mime || \x27*\/*\x27)\x3c\/code\x3e 用来设置客户端接受的资源类型。\x3c\/p\x3e\n\x3cp\x3e当 \x3ccode\x3emime\x3c\/code\x3e 存在时，调用 \x3ccode\x3eoverrideMimeType\x3c\/code\x3e 方法来重写 \x3ccode\x3eresponse\x3c\/code\x3e 的 \x3ccode\x3econtent-type\x3c\/code\x3e ，使得服务端返回的类型跟客户端要求的类型不一致时，可以按照指定的格式来解释。具体可以参见这篇文章 《\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000004322487\x22\x3e你真的会使用XMLHttpRequest吗？\x3c\/a\x3e》。\x3c\/p\x3e\n\x3cp\x3e如果有指定 \x3ccode\x3econtentType\x3c\/code\x3e ，\x3c\/p\x3e\n\x3cp\x3e或者 \x3ccode\x3econtentType\x3c\/code\x3e 没有设置为 \x3ccode\x3efalse\x3c\/code\x3e ，并且 \x3ccode\x3edata\x3c\/code\x3e 存在以及请求类型不为 \x3ccode\x3eGET\x3c\/code\x3e 时，设置 \x3ccode\x3eContent-Type\x3c\/code\x3e 为指定的 \x3ccode\x3econtentType\x3c\/code\x3e ，在没有指定时，设置为 \x3ccode\x3eapplication\/x-www-form-urlencoded\x3c\/code\x3e 。所以没有指定 \x3ccode\x3econtentType\x3c\/code\x3e 时， \x3ccode\x3ePOST\x3c\/code\x3e 请求，默认的 \x3ccode\x3eContent-Type\x3c\/code\x3e 为 \x3ccode\x3eapplication\/x-www-form-urlencoded\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果有配置 \x3ccode\x3eheaders\x3c\/code\x3e ，则遍历 \x3ccode\x3eheaders\x3c\/code\x3e 配置，分别调用 \x3ccode\x3esetHeader\x3c\/code\x3e 方法配置。\x3c\/p\x3e\n\x3ch4\x3ebefore send\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (ajaxBeforeSend(xhr, settings) === false) {\n  xhr.abort()\n  ajaxError(null, \x27abort\x27, xhr, settings, deferred)\n  return xhr\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (ajaxBeforeSend(xhr, settings) === \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e) {\n  xhr.abort()\n  ajaxError(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27abort\x27\x3c\/span\x3e, xhr, settings, deferred)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e xhr\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e调用 \x3ccode\x3eajaxBeforeSend\x3c\/code\x3e 方法，如果返回的为 \x3ccode\x3efalse\x3c\/code\x3e ，则中止 \x3ccode\x3eajax\x3c\/code\x3e 请求。\x3c\/p\x3e\n\x3ch4\x3e同步和异步请求的处理\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var async = \x27async\x27 in settings ? settings.async : true\nxhr.open(settings.type, settings.url, async, settings.username, settings.password)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27async\x27\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e settings ? settings.async : \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\nxhr.open(settings.type, settings.url, \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e, settings.username, settings.password)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果有配置 \x3ccode\x3easync\x3c\/code\x3e ，则采用配置中的值，否则，默认发送的是异步请求。\x3c\/p\x3e\n\x3cp\x3e接着调用 \x3ccode\x3eopen\x3c\/code\x3e 方法，创建一个请求。\x3c\/p\x3e\n\x3ch4\x3e创建请求后的配置\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (settings.xhrFields) for (name in settings.xhrFields) xhr[name] = settings.xhrFields[name]\n\nfor (name in headers) nativeSetHeader.apply(xhr, headers[name])\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings.xhrFields) \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (name \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e settings.xhrFields) xhr[name] = settings.xhrFields[name]\n\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (name \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e headers) nativeSetHeader.apply(xhr, headers[name])\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果有配置 \x3ccode\x3exhrFields\x3c\/code\x3e ，则遍历，设置对应的 \x3ccode\x3exhr\x3c\/code\x3e 属性。\x3c\/p\x3e\n\x3cp\x3e再遍历上面配置的 \x3ccode\x3eheaders\x3c\/code\x3e 对象，调用 \x3ccode\x3esetRequestHeader\x3c\/code\x3e 方法，设置请求头，注意这里的请求头必须要在 \x3ccode\x3eopen\x3c\/code\x3e 之后，在 \x3ccode\x3esend\x3c\/code\x3e 之前设置。\x3c\/p\x3e\n\x3ch4\x3e发送请求\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22xhr.send(settings.data ? settings.data : null)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3exhr.send(settings.data ? settings.data : \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e发送请求很简单，调用 \x3ccode\x3exhr.send\x3c\/code\x3e 方法，将配置中的数据传入即可。\x3c\/p\x3e\n\x3ch4\x3e请求响应成功后的处理\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22xhr.onreadystatechange = function(){\n  if (xhr.readyState == 4) {\n    xhr.onreadystatechange = empty\n    clearTimeout(abortTimeout)\n    var result, error = false\n    if ((xhr.status \x3e= 200 \x26amp;\x26amp; xhr.status \x3c 300) || xhr.status == 304 || (xhr.status == 0 \x26amp;\x26amp; protocol == \x27file:\x27)) {\n      dataType = dataType || mimeToDataType(settings.mimeType || xhr.getResponseHeader(\x27content-type\x27))\n\n      if (xhr.responseType == \x27arraybuffer\x27 || xhr.responseType == \x27blob\x27)\n        result = xhr.response\n      else {\n        result = xhr.responseText\n\n        try {\n          \/\/ http:\/\/perfectionkills.com\/global-eval-what-are-the-options\/\n          \/\/ sanitize response accordingly if data filter callback provided\n          result = ajaxDataFilter(result, dataType, settings)\n          if (dataType == \x27script\x27)    (1,eval)(result)\n          else if (dataType == \x27xml\x27)  result = xhr.responseXML\n          else if (dataType == \x27json\x27) result = blankRE.test(result) ? null : $.parseJSON(result)\n        } catch (e) { error = e }\n\n        if (error) return ajaxError(error, \x27parsererror\x27, xhr, settings, deferred)\n      }\n\n      ajaxSuccess(result, xhr, settings, deferred)\n    } else {\n      ajaxError(xhr.statusText || null, xhr.status ? \x27error\x27 : \x27abort\x27, xhr, settings, deferred)\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3exhr.onreadystatechange = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (xhr.readyState == \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e) {\n    xhr.onreadystatechange = empty\n    clearTimeout(abortTimeout)\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result, error = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((xhr.status \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e \x26amp;\x26amp; xhr.status \x26lt; \x3cspan class=\x22hljs-number\x22\x3e300\x3c\/span\x3e) || xhr.status == \x3cspan class=\x22hljs-number\x22\x3e304\x3c\/span\x3e || (xhr.status == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x26amp;\x26amp; protocol == \x3cspan class=\x22hljs-string\x22\x3e\x27file:\x27\x3c\/span\x3e)) {\n      dataType = dataType || mimeToDataType(settings.mimeType || xhr.getResponseHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27content-type\x27\x3c\/span\x3e))\n\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (xhr.responseType == \x3cspan class=\x22hljs-string\x22\x3e\x27arraybuffer\x27\x3c\/span\x3e || xhr.responseType == \x3cspan class=\x22hljs-string\x22\x3e\x27blob\x27\x3c\/span\x3e)\n        result = xhr.response\n      \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        result = xhr.responseText\n\n        \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ http:\/\/perfectionkills.com\/global-eval-what-are-the-options\/\x3c\/span\x3e\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ sanitize response accordingly if data filter callback provided\x3c\/span\x3e\n          result = ajaxDataFilter(result, dataType, settings)\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dataType == \x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e)    (\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3eeval\x3c\/span\x3e)(result)\n          \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dataType == \x3cspan class=\x22hljs-string\x22\x3e\x27xml\x27\x3c\/span\x3e)  result = xhr.responseXML\n          \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dataType == \x3cspan class=\x22hljs-string\x22\x3e\x27json\x27\x3c\/span\x3e) result = blankRE.test(result) ? \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e : $.parseJSON(result)\n        } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) { error = e }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (error) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e ajaxError(error, \x3cspan class=\x22hljs-string\x22\x3e\x27parsererror\x27\x3c\/span\x3e, xhr, settings, deferred)\n      }\n\n      ajaxSuccess(result, xhr, settings, deferred)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      ajaxError(xhr.statusText || \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, xhr.status ? \x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27abort\x27\x3c\/span\x3e, xhr, settings, deferred)\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3ereadyState\x3c\/h5\x3e\n\x3cp\x3e\x3ccode\x3ereadyState\x3c\/code\x3e 有以下5种状态，状态切换时，会响应 \x3ccode\x3eonreadystatechange\x3c\/code\x3e 的回调。\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e0\x3c\/th\x3e\n\x3cth\x3e\n\x3ccode\x3exhr\x3c\/code\x3e 实例已经创建，但是还没有调用 \x3ccode\x3eopen\x3c\/code\x3e 方法。\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e1\x3c\/td\x3e\n\x3ctd\x3e已经调用 \x3ccode\x3eopen\x3c\/code\x3e 方法\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e2\x3c\/td\x3e\n\x3ctd\x3e请求已经发送，可以获取响应头和状态 \x3ccode\x3estatus\x3c\/code\x3e\n\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e3\x3c\/td\x3e\n\x3ctd\x3e下载中，部分响应数据已经可以使用\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e4\x3c\/td\x3e\n\x3ctd\x3e请求完成\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e具体见 \x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/XMLHttpRequest\/readyState\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMDN:XMLHttpRequest.readyState\x3c\/a\x3e\x3c\/p\x3e\n\x3ch5\x3e清理工作\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22xhr.onreadystatechange = empty\nclearTimeout(abortTimeout)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3exhr.onreadystatechange = empty\nclearTimeout(abortTimeout)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当 \x3ccode\x3ereadyState\x3c\/code\x3e 变为 \x3ccode\x3e4\x3c\/code\x3e 时，表示请求完成（无论成功还是失败），这时需要将 \x3ccode\x3eonreadystatechange\x3c\/code\x3e 重新赋值为 \x3ccode\x3eempty\x3c\/code\x3e 函数，清除超时响应定时器，避免定时器超时的任务执行。\x3c\/p\x3e\n\x3ch5\x3e成功状态判断\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if ((xhr.status \x3e= 200 \x26amp;\x26amp; xhr.status \x3c 300) || xhr.status == 304 || (xhr.status == 0 \x26amp;\x26amp; protocol == \x27file:\x27)) {\n          ...\n   }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((xhr.status \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e \x26amp;\x26amp; xhr.status \x26lt; \x3cspan class=\x22hljs-number\x22\x3e300\x3c\/span\x3e) || xhr.status == \x3cspan class=\x22hljs-number\x22\x3e304\x3c\/span\x3e || (xhr.status == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x26amp;\x26amp; protocol == \x3cspan class=\x22hljs-string\x22\x3e\x27file:\x27\x3c\/span\x3e)) {\n          ...\n   }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里判断的是 \x3ccode\x3ehttp\x3c\/code\x3e 状态码，状态码的含义可以参考 \x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Status\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHTTP response status codes\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e解释一下最后这个条件 \x3ccode\x3exhr.status == 0 \x26amp;\x26amp; protocol == \x27file:\x27\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3estatus\x3c\/code\x3e 为 \x3ccode\x3e0\x3c\/code\x3e 时，表示请求并没有到达服务器，有几种情况会造成 \x3ccode\x3estatus\x3c\/code\x3e 为 \x3ccode\x3e0\x3c\/code\x3e 的情况，例如网络不通，不合法的跨域请求，防火墙拦截等。\x3c\/p\x3e\n\x3cp\x3e直接用本地文件的方式打开，也会出现  \x3ccode\x3estatus\x3c\/code\x3e 为 \x3ccode\x3e0\x3c\/code\x3e 的情况，但是我在 \x3ccode\x3echrome\x3c\/code\x3e 上测试，在这种情况下只能取到         \x3ccode\x3estatus\x3c\/code\x3e ， \x3ccode\x3eresponseType\x3c\/code\x3e 和 \x3ccode\x3eresponseText\x3c\/code\x3e 都取不到，不清楚这个用本地文件打开时，进入成功判断的目的何在。\x3c\/p\x3e\n\x3ch5\x3e处理数据\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22blankRE = \/^\\s*$\/,\n\ndataType = dataType || mimeToDataType(settings.mimeType || xhr.getResponseHeader(\x27content-type\x27))\nif (xhr.responseType == \x27arraybuffer\x27 || xhr.responseType == \x27blob\x27)\n  result = xhr.response\nelse {\n  result = xhr.responseText\n\n  try {\n    \/\/ http:\/\/perfectionkills.com\/global-eval-what-are-the-options\/\n    \/\/ sanitize response accordingly if data filter callback provided\n    result = ajaxDataFilter(result, dataType, settings)\n    if (dataType == \x27script\x27)    (1,eval)(result)\n    else if (dataType == \x27xml\x27)  result = xhr.responseXML\n    else if (dataType == \x27json\x27) result = blankRE.test(result) ? null : $.parseJSON(result)\n  } catch (e) { error = e }\n  if (error) return ajaxError(error, \x27parsererror\x27, xhr, settings, deferred)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eblankRE = \x3cspan class=\x22hljs-regexp\x22\x3e\/^\\s*$\/\x3c\/span\x3e,\n\ndataType = dataType || mimeToDataType(settings.mimeType || xhr.getResponseHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27content-type\x27\x3c\/span\x3e))\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (xhr.responseType == \x3cspan class=\x22hljs-string\x22\x3e\x27arraybuffer\x27\x3c\/span\x3e || xhr.responseType == \x3cspan class=\x22hljs-string\x22\x3e\x27blob\x27\x3c\/span\x3e)\n  result = xhr.response\n\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n  result = xhr.responseText\n\n  \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ http:\/\/perfectionkills.com\/global-eval-what-are-the-options\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ sanitize response accordingly if data filter callback provided\x3c\/span\x3e\n    result = ajaxDataFilter(result, dataType, settings)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dataType == \x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e)    (\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3eeval\x3c\/span\x3e)(result)\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dataType == \x3cspan class=\x22hljs-string\x22\x3e\x27xml\x27\x3c\/span\x3e)  result = xhr.responseXML\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dataType == \x3cspan class=\x22hljs-string\x22\x3e\x27json\x27\x3c\/span\x3e) result = blankRE.test(result) ? \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e : $.parseJSON(result)\n  } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) { error = e }\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (error) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e ajaxError(error, \x3cspan class=\x22hljs-string\x22\x3e\x27parsererror\x27\x3c\/span\x3e, xhr, settings, deferred)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e首先获取 \x3ccode\x3edataType\x3c\/code\x3e，后面会根据 \x3ccode\x3edataType\x3c\/code\x3e 来判断获得的数据类型，进而调用不同的方法来处理。\x3c\/p\x3e\n\x3cp\x3e如果数据为 \x3ccode\x3earraybuffer\x3c\/code\x3e 或 \x3ccode\x3eblob\x3c\/code\x3e 对象时，即为二进制数据时，\x3ccode\x3eresult\x3c\/code\x3e 从 \x3ccode\x3eresponse\x3c\/code\x3e 中直接取得。\x3c\/p\x3e\n\x3cp\x3e否则，用 \x3ccode\x3eresponseText\x3c\/code\x3e 获取数据，然后再对数据尝试解释。\x3c\/p\x3e\n\x3cp\x3e在解释数据前，调用 \x3ccode\x3eajaxDataFilter\x3c\/code\x3e 对数据进行过滤。\x3c\/p\x3e\n\x3cp\x3e如果数据类型为 \x3ccode\x3escript\x3c\/code\x3e ，则使用 \x3ccode\x3eeval\x3c\/code\x3e 方法，执行返回的 \x3ccode\x3escript\x3c\/code\x3e 内容。\x3c\/p\x3e\n\x3cp\x3e这里为什么用 \x3ccode\x3e(1, eval)\x3c\/code\x3e ，而不是直接用 \x3ccode\x3eeval\x3c\/code\x3e 呢，是为了确保 \x3ccode\x3eeval\x3c\/code\x3e 执行的作用域是在 \x3ccode\x3ewindow\x3c\/code\x3e 下。具体参考：\x3ca href=\x22https:\/\/stackoverflow.com\/questions\/9107240\/1-evalthis-vs-evalthis-in-javascript\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e(1,eval)(\x27this\x27) vs eval(\x27this\x27) in JavaScript?\x3c\/a\x3e 和 《\x3ca href=\x22http:\/\/perfectionkills.com\/global-eval-what-are-the-options\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGlobal eval. What are the options?\x3c\/a\x3e》\x3c\/p\x3e\n\x3cp\x3e如果 \x3ccode\x3edataType\x3c\/code\x3e 为 \x3ccode\x3exml\x3c\/code\x3e ，则调用\x3ccode\x3eresponseXML\x3c\/code\x3e 方法\x3c\/p\x3e\n\x3cp\x3e如果为 \x3ccode\x3ejson\x3c\/code\x3e ，返回的内容为空时，结果返回 \x3ccode\x3enull\x3c\/code\x3e ，如果不为空，调用 \x3ccode\x3e$.parseJSON\x3c\/code\x3e 方法，格式化为 \x3ccode\x3ejson\x3c\/code\x3e 格式。相关分析见《\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/4143f028beff94ce3834e41620fdea48b764301c\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0.md#parsejson\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读zepto源码之工具函数\x3c\/a\x3e》\x3c\/p\x3e\n\x3cp\x3e如果解释出错了，则调用 \x3ccode\x3eajaxError\x3c\/code\x3e 方法，触发 \x3ccode\x3eajaxError\x3c\/code\x3e 事件，事件类型为 \x3ccode\x3eparseerror\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果都成功了，则调用  \x3ccode\x3eajaxSuccess\x3c\/code\x3e 方法，执行成功回调。\x3c\/p\x3e\n\x3ch5\x3e响应出错\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22ajaxError(xhr.statusText || null, xhr.status ? \x27error\x27 : \x27abort\x27, xhr, settings, deferred)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3eajaxError(xhr.statusText || \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, xhr.status ? \x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27abort\x27\x3c\/span\x3e, xhr, settings, deferred)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果 \x3ccode\x3estatus\x3c\/code\x3e 不在成功的范围内，则调用 \x3ccode\x3eajaxError\x3c\/code\x3e 方法，触发 \x3ccode\x3eajaxError\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3ch4\x3e响应超时\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (settings.timeout \x3e 0) abortTimeout = setTimeout(function(){\n  xhr.onreadystatechange = empty\n  xhr.abort()\n  ajaxError(null, \x27timeout\x27, xhr, settings, deferred)\n}, settings.timeout)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (settings.timeout \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) abortTimeout = setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  xhr.onreadystatechange = empty\n  xhr.abort()\n  ajaxError(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27timeout\x27\x3c\/span\x3e, xhr, settings, deferred)\n}, settings.timeout)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果有设置超时时间，则设置一个定时器，超时时，首先要将 \x3ccode\x3eonreadystatechange\x3c\/code\x3e 的回调设置为空函数 \x3ccode\x3eempty\x3c\/code\x3e ，避免超时响应执行完毕后，请求完成，再次执行成功回调。\x3c\/p\x3e\n\x3cp\x3e然后调用 \x3ccode\x3exhr.abort\x3c\/code\x3e 方法，取消请求的发送，并且调用 \x3ccode\x3eajaxError\x3c\/code\x3e 方法，触发 \x3ccode\x3eajaxError\x3c\/code\x3e 事件。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader25\x22\x3e$.get\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$.get = function(\/* url, data, success, dataType *\/){\n  return $.ajax(parseArguments.apply(null, arguments))\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$.get = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-regexp\x22\x3e\/* url, data, success, dataType *\/\x3c\/span\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $.ajax(parseArguments.apply(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e))\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3e$.get\x3c\/code\x3e 是 \x3ccode\x3e$.ajax\x3c\/code\x3e \x3ccode\x3eGET\x3c\/code\x3e 请求的便捷方法，内部调用了 \x3ccode\x3e$.ajax\x3c\/code\x3e ，不需要指定请求类型。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader26\x22\x3e$.post\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$.post = function(\/* url, data, success, dataType *\/){\n  var options = parseArguments.apply(null, arguments)\n  options.type = \x27POST\x27\n  return $.ajax(options)\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$.post = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-regexp\x22\x3e\/* url, data, success, dataType *\/\x3c\/span\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e options = parseArguments.apply(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e)\n  options.type = \x3cspan class=\x22hljs-string\x22\x3e\x27POST\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $.ajax(options)\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3e$.post\x3c\/code\x3e 是 \x3ccode\x3e$.ajax\x3c\/code\x3e \x3ccode\x3ePOST\x3c\/code\x3e 请求的便捷方法，跟 \x3ccode\x3e$.get\x3c\/code\x3e 一样，只开放了 \x3ccode\x3eurl\x3c\/code\x3e、\x3ccode\x3edata\x3c\/code\x3e 、\x3ccode\x3esuccess\x3c\/code\x3e 和 \x3ccode\x3edataType\x3c\/code\x3e 等几个接口参数，默认配置了 \x3ccode\x3etype\x3c\/code\x3e 为 \x3ccode\x3ePOST\x3c\/code\x3e 请求。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader27\x22\x3e$.getJSON\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$.getJSON = function(\/* url, data, success *\/){\n  var options = parseArguments.apply(null, arguments)\n  options.dataType = \x27json\x27\n  return $.ajax(options)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$.getJSON = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-regexp\x22\x3e\/* url, data, success *\/\x3c\/span\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e options = parseArguments.apply(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e)\n  options.dataType = \x3cspan class=\x22hljs-string\x22\x3e\x27json\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $.ajax(options)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3e$.getJSON\x3c\/code\x3e 跟 \x3ccode\x3e$.get\x3c\/code\x3e 差不多，比 \x3ccode\x3e$.get\x3c\/code\x3e 更省了一个 \x3ccode\x3edataType\x3c\/code\x3e 的参数，这里指定了 \x3ccode\x3edataType\x3c\/code\x3e 为 \x3ccode\x3ejson\x3c\/code\x3e 类型。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader28\x22\x3e$.fn.load\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$.fn.load = function(url, data, success){\n  if (!this.length) return this\n  var self = this, parts = url.split(\/\\s\/), selector,\n      options = parseArguments(url, data, success),\n      callback = options.success\n  if (parts.length \x3e 1) options.url = parts[0], selector = parts[1]\n  options.success = function(response){\n    self.html(selector ?\n              $(\x27\x3cdiv\x3e\x27).html(response.replace(rscript, \x26quot;\x26quot;)).find(selector)\n              : response)\n    callback \x26amp;\x26amp; callback.apply(self, arguments)\n  }\n  $.ajax(options)\n  return this\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$.fn.load = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, data, success\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.length) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, parts = url.split(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\s\/\x3c\/span\x3e), selector,\n      options = parseArguments(url, data, success),\n      callback = options.success\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (parts.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) options.url = parts[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e], selector = parts[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n  options.success = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e)\x3c\/span\x3e{\n    self.html(selector ?\n              $(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;div\x26gt;\x27\x3c\/span\x3e).html(response.replace(rscript, \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e)).find(selector)\n              : response)\n    callback \x26amp;\x26amp; callback.apply(self, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e)\n  }\n  $.ajax(options)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eload\x3c\/code\x3e 方法是用 \x3ccode\x3eajax\x3c\/code\x3e 的方式，请求一个 \x3ccode\x3ehtml\x3c\/code\x3e 文件，并将请求的文件插入到页面中。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eurl\x3c\/code\x3e 可以指定选择符，选择符用空格分割，如果有指定选择符，则只将匹配选择符的文档插入到页面中。\x3ccode\x3eurl\x3c\/code\x3e 的格式为 \x3ccode\x3e请求地址 选择符\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var self = this, parts = url.split(\/\\s\/), selector,\n   options = parseArguments(url, data, success),\n   callback = options.success\nif (parts.length \x3e 1) options.url = parts[0], selector = parts[1]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, parts = url.split(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\s\/\x3c\/span\x3e), selector,\n   options = parseArguments(url, data, success),\n   callback = options.success\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (parts.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) options.url = parts[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e], selector = parts[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eparts\x3c\/code\x3e 是用空格分割后的结果，如果有选择符，则 \x3ccode\x3elength\x3c\/code\x3e 会大于 \x3ccode\x3e1\x3c\/code\x3e，数组的第一项为请求地址，第二项为选择符。\x3c\/p\x3e\n\x3cp\x3e调用 \x3ccode\x3eparseArguments\x3c\/code\x3e 用来重新调整参数，因为 \x3ccode\x3edata\x3c\/code\x3e 和 \x3ccode\x3esuccess\x3c\/code\x3e 都是可选的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22options.success = function(response){\n  self.html(selector ?\n            $(\x27\x3cdiv\x3e\x27).html(response.replace(rscript, \x26quot;\x26quot;)).find(selector)\n            : response)\n  callback \x26amp;\x26amp; callback.apply(self, arguments)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eoptions.success = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e)\x3c\/span\x3e{\n  self.html(selector ?\n            $(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;div\x26gt;\x27\x3c\/span\x3e).html(response.replace(rscript, \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e)).find(selector)\n            : response)\n  callback \x26amp;\x26amp; callback.apply(self, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e请求成功后，如果有 \x3ccode\x3eselector\x3c\/code\x3e ，则从文档中筛选符合的文档插入页面，否则，将返回的文档全部插入页面。\x3c\/p\x3e\n\x3cp\x3e如果有配置回调函数，则执行回调。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader29\x22\x3e系列文章\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之代码结构\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E5%86%85%E9%83%A8%E6%96%B9%E6%B3%95.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读 Zepto 源码之内部方法\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/a4d6ad99c57047beae2b652b4d2cbb380599a524\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之工具函数\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E7%A5%9E%E5%A5%87%E7%9A%84%24.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之神奇的$\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之集合操作\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E9%9B%86%E5%90%88%E5%85%83%E7%B4%A0%E6%9F%A5%E6%89%BE.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之集合元素查找\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E6%93%8D%E4%BD%9CDOM.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之操作DOM\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E6%A0%B7%E5%BC%8F%E6%93%8D%E4%BD%9C.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之样式操作\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8B%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之属性操作\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BEvent%E6%A8%A1%E5%9D%97.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之Event模块\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BIE%E6%A8%A1%E5%9D%97.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之IE模块\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BCallbacks%E6%A8%A1%E5%9D%97.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之Callbacks模块\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/yeyuqiudeng\/reading-zepto\/blob\/master\/src\/%E8%AF%BBZepto%E6%BA%90%E7%A0%81%E4%B9%8BDeferred%E6%A8%A1%E5%9D%97.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读Zepto源码之Deferred模块\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader30\x22\x3e参考\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/mominger\/p\/4398982.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eZepto源码分析-ajax模块\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/ysha.me\/2016\/07\/19\/07-19-%E8%AF%BBzepto%E6%BA%90%E7%A0%81%EF%BC%883%EF%BC%89ajax\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e读zepto源码（3) ajax\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000004322487\x22\x3e你真的会使用XMLHttpRequest吗？\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/juejin.im\/post\/593d7f0a128fe1006aea235f\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e原来你是这样的 jsonp(原理与具体实现细节)\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/BlackStorm\/p\/Zepto-Analysing-For-Ajax-Module.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e一个普通的 Zepto 源码分析（二） - ajax 模块\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/XMLHttpRequest\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMDN:XMLHttpRequest\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/fetch.spec.whatwg.org\/#responses\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3efetch.spec.whatwg.org\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/stackoverflow.com\/questions\/872206\/http-status-code-0-what-does-this-mean-for-fetch-or-xmlhttprequest\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHTTP status code 0 - what does this mean for fetch, or XMLHttpRequest?\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/stackoverflow.com\/questions\/9107240\/1-evalthis-vs-evalthis-in-javascript\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e(1,eval)(\x27this\x27) vs eval(\x27this\x27) in JavaScript?\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/perfectionkills.com\/global-eval-what-are-the-options\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGlobal eval. What are the options?\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader31\x22\x3eLicense\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/creativecommons.org\/licenses\/by-nc-nd\/4.0\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009502046\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009502046\x22 alt=\x22License: CC BY-NC-ND 4.0\x22 title=\x22License: CC BY-NC-ND 4.0\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e最后，所有文章都会同步发送到微信公众号上，欢迎关注,欢迎提意见：  \x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009735938?w=430\x26amp;h=430\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009735938?w=430\x26amp;h=430\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e作者：对角另一面\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>读Zepto源码之Ajax模块</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010879529">https://segmentfault.com/a/1190000010879529</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/2scu7p55bb9/" target="_blank">https://alili.tech/archive/2scu7p55bb9/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>