<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Collapse组件(一) collapse过渡动画"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Collapse组件(一) collapse过渡动画 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/377yv32o9n5/",
				"appid": "1613049289050283", 
				"title": "Collapse组件(一) collapse过渡动画 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-08T02:30:30"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/tntftc2032/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/5byslhnyr4h/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f377yv32o9n5%2f&text=Collapse%e7%bb%84%e4%bb%b6%28%e4%b8%80%29%20collapse%e8%bf%87%e6%b8%a1%e5%8a%a8%e7%94%bb"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f377yv32o9n5%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f377yv32o9n5%2f&text=Collapse%e7%bb%84%e4%bb%b6%28%e4%b8%80%29%20collapse%e8%bf%87%e6%b8%a1%e5%8a%a8%e7%94%bb"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f377yv32o9n5%2f&title=Collapse%e7%bb%84%e4%bb%b6%28%e4%b8%80%29%20collapse%e8%bf%87%e6%b8%a1%e5%8a%a8%e7%94%bb"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f377yv32o9n5%2f&is_video=false&description=Collapse%e7%bb%84%e4%bb%b6%28%e4%b8%80%29%20collapse%e8%bf%87%e6%b8%a1%e5%8a%a8%e7%94%bb"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Collapse%e7%bb%84%e4%bb%b6%28%e4%b8%80%29%20collapse%e8%bf%87%e6%b8%a1%e5%8a%a8%e7%94%bb&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f377yv32o9n5%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f377yv32o9n5%2f&title=Collapse%e7%bb%84%e4%bb%b6%28%e4%b8%80%29%20collapse%e8%bf%87%e6%b8%a1%e5%8a%a8%e7%94%bb"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f377yv32o9n5%2f&title=Collapse%e7%bb%84%e4%bb%b6%28%e4%b8%80%29%20collapse%e8%bf%87%e6%b8%a1%e5%8a%a8%e7%94%bb"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f377yv32o9n5%2f&title=Collapse%e7%bb%84%e4%bb%b6%28%e4%b8%80%29%20collapse%e8%bf%87%e6%b8%a1%e5%8a%a8%e7%94%bb"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f377yv32o9n5%2f&title=Collapse%e7%bb%84%e4%bb%b6%28%e4%b8%80%29%20collapse%e8%bf%87%e6%b8%a1%e5%8a%a8%e7%94%bb"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Collapse组件(一) collapse过渡动画</h1><div class="meta"><div class="postdate"><time datetime="2018-12-08" itemprop="datePublished">2018-12-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cstrong\x3eCollapse组件\x3c\/strong\x3e在做内容折叠与展开显示的时候，还是用到很多的。这一个组件的内容相对于\x3cstrong\x3eBadge\x3c\/strong\x3e和\x3cstrong\x3eTag组件\x3c\/strong\x3e更多一点，所以打算分成三篇文章来讲。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV7cqP?w=456\x26amp;h=278\x22 src=\x22https:\/\/static.alili.tech\/img\/bV7cqP?w=456\x26amp;h=278\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e高度不固定的css动画\x3c\/h2\x3e\n\x3cp\x3e第一篇先来讲一讲对于高度不确定的元素，怎么做高度的展开动画效果。\x3c\/p\x3e\n\x3cp\x3e看一下大佬对\x3ccode\x3etransition为什么不能对height：auto实现过渡动画\x3c\/code\x3e的解释：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV7dEz?w=684\x26amp;h=423\x22 src=\x22https:\/\/static.alili.tech\/img\/bV7dEz?w=684\x26amp;h=423\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这里贴一个css trick上对于这种问题的解决方案：\x3ca href=\x22https:\/\/css-tricks.com\/using-css-transitions-auto-dimensions\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eUsing CSS Transitions on Auto Dimensions\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e说一下在element-ui中的实现思路吧:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e通过transition的钩子函数 \x2b render渲染函数，我们来自定义一个过渡效果，由JS来掌控变化的值\x3c\/li\x3e\n\x3cli\x3e展开时，height从\x3ccode\x3e 0 逐步增大到 scrollHeight\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e收缩时，height从\x3ccode\x3e scrollHeight 逐步减小到 0\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e过渡动画最终实现效果\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/jsfiddle.net\/huang_jusheng\/ov3rvppd\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/jsfiddle.net\/huang_ju...\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22huang_jusheng\/ov3rvppd\/\x22 data-typeid=\x220\x22\x3e点击预览\x3c\/button\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3escrollHeight, paddingSize\x3c\/h2\x3e\n\x3cp\x3e通过自适应文本高度的输入框那篇文章，我们已经了解到scrollHeight的高度是包含了padding的，所以\x3ccode\x3e在这里的动画时，需要对padding-top，padding-bottom，height三个属性都做变化。\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e其次，对于展开时高度的值，需要scrollHeight - paddingSize\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let Transition =  {\n  beforeEnter(el){\n        if(!el.dataset) el.dataset = {};\n        let styles = window.getComputedStyle(el);\n        \/\/ 记录展开前的属性值\n        el.dataset.oldOverflow = styles.getPropertyValue(\x27overflow\x27);\n        el.dataset.oldPaddingTop = styles.getPropertyValue(\x27padding-top\x27);\n        el.dataset.oldPaddingBottom = styles.getPropertyValue(\x27padding-bottom\x27);\n        \/\/ 这三个都为0，scrollHeight的高度就是真实的内容高度了\n        el.style.height = 0;\n        el.style.paddingTop = 0;\n        el.style.paddingBottom = 0;\n        el.classList.add(\x27collapse-transition\x27);\n        el.style.overflow = \x27hidden\x27;\n  },\n\n  enter(el) {\n        if(el.scrollHeight !== 0) {\n            \/\/ 动画过程中，逐渐增大到展开前应占的高度值\n            el.style.height = el.scrollHeight \x2b \x27px\x27;\n            el.style.paddingTop = el.dataset.oldPaddingTop;\n            el.style.paddingBottom = el.dataset.oldPaddingBottom;\n        }\n  },\n\n  afterEnter(el) {\n        el.classList.remove(\x27collapse-transition\x27);\n        el.style.height = \x27\x27;\n        el.style.overflow = el.dataset.oldOverflow;\n  }\n\n  \/\/ ....\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e Transition =  {\n  beforeEnter(el){\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!el.dataset) el.dataset = {};\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e styles = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.getComputedStyle(el);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 记录展开前的属性值\x3c\/span\x3e\n        el.dataset.oldOverflow = styles.getPropertyValue(\x3cspan class=\x22hljs-string\x22\x3e\x27overflow\x27\x3c\/span\x3e);\n        el.dataset.oldPaddingTop = styles.getPropertyValue(\x3cspan class=\x22hljs-string\x22\x3e\x27padding-top\x27\x3c\/span\x3e);\n        el.dataset.oldPaddingBottom = styles.getPropertyValue(\x3cspan class=\x22hljs-string\x22\x3e\x27padding-bottom\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这三个都为0，scrollHeight的高度就是真实的内容高度了\x3c\/span\x3e\n        el.style.height = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        el.style.paddingTop = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        el.style.paddingBottom = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        el.classList.add(\x3cspan class=\x22hljs-string\x22\x3e\x27collapse-transition\x27\x3c\/span\x3e);\n        el.style.overflow = \x3cspan class=\x22hljs-string\x22\x3e\x27hidden\x27\x3c\/span\x3e;\n  },\n\n  enter(el) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(el.scrollHeight !== \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 动画过程中，逐渐增大到展开前应占的高度值\x3c\/span\x3e\n            el.style.height = el.scrollHeight \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n            el.style.paddingTop = el.dataset.oldPaddingTop;\n            el.style.paddingBottom = el.dataset.oldPaddingBottom;\n        }\n  },\n\n  afterEnter(el) {\n        el.classList.remove(\x3cspan class=\x22hljs-string\x22\x3e\x27collapse-transition\x27\x3c\/span\x3e);\n        el.style.height = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n        el.style.overflow = el.dataset.oldOverflow;\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ....\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e重绘与重排\x3c\/h2\x3e\n\x3cp\x3e观察jsfiddle的demo示例代码，会发现这句\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let Transition =  {\n  \/\/ ...\n  leave(el) {\n    if (el.scrollHeight !== 0) {\n        el.style.height = 0;\n        el.style.paddingTop = 0;\n        el.style.paddingBottom = 0;\n    }\n  }\n  \/\/ ...\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3elet Transition =  {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n  leave(el) {\n    if (el.scrollHeight !== \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        el.style.height = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        el.style.paddingTop = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        el.style.paddingBottom = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    }\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3e为什么要加el.scrollHeight !== 0的判断呢？\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e试一下，如果不加这个判断，直接变化height,paddingTop,paddingBottom的值到0，这个时候，收缩时并不会有过渡动画，元素马上就消失了。\x3c\/p\x3e\n\x3cp\x3e我们可以替换一下上面的代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let Transition =  {\n  \/\/ ...\n  leave(el) {\n    setTimeout(() =\x3e {\n        el.style.height = 0;\n        el.style.paddingTop = 0;\n        el.style.paddingBottom = 0;\n    }, 20)\n  }\n  \/\/ ...\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3elet Transition =  {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n  leave(el) {\n    setTimeout(() =\x26gt; {\n        el.style.height = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        el.style.paddingTop = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        el.style.paddingBottom = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    }, \x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e)\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这时候，收缩也会有过渡动画。但当我们尝试将延迟时间改为0的时候，并无效，延迟时间需要大于0才会有过渡效果。所以，这个过渡动画似乎和执行队列就没什么关联了。\x3c\/p\x3e\n\x3cp\x3e接下来，\x3ccode\x3e我们把目标锁定在了重绘和重排上。\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e着重看一下大佬的这篇文章：\x3ca href=\x22http:\/\/www.cnblogs.com\/zichi\/p\/4720000.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e高性能JavaScript 重排与重绘\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e1.\x3cstrong\x3e什么是重排和重绘\x3c\/strong\x3e\x3cbr\x3e浏览器解析页面生成\x3ccode\x3eDOM树\x3c\/code\x3e和\x3ccode\x3e渲染树\x3c\/code\x3e，DOM树表示节点结构，渲染树表示节点如何显示。\x3cbr\x3eDOM树节点的属性发生变化时，浏览器可能会重新计算去绘制渲染树，这个过程叫\x3ccode\x3e重排\x3c\/code\x3e，渲染树映射到屏幕上显示的过程就叫\x3ccode\x3e重绘\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e2.\x3cstrong\x3e重排什么时候发生\x3c\/strong\x3e\x3cbr\x3e\x3ccode\x3e每次重排，必然会导致重绘，那么，重排会在哪些情况下发生？\x3c\/code\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e添加或者删除可见的DOM元素\x3c\/li\x3e\n\x3cli\x3e元素位置改变\x3c\/li\x3e\n\x3cli\x3e元素尺寸改变\x3c\/li\x3e\n\x3cli\x3e元素内容改变（例如：一个文本被另一个不同尺寸的图片替代）\x3c\/li\x3e\n\x3cli\x3e页面渲染初始化（这个无法避免）\x3c\/li\x3e\n\x3cli\x3e浏览器窗口尺寸改变\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3ccode\x3e可以总结为，当一个节点的位置、大小、内容发生改变，或者增删节点的情况下会发生重排。\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e3.\x3cstrong\x3e渲染树变化的排队和刷新\x3c\/strong\x3e\x3cbr\x3e\x3ccode\x3e浏览器会把多次对节点的修改“保存”起来（大多数浏览器通过队列化修改并批量执行来优化重排过程），最终一次完成！但是，有些时候你可能会（经常是不知不觉）强制刷新队列并要求计划任务立即执行\x3c\/code\x3e。获取布局信息的操作会导致队列刷新，比如：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3eoffsetTop, offsetLeft, offsetWidth, offsetHeight（节点位置）\x3c\/li\x3e\n\x3cli\x3escrollTop, scrollLeft, scrollWidth, scrollHeight（节点位置、大小）\x3c\/li\x3e\n\x3cli\x3eclientTop, clientLeft, clientWidth, clientHeight（节点大小）\x3c\/li\x3e\n\x3cli\x3egetComputedStyle() (currentStyle in IE)（节点样式）\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e可以这么理解，要获取这些值，浏览器就需要把前面缓存的重排操作先给执行了，才能计算最新的，正确的节点信息。而这种中断，打断了浏览器自身对于重排的优化，是需要我们避免的。\x3c\/p\x3e\n\x3cp\x3e4.\x3cstrong\x3e最小化重排和重绘\x3c\/strong\x3e\x3cbr\x3e虽然浏览器对重排进行了优化，但我们不经意的操作会打断这种优化。所以，修改样式信息时，尽量集中操作\x3c\/p\x3e\n\x3cp\x3e5.\x3cstrong\x3efragment元素的应用\x3c\/strong\x3e\x3cbr\x3e\x3ccode\x3e前面说了，重排大多数都是由于节点位置、大小，增删造成的。节点位置，大小的改变我们可以通过集中操作来规范以优化性能。而对于节点的增删就可以通过fragment元素，来避免频繁的重排和重绘了\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3e尽量不要在布局信息改变时做查询（会导致渲染队列强制刷新）\x3c\/code\x3e\x3cbr\x3e\x3ccode\x3e同一个DOM的多个属性改变可以写在一起（减少DOM访问，同时把强制渲染队列刷新的风险降为0）\x3c\/code\x3e\x3cbr\x3e\x3ccode\x3e如果要批量添加DOM，可以先让元素脱离文档流，操作完后再带入文档流，这样只会触发一次重排（fragment元素的应用）\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e我们再看一下出问题的这段代码，如果不加scrollHeight的时候：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let Transition =  {\n  \/\/ ...\n  beforeLeave(el) {\n    \/\/ ...\n    el.style.height = el.scrollHeight - parseFloat(el.dataset.oldPaddingTop) - parseFloat(el.dataset.oldPaddingBottom) \x2b \x27px\x27;\n    el.style.overflow = \x27hidden\x27;\n    el.classList.add(\x27collapse-transition\x27);\n        \n    \/\/var tmp = el.offsetTop;\n  },\n\n  leave(el) {\n    el.style.height = 0;\n    el.style.paddingTop = 0;\n    el.style.paddingBottom = 0;\n  },\n\n  afterLeave(el) {\n    \/\/...\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs arduino\x22\x3e\x3ccode\x3elet Transition =  {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n  beforeLeave(el) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    el.style.\x3cspan class=\x22hljs-built_in\x22\x3eheight\x3c\/span\x3e = el.scrollHeight - \x3cspan class=\x22hljs-built_in\x22\x3eparseFloat\x3c\/span\x3e(el.dataset.oldPaddingTop) - \x3cspan class=\x22hljs-built_in\x22\x3eparseFloat\x3c\/span\x3e(el.dataset.oldPaddingBottom) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n    el.style.\x3cspan class=\x22hljs-built_in\x22\x3eoverflow\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27hidden\x27\x3c\/span\x3e;\n    el.classList.add(\x3cspan class=\x22hljs-string\x22\x3e\x27collapse-transition\x27\x3c\/span\x3e);\n        \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/var tmp = el.offsetTop;\x3c\/span\x3e\n  },\n\n  leave(el) {\n    el.style.\x3cspan class=\x22hljs-built_in\x22\x3eheight\x3c\/span\x3e = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    el.style.paddingTop = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    el.style.paddingBottom = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n  },\n\n  afterLeave(el) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们进行了一系列操作，浏览器缓存了这几次的重排。等到主线程结束，开始渲染的时候，直接就往下一直渲染到了height:0;这句。所以就没有了过渡动画。\x3cbr\x3e而加上大于零的定时器，应该是由于，1.先运行js主线程。2.执行重排重绘。3.执行定时回调，变化height的值\x3c\/p\x3e\n\x3cp\x3e可以试下，讲注释的这行代码（var tmp = el.offsetTop;）加入，也有过渡动画效果。\x3cbr\x3e结合上面对重排和重绘的学习，可以很容易的理解到：这一句代码强制刷新了重排的队列。让前面设置的属性，增加的过渡效果的类名。让它先渲染好，然后运行到leave函数的时候，再变化高度值，transition就起作用了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e通过过渡效果的实现：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e学到了一种新的思路，如果利用render\x2btransition钩子函数，自己生成一个JS掌控的transition\x3c\/li\x3e\n\x3cli\x3e重排与重绘对于性能的影响，以及编程中需要注意的点\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e参考文章：\x3c\/strong\x3e\x3cbr\x3e1.\x3ca href=\x22https:\/\/css-tricks.com\/using-css-transitions-auto-dimensions\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eUsing CSS Transitions on Auto Dimensions\x3c\/a\x3e\x3cbr\x3e2.\x3ca href=\x22https:\/\/www.zhihu.com\/question\/35991373\/answer\/130256417\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecss3怎么实现高度从固定到自动的过渡动画？\x3c\/a\x3e\x3cbr\x3e3.\x3ca href=\x22http:\/\/www.cnblogs.com\/zichi\/p\/4720000.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e高性能JavaScript 重排与重绘\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Collapse组件(一) collapse过渡动画</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014075248">https://segmentfault.com/a/1190000014075248</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/377yv32o9n5/" target="_blank">https://alili.tech/archive/377yv32o9n5/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>