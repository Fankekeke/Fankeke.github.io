<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="页面生命周期：DOMContentLoaded, load, beforeunload, unload"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>页面生命周期：DOMContentLoaded, load, beforeunload, unload | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/3hj8boa8qn4/",
				"appid": "1613049289050283", 
				"title": "页面生命周期：DOMContentLoaded, load, beforeunload, unload | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-29T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/94pxxd0te57/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/5ftt1g97bub/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f3hj8boa8qn4%2f&text=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%ef%bc%9aDOMContentLoaded%2c%20load%2c%20beforeunload%2c%20unload"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f3hj8boa8qn4%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f3hj8boa8qn4%2f&text=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%ef%bc%9aDOMContentLoaded%2c%20load%2c%20beforeunload%2c%20unload"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f3hj8boa8qn4%2f&title=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%ef%bc%9aDOMContentLoaded%2c%20load%2c%20beforeunload%2c%20unload"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f3hj8boa8qn4%2f&is_video=false&description=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%ef%bc%9aDOMContentLoaded%2c%20load%2c%20beforeunload%2c%20unload"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%ef%bc%9aDOMContentLoaded%2c%20load%2c%20beforeunload%2c%20unload&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f3hj8boa8qn4%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f3hj8boa8qn4%2f&title=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%ef%bc%9aDOMContentLoaded%2c%20load%2c%20beforeunload%2c%20unload"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3hj8boa8qn4%2f&title=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%ef%bc%9aDOMContentLoaded%2c%20load%2c%20beforeunload%2c%20unload"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3hj8boa8qn4%2f&title=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%ef%bc%9aDOMContentLoaded%2c%20load%2c%20beforeunload%2c%20unload"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3hj8boa8qn4%2f&title=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%ef%bc%9aDOMContentLoaded%2c%20load%2c%20beforeunload%2c%20unload"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">页面生命周期：DOMContentLoaded, load, beforeunload, unload</h1><div class="meta"><div class="postdate"><time datetime="2018-12-29" itemprop="datePublished">2018-12-29</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1\x3e页面生命周期：DOMContentLoaded, load, beforeunload, unload\x3c\/h1\x3e\n\x3cp\x3e原文地址：\x3ca href=\x22http:\/\/javascript.info\/onload-ondomcontentloaded\x22 rel=\x22nofollow noreferrer\x22\x3ehttp:\/\/javascript.info\/onload...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3eHTML页面的生命周期有以下三个重要事件：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e — 浏览器已经完全加载了HTML，DOM树已经构建完毕，但是像是  \x3ccode\x3e\x26lt;img\x26gt;\x3c\/code\x3e 和样式表等外部资源可能并没有下载完毕。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eload\x3c\/code\x3e — 浏览器已经加载了所有的资源（图像，样式表等）。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ebeforeunload\/unload\x3c\/code\x3e -- 当用户离开页面的时候触发。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e每个事件都有特定的用途\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e -- DOM加载完毕，所以js可以访问所有DOM节点，初始化界面。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eload\x3c\/code\x3e -- 附加资源已经加载完毕，可以在此事件触发时获得图像的大小（如果没有被在HTML\/CSS中指定）\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ebeforeunload\/unload\x3c\/code\x3e -- 用户正在离开页面：可以询问用户是否保存了更改以及是否确定要离开页面。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e来看一下每个事件的细节。\x3c\/p\x3e\n\x3ch2\x3eDOMContentLoaded\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e 由 \x3ccode\x3edocument\x3c\/code\x3e 对象触发。\x3c\/p\x3e\n\x3cp\x3e我们使用 \x3ccode\x3eaddEventListener\x3c\/code\x3e 来监听它：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3edocument.addEventListener(\x22DOMContentLoaded\x22, ready);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e举个例子\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22html\x22\x3e\x26lt;script\x26gt;\n  function ready() {\n    alert(\x27DOM is ready\x27);\n\n    \/\/ image is not yet loaded (unless was cached), so the size is 0x0\n    alert(`Image size: ${img.offsetWidth}x${img.offsetHeight}`);\n  }\n\n  document.addEventListener(\x22DOMContentLoaded\x22, ready);\n\x26lt;\/script\x26gt;\n\n\x26lt;img id=\x22img\x22 src=\x22https:\/\/en.js.cx\/clipart\/train.gif?speed=1\x26amp;cache=0\x22\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这个例子中 \x3ccode\x3eDOMContentLoaded\x3c\/code\x3e在document加载完成后就被触发，无需等待其他资源的载入，所以\x3ccode\x3ealert\x3c\/code\x3e输出的图像的大小为0。\x3c\/p\x3e\n\x3cp\x3e这么看来\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e 似乎很简单，DOM树构建完毕之后就运行该事件，不过其实存在一些陷阱。\x3c\/p\x3e\n\x3ch3\x3eDOMContentLoaded 和脚本\x3c\/h3\x3e\n\x3cp\x3e当浏览器在解析HTML页面时遇到了 \x3ccode\x3e\x26lt;script\x26gt;...\x26lt;\/script\x26gt;\x3c\/code\x3e 标签，将无法继续构建DOM树（译注：UI渲染线程与JS引擎是互斥的，当JS引擎执行时UI线程会被挂起），必须立即执行脚本。所以 \x3ccode\x3eDOMContentLoaded\x3c\/code\x3e 有可能在所有脚本执行完毕后触发。\x3c\/p\x3e\n\x3cp\x3e外部脚本（带\x3ccode\x3esrc\x3c\/code\x3e的）的加载和解析也会暂停DOM树构建，所以 \x3ccode\x3eDOMContentLoaded\x3c\/code\x3e 也会等待外部脚本。\x3c\/p\x3e\n\x3cp\x3e不过有两个例外是带\x3ccode\x3easync\x3c\/code\x3e和\x3ccode\x3edefer\x3c\/code\x3e的外部脚本，他们告诉浏览器继续解析而不需要等待脚本的执行，所以用户可以在脚本加载完成前可以看到页面，有较好的用户体验。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3easync\x3c\/code\x3e和\x3ccode\x3edefer\x3c\/code\x3e属性仅仅对外部脚本起作用，并且他们在\x3ccode\x3esrc\x3c\/code\x3e不存在时会被自动忽略。\x3c\/p\x3e\n\x3cp\x3e它们都告诉浏览器继续处理页面上的内容，而在后台加载脚本，然后在脚本加载完毕后再执行。所以脚本不会阻塞DOM树的构建和页面的渲染。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e（译注：其实这里是不对的，带有\x3ccode\x3easync\x3c\/code\x3e和\x3ccode\x3edefer\x3c\/code\x3e的脚本的下载是和HTML的下载与解析是异步的，但是js的执行一定是和UI线程是互斥的，像下面这张图所示，\x3ccode\x3easync\x3c\/code\x3e在下载完毕后的执行会阻塞HTML的解析）\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011761998\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011761998\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e他们有两处不同：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth align=\x22left\x22\x3e \x3c\/th\x3e\n\x3cth align=\x22left\x22\x3e\x3ccode\x3easync\x3c\/code\x3e\x3c\/th\x3e\n\x3cth align=\x22left\x22\x3e\x3ccode\x3edefer\x3c\/code\x3e\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e顺序\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e带有\x3ccode\x3easync\x3c\/code\x3e的脚本是优先执行先加载完的脚本，他们在页面中的顺序并不影响他们执行的顺序。\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e带有\x3ccode\x3edefer\x3c\/code\x3e的脚本按照他们在页面中出现的顺序依次执行。\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e带有\x3ccode\x3easync\x3c\/code\x3e的脚本也许会在页面没有完全下载完之前就加载，这种情况会在脚本很小或本缓存，并且页面很大的情况下发生。\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e带有\x3ccode\x3edefer\x3c\/code\x3e的脚本会在页面加载和解析完毕后执行，刚好在  \x3ccode\x3eDOMContentLoaded\x3c\/code\x3e\x3cstrong\x3e之前\x3c\/strong\x3e执行。\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e所以\x3ccode\x3easync\x3c\/code\x3e用在那些完全不依赖其他脚本的脚本上。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22html\x22\x3e### DOMContentLoaded and styles\n\nExternal style sheets don\x27t affect DOM, and so `DOMContentLoaded` does not wait for them.\n外部样式表并不会影响DOM，所以`DOMContentLoaded`并不会被他们阻塞。\nBut there\x27s a pitfall: if we have a script after the style, then that script must wait for the stylesheet to execute:\n不过仍然有一个陷阱：如果在样式后面有一个内联脚本，那么脚本必须等待样式先加载完。\n\n\x26lt;link type=\x22text\/css\x22 rel=\x22stylesheet\x22 href=\x22style.css\x22\x26gt;\n\x26lt;script\x26gt;\n  \/\/ the script doesn\x27t not execute until the stylesheet is loaded\n  \/\/ 脚本直到样式表加载完毕后才会执行。\n  alert(getComputedStyle(document.body).marginTop);\n\x26lt;\/script\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e发生这种事的原因是脚本也许会像上面的例子中所示，去得到一些元素的坐标或者基于样式的属性。所以他们自然要等到样式加载完毕才可以执行。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e需要等待脚本的执行，脚本又需要等待样式的加载。\x3c\/p\x3e\n\x3ch3\x3e浏览器的自动补全\x3c\/h3\x3e\n\x3cp\x3eFirefox, Chrome和Opera会在\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e执行时自动补全表单。\x3c\/p\x3e\n\x3cp\x3e例如，如果页面有登录的界面，浏览器记住了该页面的用户名和密码，那么在 \x3ccode\x3eDOMContentLoaded\x3c\/code\x3e运行的时候浏览器会试图自动补全表单（如果用户设置允许）。\x3c\/p\x3e\n\x3cp\x3e所以如果\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e被一个需要长时间执行的脚本阻塞，那么自动补全也会等待。你也许见过某些网站（如果你的浏览器开启了自动补全）—— 浏览器并不会立刻补全登录项，而是等到整个页面加载完毕后才填充。这就是因为在等待\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e事件。\x3c\/p\x3e\n\x3cp\x3e使用带\x3ccode\x3easync\x3c\/code\x3e和\x3ccode\x3edefer\x3c\/code\x3e的脚本的一个好处就是，他们不会阻塞\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e和浏览器自动补全。（译注：其实执行还是会阻塞的）\x3c\/p\x3e\n\x3ch2\x3ewindow.onload\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3ewindow\x3c\/code\x3e对象上的\x3ccode\x3eonload\x3c\/code\x3e事件在所有文件包括样式表，图片和其他资源下载完毕后触发。\x3c\/p\x3e\n\x3cp\x3e下面的例子正确检测了图片的大小，因为\x3ccode\x3ewindow.onload\x3c\/code\x3e会等待所有图片的加载。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22html\x22\x3e\x26lt;script\x26gt;\n  window.onload = function() {\n    alert(\x27Page loaded\x27);\n\n    \/\/ image is loaded at this time\n    alert(`Image size: ${img.offsetWidth}x${img.offsetHeight}`);\n  };\n\x26lt;\/script\x26gt;\n\n\x26lt;img id=\x22img\x22 src=\x22https:\/\/en.js.cx\/clipart\/train.gif?speed=1\x26amp;cache=0\x22\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2\x3ewindow.onunload\x3c\/h2\x3e\n\x3cp\x3e用户离开页面的时候，\x3ccode\x3ewindow\x3c\/code\x3e对象上的\x3ccode\x3eunload\x3c\/code\x3e事件会被触发，我们可以做一些不存在延迟的事情，比如关闭弹出的窗口，可是我们无法阻止用户转移到另一个页面上。\x3c\/p\x3e\n\x3cp\x3e所以我们需要使用另一个事件 —  \x3ccode\x3eonbeforeunload\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch2\x3ewindow.onbeforeunload\x3c\/h2\x3e\n\x3cp\x3e如果用户即将离开页面或者关闭窗口时，\x3ccode\x3ebeforeunload\x3c\/code\x3e事件将会被触发以进行额外的确认。\x3c\/p\x3e\n\x3cp\x3e浏览器将显示返回的字符串，举个例子：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3ewindow.onbeforeunload = function() {\n  return \x22There are unsaved changes. Leave now?\x22;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e有些浏览器像Chrome和火狐会忽略返回的字符串取而代之显示浏览器自身的文本，这是为了安全考虑，来保证用户不受到错误信息的误导。\x3c\/p\x3e\n\x3ch2\x3ereadyState\x3c\/h2\x3e\n\x3cp\x3e如果我们在整个页面加载完毕后设置\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e会发生什么呢？\x3c\/p\x3e\n\x3cp\x3e啥也没有，\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e不会被触发。\x3c\/p\x3e\n\x3cp\x3e有一些情况我们无法确定页面上是否已经加载完毕，比如一个带有\x3ccode\x3easync\x3c\/code\x3e的外部脚本的加载和执行是异步的（注：执行并不是异步的-_-）。在不同的网络状况下，脚本有可能是在页面加载完毕后执行也有可能是在页面加载完毕前执行，我们无法确定。所以我们需要知道页面加载的状况。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3edocument.readyState\x3c\/code\x3e属性给了我们加载的信息，有三个可能的值：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3eloading\x3c\/code\x3e 加载 - document仍在加载。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3einteractive\x3c\/code\x3e 互动 - 文档已经完成加载，文档已被解析，但是诸如图像，样式表和框架之类的子资源仍在加载。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ecomplete\x3c\/code\x3e - 文档和所有子资源已完成加载。状态表示 \x3ccode\x3eload\x3c\/code\x3e 事件即将被触发。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e所以我们可以检查 \x3ccode\x3edocument.readyState\x3c\/code\x3e 的状态，如果没有就绪可以选择挂载事件，如果已经就绪了就可以直接立即执行。\x3c\/p\x3e\n\x3cp\x3e像这样：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3efunction work() { \/*...*\/ }\n\nif (document.readyState == \x27loading\x27) {\n  document.addEventListener(\x27DOMContentLoaded\x27, work);\n} else {\n  work();\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e每当文档的加载状态改变的时候就有一个\x3ccode\x3ereadystatechange\x3c\/code\x3e事件被触发，所以我们可以打印所有的状态。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3e\/\/ current state\nconsole.log(document.readyState);\n\n\/\/ print state changes\ndocument.addEventListener(\x27readystatechange\x27, () =\x26gt; console.log(document.readyState));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ereadystatechange\x3c\/code\x3e 是追踪页面加载的一个可选的方法，很早之前就已经出现了。不过现在很少被使用了，为了保持完整性还是介绍一下它。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ereadystatechange\x3c\/code\x3e的在各个事件中的执行顺序又是如何呢？\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22html\x22\x3e\x26lt;script\x26gt;\n  function log(text) { \/* output the time and message *\/ }\n  log(\x27initial readyState:\x27 \x2b document.readyState);\n\n  document.addEventListener(\x27readystatechange\x27, () =\x26gt; log(\x27readyState:\x27 \x2b document.readyState));\n  document.addEventListener(\x27DOMContentLoaded\x27, () =\x26gt; log(\x27DOMContentLoaded\x27));\n\n  window.onload = () =\x26gt; log(\x27window onload\x27);\n\x26lt;\/script\x26gt;\n\n\x26lt;iframe src=\x22iframe.html\x22 onload=\x22log(\x27iframe onload\x27)\x22\x26gt;\x26lt;\/iframe\x26gt;\n\n\x26lt;img src=\x22http:\/\/en.js.cx\/clipart\/train.gif\x22 id=\x22img\x22\x26gt;\n\x26lt;script\x26gt;\n  img.onload = () =\x26gt; log(\x27img onload\x27);\n\x26lt;\/script\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e输出如下:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e[1] initial readyState:loading\x3c\/li\x3e\n\x3cli\x3e[2] readyState:interactive\x3c\/li\x3e\n\x3cli\x3e[2] DOMContentLoaded\x3c\/li\x3e\n\x3cli\x3e[3] iframe onload\x3c\/li\x3e\n\x3cli\x3e[4] readyState:complete\x3c\/li\x3e\n\x3cli\x3e[4] img onload\x3c\/li\x3e\n\x3cli\x3e[4] window onload\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e方括号中的数字表示他们发生的时间，真实的发生时间会更晚一点，不过相同数字的时间可以认为是在同一时刻被按顺序触发（误差在几毫秒之内）\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3edocument.readyState\x3c\/code\x3e 在 \x3ccode\x3eDOMContentLoaded\x3c\/code\x3e前一刻变为\x3ccode\x3einteractive\x3c\/code\x3e，这两个事件可以认为是同时发生。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3edocument.readyState\x3c\/code\x3e 在所有资源加载完毕后（包括\x3ccode\x3eiframe\x3c\/code\x3e和\x3ccode\x3eimg\x3c\/code\x3e）变成\x3ccode\x3ecomplete\x3c\/code\x3e，我们可以看到\x3ccode\x3ecomplete\x3c\/code\x3e、 \x3ccode\x3eimg.onload\x3c\/code\x3e和\x3ccode\x3ewindow.onload\x3c\/code\x3e几乎同时发生，区别就是\x3ccode\x3ewindow.onload\x3c\/code\x3e在所有其他的\x3ccode\x3eload\x3c\/code\x3e事件之后执行。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2\x3e总结\x3c\/h2\x3e\n\x3cp\x3e页面事件的生命周期：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e事件在DOM树构建完毕后被触发，我们可以在这个阶段使用js去访问元素。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3easync\x3c\/code\x3e和\x3ccode\x3edefer\x3c\/code\x3e的脚本可能还没有执行。\x3c\/li\x3e\n\x3cli\x3e图片及其他资源文件可能还在下载中。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eload\x3c\/code\x3e事件在页面所有资源被加载完毕后触发，通常我们不会用到这个事件，因为我们不需要等那么久。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ebeforeunload\x3c\/code\x3e在用户即将离开页面时触发，它返回一个字符串，浏览器会向用户展示并询问这个字符串以确定是否离开。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eunload\x3c\/code\x3e在用户已经离开时触发，我们在这个阶段仅可以做一些没有延迟的操作，由于种种限制，很少被使用。\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3edocument.readyState\x3c\/code\x3e表征页面的加载状态，可以在\x3ccode\x3ereadystatechange\x3c\/code\x3e中追踪页面的变化状态：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3eloading\x3c\/code\x3e — 页面正在加载中。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3einteractive\x3c\/code\x3e -- 页面解析完毕，时间上和 \x3ccode\x3eDOMContentLoaded\x3c\/code\x3e同时发生，不过顺序在它之前。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ecomplete\x3c\/code\x3e -- 页面上的资源都已加载完毕，时间上和\x3ccode\x3ewindow.onload\x3c\/code\x3e同时发生，不过顺序在他之前。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>页面生命周期：DOMContentLoaded, load, beforeunload, unload</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011468675">https://segmentfault.com/a/1190000011468675</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/3hj8boa8qn4/" target="_blank">https://alili.tech/archive/3hj8boa8qn4/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>