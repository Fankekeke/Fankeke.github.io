<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="前端系列——nodejs环境下http2初尝试"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>前端系列——nodejs环境下http2初尝试 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/3t2u59eyu0l/",
				"appid": "1613049289050283", 
				"title": "前端系列——nodejs环境下http2初尝试 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-14T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/iihvp95cbbe/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/h3k0kvayvyf/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f3t2u59eyu0l%2f&text=%e5%89%8d%e7%ab%af%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94nodejs%e7%8e%af%e5%a2%83%e4%b8%8bhttp2%e5%88%9d%e5%b0%9d%e8%af%95"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f3t2u59eyu0l%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f3t2u59eyu0l%2f&text=%e5%89%8d%e7%ab%af%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94nodejs%e7%8e%af%e5%a2%83%e4%b8%8bhttp2%e5%88%9d%e5%b0%9d%e8%af%95"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f3t2u59eyu0l%2f&title=%e5%89%8d%e7%ab%af%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94nodejs%e7%8e%af%e5%a2%83%e4%b8%8bhttp2%e5%88%9d%e5%b0%9d%e8%af%95"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f3t2u59eyu0l%2f&is_video=false&description=%e5%89%8d%e7%ab%af%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94nodejs%e7%8e%af%e5%a2%83%e4%b8%8bhttp2%e5%88%9d%e5%b0%9d%e8%af%95"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%89%8d%e7%ab%af%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94nodejs%e7%8e%af%e5%a2%83%e4%b8%8bhttp2%e5%88%9d%e5%b0%9d%e8%af%95&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f3t2u59eyu0l%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f3t2u59eyu0l%2f&title=%e5%89%8d%e7%ab%af%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94nodejs%e7%8e%af%e5%a2%83%e4%b8%8bhttp2%e5%88%9d%e5%b0%9d%e8%af%95"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3t2u59eyu0l%2f&title=%e5%89%8d%e7%ab%af%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94nodejs%e7%8e%af%e5%a2%83%e4%b8%8bhttp2%e5%88%9d%e5%b0%9d%e8%af%95"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3t2u59eyu0l%2f&title=%e5%89%8d%e7%ab%af%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94nodejs%e7%8e%af%e5%a2%83%e4%b8%8bhttp2%e5%88%9d%e5%b0%9d%e8%af%95"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3t2u59eyu0l%2f&title=%e5%89%8d%e7%ab%af%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94nodejs%e7%8e%af%e5%a2%83%e4%b8%8bhttp2%e5%88%9d%e5%b0%9d%e8%af%95"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">前端系列——nodejs环境下http2初尝试</h1><div class="meta"><div class="postdate"><time datetime="2018-12-14" itemprop="datePublished">2018-12-14</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch3 id=\x22articleHeader0\x22\x3e目的\x3c\/h3\x3e\n\x3cp\x3ehttp2出来也有段时间了，很多网站都已经实际应用了它，而我还活在http1.1的时代，趁着还年轻，记性还行，花点时间研究了http2在nodejs中的使用。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3ehttp2基础理论\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3eHTTP2是\x3cstrong\x3e二进制\x3c\/strong\x3e协议\x3c\/li\x3e\n\x3cli\x3e这是一个\x3cstrong\x3e复用\x3c\/strong\x3e协议。并行的请求能在同一个链接中处理，移除了HTTP\/1.x中顺序和阻塞的约束。\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e压缩了headers\x3c\/strong\x3e。因为headers在一系列请求中常常是相似的，其移除了重复和传输重复数据的成本。\x3c\/li\x3e\n\x3cli\x3e其允许服务器在客户端缓存中填充数据，通过一个叫\x3cstrong\x3e服务器推送\x3c\/strong\x3e的机制来提前请求。\x3c\/li\x3e\n\x3cli\x3e对Alt-Svc的支持允许了给定资源的位置和\x3cstrong\x3e资源鉴定\x3c\/strong\x3e，允许了\x3cstrong\x3e更智能的CDN缓冲\x3c\/strong\x3e机制。\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3eClient-Hints\x3c\/strong\x3e 的引入允许浏览器或者客户端来主动交流它的需求，或者是硬件约束的信息给服务端。\x3c\/li\x3e\n\x3cli\x3e在Cookie头中\x3cstrong\x3e引入安全相关的的前缀\x3c\/strong\x3e，现在帮助保证一个安全的cookie没被更改过。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3ehttp2使用现状\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e案例1：淘宝\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3s9h?w=1838\x26amp;h=928\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3s9h?w=1838\x26amp;h=928\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e案例2：京东\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3tal?w=1854\x26amp;h=986\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3tal?w=1854\x26amp;h=986\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e案例3：知乎\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3taG?w=2092\x26amp;h=982\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3taG?w=2092\x26amp;h=982\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e案例4：二月的公司\x3c\/strong\x3e\x3cbr\x3e不好意思，我们还没用上这么牛逼的协议。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3ttD?w=2064\x26amp;h=986\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3ttD?w=2064\x26amp;h=986\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3enodejs应用HTTP2协议\x3c\/h3\x3e\n\x3cp\x3e我参考了一个外国程序员和一个中国程序员的http2方案，然后对源码进行了调整，主要目的在于体验一把http2，没有很深的知识。如果你想深入了解node中http2的使用，请看这里：\x3ca href=\x22https:\/\/nodejs.org\/api\/http2.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enodejs之http2大全\x3c\/a\x3e\x3c\/p\x3e\n\x3ch4\x3e开发环境\x3c\/h4\x3e\n\x3cblockquote\x3emac: 10.12.6\x3cbr\x3e node: v8.9.4\x3c\/blockquote\x3e\n\x3ch4\x3e项目结构\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22├── index.js \/\/ 入口文件\n├── package-lock.json \n├── package.json \/\/配置\n├── public \/\/ 前端资源文件\n│\x26nbsp;\x26nbsp; ├── bundle1.js\n│\x26nbsp;\x26nbsp; ├── bundle2.js\n│\x26nbsp;\x26nbsp; ├── index.html\n│\x26nbsp;\x26nbsp; └── network.png\n├── src \/\/服务端文件\n│\x26nbsp;\x26nbsp; ├── helper.js\n│\x26nbsp;\x26nbsp; └── server.js\n└── ssl \/\/证书\n    ├── cert.pem\n    └── key.pem\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e├── index\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 入口文件\x3c\/span\x3e\n├── package-lock\x3cspan class=\x22hljs-selector-class\x22\x3e.json\x3c\/span\x3e \n├── package\x3cspan class=\x22hljs-selector-class\x22\x3e.json\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/配置\x3c\/span\x3e\n├── public \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 前端资源文件\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── bundle1\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── bundle2\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── index\x3cspan class=\x22hljs-selector-class\x22\x3e.html\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; └── network\x3cspan class=\x22hljs-selector-class\x22\x3e.png\x3c\/span\x3e\n├── src \x3cspan class=\x22hljs-comment\x22\x3e\/\/服务端文件\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── helper\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; └── server\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n└── ssl \x3cspan class=\x22hljs-comment\x22\x3e\/\/证书\x3c\/span\x3e\n    ├── cert\x3cspan class=\x22hljs-selector-class\x22\x3e.pem\x3c\/span\x3e\n    └── key.pem\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e步骤\x3c\/h4\x3e\n\x3cp\x3e\x3cstrong\x3e1、你必须要安装http2\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm i --save http2\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpm \x3cspan class=\x22hljs-selector-tag\x22\x3ei\x3c\/span\x3e --save http2\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e2、生成ssl证书\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e我比较懒，就没有自己生成，用别人生成好的证书来测试。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e3、项目中最核心的就是server文件\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e可以看到代码中用到了fs读取文件，helper也是获取文件的插件。和使用http1.1不同的是，这里导入的是http2，然后用http2.createSecureServer()创建一个服务器。注意它的语法： http2.createSecureServer(options, callback)，options表示你的证书或者其他有关的配置选项，但是证书是必备的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x27use strict\x27\nconst fs = require(\x27fs\x27)\nconst path = require(\x27path\x27)\nconst http2 = require(\x27http2\x27)\nconst helper = require(\x27.\/helper\x27)\n\nconst PORT = process.env.PORT || 8080\nconst PUBLIC_PATH = path.join(__dirname, \x27..\/public\x27)\nconst publicFiles = helper.getFiles(PUBLIC_PATH)\n\n\/\/创建HTTP2服务器\nconst server = http2.createSecureServer({\n  cert: fs.readFileSync(path.join(__dirname, \x27..\/ssl\/cert.pem\x27)),\n  key: fs.readFileSync(path.join(__dirname, \x27..\/ssl\/key.pem\x27))\n}, onRequest)\n\n\/\/ Request 事件\nfunction onRequest (req, res) {\n    \/\/ 路径指向 index.html\n  const reqPath = req.url === \x27\/\x27 ? \x27\/index.html\x27 : req.url\n    \/\/获取html资源\n  const file = publicFiles.get(reqPath)\n  \/\/ 文件不存在\n  if (!file) {\n    res.statusCode = 404\n    res.end()\n    return\n  }\n  \n  res.stream.respondWithFD(file.fileDescriptor, file.headers)\n}\nserver.listen(PORT)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x27use strict\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27fs\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e path = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27path\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e http2 = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27http2\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e helper = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/helper\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e PORT = process.env.PORT || \x3cspan class=\x22hljs-number\x22\x3e8080\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e PUBLIC_PATH = path.join(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27..\/public\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e publicFiles = helper.getFiles(PUBLIC_PATH)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/创建HTTP2服务器\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e server = http2.createSecureServer({\n  \x3cspan class=\x22hljs-attr\x22\x3ecert\x3c\/span\x3e: fs.readFileSync(path.join(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27..\/ssl\/cert.pem\x27\x3c\/span\x3e)),\n  \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e: fs.readFileSync(path.join(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27..\/ssl\/key.pem\x27\x3c\/span\x3e))\n}, onRequest)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Request 事件\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonRequest\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ereq, res\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 路径指向 index.html\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e reqPath = req.url === \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x27\/index.html\x27\x3c\/span\x3e : req.url\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/获取html资源\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e file = publicFiles.get(reqPath)\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 文件不存在\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!file) {\n    res.statusCode = \x3cspan class=\x22hljs-number\x22\x3e404\x3c\/span\x3e\n    res.end()\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n  }\n  \n  res.stream.respondWithFD(file.fileDescriptor, file.headers)\n}\nserver.listen(PORT)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e4、写好服务端代码，剩下的事情就是启动项目，然后交给浏览器渲染html和加载资源。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e5、关键点2 html文件\x3c\/strong\x3e  \x3cbr\x3e确保你的浏览器支持fetch，因为我没有用第三方支持库，for循环的作用是客户端向服务器发起100个请求，让我们更加直观的看到http2请求多个资源的情况。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3chtml\x3e\n\x3chead\x3e\n  \x3cmeta charset=\x26quot;UTF-8\x26quot;\x3e\n\x3c\/head\x3e\n\x3cbody\x3e\n  \x3ch1\x3e体验一把HTTP2\x3c\/h1\x3e\n\x3c\/body\x3e\n  \x3cscript src=\x26quot;bundle1.js\x26quot;\x3e\x3c\/script\x3e\n  \x3cscript src=\x26quot;bundle2.js\x26quot;\x3e\x3c\/script\x3e\n\x3cscript\x3e\n        for(var i=0;i\x3c100;i\x2b\x2b) {\n            fetch(\x27\/\/localhost:8080\/network.png\x27);\n        }\n\x3c\/script\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22UTF-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eh1\x3c\/span\x3e\x26gt;\x3c\/span\x3e体验一把HTTP2\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eh1\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22bundle1.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22bundle2.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22actionscript\x22\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i=\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;i\x26lt;\x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e;i\x2b\x2b) {\n            fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\/localhost:8080\/network.png\x27\x3c\/span\x3e);\n        }\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e6、渲染结果\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3tWv?w=2464\x26amp;h=1154\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3tWv?w=2464\x26amp;h=1154\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3tYV?w=1980\x26amp;h=378\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3tYV?w=1980\x26amp;h=378\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e源码\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/hyy1115\/http2-test\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp2-test\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e总结\x3c\/h3\x3e\n\x3cp\x3e从测试结果来看，可以回顾一下http2的知识，非常明显的一点是：\x3cstrong\x3e同个域名只需要占用一个 TCP 连接\x3c\/strong\x3e，头部压缩需要抓包才能分析出来，还有服务端推送等功能，在这里没有做测试，如果你也想体验一把http2，下载源码安装好插件就能用了，同时也得注意你的开发环境是否支持。\x3c\/p\x3e\n\x3cp\x3e本文内容很浅，想要了解更多http2的知识，可以去知乎搜相关文章和回答。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>前端系列——nodejs环境下http2初尝试</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013184607">https://segmentfault.com/a/1190000013184607</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/3t2u59eyu0l/" target="_blank">https://alili.tech/archive/3t2u59eyu0l/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>