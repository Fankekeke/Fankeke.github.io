<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="vitual-dom原理与简单实现"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>vitual-dom原理与简单实现 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/3xz3hfqu7af/",
				"appid": "1613049289050283", 
				"title": "vitual-dom原理与简单实现 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-24T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/tcnuahcdele/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/8j2tbvmo3iu/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f3xz3hfqu7af%2f&text=vitual-dom%e5%8e%9f%e7%90%86%e4%b8%8e%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f3xz3hfqu7af%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f3xz3hfqu7af%2f&text=vitual-dom%e5%8e%9f%e7%90%86%e4%b8%8e%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f3xz3hfqu7af%2f&title=vitual-dom%e5%8e%9f%e7%90%86%e4%b8%8e%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f3xz3hfqu7af%2f&is_video=false&description=vitual-dom%e5%8e%9f%e7%90%86%e4%b8%8e%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=vitual-dom%e5%8e%9f%e7%90%86%e4%b8%8e%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f3xz3hfqu7af%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f3xz3hfqu7af%2f&title=vitual-dom%e5%8e%9f%e7%90%86%e4%b8%8e%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3xz3hfqu7af%2f&title=vitual-dom%e5%8e%9f%e7%90%86%e4%b8%8e%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3xz3hfqu7af%2f&title=vitual-dom%e5%8e%9f%e7%90%86%e4%b8%8e%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3xz3hfqu7af%2f&title=vitual-dom%e5%8e%9f%e7%90%86%e4%b8%8e%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">vitual-dom原理与简单实现</h1><div class="meta"><div class="postdate"><time datetime="2018-12-24" itemprop="datePublished">2018-12-24</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e前言\x3c\/h1\x3e\n\x3cp\x3e目前广为人知的React和Vue都采用了virtual-dom，Virtual DOM凭借其高效的diff算法，让我们不再关心性能问题，可以随心所欲的修改数据状态。在实际开发中，我们并不需要关心Virtual DOM是如何实现的，但是理解Virtual DOM的实现原理确实有必要的。本文是参照\x3ca href=\x22https:\/\/github.com\/livoras\/simple-virtual-dom%E6%BA%90%E7%A0%81%E8%BF%9B%E8%A1%8C%E7%90%86%E8%A7%A3vitual\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/livoras\/si...\x3c\/a\x3e DOM。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e一、前端应用状态管理\x3c\/h1\x3e\n\x3cp\x3e在日益复杂的前端应用中，状态管理是一个经常被提及的话题，从早期的刀耕火种时代到jQuery，再到现在流行的MVVM时代，状态管理的形式发生了翻天覆地的变化，我们再也不用维护茫茫多的事件回调、监听来更新视图，转而使用使用双向数据绑定，只需要维护相应的数据状态，就可以自动更新视图，极大提高开发效率。\x3c\/p\x3e\n\x3cp\x3e但是，双向数据绑定也并不是唯一的办法，还有一个非常粗暴有效的方式：一旦数据发生变化，重新绘制整个视图，也就是重新设置一下innerHTML。这样的做法确实简单、粗暴、有效，但是如果只是因为局部一个小的数据发生变化而更新整个视图，性价比未免太低了，而且，像事件，获取焦点的输入框等，都需要重新处理。所以，对于小的应用或者说局部的小视图，这样处理完全是可以的，但是面对复杂的大型应用，这样的做法不可取。所以我们可以采取用JavaScript的方法来模拟DOM树，用新渲染的对象树去和旧的树进行对比，记录下变化的变化，然后应用到真实的DOM树上，这样我们只需要更改与原来视图不同的地方，而不需要全部重新渲染一次。这就是virtual-DOM的优势\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e二、视图渲染\x3c\/h1\x3e\n\x3cp\x3e相对于DOM对象，原生的JavaScript对象处理得更快，而且简单。DOM树上的结构，属性信息我们都能通过JavaScript进行表示出来，例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var element = {\n    tagName: \x27ul\x27, \/\/ 节点标签名\n    props: { \/\/ dom的属性键值对\n        id: \x27list\x27\n    },\n    children: [\n        {tagName: \x27li\x27, props: {class: \x27item\x27}, children: [\x26quot;Item 1\x26quot;]},\n        {tagName: \x27li\x27, props: {class: \x27item\x27}, children: [\x26quot;Item 2\x26quot;]},\n        {tagName: \x27li\x27, props: {class: \x27item\x27}, children: [\x26quot;Item 3\x26quot;]}\n    ]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e element = {\n    tagName: \x3cspan class=\x22hljs-symbol\x22\x3e\x27u\x3c\/span\x3el\x27, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 节点标签名\x3c\/span\x3e\n    props: { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ dom的属性键值对\x3c\/span\x3e\n        id: \x3cspan class=\x22hljs-symbol\x22\x3e\x27lis\x3c\/span\x3et\x27\n    },\n    children: [\n        {tagName: \x3cspan class=\x22hljs-symbol\x22\x3e\x27l\x3c\/span\x3ei\x27, props: {\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27ite\x3c\/span\x3em\x27}, children: [\x3cspan class=\x22hljs-string\x22\x3e\x22Item 1\x22\x3c\/span\x3e]},\n        {tagName: \x3cspan class=\x22hljs-symbol\x22\x3e\x27l\x3c\/span\x3ei\x27, props: {\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27ite\x3c\/span\x3em\x27}, children: [\x3cspan class=\x22hljs-string\x22\x3e\x22Item 2\x22\x3c\/span\x3e]},\n        {tagName: \x3cspan class=\x22hljs-symbol\x22\x3e\x27l\x3c\/span\x3ei\x27, props: {\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27ite\x3c\/span\x3em\x27}, children: [\x3cspan class=\x22hljs-string\x22\x3e\x22Item 3\x22\x3c\/span\x3e]}\n    ]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么在html渲染的结果就是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cul id=\x26quot;list\x26quot;\x3e\n    \x3cli class=\x26quot;item\x26quot;\x3eItem 1\x3c\/li\x3e\n    \x3cli class=\x26quot;item\x26quot;\x3eItem 2\x3c\/li\x3e\n    \x3cli class=\x26quot;item\x26quot;\x3eItem 3\x3c\/li\x3e\n\x3c\/ul\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode\x3e\x26lt;ul id=\x3cspan class=\x22hljs-string\x22\x3e\x22list\x22\x3c\/span\x3e\x26gt;\n    \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22item\x22\x3c\/span\x3e\x26gt;Item 1\x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e\x26gt;\n    \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22item\x22\x3c\/span\x3e\x26gt;Item 2\x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e\x26gt;\n    \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22item\x22\x3c\/span\x3e\x26gt;Item 3\x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e\x26gt;\n\x26lt;\/ul\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e既然能够通过JavaScript表示DOM树的信息，那么就可以通过使用JavaScript来构建DOM树。\x3c\/p\x3e\n\x3cp\x3e然而光是构建DOM树，没什么卵用，我们需要将JavaScript构建的DOM树渲染到真实的DOM树上，用JavaScript表现一个dom一个节点非常简单，我们只需要记录他的节点类型，属性键值对，子节点:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function Element(tagName, props, children) {\n    this.tagName = tagName\n    this.props = props\n    this.children = children\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eElement\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(tagName, props, children)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tagName = tagName\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props = props\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.children = children\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么ul标签我们就可以使用这种方式来表示\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var ul = new Element(\x27ul\x27, {id: \x27list\x27}, [\n    {tagName: \x27li\x27, props: {class: \x27item\x27}, children: [\x26quot;Item 1\x26quot;]},\n    {tagName: \x27li\x27, props: {class: \x27item\x27}, children: [\x26quot;Item 2\x26quot;]},\n    {tagName: \x27li\x27, props: {class: \x27item\x27}, children: [\x26quot;Item 3\x26quot;]}\n])\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ul = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eElement\x3c\/span\x3e(\x3cspan class=\x22hljs-symbol\x22\x3e\x27u\x3c\/span\x3el\x27, {id: \x3cspan class=\x22hljs-symbol\x22\x3e\x27lis\x3c\/span\x3et\x27}, [\n    {tagName: \x3cspan class=\x22hljs-symbol\x22\x3e\x27l\x3c\/span\x3ei\x27, props: {\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27ite\x3c\/span\x3em\x27}, children: [\x3cspan class=\x22hljs-string\x22\x3e\x22Item 1\x22\x3c\/span\x3e]},\n    {tagName: \x3cspan class=\x22hljs-symbol\x22\x3e\x27l\x3c\/span\x3ei\x27, props: {\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27ite\x3c\/span\x3em\x27}, children: [\x3cspan class=\x22hljs-string\x22\x3e\x22Item 2\x22\x3c\/span\x3e]},\n    {tagName: \x3cspan class=\x22hljs-symbol\x22\x3e\x27l\x3c\/span\x3ei\x27, props: {\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27ite\x3c\/span\x3em\x27}, children: [\x3cspan class=\x22hljs-string\x22\x3e\x22Item 3\x22\x3c\/span\x3e]}\n])\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e说了这么多，他只是用JavaScript表示的一个结构，那该如何将他渲染到真实的DOM结构中呢：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Element.prototype.render = function() {\n    let el = document.createElement(this.tagName), \/\/ 节点名称\n        props = this.props \/\/ 节点属性\n\n    for (var propName in props) {\n        propValue = props[propName]\n        el.setAttribute(propName, propValue)\n    }\n\n    this.children.forEach((child) =\x3e {\n        var childEl = (child instanceof Element)\n            ? child.render()\n            : document.createTextNode(child)\n        el.appendChild(childEl)\n    })\n    return el\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3eElement.prototype.render = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e el = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tagName), \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 节点名称\x3c\/span\x3e\n        props = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 节点属性\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e propName \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e props) {\n        propValue = props[propName]\n        el.setAttribute(propName, propValue)\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.children.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3echild\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e childEl = (child \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e Element)\n            ? child.render()\n            : \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createTextNode(child)\n        el.appendChild(childEl)\n    })\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e el\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果我们想将ul渲染到DOM结构中，就只需要\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22ulRoot = ul.render()\ndocument.appendChild(ulRoot)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3eulRoot = \x3cspan class=\x22hljs-selector-tag\x22\x3eul\x3c\/span\x3e.render()\ndocument.appendChild(ulRoot)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样就完成了ul到DOM的渲染，也就有了真正的DOM结构\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cul id=\x26quot;list\x26quot;\x3e\n    \x3cli class=\x26quot;item\x26quot;\x3eItem 1\x3c\/li\x3e\n    \x3cli class=\x26quot;item\x26quot;\x3eItem 2\x3c\/li\x3e\n    \x3cli class=\x26quot;item\x26quot;\x3eItem 3\x3c\/li\x3e\n\x3c\/ul\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode\x3e\x26lt;ul id=\x3cspan class=\x22hljs-string\x22\x3e\x22list\x22\x3c\/span\x3e\x26gt;\n    \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22item\x22\x3c\/span\x3e\x26gt;Item 1\x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e\x26gt;\n    \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22item\x22\x3c\/span\x3e\x26gt;Item 2\x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e\x26gt;\n    \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22item\x22\x3c\/span\x3e\x26gt;Item 3\x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eli\x3c\/span\x3e\x26gt;\n\x26lt;\/ul\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3e三、比较虚拟DOM树的差异\x3c\/h1\x3e\n\x3cp\x3eReact的核心算法是diff算法(这里指的是优化后的算法)我们来看看diff算法是如何实现的：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVZtTx?w=377\x26amp;h=199\x22 src=\x22https:\/\/static.alili.tech\/img\/bVZtTx?w=377\x26amp;h=199\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3ediff只会对相同颜色方框内的DOM节点进行比较，即同一个父节点下的所有子节点。当发现节点不存在，则该节点和子节点会被完全删除，不会做进一步的比较。\x3c\/p\x3e\n\x3cp\x3e在实际的代码中，会对新旧两棵树进行深度的遍历，给每一个节点进行标记。然后在新旧两棵树的对比中，将不同的地方记录下来。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ diff 算法，对比两棵树\nfunction diff(oldTree, newTree) {\n    var index = 0   \/\/ 当前节点的标志\n    var patches = {} \/\/ 记录每个节点差异的地方\n    dfsWalk(oldTree, newTree, index, patches)\n    return patches\n}\nfunction dfsWalk(oldNode, newNode, index, patches) {\n    \/\/ 对比newNode和oldNode的差异地方进行记录\n    patches[index] = [...]\n\n    diffChildren(oldNode.children, newNode.children, index, patches)\n}\nfunction diffChildren(oldChildren, newChildren, index, patches) {\n    let leftNode = null\n    var currentNodeIndex = index\n    oldChildren.forEach((child, i) =\x3e {\n        var newChild = newChildren[i]\n        currentNodeIndex =  (leftNode \x26amp;\x26amp; leftNode.count) \/\/ 计算节点的标记\n                ? currentNodeIndex \x2b leftNode.count \x2b 1\n                : currentNodeIndex \x2b 1\n        dfsWalk(child, newChild, currentNodeIndex, patches) \/\/ 遍历子节点\n        leftNode = child\n    })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ diff 算法，对比两棵树\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ediff\x3c\/span\x3e\x3c\/span\x3e(oldTree, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eTree\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e index = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当前节点的标志\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e patches = {} \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 记录每个节点差异的地方\x3c\/span\x3e\n    dfsWalk(oldTree, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eTree\x3c\/span\x3e, index, patches)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e patches\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edfsWalk\x3c\/span\x3e\x3c\/span\x3e(oldNode, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eNode\x3c\/span\x3e, index, patches) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对比newNode和oldNode的差异地方进行记录\x3c\/span\x3e\n    patches[index] = [...]\n\n    diffChildren(oldNode.children, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eNode\x3c\/span\x3e.children, index, patches)\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ediffChildren\x3c\/span\x3e\x3c\/span\x3e(oldChildren, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eChildren\x3c\/span\x3e, index, patches) {\n    let leftNode = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e currentNodeIndex = index\n    oldChildren.forEach((child, i) =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eChild\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eChildren\x3c\/span\x3e[i]\n        currentNodeIndex =  (leftNode \x26amp;\x26amp; leftNode.count) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 计算节点的标记\x3c\/span\x3e\n                ? currentNodeIndex \x2b leftNode.count \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n                : \x3cspan class=\x22hljs-type\x22\x3ecurrentNodeIndex \x3c\/span\x3e\x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n        dfsWalk(child, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eChild\x3c\/span\x3e, currentNodeIndex, patches) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 遍历子节点\x3c\/span\x3e\n        leftNode = child\n    })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e例如：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVZtT0?w=355\x26amp;h=239\x22 src=\x22https:\/\/static.alili.tech\/img\/bVZtT0?w=355\x26amp;h=239\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e在图中如果div有差异，标记为0,那么：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22patches[0] = [{difference}, {difference}]\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs accesslog\x22\x3e\x3ccode\x3epatches\x3cspan class=\x22hljs-string\x22\x3e[0]\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e[{difference}, {difference}]\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e同理，有p是patches[1], ul是patches[3],以此类推\x3cbr\x3epatches指的是差异变化，这些差异包括：1、节点类型的不同，2、节点类型相同，但是属性值不同，文本内容不同。所以有这么几种类型：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var REPLACE = 0,    \/\/ replace 替换\n    REORDER = 1,    \/\/ reorder 父节点中子节点的操作\n    PROPS   = 2,    \/\/ props 属性的变化\n    TEXT    = 3     \/\/ text 文本内容的变化\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3evar REPLACE = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ replace 替换\x3c\/span\x3e\n    REORDER = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ reorder 父节点中子节点的操作\x3c\/span\x3e\n    PROPS   = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ props 属性的变化\x3c\/span\x3e\n    TEXT    = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ text 文本内容的变化\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果节点类型不同，就说明是需要替换，例如将div替换成section,就记录下差异：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22patches[0] = [{\n    type: REPLACE,\n    node: newNode \/\/ section\n},{\n    type: PROPS,\n    props: {\n        id: \x27container\x27\n    }\n}]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3epatches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] = [{\n    \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: REPLACE,\n    \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e: newNode\x3c\/span\x3e \/\/ section\n},{\n    \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: PROPS,\n    props: {\n        id: \x27container\x27\n    }\n}]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader4\x22\x3e四、将差异应用到DOM树上\x3c\/h1\x3e\n\x3cp\x3e在标题二中构建了真正的DOM树的信息，所以先对那一棵DOM树进行深度优先的遍历，遍历的时候同\x3cbr\x3epatches对象进行对比，找到其中的差异，然后应用到DOM操作中。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function patch(node, patches) {\n    var walker = {index: 0} \/\/ 记录当前节点的标志\n    dfsWalk(node, walker, patches)\n}\n\nfunction dfsWalk(node, walker, patches) {\n    var currentPatches = patches[walker.index] \/\/ 这是当前节点的差异\n\n    var len = node.childNodes\n        ? node.childNodes.length\n        : 0\n\n    for (var i = 0; i \x3c len; i\x2b\x2b) { \/\/ 深度遍历子节点\n        var child = node.childNodes[i]\n        walker.index\x2b\x2b\n        dfsWalk(child, walker, patches)\n    }\n\n    if (currentPatches) {\n        applyPatches(node, currentPatches) \/\/ 对当前节点进行DOM操作\n    }\n}\n\/\/ 将差异的部分应用到DOM中\nfunction applyPatches(node, currentPatches) {\n    currentPatches.forEach((currentPatch) =\x3e {\n        switch (currentPatch.type) {\n            case REPLACE:\n                var newNode = (typeof currentPatch.node === \x27string\x27)\n                    ? document.createTextNode(currentPatch.node)\n                    : currentPatch.node.render()\n                node.parentNode.replaceChild(newNode, node)\n                break;\n            case REORDER:\n                reorderChldren(node, currentPatch.moves)\n                break\n            case PROPS:\n                setProps(node, currentPatch.props)\n                break\n            case TEXT:\n                if (node.textContent) {\n                    node.textContent = currentPatch.content\n                } else {\n                    node.nodeValue = currentPatch.content\n                }\n                break\n            default:\n                throw new Error(\x27Unknown patch type \x27 \x2b currentPatch.type)\n        }\n    })\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3efunction patch(\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e, patches\x3c\/span\x3e) {\n    var walker = {index: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e} \/\/ 记录当前节点的标志\n    dfsWalk(\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e, walker\x3c\/span\x3e, patches)\n}\n\nfunction dfsWalk(\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e, walker\x3c\/span\x3e, patches) {\n    var currentPatches = patches[walker.index] \/\/ 这是当前节点的差异\n\n    var len = \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3echildNodes\x3c\/span\x3e\n        ? \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3echildNodes\x3c\/span\x3e.length\n        : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n\n    for (var i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x3cspan class=\x22hljs-tag\x22\x3e\x26lt; len; i\x2b\x2b) { \/\/ 深度遍历子节点\n        var child = node.childNodes[i]\n        walker.index\x2b\x2b\n        dfsWalk(child, walker, patches)\n    }\n\n    if (currentPatches) {\n        applyPatches(node, currentPatches) \/\/ 对当前节点进行DOM操作\n    }\n}\n\/\/ 将差异的部分应用到DOM中\nfunction applyPatches(node, currentPatches) {\n    currentPatches.forEach((currentPatch) =\x26gt;\x3c\/span\x3e {\n        switch (currentPatch.\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e) {\n            case REPLACE:\n                var newNode = (typeof currentPatch.node === \x27\x3cspan class=\x22hljs-keyword\x22\x3estring\x3c\/span\x3e\x27)\n                    ? document.createTextNode(currentPatch.node)\n                    : currentPatch.node.render()\n                \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eparentNode\x3c\/span\x3e.replaceChild(newNode, \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e)\n                break\x3c\/span\x3e;\n            case REORDER:\n                reorderChldren(\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e, currentPatch\x3c\/span\x3e.moves)\n                break\n            case PROPS:\n                setProps(\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e, currentPatch\x3c\/span\x3e.props)\n                break\n            case TEXT:\n                if (\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3etextContent\x3c\/span\x3e) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3etextContent\x3c\/span\x3e = currentPatch.content\n                } else {\n                    \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3enodeValue\x3c\/span\x3e = currentPatch.content\n                }\n                break\n            default:\n                throw new Error(\x27Unknown patch \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e \x27 \x2b currentPatch.\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e)\n        }\n    })\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这次的粗糙的virtual-dom基本已经实现了，具体的情况更加复杂。但这已经足够让我们理解virtual-dom。\x3cbr\x3e具体的带解析的代码已经上传到\x3ca href=\x22https:\/\/github.com\/skychenbo\/Blog\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egithub\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader5\x22\x3e五、 References\x3c\/h1\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.cnblogs.com\/justany\/archive\/2015\/04\/08\/4401118.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/www.cnblogs.com\/justa...\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/livoras\/blog\/issues\/13\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/livoras\/bl...\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/y8n\/blog\/issues\/5\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/y8n\/blog\/i...\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/medium.com\/@deathmood\/how-to-write-your-own-virtual-dom-ee74acc13060\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/medium.com\/@deathmood...\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/www.infoq.com\/cn\/articles\/react-dom-diff\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.infoq.com\/cn\/artic...\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>vitual-dom原理与简单实现</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012230659">https://segmentfault.com/a/1190000012230659</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/3xz3hfqu7af/" target="_blank">https://alili.tech/archive/3xz3hfqu7af/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>