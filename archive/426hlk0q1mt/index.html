<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="1.前端自动化测试 之 视觉测试"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>1.前端自动化测试 之 视觉测试 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/426hlk0q1mt/",
				"appid": "1613049289050283", 
				"title": "1.前端自动化测试 之 视觉测试 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-02T02:30:15"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/b067wzmi86/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/gb41upo7kq8/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f426hlk0q1mt%2f&text=1.%e5%89%8d%e7%ab%af%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%20%e4%b9%8b%20%e8%a7%86%e8%a7%89%e6%b5%8b%e8%af%95"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f426hlk0q1mt%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f426hlk0q1mt%2f&text=1.%e5%89%8d%e7%ab%af%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%20%e4%b9%8b%20%e8%a7%86%e8%a7%89%e6%b5%8b%e8%af%95"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f426hlk0q1mt%2f&title=1.%e5%89%8d%e7%ab%af%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%20%e4%b9%8b%20%e8%a7%86%e8%a7%89%e6%b5%8b%e8%af%95"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f426hlk0q1mt%2f&is_video=false&description=1.%e5%89%8d%e7%ab%af%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%20%e4%b9%8b%20%e8%a7%86%e8%a7%89%e6%b5%8b%e8%af%95"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=1.%e5%89%8d%e7%ab%af%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%20%e4%b9%8b%20%e8%a7%86%e8%a7%89%e6%b5%8b%e8%af%95&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f426hlk0q1mt%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f426hlk0q1mt%2f&title=1.%e5%89%8d%e7%ab%af%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%20%e4%b9%8b%20%e8%a7%86%e8%a7%89%e6%b5%8b%e8%af%95"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f426hlk0q1mt%2f&title=1.%e5%89%8d%e7%ab%af%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%20%e4%b9%8b%20%e8%a7%86%e8%a7%89%e6%b5%8b%e8%af%95"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f426hlk0q1mt%2f&title=1.%e5%89%8d%e7%ab%af%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%20%e4%b9%8b%20%e8%a7%86%e8%a7%89%e6%b5%8b%e8%af%95"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f426hlk0q1mt%2f&title=1.%e5%89%8d%e7%ab%af%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%20%e4%b9%8b%20%e8%a7%86%e8%a7%89%e6%b5%8b%e8%af%95"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">1.前端自动化测试 之 视觉测试</h1><div class="meta"><div class="postdate"><time datetime="2018-12-02" itemprop="datePublished">2018-12-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前端自动化测试 之 视觉测试\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014720180\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014720180\x22 alt=\x22image\x22 title=\x22image\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e前端测试分类\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9Vx4?w=1123\x26amp;h=794\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9Vx4?w=1123\x26amp;h=794\x22 alt=\x225ad6b227e0634.png\x22 title=\x225ad6b227e0634.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e前端测试主要分五大方向测试，而这五大方向也分很多小方向测试，首先简单的介绍每个方向的概念\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3cp\x3e界面样式测试\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e固定界面样式测试：主要针对文字内容不变的区域，例如页面的页头，页脚这类结构、内容不变的区域，而测试一般通过截图对比解决。\x3c\/li\x3e\n\x3cli\x3e结构不变界面样式测试：主要针对结构不变的区域，例如新闻区域这类结构不变，内容变化的区域，这类测试一般通过DOM元素对比解决。\x3c\/li\x3e\n\x3cli\x3e计算样式测试：主要针对计算样式不变的区域，这类测试一般通过比较计算样式解决，但是这种测试不推荐，因为测试成本比较大。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e功能测试\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e服务器数据预期测试：主要针对用户在前端界面进行某种操作后，提交数据给后台后，测试后台能否返回预期的数据\x3c\/li\x3e\n\x3cli\x3e界面功能测试：主要针对用户在前端界面进行某种交互性操作后，测试能否获取预期的功能、界面交互\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e多浏览器测试\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e多浏览器测试：基于界面样式测试、功能测试的基础上来进行不同浏览器的的测试，俗称兼容性测试。\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e性能测试\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e白屏时间：用户浏览器输入网址后至浏览器出现至少1px画面为止。\x3c\/li\x3e\n\x3cli\x3e首屏时间：用户浏览器首屏内所有的元素呈现所花费时间。\x3c\/li\x3e\n\x3cli\x3e页面回归时间：用户浏览器非第一次加载所有的元素呈现所花费时间。\x3c\/li\x3e\n\x3cli\x3e用户可操作时间(dom ready) ：网站某些功能可以使用的时间。\x3c\/li\x3e\n\x3cli\x3e页面总下载时间(onload):网站中所有资源加载完成并且可用时间。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e质量测试\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3ca href=\x22https:\/\/developer.yahoo.com\/performance\/rules.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e雅虎网站优化规则\x3c\/a\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e什么样的项目适合自动化测试呢？\x3c\/h1\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9VxT?w=866\x26amp;h=776\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9VxT?w=866\x26amp;h=776\x22 alt=\x225ae7f3fc745e7.png\x22 title=\x225ae7f3fc745e7.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如上图所示，真正工作中无法全部满足以上条件，所以需要作出权衡，一般来说，只需要满足以下几点，就可以对项目开展自动化测试（1.需求稳定\x3cbr\x3e不会频繁变更。2.多平台运行，组合遍历型，大量的重复任务。3.软件维护周期长，有生命力。4.被测系统开发较为规范，可测试性强。）：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e需求稳定，不会频繁变更\x3cp\x3e自动化测试最大的挑战就是需求的变化，而自动化脚本本身就需要修改、扩展、debug，去适应新的功能，如果投入产出比太低，那么自动化测试也失去了其价值和意义；\x3c\/p\x3e\n\x3cp\x3e折中的做法是选择相对稳定的模块和功能进行自动化测试，变动较大、需求变更较频繁的部分用手工测试；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e多平台运行，组合遍历型、大量的重复任务\x3cp\x3e测试数据、测试用例、自动化脚本的重用性和移植性较强，降低成本，提高效率和价值；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e软件维护周期长，有生命力\x3cp\x3e自动化测试的需求稳定性要求、自动化框架的设计、脚本开发与调试均需要时间，这其实也是一个软件开发过程，如果项目周期较短，没有足够的时间去支持这一过程，那自动化测试也就不需要了；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e被测系统开发较为规范，可测试性强\x3cp\x3e主要出于这几点考虑：被测试系统的架构差异、测试技术和工具的适应性、测试人员的能力能否设计开发出适应差异的自动化测试框架；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3e什么是UI测试\x3c\/h1\x3e\n\x3cp\x3e对于界面布局，传统的测试都是由人工对比设计图和产品界面。当界面有修改之后，再由人通过肉眼去检查修改(包括正确的和错误的修改)，这样即费时而且测试结果又不稳定，因为人工对比测试存在两个巨坑：1.效率低；2.人的不确定性。对于拥有大量复杂界面的Web应用，界面布局的测试的数量巨大，再加上这两个问题，导致这类应用的界面布局测试\/回归测试时间很长，成本很高，所以很多基于Agile(敏捷开发)项目基本不可能在迭代周期内高质量的完成其视觉测试。对于每天做一次，那更是不可能完成的任务。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader4\x22\x3e视觉感知测试\/视觉回归测试\x3c\/h1\x3e\n\x3cp\x3e为了解决上面提到的各种问题，视觉感知测试孕育而生。它使用传统的对图片进行二进制比较的办法，结合敏捷迭代开发的理念，产生的一种针对界面布局的自动化测试方法。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e视觉感知测试\x3c\/h2\x3e\n\x3cp\x3e视觉感知测试就是对第一个版本的所有界面进行第一次测试。\x3c\/p\x3e\n\x3cp\x3e视觉感知测试包含以下几个主要的测试步骤：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9VxQ?w=665\x26amp;h=1137\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9VxQ?w=665\x26amp;h=1137\x22 alt=\x225ae86eda2a1cc.jpg\x22 title=\x225ae86eda2a1cc.jpg\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e需要注意的是！\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e配对URL（忽略hostname）\x3cp\x3e通过配对URL，对所有的截图按照相同的URL进行分组。当然有时候会出现新的界面，有时候老的界面会被删除。对于新的界面就需要人工进行首次验证测试 。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e像素级别的图形比较\x3cp\x3e对于分组之后的截图进行像素级别的比较并生产差别图。有时候为了降噪，可以只对局部关心的组件进行比较。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e人工查看所有不同\x3cp\x3e最后通过人工审查差别图报告完成测试。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e视觉感知测试结果：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e预期(expected)\x3c\/th\x3e\n\x3cth\x3e实际(actual)\x3c\/th\x3e\n\x3cth\x3e比较结果(diff)\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\x3ctr\x3e\n\x3ctd\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014720181?w=438\x26amp;h=412\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014720181?w=438\x26amp;h=412\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014720182?w=438\x26amp;h=412\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014720182?w=438\x26amp;h=412\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014720183?w=438\x26amp;h=412\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014720183?w=438\x26amp;h=412\x22 alt=\x221diff\x22 title=\x221diff\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e视觉回归测试\x3c\/h2\x3e\n\x3cp\x3e我们认为如果一个界面通过第一次的人工验证并发布之后，它就是一个正确的标准界面，并且是包含了人工测试价值的资产。当下一次测试的时候，这部分价值就应该被保留并重用起来，用于减少新的一次测试的时间，从而实现界面的快速回归测试。\x3c\/p\x3e\n\x3cp\x3e视觉回归测试包含以下几个主要的测试步骤：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9VZL?w=657\x26amp;h=1260\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9VZL?w=657\x26amp;h=1260\x22 alt=\x225aebce31440f0.png\x22 title=\x225aebce31440f0.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e回归和感知测试流程差不多只是差异值要更小一点，并且只有效果图需要替换内容。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e视觉自动测试怎么做？\x3c\/h2\x3e\n\x3cp\x3e要进行视觉自动测试，有三种方式。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e第一种是截屏比对（局部、整页）。\x3c\/li\x3e\n\x3cli\x3e第二种通过JavaScript调用window.getComputedStyle()获取计算后的样式并进行断言。\x3c\/li\x3e\n\x3cli\x3e第三种dom结构对比加css样式对比。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e这三种各有明显的优势和不足。 第二种方式强绑定了实现，从而变得可能比较脆弱。 第一种方式离设计太近了，当页面中有可变内容时就会有问题。\x3cbr\x3e第三种方式，无法进行视觉感知测试结果只能进行视觉回归测试和上一版的dom继续比较差异。\x3c\/p\x3e\n\x3cp\x3e我更倾向与第一种截图对比；它的测试基于用户所见而不是用户所见的抽象。当然第三种也是非常好的 \x3ca href=\x22https:\/\/github.com\/fouber\/page-monitor\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epage-monitor\x3c\/a\x3e 有兴趣的朋友可以自行了解。为什么第三种那么好为什么不使用呢？因为上面这个库是基于phantomjs并且它的实现方式过于复杂不适合新手玩玩。\x3c\/p\x3e\n\x3ch4\x3e像素对比工具，有哪些？\x3c\/h4\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e名称\x3c\/th\x3e\n\x3cth\x3e地址\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3ePhantomCSS\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/HuddleEng\/PhantomCSS\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/HuddleEng\/...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eGhostStory\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/thingsinjars\/Hardy\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/thingsinja...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eCactus\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/winston\/cactus\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/winston\/ca...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eNeedle\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/python-needle\/needle\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/python-nee...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eCSSCritic\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/cburgmer\/csscritic\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/cburgmer\/c...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3esikuli\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22http:\/\/www.sikuli.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.sikuli.org\/\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eMogo\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22http:\/\/mogotest.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/mogotest.com\/\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3epixelmatch\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/mapbox\/pixelmatch\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/mapbox\/pix...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3epixel-diff\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/koola\/pixel-diff\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/koola\/pixe...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e好了介绍了那么多，怎么选一个合适的Headless Browser呢？\x3c\/p\x3e\n\x3cp\x3eHeadless Browser？？？我是视觉测试要无界面浏览器干嘛？\x3c\/p\x3e\n\x3cp\x3e因为有了像素对比工具我们还需要一个浏览器进行截图和设计图进行像素比较。\x3c\/p\x3e\n\x3ch4\x3e比较常见出名的几个Headless Browser，有哪些？\x3c\/h4\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e名称\x3c\/th\x3e\n\x3cth\x3e内核\x3c\/th\x3e\n\x3cth\x3e地址\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3ePuppeteer\x3c\/td\x3e\n\x3ctd\x3eWebkit\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/GoogleChrome\/puppeteer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/GoogleChro...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ePhantomJS\x3c\/td\x3e\n\x3ctd\x3eWebkit\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22http:\/\/phantomjs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/phantomjs.org\/\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eSlimerJS\x3c\/td\x3e\n\x3ctd\x3eGecko\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/laurentj\/slimerjs\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/laurentj\/s...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eTrifleJS\x3c\/td\x3e\n\x3ctd\x3eIE\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/sdesalas\/trifleJS\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/sdesalas\/t...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cblockquote\x3ePhantomJS 基于 Webkit 内核，不支持 Flash 的播放；SlimerJS 基于火狐的 Gecko 内核，支持 Flash播放，并且执行过程会有页面展示。\x3c\/blockquote\x3e\n\x3cp\x3e我们这里呢就只讲Webkit内核的，其他的我就不讲了。\x3c\/p\x3e\n\x3ch4\x3ePhantomJS简介：\x3c\/h4\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/phantomjs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ePhantomJS\x3c\/code\x3e\x3c\/a\x3e 是一个基于webkit的JavaScript API。它使用QtWebKit作为它核心浏览器的功能，使用webkit来编译解释执行JavaScript代码。任何你可以在基于webkit浏览器做的事情，它都能做到。它不仅是个隐形的浏览器，提供了诸如CSS选择器、支持Web标准、DOM操作、JSON、HTML5、Canvas、SVG等，同时也提供了处理文件I\/O的操作，从而使你可以向操作系统读写文件等。PhantomJS的用处可谓非常广泛，诸如网络监测、网页截屏、无需浏览器的 Web 测试、页面访问自动化等。\x3c\/p\x3e\n\x3cp\x3e但是 \x3ca href=\x22http:\/\/phantomjs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ePhantomJS\x3c\/code\x3e\x3c\/a\x3e 因为毕竟不是真实的用户浏览器环境，使用起来还是有不少的诟病。之前一直在使用 \x3ca href=\x22http:\/\/phantomjs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ePhantomJS\x3c\/code\x3e\x3c\/a\x3e ，功能虽然够用，不过和在真实的浏览器里面访问的界面来对比差别还是比较大的。\x3c\/p\x3e\n\x3ch4\x3ePuppeteer简介：\x3c\/h4\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/developers.google.com\/web\/tools\/puppeteer\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ePuppeteer\x3c\/code\x3e\x3c\/a\x3e是Chrome团队开发的一个Node库。它提供了一个高级API来控制无头或完整的Chrome。它通过使用Chrome无界面模式 \x3ca href=\x22https:\/\/developers.google.com\/web\/updates\/2017\/04\/headless-chrome\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e(\x3ccode\x3eHeadless Chrome\x3c\/code\x3e\x3c\/a\x3e )和\x3ca href=\x22https:\/\/developers.google.com\/web\/tools\/chrome-devtools\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3eDevTools\x3c\/code\x3e\x3c\/a\x3e协议的组合来实现这一点。它使用一个更上层的API来封装其功能，让用户界面测试自动化变得轻而易举。\x3cbr\x3e人们基于Chrome DevTools协议开发了一系列Google Chrome工具。你在浏览器中点击更多工具 -\x26gt;开发工具，打开的就是DevTools。DevTools协议是DevTools的动力基础，我们现在可以使用Chrome中的DevTools来做更多的事情。\x3c\/p\x3e\n\x3cp\x3e好了简介讲完了，我们来对比一下这两个Headless Browser的区别。\x3c\/p\x3e\n\x3ch5\x3e截图比较\x3c\/h5\x3e\n\x3ch5\x3e代码：\x3c\/h5\x3e\n\x3cp\x3ePhantomJS：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var page = require(\x27webpage\x27).create();\n\npage.viewportSize = { width: 400, height: 400 };\npage.open(\x26quot;http:\/\/localhost:8899\/VS\x26quot;, function(status) {\n    if (status === \x26quot;success\x26quot;) {\n        page.render(\x26quot;a.jpg\x26quot;);\n\n    } else {\n        console.log(\x26quot;Page failed to load.\x26quot;);\n    }\n    phantom.exit(0);\n});\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e page = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpage\x27\x3c\/span\x3e).create();\n\npage.viewportSize = { \x3cspan class=\x22hljs-attr\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e };\npage.open(\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/localhost:8899\/VS\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estatus\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (status === \x3cspan class=\x22hljs-string\x22\x3e\x22success\x22\x3c\/span\x3e) {\n        page.render(\x3cspan class=\x22hljs-string\x22\x3e\x22a.jpg\x22\x3c\/span\x3e);\n\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Page failed to load.\x22\x3c\/span\x3e);\n    }\n    phantom.exit(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n});\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ePuppeteer：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const puppeteer = require(\x27puppeteer\x27);\n\n(async() =\x3e {\n    const browser = await puppeteer.launch();\n    const page = await browser.newPage();\n    await page.goto(\x27http:\/\/localhost:8899\/VS\x27);\n\n    await page.setViewport({ width: 400, height: 400 })\n\n    \/\/保存图片\n    const images = await page.screenshot({ path: \x27VS.jpg\x27, fullPage: true, omitBackground: true });\n\n    \/\/关闭浏览器\n    await browser.close();\n\n})();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e puppeteer = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27puppeteer\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e(\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e browser = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e puppeteer.launch();\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e page = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e browser.newPage();\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.goto(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/localhost:8899\/VS\x27\x3c\/span\x3e);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.setViewport({ \x3cspan class=\x22hljs-attr\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e })\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/保存图片\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e images = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.screenshot({ \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27VS.jpg\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3efullPage\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eomitBackground\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e });\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/关闭浏览器\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e browser.close();\n\n})();\x3c\/code\x3e\x3c\/pre\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3ePuppeteer\x3c\/th\x3e\n\x3cth\x3ePhantomJS\x3c\/th\x3e\n\x3cth\x3eChrome浏览器\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\x3ctr\x3e\n\x3ctd\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9Vxr?w=400\x26amp;h=400\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9Vxr?w=400\x26amp;h=400\x22 alt=\x225ab35f3ecea48.jpg\x22 title=\x225ab35f3ecea48.jpg\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9Vxt?w=400\x26amp;h=520\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9Vxt?w=400\x26amp;h=520\x22 alt=\x225ab23225073a2.jpg\x22 title=\x225ab23225073a2.jpg\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9Vxz?w=400\x26amp;h=402\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9Vxz?w=400\x26amp;h=402\x22 alt=\x225ab361e464d76.png\x22 title=\x225ab361e464d76.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e浏览器效果（大图）：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9Vxh?w=426\x26amp;h=495\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9Vxh?w=426\x26amp;h=495\x22 alt=\x225ab232251f25b.png\x22 title=\x225ab232251f25b.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e好了看到这里已经可以分别出来胜负了。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader8\x22\x3e使用puppeteer进行视觉感知测试\x3c\/h1\x3e\n\x3cp\x3e我们来做一个简单的dome\x3c\/p\x3e\n\x3cp\x3e我们这里拿\x3ca href=\x22https:\/\/juejin.im\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e掘金\x3c\/a\x3e来做一个视觉感知测试的例子。\x3c\/p\x3e\n\x3cp\x3e1.首先创建项目名字就叫“PerceptionTest”把。\x3c\/p\x3e\n\x3cp\x3e2.安装依赖\x3c\/p\x3e\n\x3cp\x3e安装Puppeteer\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm install puppeteer --save\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sql\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpm \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e puppeteer \x3cspan class=\x22hljs-comment\x22\x3e--save\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e像素对比工具我就选我最常用的blink-dif了\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm install blink-diff --save\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs maxima\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpm install blink-\x3cspan class=\x22hljs-built_in\x22\x3ediff\x3c\/span\x3e --\x3cspan class=\x22hljs-built_in\x22\x3esave\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e3.依赖安完了我们来创建一个js文件“app.js”\x3c\/p\x3e\n\x3cp\x3e4.加载依赖\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const puppeteer = require(\x27puppeteer\x27),\/\/无头浏览器\n    BlinkDiff = require(\x27blink-diff\x27),\/\/像素对比\n    imgUrl = __dirname \x2b \x26quot;\/blink-diff_img\/\x26quot;;\/\/图片目录\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e puppeteer = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27puppeteer\x27\x3c\/span\x3e),\x3cspan class=\x22hljs-comment\x22\x3e\/\/无头浏览器\x3c\/span\x3e\n    BlinkDiff = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27blink-diff\x27\x3c\/span\x3e),\x3cspan class=\x22hljs-comment\x22\x3e\/\/像素对比\x3c\/span\x3e\n    imgUrl = __dirname \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22\/blink-diff_img\/\x22\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/图片目录\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e5.使用puppeteer进行截图\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(async () =\x3e {\n    \/\/创建puppeteer\n    const browser = await puppeteer.launch({ headless: true });\n    \/\/new 一个新的tab页面\n    const page = await browser.newPage();\n    \/\/设置浏览器的尺寸\n    await page.setViewport({ width: 1920, height: 945 });\n    \/\/打开url\n    await page.goto(\x27https:\/\/juejin.im\/\x27);\n    \/\/保存截图\n   await page.screenshot({ path: imgUrl \x2b \x27Screenshots.png\x27, fullPage: true });\n  \n    \/\/关闭浏览器\n    await browser.close();\n})();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e () =\x26gt; {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/创建puppeteer\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e browser = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e puppeteer.launch({ headless: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e });\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/new 一个新的tab页面\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e page = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e browser.newPage();\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置浏览器的尺寸\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.setViewport({ width: \x3cspan class=\x22hljs-number\x22\x3e1920\x3c\/span\x3e, height: \x3cspan class=\x22hljs-number\x22\x3e945\x3c\/span\x3e });\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/打开url\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.\x3cspan class=\x22hljs-keyword\x22\x3egoto\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/juejin.im\/\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/保存截图\x3c\/span\x3e\n   \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.screenshot({ path: imgUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27Screenshots.png\x27\x3c\/span\x3e, fullPage: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e });\n  \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/关闭浏览器\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e browser.close();\n})();\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e6.分析页面找到要替换的内容\x3c\/p\x3e\n\x3cp\x3e为什么要替换内容呢，因为我们UI测试指的是测试界面样式而不是去匹配里面的内容，如果不替换里面的内容那像素对比工具比较出来的相似度肯定很低。所以我们要替换掉内容，要让内容完整统一，我们才好更加精确的去比较差异。\x3c\/p\x3e\n\x3cp\x3e好了我们来分析一下要替换的内容。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9VwS?w=1447\x26amp;h=957\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9VwS?w=1447\x26amp;h=957\x22 alt=\x225aeb1fa0de449.png\x22 title=\x225aeb1fa0de449.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e要替换的内容如下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e标题\x3c\/li\x3e\n\x3cli\x3e标签\x3c\/li\x3e\n\x3cli\x3e作者\x3c\/li\x3e\n\x3cli\x3e发布时间\x3c\/li\x3e\n\x3cli\x3e阅读数\x3c\/li\x3e\n\x3cli\x3e列表图片\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e7.替换内容\x3c\/p\x3e\n\x3cp\x3epuppeteer提供了非常丰富的api，其中有个api叫page.evaluate可以向页面插入一段js。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 await page.evaluate(async () =\x3e {\n\n        \/\/列表\n        var Lists = document.querySelectorAll(\x26quot;div.feed.welcome__feed \x3e ul \x3e li \x3e div \x3e a \x3e div\x26quot;);\n        Lists.forEach(function (element, index, array) {\n\n            element.querySelector(\x26quot;a.title\x26quot;).innerHTML = \x26quot;测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试\x26quot;;\n\n            \/\/替换标签\n            element.querySelector(\x26quot;ul \x3e li.item.category \x3e span\x26quot;).innerHTML = \x26quot;测试\x26quot;;\n\n            \/\/替换作者\n            element.querySelector(\x26quot;ul \x3e li.item.username.clickable \x3e div \x3e a\x26quot;).innerHTML = \x26quot;测试\x26quot;;\n\n            \/\/替换发布时间\n            element.querySelector(\x26quot;div.info-row.meta-row \x3e ul \x3e li:nth-child(3)\x26quot;).innerHTML = \x26quot;9999天前\x26quot;;\n\n            \/\/替换发布时间\n            element.querySelector(\x26quot;div.info-row.meta-row \x3e ul \x3e li:nth-child(4)\x26quot;).innerHTML = \x26quot;99999999999 次阅读\x26quot;;\n\n            \/\/列表图片\n            if (element.querySelectorAll(\x26quot;div.lazy.thumb.thumb.loaded\x26quot;).length==1) {\n                element.querySelector(\x26quot;div.lazy.thumb.thumb.loaded\x26quot;).style.background = \x26quot;#fdedc9\x26quot;;\n            } else {\n                var loaded=document.createElement(\x26quot;div\x26quot;);\n                loaded.className=\x26quot; lazy thumb thumb loaded\x26quot;;\n                loaded.style.background = \x26quot;#fdedc9\x26quot;;\n                loaded.setAttribute(\x26quot;data-v-b2db8566\x26quot;,\x26quot;\x26quot;);\n                loaded.setAttribute(\x26quot;data-v-009ea7bb\x26quot;,\x26quot;\x26quot;);\n                loaded.setAttribute(\x26quot;data-v-f2ca14b0\x26quot;,\x26quot;\x26quot;);\n                element.appendChild(loaded);\n            }\n        });\n\n    });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dart\x22\x3e\x3ccode\x3e \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.evaluate(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e () =\x26gt; {\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/列表\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Lists = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3equerySelectorAll\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22div.feed.welcome__feed \x26gt; ul \x26gt; li \x26gt; div \x26gt; a \x26gt; div\x22\x3c\/span\x3e);\n        Lists.forEach(function (element, index, array) {\n\n            element.\x3cspan class=\x22hljs-built_in\x22\x3equerySelector\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22a.title\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x22测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试\x22\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/替换标签\x3c\/span\x3e\n            element.\x3cspan class=\x22hljs-built_in\x22\x3equerySelector\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22ul \x26gt; li.item.category \x26gt; span\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x22测试\x22\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/替换作者\x3c\/span\x3e\n            element.\x3cspan class=\x22hljs-built_in\x22\x3equerySelector\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22ul \x26gt; li.item.username.clickable \x26gt; div \x26gt; a\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x22测试\x22\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/替换发布时间\x3c\/span\x3e\n            element.\x3cspan class=\x22hljs-built_in\x22\x3equerySelector\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22div.info-row.meta-row \x26gt; ul \x26gt; li:nth-child(3)\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x229999天前\x22\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/替换发布时间\x3c\/span\x3e\n            element.\x3cspan class=\x22hljs-built_in\x22\x3equerySelector\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22div.info-row.meta-row \x26gt; ul \x26gt; li:nth-child(4)\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x2299999999999 次阅读\x22\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/列表图片\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (element.\x3cspan class=\x22hljs-built_in\x22\x3equerySelectorAll\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22div.lazy.thumb.thumb.loaded\x22\x3c\/span\x3e).length==\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n                element.\x3cspan class=\x22hljs-built_in\x22\x3equerySelector\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22div.lazy.thumb.thumb.loaded\x22\x3c\/span\x3e).style.background = \x3cspan class=\x22hljs-string\x22\x3e\x22#fdedc9\x22\x3c\/span\x3e;\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e loaded=\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x22div\x22\x3c\/span\x3e);\n                loaded.className=\x3cspan class=\x22hljs-string\x22\x3e\x22 lazy thumb thumb loaded\x22\x3c\/span\x3e;\n                loaded.style.background = \x3cspan class=\x22hljs-string\x22\x3e\x22#fdedc9\x22\x3c\/span\x3e;\n                loaded.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x22data-v-b2db8566\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\n                loaded.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x22data-v-009ea7bb\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\n                loaded.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x22data-v-f2ca14b0\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\n                element.appendChild(loaded);\n            }\n        });\n\n    });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e8.使用Blink-Diff进行像素对比较\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const diff = new BlinkDiff({\n        imageAPath: imgUrl \x2b \x27example.png\x27, \/\/ 设计图\n        imageBPath: imgUrl \x2b \x27Screenshots.png\x27,\/\/页面截图\n        \/\/低于其中差异的像素数\/ p（默认值：500） - 百分比阈值：1 = 100％，0.2 = 20％\n        threshold: 0.02, \/\/ 1% threshold\n        imageOutputPath: imgUrl \x2b \x27Diff.png\x27\/\/Diff路径\n    });\n\n    diff.run(function (error, result) {\n        if (error) {\n            throw error;\n        } else {\n            console.log(diff.hasPassed(result.code) ? \x27通过\x27 : \x27失败\x27);\n            console.log(\x27总像素:\x27 \x2b result.dimension);\n            console.log(\x27发现:\x27 \x2b result.differences \x2b \x27 差异.\x27);\n        }\n    });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e diff = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e BlinkDiff({\n        \x3cspan class=\x22hljs-attr\x22\x3eimageAPath\x3c\/span\x3e: imgUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27example.png\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设计图\x3c\/span\x3e\n        imageBPath: imgUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27Screenshots.png\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-comment\x22\x3e\/\/页面截图\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/低于其中差异的像素数\/ p（默认值：500） - 百分比阈值：1 = 100％，0.2 = 20％\x3c\/span\x3e\n        threshold: \x3cspan class=\x22hljs-number\x22\x3e0.02\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1% threshold\x3c\/span\x3e\n        imageOutputPath: imgUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27Diff.png\x27\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/Diff路径\x3c\/span\x3e\n    });\n\n    diff.run(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerror, result\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (error) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e error;\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(diff.hasPassed(result.code) ? \x3cspan class=\x22hljs-string\x22\x3e\x27通过\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27失败\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27总像素:\x27\x3c\/span\x3e \x2b result.dimension);\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27发现:\x27\x3c\/span\x3e \x2b result.differences \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 差异.\x27\x3c\/span\x3e);\n        }\n    });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e完整代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const puppeteer = require(\x27puppeteer\x27),\n    BlinkDiff = require(\x27blink-diff\x27),\n    imgUrl = __dirname \x2b \x26quot;\/blink-diff_img\/\x26quot;;\n\n(async () =\x3e {\n    const browser = await puppeteer.launch({ headless: true });\n    const page = await browser.newPage();\n    await page.setViewport({ width: 1920, height: 945 });\n    await page.goto(\x27https:\/\/juejin.im\/\x27);\n\n\n\n    await page.evaluate(async () =\x3e {\n\n        \/\/列表\n        var Lists = document.querySelectorAll(\x26quot;div.feed.welcome__feed \x3e ul \x3e li \x3e div \x3e a \x3e div\x26quot;);\n        Lists.forEach(function (element, index, array) {\n\n            element.querySelector(\x26quot;a.title\x26quot;).innerHTML = \x26quot;测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试\x26quot;;\n\n            \/\/替换标签\n            element.querySelector(\x26quot;ul \x3e li.item.category \x3e span\x26quot;).innerHTML = \x26quot;测试\x26quot;;\n\n            \/\/替换作者\n            element.querySelector(\x26quot;ul \x3e li.item.username.clickable \x3e div \x3e a\x26quot;).innerHTML = \x26quot;测试\x26quot;;\n\n            \/\/替换发布时间\n            element.querySelector(\x26quot;div.info-row.meta-row \x3e ul \x3e li:nth-child(3)\x26quot;).innerHTML = \x26quot;9999天前\x26quot;;\n\n            \/\/替换发布时间\n            element.querySelector(\x26quot;div.info-row.meta-row \x3e ul \x3e li:nth-child(4)\x26quot;).innerHTML = \x26quot;99999999999 次阅读\x26quot;;\n\n            \/\/列表图片\n            if (element.querySelectorAll(\x26quot;div.lazy.thumb.thumb.loaded\x26quot;).length==1) {\n                element.querySelector(\x26quot;div.lazy.thumb.thumb.loaded\x26quot;).style.background = \x26quot;#fdedc9\x26quot;;\n            } else {\n                var loaded=document.createElement(\x26quot;div\x26quot;);\n                loaded.className=\x26quot; lazy thumb thumb loaded\x26quot;;\n                loaded.style.background = \x26quot;#fdedc9\x26quot;;\n                loaded.setAttribute(\x26quot;data-v-b2db8566\x26quot;,\x26quot;\x26quot;);\n                loaded.setAttribute(\x26quot;data-v-009ea7bb\x26quot;,\x26quot;\x26quot;);\n                loaded.setAttribute(\x26quot;data-v-f2ca14b0\x26quot;,\x26quot;\x26quot;);\n                element.appendChild(loaded);\n            }\n        });\n\n    });\n\n    await page.screenshot({ path: imgUrl \x2b \x27Screenshots.png\x27, fullPage: true });\n\n    const diff = new BlinkDiff({\n        imageAPath: imgUrl \x2b \x27example.png\x27, \/\/ 设计图\n        imageBPath: imgUrl \x2b \x27Screenshots.png\x27,\/\/页面截图\n        threshold: 0.02, \/\/ 1% threshold\n        imageOutputPath: imgUrl \x2b \x27Diff.png\x27\/\/Diff路径\n    });\n\n    diff.run(function (error, result) {\n        if (error) {\n            throw error;\n        } else {\n            console.log(diff.hasPassed(result.code) ? \x27通过\x27 : \x27失败\x27);\n            console.log(\x27总像素:\x27 \x2b result.dimension);\n            console.log(\x27发现:\x27 \x2b result.differences \x2b \x27 差异.\x27);\n        }\n    });\n\n\n    \/\/关闭puppeteer\n    await browser.close();\n})();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e puppeteer = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27puppeteer\x27\x3c\/span\x3e),\n    BlinkDiff = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27blink-diff\x27\x3c\/span\x3e),\n    imgUrl = __dirname \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22\/blink-diff_img\/\x22\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e browser = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e puppeteer.launch({ \x3cspan class=\x22hljs-attr\x22\x3eheadless\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e });\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e page = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e browser.newPage();\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.setViewport({ \x3cspan class=\x22hljs-attr\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1920\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e945\x3c\/span\x3e });\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.goto(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/juejin.im\/\x27\x3c\/span\x3e);\n\n\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.evaluate(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e () =\x26gt; {\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/列表\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Lists = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelectorAll(\x3cspan class=\x22hljs-string\x22\x3e\x22div.feed.welcome__feed \x26gt; ul \x26gt; li \x26gt; div \x26gt; a \x26gt; div\x22\x3c\/span\x3e);\n        Lists.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eelement, index, array\x3c\/span\x3e) \x3c\/span\x3e{\n\n            element.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x22a.title\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x22测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试\x22\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/替换标签\x3c\/span\x3e\n            element.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x22ul \x26gt; li.item.category \x26gt; span\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x22测试\x22\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/替换作者\x3c\/span\x3e\n            element.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x22ul \x26gt; li.item.username.clickable \x26gt; div \x26gt; a\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x22测试\x22\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/替换发布时间\x3c\/span\x3e\n            element.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x22div.info-row.meta-row \x26gt; ul \x26gt; li:nth-child(3)\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x229999天前\x22\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/替换发布时间\x3c\/span\x3e\n            element.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x22div.info-row.meta-row \x26gt; ul \x26gt; li:nth-child(4)\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x2299999999999 次阅读\x22\x3c\/span\x3e;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/列表图片\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (element.querySelectorAll(\x3cspan class=\x22hljs-string\x22\x3e\x22div.lazy.thumb.thumb.loaded\x22\x3c\/span\x3e).length==\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n                element.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x22div.lazy.thumb.thumb.loaded\x22\x3c\/span\x3e).style.background = \x3cspan class=\x22hljs-string\x22\x3e\x22#fdedc9\x22\x3c\/span\x3e;\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e loaded=\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x22div\x22\x3c\/span\x3e);\n                loaded.className=\x3cspan class=\x22hljs-string\x22\x3e\x22 lazy thumb thumb loaded\x22\x3c\/span\x3e;\n                loaded.style.background = \x3cspan class=\x22hljs-string\x22\x3e\x22#fdedc9\x22\x3c\/span\x3e;\n                loaded.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x22data-v-b2db8566\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\n                loaded.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x22data-v-009ea7bb\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\n                loaded.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x22data-v-f2ca14b0\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\n                element.appendChild(loaded);\n            }\n        });\n\n    });\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e page.screenshot({ \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: imgUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27Screenshots.png\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3efullPage\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e });\n\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e diff = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e BlinkDiff({\n        \x3cspan class=\x22hljs-attr\x22\x3eimageAPath\x3c\/span\x3e: imgUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27example.png\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设计图\x3c\/span\x3e\n        imageBPath: imgUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27Screenshots.png\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-comment\x22\x3e\/\/页面截图\x3c\/span\x3e\n        threshold: \x3cspan class=\x22hljs-number\x22\x3e0.02\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1% threshold\x3c\/span\x3e\n        imageOutputPath: imgUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27Diff.png\x27\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/Diff路径\x3c\/span\x3e\n    });\n\n    diff.run(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerror, result\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (error) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e error;\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(diff.hasPassed(result.code) ? \x3cspan class=\x22hljs-string\x22\x3e\x27通过\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27失败\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27总像素:\x27\x3c\/span\x3e \x2b result.dimension);\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27发现:\x27\x3c\/span\x3e \x2b result.differences \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 差异.\x27\x3c\/span\x3e);\n        }\n    });\n\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/关闭puppeteer\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e browser.close();\n})();\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e差异图\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e有差异\x3c\/th\x3e\n\x3cth\x3e无差异\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\x3ctr\x3e\n\x3ctd\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9Vwb?w=1920\x26amp;h=4731\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9Vwb?w=1920\x26amp;h=4731\x22 alt=\x225aeb373a1fa34.png\x22 title=\x225aeb373a1fa34.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9Vwl?w=1920\x26amp;h=4731\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9Vwl?w=1920\x26amp;h=4731\x22 alt=\x225aeb3773ec472.png\x22 title=\x225aeb3773ec472.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3ch1 id=\x22articleHeader9\x22\x3egit完整代码\x3c\/h1\x3e\n\x3cp\x3egit完整代码：\x3ca href=\x22https:\/\/github.com\/my07ke\/Perception_test\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/my07ke\/Per...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e好了，欲知后事如何,请听下回分解。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9Wec?w=478\x26amp;h=342\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9Wec?w=478\x26amp;h=342\x22 alt=\x225aebd8bbb1762.gif\x22 title=\x225aebd8bbb1762.gif\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e点击链接加入群聊【前端|WEB|CSS|Javascript|HTML】：\x3ca href=\x22https:\/\/jq.qq.com\/?_wv=1027\x26amp;k=5hGQc2J\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/jq.qq.com\/?_wv=1027\x26amp;k...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader10\x22\x3e参考：\x3c\/h1\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.cnblogs.com\/imyalost\/p\/7241170.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e浅谈UI自动化测试\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.infoq.com\/cn\/articles\/visual-perception-test\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e视觉感知测试\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>1.前端自动化测试 之 视觉测试</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014720175">https://segmentfault.com/a/1190000014720175</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/426hlk0q1mt/" target="_blank">https://alili.tech/archive/426hlk0q1mt/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>