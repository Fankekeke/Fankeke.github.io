<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="使用Jest测试Vuex Action"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>使用Jest测试Vuex Action | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4984842d/",
				"appid": "1613049289050283", 
				"title": "使用Jest测试Vuex Action | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-10-19T00:00:00"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/8d876f92/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/53106638/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4984842d%2f&text=%e4%bd%bf%e7%94%a8Jest%e6%b5%8b%e8%af%95Vuex%20Action"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4984842d%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4984842d%2f&text=%e4%bd%bf%e7%94%a8Jest%e6%b5%8b%e8%af%95Vuex%20Action"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4984842d%2f&title=%e4%bd%bf%e7%94%a8Jest%e6%b5%8b%e8%af%95Vuex%20Action"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4984842d%2f&is_video=false&description=%e4%bd%bf%e7%94%a8Jest%e6%b5%8b%e8%af%95Vuex%20Action"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bd%bf%e7%94%a8Jest%e6%b5%8b%e8%af%95Vuex%20Action&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4984842d%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4984842d%2f&title=%e4%bd%bf%e7%94%a8Jest%e6%b5%8b%e8%af%95Vuex%20Action"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4984842d%2f&title=%e4%bd%bf%e7%94%a8Jest%e6%b5%8b%e8%af%95Vuex%20Action"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4984842d%2f&title=%e4%bd%bf%e7%94%a8Jest%e6%b5%8b%e8%af%95Vuex%20Action"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4984842d%2f&title=%e4%bd%bf%e7%94%a8Jest%e6%b5%8b%e8%af%95Vuex%20Action"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">使用Jest测试Vuex Action</h1><div class="meta"><div class="postdate"><time datetime="2018-10-19" itemprop="datePublished">2018-10-19</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3cp\x3e在隔离状态下测试Action是非常直接的。action应该与调用它的组件解耦，独立的进行测试。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/lmiller1990.github.io\/vue-testing-handbook\/vuex-in-components-mutations-and-actions.html\x22\x3e本文\x3c\/a\x3e主要讲述在组件中正确的测试action\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e我正在书写一本关于VUE应用程序测试的\x3ca href=\x22https:\/\/lmiller1990.github.io\/vue-testing-handbook\/\x22\x3e开源书籍\x3c\/a\x3e。它包括Vue组件、Vuex和Vue Router。\x3ca href=\x22https:\/\/lmiller1990.github.io\/vue-testing-handbook\/\x22\x3e这是一些来源和贡献指南\x3c\/a\x3e（欢迎所有人提出idea）\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3e本文中涉及到的测试代码\x3c\/em\x3e \x3ca href=\x22https:\/\/github.com\/lmiller1990\/vue-testing-handbook\/tree\/master\/demo-app\/tests\/unit\/actions.spec.js\x22\x3e点击查看\x3c\/a\x3e\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3\x3e创建 Action\x3c\/h3\x3e\n\x3cp\x3e我们先按照普通Vuex模式写一个action。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e对API进行异步调用\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e对数据做一些处理（可选）\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e把结果作为moutation的参数进行提交\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e有一个身份验证action，它将用户名和密码发送到外部API，检查它们是否匹配。然后提交SET_AUTHENTICATED moutation 来更新状态。\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01cbc30c6bef7323c7.jpg\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3eaction 测试 assert:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3eapi调用正确吗？\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3epayload正确吗？\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e提交mutation正确吗？\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e让我们继续写测试，让失败的消息指导我们。\x3c\/p\x3e\n\x3ch3\x3e测试\x3c\/h3\x3e\n\x3cp\x3e\x3cimg src=\x22\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e由于axios是异步的，为了确保Jest等待测试完成，我们需要将其声明为异步的，然后等待对action.authenticate的调用。否则，测试将在预期断言之前完成，我们将会看到一个常青树一样的测试——一个永远不会失败的测试。\x3c\/p\x3e\n\x3cp\x3e运行上面的测试给了我们以下的失败信息：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01cbc30c6bef7323c7.jpg\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e这个错误来自Axios内部。我们正在向\/api...发出请求，并且由于我们在测试环境中运行，所以甚至没有服务器向其发出请求，因此出现错误。我们也没有定义url或bod，我们应该这样做\x3c\/p\x3e\n\x3cp\x3e由于我们正在使用Jest，所以可以很容易地使用jest.mock模拟API调用。我们将使用模拟的axios,而不是真实的axios，这将使我们对它的行为有更多的处理。JEST提供了\x3ca href=\x22https:\/\/jestjs.io\/docs\/en\/es6-class-mocks\x22\x3eES6 Class Mocks\x3c\/a\x3e，这是一个非常适合模拟axios的工具。\x3c\/p\x3e\n\x3cp\x3eaxios 模拟如下\x3c\/p\x3e\n\x3cp\x3eaxios 模拟如下\x3c\/p\x3e\n\x3cp\x3e我们将url和body保存到变量中，由于我们可以确定返回值是正确的。因此不需要等待返回值，我们可以立即给API调用的promise返回resolve（成功）\x3c\/p\x3e\n\x3cp\x3e测试通过\x3c\/p\x3e\n\x3ch3\x3e测试api的异常情况\x3c\/h3\x3e\n\x3cp\x3e我们只测试了API调用成功的情况。测试所有可能的结果是很重要的。让我们为发生错误的情况写一个测试。这一次，我们先写测试，然后再执行。\x3c\/p\x3e\n\x3cp\x3e测试用例可以写成这样:\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01cbc30c6bef7323c7.jpg\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e我们需要找到一种方法来强制axios模拟抛出一个错误，我们选择使用MockError变量。更新axios模拟：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01cbc30c6bef7323c7.jpg\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e如果变量名称是用mock预置的话， JEST允许在ES6类模拟中访问外部变量。现在我们可以简单地写mockError＝true，AXIOS将抛出一个错误。\x3c\/p\x3e\n\x3cp\x3e运行这个测试给我们错误信息如下:\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01cbc30c6bef7323c7.jpg\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e成功地捕获了一个错误……但不是我们预期的那个错误。更新身份验证以抛出测试所预期的错误：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01cbc30c6bef7323c7.jpg\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e测试通过。\x3c\/p\x3e\n\x3ch3\x3e改进\x3c\/h3\x3e\n\x3cp\x3e现在你知道如何孤立地测试action了。至少有一个可能成功的优化， 作为一个 \x3ca href=\x22https:\/\/jestjs.io\/docs\/en\/manual-mocks\x22\x3emanual mock\x3c\/a\x3e调用axion 模拟.（https：\/ \/ jestjs。IO \/文档\/ EN \/手动嘲笑）。在node_modules同级创建一个\x3cstrong\x3eMOCK\x3c\/strong\x3e目录，并在那里实现模拟模块。\x3c\/p\x3e\n\x3cp\x3e通过使用手动模拟，您可以在所有测试中共享模拟实现。JEST将自动使用\x3cstrong\x3eMOCK\x3c\/strong\x3e模拟实现。在Jest网站和互联网上有很多关于如何做到这一点的例子。使用手动模拟重构这个测试作为练习留给读者。\x3c\/p\x3e\n\x3ch3\x3e结论\x3c\/h3\x3e\n\x3cp\x3e本文指南:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e使用 Jest ES6 class 模拟\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e测试action成功个和失败的情况\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e在\x3ca href=\x22https:\/\/github.com\/lmiller1990\/vue-testing-handbook\/tree\/master\/demo-app\/tests\/unit\/actions.spec.js\x22\x3e这里\x3c\/a\x3e可以找到本页描述的测试的源代码\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>原文链接: <a href="https://www.zcfy.cc/article/testing-vuex-actions-correctly-with-jest">https://www.zcfy.cc/article/testing-vuex-actions-correctly-with-jest</a> 原文标题: 使用Jest测试Vuex Action 本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2>本文链接：</h2><a href="https://alili.tech/archive/4984842d/" target="_blank">https://alili.tech/archive/4984842d/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>