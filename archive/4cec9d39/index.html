<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="在React中跨组件分发状态的三种方法"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>在React中跨组件分发状态的三种方法 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4cec9d39/",
				"appid": "1613049289050283", 
				"title": "在React中跨组件分发状态的三种方法 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-10-18T00:00:00"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/d3f22047/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/e3f771f8/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4cec9d39%2f&text=%e5%9c%a8React%e4%b8%ad%e8%b7%a8%e7%bb%84%e4%bb%b6%e5%88%86%e5%8f%91%e7%8a%b6%e6%80%81%e7%9a%84%e4%b8%89%e7%a7%8d%e6%96%b9%e6%b3%95"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4cec9d39%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4cec9d39%2f&text=%e5%9c%a8React%e4%b8%ad%e8%b7%a8%e7%bb%84%e4%bb%b6%e5%88%86%e5%8f%91%e7%8a%b6%e6%80%81%e7%9a%84%e4%b8%89%e7%a7%8d%e6%96%b9%e6%b3%95"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4cec9d39%2f&title=%e5%9c%a8React%e4%b8%ad%e8%b7%a8%e7%bb%84%e4%bb%b6%e5%88%86%e5%8f%91%e7%8a%b6%e6%80%81%e7%9a%84%e4%b8%89%e7%a7%8d%e6%96%b9%e6%b3%95"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4cec9d39%2f&is_video=false&description=%e5%9c%a8React%e4%b8%ad%e8%b7%a8%e7%bb%84%e4%bb%b6%e5%88%86%e5%8f%91%e7%8a%b6%e6%80%81%e7%9a%84%e4%b8%89%e7%a7%8d%e6%96%b9%e6%b3%95"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%9c%a8React%e4%b8%ad%e8%b7%a8%e7%bb%84%e4%bb%b6%e5%88%86%e5%8f%91%e7%8a%b6%e6%80%81%e7%9a%84%e4%b8%89%e7%a7%8d%e6%96%b9%e6%b3%95&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4cec9d39%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4cec9d39%2f&title=%e5%9c%a8React%e4%b8%ad%e8%b7%a8%e7%bb%84%e4%bb%b6%e5%88%86%e5%8f%91%e7%8a%b6%e6%80%81%e7%9a%84%e4%b8%89%e7%a7%8d%e6%96%b9%e6%b3%95"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4cec9d39%2f&title=%e5%9c%a8React%e4%b8%ad%e8%b7%a8%e7%bb%84%e4%bb%b6%e5%88%86%e5%8f%91%e7%8a%b6%e6%80%81%e7%9a%84%e4%b8%89%e7%a7%8d%e6%96%b9%e6%b3%95"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4cec9d39%2f&title=%e5%9c%a8React%e4%b8%ad%e8%b7%a8%e7%bb%84%e4%bb%b6%e5%88%86%e5%8f%91%e7%8a%b6%e6%80%81%e7%9a%84%e4%b8%89%e7%a7%8d%e6%96%b9%e6%b3%95"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4cec9d39%2f&title=%e5%9c%a8React%e4%b8%ad%e8%b7%a8%e7%bb%84%e4%bb%b6%e5%88%86%e5%8f%91%e7%8a%b6%e6%80%81%e7%9a%84%e4%b8%89%e7%a7%8d%e6%96%b9%e6%b3%95"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">在React中跨组件分发状态的三种方法</h1><div class="meta"><div class="postdate"><time datetime="2018-10-18" itemprop="datePublished">2018-10-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3cp\x3e当我问自己第一百次时，我正在研究一个典型的CRUD屏幕：“我应该将状态保留在这个组件中还是将其移动到父组件？”。\x3c\/p\x3e\n\x3cp\x3e如果需要对子组件的状态进行轻微控制。您可能也遇到了同样的问题。\x3c\/p\x3e\n\x3cp\x3e让我们通过一个简单的例子和​​三种修复方法来回顾它。前两种方法是常见的做法，第三种方法不太常规。\x3c\/p\x3e\n\x3ch4\x3e问题；\x3c\/h4\x3e\n\x3cp\x3e为了向您展示我的意思，我将使用一个简单的书籍CRUD（译者注：增加(Create)、读取查询(Retrieve)、更新(Update)和删除(Delete)）屏幕（如此简单，它没有创建和删除操作）。\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01eecbae26e9983a87.png\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e我们有三个组成部分。\x3ccode\x3e\x26lt;BookList \/\x26gt;\x3c\/code\x3e是一个组件，显示了用于编辑它们的书籍和按钮列表。\x3ccode\x3e\x26lt;BookForm \/\x26gt;\x3c\/code\x3e有两个输入和一个按钮，用于保存对书籍的更改。以及包含其他两个组件的\x3ccode\x3e\x26lt;BookApp \/\x26gt;\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e那么，我们的状态是什么？好吧，\x26lt;BookApp \/\x26gt;应该跟踪书籍清单以及识别当前正在编辑的书籍的内容。 \x26lt;BookList \/\x26gt;没有任何状态。并且\x26lt;BookForm \/\x26gt;应该保持输入的当前状态，直到单击“保存”按钮。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs pf\x22\x3eimport React, { Component } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22react\x22\x3c\/span\x3e;\nimport { render } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22react-dom\x22\x3c\/span\x3e;\n\nconst books = [\n  {\n    title: \x3cspan class=\x22hljs-string\x22\x3e\x22The End of Eternity\x22\x3c\/span\x3e,\n    author: \x3cspan class=\x22hljs-string\x22\x3e\x22Isaac Asimov\x22\x3c\/span\x3e\n  },\n  \/\/...\n];\n\nconst BookList = ({ books, \x3cspan class=\x22hljs-keyword\x22\x3eon\x3c\/span\x3eEdit }) =\x26gt; (\n  \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;table\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;tr\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;th\x26gt;\x3c\/span\x3eBook Title\x26lt;\/th\x26gt;\n      \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;th\x26gt;\x3c\/span\x3eActions\x26lt;\/th\x26gt;\n    \x26lt;\/tr\x26gt;\n    {books.map((book, index) =\x26gt; (\n      \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;tr key={index}\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;td\x26gt;\x3c\/span\x3e{book.title}\x26lt;\/td\x26gt;\n        \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;td\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;button onClick={() =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eon\x3c\/span\x3eEdit(index)}\x26gt;Edit\x26lt;\/button\x26gt;\n        \x26lt;\/td\x26gt;\n      \x26lt;\/tr\x26gt;\n    ))}\n  \x26lt;\/table\x26gt;\n);\n\nclass BookForm extends Component {\n  \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e = { ...this.props.book };\n  render() {\n    if (!this.props.book) return null;\n    return (\n      \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;form\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;h3\x26gt;\x3c\/span\x3eBook\x26lt;\/h3\x26gt;\n        \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;label\x26gt;\x3c\/span\x3e\n          Title:\n          \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;input\n            value={this.state.title}\n            onChange={e =\x26gt;\x3c\/span\x3e this.\x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3eState({ title: e.target.value })}\n          \/\x26gt;\n        \x26lt;\/label\x26gt;\n        \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;label\x26gt;\x3c\/span\x3e\n          Author:\n          \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;input\n            value={this.state.author}\n            onChange={e =\x26gt;\x3c\/span\x3e this.\x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3eState({ author: e.target.value })}\n          \/\x26gt;\n        \x26lt;\/label\x26gt;\n        \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;button onClick={() =\x26gt;\x3c\/span\x3e this.props.\x3cspan class=\x22hljs-keyword\x22\x3eon\x3c\/span\x3eSave({ ...this.\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e })}\x26gt;\n          Save\n        \x26lt;\/button\x26gt;\n      \x26lt;\/form\x26gt;\n    );\n  }\n}\n\nclass BookApp extends Component {\n  \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e = {\n    books: books,\n    activeIndex: -\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n  };\n  render() {\n    const { books, activeIndex } = this.\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e;\n    const activeBook = books[activeIndex];\n    return (\n      \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;div\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;BookList\n          books={books}\n          onEdit={index =\x26gt;\x3c\/span\x3e\n            this.\x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3eState({\n              activeIndex: index\n            })}\n        \/\x26gt;\n        \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;BookForm\n          book={activeBook}\n          onSave={book =\x26gt;\x3c\/span\x3e\n            this.\x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3eState({\n              books: Object.assign([...books], { [activeIndex]: book }),\n              activeIndex: -\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n            })}\n        \/\x26gt;\n      \x26lt;\/div\x26gt;\n    );\n  }\n}\n\nrender(\x3cspan class=\x22hljs-variable\x22\x3e\x26lt;BookApp \/\x26gt;\x3c\/span\x3e, document.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22root\x22\x3c\/span\x3e));\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在\x3ca href=\x22https:\/\/codesandbox.io\/s\/1oo33rkk3j\x22\x3ecodesandbox\x3c\/a\x3e尝试一下\x3c\/p\x3e\n\x3cp\x3e看起来不错，但是他不起作用。\x3c\/p\x3e\n\x3cp\x3e我们正在创建组件实例时初始化\x26lt;BookForm \/\x26gt;状态，因此，当从列表中选择另一本书时，父级无法让它知道它需要更改它。\x3c\/p\x3e\n\x3cp\x3e我们正在创建组件实例时初始化\x26lt;BookForm \/\x26gt;状态，因此，当从列表中选择另一本书时，父级无法让它知道它需要更改它。\x3c\/p\x3e\n\x3ch4\x3e方法1：受控组件\x3c\/h4\x3e\n\x3cp\x3e一种常见的方法是将状态提升，将\x26lt;BookForm \/\x26gt;转换为受控组件。我们删除\x26lt;BookForm \/\x26gt;状态，将activeBook添加到\x26lt;BookApp \/\x26gt;状态，并向\x26lt;BookForm \/\x26gt;添加一个onChange道具，我们在每次输入时都会调用它。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs scala\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eBookForm\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.book) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;form\x26gt;\n        \x26lt;h3\x26gt;\x3cspan class=\x22hljs-type\x22\x3eBook\x3c\/span\x3e\x26lt;\/h3\x26gt;\n        \x26lt;label\x26gt;\n          \x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e:\n          \x26lt;input\n            value={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.book.title}\n            onChange={e =\x26gt;\n              \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.onChange({\n                ...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.book,\n                title: e.target.value\n              })}\n          \/\x26gt;\n        \x26lt;\/label\x26gt;\n        \x26lt;label\x26gt;\n          \x3cspan class=\x22hljs-type\x22\x3eAuthor\x3c\/span\x3e:\n          \x26lt;input\n            value={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.book.author}\n            onChange={e =\x26gt;\n              \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.onChange({\n                ...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.book,\n                author: e.target.value\n              })}\n          \/\x26gt;\n        \x26lt;\/label\x26gt;\n        \x26lt;button onClick={() =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.onSave()}\x26gt;\x3cspan class=\x22hljs-type\x22\x3eSave\x3c\/span\x3e\x26lt;\/button\x26gt;\n      \x26lt;\/form\x26gt;\n    );\n  }\n}\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eBookApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  state = {\n    books: books,\n    activeBook: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e,\n    activeIndex: \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e\n  };\n  render() {\n    const { books, activeBook, activeIndex } = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;div\x26gt;\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eBookList\x3c\/span\x3e\n          books={books}\n          onEdit={index =\x26gt;\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n              activeBook: { ...books[index] },\n              activeIndex: index\n            })}\n        \/\x26gt;\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eBookForm\x3c\/span\x3e\n          book={activeBook}\n          onChange={book =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ activeBook: book })}\n          onSave={() =\x26gt;\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n              books: \x3cspan class=\x22hljs-type\x22\x3eObject\x3c\/span\x3e.assign([...books], { [activeIndex]: activeBook }),\n              activeBook: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e,\n              activeIndex: \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e\n            })}\n        \/\x26gt;\n      \x26lt;\/div\x26gt;\n    );\n  }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在\x3ca href=\x22https:\/\/codesandbox.io\/s\/93y9oprw\x22\x3ecodesandbox\x3c\/a\x3e尝试一下\x3c\/p\x3e\n\x3cp\x3e现在它可以工作，但对我来说，提升\x3ccode\x3e\x26amp;lt;BookForm \/\x26amp;gt;\x3c\/code\x3e的状态感觉不对。在用户单击“保存”之前，\x3ccode\x3e\x26amp;lt;BookApp \/\x26amp;gt;\x3c\/code\x3e不关心对书的任何更改，那么为什么需要将其保持在自己的状态？\x3c\/p\x3e\n\x3ch4\x3e方法2：同步state\x3c\/h4\x3e\n\x3cp\x3e现在它可以工作，但对我来说，提升\x26lt;BookForm \/\x26gt;的状态感觉不对。在用户单击“保存”之前，\x26lt;BookApp \/\x26gt;不关心对书的任何更改，那么为什么需要将其保持在自己的状态？\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs kotlin\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eBookForm\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  state = { ...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.book };\n  componentWillReceiveProps(nextProps) {\n    const nextBook = nextProps.book;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.book !== nextBook) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ ...nextBook });\n    }\n  }\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.book) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;form\x26gt;\n        \x26lt;h3\x26gt;Book\x26lt;\/h3\x26gt;\n        \x26lt;label\x26gt;\n          Title:\n          \x26lt;input\n            value={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.title}\n            onChange={e =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ title: e.target.value })}\n          \/\x26gt;\n        \x26lt;\/label\x26gt;\n        \x26lt;label\x26gt;\n          Author:\n          \x26lt;input\n            value={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.author}\n            onChange={e =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ author: e.target.value })}\n          \/\x26gt;\n        \x26lt;\/label\x26gt;\n        \x26lt;button onClick={() =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.onSave({ ...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state })}\x26gt;\n          Save\n        \x26lt;\/button\x26gt;\n      \x26lt;\/form\x26gt;\n    );\n  }\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在\x3ca href=\x22https:\/\/codesandbox.io\/s\/23k60on01p\x22\x3ecodesandbox\x3c\/a\x3e尝试一下\x3c\/p\x3e\n\x3cp\x3e这种方法通常被认为是一种不好的做法，因为它违背了React关于拥有单一事实来源的想法。我不确定是这种情况，然而，同步状态并不总是那么容易。此外，我尽量避免使用生命周期方法。\x3c\/p\x3e\n\x3ch4\x3e方法3：由Key控制的组件\x3c\/h4\x3e\n\x3cp\x3e但为什么我们要回收旧的状态呢？每次用户选择一本书时，拥有一个全新状态的新实例是不是有意义？\x3c\/p\x3e\n\x3cp\x3e为此，我们需要告诉React停止使用旧实例并创建一个新实例。这就是key prop的用途。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs scala\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eBookApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  state = {\n    books: books,\n    activeIndex: \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e\n  };\n  render() {\n    const { books, activeIndex } = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state;\n    const activeBook = books[activeIndex];\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;div\x26gt;\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eBookList\x3c\/span\x3e\n          books={books}\n          onEdit={index =\x26gt;\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n              activeIndex: index\n            })}\n        \/\x26gt;\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eBookForm\x3c\/span\x3e\n          key={activeIndex}\n          book={activeBook}\n          onSave={book =\x26gt;\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n              books: \x3cspan class=\x22hljs-type\x22\x3eObject\x3c\/span\x3e.assign([...books], { [activeIndex]: book }),\n              activeIndex: \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e\n            })}\n        \/\x26gt;\n      \x26lt;\/div\x26gt;\n    );\n  }\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在 \x3ca href=\x22https:\/\/codesandbox.io\/s\/kxn89qp965\x22\x3ecodesandbox\x3c\/a\x3e尝试一下。\x3c\/p\x3e\n\x3cp\x3e如果元素具有与上一个渲染不同的键，则React会为其创建一个新实例。因此，当用户选择新书时，\x26lt;BookForm \/\x26gt;的键更改，将创建组件的新实例，并从props初始化状态。\x3c\/p\x3e\n\x3cp\x3e有什么收获？重用组件实例意味着更少的DOM突变，这意味着更好的性能。因此，当我们强制React创建组件的新实例时，我们会为额外的DOM突变获得一些开销。但是对于这样的情况，这种开销是最小的，其中密钥没有变化太快而且组件不大。\x3c\/p\x3e\n\x3cp\x3e感谢你的阅读。\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>原文链接: <a href="https://www.zcfy.cc/article/three-approaches-to-distribute-the-state-across-components-in-react">https://www.zcfy.cc/article/three-approaches-to-distribute-the-state-across-components-in-react</a> 原文标题: 在React中跨组件分发状态的三种方法 本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2>本文链接：</h2><a href="https://alili.tech/archive/4cec9d39/" target="_blank">https://alili.tech/archive/4cec9d39/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>