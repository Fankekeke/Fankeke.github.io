<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="WebSocket 协议"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>WebSocket 协议 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4edhgmzbkdd/",
				"appid": "1613049289050283", 
				"title": "WebSocket 协议 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-13T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/5hd7uqclvt6/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/0g4s45wsdvuv/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4edhgmzbkdd%2f&text=WebSocket%20%e5%8d%8f%e8%ae%ae"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4edhgmzbkdd%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4edhgmzbkdd%2f&text=WebSocket%20%e5%8d%8f%e8%ae%ae"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4edhgmzbkdd%2f&title=WebSocket%20%e5%8d%8f%e8%ae%ae"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4edhgmzbkdd%2f&is_video=false&description=WebSocket%20%e5%8d%8f%e8%ae%ae"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=WebSocket%20%e5%8d%8f%e8%ae%ae&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4edhgmzbkdd%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4edhgmzbkdd%2f&title=WebSocket%20%e5%8d%8f%e8%ae%ae"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4edhgmzbkdd%2f&title=WebSocket%20%e5%8d%8f%e8%ae%ae"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4edhgmzbkdd%2f&title=WebSocket%20%e5%8d%8f%e8%ae%ae"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4edhgmzbkdd%2f&title=WebSocket%20%e5%8d%8f%e8%ae%ae"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">WebSocket 协议</h1><div class="meta"><div class="postdate"><time datetime="2018-12-13" itemprop="datePublished">2018-12-13</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e参考文章\x3c\/h1\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/grayVTouch\/websocket-protocol\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebsocket RFC github 中文翻译\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.rfc-editor.org\/rfc\/rfc6455.txt\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebsocket RFC 文档\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/walkor\/Workerman\/blob\/master\/Protocols\/Websocket.php\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eworkerman websocket 协议实现\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e协议组成\x3c\/h1\x3e\n\x3cp\x3e协议由一个开放握手组成,其次是基本的消息成帧，分层的TCP.\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e解决的问题\x3c\/h1\x3e\n\x3cp\x3e基于浏览器的机制,实现客户端与服务端的双向通信.\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3e协议概述\x3c\/h1\x3e\n\x3col\x3e\x3cli\x3e来自客户端握手\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22GET \/chat HTTP\/1.1\nHost: server.example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==\nOrigin: http:\/\/example.com\nSec-WebSocket-Protocol: chat, superchat\nSec-WebSocket-Version: 13\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs http\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eGET\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\/chat\x3c\/span\x3e HTTP\/1.1\n\x3cspan class=\x22hljs-attribute\x22\x3eHost\x3c\/span\x3e: server.example.com\n\x3cspan class=\x22hljs-attribute\x22\x3eUpgrade\x3c\/span\x3e: websocket\n\x3cspan class=\x22hljs-attribute\x22\x3eConnection\x3c\/span\x3e: Upgrade\n\x3cspan class=\x22hljs-attribute\x22\x3eSec-WebSocket-Key\x3c\/span\x3e: dGhlIHNhbXBsZSBub25jZQ==\n\x3cspan class=\x22hljs-attribute\x22\x3eOrigin\x3c\/span\x3e: http:\/\/example.com\n\x3cspan class=\x22hljs-attribute\x22\x3eSec-WebSocket-Protocol\x3c\/span\x3e: chat, superchat\n\x3cspan class=\x22hljs-attribute\x22\x3eSec-WebSocket-Version\x3c\/span\x3e: 13\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\x3cli\x3e来自服务端的握手\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22HTTP\/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK\x2bxOo=\n\/\/ 可选的头,表示允许的通过的客户端\nSec-WebSocket-Protocol: chat\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3eHTTP\/\x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e101\x3c\/span\x3e Switching Protocols\n\x3cspan class=\x22hljs-string\x22\x3eUpgrade:\x3c\/span\x3e websocket\n\x3cspan class=\x22hljs-string\x22\x3eConnection:\x3c\/span\x3e Upgrade\nSec-WebSocket-\x3cspan class=\x22hljs-string\x22\x3eAccept:\x3c\/span\x3e s3pPLMBiTxaQ9kYGzzhZRbK\x2bxOo=\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 可选的头,表示允许的通过的客户端\x3c\/span\x3e\nSec-WebSocket-\x3cspan class=\x22hljs-string\x22\x3eProtocol:\x3c\/span\x3e chat\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以上,头顺序无所谓.\x3c\/p\x3e\n\x3cp\x3e一旦客户端和服务器都发送了握手信号，如果握手成功,数据传输部分启动。这是双方沟通的渠道，独立于另一方,可随意发送数据。\x3c\/p\x3e\n\x3cp\x3e服务器的响应,不是随意的,需要遵循一定的规则 \x3ca href=\x22https:\/\/www.rfc-editor.org\/rfc\/rfc6455.txt\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e请参考RFC 文档 第 6\/7页\x3c\/a\x3e:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e获取客户端请求的 \x3ccode\x3eSec-Weboscket-Key\x3c\/code\x3e 字段值,去除收尾空白字符\x3c\/li\x3e\n\x3cli\x3e与全球唯一标识符拼接 \x3ccode\x3e258EAFA5-E914-47DA-95CA-C5AB0DC85B11\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3esha1\x3c\/code\x3e 加密(短格式)\x3c\/li\x3e\n\x3cli\x3ebase64 加密\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3ePHP 程序描述:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$client_key = \x27dGhlIHNhbXBsZSBub25jZQ==\x27;\n$client_key = trim($client_key);\n$guid       = \x27258EAFA5-E914-47DA-95CA-C5AB0DC85B11\x27;\n$key        = $client_key . $guid;\n$key        = sha1($key , true);\n$key        = base64_encode($key);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs autoit\x22\x3e\x3ccode\x3e$client_key = \x3cspan class=\x22hljs-string\x22\x3e\x27dGhlIHNhbXBsZSBub25jZQ==\x27\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n$client_key = trim($client_key)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n$guid       = \x3cspan class=\x22hljs-string\x22\x3e\x27258EAFA5-E914-47DA-95CA-C5AB0DC85B11\x27\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n$key        = $client_key . $guid\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n$key        = sha1($key , \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n$key        = base64_encode($key)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上述结果得出的值即是服务端返回给客户端握手的 \x3ccode\x3eSec-Websocket-Accept\x3c\/code\x3e 头字段值.\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader4\x22\x3e关闭链接\x3c\/h1\x3e\n\x3cp\x3e接收到一个 \x3ccode\x3e0x8\x3c\/code\x3e 控制帧后，链接也许立即断开，也许在接收完剩下的数据后断开。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e可以有消息体，指明消息原因，可作为日志进行记录。\x3c\/li\x3e\n\x3cli\x3e应用发送关闭帧后必须不在发送更多数据帧。\x3c\/li\x3e\n\x3cli\x3e如果一个端点接受到一个关闭帧且先前没有发送关闭帧，则必须发送一个关闭帧。\x3c\/li\x3e\n\x3cli\x3e端点在接受到关闭帧后，可以延迟响应关闭帧，继续发送或接受数据帧，但不保证一个已经发送关闭帧的端点继续处理数据。\x3c\/li\x3e\n\x3cli\x3e发送并接收了关闭帧的端点，被认为是关闭了 \x3ccode\x3ewebsocket\x3c\/code\x3e 连接，其必须关闭底层的 \x3ccode\x3eTCP\x3c\/code\x3e 连接。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch1 id=\x22articleHeader5\x22\x3e设计理念\x3c\/h1\x3e\n\x3cp\x3e基于框架而不是基于流\/文本或二进制帧.\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader6\x22\x3e链接要求\x3c\/h1\x3e\n\x3ch4\x3e针对客户端要求\x3c\/h4\x3e\n\x3cul\x3e\n\x3cli\x3e握手必须是一个有效的 HTTP 请求\x3c\/li\x3e\n\x3cli\x3e请求的方法必须为 \x3ccode\x3eGET\x3c\/code\x3e,且 \x3ccode\x3eHTTP\x3c\/code\x3e 版本必须是 \x3cstrong\x3e1.1\x3c\/strong\x3e\n\x3c\/li\x3e\n\x3cli\x3e请求的 \x3ccode\x3eREQUEST-URI\x3c\/code\x3e 必须符合文档规定的要求(\x3ca href=\x22https:\/\/www.rfc-editor.org\/rfc\/rfc6455.txt\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e详情查看 Page 13\x3c\/a\x3e)\x3c\/li\x3e\n\x3cli\x3e请求必须包含 \x3ccode\x3eHost\x3c\/code\x3e 头\x3c\/li\x3e\n\x3cli\x3e请求必须包含 \x3ccode\x3eUpgrade: websocket\x3c\/code\x3e 头,值必须为 \x3ccode\x3ewebsocket\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e请求必须包含 \x3ccode\x3eConnection: Upgrade\x3c\/code\x3e 头,值必须为 \x3ccode\x3eUpgrade\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e请求必须包含 \x3ccode\x3eSec-WebSocket-Key\x3c\/code\x3e 头\x3c\/li\x3e\n\x3cli\x3e请求必须包含 \x3ccode\x3eSec-WebSocket-Version: 13\x3c\/code\x3e 头,值必须为 \x3ccode\x3e13\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e请求必须包含 \x3ccode\x3eOrigin\x3c\/code\x3e 头\x3c\/li\x3e\n\x3cli\x3e请求可能包含 \x3ccode\x3eSec-WebSocket-Protocol\x3c\/code\x3e 头,规定子协议\x3c\/li\x3e\n\x3cli\x3e请求可能包含 \x3ccode\x3eSec-WebSocket-Extensions\x3c\/code\x3e ,规定协议扩展\x3c\/li\x3e\n\x3cli\x3e请求可能包含其他字段,如 \x3ccode\x3ecookie\x3c\/code\x3e 等\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e不符合上述要求的服务器响应,客户端都会断开链接.\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e如果响应不包含 \x3ccode\x3eSec-WebSocket-Protocol\x3c\/code\x3e 中指定的子协议,客户端断开\x3c\/li\x3e\n\x3cli\x3e如果响应 \x3ccode\x3eHTTP\/1.1 101 Switching Protocols\x3c\/code\x3e 状态码不是 \x3ccode\x3e101\x3c\/code\x3e,客户端断开\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e针对服务端要求\x3c\/h4\x3e\n\x3cul\x3e\n\x3cli\x3e如果请求是 \x3ccode\x3eHTTP\/1.1\x3c\/code\x3e 或更高的 \x3ccode\x3eGET\x3c\/code\x3e 请求,包含 \x3ccode\x3eREQUEST-URI\x3c\/code\x3e 则应正确地按照文档要求进行解析.\x3c\/li\x3e\n\x3cli\x3e必须验证 Host 字段\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eUpgrade\x3c\/code\x3e 头字段值必须是大小写不敏感的 \x3ccode\x3ewebsocket\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eSec-WebSocket-key\x3c\/code\x3ed 解码时长度为 \x3ccode\x3e16Byte\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eSec-WebSocket-Version\x3c\/code\x3e 值必须是 \x3ccode\x3e13\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eHost\x3c\/code\x3e 如果没有被包含,则链接不应该被解释为浏览器发起的行为\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eSec-WebSocket-Protocol\x3c\/code\x3e 中列出的客户端请求的子协议,服务端应按照优先顺序排列,响应\x3c\/li\x3e\n\x3cli\x3e任选的其他字段\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e响应要求:\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e验证 \x3ccode\x3eOrigin\x3c\/code\x3e 字段,如果不符合要求的请求则返回适当的错误代码(例如:403)\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eSec-WebSocket-Key\x3c\/code\x3e 值是一个 \x3ccode\x3ebase64\x3c\/code\x3e 加密后的值,服务端不需要对其进行解码,而仅是用来创建服务器的握手.\x3c\/li\x3e\n\x3cli\x3e验证 \x3ccode\x3eSec-WebSocket-Version\x3c\/code\x3e 值,如果不是 \x3ccode\x3e13\x3c\/code\x3e,则返回一个适当的错误代码(例如:\x3ccode\x3eHTTP\/1.1 426 Upgrade Required\x3c\/code\x3e)\x3c\/li\x3e\n\x3cli\x3e资源名验证\x3c\/li\x3e\n\x3cli\x3e子协议验证\x3c\/li\x3e\n\x3cli\x3eextensions 验证\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e如果通过了上述验证,则服务器表示接受该链接.那么起响应必须符合以下要求\x3ca href=\x22https:\/\/www.rfc-editor.org\/rfc\/rfc6455.txt\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e详情查看 Page 23\x3c\/a\x3e:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e必须，状态行 \x3ccode\x3eHTTP\/1.1 101 Switching Protocols\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e必须，协议升级头 \x3ccode\x3eUpgrade: websocket\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e必须，表示连接升级的头字段 \x3ccode\x3eConnection: Upgrade\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e必须，\x3ccode\x3eSec-WebSocket-Accept\x3c\/code\x3e 头字段，详情请查阅 \x3cstrong\x3e协议概述\x3c\/strong\x3e 部分\x3c\/li\x3e\n\x3cli\x3e可选：\x3ccode\x3eSec-WebSocket-Protocols\x3c\/code\x3e 头部\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e完整的响应代码如下（严格按照如下格式响应！！头部顺序无所谓！关键是后面的换行符注意了！严格控制数量！）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22HTTP\/1.1 101 Switching Protocols\\r\\n\nConnection: Upgrade\\r\\n\nUpgrade: websocket\\r\\n\nSec-WebSocket-Accept: 3nlEzv\x2bLqVBYnTHclAqtk62uOTQ=\\r\\n\n\/\/ 下面这个头字段为可选字段\nSec-WebSocket-Protocols: chat\\r\\n\\r\\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs taggerscript\x22\x3e\x3ccode\x3eHTTP\/1.1 101 Switching Protocols\x3cspan class=\x22hljs-symbol\x22\x3e\\r\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\\n\x3c\/span\x3e\nConnection: Upgrade\x3cspan class=\x22hljs-symbol\x22\x3e\\r\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\\n\x3c\/span\x3e\nUpgrade: websocket\x3cspan class=\x22hljs-symbol\x22\x3e\\r\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\\n\x3c\/span\x3e\nSec-WebSocket-Accept: 3nlEzv\x2bLqVBYnTHclAqtk62uOTQ=\x3cspan class=\x22hljs-symbol\x22\x3e\\r\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\\n\x3c\/span\x3e\n\/\/ 下面这个头字段为可选字段\nSec-WebSocket-Protocols: chat\x3cspan class=\x22hljs-symbol\x22\x3e\\r\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\\n\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\\r\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader7\x22\x3e基本框架协议\x3c\/h1\x3e\n\x3cp\x3e数据传输部分对 \x3cstrong\x3e位\x3c\/strong\x3e 进行了分组！！由于是在\x3ccode\x3ebit\x3c\/code\x3e层面上进行的数据封装，所以如果直接取出的话，获取到的将是处理后的数据，需要解密。下图是\x3cstrong\x3e传输数据格式\x3c\/strong\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  0                   1                   2                   3\n  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n \x2b-\x2b-\x2b-\x2b-\x2b-------\x2b-\x2b-------------\x2b-------------------------------\x2b\n |F|R|R|R| opcode|M| Payload len |    Extended payload length    |\n |I|S|S|S|  (4)  |A|     (7)     |             (16\/64)           |\n |N|V|V|V|       |S|             |   (if payload len==126\/127)   |\n | |1|2|3|       |K|             |                               |\n \x2b-\x2b-\x2b-\x2b-\x2b-------\x2b-\x2b-------------\x2b - - - - - - - - - - - - - - - \x2b\n |     Extended payload length continued, if payload len == 127  |\n \x2b - - - - - - - - - - - - - - - \x2b-------------------------------\x2b\n |                               |Masking-key, if MASK set to 1  |\n \x2b-------------------------------\x2b-------------------------------\x2b\n | Masking-key (continued)       |          Payload Data         |\n \x2b-------------------------------- - - - - - - - - - - - - - - - \x2b\n :                     Payload Data continued ...                :\n \x2b - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \x2b\n |                     Payload Data continued ...                |\n \x2b---------------------------------------------------------------\x2b\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gherkin\x22\x3e\x3ccode\x3e  0                   1                   2                   3\n  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n \x2b-\x2b-\x2b-\x2b-\x2b-------\x2b-\x2b-------------\x2b-------------------------------\x2b\n |\x3cspan class=\x22hljs-string\x22\x3eF\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eR\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eR\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eR\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e opcode\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eM\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e Payload len \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e    Extended payload length    \x3c\/span\x3e|\n |\x3cspan class=\x22hljs-string\x22\x3eI\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eS\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eS\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eS\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e  (4)  \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eA\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e     (7)     \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e             (16\/64)           \x3c\/span\x3e|\n |\x3cspan class=\x22hljs-string\x22\x3eN\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eV\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eV\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eV\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e       \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eS\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e             \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e   (if payload len==126\/127)   \x3c\/span\x3e|\n |\x3cspan class=\x22hljs-string\x22\x3e \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e1\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e2\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e3\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e       \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eK\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e             \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e                               \x3c\/span\x3e|\n \x2b-\x2b-\x2b-\x2b-\x2b-------\x2b-\x2b-------------\x2b - - - - - - - - - - - - - - - \x2b\n |\x3cspan class=\x22hljs-string\x22\x3e     Extended payload length continued, if payload len == 127  \x3c\/span\x3e|\n \x2b - - - - - - - - - - - - - - - \x2b-------------------------------\x2b\n |\x3cspan class=\x22hljs-string\x22\x3e                               \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3eMasking-key, if MASK set to 1  \x3c\/span\x3e|\n \x2b-------------------------------\x2b-------------------------------\x2b\n |\x3cspan class=\x22hljs-string\x22\x3e Masking-key (continued)       \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e          Payload Data         \x3c\/span\x3e|\n \x2b-------------------------------- - - - - - - - - - - - - - - - \x2b\n :                     Payload Data continued ...                :\n \x2b - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \x2b\n |\x3cspan class=\x22hljs-string\x22\x3e                     Payload Data continued ...                \x3c\/span\x3e|\n \x2b---------------------------------------------------------------\x2b\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e1. 特殊名词含义介绍\x3c\/h4\x3e\n\x3col\x3e\n\x3cli\x3e1bit，FIN\x3c\/li\x3e\n\x3cli\x3e每个 1bit, RSV1、RSV2、RSV3\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e4bit，opcode（以下定义在\x3ca href=\x22http:\/\/blog.csdn.net\/basementman\/article\/details\/17788303\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eABNF\x3c\/a\x3e中）\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e%x0  连续帧\x3c\/li\x3e\n\x3cli\x3e%x1  文本帧\x3c\/li\x3e\n\x3cli\x3e%x2  二进制帧\x3c\/li\x3e\n\x3cli\x3e%x3 - %x7 保留帧\x3c\/li\x3e\n\x3cli\x3e%x8  链接关闭\x3c\/li\x3e\n\x3cli\x3e%x9  ping\x3c\/li\x3e\n\x3cli\x3e%xA  pong\x3c\/li\x3e\n\x3cli\x3e%xB-F 保留的控制帧\x3c\/li\x3e\n\x3cli\x3e以上表示的都是 16 进制数值\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e1bit, mask\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e客户端发送给服务端的数据都需要设置为 1\x3c\/li\x3e\n\x3cli\x3e也就是说数据都是经过掩码处理过的\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e7bit、7 \x2b 16bit、7 \x2b 64bit，Payload length \x3ca href=\x22https:\/\/www.rfc-editor.org\/rfc\/rfc6455.txt\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e具体范围请参阅 RFC 文档（Page 31）\x3c\/a\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3ePlayload length = Extended Payload length \x2b Application Payload length\x3c\/li\x3e\n\x3cli\x3e有效载荷长度 = 扩展数据长度 \x2b 应用程序数据长度\x3c\/li\x3e\n\x3cli\x3e扩展数据长度有可能为 0，所以当 扩展数据长度 = 0 的时候，有效载荷长度 = 应用程序长度\x3c\/li\x3e\n\x3cli\x3e有效载荷数据的长度单位为 \x3ccode\x3eByte\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e0\/4 byte, masking-key\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e客户端发送给服务端的数据都是经过掩码处理的，长度为 32bit\x3c\/li\x3e\n\x3cli\x3e服务端发送给客户端的数据都是未经过掩码处理的，长度为 0bit\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3ex \x2b y Byte, Payload Data\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e有效载荷数据\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3ex Byte, Extension Data\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e扩展数据\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3ey Byte, Application Data\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e应用数据\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch4\x3e2. 理解\x3c\/h4\x3e\n\x3cp\x3e图中表示遵循 \x3ccode\x3ewebsocket\x3c\/code\x3e 协议进行传输的数据，由于是经过 \x3ccode\x3ewebsocket\x3c\/code\x3e 协议处理后的数据，所以无法直接获取\x3cstrong\x3e有效数据\x3c\/strong\x3e。如果想要获取有效数据，就需要按照 \x3ccode\x3ewebsocket\x3c\/code\x3e 协议规定进行解读。\x3c\/p\x3e\n\x3cp\x3e图中从左往右，按高位到低位进行排列。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e什么是低位、高位？？\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e就像是十进制数字，如果有一个描述是这样的：\x3ccode\x3e3\x3c\/code\x3e表示个位，\x3ccode\x3e2\x3c\/code\x3e 表示十位，\x3ccode\x3e1\x3c\/code\x3e表示百位，请问这个数字是？？答案：\x3ccode\x3e123\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e这就很好理解了，\x3ccode\x3e个位、十位、百位\x3c\/code\x3e 描述了排列顺序；同样的，在程序领域，低位到高位描述的也是排列顺序！不过 \x3ccode\x3e个位、十位、百位\x3c\/code\x3e描述的是\x3ccode\x3e10进制\x3c\/code\x3e的排列顺序，而 \x3ccode\x3e低位、高位\x3c\/code\x3e描述的是 \x3ccode\x3e2进制\x3c\/code\x3e 的排列顺序，具体描述是 \x3ccode\x3e位0、位1、位2....\x3c\/code\x3e 等（\x3cstrong\x3e当前举例中的的排列顺序为低位到高位\x3c\/strong\x3e），以下是图片描述：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013311228?w=551\x26amp;h=74\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013311228?w=551\x26amp;h=74\x22 alt=\x22描述\x22 title=\x22描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e理解了\x3cstrong\x3e低位、高位\x3c\/strong\x3e，就清楚了上图描述的数据排列顺序。\x3c\/p\x3e\n\x3cp\x3e众所周知，\x3ccode\x3e位（bit）\x3c\/code\x3e是内存中的最小存储单位，仅能存 \x3ccode\x3e0、1\x3c\/code\x3e两个数值。所以要想获取、设置某位的值，需要进行\x3ca href=\x22http:\/\/note.youdao.com\/noteshare?id=0c196df5ebe810378943207b677f54cd\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e位操作\x3c\/a\x3e。由于是在\x3cstrong\x3e位\x3c\/strong\x3e上进行操作者，所以，图中描述的内容是在\x3ca href=\x22http:\/\/note.youdao.com\/noteshare?id=01df6eafa1e68eacc452e383591a8b13\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e补码\x3c\/a\x3e的基础上进行的。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e客户端发送给服务端的数据是经过掩码处理的！\x3c\/strong\x3e 需要进行解析，解析数据流程：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 按照 websocket 规范解析客户端加密数据\nfunction decode(string $buffer){\n    \/\/ buffer[0] 获取第一个字节，8bit\n    \/\/ 对照那张图，表示的是 fin \x2b rsv1 \x2b rsv2 \x2b rsv 3 \x2b opcode\n    \/\/ 之所以要转换为 ASCII 码值\n    \/\/ 是为了确保位运算结果正确!\n    \/\/ php 位运算详情参考：https:\/\/note.youdao.com\/share\/?id=927bfc2f40a8d62f4c9165de30a41e75\x26amp;type=note#\/\n    \/\/ 这边做一点简单解释\n    \/\/ 后面的代码会有 $first_byte \x3e\x3e 7 这样的代码\n    \/\/ php 中 \x3c\x3c \x3e\x3e 都会将操作数当成是整型数(int) \n    \/\/ 所以如果不转换成 ascii 值的话,过程将会是\n    \/\/ (int) $buffer[0] \x3e\x3e 7\n    \/\/ 这样的结果将是错误的！！\n    \/\/ ord((int) $buffer[0]) !== ord($buffer[0]) 就是最好的证明\n    \/\/ 因为 ascii 值不一样，则二进制值（严格一点，我认为应该说成是：补码）也不一样\n    \/\/ 这违反了 websocket 规定的协议\n    \/\/ 会导致解析错误\n    $first_byte  = ord($buffer[0]);\n    \/\/ buffer[1] 获取第二个字节，8bit\n    \/\/ 对照那张图，表示的是 mask \x2b payload len\n    $second_byte = ord($buffer[1]);\n    \n    \/\/ 获取左边第一位值\n    $fin = $first_byte \x3e\x3e 7;\n    \/\/ 对照那张图，要想获取 payload len 表示的值\n    \/\/ 需要设置 位 7 为 0\n    \/\/ 因为位 7 表示的是掩码，位 0 - 6 表示的是 paylaod len 的补码\n    \/\/ 所以要想获取 payload len 的值\n    \/\/ 0111 1111 =\x3e 127\n    $payload_len = $second_byte \x26amp; 127;\n    \n    \/\/ 客户端发送给服务端的数据是经过掩码处理的\n    \/\/ 所以要获取 掩码键 \x2b 掩码处理过后的客户端数据\n    \/\/ 获取 mask-key \x2b payload data\n    if ($payload_len === 127) {\n        \/\/ 如果 payload len = 127 byte\n        \/\/ payload len 本身占据 7bit\n        \/\/ extended payload lenght 占据 64bit\n        $mask_key       = substr($buffer , 10 , 4);\n        $encoded_data   = substr($buffer , 14);\n    } else if ($payload_len === 126) {\n        \/\/ 如果 payload len = 126 byte\n        \/\/ payload length 本身占据 7bit\n        \/\/ extended payload lenght 占据 16bit\n        $mask_key       = substr($buffer , 4 , 4);\n        $encoded_data   = substr($buffer , 8);\n    } else {\n        \/\/ 如果 payload len = 126 byte\n        \/\/ payload length 本身占据 7bit\n        \/\/ extended payload lenght 占据 0bit\n        $mask_key       = substr($buffer , 2 , 4);\n        $encoded_data   = substr($buffer , 6);\n    }\n    \n    \/\/ 对 payload data 进行解码\n    $decoded_data = \x26quot;\x26quot;;\n    \n    \/\/ 对每一个有效载荷数据进行解码操作\n    \/\/ 解码规则在 RFC 文档中有详细描述\n    for ($index = 0; $index \x3c count($encoded_data); \x2b\x2b$index)\n    {\n        $k              = $index % 4;\n        $valid_data     = $encoded_data[$index] ^ $mask_data[$k];\n        $decoded_data  .= $valid_data;\n    }\n    \n    \/\/ 这个就是客户端发送的真实数据！！\n    return $decoded_data;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 按照 websocket 规范解析客户端加密数据\x3c\/span\x3e\nfunction \x3cspan class=\x22hljs-keyword\x22\x3edecode\x3c\/span\x3e(string \x3cspan class=\x22hljs-variable\x22\x3e$buffer\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ buffer[0] 获取第一个字节，8bit\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对照那张图，表示的是 fin \x2b rsv1 \x2b rsv2 \x2b rsv 3 \x2b opcode\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 之所以要转换为 ASCII 码值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 是为了确保位运算结果正确!\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ php 位运算详情参考：https:\/\/note.youdao.com\/share\/?id=927bfc2f40a8d62f4c9165de30a41e75\x26amp;type=note#\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这边做一点简单解释\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 后面的代码会有 $first_byte \x26gt;\x26gt; 7 这样的代码\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ php 中 \x26lt;\x26lt; \x26gt;\x26gt; 都会将操作数当成是整型数(int) \x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所以如果不转换成 ascii 值的话,过程将会是\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ (int) $buffer[0] \x26gt;\x26gt; 7\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这样的结果将是错误的！！\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ord((int) $buffer[0]) !== ord($buffer[0]) 就是最好的证明\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 因为 ascii 值不一样，则二进制值（严格一点，我认为应该说成是：补码）也不一样\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这违反了 websocket 规定的协议\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 会导致解析错误\x3c\/span\x3e\n    \x3cspan class=\x22hljs-variable\x22\x3e$first_byte\x3c\/span\x3e  = ord(\x3cspan class=\x22hljs-variable\x22\x3e$buffer\x3c\/span\x3e[0]);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ buffer[1] 获取第二个字节，8bit\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对照那张图，表示的是 mask \x2b payload len\x3c\/span\x3e\n    \x3cspan class=\x22hljs-variable\x22\x3e$second_byte\x3c\/span\x3e = ord(\x3cspan class=\x22hljs-variable\x22\x3e$buffer\x3c\/span\x3e[1]);\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取左边第一位值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-variable\x22\x3e$fin\x3c\/span\x3e = \x3cspan class=\x22hljs-variable\x22\x3e$first_byte\x3c\/span\x3e \x26gt;\x26gt; 7;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对照那张图，要想获取 payload len 表示的值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 需要设置 位 7 为 0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 因为位 7 表示的是掩码，位 0 - 6 表示的是 paylaod len 的补码\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所以要想获取 payload len 的值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 0111 1111 =\x26gt; 127\x3c\/span\x3e\n    \x3cspan class=\x22hljs-variable\x22\x3e$payload_len\x3c\/span\x3e = \x3cspan class=\x22hljs-variable\x22\x3e$second_byte\x3c\/span\x3e \x26amp; 127;\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 客户端发送给服务端的数据是经过掩码处理的\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所以要获取 掩码键 \x2b 掩码处理过后的客户端数据\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取 mask-key \x2b payload data\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-variable\x22\x3e$payload_len\x3c\/span\x3e === 127) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果 payload len = 127 byte\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ payload len 本身占据 7bit\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ extended payload lenght 占据 64bit\x3c\/span\x3e\n        \x3cspan class=\x22hljs-variable\x22\x3e$mask_key\x3c\/span\x3e       = \x3cspan class=\x22hljs-built_in\x22\x3esubstr\x3c\/span\x3e(\x3cspan class=\x22hljs-variable\x22\x3e$buffer\x3c\/span\x3e , 10 , 4);\n        \x3cspan class=\x22hljs-variable\x22\x3e$encoded_data\x3c\/span\x3e   = \x3cspan class=\x22hljs-built_in\x22\x3esubstr\x3c\/span\x3e(\x3cspan class=\x22hljs-variable\x22\x3e$buffer\x3c\/span\x3e , 14);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-variable\x22\x3e$payload_len\x3c\/span\x3e === 126) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果 payload len = 126 byte\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ payload length 本身占据 7bit\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ extended payload lenght 占据 16bit\x3c\/span\x3e\n        \x3cspan class=\x22hljs-variable\x22\x3e$mask_key\x3c\/span\x3e       = \x3cspan class=\x22hljs-built_in\x22\x3esubstr\x3c\/span\x3e(\x3cspan class=\x22hljs-variable\x22\x3e$buffer\x3c\/span\x3e , 4 , 4);\n        \x3cspan class=\x22hljs-variable\x22\x3e$encoded_data\x3c\/span\x3e   = \x3cspan class=\x22hljs-built_in\x22\x3esubstr\x3c\/span\x3e(\x3cspan class=\x22hljs-variable\x22\x3e$buffer\x3c\/span\x3e , 8);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果 payload len = 126 byte\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ payload length 本身占据 7bit\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ extended payload lenght 占据 0bit\x3c\/span\x3e\n        \x3cspan class=\x22hljs-variable\x22\x3e$mask_key\x3c\/span\x3e       = \x3cspan class=\x22hljs-built_in\x22\x3esubstr\x3c\/span\x3e(\x3cspan class=\x22hljs-variable\x22\x3e$buffer\x3c\/span\x3e , 2 , 4);\n        \x3cspan class=\x22hljs-variable\x22\x3e$encoded_data\x3c\/span\x3e   = \x3cspan class=\x22hljs-built_in\x22\x3esubstr\x3c\/span\x3e(\x3cspan class=\x22hljs-variable\x22\x3e$buffer\x3c\/span\x3e , 6);\n    }\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对 payload data 进行解码\x3c\/span\x3e\n    \x3cspan class=\x22hljs-variable\x22\x3e$decoded_data\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对每一个有效载荷数据进行解码操作\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 解码规则在 RFC 文档中有详细描述\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-variable\x22\x3e$index\x3c\/span\x3e = 0; \x3cspan class=\x22hljs-variable\x22\x3e$index\x3c\/span\x3e \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ecount\x3c\/span\x3e(\x3cspan class=\x22hljs-variable\x22\x3e$encoded_data\x3c\/span\x3e); \x2b\x2b\x3cspan class=\x22hljs-variable\x22\x3e$index\x3c\/span\x3e)\n    {\n        \x3cspan class=\x22hljs-variable\x22\x3e$k\x3c\/span\x3e              = \x3cspan class=\x22hljs-variable\x22\x3e$index\x3c\/span\x3e % 4;\n        \x3cspan class=\x22hljs-variable\x22\x3e$valid_data\x3c\/span\x3e     = \x3cspan class=\x22hljs-variable\x22\x3e$encoded_data\x3c\/span\x3e[\x3cspan class=\x22hljs-variable\x22\x3e$index\x3c\/span\x3e] ^ \x3cspan class=\x22hljs-variable\x22\x3e$mask_data\x3c\/span\x3e[\x3cspan class=\x22hljs-variable\x22\x3e$k\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-variable\x22\x3e$decoded_data\x3c\/span\x3e  .= \x3cspan class=\x22hljs-variable\x22\x3e$valid_data\x3c\/span\x3e;\n    }\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这个就是客户端发送的真实数据！！\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-variable\x22\x3e$decoded_data\x3c\/span\x3e;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e相反，如果服务器想要发送数据给 \x3ccode\x3ewebsocket\x3c\/code\x3e 客户端，则也要对数据进行相应处理！处理流程：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 按照 websocket 规范封装发送给客户端的消息\nfunction encode($msg){\n    if (!is_scalar($msg)) {\n        print_r(\x26quot;只允许发送标量数据\x26quot;);\n    }\n    \n    \/\/ 数据长度\n    $len = strlen($msg);\n    \n    \/\/ 这边仅实现传输文本帧！第一个字节，文本帧 1000 0001 =\x3e 129\n    \/\/ 如果需要例如二进制帧，用于传输大文件，请另行实现\n    $first_byte = chr(129);\n    \n    if ($len \x3c= 125) {\n        \/\/ payload length = 7bit 支持的最大范围！\n        $second_byte = chr($len);\n    } else {\n        if ($len \x3c= 65535) {\n            \/\/ payload length = 7 , extended payload length = 16bit，支持的最大范围 65535\n            \/\/ 最后16bit 被解释为无符号整数，排序为：大端字节序（网络字节序）\n            $second_byte = chr(126) . pack(\x27n\x27 , $len);\n        } else {\n            \/\/ payload length = 7，extended payload length = 64bit\n            \/\/ 最后 64 位被解释为无符号整数，大端字节序（网络字节序）\n            $second_byte = chr(127) . pack(\x27J\x27 , $len);\n        }\n    }\n    \n    \/\/ 注意了，发送给客户端的数据不需要处理\n    \/\/ 详情查看 websocket 文档！！\n    $encoded_data = $first_byte . $second_byte . $buffer;\n    \n    \/\/ 这个就是发送给客户端的数据！   \n    return $encoded_data;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 按照 websocket 规范封装发送给客户端的消息\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eencode\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e($msg)\x3c\/span\x3e\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!is_scalar($msg)) {\n        print_r(\x3cspan class=\x22hljs-string\x22\x3e\x22只允许发送标量数据\x22\x3c\/span\x3e);\n    }\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据长度\x3c\/span\x3e\n    $len = strlen($msg);\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这边仅实现传输文本帧！第一个字节，文本帧 1000 0001 =\x26gt; 129\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果需要例如二进制帧，用于传输大文件，请另行实现\x3c\/span\x3e\n    $first_byte = chr(\x3cspan class=\x22hljs-number\x22\x3e129\x3c\/span\x3e);\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($len \x26lt;= \x3cspan class=\x22hljs-number\x22\x3e125\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ payload length = 7bit 支持的最大范围！\x3c\/span\x3e\n        $second_byte = chr($len);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($len \x26lt;= \x3cspan class=\x22hljs-number\x22\x3e65535\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ payload length = 7 , extended payload length = 16bit，支持的最大范围 65535\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 最后16bit 被解释为无符号整数，排序为：大端字节序（网络字节序）\x3c\/span\x3e\n            $second_byte = chr(\x3cspan class=\x22hljs-number\x22\x3e126\x3c\/span\x3e) . pack(\x3cspan class=\x22hljs-string\x22\x3e\x27n\x27\x3c\/span\x3e , $len);\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ payload length = 7，extended payload length = 64bit\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 最后 64 位被解释为无符号整数，大端字节序（网络字节序）\x3c\/span\x3e\n            $second_byte = chr(\x3cspan class=\x22hljs-number\x22\x3e127\x3c\/span\x3e) . pack(\x3cspan class=\x22hljs-string\x22\x3e\x27J\x27\x3c\/span\x3e , $len);\n        }\n    }\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注意了，发送给客户端的数据不需要处理\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 详情查看 websocket 文档！！\x3c\/span\x3e\n    $encoded_data = $first_byte . $second_byte . $buffer;\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这个就是发送给客户端的数据！   \x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $encoded_data;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader8\x22\x3e消息分片\x3c\/h1\x3e\n\x3ch4\x3e分片目的\x3c\/h4\x3e\n\x3cp\x3e消息分片的主要目的是允许消息开始但不必缓冲整个消息时，发送一个未知大小的消息；未分片的消息需要缓冲整个消息，以便获取消息大小；\x3c\/p\x3e\n\x3ch4\x3e分片要求：\x3c\/h4\x3e\n\x3cul\x3e\n\x3cli\x3e首个分片 Fin = 0，opcode != 0x0，其后跟随多个 Fin = 0，opcode = 0x0的分片，终止于 Fin = 1，opcode = 0x0的片段\x3c\/li\x3e\n\x3cli\x3e扩展数据可能发生在分片中的任意一个分片中\x3c\/li\x3e\n\x3cli\x3e控制帧可能被注入到分片消息的中间，控制帧本身必须不被分割\x3c\/li\x3e\n\x3cli\x3e消息分片必须按照发送者发送顺序交付给收件人\x3c\/li\x3e\n\x3cli\x3e片段中的一个消息必须不能与片段中的另一个消息交替，除非已协商了一个能解释交替的扩展。\x3c\/li\x3e\n\x3cli\x3ewebsocket服务器应能够处理分片消息中间的控制帧\x3c\/li\x3e\n\x3cli\x3e一个发送者可以为非控制消息（非控制帧）创建任何大小的片段\x3c\/li\x3e\n\x3cli\x3e不能处理控制帧\x3c\/li\x3e\n\x3cli\x3e如果使用了任何保留的位值且这些值的意思对中间件是未知的，一个中间件必须不改变一个消息的分片。\x3c\/li\x3e\n\x3cli\x3e在一个连接上下文中，已经协商了扩展且中间件不知道协商的扩展的语义，一个中间件必须不改变任何消息的分片。同样，没有看见WebSocket握手（且没被通知有关它的内容）、导致一个WebSocket连接的一个中间件，必须不改变这个链接的任何消息的分片。\x3c\/li\x3e\n\x3cli\x3e由于这些规则，一个消息的所有分片是相同类型，以第一个片段的操作码设置。因为控制帧不能被分片，用于一个消息中的所有分片的类型必须或者是文本、或者二进制、或者一个保留的操作码。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch1 id=\x22articleHeader9\x22\x3eping\x3c\/h1\x3e\n\x3cp\x3e接受到一个 \x3ccode\x3eping(0x9)\x3c\/code\x3e 控制帧，必须返回一个 \x3ccode\x3epong(0xa)\x3c\/code\x3e 控制帧，表示进程还在！！实际就是心跳检查\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader10\x22\x3epong\x3c\/h1\x3e\n\x3col\x3e\n\x3cli\x3e可以在接收到 \x3ccode\x3eping（0x9）\x3c\/code\x3e 控制帧后，作为响应消息返回。\x3c\/li\x3e\n\x3cli\x3e也可以单向发送 \x3ccode\x3epong\x3c\/code\x3e 帧，表示发送方进程还在，作为单向心跳\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch1 id=\x22articleHeader11\x22\x3e状态码\x3c\/h1\x3e\n\x3col\x3e\n\x3cli\x3e1000，正常关闭\x3c\/li\x3e\n\x3cli\x3e1001，正在离开\x3c\/li\x3e\n\x3cli\x3e1003，正在关闭连接\x3c\/li\x3e\n\x3cli\x3e1004，保留\x3c\/li\x3e\n\x3cli\x3e1005，保留\x3c\/li\x3e\n\x3cli\x3e1006，保留\x3c\/li\x3e\n\x3cli\x3e1007，端点正在终止连接，因为它收到的消息中没有与消息类型一致。\x3c\/li\x3e\n\x3cli\x3e1008，端点正在终止链接，因为接收到了违反其规则的消息。\x3c\/li\x3e\n\x3cli\x3e1009，端点正在终止链接，因为接受到的消息太大\x3c\/li\x3e\n\x3cli\x3e1010，端点正在终止链接，因为扩展问题\x3c\/li\x3e\n\x3cli\x3e1011，端点正在终止链接，发生了以外错误\x3c\/li\x3e\n\x3cli\x3e1015，保留\x3c\/li\x3e\n\x3cli\x3e.....省略了部分，详情参考 \x3ca href=\x22https:\/\/www.rfc-editor.org\/rfc\/rfc6455.txt\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3erfc\x3c\/a\x3e 文档\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch1 id=\x22articleHeader12\x22\x3e尾部\x3c\/h1\x3e\n\x3cp\x3e以上个人理解，仅供参考，有错欢迎纠正，未完待续 ....\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>WebSocket 协议</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013298527">https://segmentfault.com/a/1190000013298527</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/4edhgmzbkdd/" target="_blank">https://alili.tech/archive/4edhgmzbkdd/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>