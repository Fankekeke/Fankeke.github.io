<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="翻译 | 一行 JavaScript 代码的逆向工程"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>翻译 | 一行 JavaScript 代码的逆向工程 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4knm3gep6kq/",
				"appid": "1613049289050283", 
				"title": "翻译 | 一行 JavaScript 代码的逆向工程 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-01T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/oi1m4iblxj/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/knj76exbwnm/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4knm3gep6kq%2f&text=%e7%bf%bb%e8%af%91%20%7c%20%e4%b8%80%e8%a1%8c%20JavaScript%20%e4%bb%a3%e7%a0%81%e7%9a%84%e9%80%86%e5%90%91%e5%b7%a5%e7%a8%8b"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4knm3gep6kq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4knm3gep6kq%2f&text=%e7%bf%bb%e8%af%91%20%7c%20%e4%b8%80%e8%a1%8c%20JavaScript%20%e4%bb%a3%e7%a0%81%e7%9a%84%e9%80%86%e5%90%91%e5%b7%a5%e7%a8%8b"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4knm3gep6kq%2f&title=%e7%bf%bb%e8%af%91%20%7c%20%e4%b8%80%e8%a1%8c%20JavaScript%20%e4%bb%a3%e7%a0%81%e7%9a%84%e9%80%86%e5%90%91%e5%b7%a5%e7%a8%8b"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4knm3gep6kq%2f&is_video=false&description=%e7%bf%bb%e8%af%91%20%7c%20%e4%b8%80%e8%a1%8c%20JavaScript%20%e4%bb%a3%e7%a0%81%e7%9a%84%e9%80%86%e5%90%91%e5%b7%a5%e7%a8%8b"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%bf%bb%e8%af%91%20%7c%20%e4%b8%80%e8%a1%8c%20JavaScript%20%e4%bb%a3%e7%a0%81%e7%9a%84%e9%80%86%e5%90%91%e5%b7%a5%e7%a8%8b&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4knm3gep6kq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4knm3gep6kq%2f&title=%e7%bf%bb%e8%af%91%20%7c%20%e4%b8%80%e8%a1%8c%20JavaScript%20%e4%bb%a3%e7%a0%81%e7%9a%84%e9%80%86%e5%90%91%e5%b7%a5%e7%a8%8b"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4knm3gep6kq%2f&title=%e7%bf%bb%e8%af%91%20%7c%20%e4%b8%80%e8%a1%8c%20JavaScript%20%e4%bb%a3%e7%a0%81%e7%9a%84%e9%80%86%e5%90%91%e5%b7%a5%e7%a8%8b"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4knm3gep6kq%2f&title=%e7%bf%bb%e8%af%91%20%7c%20%e4%b8%80%e8%a1%8c%20JavaScript%20%e4%bb%a3%e7%a0%81%e7%9a%84%e9%80%86%e5%90%91%e5%b7%a5%e7%a8%8b"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4knm3gep6kq%2f&title=%e7%bf%bb%e8%af%91%20%7c%20%e4%b8%80%e8%a1%8c%20JavaScript%20%e4%bb%a3%e7%a0%81%e7%9a%84%e9%80%86%e5%90%91%e5%b7%a5%e7%a8%8b"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">翻译 | 一行 JavaScript 代码的逆向工程</h1><div class="meta"><div class="postdate"><time datetime="2019-01-01" itemprop="datePublished">2019-01-01</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cul\x3e\n\x3cli\x3e原文地址：\x3ca href=\x22https:\/\/www.alexkras.com\/reverse-engineering-one-line-of-javascript\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReverse Engineering One Line of JavaScript\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e原文作者：\x3ca href=\x22https:\/\/www.alexkras.com\/author\/admin\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAlex Kras\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e译者：李波\x3c\/li\x3e\n\x3cli\x3e校对者：冬青、小萝卜\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e几个月前，我看到一个邮件问：有没有人可以解析这一行 JavaScript 代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cpre id=p\x3e\x3cscript\x3en=setInterval(\x26quot;for(n\x2b=7,i=k,P=\x27p.\\\\n\x27;i-=1\/k;P\x2b=P[i%2?(i%2*j-j\x2bn\/k^j)\x26amp;1:2])j=k\/i;p.innerHTML=P\x26quot;,k=64)\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x26lt;pre id=p\x26gt;\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22actionscript\x22\x3en=setInterval(\x3cspan class=\x22hljs-string\x22\x3e\x22for(n\x2b=7,i=k,P=\x27p.\\\\n\x27;i-=1\/k;P\x2b=P[i%2?(i%2*j-j\x2bn\/k^j)\x26amp;1:2])j=k\/i;p.innerHTML=P\x22\x3c\/span\x3e,k=\x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e)\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这一行代码会被渲染成下图的效果。你可以在\x3ca href=\x22https:\/\/codepen.io\/akras14\/pen\/yXGzVd\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22akras14\/pen\/yXGzVd\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e用浏览器打开来观看。这是 Mathieu ‘p01’ Henri 写的，你还可以在作者的网站\x3ca\x3ewww.p01.org\x3c\/a\x3e里看到更多很酷的例子。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073914\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073914\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e好的！我决定接受挑战\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e第一步：让代码变得可读\x3c\/h2\x3e\n\x3cp\x3e第一件事，让 HTML 文件里只有 HTML 代码，然后把 JavaScript 代码放到 \x3ccode\x3ecode.js\x3c\/code\x3e 文件里。我还用 \x3ccode\x3eid=\x22p\x22\x3c\/code\x3e 来包装 pre 标签。\x3c\/p\x3e\n\x3cp\x3eindex.html\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript src=\x26quot;code.js\x26quot;\x3e\x3c\/script\x3e\n\x3cpre id=\x26quot;p\x26quot;\x3e\x3c\/pre\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22code.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3epre\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22p\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3epre\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我注意到变量 \x3ccode\x3ek\x3c\/code\x3e 只是一个常量，所以把它移出来，然后重命名为 \x3ccode\x3edelay\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3ecode.js\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var delay = 64;\nvar draw = \x26quot;for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x26quot;;\nvar n = setInterval(draw, delay);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e delay = \x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e draw = \x3cspan class=\x22hljs-string\x22\x3e\x22for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x22\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e n = setInterval(draw, delay);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来，因为 \x3ccode\x3esetInterval\x3c\/code\x3e 可以接收一个函数或者字符串来执行，字符串 \x3ccode\x3evar draw\x3c\/code\x3e 会被 setInterval 用 \x3ccode\x3eeval\x3c\/code\x3e 来解析并执行。所以我把它移到一个新建的函数体内。 然后保留旧的那行代码，以供参考。\x3c\/p\x3e\n\x3cp\x3e我注意到的另一个点，变量 \x3ccode\x3ep\x3c\/code\x3e 指向了存在于 HTML 的 DOM 结构里 id 为 \x3ccode\x3ep\x3c\/code\x3e 的标签，就是那个之前我包装过的 pre 标签。事实上，元素标签可以通过他们的 id 用 JavaScript 来获取，只要 id 仅由字母数字组成。这里，我通过 \x3ccode\x3edocument.getElementById(\x22p\x22)\x3c\/code\x3e 来让它更加直观。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var delay = 64;\nvar p = document.getElementById(\x26quot;p\x26quot;); \/\/ \x3c --------------\n\/\/ var draw = \x26quot;for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x26quot;;\nvar draw = function() {\n    for (n \x2b= 7, i = delay, P = \x27p.\\n\x27; i -= 1 \/ delay; P \x2b= P[i % 2 ? (i % 2 * j - j \x2b n \/ delay ^ j) \x26amp; 1 : 2]) {\n        j = delay \/ i; p.innerHTML = P;\n    }\n};\nvar n = setInterval(draw, delay);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e delay = \x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22p\x22\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt; --------------\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ var draw = \x22for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x22;\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e draw = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (n \x2b= \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e, i = delay, P = \x3cspan class=\x22hljs-string\x22\x3e\x27p.\\n\x27\x3c\/span\x3e; i -= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \/ delay; P \x2b= P[i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e ? (i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * j - j \x2b n \/ delay ^ j) \x26amp; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]) {\n        j = delay \/ i; p.innerHTML = P;\n    }\n};\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e n = setInterval(draw, delay);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e下一步，我声明了变量 \x3ccode\x3ei\x3c\/code\x3e、\x3ccode\x3ep\x3c\/code\x3e 和 \x3ccode\x3ej\x3c\/code\x3e，然后把他们放在函数的顶部。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var delay = 64;\nvar p = document.getElementById(\x26quot;p\x26quot;);\n\/\/ var draw = \x26quot;for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x26quot;;\nvar draw = function() {\n    var i = delay; \/\/ \x3c ---------------\n    var P =\x27p.\\n\x27;\n    var j;\n    for (n \x2b= 7; i \x3e 0 ;P \x2b= P[i % 2 ? (i % 2 * j - j \x2b n \/ delay ^ j) \x26amp; 1 : 2]) {\n        j = delay \/ i; p.innerHTML = P;\n        i -= 1 \/ delay;\n    }\n};\nvar n = setInterval(draw, delay);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e delay = \x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22p\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ var draw = \x22for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x22;\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e draw = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = delay; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt; ---------------\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e P =\x3cspan class=\x22hljs-string\x22\x3e\x27p.\\n\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e j;\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (n \x2b= \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e; i \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ;P \x2b= P[i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e ? (i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * j - j \x2b n \/ delay ^ j) \x26amp; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]) {\n        j = delay \/ i; p.innerHTML = P;\n        i -= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \/ delay;\n    }\n};\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e n = setInterval(draw, delay);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我把 \x3ccode\x3efor\x3c\/code\x3e 循环分解成 \x3ccode\x3ewhile\x3c\/code\x3e 循环。只保留了 \x3ccode\x3efor\x3c\/code\x3e 的CHECK_EVERY_LOOP部分（for的三个部分分别是RUNS_ONCE_ON_INIT; CHECK_EVERY_LOOP; DO_EVERY_LOOP），然后分别把其他的代码移到循环的内外部。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var delay = 64;\nvar p = document.getElementById(\x26quot;p\x26quot;);\n\/\/ var draw = \x26quot;for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x26quot;;\nvar draw = function() {\n    var i = delay;\n    var P =\x27p.\\n\x27;\n    var j;\n    n \x2b= 7;\n    while (i \x3e 0) { \/\/ \x3c----------------------\n        \/\/Update HTML\n        p.innerHTML = P;\n\n        j = delay \/ i;\n        i -= 1 \/ delay;\n        P \x2b= P[i % 2 ? (i % 2 * j - j \x2b n \/ delay ^ j) \x26amp; 1 : 2];\n    }\n};\nvar n = setInterval(draw, delay);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e delay = \x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22p\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ var draw = \x22for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x22;\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e draw = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = delay;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e P =\x3cspan class=\x22hljs-string\x22\x3e\x27p.\\n\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e j;\n    n \x2b= \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (i \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt;----------------------\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/Update HTML\x3c\/span\x3e\n        p.innerHTML = P;\n\n        j = delay \/ i;\n        i -= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \/ delay;\n        P \x2b= P[i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e ? (i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * j - j \x2b n \/ delay ^ j) \x26amp; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e];\n    }\n};\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e n = setInterval(draw, delay);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接着我将会展开 \x3ccode\x3eP \x2b= P[i % 2 ? (i % 2 * j - j \x2b n \/ delay ^ j) \x26amp; 1 : 2]\x3c\/code\x3e 中的三元操作（\x3ccode\x3e判断条件 ？ true时运行 ：false时运行\x3c\/code\x3e）\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ei % 2\x3c\/code\x3e 是用来检测 \x3ccode\x3ei\x3c\/code\x3e 是奇数还是偶数，如果 i 是偶数，则返回 2。如果是奇数，则返回 \x3ccode\x3e(i % 2 * j - j \x2b n \/ delay ^ j) \x26amp; 1\x3c\/code\x3e 的计算结果（更多的是这种情况）。\x3c\/p\x3e\n\x3cp\x3e最终，这个返回值被当作索引，被用于获取字符串P的某个字符，因此它可以写成 \x3ccode\x3eP \x2b= P[index]\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var delay = 64;\nvar p = document.getElementById(\x26quot;p\x26quot;);\n\/\/ var draw = \x26quot;for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x26quot;;\nvar draw = function() {\n    var i = delay;\n    var P =\x27p.\\n\x27;\n    var j;\n    n \x2b= 7;\n    while (i \x3e 0) {\n        \/\/Update HTML\n        p.innerHTML = P;\n\n        j = delay \/ i;\n        i -= 1 \/ delay;\n\n        let index;\n        let iIsOdd = (i % 2 != 0); \/\/ \x3c---------------\n\n        if (iIsOdd) { \/\/ \x3c---------------\n            index = (i % 2 * j - j \x2b n \/ delay ^ j) \x26amp; 1;\n        } else {\n            index = 2;\n        }\n\n        P \x2b= P[index];\n    }\n};\nvar n = setInterval(draw, delay);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e delay = \x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22p\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ var draw = \x22for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x22;\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e draw = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = delay;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e P =\x3cspan class=\x22hljs-string\x22\x3e\x27p.\\n\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e j;\n    n \x2b= \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (i \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/Update HTML\x3c\/span\x3e\n        p.innerHTML = P;\n\n        j = delay \/ i;\n        i -= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \/ delay;\n\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e index;\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e iIsOdd = (i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e != \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt;---------------\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (iIsOdd) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt;---------------\x3c\/span\x3e\n            index = (i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * j - j \x2b n \/ delay ^ j) \x26amp; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            index = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n        }\n\n        P \x2b= P[index];\n    }\n};\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e n = setInterval(draw, delay);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e下一步，我会把 \x3ccode\x3eindex = (i % 2 * j - j \x2b n \/ delay ^ j) \x26amp; 1\x3c\/code\x3e 里的 \x3ccode\x3e\x26amp; 1\x3c\/code\x3e 分解到另外的 if 表达式里。\x3c\/p\x3e\n\x3cp\x3e这是一种聪明的方法来检测括号内的值是奇数还是偶数，如果是偶数则返回 0，反之返回 1.\x3ccode\x3e\x26amp;\x3c\/code\x3e 是与的位运算符。与的逻辑如下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e1 \x26amp; 1 = 1\x3c\/li\x3e\n\x3cli\x3e0 \x26amp; 1 = 0\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e因此 \x3ccode\x3esomething \x26amp; 1\x3c\/code\x3e 则可以看成把“something”转化成二进制，接着在 1 的前面填充对应数量的 0，从而保持和 something 的长度一致，然后仅仅返回与运算的最后一位。例如，5的二进制是 \x3ccode\x3e101\x3c\/code\x3e。如果我们和 \x3ccode\x3e1\x3c\/code\x3e 进行与运算，将会得到如下结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    101\nAND 001\n    001\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e    \x3cspan class=\x22hljs-number\x22\x3e101\x3c\/span\x3e\nAND \x3cspan class=\x22hljs-number\x22\x3e001\x3c\/span\x3e\n    \x3cspan class=\x22hljs-number\x22\x3e001\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e或者说，5是一个奇数，\x3ccode\x3e5 \x26amp; 1\x3c\/code\x3e 的结果是 1。用 JavaScript 的控制台很容易可以证明下面这个逻辑。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x220 \x26amp; 1 \/\/ 0 - even return 0\n1 \x26amp; 1 \/\/ 1 - odd return 1\n2 \x26amp; 1 \/\/ 0 - even return 0\n3 \x26amp; 1 \/\/ 1 - odd return 1\n4 \x26amp; 1 \/\/ 0 - even return 0\n5 \x26amp; 1 \/\/ 1 - odd return 1\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x26amp; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 0 - even return 0\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x26amp; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1 - odd return 1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e \x26amp; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 0 - even return 0\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e \x26amp; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1 - odd return 1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x26amp; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 0 - even return 0\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e \x26amp; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1 - odd return 1\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意，我将上述 \x3ccode\x3eindex\x3c\/code\x3e 的剩余部分重命名为 \x3ccode\x3emagic\x3c\/code\x3e。因此这些代码加上展开 \x3ccode\x3e\x26amp; 1\x3c\/code\x3e 后的代码看起来是下面这样的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var delay = 64;\nvar p = document.getElementById(\x26quot;p\x26quot;);\n\/\/ var draw = \x26quot;for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x26quot;;\nvar draw = function() {\n    var i = delay;\n    var P =\x27p.\\n\x27;\n    var j;\n    n \x2b= 7;\n    while (i \x3e 0) {\n        \/\/Update HTML\n        p.innerHTML = P;\n\n        j = delay \/ i;\n        i -= 1 \/ delay;\n\n        let index;\n        let iIsOdd = (i % 2 != 0);\n\n        if (iIsOdd) {\n            let magic = (i % 2 * j - j \x2b n \/ delay ^ j);\n            let magicIsOdd = (magic % 2 != 0); \/\/ \x26amp;1 \x3c --------------------------\n            if (magicIsOdd) { \/\/ \x26amp;1 \x3c--------------------------\n                index = 1;\n            } else {\n                index = 0;\n            }\n        } else {\n            index = 2;\n        }\n\n        P \x2b= P[index];\n    }\n};\nvar n = setInterval(draw, delay);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e delay = \x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22p\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ var draw = \x22for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x22;\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e draw = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = delay;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e P =\x3cspan class=\x22hljs-string\x22\x3e\x27p.\\n\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e j;\n    n \x2b= \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (i \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/Update HTML\x3c\/span\x3e\n        p.innerHTML = P;\n\n        j = delay \/ i;\n        i -= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \/ delay;\n\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e index;\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e iIsOdd = (i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e != \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (iIsOdd) {\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e magic = (i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * j - j \x2b n \/ delay ^ j);\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e magicIsOdd = (magic % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e != \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26amp;1 \x26lt; --------------------------\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (magicIsOdd) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26amp;1 \x26lt;--------------------------\x3c\/span\x3e\n                index = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                index = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n            }\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            index = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n        }\n\n        P \x2b= P[index];\n    }\n};\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e n = setInterval(draw, delay);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来，我将会分解 \x3ccode\x3eP \x2b= P[index]\x3c\/code\x3e 到一个 switch 表达式里。现在我们可以很清晰的知道 index的值只可能为 0、1 和 2 中的一个。也可以知道 P 的初始化总是 \x3ccode\x3evar P =\x27p.\\n\x27\x3c\/code\x3e， index 为 0 时指向 \x3ccode\x3ep\x3c\/code\x3e，为 1 时指向 \x3ccode\x3e.\x3c\/code\x3e，为 2 时指向 \x3ccode\x3e\\n\x3c\/code\x3e —— 新的一行字符串。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var delay = 64;\nvar p = document.getElementById(\x26quot;p\x26quot;);\n\/\/ var draw = \x26quot;for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x26quot;;\nvar draw = function() {\n    var i = delay;\n    var P =\x27p.\\n\x27;\n    var j;\n    n \x2b= 7;\n    while (i \x3e 0) {\n        \/\/Update HTML\n        p.innerHTML = P;\n\n        j = delay \/ i;\n        i -= 1 \/ delay;\n\n        let index;\n        let iIsOdd = (i % 2 != 0);\n\n        if (iIsOdd) {\n            let magic = (i % 2 * j - j \x2b n \/ delay ^ j);\n            let magicIsOdd = (magic % 2 != 0); \/\/ \x26amp;1\n            if (magicIsOdd) { \/\/ \x26amp;1\n                index = 1;\n            } else {\n                index = 0;\n            }\n        } else {\n            index = 2;\n        }\n\n        switch (index) { \/\/ P \x2b= P[index]; \x3c-----------------------\n            case 0:\n                P \x2b= \x26quot;p\x26quot;; \/\/ aka P[0]\n                break;\n            case 1:\n                P \x2b= \x26quot;.\x26quot;; \/\/ aka P[1]\n                break;\n            case 2:\n                P \x2b= \x26quot;\\n\x26quot;; \/\/ aka P[2]\n        }\n    }\n};\n\nvar n = setInterval(draw, delay);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e delay = \x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22p\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ var draw = \x22for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x22;\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e draw = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = delay;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e P =\x3cspan class=\x22hljs-string\x22\x3e\x27p.\\n\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e j;\n    n \x2b= \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (i \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/Update HTML\x3c\/span\x3e\n        p.innerHTML = P;\n\n        j = delay \/ i;\n        i -= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \/ delay;\n\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e index;\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e iIsOdd = (i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e != \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (iIsOdd) {\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e magic = (i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * j - j \x2b n \/ delay ^ j);\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e magicIsOdd = (magic % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e != \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26amp;1\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (magicIsOdd) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26amp;1\x3c\/span\x3e\n                index = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                index = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n            }\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            index = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (index) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ P \x2b= P[index]; \x26lt;-----------------------\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e:\n                P \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22p\x22\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ aka P[0]\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e:\n                P \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22.\x22\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ aka P[1]\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e:\n                P \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\\n\x22\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ aka P[2]\x3c\/span\x3e\n        }\n    }\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e n = setInterval(draw, delay);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我将简化 \x3ccode\x3evar n = setInterval(draw, delay)\x3c\/code\x3e。\x3ccode\x3esetInterval\x3c\/code\x3e 会返回一个从 1 开始的整数，并且每次执行完 \x3ccode\x3esetInterval\x3c\/code\x3e 之后返回值都会递增。这个整数可以在 \x3ccode\x3eclearInterval\x3c\/code\x3e 方法里面用到（用来取消定时器）。在我们的代码里， \x3ccode\x3esetInterval\x3c\/code\x3e 仅仅只会执行一次，所以 n 可以简单的设置为 1.\x3c\/p\x3e\n\x3cp\x3e我还把 \x3ccode\x3edelay\x3c\/code\x3e 重命名为 \x3ccode\x3eDELAY\x3c\/code\x3e 让它看起来是一个常量。\x3c\/p\x3e\n\x3cp\x3e最后但并非不重要的一点，我用括号把 \x3ccode\x3ei % 2 * j - j \x2b n \/ DELAY\x3c\/code\x3e 包起来，指明 \x3ccode\x3e^\x3c\/code\x3e 异或运算的执行优先度低于 \x3ccode\x3e%\x3c\/code\x3e,\x3ccode\x3e*\x3c\/code\x3e,\x3ccode\x3e-\x3c\/code\x3e,\x3ccode\x3e\x2b\x3c\/code\x3e和\x3ccode\x3e\/\x3c\/code\x3e操作。或者说，所有的运算操作都会比 \x3ccode\x3e^\x3c\/code\x3e 先执行。包装后的代码应该是这样的 \x3ccode\x3e((i % 2 * j - j \x2b n \/ DELAY) ^ j)\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ 之前我把 `p.innerHTML = P;` 放错地方了，更新后，把它移出了while循环\n\nconst DELAY = 64; \/\/ approximately 15 frames per second 15 frames per second * 64 seconds = 960 frames\nvar n = 1;\nvar p = document.getElementById(\x26quot;p\x26quot;);\n\/\/ var draw = \x26quot;for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x26quot;;\n\n\/**\n * Draws a picture\n * 128 chars by 32 chars = total 4096 chars\n *\/\nvar draw = function() {\n    var i = DELAY; \/\/ 64\n    var P =\x27p.\\n\x27; \/\/ First line, reference for chars to use\n    var j;\n\n    n \x2b= 7;\n\n    while (i \x3e 0) {\n\n        j = DELAY \/ i;\n        i -= 1 \/ DELAY;\n\n        let index;\n        let iIsOdd = (i % 2 != 0);\n\n        if (iIsOdd) {\n            let magic = ((i % 2 * j - j \x2b n \/ DELAY) ^ j); \/\/ \x3c ------------------\n            let magicIsOdd = (magic % 2 != 0); \/\/ \x26amp;1\n            if (magicIsOdd) { \/\/ \x26amp;1\n                index = 1;\n            } else {\n                index = 0;\n            }\n        } else {\n            index = 2;\n        }\n\n        switch (index) { \/\/ P \x2b= P[index];\n            case 0:\n                P \x2b= \x26quot;p\x26quot;; \/\/ aka P[0]\n                break;\n            case 1:\n                P \x2b= \x26quot;.\x26quot;; \/\/ aka P[1]\n                break;\n            case 2:\n                P \x2b= \x26quot;\\n\x26quot;; \/\/ aka P[2]\n        }\n    }\n    \/\/Update HTML\n    p.innerHTML = P;\n};\n\nsetInterval(draw, 64);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 之前我把 `p.innerHTML = P;` 放错地方了，更新后，把它移出了while循环\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e DELAY = \x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ approximately 15 frames per second 15 frames per second * 64 seconds = 960 frames\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e n = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22p\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ var draw = \x22for(n\x2b=7,i=delay,P=\x27p.\\\\n\x27;i-=1\/delay;P\x2b=P[i%2?(i%2*j-j\x2bn\/delay^j)\x26amp;1:2])j=delay\/i;p.innerHTML=P\x22;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * Draws a picture\n * 128 chars by 32 chars = total 4096 chars\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e draw = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = DELAY; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 64\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e P =\x3cspan class=\x22hljs-string\x22\x3e\x27p.\\n\x27\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ First line, reference for chars to use\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e j;\n\n    n \x2b= \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (i \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n\n        j = DELAY \/ i;\n        i -= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \/ DELAY;\n\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e index;\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e iIsOdd = (i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e != \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (iIsOdd) {\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e magic = ((i % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * j - j \x2b n \/ DELAY) ^ j); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt; ------------------\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e magicIsOdd = (magic % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e != \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26amp;1\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (magicIsOdd) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26amp;1\x3c\/span\x3e\n                index = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                index = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n            }\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            index = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (index) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ P \x2b= P[index];\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e:\n                P \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22p\x22\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ aka P[0]\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e:\n                P \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22.\x22\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ aka P[1]\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e:\n                P \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\\n\x22\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ aka P[2]\x3c\/span\x3e\n        }\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/Update HTML\x3c\/span\x3e\n    p.innerHTML = P;\n};\n\nsetInterval(draw, \x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你可以在\x3ca href=\x22https:\/\/codepen.io\/akras14\/pen\/qjgrxz\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22akras14\/pen\/qjgrxz\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e看到最后的结果。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e第二步：理解代码\x3c\/h2\x3e\n\x3cp\x3e这部分将会介绍什么内容呢？不要心急，让我们一步一步来解析。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ei\x3c\/code\x3e 通过 \x3ccode\x3evar i = DELAY\x3c\/code\x3e，被初始化为 64，然后每次循环递减 1\/64，等于0.015625（i -= 1 \/ DELAY）。循环持续到 \x3ccode\x3ei\x3c\/code\x3e 小于 0 时（\x3ccode\x3ewhile (i \x26gt; 0) {\x3c\/code\x3e）。每次执行循环，\x3ccode\x3ei\x3c\/code\x3e 将会减少 1\/64，所以每执行 64 次循环，\x3ccode\x3ei\x3c\/code\x3e 就会减 1 （64 \/ 64 = 1），总得来说， \x3ccode\x3ei\x3c\/code\x3e 需要执行 64 x 64 = 4096 次，之后小于 0.\x3c\/p\x3e\n\x3cp\x3e之前的图片中，一共有 32 行，每行包含了 128 个字符。恰巧的是 64 x 64 = 32 x 128 = 4096。我们触发 32 次 \x3ccode\x3ei\x3c\/code\x3e 为严谨的偶数的情况，\x3ccode\x3ei\x3c\/code\x3e 是绝对的偶数时，\x3ccode\x3ei\x3c\/code\x3e 才为偶数（非奇数 \x3ccode\x3elet iIsOdd = (i % 2 != 0)\x3c\/code\x3e; 译者提示：偶数是整数，所以2.2是奇数），例如 \x3ccode\x3ei\x3c\/code\x3e 为 64，62，60等。在这 32 次里，index 通过 \x3ccode\x3eindex = 2\x3c\/code\x3e 赋值为 2，意味着字符串将添加 \x3ccode\x3eP \x2b= \x22\\n\x22; \/\/ aka P[2]\x3c\/code\x3e 从而换行，开始一行新的字符串。剩余的 127 个字符则都是 \x3ccode\x3ep\x3c\/code\x3e 和 \x3ccode\x3e.\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e那么我们根据什么来判断何时用 \x3ccode\x3ep\x3c\/code\x3e 或者 \x3ccode\x3e.\x3c\/code\x3e ?\x3c\/p\x3e\n\x3cp\x3e当然，之前我们就已经知道了，当 \x3ccode\x3elet magic = ((i % 2 * j - j \x2b n \/ DELAY) ^ j)\x3c\/code\x3e 中的 magic 是奇数的时候用 \x3ccode\x3e.\x3c\/code\x3e ，如果是偶数则用 \x3ccode\x3ep\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var P =\x27p.\\n\x27;\n\n...\n\nif (magicIsOdd) { \/\/ \x26amp;1\n    index = 1; \/\/ second char in P - .\n} else {\n    index = 0; \/\/ first char in P - p\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e P =\x3cspan class=\x22hljs-string\x22\x3e\x27p.\\n\x27\x3c\/span\x3e;\n\n...\n\nif (magicIsOdd) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26amp;1\x3c\/span\x3e\n    index = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ second char in P - .\x3c\/span\x3e\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    index = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ first char in P - p\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但我们很难知道 magic 是奇数还是偶数，这是一个很有分量的问题。在此之前，让我们证实一些事情。\x3c\/p\x3e\n\x3cp\x3e如果我们把 \x3ccode\x3e\x2b n\/DELAY\x3c\/code\x3e 从 \x3ccode\x3elet magic = ((i % 2 * j - j \x2b n \/ DELAY) ^ j)\x3c\/code\x3e 当中移除掉，我们最终将会看到一个静态的布局，如下图\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073915\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073915\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e现在，让我们来看看移除了 \x3ccode\x3e\x2b n\/DELAY\x3c\/code\x3e 的 \x3ccode\x3emagic\x3c\/code\x3e。如何能得到上面漂亮的图片。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3e(i % 2 * j - j) ^ j\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e注意到每次循环里，我们都会执行：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22j = DELAY \/ i;\ni -= 1 \/ DELAY;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3ej = DELAY \/ i;\ni -= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \/ DELAY;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e换句话说，我们可以将上述表达式中的 \x3ccode\x3ej\x3c\/code\x3e 用 \x3ccode\x3ei\x3c\/code\x3e 表示，变成 \x3ccode\x3ej = DELAY\/ (i \x2b 1\/DELAY)\x3c\/code\x3e，但因为 1\/DELAY 是一个非常小的数值，所以我们暂时去掉 \x3ccode\x3e\x2b 1\/DELAY\x3c\/code\x3e 并简化成 \x3ccode\x3ej = DELAY\/i = 64\/i\x3c\/code\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\/\/ 译者注\x3c\/p\x3e\n\x3cp\x3e为何这里不是 j = DELAY\/ (i - 1\/DELAY)呢？\x3c\/p\x3e\n\x3cp\x3e原因：\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ei -= 1 \/ DELAY\x3c\/code\x3e 转化成 \x3ccode\x3ei = i - 1 \/ DELAY\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e这里有 2 个 \x3ccode\x3ei\x3c\/code\x3e 可以代入消元，但是因为 \x3ccode\x3ej\x3c\/code\x3e 的表达式在 \x3ccode\x3ei\x3c\/code\x3e 前面，所以 \x3ccode\x3ej\x3c\/code\x3e 取得 \x3ccode\x3ei\x3c\/code\x3e 应\x3cbr\x3e该是自减前的 \x3ccode\x3ei\x3c\/code\x3e，故 \x3ccode\x3ei = i \x2b 1\/ DELAY\x3c\/code\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e因此我们可以重写 \x3ccode\x3e(i % 2 * j - j) ^ j\x3c\/code\x3e 为 \x3ccode\x3e(i % 2 * 64\/i - 64\/i) ^ 64\/i\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e让我们用\x3ca href=\x22https:\/\/www.desmos.com\/calculator\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e在线的图形计算器\x3c\/a\x3e来绘制那些函数\x3c\/p\x3e\n\x3cp\x3e首先，我们来绘制下 \x3ccode\x3ei%2\x3c\/code\x3e 的图\x3c\/p\x3e\n\x3cp\x3e从下面的图形可以看出，y 的值区间在 0 到 2 之间。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073916\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073916\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如果我们绘制 \x3ccode\x3e64 \/ i\x3c\/code\x3e 则会得到如下图形\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073917\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073917\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如果我们绘制 \x3ccode\x3e(i % 2 * 64\/i - 64\/i)\x3c\/code\x3e 表达式，我们将得到一个混合了上面两张图的一个图形，如下\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073918\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073918\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e最后，如果我们把2个函数同时绘制出来，将会是如下的图（红线为 \x3ccode\x3ej\x3c\/code\x3e 的关系图）\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073919\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073919\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e我们能从图形里知道些什么？\x3c\/h2\x3e\n\x3cp\x3e让我们回忆下我们要去解答的问题：如何得到如下静止图像：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073920\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073920\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e好的，我们知道如果 \x3ccode\x3e(i % 2 * j - j) ^ j\x3c\/code\x3e 的值是一个偶数，那么我们将添加 \x3ccode\x3ep\x3c\/code\x3e，如果是一个奇数则添加 \x3ccode\x3e.\x3c\/code\x3e 。\x3c\/p\x3e\n\x3cp\x3e让我们专注在图形的前面 16 行，\x3ccode\x3ei\x3c\/code\x3e 的值在 64 到 32 之间。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073921\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073921\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e异或运算在 JavaScript 里会把小数点右边的值忽略掉，所以它看起来和执行 \x3ccode\x3eMath.floor\x3c\/code\x3e 的效果一样。\x3c\/p\x3e\n\x3cp\x3e其实当2个对比位都是 1 或者 0 的时候, 异或操作会返回0。\x3c\/p\x3e\n\x3cp\x3e这里我们的 \x3ccode\x3ej\x3c\/code\x3e 初始值为 1，且慢慢的递增趋向于 2，但始终小于 2，所以我们可以把它当成 1 来处理（\x3ccode\x3eMath.floor(1.9999) === 1\x3c\/code\x3e），为了得到结果为 0 （意味着是偶数），我们还需要异或表达式的左边也是 1，使得返回一个 \x3ccode\x3ep\x3c\/code\x3e 给我们。\x3c\/p\x3e\n\x3cp\x3e换句话说，每条藏青色的倾斜线都相当于我们图像中的一行，因为前面16行的 \x3ccode\x3ej\x3c\/code\x3e 值总是介于 1 和 2 之间，而唯一能得到奇数值的方法是让 \x3ccode\x3e(i % 2 * j - j) ^ j\x3c\/code\x3e（也可以说\x3ccode\x3ei % 2 * i\/64 - i\/64\x3c\/code\x3e 或者藏青色的倾斜线）大于 1 或小于 -1。\x3c\/p\x3e\n\x3cp\x3e为了将这个地方讲清楚，这里有一些Javascript控制台的输出，0 或者 -2 意味着结果是偶数，1 则是奇数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221 ^ 1 \/\/ 0 - even p\n1.1 ^ 1.1 \/\/ 0 - even p\n0.9 ^ 1 \/\/ 1 - odd .\n0 ^ 1 \/\/ 1 - odd .\n-1 ^ 1 \/\/ -2 - even p\n-1.1 ^ 1.1 \/\/ -2 - even p\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e ^ \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 0 - even p\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e ^ \x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 0 - even p\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e0.9\x3c\/span\x3e ^ \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1 - odd .\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ^ \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1 - odd .\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e ^ \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ -2 - even p\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e-1.1\x3c\/span\x3e ^ \x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ -2 - even p\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果我们观察下我们的图形，可以看出原点右边的斜线大部分都是大于 1 或者小于 -1（几乎没有偶数，或者说几乎没有 p），且越靠后（靠近原点）越如此。第 16 行几乎介于 2 和 -2 之间。第 16 行之后，我们可以看到图形是另外一种模式。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073922\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073922\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e16 行之后 \x3ccode\x3ej\x3c\/code\x3e 超过了 2，使得结果发生了变化。现在当藏青色的斜线大于 2 ，小于 -2 ，或者在1和-1之间且不等于的时候，我们将会得到一个偶数。这也是为什么在 17 行之后我们会在一行内看到两组和两组以上的 \x3ccode\x3ep\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果你仔细看动图的最底部几行，你会发现这几行不符合上面的规则，图表曲线看起来起伏非常大。\x3c\/p\x3e\n\x3cp\x3e现在让我们把 \x3ccode\x3e\x2b n\/DELAY\x3c\/code\x3e 加回来。在代码里我们可以看到 \x3ccode\x3en\x3c\/code\x3e 的初始值是 8 （初始是 1 ，但是每次定时器被调用时就加 7），它会在每次执行定时器时增加 7。\x3c\/p\x3e\n\x3cp\x3e当 \x3ccode\x3en\x3c\/code\x3e 变成 64，图形会变成如下样子。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073923\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073923\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以注意到，\x3ccode\x3ej\x3c\/code\x3e 总是 ~1（这里的 ~ 是近似的意思），但是现在红斜线的左半边位于 62-63 区间的值无限趋近于 0，红斜线的右半边位于 63-64 则无限趋近与 1。因为我们的字符按64到62的顺序排列，那么我们可以猜测斜线的 63-64 部分（1^1=0 是偶数）添加的是一段 \x3ccode\x3ep\x3c\/code\x3e，左边 62-63 部分（1^0=1 是奇数）添加的是一段 \x3ccode\x3e.\x3c\/code\x3e。就像普通的英语单词一样，从左到右的添加上。\x3c\/p\x3e\n\x3cp\x3e用 HTML 渲染出来的话，将会看到下图（你可以自己在 codepen 改变 \x3ccode\x3en\x3c\/code\x3e 来观看效果）。这和我们的预期一致。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073924\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073924\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这一时刻 \x3ccode\x3ep\x3c\/code\x3e 的数量已经增长了一定的数量。例如第一行里面就有一半的值是偶数，从现在起，一大段的\x3ccode\x3ep\x3c\/code\x3e 和 \x3ccode\x3es\x3c\/code\x3e 将移动他们的位置。\x3c\/p\x3e\n\x3cp\x3e为了说明这一点，我们可以看到当 \x3ccode\x3en\x3c\/code\x3e 在下一个定时器里增加了 7 时，图形就会有稍微的变化\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073925\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073925\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e注意，第一行的斜线（在 64 附近）已经稍微移动了 1 小格，假设 4 个方格代表 128 个字符，1 个方格 相当于 32 个字符，那么 1 个小格则相当于 32\/5=6.4 个字符（大约）。正如下图所示，我们可以看到第一行实际上向右移动了 7 个字符。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073926\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073926\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e最后一个例子。就是当定时器被调用超过 7 次时（n 等于 64\x2b9x7）会发生什么。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073927\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073927\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e对于第一行，\x3ccode\x3ej\x3c\/code\x3e 还等于 1。现在红斜线的上部分在 64 左右的值趋向于 2，下部分趋向于 1。这个图片将会翻转，因为现在 \x3ccode\x3e1^2 = 3 是奇数-输出.\x3c\/code\x3e 而 \x3ccode\x3e1^1 = 0 是偶数- 输出p\x3c\/code\x3e。所以我们预期在一大段 \x3ccode\x3ep\x3c\/code\x3e 之后会是一大段 \x3ccode\x3e.\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e他会这么渲染。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073928\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073928\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e自此，图形将会以这种形式无限循环下去。\x3c\/p\x3e\n\x3cp\x3e我希望我解释清楚了。我不认为自己有能力写出这样的代码，但是我很享受理解它的过程。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010887896\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010887896\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011073929\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011073929\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3eiKcamp原创新书《移动Web前端高效开发实战》已在亚马逊、京东、当当开售。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/m.bosszhipin.com\/weijd\/v2\/job\/7bbfc95b9f1e9c4a1nRy2926FVA~?date8=20170905\x26amp;sid=self_jd\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e沪江Web前端上海团队招聘【Web前端架构师】，有意者简历至：zhouyao@hujiang.com\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>翻译 | 一行 JavaScript 代码的逆向工程</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011073909">https://segmentfault.com/a/1190000011073909</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/4knm3gep6kq/" target="_blank">https://alili.tech/archive/4knm3gep6kq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>