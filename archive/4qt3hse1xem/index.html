<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="mongoose学习笔记（超详细）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>mongoose学习笔记（超详细） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4qt3hse1xem/",
				"appid": "1613049289050283", 
				"title": "mongoose学习笔记（超详细） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-04T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/nn5kkhh0sw/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/h7cvmncoktm/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4qt3hse1xem%2f&text=mongoose%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e8%b6%85%e8%af%a6%e7%bb%86%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4qt3hse1xem%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4qt3hse1xem%2f&text=mongoose%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e8%b6%85%e8%af%a6%e7%bb%86%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4qt3hse1xem%2f&title=mongoose%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e8%b6%85%e8%af%a6%e7%bb%86%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4qt3hse1xem%2f&is_video=false&description=mongoose%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e8%b6%85%e8%af%a6%e7%bb%86%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=mongoose%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e8%b6%85%e8%af%a6%e7%bb%86%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4qt3hse1xem%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4qt3hse1xem%2f&title=mongoose%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e8%b6%85%e8%af%a6%e7%bb%86%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4qt3hse1xem%2f&title=mongoose%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e8%b6%85%e8%af%a6%e7%bb%86%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4qt3hse1xem%2f&title=mongoose%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e8%b6%85%e8%af%a6%e7%bb%86%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4qt3hse1xem%2f&title=mongoose%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e8%b6%85%e8%af%a6%e7%bb%86%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">mongoose学习笔记（超详细）</h1><div class="meta"><div class="postdate"><time datetime="2019-01-04" itemprop="datePublished">2019-01-04</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e\x3ca href=\x22http:\/\/cnodejs.org\/topic\/58b911997872ea0864fee313\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e原文出处\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e名词解释\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3eSchema： 一种以文件形式存储的数据库模型骨架，不具备数据库的操作能力\x3c\/li\x3e\n\x3cli\x3eModel： 由Schema编译而成的假想（fancy）构造器，具有抽象属性和行为。Model的每一个实例（instance）就是一个document。document可以保存到数据库和从数据库返回。\x3c\/li\x3e\n\x3cli\x3eInstance： 由Model创建的实例。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e概念解析\x3c\/h2\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3eSQL术语\/概念\x3c\/th\x3e\n\x3cth align=\x22center\x22\x3eMongoDB术语\/概念\x3c\/th\x3e\n\x3cth align=\x22left\x22\x3e解释\/说明\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3erdatabase\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3edatabase\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e-\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3etable\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3ecollection\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e数据库表\/集合\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3erow\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3edocument\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e数据记录行\/文档\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ecolumn\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3eindex\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e数据记录行\/文档\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3etable joins\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3e-\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e表连接,MongoDB不支持\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eprimary key\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3eprimary key 主键\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3eMongoDB自动将_id字段设置为主键\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e定义Schema\x3c\/h2\x3e\n\x3cp\x3emongoose中任何任何事物都是从Schema开始的。每一个Schema对应MongoDB中的一个集合（collection）。Schema中定义了集合中文档（document）的样式。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var mongoose = require(\x27mongoose\x27);\nvar Schema = mongoose.Schema;\nvar blogSchema = new Schema({  \n    title:  String,  \n    author: String,  \n    body:   String,  \n    comments: [{ body: String, date: Date }],  \n    date: { type: Date, default: Date.now },  \n    hidden: Boolean, \n    meta: {    votes: Number,    favs:  Number  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e mongoose = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27mongoose\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Schema = mongoose.Schema;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e blogSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({  \n    title:  \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e,  \n    author: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e,  \n    body:   \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e,  \n    comments: [{ body: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e, date: \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e }],  \n    date: { \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now },  \n    hidden: \x3cspan class=\x22hljs-built_in\x22\x3eBoolean\x3c\/span\x3e, \n    meta: {    votes: \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e,    favs:  \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果之后想要在Schema中添加键，可以使用Schema#add方法。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e创造一个model\x3c\/h2\x3e\n\x3cp\x3e为了使用schema定义，我们需要转换blogSchema为一个Model。使用\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22mongoose.model(modelName, schema)\nvar BlogModel = mongoose.model(\x27Blog\x27, blogSchema);\/\/ 开始吧！\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3emongoose.model(modelName, schema)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e BlogModel = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Blog\x27\x3c\/span\x3e, blogSchema);\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 开始吧！\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e实例方法\x3c\/h2\x3e\n\x3cp\x3eModel的实例是document。实例有很多内置的方法，我们也可以给实例自定义方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var animalSchema = new Schema({ \n    name: String, type: String    \n});\nanimalSchema.methods.findSimilarTypes = function (cb) {\n    return this.model(\x27Animal\x27).find({ type: this.type }, cb);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e animalSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ \n    name: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e    \n});\nanimalSchema.methods.findSimilarTypes = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Animal\x27\x3c\/span\x3e).find({ \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.type }, cb);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在所有的动物实例有findSimilarTypes方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var AnimalModel = mongoose.model(\x27Animal\x27, animalSechema);\nvar dog = new AnimalModel({ type: \x27dog\x27 });\ndog.findSimilarTypes(function (err, dogs) { \n    console.log(dogs); \/\/ woof\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e AnimalModel = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Animal\x27\x3c\/span\x3e, animalSechema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dog = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AnimalModel({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27dog\x27\x3c\/span\x3e });\ndog.findSimilarTypes(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, dogs\x3c\/span\x3e) \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(dogs); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ woof\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e重写一个默认的实例方法可能会导致不期待的结果。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3eStatics方法\x3c\/h2\x3e\n\x3cp\x3e给Model添加一个静态方法也是简单的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22animalSchema.statics.findByName = function (name, cb) {\n    this.find({ name: new RegExp(name, \x27i\x27) }, cb);\n}\n\nvar AnimalModel = mongoose.model(\x27Animal\x27, animalSchema);\nAnimalModel.findByName(\x27fido\x27, function (err, animals) { \n    console.log(animals);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3eanimalSchema.statics.findByName = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ename, cb\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.find({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eRegExp\x3c\/span\x3e(name, \x3cspan class=\x22hljs-string\x22\x3e\x27i\x27\x3c\/span\x3e) }, cb);\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e AnimalModel = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Animal\x27\x3c\/span\x3e, animalSchema);\nAnimalModel.findByName(\x3cspan class=\x22hljs-string\x22\x3e\x27fido\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, animals\x3c\/span\x3e) \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(animals);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3emethods和statics的区别\x3c\/h3\x3e\n\x3cp\x3e区别就是一个给Model添加方法（statics），\x3cbr\x3e一个给实例添加方法（methods）。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e索引\x3c\/h2\x3e\n\x3cp\x3eMongoDB支持二级索引，定义索引有两种方式\x3c\/p\x3e\n\x3cp\x3e路径级别 schema级别\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var animalSchema = new Schema({  \n    name: String,  \n    type: String,  \n    tags: { type: [String], index: true } \/\/ field level\n    });\n\nanimalSchema.index({ name: 1, type: -1 }); \/\/ schema level, 1是正序，-1是倒序\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e animalSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e({  \n    name: \x3cspan class=\x22hljs-type\x22\x3eString\x3c\/span\x3e,  \n    \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-type\x22\x3eString\x3c\/span\x3e,  \n    tags: { \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: [\x3cspan class=\x22hljs-type\x22\x3eString\x3c\/span\x3e], index: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e } \x3cspan class=\x22hljs-comment\x22\x3e\/\/ field level\x3c\/span\x3e\n    });\n\nanimalSchema.index({ name: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e }); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ schema level, 1是正序，-1是倒序\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果要建立复合索引的话，在schema级别建立是必要的。\x3c\/p\x3e\n\x3cp\x3e索引或者复合索引能让搜索更加高效，默认索引就是主键索引ObjectId，属性名为_id。\x3c\/p\x3e\n\x3cp\x3e数据库中主要的就是CRUD操作，建立索引可以提高查询速度。但是过多的索引会降低CUD操作。深度好文如下\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/huangxincheng\/archive\/2012\/02\/29\/2372699.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.cnblogs.com\/huangx...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e虚拟属性\x3c\/h2\x3e\n\x3cp\x3eSchema中如果定义了虚拟属性，那么该属性将不写入数据库。写入数据库的还是原来的属性。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 定义一个schema\n\nvar personSchema = new Schema({  \n    name: {  first: String,    last: String  }\n});\n\n\/\/ 编译\nvar Person = mongoose.model(\x27Person\x27, personSchema);\/\/ 创造实例\n\nvar bad = new Person({ \n    name: { first: \x27Walter\x27, last: \x27White\x27 }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dart\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 定义一个schema\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e personSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({  \n    name: {  first: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e,    last: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e  }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 编译\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Person = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Person\x27\x3c\/span\x3e, personSchema);\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创造实例\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e bad = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Person({ \n    name: { first: \x3cspan class=\x22hljs-string\x22\x3e\x27Walter\x27\x3c\/span\x3e, last: \x3cspan class=\x22hljs-string\x22\x3e\x27White\x27\x3c\/span\x3e }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们将名字分成名字和姓，如果要得到全名，我们需要\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22console.log(bad.name.first \x2b \x27 \x27 \x2b bad.name.last); \/\/ Walter White\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs livecodeserver\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3econsole.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(bad.name.\x3cspan class=\x22hljs-keyword\x22\x3efirst\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e \x2b bad.name.\x3cspan class=\x22hljs-keyword\x22\x3elast\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e \/\/ Walter White\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样无疑是麻烦的，我们可以通过虚拟属性的getter来解决这个问题。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22personSchema.virtual(\x27name.full\x27).get(function () { \n    return this.name.first \x2b \x27 \x27 \x2b this.name.last;\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3epersonSchema.virtual(\x3cspan class=\x22hljs-string\x22\x3e\x27name.full\x27\x3c\/span\x3e).\x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e(function () { \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name.first \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name.last;\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么就可以使用bad.name.full直接调用全名了。\x3c\/p\x3e\n\x3cp\x3e反之，如果我们知道虚拟属性name.full，通过setter也可以得到组成name.full的每一项。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22personSchema.virtual(\x27name.full\x27).set(function (name) {  \n    var split = name.split(\x27 \x27);  \n    this.name.first = split[0];  \n    this.name.last = split[1];\n});\n...\nmad.name.full = \x27Breaking Bad\x27;\nconsole.log(mad.name.first); \/\/ Breaking\nconsole.log(mad.name.last);  \/\/ Bad\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sqf\x22\x3e\x3ccode\x3epersonSchema.virtual(\x3cspan class=\x22hljs-string\x22\x3e\x27name.full\x27\x3c\/span\x3e).\x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3e(function (\x3cspan class=\x22hljs-built_in\x22\x3ename\x3c\/span\x3e) {  \n    var split = \x3cspan class=\x22hljs-built_in\x22\x3ename\x3c\/span\x3e.split(\x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e);  \n    this.\x3cspan class=\x22hljs-built_in\x22\x3ename\x3c\/span\x3e.first = split[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];  \n    this.\x3cspan class=\x22hljs-built_in\x22\x3ename\x3c\/span\x3e.last = split[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n});\n...\nmad.\x3cspan class=\x22hljs-built_in\x22\x3ename\x3c\/span\x3e.full = \x3cspan class=\x22hljs-string\x22\x3e\x27Breaking Bad\x27\x3c\/span\x3e;\nconsole.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(mad.\x3cspan class=\x22hljs-built_in\x22\x3ename\x3c\/span\x3e.first); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Breaking\x3c\/span\x3e\nconsole.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(mad.\x3cspan class=\x22hljs-built_in\x22\x3ename\x3c\/span\x3e.last);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Bad\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e配置项\x3c\/h2\x3e\n\x3cp\x3eschema有一些配置项可以使用，有两种方式：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22new Schema({…}, options)\n\nvar schema = new Schema({...});\nschema.set(option, value);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode\x3enew \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e({…}, options)\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e schema = new \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e(\x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e);\nschema.\x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3e(option, value);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e有效的配置有:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3eautoIndex（默认true）\x3c\/li\x3e\n\x3cli\x3ecapped\x3c\/li\x3e\n\x3cli\x3ecollection\x3c\/li\x3e\n\x3cli\x3eid _id（默认true）\x3c\/li\x3e\n\x3cli\x3eread safe（默认true）\x3c\/li\x3e\n\x3cli\x3eshardKey strict（默认true）\x3c\/li\x3e\n\x3cli\x3etoJSON\x3c\/li\x3e\n\x3cli\x3etoObject\x3c\/li\x3e\n\x3cli\x3eversionKey\x3c\/li\x3e\n\x3cli\x3etypeKey\x3c\/li\x3e\n\x3cli\x3evalidateBeforeSave\x3c\/li\x3e\n\x3cli\x3eskipVersioning\x3c\/li\x3e\n\x3cli\x3etimestamps\x3c\/li\x3e\n\x3cli\x3euseNestedStrict\x3c\/li\x3e\n\x3cli\x3eretainKeyOrder\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3eautoIndex–自动索引\x3c\/h3\x3e\n\x3cp\x3e应用开始的时候，Mongoose对每一个索引发送一个ensureIndex的命令。索引默认（_id）被Mongoose创建。\x3c\/p\x3e\n\x3cp\x3e当我们不需要设置索引的时候，就可以通过设置这个选项。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var schema = new Schema({..}, { autoIndex: false });\nvar Clock = mongoose.model(\x27Clock\x27, schema);\nClock.ensureIndexes(callback);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e schema = new \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e(\x3cspan class=\x22hljs-meta\x22\x3e{..}\x3c\/span\x3e, { autoIndex: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eClock\x3c\/span\x3e = mongoose.model(\x27\x3cspan class=\x22hljs-type\x22\x3eClock\x3c\/span\x3e\x27, schema);\n\x3cspan class=\x22hljs-type\x22\x3eClock\x3c\/span\x3e.ensureIndexes(callback);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3ebufferCommands\x3c\/h3\x3e\n\x3cp\x3e似乎是说这个（mongoose buffer）管理在mongoose连接关闭的时候重连，如果取消buffer设置，如下：（存疑）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var schema = new Schema({..}, { bufferCommands: false });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e schema = new \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e(\x3cspan class=\x22hljs-meta\x22\x3e{..}\x3c\/span\x3e, { bufferCommands: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e });\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3ecapped–上限设置\x3c\/h3\x3e\n\x3cp\x3e如果有数据库的批量操作，该属性能限制一次操作的量，例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22new Schema({...},{capped:1024});  \/\/一次操作上线1024条数据\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enew \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e(\x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e,{capped:\x3cspan class=\x22hljs-number\x22\x3e1024\x3c\/span\x3e});  \/\/一次操作上线\x3cspan class=\x22hljs-number\x22\x3e1024\x3c\/span\x3e条数据\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当然该参数也可是对象，包含size、max、autiIndexId属性\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22new Schema({...},{capped:{size:1024,max:100,autoIndexId:true\x22}}\x22);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enew \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e(\x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e,{capped:{size:\x3cspan class=\x22hljs-number\x22\x3e1024\x3c\/span\x3e,max:\x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e,autoIndexId:\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x22}}\x22);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3ecollection–集合名字\x3c\/h3\x3e\n\x3cp\x3e在MongDB中默认使用Model的名字作为集合的名字，如过需要自定义集合的名字，可以通过设置这个选项。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var schema = new Schema({...}, {collection: \x27yourName\x27});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e schema = new \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e(\x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e, {collection: \x27yourName\x27});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3eid\x3c\/h3\x3e\n\x3cp\x3emongoose分配给每一个schema一个虚拟属性id，它是一个getter。返回的是_id转换为字符串后的值。如果不需要为schema添加这个getter，可以通过id配置修改。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 默认行为\nvar pageSchema = new Schema({ name: String });\nvar pageModel = mongoose.model(\x27Page\x27, pageSchema);\nvar p = new pageModel({ name: \x27mongodb.org\x27 });\nconsole.log(p.id); \/\/ \x2750341373e894ad16347efe01\x27\n\n\/\/ 禁止id\nvar pageSchema = new Schema({ name: String }, { id: false } );\nvar pageModel = mongoose.model(\x27Page\x27, pageSchema);\nvar p = new pageModel({ name: \x27mongodb.org\x27 });\nconsole.log(p.id); \/\/ undefined\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 默认行为\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e pageSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ \x3cspan class=\x22hljs-attribute\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e });\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e pageModel = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Page\x27\x3c\/span\x3e, pageSchema);\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e pageModel({ \x3cspan class=\x22hljs-attribute\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27mongodb.org\x27\x3c\/span\x3e });\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(p.id); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x2750341373e894ad16347efe01\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 禁止id\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e pageSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ \x3cspan class=\x22hljs-attribute\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e }, { \x3cspan class=\x22hljs-attribute\x22\x3eid:\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e false\x3c\/span\x3e } );\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e pageModel = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Page\x27\x3c\/span\x3e, pageSchema);\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e pageModel({ \x3cspan class=\x22hljs-attribute\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27mongodb.org\x27\x3c\/span\x3e });\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(p.id); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ undefined\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e_id\x3c\/h3\x3e\n\x3cp\x3e在一个schema中如果没有定义_id域（field），那么mongoose将会默认分配一个_id域（field）。类型是ObjectId。如果不需要使用这个默认的选择，可以通过设置这个选项。\x3c\/p\x3e\n\x3cp\x3e通过在schema中设置这个字段可以阻止生成mongoose获得_id。但是在插入的时候仍然会生成_id。设置这个字段之后，如果再使用Schema.set(’_id’, false)将无效。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 默认行为\nvar pageSchema = new Schema({ name: String });\nvar pageModel = mongoose.model(\x27Page\x27, pageSchema);\nvar p = new pageModel({ name: \x27mongodb.org\x27 });\nconsole.log(p); \/\/ { _id: \x2750341373e894ad16347efe01\x27, name: \x27mongodb.org\x27 }\n\n\/\/ 禁用 _id\nvar pageSchema = new Schema({ name: String }, { _id: false });\n\/\/ schema构造器设置之后，不要再像下面这样设置\n\/\/ var schema = new Schema({ name: String });\n\/\/ schema.set(\x27_id\x27, false);\n\nvar PageModel = mongoose.model(\x27Page\x27, pageSchema);\nvar p = new pageModel({ name: \x27mongodb.org\x27 });\nconsole.log(p); \/\/ { name: \x27mongodb.org\x27 }\n\/\/ 当插入的时候，MongoDB将会创建_id\np.save(function (err) {  \n    if (err) return handleError(err);  \n    pageModel.findById(p, function (err, doc) { \n        if (err) return handleError(err);   \n        console.log(doc); \n        \/\/ { name: \x27mongodb.org\x27, _id: \x2750341373e894ad16347efe12\x27 }  \n    })\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 默认行为\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e pageSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e pageModel = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Page\x27\x3c\/span\x3e, pageSchema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e pageModel({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27mongodb.org\x27\x3c\/span\x3e });\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(p); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { _id: \x2750341373e894ad16347efe01\x27, name: \x27mongodb.org\x27 }\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 禁用 _id\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e pageSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e }, { \x3cspan class=\x22hljs-attr\x22\x3e_id\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e });\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ schema构造器设置之后，不要再像下面这样设置\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ var schema = new Schema({ name: String });\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ schema.set(\x27_id\x27, false);\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e PageModel = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Page\x27\x3c\/span\x3e, pageSchema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e pageModel({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27mongodb.org\x27\x3c\/span\x3e });\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(p); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { name: \x27mongodb.org\x27 }\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当插入的时候，MongoDB将会创建_id\x3c\/span\x3e\np.save(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{  \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e handleError(err);  \n    pageModel.findById(p, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, doc\x3c\/span\x3e) \x3c\/span\x3e{ \n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e handleError(err);   \n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(doc); \n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { name: \x27mongodb.org\x27, _id: \x2750341373e894ad16347efe12\x27 }  \x3c\/span\x3e\n    })\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为什么不建议使用set\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3eread\x3c\/h3\x3e\n\x3cp\x3e允许在schema级别设置query#read，对于所有的查询，提供给我们一种方法应用默认的ReadPreferences。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3esafe\x3c\/h3\x3e\n\x3cp\x3e这个配置会在MongoDB所有的操作中起作用。如果设置成true就是在操作的时候要等待返回的MongoDB返回的结果，比如update，要返回影响的条数，才往后执行，如果safe：false，则表示不用等到结果就向后执行了。\x3cbr\x3e默认设置为true能保证所有的错误能通过我们写的回调函数。我们也能设置其它的安全等级如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ j: 1, w: 2, wtimeout: 10000 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ \x3cspan class=\x22hljs-attribute\x22\x3ej\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, w: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, wtimeout: \x3cspan class=\x22hljs-number\x22\x3e10000\x3c\/span\x3e }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e表示如果10秒内写操作没有完成，将会超时。\x3cbr\x3e关于j和w，这里有很好的解释。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/kyfxbl.iteye.com\/blog\/1952941\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/kyfxbl.iteye.com\/blog\/...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader18\x22\x3eshardKey\x3c\/h3\x3e\n\x3cp\x3e需要mongodb做分布式，才会使用该属性。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader19\x22\x3estrict\x3c\/h3\x3e\n\x3cp\x3e默认是enabled，如果实例中的域（field）在schema中不存在，那么这个域不会被插入到数据库。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var ThingSchema = new Schema({a:String});\nvar ThingModel = db.model(\x27Thing\x27,SchemaSchema);\nvar thing = new Thing({iAmNotInTheThingSchema:true});\nthing.save();\/\/iAmNotInTheThingSchema这个属性将无法被存储\n\n\/\/ 通过doc.set()设置也会受到影响。\nvar thingSchema = new Schema({..})\nvar Thing = mongoose.model(\x27Thing\x27, thingSchema);\nvar thing = new Thing;\nthing.set(\x27iAmNotInTheSchema\x27, true);\nthing.save(); \/\/ iAmNotInTheSchema is not saved to the db\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ThingSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e({a:\x3cspan class=\x22hljs-type\x22\x3eString\x3c\/span\x3e});\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ThingModel = db.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Thing\x27\x3c\/span\x3e,SchemaSchema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thing = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eThing\x3c\/span\x3e({iAmNotInTheThingSchema:\x3cspan class=\x22hljs-type\x22\x3etrue\x3c\/span\x3e});\nthing.save();\x3cspan class=\x22hljs-comment\x22\x3e\/\/iAmNotInTheThingSchema这个属性将无法被存储\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过doc.set()设置也会受到影响。\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thingSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e({..})\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Thing = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Thing\x27\x3c\/span\x3e, thingSchema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thing = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eThing\x3c\/span\x3e;\nthing.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27iAmNotInTheSchema\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\nthing.save(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ iAmNotInTheSchema is not saved to the db\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果取消严格选项，iAmNotInTheThingSchema将会被存入数据库\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var thingSchema = new Schema({..}, { strict: false });\nvar thing = new Thing({ iAmNotInTheSchema: true });\nthing.save(); \/\/ iAmNotInTheSchema is now saved to the db!!\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thingSchema = new \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e(\x3cspan class=\x22hljs-meta\x22\x3e{..}\x3c\/span\x3e, { strict: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thing = new \x3cspan class=\x22hljs-type\x22\x3eThing\x3c\/span\x3e({ iAmNotInTheSchema: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e });\nthing.save(); \/\/ iAmNotInTheSchema \x3cspan class=\x22hljs-keyword\x22\x3eis\x3c\/span\x3e now saved to the db!!\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该选项也可以在Model级别使用，通过设置第二个参数，例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var ThingModel = db.model(\x27Thing\x27);\nvar thing1 = new ThingModel(doc,true);  \/\/启用严格\nvar thing2 = new ThingModel(doc,false); \/\/禁用严格\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ThingModel = db.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Thing\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thing1 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eThingModel\x3c\/span\x3e(doc,\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/启用严格\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thing2 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eThingModel\x3c\/span\x3e(doc,\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/禁用严格\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3estrict也可以设置为throw，表示出现问题将会抛出错误而不是抛弃不合适的数据。\x3c\/p\x3e\n\x3cp\x3e注意：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e不要设置为false除非你有充分的理由。\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e在mongoose v2里默认是false。\x3c\/p\x3e\n\x3cp\x3e在实例上设置的任何键值对如果再schema中不存在对应的，将会被忽视。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var thingSchema = new Schema({..})\nvar Thing = mongoose.model(\x27Thing\x27, thingSchema);\nvar thing = new Thing;\nthing.iAmNotInTheSchema = true;\nthing.save(); \/\/ iAmNotInTheSchema 不会保存到数据库。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thingSchema = new \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e(\x3cspan class=\x22hljs-meta\x22\x3e{..}\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eThing\x3c\/span\x3e = mongoose.model(\x27\x3cspan class=\x22hljs-type\x22\x3eThing\x3c\/span\x3e\x27, thingSchema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thing = new \x3cspan class=\x22hljs-type\x22\x3eThing\x3c\/span\x3e;\nthing.iAmNotInTheSchema = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\nthing.save(); \/\/ iAmNotInTheSchema 不会保存到数据库。\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader20\x22\x3etoJSON\x3c\/h3\x3e\n\x3cp\x3e和toObject类似，选择这个选项为true后，但是只有当实例调用了toJSON方法后，才会起作用。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var schema = new Schema({ name: String });\nschema.path(\x27name\x27).get(function (v) { \n    return v \x2b \x27 is my name\x27;\n});\n\nschema.set(\x27toJSON\x27, { getters: true, virtuals: false });\nvar M = mongoose.model(\x27Person\x27, schema);\nvar m = new M({ name: \x27Max Headroom\x27 });\nconsole.log(m.toObject()); \/\/ { _id: 504e0cd7dd992d9be2f20b6f, name: \x27Max Headroom\x27 }\nconsole.log(m.toJSON()); \/\/ { _id: 504e0cd7dd992d9be2f20b6f, name: \x27Max Headroom is my name\x27 }\nconsole.log(JSON.stringify(m)); \/\/ { \x26quot;_id\x26quot;: \x26quot;504e0cd7dd992d9be2f20b6f\x26quot;, \x26quot;name\x26quot;: \x26quot;Max Headroom is my name\x26quot; }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e schema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e });\nschema.path(\x3cspan class=\x22hljs-string\x22\x3e\x27name\x27\x3c\/span\x3e).get(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ev\x3c\/span\x3e) \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e v \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 is my name\x27\x3c\/span\x3e;\n});\n\nschema.set(\x3cspan class=\x22hljs-string\x22\x3e\x27toJSON\x27\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3egetters\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3evirtuals\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e M = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Person\x27\x3c\/span\x3e, schema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e m = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e M({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Max Headroom\x27\x3c\/span\x3e });\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(m.toObject()); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { _id: 504e0cd7dd992d9be2f20b6f, name: \x27Max Headroom\x27 }\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(m.toJSON()); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { _id: 504e0cd7dd992d9be2f20b6f, name: \x27Max Headroom is my name\x27 }\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(m)); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { \x22_id\x22: \x22504e0cd7dd992d9be2f20b6f\x22, \x22name\x22: \x22Max Headroom is my name\x22 }\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以看出，配置属性name对toObject没影响，对toJSON有影响。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader21\x22\x3etoObject\x3c\/h3\x3e\n\x3cp\x3e选择这个选项为true后，默认对这个schema所有的实例都有作用。不需要实例手动调用。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var schema = new Schema({ name: String });\nschema.path(\x27name\x27).get(function (v) {  \n    return v \x2b \x27 is my name\x27;\n});\n\nschema.set(\x27toObject\x27, { getters: true });\nvar M = mongoose.model(\x27Person\x27, schema);\nvar m = new M({ name: \x27Max Headroom\x27 });\nconsole.log(m); \/\/ { _id: 504e0cd7dd992d9be2f20b6f, name: \x27Max Headroom is my name\x27 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e schema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e });\nschema.path(\x3cspan class=\x22hljs-string\x22\x3e\x27name\x27\x3c\/span\x3e).get(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ev\x3c\/span\x3e) \x3c\/span\x3e{  \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e v \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 is my name\x27\x3c\/span\x3e;\n});\n\nschema.set(\x3cspan class=\x22hljs-string\x22\x3e\x27toObject\x27\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3egetters\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e M = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Person\x27\x3c\/span\x3e, schema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e m = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e M({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Max Headroom\x27\x3c\/span\x3e });\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(m); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { _id: 504e0cd7dd992d9be2f20b6f, name: \x27Max Headroom is my name\x27 }\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e较上面不同的是，没有virtuals: false这个设置。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader22\x22\x3etypeKey\x3c\/h3\x3e\n\x3cp\x3e在mongoose里，如果schema里有个对象，并且这个对象有个type键，mongoose将会将这个作为一种类型声明。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ Mongoose 认为loc字段的类型是一个字符串，而不是有type这个字段 \nvar schema = new Schema({ loc: { type: String, coordinates: [Number] } });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Mongoose 认为loc字段的类型是一个字符串，而不是有type这个字段 \x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e schema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ loc: { \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e, coordinates: [\x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e] } });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然而，对于一些应用来说，type字段是必要的。那么可以通过typeKey来设置。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var schema = new Schema({ \n    \/\/ Mongoose 这时候认为loc字段有两个键，一个是type，一个是coordinates  \n    loc: { type: String, coordinates: [Number] },  \n    \/\/ Mongoose 这时候认为name字段的类型是字符串。  \n    name: { $type: String }\n},{ typeKey: \x27$type\x27 }); \/\/ \x27$type\x27键意味着这是一个类型宣告，而不是默认的type\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e schema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e({ \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Mongoose 这时候认为loc字段有两个键，一个是type，一个是coordinates  \x3c\/span\x3e\n    loc: { \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-type\x22\x3eString\x3c\/span\x3e, coordinates: [\x3cspan class=\x22hljs-type\x22\x3eNumber\x3c\/span\x3e] },  \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Mongoose 这时候认为name字段的类型是字符串。  \x3c\/span\x3e\n    name: { $\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-type\x22\x3eString\x3c\/span\x3e }\n},{ typeKey: \x27$\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x27 })\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x27$type\x27键意味着这是一个类型宣告，而不是默认的type\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader23\x22\x3evalidateBeforeSave\x3c\/h3\x3e\n\x3cp\x3e默认得，文档被保存到数据库的时候会自动验证，这是为了防止无效的文档。如果想要手动处理验证，并且能保存不通过验证的文档，可以设置这个选项为false。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var schema = new Schema({ name: String });\nschema.set(\x27validateBeforeSave\x27, false);\nschema.path(\x27name\x27).validate(function (value) {   \n    return v != null;\n});\nvar M = mongoose.model(\x27Person\x27, schema);\nvar m = new M({ name: null });\nm.validate(function(err) { \n    console.log(err); \/\/ 将会告诉你null不被允许\n});\nm.save(); \/\/ 尽管数据无效，但是仍然可以保存。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e schema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e });\nschema.set(\x3cspan class=\x22hljs-string\x22\x3e\x27validateBeforeSave\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\nschema.path(\x3cspan class=\x22hljs-string\x22\x3e\x27name\x27\x3c\/span\x3e).validate(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{   \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e v != \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n});\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e M = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Person\x27\x3c\/span\x3e, schema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e m = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e M({ \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e });\nm.validate(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(err); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将会告诉你null不被允许\x3c\/span\x3e\n});\nm.save(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 尽管数据无效，但是仍然可以保存。\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader24\x22\x3eversionKey\x3c\/h3\x3e\n\x3cp\x3e版本锁设置在每一个文档（document）上，由mogoose生成。默认的值是__v，但是可以自定义。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var schema = new Schema({ name: \x27string\x27 });\nvar Thing = mongoose.model(\x27Thing\x27, schema);\nvar thing = new Thing({ name: \x27mongoose v3\x27 });\nthing.save(); \/\/ { __v: 0, name: \x27mongoose v3\x27 }\n\n\/\/ 自定义版本锁\nnew Schema({..}, { versionKey: \x27_somethingElse\x27 });\nvar Thing = mongoose.model(\x27Thing\x27, schema);\nvar thing = new Thing({ name: \x27mongoose v3\x27 });\nthing.save(); \/\/ { _somethingElse: 0, name: \x27mongoose v3\x27 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e schema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ name: \x3cspan class=\x22hljs-string\x22\x3e\x27string\x27\x3c\/span\x3e });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Thing = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Thing\x27\x3c\/span\x3e, schema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thing = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Thing({ name: \x3cspan class=\x22hljs-string\x22\x3e\x27mongoose v3\x27\x3c\/span\x3e });\nthing.save(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { __v: 0, name: \x27mongoose v3\x27 }\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 自定义版本锁\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({..}, { versionKey: \x3cspan class=\x22hljs-string\x22\x3e\x27_somethingElse\x27\x3c\/span\x3e });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Thing = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Thing\x27\x3c\/span\x3e, schema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thing = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Thing({ name: \x3cspan class=\x22hljs-string\x22\x3e\x27mongoose v3\x27\x3c\/span\x3e });\nthing.save(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { _somethingElse: 0, name: \x27mongoose v3\x27 }\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e不要将这个选项设置为false除非你知道你在做什么。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader25\x22\x3eskipVersioning\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/aaronheckmann.tumblr.com\/post\/48943525537\/mongoose-v3-part-1-\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/aaronheckmann.tumblr.c...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e按照这里的说法，大致是说，加入在一个博客系统中，一个人所有的评论是一个数组，那么所有的评论是有索引的，比如某一条评论的body，comments.3.body，这里3是索引。假如一个评论者（A）想要修改自己的评论，但是此时另一个评论者（B）删除（或其他操作）了自己的评论，那么对A的索引可能会造成变化，此时对A的操作会发生错误。\x3c\/p\x3e\n\x3cp\x3e为了改变这个问题，mongoose v3添加了version key配置。无论什么时候修改一个数组潜在地改变数组元素位置，这个version key(__V)的值会加1。在where条件中也需要添加__v条件，如果能通过（数组索引没改变），就可以修改，例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22posts.update(\n    { _id: postId, __v: verionNumber } ,\n    { $set: { \x27comments.3.body\x27: updatedText \x22}}\x22\n);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3eposts\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.update\x3c\/span\x3e(\n    { \x3cspan class=\x22hljs-attribute\x22\x3e_id\x3c\/span\x3e: postId, \x3cspan class=\x22hljs-attribute\x22\x3e__v\x3c\/span\x3e: verionNumber } ,\n    { $\x3cspan class=\x22hljs-attribute\x22\x3eset\x3c\/span\x3e: { \x3cspan class=\x22hljs-string\x22\x3e\x27comments.3.body\x27\x3c\/span\x3e: updatedText \x22}}\x22\n);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果在更新之前删除了评论，那么就会发生错误。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22post.save(function (err) { \n    console.log(err); \/\/ Error: No matching document found.\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3epost\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3esave\x3c\/span\x3e(function (\x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e) { \n    console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Error: No matching document found.\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader26\x22\x3etimestamps\x3c\/h3\x3e\n\x3cp\x3e如果在schema设置这个选项，createdAt和updatedAt域将会被自动添加的文档中。它们默认的类型是Date，默认的名字是createdAt和updatedAt，不过我们可以自己修改。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var thingSchema = new Schema({..}, { timestamps: { createdAt: \x27created_at\x27 } });\nvar Thing = mongoose.model(\x27Thing\x27, thingSchema);\nvar thing = new Thing();\nthing.save(); \/\/ created_at \x26amp; updatedAt将会被包含在文档。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thingSchema = new \x3cspan class=\x22hljs-type\x22\x3eSchema\x3c\/span\x3e(\x3cspan class=\x22hljs-meta\x22\x3e{..}\x3c\/span\x3e, { timestamps: { createdAt: \x27created_at\x27 } });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eThing\x3c\/span\x3e = mongoose.model(\x27\x3cspan class=\x22hljs-type\x22\x3eThing\x3c\/span\x3e\x27, thingSchema);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e thing = new \x3cspan class=\x22hljs-type\x22\x3eThing\x3c\/span\x3e();\nthing.save(); \/\/ created_at \x26amp; updatedAt将会被包含在文档。\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader27\x22\x3euseNestedStrict\x3c\/h3\x3e\n\x3cp\x3e在mongoos 4， update()和findOneAndUpdate()方法只检查顶级schema的strict的选项设置。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var childSchema = new Schema({}, { strict: false });\/\/ 这里parentSchema是topSchema，而childSchema是subSchema。\nvar parentSchema = new Schema({ child: childSchema }, { strict: \x27throw\x27 });\nvar Parent = mongoose.model(\x27Parent\x27, parentSchema);\nParent.update({}, { \x27child.name\x27: \x27Luke Skywalker\x27 }, function(error) {  \n    \/\/ 发生错误因为parentSchema设置了strict: \x27throw\x27}\n    \/\/ 即使childSchema设置了{strict: false}\n});\nvar update = { \x27child.name\x27: \x27Luke Skywalker\x27 };\nvar opts = { strict: false };\nParent.update({}, update, opts, function(error) { \n    \/\/ 这个可以通过因为重写了parentSchema的strict选项\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e childSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({}, { strict: \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e });\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里parentSchema是topSchema，而childSchema是subSchema。\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e parentSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ child: childSchema }, { strict: \x3cspan class=\x22hljs-string\x22\x3e\x27throw\x27\x3c\/span\x3e });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eParent\x3c\/span\x3e = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Parent\x27\x3c\/span\x3e, parentSchema);\n\x3cspan class=\x22hljs-keyword\x22\x3eParent\x3c\/span\x3e.update({}, { \x3cspan class=\x22hljs-string\x22\x3e\x27child.name\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Luke Skywalker\x27\x3c\/span\x3e }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(error)\x3c\/span\x3e \x3c\/span\x3e{  \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发生错误因为parentSchema设置了strict: \x27throw\x27}\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 即使childSchema设置了{strict: false}\x3c\/span\x3e\n});\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e update = { \x3cspan class=\x22hljs-string\x22\x3e\x27child.name\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Luke Skywalker\x27\x3c\/span\x3e };\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e opts = { strict: \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e };\n\x3cspan class=\x22hljs-keyword\x22\x3eParent\x3c\/span\x3e.update({}, update, opts, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(error)\x3c\/span\x3e \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这个可以通过因为重写了parentSchema的strict选项\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果设置了useNestedStrict为true，mogoose在更新时使用childSchema的strict选项。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var childSchema = new Schema({}, { strict: false });\nvar parentSchema = new Schema({ child: childSchema },  { strict: \x27throw\x27, useNestedStrict: true });\nvar Parent = mongoose.model(\x27Parent\x27, parentSchema);\nParent.update({}, { \x27child.name\x27: \x27Luke Skywalker\x27 }, function(error) { \n    \/\/ 可以更新\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e childSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({}, { strict: \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e parentSchema = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Schema({ child: childSchema },  { strict: \x3cspan class=\x22hljs-string\x22\x3e\x27throw\x27\x3c\/span\x3e, useNestedStrict: \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e });\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eParent\x3c\/span\x3e = mongoose.model(\x3cspan class=\x22hljs-string\x22\x3e\x27Parent\x27\x3c\/span\x3e, parentSchema);\n\x3cspan class=\x22hljs-keyword\x22\x3eParent\x3c\/span\x3e.update({}, { \x3cspan class=\x22hljs-string\x22\x3e\x27child.name\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Luke Skywalker\x27\x3c\/span\x3e }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(error)\x3c\/span\x3e \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 可以更新\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader28\x22\x3eretainKeyOrder\x3c\/h3\x3e\n\x3cp\x3e默认得，mongoose会转换实体中键的顺序。比如\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22new Model({ first: 1, second: 2 })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eModel\x3c\/span\x3e({ \x3cspan class=\x22hljs-attribute\x22\x3efirst\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, second: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e将会在MongoDB中存储为{ second: 2, first: 1 }；这带来了极大的不方便。\x3c\/p\x3e\n\x3cp\x3eMongoose v4.6.4 有一个retainKeyOrder选项确保mongoose不会改变键的顺序。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e参考\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/cnodejs.org\/topic\/504b4924e2b84515770103dd?utm_source=ourjs.com\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/cnodejs.org\/topic\/504b...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.nodeclass.com\/api\/mongoose.html#schema_Schema-add\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.nodeclass.com\/api\/...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/mongoosejs.com\/docs\/guide.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/mongoosejs.com\/docs\/gu...\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>mongoose学习笔记（超详细）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010688972">https://segmentfault.com/a/1190000010688972</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/4qt3hse1xem/" target="_blank">https://alili.tech/archive/4qt3hse1xem/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>