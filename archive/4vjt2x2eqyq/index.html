<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React深度编程：受控组件与非受控组件"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React深度编程：受控组件与非受控组件 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4vjt2x2eqyq/",
				"appid": "1613049289050283", 
				"title": "React深度编程：受控组件与非受控组件 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-21T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/mf22y6zyunk/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/dss65kwp0c9/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4vjt2x2eqyq%2f&text=React%e6%b7%b1%e5%ba%a6%e7%bc%96%e7%a8%8b%ef%bc%9a%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6%e4%b8%8e%e9%9d%9e%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4vjt2x2eqyq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4vjt2x2eqyq%2f&text=React%e6%b7%b1%e5%ba%a6%e7%bc%96%e7%a8%8b%ef%bc%9a%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6%e4%b8%8e%e9%9d%9e%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4vjt2x2eqyq%2f&title=React%e6%b7%b1%e5%ba%a6%e7%bc%96%e7%a8%8b%ef%bc%9a%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6%e4%b8%8e%e9%9d%9e%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4vjt2x2eqyq%2f&is_video=false&description=React%e6%b7%b1%e5%ba%a6%e7%bc%96%e7%a8%8b%ef%bc%9a%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6%e4%b8%8e%e9%9d%9e%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%e6%b7%b1%e5%ba%a6%e7%bc%96%e7%a8%8b%ef%bc%9a%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6%e4%b8%8e%e9%9d%9e%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4vjt2x2eqyq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4vjt2x2eqyq%2f&title=React%e6%b7%b1%e5%ba%a6%e7%bc%96%e7%a8%8b%ef%bc%9a%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6%e4%b8%8e%e9%9d%9e%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4vjt2x2eqyq%2f&title=React%e6%b7%b1%e5%ba%a6%e7%bc%96%e7%a8%8b%ef%bc%9a%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6%e4%b8%8e%e9%9d%9e%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4vjt2x2eqyq%2f&title=React%e6%b7%b1%e5%ba%a6%e7%bc%96%e7%a8%8b%ef%bc%9a%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6%e4%b8%8e%e9%9d%9e%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4vjt2x2eqyq%2f&title=React%e6%b7%b1%e5%ba%a6%e7%bc%96%e7%a8%8b%ef%bc%9a%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6%e4%b8%8e%e9%9d%9e%e5%8f%97%e6%8e%a7%e7%bb%84%e4%bb%b6"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React深度编程：受控组件与非受控组件</h1><div class="meta"><div class="postdate"><time datetime="2018-12-21" itemprop="datePublished">2018-12-21</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e受控组件与非受控组件在官网与国内网上的资料都不多，有些人觉得它可有可不有，也不在意。这恰恰显示React的威力，满足不同规模大小的工程需求。譬如你只是做ListView这样简单的数据显示，将数据拍出来，那么for循坏与\x3ccode\x3e{}\x3c\/code\x3e就足够了，但后台系统存在大量报表，不同的表单联动，缺了受控组件真的不行。\x3c\/p\x3e\n\x3cp\x3e受控组件与非受控组件是React处理表单的入口。从React的思路来讲，作者肯定让数据控制一切，或者简单的理解为，页面的生成与更新得忠实地执行JSX的指令。\x3c\/p\x3e\n\x3cp\x3e但是表单元素有其特殊之处，用户可以通过键盘输入与鼠标选择，改变界面的显示。界面的改变也意味着有一些数据被改动，比较明显的是input的\x3cstrong\x3evalue\x3c\/strong\x3e，textarea的\x3cstrong\x3einnerHTML\x3c\/strong\x3e，radio\/checkbox的\x3cstrong\x3echecked\x3c\/strong\x3e，不太明显的是option的\x3cstrong\x3eselected\x3c\/strong\x3e与\x3cstrong\x3eselectedIndex\x3c\/strong\x3e，这两个是被动修改的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput value={this.state.value} \/\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode class=\x22jsx\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3einput\x3c\/span\x3e value={this\x3cspan class=\x22hljs-selector-class\x22\x3e.state\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.value\x3c\/span\x3e} \/\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当input.value是由组件的state.value拍出来的，当用户进行输入修改后，然后JSX再次重刷视图，这时input.value是采取用户的新值还是state的新值？基于这个分歧，React给出一个折衷的方案，两者都支持，于是就产生了今天的主题了。\x3c\/p\x3e\n\x3cp\x3eReact认为value\/checked不能单独存在，需要与onInput\/onChange\/disabed\/readOnly等控制value\/checked的属性或事件一起使用。 它们共同构成\x3cstrong\x3e受控组件\x3c\/strong\x3e，受控是受JSX的控制。如果用户没有写这些额外的属性与事件，那么框架内部会给它添加一些事件，如onClick, onInput, onChange，阻止你进行输入或选择，让你无法修改它的值。在框架内部，有一个顽固的变量，我称之为 persistValue，它一直保持JSX上次赋给它的值，只能让内部事件修改它。\x3c\/p\x3e\n\x3cp\x3e因此我们可以断言，受控组件是可通过\x3cstrong\x3e事件\x3c\/strong\x3e完成的对value的控制。\x3c\/p\x3e\n\x3cp\x3e在受控组件中，persistValue总能被刷新。\x3c\/p\x3e\n\x3cp\x3e我们再看非受控组件，既然value\/checked已经被占用了，React启用了HTML中另一组被忽略的属性defaultValue\/defaultChecked。一般认为它们是与value\/checked相通的，即，value不存在的情况下，defaultValue的值就当作是value。\x3c\/p\x3e\n\x3cp\x3e上面我们已经说过，表单元素的显示情况是由内部的 persistValue 控制的，因此defaultXXX也会同步persistValue，然后再由persistValue同步DOM。但非受控组件的出发点是忠实于用户操作，如果用户在代码中\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22input.value = \x26quot;xxxx\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3einput.value = \x3cspan class=\x22hljs-string\x22\x3e\x22xxxx\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以后\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput defaultValue={this.state.value} \/\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode class=\x22jsx\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3einput\x3c\/span\x3e defaultValue={this\x3cspan class=\x22hljs-selector-class\x22\x3e.state\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.value\x3c\/span\x3e} \/\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e就再不生效，一直是xxxx。\x3c\/p\x3e\n\x3cp\x3e它怎么做到这一点，怎么辨识这个修改是来自框架内部或外部呢？我翻看了一下React的源码，原来它有一个叫valueTracker的东西跟踪用户的输入\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var tracker = {\n    getValue: function () {\n      return currentValue;\n    },\n    setValue: function (value) {\n      currentValue = \x27\x27 \x2b value;\n    },\n    stopTracking: function () {\n      detachTracker(node);\n      delete node[valueField];\n    }\n  };\n  return tracker;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tracker = {\n    \x3cspan class=\x22hljs-attr\x22\x3egetValue\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e currentValue;\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3esetValue\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n      currentValue = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e \x2b value;\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3estopTracking\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      detachTracker(node);\n      \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e node[valueField];\n    }\n  };\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e tracker;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个东西又是通过Object.defineProperty打进元素的value\/checked的内部，因此就知晓用户对它的取值赋值操作。\x3c\/p\x3e\n\x3cp\x3e但value\/checked还是两个很核心的属性，涉及到太多内部机制（比如说value与oninput, onchange, 输入法事件oncompositionstart,\x3cbr\x3ecompositionchange, oncompositionend, onpaste, oncut），为了平缓地修改value\/checked，\x3cbr\x3e还要用到\x3ccode\x3eObject.getOwnPropertyDescriptor\x3c\/code\x3e。如果我要兼容IE8，没有这么高级的玩艺儿。我采取另一种更安全的方式，\x3cbr\x3e只用Object.defineProperty修改\x3ccode\x3edefaultValue\/defaultChecked\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e首先我为元素添加一个\x3ccode\x3e_uncontrolled\x3c\/code\x3e的属性，用来表示我已经劫持过defaultXXX。 然后描述对象 （\x3ccode\x3eObject.defineProperty的第三个参数\x3c\/code\x3e）的set方法里面再添加一个开关，\x3ccode\x3e_observing\x3c\/code\x3e。在框架内部更新视图，此值为false,更新完，它置为true。\x3c\/p\x3e\n\x3cp\x3e这样就知晓 input.defaultValue = \x22xxx\x22时，这是由用户还是框架修改的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22f (!dom._uncontrolled) {\n    dom._uncontrolled = true;\n    inputMonitor.observe(dom, name); \/\/重写defaultXXX的setter\/getter\n}\ndom._observing = false;\/\/此时是框架在修改视图，因此需要关闭开关\ndom[name] = val;\ndom._observing = true;\/\/打开开关，来监听用户的修改行为\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ef (!dom._uncontrolled) {\n    dom._uncontrolled = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    inputMonitor.observe(dom, name); \x3cspan class=\x22hljs-comment\x22\x3e\/\/重写defaultXXX的setter\/getter\x3c\/span\x3e\n}\ndom._observing = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/此时是框架在修改视图，因此需要关闭开关\x3c\/span\x3e\ndom[name] = val;\ndom._observing = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/打开开关，来监听用户的修改行为\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3einputMonitor的实现如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export var inputMonitor = {};\nvar rcheck = \/checked|radio\/;\nvar describe = {\n    set: function(value) {\n        var controllProp = rcheck.test(this.type) ? \x26quot;checked\x26quot; : \x26quot;value\x26quot;;\n        if (this.type === \x26quot;textarea\x26quot;) {\n            this.innerHTML = value;\n        }\n        if (!this._observing) {\n            if (!this._setValue) {\n                \/\/defaultXXX只会同步一次_persistValue\n                var parsedValue = (this[controllProp] = value);\n                this._persistValue = Array.isArray(value) ? value : parsedValue;\n                this._setValue = true;\n            }\n        } else {\n            \/\/如果用户私下改变defaultValue，那么_setValue会被抺掉\n            this._setValue = value == null ? false : true;\n        }\n        this._defaultValue = value;\n    },\n    get: function() {\n        return this._defaultValue;\n    },\n    configurable: true\n};\n\ninputMonitor.observe = function(dom, name) {\n    try {\n        if (\x26quot;_persistValue\x26quot; in dom) {\n            dom._setValue = true;\n        }\n        Object.defineProperty(dom, name, describe);\n    } catch (e) {}\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e inputMonitor = {};\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e rcheck = \x3cspan class=\x22hljs-regexp\x22\x3e\/checked|radio\/\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e describe = {\n    \x3cspan class=\x22hljs-attr\x22\x3eset\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e controllProp = rcheck.test(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.type) ? \x3cspan class=\x22hljs-string\x22\x3e\x22checked\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22value\x22\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.type === \x3cspan class=\x22hljs-string\x22\x3e\x22textarea\x22\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.innerHTML = value;\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._observing) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._setValue) {\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/defaultXXX只会同步一次_persistValue\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e parsedValue = (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e[controllProp] = value);\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._persistValue = \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.isArray(value) ? value : parsedValue;\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._setValue = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n            }\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果用户私下改变defaultValue，那么_setValue会被抺掉\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._setValue = value == \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e ? \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e : \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._defaultValue = value;\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._defaultValue;\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3econfigurable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n};\n\ninputMonitor.observe = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edom, name\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x22_persistValue\x22\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e dom) {\n            dom._setValue = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(dom, name, describe);\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {}\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e又不小心贴了这么烧脑的代码，这是码农的坏毛病。不过，到这步，大家都明白，无论是官方react还是anu\/qreact都是通过Object.defineProperty来控制用户的输入的。\x3c\/p\x3e\n\x3cp\x3e于是我们可以理解以下的代码的行为了\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    var a =  ReactDOM.render(\x3ctextarea defaultValue=\x26quot;foo\x26quot; \/\x3e, container);\n    ReactDOM.render(\x3ctextarea defaultValue=\x26quot;bar\x26quot; \/\x3e, container);\n    ReactDOM.render(\x3ctextarea defaultValue=\x26quot;noise\x26quot; \/\x3e, container);\n    expect(a.defaultValue).toBe(\x26quot;noise\x26quot;);\n    expect(a.value).toBe(\x26quot;foo\x26quot;);\n    expect(a.textContent).toBe(\x26quot;noise\x26quot;);\n    expect(a.innerHTML).toBe(\x26quot;noise\x26quot;);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mel\x22\x3e\x3ccode class=\x22jsx\x22\x3e    var a =  ReactDOM.\x3cspan class=\x22hljs-keyword\x22\x3erender\x3c\/span\x3e(\x26lt;textarea defaultValue=\x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e \/\x26gt;, \x3cspan class=\x22hljs-keyword\x22\x3econtainer\x3c\/span\x3e);\n    ReactDOM.\x3cspan class=\x22hljs-keyword\x22\x3erender\x3c\/span\x3e(\x26lt;textarea defaultValue=\x3cspan class=\x22hljs-string\x22\x3e\x22bar\x22\x3c\/span\x3e \/\x26gt;, \x3cspan class=\x22hljs-keyword\x22\x3econtainer\x3c\/span\x3e);\n    ReactDOM.\x3cspan class=\x22hljs-keyword\x22\x3erender\x3c\/span\x3e(\x26lt;textarea defaultValue=\x3cspan class=\x22hljs-string\x22\x3e\x22noise\x22\x3c\/span\x3e \/\x26gt;, \x3cspan class=\x22hljs-keyword\x22\x3econtainer\x3c\/span\x3e);\n    expect(a.defaultValue).toBe(\x3cspan class=\x22hljs-string\x22\x3e\x22noise\x22\x3c\/span\x3e);\n    expect(a.value).toBe(\x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e);\n    expect(a.textContent).toBe(\x3cspan class=\x22hljs-string\x22\x3e\x22noise\x22\x3c\/span\x3e);\n    expect(a.innerHTML).toBe(\x3cspan class=\x22hljs-string\x22\x3e\x22noise\x22\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由于用户一直没有手动修改 defaultValue，\x3ccode\x3edom._setValue\x3c\/code\x3e 一直为\x3cstrong\x3efalse\/undefined\x3c\/strong\x3e，因此 \x3ccode\x3e_persistValue\x3c\/code\x3e 一直能修改。\x3c\/p\x3e\n\x3cp\x3e另一个例子:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var renderTextarea = function(component, container) {\n    if (!container) {\n        container = document.createElement(\x26quot;div\x26quot;);\n    }\n    const node = ReactDOM.render(component, container);\n    node.defaultValue = node.innerHTML.replace(\/^\\n\/, \x26quot;\x26quot;);\n    return node;\n};\n\nconst container = document.createElement(\x26quot;div\x26quot;);\n\/\/注意这个方法，用户在renderTextarea中手动改变了defaultValue，_setValue就变成true\nconst node = renderTextarea(\x3ctextarea defaultValue=\x26quot;giraffe\x26quot; \/\x3e, container);\n\nexpect(node.value).toBe(\x26quot;giraffe\x26quot;);\n\n\/\/ _setValue后，gorilla就不能同步到_persistValue，因此还是giraffe\nrenderTextarea(\x3ctextarea defaultValue=\x26quot;gorilla\x26quot; \/\x3e, container);\n\/\/  expect(node.value).toEqual(\x26quot;giraffe\x26quot;);\n\nnode.value = \x26quot;cat\x26quot;;\n\/\/ 这个又是什么回事了呢，因此非监控属性是在diffProps中批量处理的，在监控属性，则是在更后的方法中处理\n\/\/ 检测到node.value !== _persistValue，于是重写 _persistValue = node.value，于是输出cat\nrenderTextarea(\x3ctextarea defaultValue=\x26quot;monkey\x26quot; \/\x3e, container);\nexpect(node.value).toEqual(\x26quot;cat\x26quot;);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e renderTextarea = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecomponent, container\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!container) {\n        container = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x22div\x22\x3c\/span\x3e);\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e node = ReactDOM.render(component, container);\n    node.defaultValue = node.innerHTML.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/^\\n\/\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e node;\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e container = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x22div\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/注意这个方法，用户在renderTextarea中手动改变了defaultValue，_setValue就变成true\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e node = renderTextarea(\x26lt;textarea defaultValue=\x22giraffe\x22 \/\x26gt;, container);\n\nexpect(node.value).toBe(\x22giraffe\x22);\n\n\/\/ _setValue后，gorilla就不能同步到_persistValue，因此还是giraffe\nrenderTextarea(\x26lt;textarea defaultValue=\x22gorilla\x22 \/\x26gt;, container);\n\/\/  expect(node.value).toEqual(\x22giraffe\x22);\n\nnode.value = \x22cat\x22;\n\/\/ 这个又是什么回事了呢，因此非监控属性是在diffProps中批量处理的，在监控属性，则是在更后的方法中处理\n\/\/ 检测到node.value !== _persistValue，于是重写 _persistValue = node.value，于是输出cat\nrenderTextarea(\x26lt;textarea defaultValue=\x22monkey\x22 \/\x26gt;, container);\nexpect(node.value).toEqual(\x22cat\x22);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当然表单元素也分许多种，每种表单元素也有其默认行为。\x3c\/p\x3e\n\x3cp\x3e纯文本类：text, textarea, JSX的值，总是往字符串转换\x3cbr\x3etype=\x22number\x22的控制，值总是为数字，不填或为“”则转换为“0”\x3cbr\x3eradio有联动效果，同一父节点下的相同name的radio控制只能选择一个。\x3cbr\x3eselect的value\/defaultValue支持数组，不做转换，但用户对底下的option元素做增删操作，selected会跟着变动。\x3c\/p\x3e\n\x3cp\x3e此外select还有模糊匹配与精确匹配之分。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/精确匹配\nvar dom = ReactDOM.render(\n    \x3cselect value={222}\x3e\n        \x3coption value={111}\x3eaaa\x3c\/option\x3e\n        \x3coption value={\x26quot;222\x26quot;}\x3exxx\x3c\/option\x3e\n        \x3coption value={222}\x3ebbb\x3c\/option\x3e\n        \x3coption value={333}\x3eccc\x3c\/option\x3e\n    \x3c\/select\x3e,\n    container\n);\nexpect(dom.options[2].selected).toBe(true);\/\/选中第三个\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/精确匹配\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dom = ReactDOM.render(\n    \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eselect\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{222}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{111}\x3c\/span\x3e\x26gt;\x3c\/span\x3eaaa\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\x22\x3cspan class=\x22hljs-attr\x22\x3e222\x3c\/span\x3e\x22}\x26gt;\x3c\/span\x3exxx\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{222}\x3c\/span\x3e\x26gt;\x3c\/span\x3ebbb\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{333}\x3c\/span\x3e\x26gt;\x3c\/span\x3eccc\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eselect\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e,\n    container\n);\nexpect(dom.options[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e].selected).toBe(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/选中第三个\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/模糊匹配\nvar dom = ReactDOM.render(\n    \x3cselect value={222}\x3e\n        \x3coption value={111}\x3eaaa\x3c\/option\x3e\n        \x3coption value={\x26quot;222\x26quot;}\x3exxx\x3c\/option\x3e\n        \x3coption value={333}\x3eccc\x3c\/option\x3e\n    \x3c\/select\x3e,\n    container\n);\nexpect(dom.options[2].selected).toBe(true);\/\/选中第二个\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/模糊匹配\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dom = ReactDOM.render(\n    \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eselect\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{222}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{111}\x3c\/span\x3e\x26gt;\x3c\/span\x3eaaa\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\x22\x3cspan class=\x22hljs-attr\x22\x3e222\x3c\/span\x3e\x22}\x26gt;\x3c\/span\x3exxx\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{333}\x3c\/span\x3e\x26gt;\x3c\/span\x3eccc\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eoption\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eselect\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e,\n    container\n);\nexpect(dom.options[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e].selected).toBe(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/选中第二个\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e凡此种种，React\/anu都是做了大量工作，迷你如preact\/react-lite之流则可能遇坑。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React深度编程：受控组件与非受控组件</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012458996">https://segmentfault.com/a/1190000012458996</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/4vjt2x2eqyq/" target="_blank">https://alili.tech/archive/4vjt2x2eqyq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>