<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="【Node.js 微信公众号实战】2.Node.js access_token的获取、存储及更新"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>【Node.js 微信公众号实战】2.Node.js access_token的获取、存储及更新 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/5e1o43o1m/",
				"appid": "1613049289050283", 
				"title": "【Node.js 微信公众号实战】2.Node.js access_token的获取、存储及更新 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-22T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/78n7amdph6s/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/spdgldxj98j/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f5e1o43o1m%2f&text=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%912.Node.js%20access_token%e7%9a%84%e8%8e%b7%e5%8f%96%e3%80%81%e5%ad%98%e5%82%a8%e5%8f%8a%e6%9b%b4%e6%96%b0"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f5e1o43o1m%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f5e1o43o1m%2f&text=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%912.Node.js%20access_token%e7%9a%84%e8%8e%b7%e5%8f%96%e3%80%81%e5%ad%98%e5%82%a8%e5%8f%8a%e6%9b%b4%e6%96%b0"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f5e1o43o1m%2f&title=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%912.Node.js%20access_token%e7%9a%84%e8%8e%b7%e5%8f%96%e3%80%81%e5%ad%98%e5%82%a8%e5%8f%8a%e6%9b%b4%e6%96%b0"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f5e1o43o1m%2f&is_video=false&description=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%912.Node.js%20access_token%e7%9a%84%e8%8e%b7%e5%8f%96%e3%80%81%e5%ad%98%e5%82%a8%e5%8f%8a%e6%9b%b4%e6%96%b0"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%912.Node.js%20access_token%e7%9a%84%e8%8e%b7%e5%8f%96%e3%80%81%e5%ad%98%e5%82%a8%e5%8f%8a%e6%9b%b4%e6%96%b0&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f5e1o43o1m%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f5e1o43o1m%2f&title=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%912.Node.js%20access_token%e7%9a%84%e8%8e%b7%e5%8f%96%e3%80%81%e5%ad%98%e5%82%a8%e5%8f%8a%e6%9b%b4%e6%96%b0"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5e1o43o1m%2f&title=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%912.Node.js%20access_token%e7%9a%84%e8%8e%b7%e5%8f%96%e3%80%81%e5%ad%98%e5%82%a8%e5%8f%8a%e6%9b%b4%e6%96%b0"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5e1o43o1m%2f&title=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%912.Node.js%20access_token%e7%9a%84%e8%8e%b7%e5%8f%96%e3%80%81%e5%ad%98%e5%82%a8%e5%8f%8a%e6%9b%b4%e6%96%b0"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5e1o43o1m%2f&title=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%912.Node.js%20access_token%e7%9a%84%e8%8e%b7%e5%8f%96%e3%80%81%e5%ad%98%e5%82%a8%e5%8f%8a%e6%9b%b4%e6%96%b0"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">【Node.js 微信公众号实战】2.Node.js access_token的获取、存储及更新</h1><div class="meta"><div class="postdate"><time datetime="2018-12-22" itemprop="datePublished">2018-12-22</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e一、写在前面的话\x3c\/h2\x3e\n\x3cp\x3e  上一篇文章中，我们使用 Node.js 成功的实现了接入微信公众平台功能。在这篇文章中，我们将实现微信公众平台一个非常重要的参数 access_token ,它是公众号的全局唯一接口调用凭据，公众号调用各接口时都需使用 access_token。\x3c\/p\x3e\n\x3cp\x3e  在开始之前，让我们先按捺住自己激动的心情、调整好呼吸，因为我们要将上一篇文章的代码重新整理一下。一个好的项目结构，更能有助于我们理清业务逻辑以及将来维护代码的便捷。OK!\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012428082?w=960\x26amp;h=716\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012428082?w=960\x26amp;h=716\x22 alt=\x22Are you ready?\x22 title=\x22Are you ready?\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e二、整理项目结构\x3c\/h2\x3e\n\x3cp\x3e1.打开我们的项目，并在项目中添加文件夹，命名为 wechat ，如图:\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012428083?w=2448\x26amp;h=1516\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012428083?w=2448\x26amp;h=1516\x22 alt=\x22这里写图片描述\x22 title=\x22这里写图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e2.在 wechat 文件夹中添加文件并命名为 wechat.js。wechat.js 主要用于封装开发微信公众平台的所有方法。首先我们构建这个模块的结构，代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x27use strict\x27 \/\/设置为严格模式\n\n\/\/构建 WeChat 对象 即 js中 函数就是对象\nvar WeChat = function(config){\n    \/\/设置 WeChat 对象属性 config\n    this.config = config;\n    \n    \/\/设置 WeChat 对象属性 token\n    this.token = config.token;\n}\n\n\/\/暴露可供外部访问的接口\nmodule.exports = WeChat;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x27use strict\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置为严格模式\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/构建 WeChat 对象 即 js中 函数就是对象\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e WeChat = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3econfig\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 WeChat 对象属性 config\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config = config;\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 WeChat 对象属性 token\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.token = config.token;\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/暴露可供外部访问的接口\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = WeChat;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e 严格模式：是在 ECMAScript 5 中引入的概念。严格模式是为 Javascript 定义了一种解析与执行模型。\x3c\/p\x3e\n\x3cp\x3e module.exports ：暴露接口用于外部操作。实际上我们定义模块后，使用 node.js 的 require 引用时，node.js 会自动在我们定义的模块外层加入以下代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * exports  module.exports 的一个简短的引用\n * require  用于引入模块\n * module   当前模块的引用\n * __filename  当前模块的文件名\n * __dirname   当前模块的目录名\n *\/\n(function (exports, require, module, __filename, __dirname) {\n    \/\/自定义模块的代码块\n})();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * exports  module.exports 的一个简短的引用\n * require  用于引入模块\n * module   当前模块的引用\n * __filename  当前模块的文件名\n * __dirname   当前模块的目录名\n *\/\x3c\/span\x3e\n(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eexports, require, module, __filename, __dirname\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/自定义模块的代码块\x3c\/span\x3e\n})();\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e相信对于有过 javascript 开发经验的同学，上面的代码并不陌生。我们可以将它理解为一个闭包，是一个匿名方法的调用，避免污染全局变量。\x3c\/p\x3e\n\x3cblockquote\x3e小知识：\x3cp\x3e  在上面的代码中，除了我们所使用的 module.exports 对象，还有另一个用于暴露接口的 变量 exports (官方文档将 module.exports 称为对象，exports 称为 属性，我在这里也就这样称呼了)，那么 module.exports 与 exports 有什么区别呢？\x3c\/p\x3e\n\x3cp\x3e  module.exports 对象是由模块系统创建的，exports 变量是在模块的文件级别作用域内有效的，它在模块被执行前被赋于 module.exports 的值。——\x3ca href=\x22https:\/\/nodejs.org\/dist\/latest-v6.x\/docs\/api\/modules.html#modules_module_exports\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e来自Node.js官方文档\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e  也就是说 exports 是 module.exports 的引用，而 module.exports 才是真正用于暴露接口的对象。 exports 赋值的所有属性与方法都赋值给了 module.exports 对象。\x3c\/p\x3e\n\x3cp\x3e  如果 module.exports 与 exports 将值赋值给了相同的属性，则按照赋值的先后顺序，取最后一个赋值；如果我们给 module.exports 赋值的是一个对象，则会覆盖 exports 的所有方法与属性。\x3c\/p\x3e\n\x3cp\x3e  因此我们在暴露接口的使用上，如果只是单一属性或方法的话，建议使用exports.属性\/方法，要是导出多个属性或方法或使用对象构造方法，建议使用 module.exports。\x3c\/p\x3e\n\x3cp\x3e  具体详解可以点击查看该文章 -\x26gt; \x3ca href=\x22https:\/\/www.ycjcl.cc\/2017\/02\/10\/module-exportshe-exportsde-qu-bie\/?utm_source=tuicool\x26amp;utm_medium=referral\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eModule.exports和exports的区别\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e3.为 WeChat 对象添加一个方法 auth，并将 app.js 中的验证方法粘贴进去\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x27use strict\x27 \/\/设置为严格模式\n\nconst crypto = require(\x27crypto\x27); \/\/引入加密模块\n\n\/\/构建 WeChat 对象 即 js中 函数就是对象\nvar WeChat = function(config){\n    \/\/设置 WeChat 对象属性 config\n    this.config = config;\n\n    \/\/设置 WeChat 对象属性 token\n    this.token = config.token;\n}\n\n\/**\n * 微信接入验证\n *\/\nWeChat.prototype.auth = function(req,res){\n     \/\/1.获取微信服务器Get请求的参数 signature、timestamp、nonce、echostr\n        var signature = req.query.signature,\/\/微信加密签名\n            timestamp = req.query.timestamp,\/\/时间戳\n                nonce = req.query.nonce,\/\/随机数\n            echostr = req.query.echostr;\/\/随机字符串\n\n        \/\/2.将token、timestamp、nonce三个参数进行字典序排序\n        var array = [this.token,timestamp,nonce];\n        array.sort();\n\n        \/\/3.将三个参数字符串拼接成一个字符串进行sha1加密\n        var tempStr = array.join(\x27\x27);\n        const hashCode = crypto.createHash(\x27sha1\x27); \/\/创建加密类型 \n        var resultCode = hashCode.update(tempStr,\x27utf8\x27).digest(\x27hex\x27); \/\/对传入的字符串进行加密\n\n        \/\/4.开发者获得加密后的字符串可与signature对比，标识该请求来源于微信\n        if(resultCode === signature){\n            res.send(echostr);\n        }else{\n            res.send(\x27mismatch\x27);\n        }\n}\n\n\/\/暴露可供外部访问的接口\nmodule.exports = WeChat;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x27use strict\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置为严格模式\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e crypto = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27crypto\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/引入加密模块\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/构建 WeChat 对象 即 js中 函数就是对象\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e WeChat = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3econfig\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 WeChat 对象属性 config\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config = config;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 WeChat 对象属性 token\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.token = config.token;\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 微信接入验证\n *\/\x3c\/span\x3e\nWeChat.prototype.auth = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq,res\x3c\/span\x3e)\x3c\/span\x3e{\n     \x3cspan class=\x22hljs-comment\x22\x3e\/\/1.获取微信服务器Get请求的参数 signature、timestamp、nonce、echostr\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e signature = req.query.signature,\x3cspan class=\x22hljs-comment\x22\x3e\/\/微信加密签名\x3c\/span\x3e\n            timestamp = req.query.timestamp,\x3cspan class=\x22hljs-comment\x22\x3e\/\/时间戳\x3c\/span\x3e\n                nonce = req.query.nonce,\x3cspan class=\x22hljs-comment\x22\x3e\/\/随机数\x3c\/span\x3e\n            echostr = req.query.echostr;\x3cspan class=\x22hljs-comment\x22\x3e\/\/随机字符串\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/2.将token、timestamp、nonce三个参数进行字典序排序\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e array = [\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.token,timestamp,nonce];\n        array.sort();\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/3.将三个参数字符串拼接成一个字符串进行sha1加密\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tempStr = array.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hashCode = crypto.createHash(\x3cspan class=\x22hljs-string\x22\x3e\x27sha1\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/创建加密类型 \x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e resultCode = hashCode.update(tempStr,\x3cspan class=\x22hljs-string\x22\x3e\x27utf8\x27\x3c\/span\x3e).digest(\x3cspan class=\x22hljs-string\x22\x3e\x27hex\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/对传入的字符串进行加密\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/4.开发者获得加密后的字符串可与signature对比，标识该请求来源于微信\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(resultCode === signature){\n            res.send(echostr);\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            res.send(\x3cspan class=\x22hljs-string\x22\x3e\x27mismatch\x27\x3c\/span\x3e);\n        }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/暴露可供外部访问的接口\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = WeChat;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e4.整理 app.js 文件的中的代码，如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const express = require(\x27express\x27), \/\/express 框架 \n      wechat  = require(\x27.\/wechat\/wechat\x27), \n       config = require(\x27.\/config\x27);\/\/引入配置文件\n\nvar app = express();\/\/实例express框架\n\nvar wechatApp = new wechat(config); \/\/实例wechat 模块\n\n\/\/用于处理所有进入 3000 端口 get 的连接请求\napp.get(\x27\/\x27,function(req,res){\n    wechatApp.auth(req,res);\n});\n\n\/\/监听3000端口\napp.listen(3000);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-comment\x22\x3e\/\/express 框架 \x3c\/span\x3e\n      wechat  = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/wechat\/wechat\x27\x3c\/span\x3e), \n       config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/config\x27\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/引入配置文件\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\x3cspan class=\x22hljs-comment\x22\x3e\/\/实例express框架\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e wechatApp = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e wechat(config); \x3cspan class=\x22hljs-comment\x22\x3e\/\/实例wechat 模块\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/用于处理所有进入 3000 端口 get 的连接请求\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq,res\x3c\/span\x3e)\x3c\/span\x3e{\n    wechatApp.auth(req,res);\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/监听3000端口\x3c\/span\x3e\napp.listen(\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e嗯！这样代码看着是不是舒服多了呢。\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012428084?w=200\x26amp;h=200\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012428084?w=200\x26amp;h=200\x22 alt=\x22机智如我\x22 title=\x22机智如我\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e剩下的就是去微信公众平台接入验证了，在\x3ca href=\x22http:\/\/cnodejs.org\/topic\/59294bff9e32cc84569a746a\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e上一篇文章\x3c\/a\x3e中有详细的教程，这里我就不再演示了\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012428085?w=800\x26amp;h=800\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012428085?w=800\x26amp;h=800\x22 alt=\x22就是这么懒\x22 title=\x22就是这么懒\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e三、access_token的获取、存储及更新\x3c\/h2\x3e\n\x3cp\x3e1.微信文档步骤\x3c\/p\x3e\n\x3cp\x3e  在开始码代码之前，我们依然是先理清实现的思路，在开始编写实现代码。打开 \x3ca href=\x22https:\/\/mp.weixin.qq.com\/wiki\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e微信帮助文档\x3c\/a\x3e ，点击左侧菜单中的开始开发，点击其子菜单获取access_token，如图：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012428086?w=1420\x26amp;h=1186\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012428086?w=1420\x26amp;h=1186\x22 alt=\x22获取access_token\x22 title=\x22获取access_token\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012428087?w=973\x26amp;h=2194\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012428087?w=973\x26amp;h=2194\x22 alt=\x22获取access_token 帮助文档\x22 title=\x22获取access_token 帮助文档\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e通过上面的 API 的描述，我们总结出以下步骤：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e实现 https  Get 请求\x3c\/li\x3e\n\x3cli\x3e获取 access_token 并存储  如果 当前 access_token 过期则更新\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e2.access_token的获取、存储及更新 代码实现\x3c\/p\x3e\n\x3cp\x3e  整理好思路后我们就按照上一节的步骤去实现。通过帮助文档我们将用于请求微信API 的请求地址与参数，存放到 config.json 文件。\x3c\/p\x3e\n\x3cp\x3e  其中 appid 与 secret 两个参数 位于  \x3ca href=\x22https:\/\/mp.weixin.qq.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e微信公众平台\x3c\/a\x3e 左侧菜单的基本配置中，如图：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011393764?w=732\x26amp;h=411\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011393764?w=732\x26amp;h=411\x22 alt=\x22微信公众平台 - 基本配置\x22 title=\x22微信公众平台 - 基本配置\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012428088?w=985\x26amp;h=423\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012428088?w=985\x26amp;h=423\x22 alt=\x22APPID 与 AppSecret\x22 title=\x22APPID 与 AppSecret\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e开发者密码 点击重置，用手机微信扫面二维码后便可得到。config.json 代码如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;token\x26quot;:\x26quot;wechat\x26quot;,\n    \x26quot;appID\x26quot;:\x26quot;wx154f********764da\x26quot;,\n    \x26quot;appScrect\x26quot;:\x26quot;59de4266*******8dbe9de4b798cd372\x26quot;,\n    \x26quot;apiDomain\x26quot;:\x26quot;https:\/\/api.weixin.qq.com\/\x26quot;,\n    \x26quot;apiURL\x26quot;:{\n        \x26quot;accessTokenApi\x26quot;:\x26quot;%scgi-bin\/token?grant_type=client_credential\x26amp;appid=%s\x26amp;secret=%s\x26quot;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n    \x3cspan class=\x22hljs-string\x22\x3e\x22token\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22wechat\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22appID\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22wx154f********764da\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22appScrect\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x2259de4266*******8dbe9de4b798cd372\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22apiDomain\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/api.weixin.qq.com\/\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22apiURL\x22\x3c\/span\x3e:{\n        \x3cspan class=\x22hljs-string\x22\x3e\x22accessTokenApi\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22%scgi-bin\/token?grant_type=client_credential\x26amp;appid=%s\x26amp;secret=%s\x22\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由于微信 API 请求连接的域名是公用的，我们将它提出来，在请求地址中使用 %s(字符串) 占位符占位。\x3c\/p\x3e\n\x3cp\x3e  微信所有请求连接都是 https 协议，很幸运的是 Node.js 系统包中为我们提供了 https 的包，由于后面的请求会多次用到 https ，因此我们将它封装为一个公用的方法，以便以后的使用，再次打开  wechat.js 在构造方法中，引入 https 模块，并在构造函数内部添加 requestGet 方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/用于处理 https Get请求方法\n    this.requestGet = function(url){\n        return new Promise(function(resolve,reject){\n            https.get(url,function(res){\n                var buffer = [],result = \x26quot;\x26quot;;\n                \/\/监听 data 事件\n                res.on(\x27data\x27,function(data){\n                    buffer.push(data);\n                });\n                \/\/监听 数据传输完成事件\n                res.on(\x27end\x27,function(){\n                    result = Buffer.concat(buffer,buffer.length).toString(\x27utf-8\x27);\n                    \/\/将最后结果返回\n                    resolve(result);\n                });\n            }).on(\x27error\x27,function(err){\n                reject(err);\n            });\n        });\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/用于处理 https Get请求方法\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.requestGet = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve,reject\x3c\/span\x3e)\x3c\/span\x3e{\n            https.get(url,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e)\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e buffer = [],result = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/监听 data 事件\x3c\/span\x3e\n                res.on(\x3cspan class=\x22hljs-string\x22\x3e\x27data\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n                    buffer.push(data);\n                });\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/监听 数据传输完成事件\x3c\/span\x3e\n                res.on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n                    result = Buffer.concat(buffer,buffer.length).toString(\x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e);\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/将最后结果返回\x3c\/span\x3e\n                    resolve(result);\n                });\n            }).on(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e)\x3c\/span\x3e{\n                reject(err);\n            });\n        });\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e提示：\x3cp\x3e    npm 提供了很多用于请求的工具包，比如 request ( 安装命令 npm install request ) 等。这里我只是用系统包去做请求处理。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e  由于 https 是异步请求的，我在这里面使用了 ES6 的 \x3ca href=\x22http:\/\/es6.ruanyifeng.com\/#docs\/promise\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePromise 对象\x3c\/a\x3e 。\x3c\/p\x3e\n\x3cp\x3e  完成了 requestGet方法后，我们的第1步骤也就完成了。下面开始第2步，获取 access_token 并存储  如果 当前 access_token 过期则更新。\x3c\/p\x3e\n\x3cp\x3e  在这之前我是想将 access_token 的存储位置依然放在 config.json 文件中，由于 access_token 在更新后 需要将文件重写，可能容易造成 config.json 文件的格式的紊乱，因此在 wechat 中重新创建一个 accessToken.json 文件用于存储 access_token \x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012428089?w=2448\x26amp;h=1516\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012428089?w=2448\x26amp;h=1516\x22 alt=\x22这里写图片描述\x22 title=\x22这里写图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;access_token\x26quot;:\x26quot;\x26quot;,\n    \x26quot;expires_time\x26quot;:0\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n    \x3cspan class=\x22hljs-string\x22\x3e\x22access_token\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22expires_time\x22\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e   其中 access_token 用于存储  我们 GET 请求后access_token 的值，expires_time 用于存储 access_token 的过期时间，保存为时间戳。\x3c\/p\x3e\n\x3cp\x3e  在 wechat.js 引入 fs 模块用于操作文件、util 工具模块用于处理占位符、  accessToken.json 文件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x27use strict\x27 \/\/设置为严格模式\n\nconst crypto = require(\x27crypto\x27), \/\/引入加密模块\n       https = require(\x27https\x27), \/\/引入 htts 模块\n        util = require(\x27util\x27), \/\/引入 util 工具包\naccessTokenJson = require(\x27.\/access_token\x27); \/\/引入本地存储的 access_token\n\n\/\/构建 WeChat 对象 即 js中 函数就是对象\nvar WeChat = function(config){\n    \/\/设置 WeChat 对象属性 config\n    this.config = config;\n    \/\/设置 WeChat 对象属性 token\n    this.token = config.token;\n    \/\/设置 WeChat 对象属性 appID\n    this.appID = config.appID;\n    \/\/设置 WeChat 对象属性 appScrect\n    this.appScrect = config.appScrect;\n    \/\/设置 WeChat 对象属性 apiDomain\n    this.apiDomain = config.apiDomain;\n    \/\/设置 WeChat 对象属性 apiURL\n    this.apiDomain = config.apiURL;\n\n    \/\/用于处理 https Get请求方法\n    this.requestGet = function(url){\n        return new Promise(function(resolve,reject){\n            https.get(url,function(res){\n                var buffer = [],result = \x26quot;\x26quot;;\n                \/\/监听 data 事件\n                res.on(\x27data\x27,function(data){\n                    buffer.push(data);\n                });\n                \/\/监听 数据传输完成事件\n                res.on(\x27end\x27,function(){\n                    result = Buffer.concat(buffer,buffer.length).toString(\x27utf-8\x27);\n                    \/\/将最后结果返回\n                    resolve(result);\n                });\n            }).on(\x27error\x27,function(err){\n                reject(err);\n            });\n        });\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x27use strict\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置为严格模式\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e crypto = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27crypto\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-comment\x22\x3e\/\/引入加密模块\x3c\/span\x3e\n       https = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27https\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-comment\x22\x3e\/\/引入 htts 模块\x3c\/span\x3e\n        util = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27util\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-comment\x22\x3e\/\/引入 util 工具包\x3c\/span\x3e\naccessTokenJson = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/access_token\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/引入本地存储的 access_token\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/构建 WeChat 对象 即 js中 函数就是对象\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e WeChat = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3econfig\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 WeChat 对象属性 config\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config = config;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 WeChat 对象属性 token\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.token = config.token;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 WeChat 对象属性 appID\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.appID = config.appID;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 WeChat 对象属性 appScrect\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.appScrect = config.appScrect;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 WeChat 对象属性 apiDomain\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.apiDomain = config.apiDomain;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置 WeChat 对象属性 apiURL\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.apiDomain = config.apiURL;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/用于处理 https Get请求方法\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.requestGet = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve,reject\x3c\/span\x3e)\x3c\/span\x3e{\n            https.get(url,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e)\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e buffer = [],result = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/监听 data 事件\x3c\/span\x3e\n                res.on(\x3cspan class=\x22hljs-string\x22\x3e\x27data\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n                    buffer.push(data);\n                });\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/监听 数据传输完成事件\x3c\/span\x3e\n                res.on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n                    result = Buffer.concat(buffer,buffer.length).toString(\x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e);\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/将最后结果返回\x3c\/span\x3e\n                    resolve(result);\n                });\n            }).on(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e)\x3c\/span\x3e{\n                reject(err);\n            });\n        });\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e  在 wechat.js  添加获取 access_token 的方法 getAccessToken\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 获取微信 access_token\n *\/\nWeChat.prototype.getAccessToken = function(){\n    var that = this;\n    return new Promise(function(resolve,reject){\n        \/\/获取当前时间 \n        var currentTime = new Date().getTime();\n        \/\/格式化请求地址\n        var url = util.format(that.apiURL.accessTokenApi,that.apiDomain,that.appID,that.appScrect);\n        \/\/判断 本地存储的 access_token 是否有效\n        if(accessTokenJson.access_token === \x26quot;\x26quot; || accessTokenJson.expires_time \x3c currentTime){\n            that.requestGet(url).then(function(data){\n                var result = JSON.parse(data); \n                if(data.indexOf(\x26quot;errcode\x26quot;) \x3c 0){\n                    accessTokenJson.access_token = result.access_token;\n                    accessTokenJson.expires_time = new Date().getTime() \x2b (parseInt(result.expires_in) - 200) * 1000;\n                    \/\/更新本地存储的\n                    fs.writeFile(\x27.\/wechat\/access_token.json\x27,JSON.stringify(accessTokenJson));\n                    \/\/将获取后的 access_token 返回\n                    resolve(accessTokenJson.access_token);\n                }else{\n                    \/\/将错误返回\n                    resolve(result);\n                } \n            });\n        }else{\n            \/\/将本地存储的 access_token 返回\n            resolve(accessTokenJson.access_token);  \n        }\n    });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 获取微信 access_token\n *\/\x3c\/span\x3e\nWeChat.prototype.getAccessToken = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e that = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve,reject\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/获取当前时间 \x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e currentTime = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime();\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/格式化请求地址\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = util.format(that.apiURL.accessTokenApi,that.apiDomain,that.appID,that.appScrect);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/判断 本地存储的 access_token 是否有效\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(accessTokenJson.access_token === \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e || accessTokenJson.expires_time \x26lt; currentTime){\n            that.requestGet(url).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.parse(data); \n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(data.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x22errcode\x22\x3c\/span\x3e) \x26lt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e){\n                    accessTokenJson.access_token = result.access_token;\n                    accessTokenJson.expires_time = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime() \x2b (\x3cspan class=\x22hljs-built_in\x22\x3eparseInt\x3c\/span\x3e(result.expires_in) - \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e) * \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e;\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/更新本地存储的\x3c\/span\x3e\n                    fs.writeFile(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/wechat\/access_token.json\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(accessTokenJson));\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/将获取后的 access_token 返回\x3c\/span\x3e\n                    resolve(accessTokenJson.access_token);\n                }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/将错误返回\x3c\/span\x3e\n                    resolve(result);\n                } \n            });\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/将本地存储的 access_token 返回\x3c\/span\x3e\n            resolve(accessTokenJson.access_token);  \n        }\n    });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e  在 app.js  中添加新的监听链接用于测试 我们获取的token\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/用于请求获取 access_token\napp.get(\x27\/getAccessToken\x27,function(req,res){\n    wechatApp.getAccessToken().then(function(data){\n        res.send(data);\n    });    \n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/用于请求获取 access_token\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/getAccessToken\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq,res\x3c\/span\x3e)\x3c\/span\x3e{\n    wechatApp.getAccessToken().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n        res.send(data);\n    });    \n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012428090?w=2354\x26amp;h=1316\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012428090?w=2354\x26amp;h=1316\x22 alt=\x22获取access_token的效果图\x22 title=\x22获取access_token的效果图\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e  这样我们就大功告成了！\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012428091?w=440\x26amp;h=440\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012428091?w=440\x26amp;h=440\x22 alt=\x22年轻人恭喜你\x22 title=\x22年轻人恭喜你\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e  文章源代码：\x3ca href=\x22https:\/\/github.com\/SilenceHVK\/wechatByNode\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/SilenceHVK...\x3c\/a\x3e 。对文章有不正确之处，请给予纠正。github源代码请顺手给个 Star，最后感谢您的阅读。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>【Node.js 微信公众号实战】2.Node.js access_token的获取、存储及更新</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012428077">https://segmentfault.com/a/1190000012428077</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/5e1o43o1m/" target="_blank">https://alili.tech/archive/5e1o43o1m/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>