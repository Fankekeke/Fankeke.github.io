<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="XSS攻击原理分析与防御技术"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>XSS攻击原理分析与防御技术 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/5hd7uqclvt6/",
				"appid": "1613049289050283", 
				"title": "XSS攻击原理分析与防御技术 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-13T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/zl97rlc8twh/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/4edhgmzbkdd/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f5hd7uqclvt6%2f&text=XSS%e6%94%bb%e5%87%bb%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90%e4%b8%8e%e9%98%b2%e5%be%a1%e6%8a%80%e6%9c%af"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f5hd7uqclvt6%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f5hd7uqclvt6%2f&text=XSS%e6%94%bb%e5%87%bb%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90%e4%b8%8e%e9%98%b2%e5%be%a1%e6%8a%80%e6%9c%af"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f5hd7uqclvt6%2f&title=XSS%e6%94%bb%e5%87%bb%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90%e4%b8%8e%e9%98%b2%e5%be%a1%e6%8a%80%e6%9c%af"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f5hd7uqclvt6%2f&is_video=false&description=XSS%e6%94%bb%e5%87%bb%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90%e4%b8%8e%e9%98%b2%e5%be%a1%e6%8a%80%e6%9c%af"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=XSS%e6%94%bb%e5%87%bb%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90%e4%b8%8e%e9%98%b2%e5%be%a1%e6%8a%80%e6%9c%af&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f5hd7uqclvt6%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f5hd7uqclvt6%2f&title=XSS%e6%94%bb%e5%87%bb%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90%e4%b8%8e%e9%98%b2%e5%be%a1%e6%8a%80%e6%9c%af"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5hd7uqclvt6%2f&title=XSS%e6%94%bb%e5%87%bb%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90%e4%b8%8e%e9%98%b2%e5%be%a1%e6%8a%80%e6%9c%af"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5hd7uqclvt6%2f&title=XSS%e6%94%bb%e5%87%bb%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90%e4%b8%8e%e9%98%b2%e5%be%a1%e6%8a%80%e6%9c%af"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5hd7uqclvt6%2f&title=XSS%e6%94%bb%e5%87%bb%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90%e4%b8%8e%e9%98%b2%e5%be%a1%e6%8a%80%e6%9c%af"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">XSS攻击原理分析与防御技术</h1><div class="meta"><div class="postdate"><time datetime="2018-12-13" itemprop="datePublished">2018-12-13</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e跨站脚本攻击(Cross Site Scripting)，缩写为XSS。恶意攻击者往Web页面里插入恶意javaScript代码，当用户浏览该页之时，嵌入其中Web里面的javaScript代码会被执行，从而达到恶意攻击用户的目的。\x3c\/p\x3e\n\x3cblockquote\x3e\x3ch3 id=\x22articleHeader0\x22\x3e一个简单的XSS攻击\x3c\/h3\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV31qW?w=466\x26amp;h=268\x22 src=\x22https:\/\/static.alili.tech\/img\/bV31qW?w=466\x26amp;h=268\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22async function(ctx, next){\n    ctx.set(\x27X-XSS-Protection\x27,0);\n    ctx.render(\x27index\x27,{from:ctx.query.from});\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ectx, next\x3c\/span\x3e)\x3c\/span\x3e{\n    ctx.\x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27X-XSS-Protection\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n    ctx.render(\x3cspan class=\x22hljs-string\x22\x3e\x27index\x27\x3c\/span\x3e,{\x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e:ctx.query.\x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e});\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意：插入X-XSS-Protection头部使浏览器XSS拦截器失效。\x3c\/p\x3e\n\x3cp\x3e开始攻击：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV31Px?w=1007\x26amp;h=204\x22 src=\x22https:\/\/static.alili.tech\/img\/bV31Px?w=1007\x26amp;h=204\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e大家发现网页执行了一段脚本，而且这段脚本是用户恶意输入的。这就是XSS攻击最简单的一个案例。把原本应该显示纯文本的地方，执行了一段黑客写入的脚本。\x3c\/p\x3e\n\x3cp\x3e那XSS攻击有什么危害呢？\x3c\/p\x3e\n\x3cp\x3e1、盗取各类用户帐号\x3cbr\x3e2、控制企业数据，包括读取、篡改、添加、删除企业敏感数据的能力\x3cbr\x3e3、盗窃企业重要的具有商业价值的资料\x3cbr\x3e4、非法转账\x3cbr\x3e5、强制发送电子邮件\x3cbr\x3e6、网站挂马\x3cbr\x3e7、控制受害者机器向其它网站发起攻击\x3c\/p\x3e\n\x3cblockquote\x3e\x3ch3 id=\x22articleHeader1\x22\x3eXSS攻击的分类\x3c\/h3\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e1、反射型\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e又称为非持久性跨站点脚本攻击。漏洞产生的原因是攻击者注入的数据反映在响应中。非持久型XSS攻击要求用户访问一个被攻击者篡改后的链接，用户访问该链接时，被植入的攻击脚本被用户游览器执行，从而达到攻击目的。也就是我上面举的那个简单的XSS攻击案例，通过url参数直接注入。然后在响应的数据中包含着危险的代码。\x3c\/p\x3e\n\x3cp\x3e当黑客把这个链接发给你，你就中招啦！\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e2、存储型\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e又称为持久型跨站点脚本，它一般发生在XSS攻击向量(一般指XSS攻击代码)存储在网站数据库，当一个页面被用户打开的时候执行。持久的XSS相比非持久性XSS攻击危害性更大,容易造成蠕虫，因为每当用户打开页面，查看内容时脚本将自动执行。\x3c\/p\x3e\n\x3cp\x3e该网页有一个发表评论的功能，该评论会写入后台数据库，并且访问主页的时候，会从数据库中加载出所有的评论。\x3c\/p\x3e\n\x3cp\x3e当我添加一个评论，并且暗藏一个脚本，如下图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV31PW?w=698\x26amp;h=283\x22 src=\x22https:\/\/static.alili.tech\/img\/bV31PW?w=698\x26amp;h=283\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e当别人访问主页的时候，刚刚黑客写入的评论里面的脚本被浏览器当成代码执行了，用户莫名其妙受到攻击：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV31PY?w=919\x26amp;h=430\x22 src=\x22https:\/\/static.alili.tech\/img\/bV31PY?w=919\x26amp;h=430\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e上面就是两种XSS攻击的两种基本类型。当然黑客不会弹出一个框框给你，告诉你被攻击，黑客不会这么傻的~他可以在用户不知情的情况下，盗取用户的cookie，改变网页业务逻辑等等。\x3c\/p\x3e\n\x3cblockquote\x3e\x3ch3 id=\x22articleHeader2\x22\x3eXSS攻击的注入点\x3c\/h3\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e1、HTML节点内容\x3c\/strong\x3e\x3cbr\x3e这个其实就是我之前演示的，HTML节点中暗藏攻击脚本。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV31QU?w=380\x26amp;h=63\x22 src=\x22https:\/\/static.alili.tech\/img\/bV31QU?w=380\x26amp;h=63\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e2、HTML属性\x3c\/strong\x3e\x3cbr\x3e这里img的src属性是由用户传递过来的值，当用户把图片地址写成：1\x22%20onerror=\x22alert(%27哈哈被攻击%27)\x3cbr\x3e大家看下面发生了什么：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV31RO?w=410\x26amp;h=60\x22 src=\x22https:\/\/static.alili.tech\/img\/bV31RO?w=410\x26amp;h=60\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV31RM?w=909\x26amp;h=165\x22 src=\x22https:\/\/static.alili.tech\/img\/bV31RM?w=909\x26amp;h=165\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e3、JavaScript代码 （字符串提前关闭）\x3c\/strong\x3e\x3cbr\x3e当JavaScript代码中有一个变量是由用户提供的数据，这个数据也有可能之前被写入了数据库。如下图，当用户输入的内容为：\x3cbr\x3e小柚子\x22;alert(%27哈哈你被攻击了！%27);\x22\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV31Vh?w=532\x26amp;h=49\x22 src=\x22https:\/\/static.alili.tech\/img\/bV31Vh?w=532\x26amp;h=49\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV31Vd?w=1019\x26amp;h=163\x22 src=\x22https:\/\/static.alili.tech\/img\/bV31Vd?w=1019\x26amp;h=163\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e4、富文本\x3c\/strong\x3e\x3cbr\x3e大家都知道，富文本其实就是一段HTML。既然它是一段HTML，那么就存在XSS攻击。而且富文本攻击的防御相对比较麻烦。\x3c\/p\x3e\n\x3cblockquote\x3e\x3ch3 id=\x22articleHeader3\x22\x3eXSS攻击防御\x3c\/h3\x3e\x3c\/blockquote\x3e\n\x3cp\x3echrome浏览器自带防御,可拦截反射性XSS（HTML内容和属性），js和富文本的无法拦截，所以我们必须得自己做一些防御手段。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e1、HTML节点内容的防御\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e将用户输入的内容进行转义：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var escapeHtml = function(str) {\n    str = str.replace(\/\x3c\/g,\x27\x26amp;lt;\x27);\n    str = str.replace(\/\x3c\/g,\x27\x26amp;gt;\x27);\n    return str;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs axapta\x22\x3e\x3ccode\x3evar escapeHtml = function(\x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e.replace(\/\x26lt;\/g,\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;lt;\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e.replace(\/\x26lt;\/g,\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;gt;\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22ctx.render(\x27index\x27, {comments, from: escapeHtml(ctx.query.from || \x27\x27)});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3ectx.render(\x3cspan class=\x22hljs-string\x22\x3e\x27index\x27\x3c\/span\x3e, {comments, \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e: escapeHtml(ctx.query.\x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e || \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV310b?w=574\x26amp;h=81\x22 src=\x22https:\/\/static.alili.tech\/img\/bV310b?w=574\x26amp;h=81\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e2、HTML属性的防御\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e对空格，单引号，双引号进行转义\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var escapeHtmlProperty = function (str) {\n    if(!str) return \x27\x27;\n    str = str.replace(\/\x26quot;\/g,\x27\x26amp;quto;\x27);\n    str = str.replace(\/\x27\/g,\x27\x26amp;#39;\x27);\n    str = str.replace(\/ \/g,\x27\x26amp;#32;\x27);\n    return str;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e escapeHtmlProperty = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!str) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n    str = str.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\x22\/g\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;quto;\x27\x3c\/span\x3e);\n    str = str.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\x27\/g\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;#39;\x27\x3c\/span\x3e);\n    str = str.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/ \/g\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;#32;\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e str;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22ctx.render(\x27index\x27, {posts, comments,\n    from:ctx.query.from || \x27\x27,\n    avatarId:escapeHtmlProperty(ctx.query.avatarId || \x27\x27)});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3ectx.render(\x3cspan class=\x22hljs-string\x22\x3e\x27index\x27\x3c\/span\x3e, {posts, comments,\n    \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e:ctx.query.\x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e || \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n    avatarId:escapeHtmlProperty(ctx.query.avatarId || \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV311b?w=572\x26amp;h=52\x22 src=\x22https:\/\/static.alili.tech\/img\/bV311b?w=572\x26amp;h=52\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e3、JavaScript的防御\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e对引号进行转义\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var escapeForJS = function(str){\n        if(!str) return \x27\x27;\n        str = str.replace(\/\\\\\/g,\x27\\\\\\\\\x27);\n        str = str.replace(\/\x26quot;\/g,\x27\\\\\x26quot;\x27);\n        return str;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e escapeForJS = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!str) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n        str = str.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\\\\/g\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27\\\\\\\\\x27\x3c\/span\x3e);\n        str = str.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\x22\/g\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27\\\\\x22\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e str;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV311y?w=484\x26amp;h=34\x22 src=\x22https:\/\/static.alili.tech\/img\/bV311y?w=484\x26amp;h=34\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e4、富文本的防御\x3c\/strong\x3e\x3cbr\x3e富文本的情况非常的复杂，js可以藏在标签里，超链接url里，何种属性里。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript\x3ealert(1)\x3c\/script\x3e\n\x3ca href=\x26quot;javascript:alert(1)\x26quot;\x3e\x3c\/a\x3e\n\x3cimg src=\x26quot;abc\x26quot; onerror=\x26quot;alert(1)\x26quot;\/\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3ealert(1)\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22javascript:alert(1)\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22abc\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonerror\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22alert(1)\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e所以我们不能过用上面的方法做简单的转义。因为情况实在太多了。\x3c\/p\x3e\n\x3cp\x3e现在我们换个思路，\x3cbr\x3e提供两种过滤的办法：\x3c\/p\x3e\n\x3cp\x3e1）黑名单\x3cbr\x3e我们可以把\x26lt;script\/\x26gt; onerror 这种危险标签或者属性纳入黑名单，过滤掉它。但是我们想，这种方式你要考虑很多情况，你也有可能漏掉一些情况等。\x3c\/p\x3e\n\x3cp\x3e2）白名单\x3cbr\x3e这种方式只允许部分标签和属性。不在这个白名单中的，一律过滤掉它。但是这种方式编码有点麻烦，我们需要去解析html树状结构，然后进行过滤，把过滤后安全的html在输出。\x3cbr\x3e这里提供一个包，帮助我们去解析html树状结构，它使用起来和jquery非常的类似。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm install cheerio --save\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sql\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpm \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e cheerio \x3cspan class=\x22hljs-comment\x22\x3e--save\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var xssFilter = function(html) {\n    if(!html) return \x27\x27;\n    var cheerio = require(\x27cheerio\x27);\n    var $ = cheerio.load(html);\n    \/\/白名单\n    var whiteList = {\n        \x27html\x27 : [\x27\x27],\n        \x27body\x27 : [\x27\x27],\n        \x27head\x27 : [\x27\x27],\n        \x27div\x27 : [\x27class\x27],\n        \x27img\x27 : [\x27src\x27],\n        \x27a\x27 : [\x27href\x27],\n        \x27font\x27:[\x27size\x27,\x27color\x27]\n    };\n\n    $(\x27*\x27).each(function(index,elem){\n        if(!whiteList[elem.name]) {\n            $(elem).remove();\n            return;\n        }\n        for(var attr in elem.attribs) {\n            if(whiteList[elem.name].indexOf(attr) === -1) {\n                $(elem).attr(attr,null);\n            }\n        }\n\n    });\n\n    return $.html();\n}\n\nconsole.log(xssFilter(\x27\x3cdiv\x3e\x3cfont color=\x26quot;red\x26quot;\x3e你好\x3c\/font\x3e\x3ca href=\x26quot;http:\/\/www.baidu.com\x26quot;\x3e百度\x3c\/a\x3e\x3cscript\x3ealert(\x26quot;哈哈你被攻击了\x26quot;)\x3c\/script\x3e\x3c\/div\x3e\x27));\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e xssFilter = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ehtml\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!html) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cheerio = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27cheerio\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e $ = cheerio.load(html);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/白名单\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e whiteList = {\n        \x3cspan class=\x22hljs-string\x22\x3e\x27html\x27\x3c\/span\x3e : [\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e],\n        \x3cspan class=\x22hljs-string\x22\x3e\x27body\x27\x3c\/span\x3e : [\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e],\n        \x3cspan class=\x22hljs-string\x22\x3e\x27head\x27\x3c\/span\x3e : [\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e],\n        \x3cspan class=\x22hljs-string\x22\x3e\x27div\x27\x3c\/span\x3e : [\x3cspan class=\x22hljs-string\x22\x3e\x27class\x27\x3c\/span\x3e],\n        \x3cspan class=\x22hljs-string\x22\x3e\x27img\x27\x3c\/span\x3e : [\x3cspan class=\x22hljs-string\x22\x3e\x27src\x27\x3c\/span\x3e],\n        \x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e : [\x3cspan class=\x22hljs-string\x22\x3e\x27href\x27\x3c\/span\x3e],\n        \x3cspan class=\x22hljs-string\x22\x3e\x27font\x27\x3c\/span\x3e:[\x3cspan class=\x22hljs-string\x22\x3e\x27size\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27color\x27\x3c\/span\x3e]\n    };\n\n    $(\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e).each(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eindex,elem\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!whiteList[elem.name]) {\n            $(elem).remove();\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e attr \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e elem.attribs) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(whiteList[elem.name].indexOf(attr) === \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n                $(elem).attr(attr,\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e);\n            }\n        }\n\n    });\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $.html();\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(xssFilter(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;div\x26gt;\x26lt;font color=\x22red\x22\x26gt;你好\x26lt;\/font\x26gt;\x26lt;a href=\x22http:\/\/www.baidu.com\x22\x26gt;百度\x26lt;\/a\x26gt;\x26lt;script\x26gt;alert(\x22哈哈你被攻击了\x22)\x26lt;\/script\x26gt;\x26lt;\/div\x26gt;\x27\x3c\/span\x3e));\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e大家可以看到：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV314w?w=650\x26amp;h=42\x22 src=\x22https:\/\/static.alili.tech\/img\/bV314w?w=650\x26amp;h=42\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x26lt;script\x26gt;不在白名单中，所以被过滤掉了。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e5、CSP(Content Security Policy)\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e内容安全策略（Content Security Policy，简称CSP）是一种以可信白名单作机制，来限制网站中是否可以包含某来源内容。默认配置下不允许执行内联代码（\x26lt;script\x26gt;块内容，内联事件，内联样式），以及禁止执行eval() , newFunction() , setTimeout([string], ...) 和setInterval([string], ...) 。     \x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e示例：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e1.只允许本站资源\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Content-Security-Policy： default-src ‘self’\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haskell\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-type\x22\x3eContent\x3c\/span\x3e-\x3cspan class=\x22hljs-type\x22\x3eSecurity\x3c\/span\x3e-\x3cspan class=\x22hljs-type\x22\x3ePolicy\x3c\/span\x3e： \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e-src ‘self’\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e2.允许本站的资源以及任意位置的图片以及 \x3ca href=\x22https:\/\/segmentfault.com\x22\x3ehttps:\/\/segmentfault.com\x3c\/a\x3e 下的脚本。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Content-Security-Policy： default-src ‘self’; img-src *;\nscript-src https:\/\/segmentfault.com\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3eContent-Security-Policy： \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e-src ‘self’; img-src *;\nscript-src \x3cspan class=\x22hljs-string\x22\x3ehttps:\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/segmentfault.com\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>XSS攻击原理分析与防御技术</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013315450">https://segmentfault.com/a/1190000013315450</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/5hd7uqclvt6/" target="_blank">https://alili.tech/archive/5hd7uqclvt6/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>