<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="dva值得一试"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>dva值得一试 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/6klc5egm705/",
				"appid": "1613049289050283", 
				"title": "dva值得一试 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-29T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/sh4377sddis/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/kp6qcxwu1z/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f6klc5egm705%2f&text=dva%e5%80%bc%e5%be%97%e4%b8%80%e8%af%95"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f6klc5egm705%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f6klc5egm705%2f&text=dva%e5%80%bc%e5%be%97%e4%b8%80%e8%af%95"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f6klc5egm705%2f&title=dva%e5%80%bc%e5%be%97%e4%b8%80%e8%af%95"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f6klc5egm705%2f&is_video=false&description=dva%e5%80%bc%e5%be%97%e4%b8%80%e8%af%95"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=dva%e5%80%bc%e5%be%97%e4%b8%80%e8%af%95&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f6klc5egm705%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f6klc5egm705%2f&title=dva%e5%80%bc%e5%be%97%e4%b8%80%e8%af%95"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f6klc5egm705%2f&title=dva%e5%80%bc%e5%be%97%e4%b8%80%e8%af%95"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f6klc5egm705%2f&title=dva%e5%80%bc%e5%be%97%e4%b8%80%e8%af%95"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f6klc5egm705%2f&title=dva%e5%80%bc%e5%be%97%e4%b8%80%e8%af%95"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">dva值得一试</h1><div class="meta"><div class="postdate"><time datetime="2018-12-29" itemprop="datePublished">2018-12-29</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e\x3ca href=\x22http:\/\/realtcg.com\/2017\/08\/25\/dva%E5%80%BC%E5%BE%97%E4%B8%80%E8%AF%95\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e原文地址\x3c\/a\x3e在我的博客, 转载请注明出处，谢谢！\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e前言\x3c\/h3\x3e\n\x3cp\x3e使用React技术栈管理大型复杂的应用往往要使用Redux来管理应用的状态，然而随着深度使用，Redux也暴露出了一些问题。如编写页面配套（action、reducer）过于繁琐、复杂，组件之间耦合较深、不够扁平化、调用action creator发起动作破坏action纯洁性且必须层层传递等。这些缺点迫使使用Redux的人开始探索好的架构方式，解决或减轻使用Redux的问题。业界标杆阿里为此推出了dva 和 Mirror两种改良Redux的架构方案，不过这两者类似，本文就介绍一下dva。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e概述\x3c\/h3\x3e\n\x3cp\x3e本文介绍了dva的产生背景，dva是什么，用来做什么，解决了什么问题，使用场景，原理，实践以及我的使用心得。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e背景\x3c\/h3\x3e\n\x3cp\x3eRedux 文档中介绍，我们需要编写页面的action creator来提交，需要写reducer来更新state，最好对action 和 reducer 做页面为单位的分割，利用redux 给的API 构建容器组件包裹父组件来connect store拿到数据，然后再向下传递给functional component 来渲染，整个过程就实现了单向数据流。当应用复杂起来，一般的做法是配合react-router 做页面分割，光这个分割，你就得 做redux store 的创建，中间件的配置，路由的初始化，Provider 的 store 的绑定，saga 的初始化，还要处理 reducer, component, saga之间的联系...这个没办法，Redux就这么复杂；但是每个页面下要有自己对应的action、reducer，一般还会有saga，这样的话每个页面下都要有四五个文件目录（还有components、containers），每个文件目录下估计还要有不同功能的action、reducer、saga...如果这能忍的话，你在组件里发起action有两个方案，第一：调用经过\x3cstrong\x3e层层传递\x3c\/strong\x3e的action creator 或者 sagas，第二，让saga监听action，再在组件里直接dispatch相应action类型就行了，不用层层传递，但是得提前 fork -\x26gt; watcher -\x26gt; worker.....真的是非常复杂，容易出错。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3edva 是什么\x3c\/h3\x3e\n\x3cp\x3edva名字取自游戏守望先锋里的一个驾驶机甲的韩国英雄叫dva，大概含义就是Redux的机甲吧...\x3c\/p\x3e\n\x3cp\x3e确实,\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3edva 是基于现有应用架构 (redux \x2b react-router \x2b redux-saga 等)的一层轻量封装，没有引入任何新概念，全部代码不到 100 行。( Inspired by elm and choo. )\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3edva 帮你自动化了Redux 架构一些繁琐的步骤，比如上面所说的redux store 的创建，中间件的配置，路由的初始化等等,没有什么魔法，只是帮你做了redux \x2b react-router \x2b redux-saga 架构的那些恶心、繁琐、容易出错的步骤，只需写几行代码就可以实现上述步骤，它解决了背景所说的所有缺点。\x3ca href=\x22https:\/\/github.com\/dvajs\/dva\/issues\/1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edva介绍\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e此外，dva重要的特性就是把一个路由下的state、reducer、sagas 写到一块了，清晰明了\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22app.model({\n  namespace: \x27products\x27, \/\/分割的路由，对应要combine到root Reducer里的名字，这里就是state.products\n  state: {  \/\/这个路由下初始state\n    list: [],\n    loading: false,\n  },\n  subscriptions: [  \/\/用来监听路径变化，这里就是当路由为products时dispatch一个获取数据的请求\n    setup({ dispatch, history }) {\n      return history.listen(({ pathname }) =\x3e {\n        if (pathname === \x27products\x27) {\n          \/\/dispatch({ type: \x27getUserInfo\x27, payload: {} });\n        }\n      });\n    },\n  },\n  ],\n  effects: { \/\/saga里的effects，里面的各种处理异步操作的saga\n    [\x27products\/query\x27]: function*() {\n      yield call(delay(800));\n      yield put({\n        type: \x27products\/query\/success\x27,\n        payload: [\x27ant-tool\x27, \x27roof\x27],\n      });\n    },\n  },\n  reducers: {  \/\/ reducers \n    [\x27products\/query\x27](state) {\n      return { ...state, loading: true, };\n    },\n    [\x27products\/query\/success\x27](state, { payload }) {\n      return { ...state, loading: false, list: payload };\n    },\n  },\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eapp.model({\n  \x3cspan class=\x22hljs-attr\x22\x3enamespace\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27products\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/分割的路由，对应要combine到root Reducer里的名字，这里就是state.products\x3c\/span\x3e\n  state: {  \x3cspan class=\x22hljs-comment\x22\x3e\/\/这个路由下初始state\x3c\/span\x3e\n    list: [],\n    \x3cspan class=\x22hljs-attr\x22\x3eloading\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3esubscriptions\x3c\/span\x3e: [  \x3cspan class=\x22hljs-comment\x22\x3e\/\/用来监听路径变化，这里就是当路由为products时dispatch一个获取数据的请求\x3c\/span\x3e\n    setup({ dispatch, history }) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e history.listen(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ pathname }\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (pathname === \x3cspan class=\x22hljs-string\x22\x3e\x27products\x27\x3c\/span\x3e) {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/dispatch({ type: \x27getUserInfo\x27, payload: {} });\x3c\/span\x3e\n        }\n      });\n    },\n  },\n  ],\n  \x3cspan class=\x22hljs-attr\x22\x3eeffects\x3c\/span\x3e: { \x3cspan class=\x22hljs-comment\x22\x3e\/\/saga里的effects，里面的各种处理异步操作的saga\x3c\/span\x3e\n    [\x3cspan class=\x22hljs-string\x22\x3e\x27products\/query\x27\x3c\/span\x3e]: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e*(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(delay(\x3cspan class=\x22hljs-number\x22\x3e800\x3c\/span\x3e));\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27products\/query\/success\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x27ant-tool\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27roof\x27\x3c\/span\x3e],\n      });\n    },\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3ereducers\x3c\/span\x3e: {  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ reducers \x3c\/span\x3e\n    [\x3cspan class=\x22hljs-string\x22\x3e\x27products\/query\x27\x3c\/span\x3e](state) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { ...state, \x3cspan class=\x22hljs-attr\x22\x3eloading\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, };\n    },\n    [\x3cspan class=\x22hljs-string\x22\x3e\x27products\/query\/success\x27\x3c\/span\x3e](state, { payload }) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { ...state, \x3cspan class=\x22hljs-attr\x22\x3eloading\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3elist\x3c\/span\x3e: payload };\n    },\n  },\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3edva的思想\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/dvajs\/dva\/blob\/master\/docs\/Concepts_zh-CN.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e官方文档\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3edva就是把之前Redux每个路由下的state、reducer、sagas写到一块去了，做了写到一块去也能做到以前redux能做的事，并且让思路变得很清晰 ：\x3c\/p\x3e\n\x3cp\x3e每个路由下都有一个model，这个model掌管这个路由的所有状态（action、state、reducer、sagas），组件想改变状态dispatch type名字就行了。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010645726\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010645726\x22 alt=\x22img\x22 title=\x22img\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e实践\x3c\/h3\x3e\n\x3cp\x3e搞懂框架的脚手架是快速上手这个框架的一个好方法，下面是dva-cli\x3c\/p\x3e\n\x3ch4\x3e项目架构\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\n├── src                    \n    ├── assets             # 图片、logo\n    ├── components         # 公用UI组件\n    ├── index.css          # CSS for entry file\n    ├── index.html         # HTML for entry file\n    ├── index.js           # 入口文件\n    ├── models             # 这里存放的就是上面说的dva的model，最好每个路由一个model\n    ├── router.js          # 路由文件\n    ├── routes             # 路由组件，跟Redux相同\n    ├── services           # 每个页面的services，通常是获取后端数据的接口定义\n    └── utils              # 存放一些工具\n        └── request.js     # 这里封装一个用来与后端通信的接口\n├── .editorconfig          #\n├── .eslintrc              # Eslint config\n├── .gitignore             #\n├── .roadhogrc             # Roadhog config\n└── package.json           #\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mipsasm\x22\x3e\x3ccode\x3e.\n├── src                    \n    ├── assets             \x3cspan class=\x22hljs-comment\x22\x3e# 图片、logo\x3c\/span\x3e\n    ├── components         \x3cspan class=\x22hljs-comment\x22\x3e# 公用UI组件\x3c\/span\x3e\n    ├── index.css          \x3cspan class=\x22hljs-comment\x22\x3e# CSS for entry file\x3c\/span\x3e\n    ├── index.html         \x3cspan class=\x22hljs-comment\x22\x3e# HTML for entry file\x3c\/span\x3e\n    ├── index.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e          \x3cspan class=\x22hljs-comment\x22\x3e# 入口文件\x3c\/span\x3e\n    ├── models             \x3cspan class=\x22hljs-comment\x22\x3e# 这里存放的就是上面说的dva的model，最好每个路由一个model\x3c\/span\x3e\n    ├── router.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e         \x3cspan class=\x22hljs-comment\x22\x3e# 路由文件\x3c\/span\x3e\n    ├── routes             \x3cspan class=\x22hljs-comment\x22\x3e# 路由组件，跟Redux相同\x3c\/span\x3e\n    ├── services           \x3cspan class=\x22hljs-comment\x22\x3e# 每个页面的services，通常是获取后端数据的接口定义\x3c\/span\x3e\n    └── utils              \x3cspan class=\x22hljs-comment\x22\x3e# 存放一些工具\x3c\/span\x3e\n        └── request.\x3cspan class=\x22hljs-keyword\x22\x3ejs \x3c\/span\x3e    \x3cspan class=\x22hljs-comment\x22\x3e# 这里封装一个用来与后端通信的接口\x3c\/span\x3e\n├── .editorconfig          \x3cspan class=\x22hljs-comment\x22\x3e#\x3c\/span\x3e\n├── .eslintrc              \x3cspan class=\x22hljs-comment\x22\x3e# Eslint config\x3c\/span\x3e\n├── .gitignore             \x3cspan class=\x22hljs-comment\x22\x3e#\x3c\/span\x3e\n├── .roadhogrc             \x3cspan class=\x22hljs-comment\x22\x3e# Roadhog config\x3c\/span\x3e\n└── package.\x3cspan class=\x22hljs-keyword\x22\x3ejson \x3c\/span\x3e          \x3cspan class=\x22hljs-comment\x22\x3e#\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e按照dva的架构，每个路由下都有个model层，在model定义好这个路由的initialstate、reducers、sagas、subscriptions；然后connect组件，当在组件里发起action时，直接dispatch就行了，dva会帮你自动调用sagas\/reducers。当发起同步action时，type写成\x3ccode\x3e\x27(namespace)\/(reducer)\x27\x3c\/code\x3edva就帮你调用对应名字的reducer直接更新state，当发起异步action，type就写成\x3ccode\x3e\x27(namespace)\/(saga)\x27\x3c\/code\x3e,dva就帮你调用对应名字的saga异步更新state，非常方便：\x3c\/p\x3e\n\x3cp\x3e在组件里：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  ...\n  const { dispatch } = this.props\n  dispatch({\n    type: \x27namespace\/sagas\x27, \/\/这里的type规范为model里面定义的namespace和effects下面定义的sagas或者    \n    payload: {               \/\/ reducers,这样就能实现自动调用这些函数\n      ...\n    }\n  })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  ...\n  const { dispatch } = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props\n  dispatch({\n    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27namespace\/sagas\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/这里的type规范为model里面定义的namespace和effects下面定义的sagas或者    \x3c\/span\x3e\n    payload: {               \x3cspan class=\x22hljs-comment\x22\x3e\/\/ reducers,这样就能实现自动调用这些函数\x3c\/span\x3e\n      ...\n    }\n  })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e注意，\x3c\/strong\x3edispatch用来更新state某个数据后，下一步从state拿到的这个数据并不是更新后的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22...\n  const { dispatch, data } = this.props\n  dispatch({\n    type: \x27namespace\/sagas\x27, \/\/这里的type规范为model里面定义的namespace和effects下面定义的sagas或者    \n    payload: {               \/\/ reducers,这样就能实现自动调用这些函数\n      data      \/\/这里想更新data\n    }\n  })\n  console.log(data) \/\/ 仍然是之前的数据，并不是dispatch更新后的数据\n                      \/\/ 因为dispatch是异步的，如同React的setState后面打印state\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e...\n  const { dispatch, data } = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props\n  dispatch({\n    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27namespace\/sagas\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/这里的type规范为model里面定义的namespace和effects下面定义的sagas或者    \x3c\/span\x3e\n    payload: {               \x3cspan class=\x22hljs-comment\x22\x3e\/\/ reducers,这样就能实现自动调用这些函数\x3c\/span\x3e\n      data      \x3cspan class=\x22hljs-comment\x22\x3e\/\/这里想更新data\x3c\/span\x3e\n    }\n  })\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 仍然是之前的数据，并不是dispatch更新后的数据\x3c\/span\x3e\n                      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 因为dispatch是异步的，如同React的setState后面打印state\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e此外，由于不用层层传递action creator，\x3ccode\x3emapDispatchToProps\x3c\/code\x3e就不用再写了，组件之间的耦合度也降低了，或者说根本没有关系了，dva使组件之间的关系变得更加扁平化,没有什么父子、兄弟关系，这样组件就具有很高的可重用性。所有需要在组件里通信的数据都要放在state中，然后connect组件，只拿到组件关心的数据，就像这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class App extends Component {\n  ...\n}\n \nfunction mapStateToProps(state) {\n  const {\n    data\n  } = state.user;  \/\/ user 对应namespace\n  const loading = state.loading.effects[\x27user\/fetch\x27];\n  return {\n    data,\n    loading\n  };\n}\nexport default connect(mapStateToProps)(User);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  ...\n}\n \n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emapStateToProps\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estate\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {\n    data\n  } = state.user;  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ user 对应namespace\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e loading = state.loading.effects[\x3cspan class=\x22hljs-string\x22\x3e\x27user\/fetch\x27\x3c\/span\x3e];\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    data,\n    loading\n  };\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e connect(mapStateToProps)(User);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样写，除了具有很高的重用性，也避免了父组件更新，子组件也会随之更新的缺点了！只要这个组件关心的数据没变，它就不会重新渲染，省掉了重写shouldComponentUpdate来提高性能，逻辑也变得清晰、简单起来！\x3c\/p\x3e\n\x3cp\x3e另外，model下有个\x3ccode\x3esubscriptions\x3c\/code\x3e用于订阅一个数据源，可以在这里面监听路由变化，比如当路由跳转到本页面时，发起请求来获取初始数据：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22subscriptions: {\n    setup: ({ history, dispatch }) =\x3e history.listen(({ pathname, query }) =\x3e {\n      if (pathname === \x27\/user\x27) {\n        dispatch({\n          type: \x27fetch\x27,\n          payload: {\n            query\n          }\n        });\n      }\n    }),\n  },\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3esubscriptions: {\n    \x3cspan class=\x22hljs-attr\x22\x3esetup\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ history, dispatch }\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e history.listen(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ pathname, query }\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (pathname === \x3cspan class=\x22hljs-string\x22\x3e\x27\/user\x27\x3c\/span\x3e) {\n        dispatch({\n          \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27fetch\x27\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: {\n            query\n          }\n        });\n      }\n    }),\n  },\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e问题\x3c\/h3\x3e\n\x3cp\x3e使用没多久，了解较浅，暂时没发现什么问题\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e总结\x3c\/h3\x3e\n\x3cp\x3edva框架封装了Redux 架构一些繁琐、复杂的步骤和常用库，使用dva，不会构建Redux架构也可以，dva帮你做好了;\x3c\/p\x3e\n\x3cp\x3edva 降低了组件之间的耦合度，没有父子、兄弟组件的关系，提高了组件可重用性以及渲染性能，使思路变得简单清晰；\x3c\/p\x3e\n\x3cp\x3edva架构思路清晰，代码书写方式固定，有利于团队合作，但可扩展性不强\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>dva值得一试</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011523348">https://segmentfault.com/a/1190000011523348</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/6klc5egm705/" target="_blank">https://alili.tech/archive/6klc5egm705/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>