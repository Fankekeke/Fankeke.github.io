<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="webpack详解"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>webpack详解 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/73362992/",
				"appid": "1613049289050283", 
				"title": "webpack详解 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-10-23T00:00:00"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/cb6887ef/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/9f9a7b3c/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f73362992%2f&text=webpack%e8%af%a6%e8%a7%a3"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f73362992%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f73362992%2f&text=webpack%e8%af%a6%e8%a7%a3"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f73362992%2f&title=webpack%e8%af%a6%e8%a7%a3"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f73362992%2f&is_video=false&description=webpack%e8%af%a6%e8%a7%a3"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=webpack%e8%af%a6%e8%a7%a3&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f73362992%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f73362992%2f&title=webpack%e8%af%a6%e8%a7%a3"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f73362992%2f&title=webpack%e8%af%a6%e8%a7%a3"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f73362992%2f&title=webpack%e8%af%a6%e8%a7%a3"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f73362992%2f&title=webpack%e8%af%a6%e8%a7%a3"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文链接">原文链接</a></li><li><a href="#原文标题">原文标题</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">webpack详解</h1><div class="meta"><div class="postdate"><time datetime="2018-10-23" itemprop="datePublished">2018-10-23</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3ewebpack是现代前端开发中最火的模块打包工具，只需要通过简单的配置，便可以完成模块的加载和打包。那它是怎么做到通过对一些插件的配置，便可以轻松实现对代码的构建呢？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3ewebpack的配置\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const path = require(\x27path\x27);\nmodule.exports = {\n  entry: \x26quot;.\/app\/entry\x26quot;, \/\/ string | object | array\n  \/\/ Webpack打包的入口\n  output: {  \/\/ 定义webpack如何输出的选项\n    path: path.resolve(__dirname, \x26quot;dist\x26quot;), \/\/ string\n    \/\/ 所有输出文件的目标路径\n    filename: \x26quot;[chunkhash].js\x26quot;, \/\/ string\n    \/\/ 「入口(entry chunk)」文件命名模版\n    publicPath: \x26quot;\/assets\/\x26quot;, \/\/ string\n    \/\/ 构建文件的输出目录\n    \/* 其它高级配置 *\/\n  },\n  module: {  \/\/ 模块相关配置\n    rules: [ \/\/ 配置模块loaders，解析规则\n      {\n        test: \/\\.jsx?$\/,  \/\/ RegExp | string\n        include: [ \/\/ 和test一样，必须匹配选项\n          path.resolve(__dirname, \x26quot;app\x26quot;)\n        ],\n        exclude: [ \/\/ 必不匹配选项（优先级高于test和include）\n          path.resolve(__dirname, \x26quot;app\/demo-files\x26quot;)\n        ],\n        loader: \x26quot;babel-loader\x26quot;, \/\/ 模块上下文解析\n        options: { \/\/ loader的可选项\n          presets: [\x26quot;es2015\x26quot;]\n        },\n      },\n  },\n  resolve: { \/\/  解析模块的可选项\n    modules: [ \/\/ 模块的查找目录\n      \x26quot;node_modules\x26quot;,\n      path.resolve(__dirname, \x26quot;app\x26quot;)\n    ],\n    extensions: [\x26quot;.js\x26quot;, \x26quot;.json\x26quot;, \x26quot;.jsx\x26quot;, \x26quot;.css\x26quot;], \/\/ 用到的文件的扩展\n    alias: { \/\/ 模块别名列表\n      \x26quot;module\x26quot;: \x26quot;new-module\x26quot;\n      },\n  },\n  devtool: \x26quot;source-map\x26quot;, \/\/ enum\n  \/\/ 为浏览器开发者工具添加元数据增强调试\n  plugins: [ \/\/ 附加插件列表\n    \/\/ ...\n  ],\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e path = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27path\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n  \x3cspan class=\x22hljs-attr\x22\x3eentry\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22.\/app\/entry\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ string | object | array\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Webpack打包的入口\x3c\/span\x3e\n  output: {  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 定义webpack如何输出的选项\x3c\/span\x3e\n    path: path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x22dist\x22\x3c\/span\x3e), \x3cspan class=\x22hljs-comment\x22\x3e\/\/ string\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所有输出文件的目标路径\x3c\/span\x3e\n    filename: \x3cspan class=\x22hljs-string\x22\x3e\x22[chunkhash].js\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ string\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 「入口(entry chunk)」文件命名模版\x3c\/span\x3e\n    publicPath: \x3cspan class=\x22hljs-string\x22\x3e\x22\/assets\/\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ string\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 构建文件的输出目录\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/* 其它高级配置 *\/\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3emodule\x3c\/span\x3e: {  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模块相关配置\x3c\/span\x3e\n    rules: [ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 配置模块loaders，解析规则\x3c\/span\x3e\n      {\n        \x3cspan class=\x22hljs-attr\x22\x3etest\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.jsx?$\/\x3c\/span\x3e,  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ RegExp | string\x3c\/span\x3e\n        include: [ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 和test一样，必须匹配选项\x3c\/span\x3e\n          path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x22app\x22\x3c\/span\x3e)\n        ],\n        \x3cspan class=\x22hljs-attr\x22\x3eexclude\x3c\/span\x3e: [ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 必不匹配选项（优先级高于test和include）\x3c\/span\x3e\n          path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x22app\/demo-files\x22\x3c\/span\x3e)\n        ],\n        \x3cspan class=\x22hljs-attr\x22\x3eloader\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22babel-loader\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模块上下文解析\x3c\/span\x3e\n        options: { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ loader的可选项\x3c\/span\x3e\n          presets: [\x3cspan class=\x22hljs-string\x22\x3e\x22es2015\x22\x3c\/span\x3e]\n        },\n      },\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eresolve\x3c\/span\x3e: { \x3cspan class=\x22hljs-comment\x22\x3e\/\/  解析模块的可选项\x3c\/span\x3e\n    modules: [ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模块的查找目录\x3c\/span\x3e\n      \x3cspan class=\x22hljs-string\x22\x3e\x22node_modules\x22\x3c\/span\x3e,\n      path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x22app\x22\x3c\/span\x3e)\n    ],\n    \x3cspan class=\x22hljs-attr\x22\x3eextensions\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22.js\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22.json\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22.jsx\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22.css\x22\x3c\/span\x3e], \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用到的文件的扩展\x3c\/span\x3e\n    alias: { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模块别名列表\x3c\/span\x3e\n      \x3cspan class=\x22hljs-string\x22\x3e\x22module\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22new-module\x22\x3c\/span\x3e\n      },\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3edevtool\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22source-map\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ enum\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 为浏览器开发者工具添加元数据增强调试\x3c\/span\x3e\n  plugins: [ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 附加插件列表\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n  ],\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从上面我们可以看到，webpack配置中需要理解几个核心的概念\x3ccode\x3eEntry\x3c\/code\x3e 、\x3ccode\x3eOutput\x3c\/code\x3e、\x3ccode\x3eLoaders\x3c\/code\x3e 、\x3ccode\x3ePlugins\x3c\/code\x3e、 \x3ccode\x3eChunk\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eEntry：指定webpack开始构建的入口模块，从该模块开始构建并计算出直接或间接依赖的模块或者库\x3c\/li\x3e\n\x3cli\x3eOutput：告诉webpack如何命名输出的文件以及输出的目录\x3c\/li\x3e\n\x3cli\x3eLoaders：由于webpack只能处理javascript，所以我们需要对一些非js文件处理成webpack能够处理的模块，比如sass文件\x3c\/li\x3e\n\x3cli\x3ePlugins：\x3ccode\x3eLoaders\x3c\/code\x3e将各类型的文件处理成webpack能够处理的模块，\x3ccode\x3eplugins\x3c\/code\x3e有着很强的能力。插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。但也是最复杂的一个。比如对js文件进行压缩优化的\x3ccode\x3eUglifyJsPlugin\x3c\/code\x3e插件\x3c\/li\x3e\n\x3cli\x3eChunk：coding split的产物，我们可以对一些代码打包成一个单独的chunk，比如某些公共模块，去重，更好的利用缓存。或者按需加载某些功能模块，优化加载时间。在webpack3及以前我们都利用\x3ccode\x3eCommonsChunkPlugin\x3c\/code\x3e将一些公共代码分割成一个chunk，实现单独加载。在webpack4 中\x3ccode\x3eCommonsChunkPlugin\x3c\/code\x3e被废弃，使用\x3ccode\x3eSplitChunksPlugin\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3ewebpack详解\x3c\/h3\x3e\n\x3cp\x3e读到这里，或许你对webpack有一个大概的了解，那webpack 是怎么运行的呢？我们都知道，webpack是高度复杂抽象的插件集合，理解webpack的运行机制，对于我们日常定位构建错误以及写一些插件处理构建任务有很大的帮助。\x3c\/p\x3e\n\x3ch4\x3e不得不说的tapable\x3c\/h4\x3e\n\x3cp\x3ewebpack本质上是一种事件流的机制，它的工作流程就是将各个插件串联起来，而实现这一切的核心就是\x3ca href=\x22https:\/\/github.com\/webpack\/tapable\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTapable\x3c\/a\x3e，webpack中最核心的负责编译的\x3ccode\x3eCompiler\x3c\/code\x3e和负责创建bundles的\x3ccode\x3eCompilation\x3c\/code\x3e都是Tapable的实例。在Tapable1.0之前，也就是webpack3及其以前使用的Tapable，提供了包括\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3eplugin(name:string, handler:function)\x3c\/code\x3e注册插件到Tapable对象中\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eapply(…pluginInstances: (AnyPlugin|function)[])\x3c\/code\x3e调用插件的定义，将事件监听器注册到Tapable实例注册表中\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eapplyPlugins*(name:string, …)\x3c\/code\x3e多种策略细致地控制事件的触发，包括\x3ccode\x3eapplyPluginsAsync\x3c\/code\x3e、\x3ccode\x3eapplyPluginsParallel\x3c\/code\x3e等方法实现对事件触发的控制，实现\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e（1）多个事件连续顺序执行\x3cbr\x3e（2）并行执行\x3cbr\x3e（3）异步执行\x3cbr\x3e（4）一个接一个地执行插件，前面的输出是后一个插件的输入的瀑布流执行顺序\x3cbr\x3e（5）在允许时停止执行插件，即某个插件返回了一个\x3ccode\x3eundefined\x3c\/code\x3e的值，即退出执行\x3cbr\x3e我们可以看到，Tapable就像nodejs中\x3ccode\x3eEventEmitter\x3c\/code\x3e,提供对事件的注册\x3ccode\x3eon\x3c\/code\x3e和触发\x3ccode\x3eemit\x3c\/code\x3e,理解它很重要，看个栗子：比如我们来写一个插件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function CustomPlugin() {}\nCustomPlugin.prototype.apply = function(compiler) {\n  compiler.plugin(\x27emit\x27, pluginFunction);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eCustomPlugin\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{}\nCustomPlugin.prototype.apply = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecompiler\x3c\/span\x3e) \x3c\/span\x3e{\n  compiler.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x27emit\x27\x3c\/span\x3e, pluginFunction);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在webpack的生命周期中会适时的执行\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.apply*(\x26quot;emit\x26quot;,options)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.apply*(\x3cspan class=\x22hljs-string\x22\x3e\x22emit\x22\x3c\/span\x3e,options)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当然上面提到的Tapable都是1.0版本之前的，如果想深入学习，可以查看\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000008060440\x22\x3eTapable 和 事件流\x3c\/a\x3e\x3cbr\x3e那1.0的Tapable又是什么样的呢？1.0版本发生了巨大的改变，不再是此前的通过\x3ccode\x3eplugin\x3c\/code\x3e注册事件，通过\x3ccode\x3eapplyPlugins*\x3c\/code\x3e触发事件调用，那1.0的Tapable是什么呢？\x3c\/p\x3e\n\x3cblockquote\x3e暴露出很多的钩子，可以使用它们为插件创建钩子函数\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const {\n    SyncHook,\n    SyncBailHook,\n    SyncWaterfallHook,\n    SyncLoopHook,\n    AsyncParallelHook,\n    AsyncParallelBailHook,\n    AsyncSeriesHook,\n    AsyncSeriesBailHook,\n    AsyncSeriesWaterfallHook\n } = require(\x26quot;tapable\x26quot;);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {\n    SyncHook,\n    SyncBailHook,\n    SyncWaterfallHook,\n    SyncLoopHook,\n    AsyncParallelHook,\n    AsyncParallelBailHook,\n    AsyncSeriesHook,\n    AsyncSeriesBailHook,\n    AsyncSeriesWaterfallHook\n } = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22tapable\x22\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们来看看 怎么使用。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class Order {\n    constructor() {\n        this.hooks = { \/\/hooks\n            goods: new SyncHook([\x27goodsId\x27, \x27number\x27]),\n            consumer: new AsyncParallelHook([\x27userId\x27, \x27orderId\x27])\n        }\n    }\n\n    queryGoods(goodsId, number) {\n        this.hooks.goods.call(goodsId, number);\n    }\n\n    consumerInfoPromise(userId, orderId) {\n        this.hooks.consumer.promise(userId, orderId).then(() =\x3e {\n            \/\/TODO\n        })\n    }\n\n    consumerInfoAsync(userId, orderId) {\n        this.hooks.consumer.callAsync(userId, orderId, (err, data) =\x3e {\n            \/\/TODO\n        })\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eOrder\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e() {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks = { \x3cspan class=\x22hljs-comment\x22\x3e\/\/hooks\x3c\/span\x3e\n            goods: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e SyncHook([\x3cspan class=\x22hljs-string\x22\x3e\x27goodsId\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27number\x27\x3c\/span\x3e]),\n            \x3cspan class=\x22hljs-attr\x22\x3econsumer\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AsyncParallelHook([\x3cspan class=\x22hljs-string\x22\x3e\x27userId\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27orderId\x27\x3c\/span\x3e])\n        }\n    }\n\n    queryGoods(goodsId, number) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.goods.call(goodsId, number);\n    }\n\n    consumerInfoPromise(userId, orderId) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.consumer.promise(userId, orderId).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/TODO\x3c\/span\x3e\n        })\n    }\n\n    consumerInfoAsync(userId, orderId) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.consumer.callAsync(userId, orderId, (err, data) =\x26gt; {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/TODO\x3c\/span\x3e\n        })\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于所有的hook的构造函数均接受一个可选的string类型的数组\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const hook = new SyncHook([\x26quot;arg1\x26quot;, \x26quot;arg2\x26quot;, \x26quot;arg3\x26quot;]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hook = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e SyncHook([\x3cspan class=\x22hljs-string\x22\x3e\x22arg1\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22arg2\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22arg3\x22\x3c\/span\x3e]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 调用tap方法注册一个consument\norder.hooks.goods.tap(\x27QueryPlugin\x27, (goodsId, number) =\x3e {\n    return fetchGoods(goodsId, number);\n})\n\/\/ 再添加一个\norder.hooks.goods.tap(\x27LoggerPlugin\x27, (goodsId, number) =\x3e {\n    logger(goodsId, number);\n})\n\n\/\/ 调用\norder.queryGoods(\x2710000000\x27, 1)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用tap方法注册一个consument\x3c\/span\x3e\norder.hooks.goods.tap(\x3cspan class=\x22hljs-string\x22\x3e\x27QueryPlugin\x27\x3c\/span\x3e, (goodsId, number) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fetchGoods(goodsId, number);\n})\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 再添加一个\x3c\/span\x3e\norder.hooks.goods.tap(\x3cspan class=\x22hljs-string\x22\x3e\x27LoggerPlugin\x27\x3c\/span\x3e, (goodsId, number) =\x26gt; {\n    logger(goodsId, number);\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用\x3c\/span\x3e\norder.queryGoods(\x3cspan class=\x22hljs-string\x22\x3e\x2710000000\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于一个 \x3ccode\x3eSyncHook\x3c\/code\x3e,我们通过\x3ccode\x3etap\x3c\/code\x3e来添加消费者，通过\x3ccode\x3ecall\x3c\/code\x3e来触发钩子的顺序执行。\x3c\/p\x3e\n\x3cp\x3e对于一个非\x3ccode\x3esync*\x3c\/code\x3e类型的钩子，即\x3ccode\x3easync*\x3c\/code\x3e类型的钩子，我们还可以通过其它方式注册消费者和调用\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 注册一个sync 钩子\norder.hooks.consumer.tap(\x27LoggerPlugin\x27, (userId, orderId) =\x3e {\n   logger(userId, orderId);\n})\n\norder.hooks.consumer.tapAsync(\x27LoginCheckPlugin\x27, (userId, orderId, callback) =\x3e {\n    LoginCheck(userId, callback);\n})\n\norder.hooks.consumer.tapPromise(\x27PayPlugin\x27, (userId, orderId) =\x3e {\n    return Promise.resolve();\n})\n\n\/\/ 调用\n\/\/ 返回Promise\norder.consumerInfoPromise(\x27user007\x27, \x271024\x27);\n\n\/\/回调函数\norder.consumerInfoAsync(\x27user007\x27, \x271024\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注册一个sync 钩子\x3c\/span\x3e\norder.hooks.consumer.tap(\x3cspan class=\x22hljs-string\x22\x3e\x27LoggerPlugin\x27\x3c\/span\x3e, (userId, orderId) =\x26gt; {\n   logger(userId, orderId);\n})\n\norder.hooks.consumer.tapAsync(\x3cspan class=\x22hljs-string\x22\x3e\x27LoginCheckPlugin\x27\x3c\/span\x3e, (userId, orderId, callback) =\x26gt; {\n    LoginCheck(userId, callback);\n})\n\norder.hooks.consumer.tapPromise(\x3cspan class=\x22hljs-string\x22\x3e\x27PayPlugin\x27\x3c\/span\x3e, (userId, orderId) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve();\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回Promise\x3c\/span\x3e\norder.consumerInfoPromise(\x3cspan class=\x22hljs-string\x22\x3e\x27user007\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x271024\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/回调函数\x3c\/span\x3e\norder.consumerInfoAsync(\x3cspan class=\x22hljs-string\x22\x3e\x27user007\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x271024\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过上面的栗子，你可能已经大致了解了\x3ccode\x3eTapable\x3c\/code\x3e的用法，它的用法\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e插件注册数量\x3c\/li\x3e\n\x3cli\x3e插件注册的类型（sync, async, promise）\x3c\/li\x3e\n\x3cli\x3e调用的方式（sync, async, promise）\x3c\/li\x3e\n\x3cli\x3e实例钩子的时候参数数量\x3c\/li\x3e\n\x3cli\x3e是否使用了\x3ccode\x3einterception\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3eTapable详解\x3c\/h4\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013657047\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013657047\x22 alt=\x22Alt text\x22 title=\x22Alt text\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e对于\x3ccode\x3eSync*\x3c\/code\x3e类型的钩子来说。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e注册在该钩子下面的插件的执行顺序都是顺序执行。\x3c\/li\x3e\n\x3cli\x3e只能使用\x3ccode\x3etap\x3c\/code\x3e注册，不能使用\x3ccode\x3etapPromise\x3c\/code\x3e和\x3ccode\x3etapAsync\x3c\/code\x3e注册\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 所有的钩子都继承于Hook\nclass Sync* extends Hook { \n    tapAsync() { \/\/ Sync*类型的钩子不支持tapAsync\n        throw new Error(\x26quot;tapAsync is not supported on a Sync*\x26quot;);\n    }\n    tapPromise() {\/\/ Sync*类型的钩子不支持tapPromise\n        throw new Error(\x26quot;tapPromise is not supported on a Sync*\x26quot;);\n    }\n    compile(options) { \/\/ 编译代码来按照一定的策略执行Plugin\n        factory.setup(this, options);\n        return factory.create(options);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所有的钩子都继承于Hook\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSync\x3c\/span\x3e* \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHook\x3c\/span\x3e \x3c\/span\x3e{ \n    tapAsync() { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Sync*类型的钩子不支持tapAsync\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22tapAsync is not supported on a Sync*\x22\x3c\/span\x3e);\n    }\n    tapPromise() {\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Sync*类型的钩子不支持tapPromise\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22tapPromise is not supported on a Sync*\x22\x3c\/span\x3e);\n    }\n    compile(options) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 编译代码来按照一定的策略执行Plugin\x3c\/span\x3e\n        factory.setup(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, options);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e factory.create(options);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于\x3ccode\x3eAsync*\x3c\/code\x3e类型钩子\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e支持\x3ccode\x3etap\x3c\/code\x3e、\x3ccode\x3etapPromise\x3c\/code\x3e、\x3ccode\x3etapAsync\x3c\/code\x3e注册\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class AsyncParallelHook extends Hook {\n    constructor(args) {\n        super(args);\n        this.call = this._call = undefined;\n    }\n\n    compile(options) {\n        factory.setup(this, options);\n        return factory.create(options);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eAsyncParallelHook\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHook\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(args) {\n        \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(args);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.call = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._call = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e;\n    }\n\n    compile(options) {\n        factory.setup(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, options);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e factory.create(options);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class Hook {\n    constructor(args) {\n        if(!Array.isArray(args)) args = [];\n        this._args = args; \/\/ 实例钩子的时候的string类型的数组\n        this.taps = []; \/\/ 消费者\n        this.interceptors = []; \/\/ interceptors\n        this.call = this._call =  \/\/ 以sync类型方式来调用钩子\n        this._createCompileDelegate(\x26quot;call\x26quot;, \x26quot;sync\x26quot;);\n        this.promise = \n        this._promise = \/\/ 以promise方式\n        this._createCompileDelegate(\x26quot;promise\x26quot;, \x26quot;promise\x26quot;);\n        this.callAsync = \n        this._callAsync = \/\/ 以async类型方式来调用\n        this._createCompileDelegate(\x26quot;callAsync\x26quot;, \x26quot;async\x26quot;);\n        this._x = undefined; \/\/ \n    }\n\n    _createCall(type) {\n        return this.compile({\n            taps: this.taps,\n            interceptors: this.interceptors,\n            args: this._args,\n            type: type\n        });\n    }\n\n    _createCompileDelegate(name, type) {\n        const lazyCompileHook = (...args) =\x3e {\n            this[name] = this._createCall(type);\n            return this[name](...args);\n        };\n        return lazyCompileHook;\n    }\n    \/\/ 调用tap 类型注册\n    tap(options, fn) {\n        \/\/ ...\n        options = Object.assign({ type: \x26quot;sync\x26quot;, fn: fn }, options);\n        \/\/ ...\n        this._insert(options);  \/\/ 添加到 this.taps中\n    }\n    \/\/ 注册 async类型的钩子\n    tapAsync(options, fn) {\n        \/\/ ...\n        options = Object.assign({ type: \x26quot;async\x26quot;, fn: fn }, options);\n        \/\/ ...\n        this._insert(options); \/\/ 添加到 this.taps中\n    }\n    注册 promise类型钩子\n    tapPromise(options, fn) {\n        \/\/ ...\n        options = Object.assign({ type: \x26quot;promise\x26quot;, fn: fn }, options);\n        \/\/ ...\n        this._insert(options); \/\/ 添加到 this.taps中\n    }\n    \n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHook\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(args) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!\x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.isArray(args)) args = [];\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._args = args; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实例钩子的时候的string类型的数组\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.taps = []; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 消费者\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.interceptors = []; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ interceptors\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.call = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._call =  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 以sync类型方式来调用钩子\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._createCompileDelegate(\x3cspan class=\x22hljs-string\x22\x3e\x22call\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22sync\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.promise = \n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._promise = \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 以promise方式\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._createCompileDelegate(\x3cspan class=\x22hljs-string\x22\x3e\x22promise\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22promise\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.callAsync = \n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._callAsync = \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 以async类型方式来调用\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._createCompileDelegate(\x3cspan class=\x22hljs-string\x22\x3e\x22callAsync\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22async\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._x = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x3c\/span\x3e\n    }\n\n    _createCall(type) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.compile({\n            \x3cspan class=\x22hljs-attr\x22\x3etaps\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.taps,\n            \x3cspan class=\x22hljs-attr\x22\x3einterceptors\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.interceptors,\n            \x3cspan class=\x22hljs-attr\x22\x3eargs\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._args,\n            \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: type\n        });\n    }\n\n    _createCompileDelegate(name, type) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e lazyCompileHook = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e...args\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e[name] = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._createCall(type);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e[name](...args);\n        };\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e lazyCompileHook;\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用tap 类型注册\x3c\/span\x3e\n    tap(options, fn) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        options = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22sync\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3efn\x3c\/span\x3e: fn }, options);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._insert(options);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加到 this.taps中\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注册 async类型的钩子\x3c\/span\x3e\n    tapAsync(options, fn) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        options = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22async\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3efn\x3c\/span\x3e: fn }, options);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._insert(options); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加到 this.taps中\x3c\/span\x3e\n    }\n    注册 promise类型钩子\n    tapPromise(options, fn) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        options = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22promise\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3efn\x3c\/span\x3e: fn }, options);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._insert(options); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加到 this.taps中\x3c\/span\x3e\n    }\n    \n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e每次都是调用\x3ccode\x3etap\x3c\/code\x3e、\x3ccode\x3etapSync\x3c\/code\x3e、\x3ccode\x3etapPromise\x3c\/code\x3e注册不同类型的插件钩子，通过调用\x3ccode\x3ecall\x3c\/code\x3e、\x3ccode\x3ecallAsync\x3c\/code\x3e 、\x3ccode\x3epromise\x3c\/code\x3e方式调用。其实调用的时候为了按照一定的执行策略执行，调用\x3ccode\x3ecompile\x3c\/code\x3e方法快速编译出一个方法来执行这些插件。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const factory = new Sync*CodeFactory();\nclass Sync* extends Hook { \n    \/\/ ...\n    compile(options) { \/\/ 编译代码来按照一定的策略执行Plugin\n        factory.setup(this, options);\n        return factory.create(options);\n    }\n}\n\nclass Sync*CodeFactory extends HookCodeFactory {\n    content({ onError, onResult, onDone, rethrowIfPossible }) {\n        return this.callTapsSeries({\n            onError: (i, err) =\x3e onError(err),\n            onDone,\n            rethrowIfPossible\n        });\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e factory = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Sync*CodeFactory();\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSync\x3c\/span\x3e* \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHook\x3c\/span\x3e \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    compile(options) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 编译代码来按照一定的策略执行Plugin\x3c\/span\x3e\n        factory.setup(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, options);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e factory.create(options);\n    }\n}\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSync\x3c\/span\x3e*\x3cspan class=\x22hljs-title\x22\x3eCodeFactory\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHookCodeFactory\x3c\/span\x3e \x3c\/span\x3e{\n    content({ onError, onResult, onDone, rethrowIfPossible }) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.callTapsSeries({\n            \x3cspan class=\x22hljs-attr\x22\x3eonError\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ei, err\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e onError(err),\n            onDone,\n            rethrowIfPossible\n        });\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ecompile\x3c\/code\x3e中调用\x3ccode\x3eHookCodeFactory#create\x3c\/code\x3e方法编译生成执行代码。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nclass HookCodeFactory {\n    constructor(config) {\n        this.config = config;\n        this.options = undefined;\n    }\n\n    create(options) {\n        this.init(options);\n        switch(this.options.type) {\n            case \x26quot;sync\x26quot;:  \/\/ 编译生成sync, 结果直接返回\n                return new Function(this.args(), \n                \x26quot;\\\x26quot;use strict\\\x26quot;;\\n\x26quot; \x2b this.header() \x2b this.content({\n                    \/\/ ...\n                    onResult: result =\x3e `return ${result};\\n`,\n                    \/\/ ...\n                }));\n            case \x26quot;async\x26quot;: \/\/ async类型, 异步执行，最后将调用插件执行结果来调用callback,\n                return new Function(this.args({\n                    after: \x26quot;_callback\x26quot;\n                }), \x26quot;\\\x26quot;use strict\\\x26quot;;\\n\x26quot; \x2b this.header() \x2b this.content({\n                    \/\/ ...\n                    onResult: result =\x3e `_callback(null, ${result});\\n`,\n                    onDone: () =\x3e \x26quot;_callback();\\n\x26quot;\n                }));\n            case \x26quot;promise\x26quot;: \/\/ 返回promise类型，将结果放在resolve中\n                \/\/ ...\n                code \x2b= \x26quot;return new Promise((_resolve, _reject) =\x3e {\\n\x26quot;;\n                code \x2b= \x26quot;var _sync = true;\\n\x26quot;;\n                code \x2b= this.header();\n                code \x2b= this.content({\n                    \/\/ ...\n                    onResult: result =\x3e `_resolve(${result});\\n`,\n                    onDone: () =\x3e \x26quot;_resolve();\\n\x26quot;\n                });\n                \/\/ ...\n                return new Function(this.args(), code);\n        }\n    }\n    \/\/ callTap 就是执行一些插件，并将结果返回\n    callTap(tapIndex, { onError, onResult, onDone, rethrowIfPossible }) {\n        let code = \x26quot;\x26quot;;\n        let hasTapCached = false;\n        \/\/ ...\n        code \x2b= `var _fn${tapIndex} = ${this.getTapFn(tapIndex)};\\n`;\n        const tap = this.options.taps[tapIndex];\n        switch(tap.type) {\n            case \x26quot;sync\x26quot;:\n                \/\/ ...\n                if(onResult) {\n                    code \x2b= `var _result${tapIndex} = _fn${tapIndex}(${this.args({\n                        before: tap.context ? \x26quot;_context\x26quot; : undefined\n                    })});\\n`;\n                } else {\n                    code \x2b= `_fn${tapIndex}(${this.args({\n                        before: tap.context ? \x26quot;_context\x26quot; : undefined\n                    })});\\n`;\n                }\n                \n                if(onResult) { \/\/ 结果透传\n                    code \x2b= onResult(`_result${tapIndex}`);\n                }\n                if(onDone) { \/\/ 通知插件执行完毕，可以执行下一个插件\n                    code \x2b= onDone();\n                }\n                break;\n            case \x26quot;async\x26quot;: \/\/异步执行，插件运行完后再将结果通过执行callback透传\n                let cbCode = \x26quot;\x26quot;;\n                if(onResult)\n                    cbCode \x2b= `(_err${tapIndex}, _result${tapIndex}) =\x3e {\\n`;\n                else\n                    cbCode \x2b= `_err${tapIndex} =\x3e {\\n`;\n                cbCode \x2b= `if(_err${tapIndex}) {\\n`;\n                cbCode \x2b= onError(`_err${tapIndex}`);\n                cbCode \x2b= \x26quot;} else {\\n\x26quot;;\n                if(onResult) {\n                    cbCode \x2b= onResult(`_result${tapIndex}`);\n                }\n                \n                cbCode \x2b= \x26quot;}\\n\x26quot;;\n                cbCode \x2b= \x26quot;}\x26quot;;\n                code \x2b= `_fn${tapIndex}(${this.args({\n                    before: tap.context ? \x26quot;_context\x26quot; : undefined,\n                    after: cbCode \/\/cbCode将结果透传\n                })});\\n`;\n                break;\n            case \x26quot;promise\x26quot;: \/\/ _fn${tapIndex} 就是第tapIndex 个插件，它必须是个Promise类型的插件\n                code \x2b= `var _hasResult${tapIndex} = false;\\n`;\n                code \x2b= `_fn${tapIndex}(${this.args({\n                    before: tap.context ? \x26quot;_context\x26quot; : undefined\n                })}).then(_result${tapIndex} =\x3e {\\n`;\n                code \x2b= `_hasResult${tapIndex} = true;\\n`;\n                if(onResult) {\n                    code \x2b= onResult(`_result${tapIndex}`);\n                }\n            \/\/ ...\n                break;\n        }\n        return code;\n    }\n    \/\/ 按照插件的注册顺序，按照顺序递归调用执行插件\n    callTapsSeries({ onError, onResult, onDone, rethrowIfPossible }) {\n        \/\/ ...\n        const firstAsync = this.options.taps.findIndex(t =\x3e t.type !== \x26quot;sync\x26quot;);\n        const next = i =\x3e {\n            \/\/ ...\n            const done = () =\x3e next(i \x2b 1);\n            \/\/ ...\n            return this.callTap(i, {\n                \/\/ ...\n                onResult: onResult \x26amp;\x26amp; ((result) =\x3e {\n                    return onResult(i, result, done, doneBreak);\n                }),\n                \/\/ ...\n            });\n        };\n        return next(0);\n    }\n\n    callTapsLooping({ onError, onDone, rethrowIfPossible }) {\n        \n        const syncOnly = this.options.taps.every(t =\x3e t.type === \x26quot;sync\x26quot;);\n        let code = \x26quot;\x26quot;;\n        if(!syncOnly) {\n            code \x2b= \x26quot;var _looper = () =\x3e {\\n\x26quot;;\n            code \x2b= \x26quot;var _loopAsync = false;\\n\x26quot;;\n        }\n        code \x2b= \x26quot;var _loop;\\n\x26quot;;\n        code \x2b= \x26quot;do {\\n\x26quot;;\n        code \x2b= \x26quot;_loop = false;\\n\x26quot;;\n        \/\/ ...\n        code \x2b= this.callTapsSeries({\n            \/\/ ...\n            onResult: (i, result, next, doneBreak) =\x3e { \/\/ 一旦某个插件返回不为undefined,  即一只调用某个插件执行，如果为undefined,开始调用下一个\n                let code = \x26quot;\x26quot;;\n                code \x2b= `if(${result} !== undefined) {\\n`;\n                code \x2b= \x26quot;_loop = true;\\n\x26quot;;\n                if(!syncOnly)\n                    code \x2b= \x26quot;if(_loopAsync) _looper();\\n\x26quot;;\n                code \x2b= doneBreak(true);\n                code \x2b= `} else {\\n`;\n                code \x2b= next();\n                code \x2b= `}\\n`;\n                return code;\n            },\n            \/\/ ...\n        })\n        code \x2b= \x26quot;} while(_loop);\\n\x26quot;;\n        \/\/ ...\n        return code;\n    }\n    \/\/ 并行调用插件执行\n    callTapsParallel({ onError, onResult, onDone, rethrowIfPossible, onTap = (i, run) =\x3e run() }) {\n        \/\/ ...\n        \/\/ 遍历注册都所有插件，并调用\n        for(let i = 0; i \x3c this.options.taps.length; i\x2b\x2b) {\n            \/\/ ...\n            code \x2b= \x26quot;if(_counter \x3c= 0) break;\\n\x26quot;;\n            code \x2b= onTap(i, () =\x3e this.callTap(i, {\n                \/\/ ...\n                onResult: onResult \x26amp;\x26amp; ((result) =\x3e {\n                    let code = \x26quot;\x26quot;;\n                    code \x2b= \x26quot;if(_counter \x3e 0) {\\n\x26quot;;\n                    code \x2b= onResult(i, result, done, doneBreak);\n                    code \x2b= \x26quot;}\\n\x26quot;;\n                    return code;\n                }),\n                \/\/ ...\n            }), done, doneBreak);\n        }\n        \/\/ ...\n        return code;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHookCodeFactory\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(config) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config = config;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.options = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e;\n    }\n\n    create(options) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.init(options);\n        \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.options.type) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22sync\x22\x3c\/span\x3e:  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 编译生成sync, 结果直接返回\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.args(), \n                \x3cspan class=\x22hljs-string\x22\x3e\x22\\\x22use strict\\\x22;\\n\x22\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.header() \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.content({\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                    onResult: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e`return \x3cspan class=\x22hljs-subst\x22\x3e${result}\x3c\/span\x3e;\\n`\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                }));\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22async\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async类型, 异步执行，最后将调用插件执行结果来调用callback,\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.args({\n                    \x3cspan class=\x22hljs-attr\x22\x3eafter\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22_callback\x22\x3c\/span\x3e\n                }), \x3cspan class=\x22hljs-string\x22\x3e\x22\\\x22use strict\\\x22;\\n\x22\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.header() \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.content({\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                    onResult: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e`_callback(null, \x3cspan class=\x22hljs-subst\x22\x3e${result}\x3c\/span\x3e);\\n`\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-attr\x22\x3eonDone\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22_callback();\\n\x22\x3c\/span\x3e\n                }));\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22promise\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回promise类型，将结果放在resolve中\x3c\/span\x3e\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22return new Promise((_resolve, _reject) =\x26gt; {\\n\x22\x3c\/span\x3e;\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22var _sync = true;\\n\x22\x3c\/span\x3e;\n                code \x2b= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.header();\n                code \x2b= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.content({\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                    onResult: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e`_resolve(\x3cspan class=\x22hljs-subst\x22\x3e${result}\x3c\/span\x3e);\\n`\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-attr\x22\x3eonDone\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22_resolve();\\n\x22\x3c\/span\x3e\n                });\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.args(), code);\n        }\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ callTap 就是执行一些插件，并将结果返回\x3c\/span\x3e\n    callTap(tapIndex, { onError, onResult, onDone, rethrowIfPossible }) {\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e code = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e hasTapCached = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`var _fn\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e = \x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getTapFn(tapIndex)}\x3c\/span\x3e;\\n`\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e tap = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.options.taps[tapIndex];\n        \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(tap.type) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22sync\x22\x3c\/span\x3e:\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(onResult) {\n                    code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`var _result\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e = _fn\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e(\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.args({\n                        before: tap.context ? \x3cspan class=\x22hljs-string\x22\x3e\x22_context\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n                    }\x3c\/span\x3e)});\\n`\x3c\/span\x3e;\n                } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                    code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`_fn\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e(\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.args({\n                        before: tap.context ? \x3cspan class=\x22hljs-string\x22\x3e\x22_context\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n                    }\x3c\/span\x3e)});\\n`\x3c\/span\x3e;\n                }\n                \n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(onResult) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 结果透传\x3c\/span\x3e\n                    code \x2b= onResult(\x3cspan class=\x22hljs-string\x22\x3e`_result\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e`\x3c\/span\x3e);\n                }\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(onDone) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通知插件执行完毕，可以执行下一个插件\x3c\/span\x3e\n                    code \x2b= onDone();\n                }\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22async\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-comment\x22\x3e\/\/异步执行，插件运行完后再将结果通过执行callback透传\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e cbCode = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(onResult)\n                    cbCode \x2b= \x3cspan class=\x22hljs-string\x22\x3e`(_err\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e, _result\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e) =\x26gt; {\\n`\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e\n                    cbCode \x2b= \x3cspan class=\x22hljs-string\x22\x3e`_err\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e =\x26gt; {\\n`\x3c\/span\x3e;\n                cbCode \x2b= \x3cspan class=\x22hljs-string\x22\x3e`if(_err\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e) {\\n`\x3c\/span\x3e;\n                cbCode \x2b= onError(\x3cspan class=\x22hljs-string\x22\x3e`_err\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e`\x3c\/span\x3e);\n                cbCode \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22} else {\\n\x22\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(onResult) {\n                    cbCode \x2b= onResult(\x3cspan class=\x22hljs-string\x22\x3e`_result\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e`\x3c\/span\x3e);\n                }\n                \n                cbCode \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22}\\n\x22\x3c\/span\x3e;\n                cbCode \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22}\x22\x3c\/span\x3e;\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`_fn\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e(\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.args({\n                    before: tap.context ? \x3cspan class=\x22hljs-string\x22\x3e\x22_context\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e,\n                    after: cbCode \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3ecbCode将结果透传\n                }\x3c\/span\x3e)});\\n`\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22promise\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-comment\x22\x3e\/\/ _fn${tapIndex} 就是第tapIndex 个插件，它必须是个Promise类型的插件\x3c\/span\x3e\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`var _hasResult\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e = false;\\n`\x3c\/span\x3e;\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`_fn\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e(\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.args({\n                    before: tap.context ? \x3cspan class=\x22hljs-string\x22\x3e\x22_context\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n                }\x3c\/span\x3e)}).then(_result\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e =\x26gt; {\\n`\x3c\/span\x3e;\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`_hasResult\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e = true;\\n`\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(onResult) {\n                    code \x2b= onResult(\x3cspan class=\x22hljs-string\x22\x3e`_result\x3cspan class=\x22hljs-subst\x22\x3e${tapIndex}\x3c\/span\x3e`\x3c\/span\x3e);\n                }\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e code;\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 按照插件的注册顺序，按照顺序递归调用执行插件\x3c\/span\x3e\n    callTapsSeries({ onError, onResult, onDone, rethrowIfPossible }) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e firstAsync = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.options.taps.findIndex(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3et\x3c\/span\x3e =\x26gt;\x3c\/span\x3e t.type !== \x3cspan class=\x22hljs-string\x22\x3e\x22sync\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e next = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ei\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e done = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e next(i \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.callTap(i, {\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                onResult: onResult \x26amp;\x26amp; \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e(result\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e onResult(i, result, done, doneBreak);\n                }),\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n            });\n        };\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n    }\n\n    callTapsLooping({ onError, onDone, rethrowIfPossible }) {\n        \n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e syncOnly = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.options.taps.every(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3et\x3c\/span\x3e =\x26gt;\x3c\/span\x3e t.type === \x3cspan class=\x22hljs-string\x22\x3e\x22sync\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e code = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!syncOnly) {\n            code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22var _looper = () =\x26gt; {\\n\x22\x3c\/span\x3e;\n            code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22var _loopAsync = false;\\n\x22\x3c\/span\x3e;\n        }\n        code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22var _loop;\\n\x22\x3c\/span\x3e;\n        code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22do {\\n\x22\x3c\/span\x3e;\n        code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22_loop = false;\\n\x22\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        code \x2b= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.callTapsSeries({\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n            onResult: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ei, result, next, doneBreak\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 一旦某个插件返回不为undefined,  即一只调用某个插件执行，如果为undefined,开始调用下一个\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e code = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`if(\x3cspan class=\x22hljs-subst\x22\x3e${result}\x3c\/span\x3e !== undefined) {\\n`\x3c\/span\x3e;\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22_loop = true;\\n\x22\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!syncOnly)\n                    code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22if(_loopAsync) _looper();\\n\x22\x3c\/span\x3e;\n                code \x2b= doneBreak(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`} else {\\n`\x3c\/span\x3e;\n                code \x2b= next();\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`}\\n`\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e code;\n            },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        })\n        code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22} while(_loop);\\n\x22\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e code;\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 并行调用插件执行\x3c\/span\x3e\n    callTapsParallel({ onError, onResult, onDone, rethrowIfPossible, onTap = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ei, run\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e run() }) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 遍历注册都所有插件，并调用\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.options.taps.length; i\x2b\x2b) {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n            code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22if(_counter \x26lt;= 0) break;\\n\x22\x3c\/span\x3e;\n            code \x2b= onTap(i, () =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.callTap(i, {\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                onResult: onResult \x26amp;\x26amp; \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e(result\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e code = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n                    code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22if(_counter \x26gt; 0) {\\n\x22\x3c\/span\x3e;\n                    code \x2b= onResult(i, result, done, doneBreak);\n                    code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22}\\n\x22\x3c\/span\x3e;\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e code;\n                }),\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n            }), done, doneBreak);\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e code;\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在\x3ccode\x3eHookCodeFactory#create\x3c\/code\x3e中调用到\x3ccode\x3econtent\x3c\/code\x3e方法，此方法将按照此钩子的执行策略，调用不同的方法来执行编译 生成最终的代码。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3eSyncHook中调用\x3ccode\x3ecallTapsSeries\x3c\/code\x3e编译生成最终执行插件的函数，\x3ccode\x3ecallTapsSeries\x3c\/code\x3e做的就是将插件列表中插件按照注册顺序遍历执行。\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class SyncHookCodeFactory extends HookCodeFactory {\n    content({ onError, onResult, onDone, rethrowIfPossible }) {\n        return this.callTapsSeries({\n            onError: (i, err) =\x3e onError(err),\n            onDone,\n            rethrowIfPossible\n        });\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSyncHookCodeFactory\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHookCodeFactory\x3c\/span\x3e \x3c\/span\x3e{\n    content({ onError, onResult, onDone, rethrowIfPossible }) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.callTapsSeries({\n            \x3cspan class=\x22hljs-attr\x22\x3eonError\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ei, err\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e onError(err),\n            onDone,\n            rethrowIfPossible\n        });\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3eSyncBailHook中当一旦某个返回值结果不为\x3ccode\x3eundefined\x3c\/code\x3e便结束执行列表中的插件\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 class SyncBailHookCodeFactory extends HookCodeFactory {\n    content({ onError, onResult, onDone, rethrowIfPossible }) {\n        return this.callTapsSeries({\n            \/\/ ...\n            onResult: (i, result, next) =\x3e `if(${result} !== undefined) {\\n${onResult(result)};\\n} else {\\n${next()}}\\n`,\n            \/\/ ...\n        });\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSyncBailHookCodeFactory\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHookCodeFactory\x3c\/span\x3e \x3c\/span\x3e{\n    content({ onError, onResult, onDone, rethrowIfPossible }) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.callTapsSeries({\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n            onResult: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ei, result, next\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e`if(\x3cspan class=\x22hljs-subst\x22\x3e${result}\x3c\/span\x3e !== undefined) {\\n\x3cspan class=\x22hljs-subst\x22\x3e${onResult(result)}\x3c\/span\x3e;\\n} else {\\n\x3cspan class=\x22hljs-subst\x22\x3e${next()}\x3c\/span\x3e}\\n`\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        });\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3eSyncWaterfallHook中上一个插件执行结果当作下一个插件的入参\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class SyncWaterfallHookCodeFactory extends HookCodeFactory {\n    content({ onError, onResult, onDone, rethrowIfPossible }) {\n        return this.callTapsSeries({\n            \/\/ ...\n            onResult: (i, result, next) =\x3e {\n                let code = \x26quot;\x26quot;;\n                code \x2b= `if(${result} !== undefined) {\\n`;\n                code \x2b= `${this._args[0]} = ${result};\\n`;\n                code \x2b= `}\\n`;\n                code \x2b= next();\n                return code;\n            },\n            onDone: () =\x3e onResult(this._args[0]),\n        });\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSyncWaterfallHookCodeFactory\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHookCodeFactory\x3c\/span\x3e \x3c\/span\x3e{\n    content({ onError, onResult, onDone, rethrowIfPossible }) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.callTapsSeries({\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n            onResult: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ei, result, next\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e code = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`if(\x3cspan class=\x22hljs-subst\x22\x3e${result}\x3c\/span\x3e !== undefined) {\\n`\x3c\/span\x3e;\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._args[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]}\x3c\/span\x3e = \x3cspan class=\x22hljs-subst\x22\x3e${result}\x3c\/span\x3e;\\n`\x3c\/span\x3e;\n                code \x2b= \x3cspan class=\x22hljs-string\x22\x3e`}\\n`\x3c\/span\x3e;\n                code \x2b= next();\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e code;\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3eonDone\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e onResult(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._args[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]),\n        });\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3eAsyncParallelHook调用\x3ccode\x3ecallTapsParallel\x3c\/code\x3e并行执行插件\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class AsyncParallelHookCodeFactory extends HookCodeFactory {\n    content({ onError, onDone }) {\n        return this.callTapsParallel({\n            onError: (i, err, done, doneBreak) =\x3e onError(err) \x2b doneBreak(true),\n            onDone\n        });\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eAsyncParallelHookCodeFactory\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHookCodeFactory\x3c\/span\x3e \x3c\/span\x3e{\n    content({ onError, onDone }) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.callTapsParallel({\n            \x3cspan class=\x22hljs-attr\x22\x3eonError\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ei, err, done, doneBreak\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e onError(err) \x2b doneBreak(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e),\n            onDone\n        });\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3ewebpack流程篇\x3c\/h3\x3e\n\x3cp\x3e本文关于webpack 的流程讲解是基于webpack4的。\x3c\/p\x3e\n\x3ch4\x3ewebpack 入口文件\x3c\/h4\x3e\n\x3cp\x3e从webpack项目的package.json文件中我们找到了入口执行函数，在函数中引入webpack，那么入口将会是\x3ccode\x3elib\/webpack.js\x3c\/code\x3e,而如果在shell中执行，那么将会走到\x3ccode\x3e.\/bin\/webpack.js\x3c\/code\x3e,我们就以\x3ccode\x3elib\/webpack.js\x3c\/code\x3e为入口开始吧！\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;name\x26quot;: \x26quot;webpack\x26quot;,\n  \x26quot;version\x26quot;: \x26quot;4.1.1\x26quot;,\n  ...\n  \x26quot;main\x26quot;: \x26quot;lib\/webpack.js\x26quot;,\n  \x26quot;web\x26quot;: \x26quot;lib\/webpack.web.js\x26quot;,\n  \x26quot;bin\x26quot;: \x26quot;.\/bin\/webpack.js\x26quot;,\n  ...\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22webpack\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x224.1.1\x22\x3c\/span\x3e,\n  ...\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22main\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22lib\/webpack.js\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22web\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22lib\/webpack.web.js\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22bin\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22.\/bin\/webpack.js\x22\x3c\/span\x3e,\n  ...\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3ewebpack入口\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const webpack = (options, callback) =\x3e {\n    \/\/ ...\n    \/\/ 验证options正确性\n    \/\/ 预处理options\n    options = new WebpackOptionsDefaulter().process(options); \/\/ webpack4的默认配置\n    compiler = new Compiler(options.context); \/\/ 实例Compiler\n    \/\/ ...\n    \/\/ 若options.watch === true \x26amp;\x26amp; callback 则开启watch线程\n    compiler.watch(watchOptions, callback);\n    compiler.run(callback);\n    return compiler;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e webpack = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions, callback\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 验证options正确性\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 预处理options\x3c\/span\x3e\n    options = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e WebpackOptionsDefaulter().process(options); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ webpack4的默认配置\x3c\/span\x3e\n    compiler = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Compiler(options.context); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实例Compiler\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 若options.watch === true \x26amp;\x26amp; callback 则开启watch线程\x3c\/span\x3e\n    compiler.watch(watchOptions, callback);\n    compiler.run(callback);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e compiler;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ewebpack 的入口文件其实就实例了\x3ccode\x3eCompiler\x3c\/code\x3e并调用了\x3ccode\x3erun\x3c\/code\x3e方法开启了编译，webpack的编译都按照下面的钩子调用顺序执行。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3ebefore-run 清除缓存\x3c\/li\x3e\n\x3cli\x3erun 注册缓存数据钩子\x3c\/li\x3e\n\x3cli\x3ebefore-compile\x3c\/li\x3e\n\x3cli\x3ecompile 开始编译\x3c\/li\x3e\n\x3cli\x3emake 从入口分析依赖以及间接依赖模块，创建模块对象\x3c\/li\x3e\n\x3cli\x3ebuild-module 模块构建\x3c\/li\x3e\n\x3cli\x3eseal 构建结果封装， 不可再更改\x3c\/li\x3e\n\x3cli\x3eafter-compile 完成构建，缓存数据\x3c\/li\x3e\n\x3cli\x3eemit 输出到dist目录\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e编译\x26amp;构建流程\x3c\/h4\x3e\n\x3cp\x3ewebpack中负责构建和编译都是\x3ccode\x3eCompilation\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class Compilation extends Tapable {\n    constructor(compiler) {\n        super();\n        this.hooks = {\n            \/\/ hooks\n        };\n        \/\/ ...\n        this.compiler = compiler;\n        \/\/ ...\n        \/\/ template\n        this.mainTemplate = new MainTemplate(this.outputOptions);\n        this.chunkTemplate = new ChunkTemplate(this.outputOptions);\n        this.hotUpdateChunkTemplate = new HotUpdateChunkTemplate(\n            this.outputOptions\n        );\n        this.runtimeTemplate = new RuntimeTemplate(\n            this.outputOptions,\n            this.requestShortener\n        );\n        this.moduleTemplates = {\n            javascript: new ModuleTemplate(this.runtimeTemplate),\n            webassembly: new ModuleTemplate(this.runtimeTemplate)\n        };\n\n        \/\/ 构建生成的资源\n        this.chunks = [];\n        this.chunkGroups = [];\n        this.modules = [];\n        this.additionalChunkAssets = [];\n        this.assets = {};\n        this.children = [];\n        \/\/ ...\n    }\n    \/\/ \n    buildModule(module, optional, origin, dependencies, thisCallback) {\n        \/\/ ...\n        \/\/ 调用module.build方法进行编译代码，build中 其实是利用acorn编译生成AST\n        this.hooks.buildModule.call(module);\n        module.build(\/**param*\/);\n    }\n    \/\/ 将模块添加到列表中，并编译模块\n    _addModuleChain(context, dependency, onModule, callback) {\n            \/\/ ...\n            \/\/ moduleFactory.create创建模块，这里会先利用loader处理文件，然后生成模块对象\n            moduleFactory.create(\n                {\n                    contextInfo: {\n                        issuer: \x26quot;\x26quot;,\n                        compiler: this.compiler.name\n                    },\n                    context: context,\n                    dependencies: [dependency]\n                },\n                (err, module) =\x3e {\n                    const addModuleResult = this.addModule(module);\n                    module = addModuleResult.module;\n                    onModule(module);\n                    dependency.module = module;\n                    \n                    \/\/ ...\n                    \/\/ 调用buildModule编译模块\n                    this.buildModule(module, false, null, null, err =\x3e {});\n                }\n        });\n    }\n    \/\/ 添加入口模块，开始编译\x26amp;构建\n    addEntry(context, entry, name, callback) {\n        \/\/ ...\n        this._addModuleChain( \/\/ 调用_addModuleChain添加模块\n            context,\n            entry,\n            module =\x3e {\n                this.entries.push(module);\n            },\n            \/\/ ...\n        );\n    }\n\n    \n    seal(callback) {\n        this.hooks.seal.call();\n\n        \/\/ ...\n        const chunk = this.addChunk(name);\n        const entrypoint = new Entrypoint(name);\n        entrypoint.setRuntimeChunk(chunk);\n        entrypoint.addOrigin(null, name, preparedEntrypoint.request);\n        this.namedChunkGroups.set(name, entrypoint);\n        this.entrypoints.set(name, entrypoint);\n        this.chunkGroups.push(entrypoint);\n\n        GraphHelpers.connectChunkGroupAndChunk(entrypoint, chunk);\n        GraphHelpers.connectChunkAndModule(chunk, module);\n\n        chunk.entryModule = module;\n        chunk.name = name;\n\n         \/\/ ...\n        this.hooks.beforeHash.call();\n        this.createHash();\n        this.hooks.afterHash.call();\n        this.hooks.beforeModuleAssets.call();\n        this.createModuleAssets();\n        if (this.hooks.shouldGenerateChunkAssets.call() !== false) {\n            this.hooks.beforeChunkAssets.call();\n            this.createChunkAssets();\n        }\n        \/\/ ...\n    }\n\n\n    createHash() {\n        \/\/ ...\n    }\n    \n    \/\/ 生成 assets 资源并 保存到 Compilation.assets 中 给webpack写插件的时候会用到\n    createModuleAssets() {\n        for (let i = 0; i \x3c this.modules.length; i\x2b\x2b) {\n            const module = this.modules[i];\n            if (module.buildInfo.assets) {\n                for (const assetName of Object.keys(module.buildInfo.assets)) {\n                    const fileName = this.getPath(assetName);\n                    this.assets[fileName] = module.buildInfo.assets[assetName]; \n                    this.hooks.moduleAsset.call(module, fileName);\n                }\n            }\n        }\n    }\n\n    createChunkAssets() {\n     \/\/ ...\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eCompilation\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTapable\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(compiler) {\n        \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e();\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks = {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ hooks\x3c\/span\x3e\n        };\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.compiler = compiler;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ template\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.mainTemplate = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e MainTemplate(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputOptions);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chunkTemplate = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ChunkTemplate(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputOptions);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hotUpdateChunkTemplate = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e HotUpdateChunkTemplate(\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputOptions\n        );\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.runtimeTemplate = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e RuntimeTemplate(\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputOptions,\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.requestShortener\n        );\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.moduleTemplates = {\n            \x3cspan class=\x22hljs-attr\x22\x3ejavascript\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ModuleTemplate(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.runtimeTemplate),\n            \x3cspan class=\x22hljs-attr\x22\x3ewebassembly\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ModuleTemplate(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.runtimeTemplate)\n        };\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 构建生成的资源\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chunks = [];\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chunkGroups = [];\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.modules = [];\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.additionalChunkAssets = [];\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.assets = {};\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.children = [];\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x3c\/span\x3e\n    buildModule(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e, optional, origin, dependencies, thisCallback) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用module.build方法进行编译代码，build中 其实是利用acorn编译生成AST\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.buildModule.call(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.build(\x3cspan class=\x22hljs-comment\x22\x3e\/**param*\/\x3c\/span\x3e);\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将模块添加到列表中，并编译模块\x3c\/span\x3e\n    _addModuleChain(context, dependency, onModule, callback) {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ moduleFactory.create创建模块，这里会先利用loader处理文件，然后生成模块对象\x3c\/span\x3e\n            moduleFactory.create(\n                {\n                    \x3cspan class=\x22hljs-attr\x22\x3econtextInfo\x3c\/span\x3e: {\n                        \x3cspan class=\x22hljs-attr\x22\x3eissuer\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e,\n                        \x3cspan class=\x22hljs-attr\x22\x3ecompiler\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.compiler.name\n                    },\n                    \x3cspan class=\x22hljs-attr\x22\x3econtext\x3c\/span\x3e: context,\n                    \x3cspan class=\x22hljs-attr\x22\x3edependencies\x3c\/span\x3e: [dependency]\n                },\n                (err, \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e) =\x26gt; {\n                    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e addModuleResult = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.addModule(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e);\n                    \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e = addModuleResult.module;\n                    onModule(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e);\n                    dependency.module = \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e;\n                    \n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用buildModule编译模块\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.buildModule(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, err =\x26gt; {});\n                }\n        });\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加入口模块，开始编译\x26amp;构建\x3c\/span\x3e\n    addEntry(context, entry, name, callback) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._addModuleChain( \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用_addModuleChain添加模块\x3c\/span\x3e\n            context,\n            entry,\n            \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e =\x26gt; {\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.entries.push(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e);\n            },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        );\n    }\n\n    \n    seal(callback) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.seal.call();\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e chunk = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.addChunk(name);\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e entrypoint = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Entrypoint(name);\n        entrypoint.setRuntimeChunk(chunk);\n        entrypoint.addOrigin(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, name, preparedEntrypoint.request);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.namedChunkGroups.set(name, entrypoint);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.entrypoints.set(name, entrypoint);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chunkGroups.push(entrypoint);\n\n        GraphHelpers.connectChunkGroupAndChunk(entrypoint, chunk);\n        GraphHelpers.connectChunkAndModule(chunk, \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e);\n\n        chunk.entryModule = \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e;\n        chunk.name = name;\n\n         \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.beforeHash.call();\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.createHash();\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.afterHash.call();\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.beforeModuleAssets.call();\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.createModuleAssets();\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.shouldGenerateChunkAssets.call() !== \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.beforeChunkAssets.call();\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.createChunkAssets();\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    }\n\n\n    createHash() {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    }\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 生成 assets 资源并 保存到 Compilation.assets 中 给webpack写插件的时候会用到\x3c\/span\x3e\n    createModuleAssets() {\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.modules.length; i\x2b\x2b) {\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.modules[i];\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.buildInfo.assets) {\n                \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e assetName \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.buildInfo.assets)) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fileName = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getPath(assetName);\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.assets[fileName] = \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.buildInfo.assets[assetName]; \n                    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.moduleAsset.call(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e, fileName);\n                }\n            }\n        }\n    }\n\n    createChunkAssets() {\n     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在webpack \x3ccode\x3emake\x3c\/code\x3e钩子中, \x3ccode\x3etapAsync\x3c\/code\x3e注册了一个\x3ccode\x3eDllEntryPlugin\x3c\/code\x3e, 就是将入口模块通过调用\x3ccode\x3ecompilation.addEntry\x3c\/code\x3e方法将所有的入口模块添加到编译构建队列中，开启编译流程。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22compiler.hooks.make.tapAsync(\x26quot;DllEntryPlugin\x26quot;, (compilation, callback) =\x3e {\n        compilation.addEntry(\n            this.context,\n            new DllEntryDependency(\n                this.entries.map((e, idx) =\x3e {\n                    const dep = new SingleEntryDependency(e);\n                    dep.loc = `${this.name}:${idx}`;\n                    return dep;\n                }),\n                this.name\n            ),\n            \/\/ ...\n        );\n    });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ecompiler.hooks.make.tapAsync(\x3cspan class=\x22hljs-string\x22\x3e\x22DllEntryPlugin\x22\x3c\/span\x3e, (compilation, callback) =\x26gt; {\n        compilation.addEntry(\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context,\n            \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e DllEntryDependency(\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.entries.map(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ee, idx\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dep = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e SingleEntryDependency(e);\n                    dep.loc = \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name}\x3c\/span\x3e:\x3cspan class=\x22hljs-subst\x22\x3e${idx}\x3c\/span\x3e`\x3c\/span\x3e;\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e dep;\n                }),\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name\n            ),\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        );\n    });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e随后在\x3ccode\x3eaddEntry\x3c\/code\x3e 中调用\x3ccode\x3e_addModuleChain\x3c\/code\x3e开始编译。在\x3ccode\x3e_addModuleChain\x3c\/code\x3e首先会生成模块，最后构建。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class NormalModuleFactory extends Tapable {\n    \/\/ ...\n    create(data, callback) {\n        \/\/ ...\n        this.hooks.beforeResolve.callAsync(\n            {\n                contextInfo,\n                resolveOptions,\n                context,\n                request,\n                dependencies\n            },\n            (err, result) =\x3e {\n                if (err) return callback(err);\n\n                \/\/ Ignored\n                if (!result) return callback();\n                \/\/ factory 钩子会触发 resolver 钩子执行，而resolver钩子中会利用acorn 处理js生成AST，再利用acorn处理前，会使用loader加载文件\n                const factory = this.hooks.factory.call(null);\n\n                factory(result, (err, module) =\x3e {\n                    if (err) return callback(err);\n\n                    if (module \x26amp;\x26amp; this.cachePredicate(module)) {\n                        for (const d of dependencies) {\n                            d.__NormalModuleFactoryCache = module;\n                        }\n                    }\n\n                    callback(null, module);\n                });\n            }\n        );\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eNormalModuleFactory\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTapable\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    create(data, callback) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.beforeResolve.callAsync(\n            {\n                contextInfo,\n                resolveOptions,\n                context,\n                request,\n                dependencies\n            },\n            (err, result) =\x26gt; {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Ignored\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!result) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback();\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ factory 钩子会触发 resolver 钩子执行，而resolver钩子中会利用acorn 处理js生成AST，再利用acorn处理前，会使用loader加载文件\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e factory = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.factory.call(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e);\n\n                factory(result, (err, \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e) =\x26gt; {\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.cachePredicate(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e)) {\n                        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e d \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e dependencies) {\n                            d.__NormalModuleFactoryCache = \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e;\n                        }\n                    }\n\n                    callback(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e);\n                });\n            }\n        );\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在编译完成后，调用\x3ccode\x3ecompilation.seal\x3c\/code\x3e方法封闭，生成资源，这些资源保存在\x3ccode\x3ecompilation.assets\x3c\/code\x3e, \x3ccode\x3ecompilation.chunk\x3c\/code\x3e, 在给webpack写插件的时候会用到\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class Compiler extends Tapable {\n    constructor(context) {\n        super();\n        this.hooks = {\n            beforeRun: new AsyncSeriesHook([\x26quot;compilation\x26quot;]),\n            run: new AsyncSeriesHook([\x26quot;compilation\x26quot;]),\n            emit: new AsyncSeriesHook([\x26quot;compilation\x26quot;]),\n            afterEmit: new AsyncSeriesHook([\x26quot;compilation\x26quot;]),\n            compilation: new SyncHook([\x26quot;compilation\x26quot;, \x26quot;params\x26quot;]),\n            beforeCompile: new AsyncSeriesHook([\x26quot;params\x26quot;]),\n            compile: new SyncHook([\x26quot;params\x26quot;]),\n            make: new AsyncParallelHook([\x26quot;compilation\x26quot;]),\n            afterCompile: new AsyncSeriesHook([\x26quot;compilation\x26quot;]),\n            \/\/ other hooks\n        };\n        \/\/ ...\n    }\n\n    run(callback) {\n        const startTime = Date.now();\n\n        const onCompiled = (err, compilation) =\x3e {\n            \/\/ ...\n\n            this.emitAssets(compilation, err =\x3e {\n                if (err) return callback(err);\n\n                if (compilation.hooks.needAdditionalPass.call()) {\n                    compilation.needAdditionalPass = true;\n\n                    const stats = new Stats(compilation);\n                    stats.startTime = startTime;\n                    stats.endTime = Date.now();\n                    this.hooks.done.callAsync(stats, err =\x3e {\n                        if (err) return callback(err);\n\n                        this.hooks.additionalPass.callAsync(err =\x3e {\n                            if (err) return callback(err);\n                            this.compile(onCompiled);\n                        });\n                    });\n                    return;\n                }\n                \/\/ ...\n            });\n        };\n\n        this.hooks.beforeRun.callAsync(this, err =\x3e {\n            if (err) return callback(err);\n            this.hooks.run.callAsync(this, err =\x3e {\n                if (err) return callback(err);\n\n                this.readRecords(err =\x3e {\n                    if (err) return callback(err);\n\n                    this.compile(onCompiled);\n                });\n            });\n        });\n    }\n    \/\/ 输出文件到构建目录\n    emitAssets(compilation, callback) {\n        \/\/ ...\n        this.hooks.emit.callAsync(compilation, err =\x3e {\n            if (err) return callback(err);\n            outputPath = compilation.getPath(this.outputPath);\n            this.outputFileSystem.mkdirp(outputPath, emitFiles);\n        });\n    }\n    \n    newCompilationParams() {\n        const params = {\n            normalModuleFactory: this.createNormalModuleFactory(),\n            contextModuleFactory: this.createContextModuleFactory(),\n            compilationDependencies: new Set()\n        };\n        return params;\n    }\n\n    compile(callback) {\n        const params = this.newCompilationParams();\n        this.hooks.beforeCompile.callAsync(params, err =\x3e {\n            if (err) return callback(err);\n            this.hooks.compile.call(params);\n            const compilation = this.newCompilation(params);\n\n            this.hooks.make.callAsync(compilation, err =\x3e {\n                if (err) return callback(err);\n                compilation.finish();\n                \/\/ make 钩子执行后，调用seal生成资源\n                compilation.seal(err =\x3e {\n                    if (err) return callback(err);\n                    this.hooks.afterCompile.callAsync(compilation, err =\x3e {\n                        if (err) return callback(err);\n                        \/\/ emit, 生成最终文件\n                        return callback(null, compilation);\n                    });\n                });\n            });\n        });\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eCompiler\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTapable\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(context) {\n        \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e();\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks = {\n            \x3cspan class=\x22hljs-attr\x22\x3ebeforeRun\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AsyncSeriesHook([\x3cspan class=\x22hljs-string\x22\x3e\x22compilation\x22\x3c\/span\x3e]),\n            \x3cspan class=\x22hljs-attr\x22\x3erun\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AsyncSeriesHook([\x3cspan class=\x22hljs-string\x22\x3e\x22compilation\x22\x3c\/span\x3e]),\n            \x3cspan class=\x22hljs-attr\x22\x3eemit\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AsyncSeriesHook([\x3cspan class=\x22hljs-string\x22\x3e\x22compilation\x22\x3c\/span\x3e]),\n            \x3cspan class=\x22hljs-attr\x22\x3eafterEmit\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AsyncSeriesHook([\x3cspan class=\x22hljs-string\x22\x3e\x22compilation\x22\x3c\/span\x3e]),\n            \x3cspan class=\x22hljs-attr\x22\x3ecompilation\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e SyncHook([\x3cspan class=\x22hljs-string\x22\x3e\x22compilation\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22params\x22\x3c\/span\x3e]),\n            \x3cspan class=\x22hljs-attr\x22\x3ebeforeCompile\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AsyncSeriesHook([\x3cspan class=\x22hljs-string\x22\x3e\x22params\x22\x3c\/span\x3e]),\n            \x3cspan class=\x22hljs-attr\x22\x3ecompile\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e SyncHook([\x3cspan class=\x22hljs-string\x22\x3e\x22params\x22\x3c\/span\x3e]),\n            \x3cspan class=\x22hljs-attr\x22\x3emake\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AsyncParallelHook([\x3cspan class=\x22hljs-string\x22\x3e\x22compilation\x22\x3c\/span\x3e]),\n            \x3cspan class=\x22hljs-attr\x22\x3eafterCompile\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AsyncSeriesHook([\x3cspan class=\x22hljs-string\x22\x3e\x22compilation\x22\x3c\/span\x3e]),\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ other hooks\x3c\/span\x3e\n        };\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    }\n\n    run(callback) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e startTime = \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now();\n\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e onCompiled = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, compilation\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.emitAssets(compilation, err =\x26gt; {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (compilation.hooks.needAdditionalPass.call()) {\n                    compilation.needAdditionalPass = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n\n                    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e stats = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Stats(compilation);\n                    stats.startTime = startTime;\n                    stats.endTime = \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now();\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.done.callAsync(stats, err =\x26gt; {\n                        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n\n                        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.additionalPass.callAsync(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n                            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.compile(onCompiled);\n                        });\n                    });\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n                }\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n            });\n        };\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.beforeRun.callAsync(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, err =\x26gt; {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.run.callAsync(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, err =\x26gt; {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.readRecords(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.compile(onCompiled);\n                });\n            });\n        });\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 输出文件到构建目录\x3c\/span\x3e\n    emitAssets(compilation, callback) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.emit.callAsync(compilation, err =\x26gt; {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n            outputPath = compilation.getPath(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputPath);\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputFileSystem.mkdirp(outputPath, emitFiles);\n        });\n    }\n    \n    newCompilationParams() {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e params = {\n            \x3cspan class=\x22hljs-attr\x22\x3enormalModuleFactory\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.createNormalModuleFactory(),\n            \x3cspan class=\x22hljs-attr\x22\x3econtextModuleFactory\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.createContextModuleFactory(),\n            \x3cspan class=\x22hljs-attr\x22\x3ecompilationDependencies\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eSet\x3c\/span\x3e()\n        };\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e params;\n    }\n\n    compile(callback) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e params = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.newCompilationParams();\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.beforeCompile.callAsync(params, err =\x26gt; {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.compile.call(params);\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e compilation = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.newCompilation(params);\n\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.make.callAsync(compilation, err =\x26gt; {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n                compilation.finish();\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ make 钩子执行后，调用seal生成资源\x3c\/span\x3e\n                compilation.seal(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hooks.afterCompile.callAsync(compilation, err =\x26gt; {\n                        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(err);\n                        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ emit, 生成最终文件\x3c\/span\x3e\n                        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, compilation);\n                    });\n                });\n            });\n        });\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e最后输出\x3c\/h4\x3e\n\x3cp\x3e在\x3ccode\x3eseal\x3c\/code\x3e执行后，便会调用\x3ccode\x3eemit\x3c\/code\x3e钩子，根据webpack config文件的output配置的path属性，将文件输出到指定的path.\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e最后\x3c\/h3\x3e\n\x3cp\x3e腾讯IVWEB团队的工程化解决方案\x3ca href=\x22https:\/\/github.com\/feflow\/feflow\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3efeflow\x3c\/a\x3e已经开源：Github主页：\x3ca href=\x22https:\/\/github.com\/feflow\/feflow\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/feflow\/feflow\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e如果对您的团队或者项目有帮助，请给个Star支持一下哈～\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013657042">https://segmentfault.com/a/1190000013657042</a></p><h2 id="原文标题">原文标题</h2><p>webpack详解</p><h2>本文链接：</h2><a href="https://alili.tech/archive/73362992/" target="_blank">https://alili.tech/archive/73362992/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>