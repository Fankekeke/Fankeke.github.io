<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="【Node.js 微信公众号实战】4.Node.js 微信消息管理"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>【Node.js 微信公众号实战】4.Node.js 微信消息管理 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/78n7amdph6s/",
				"appid": "1613049289050283", 
				"title": "【Node.js 微信公众号实战】4.Node.js 微信消息管理 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-22T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/2d7jwc5heht/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/5e1o43o1m/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f78n7amdph6s%2f&text=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%914.Node.js%20%e5%be%ae%e4%bf%a1%e6%b6%88%e6%81%af%e7%ae%a1%e7%90%86"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f78n7amdph6s%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f78n7amdph6s%2f&text=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%914.Node.js%20%e5%be%ae%e4%bf%a1%e6%b6%88%e6%81%af%e7%ae%a1%e7%90%86"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f78n7amdph6s%2f&title=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%914.Node.js%20%e5%be%ae%e4%bf%a1%e6%b6%88%e6%81%af%e7%ae%a1%e7%90%86"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f78n7amdph6s%2f&is_video=false&description=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%914.Node.js%20%e5%be%ae%e4%bf%a1%e6%b6%88%e6%81%af%e7%ae%a1%e7%90%86"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%914.Node.js%20%e5%be%ae%e4%bf%a1%e6%b6%88%e6%81%af%e7%ae%a1%e7%90%86&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f78n7amdph6s%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f78n7amdph6s%2f&title=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%914.Node.js%20%e5%be%ae%e4%bf%a1%e6%b6%88%e6%81%af%e7%ae%a1%e7%90%86"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f78n7amdph6s%2f&title=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%914.Node.js%20%e5%be%ae%e4%bf%a1%e6%b6%88%e6%81%af%e7%ae%a1%e7%90%86"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f78n7amdph6s%2f&title=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%914.Node.js%20%e5%be%ae%e4%bf%a1%e6%b6%88%e6%81%af%e7%ae%a1%e7%90%86"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f78n7amdph6s%2f&title=%e3%80%90Node.js%20%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%e5%ae%9e%e6%88%98%e3%80%914.Node.js%20%e5%be%ae%e4%bf%a1%e6%b6%88%e6%81%af%e7%ae%a1%e7%90%86"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">【Node.js 微信公众号实战】4.Node.js 微信消息管理</h1><div class="meta"><div class="postdate"><time datetime="2018-12-22" itemprop="datePublished">2018-12-22</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e一、写在前面的话\x3c\/h1\x3e\n\x3cp\x3e  当用户发送消息给公众号时（或某些特定的用户操作引发的事件推送时），会产生一个POST请求，开发者可以在响应包（Get）中返回特定XML结构，来对该消息进行响应。\x3c\/p\x3e\n\x3cp\x3e  消息推送也是微信公众号开发更为有趣的功能，涉及到文本消息、图片消息、语音消息、视频消息、音乐消息以及图文消息。并且最为有趣的功能当属消息加解密了，当然由于篇文章篇幅的原因我会在下一篇文章中去着重说明。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441023?w=440\x26amp;h=440\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441023?w=440\x26amp;h=440\x22 alt=\x22我们接着来，微信消息管理\x22 title=\x22我们接着来，微信消息管理\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e二、微信消息管理\x3c\/h1\x3e\n\x3cp\x3e1.捕获消息信息\x3c\/p\x3e\n\x3cp\x3e  在文章的第一句话中,为我们指明了微信消息产生的请求方式为 POST，因此首先我们就去对 Node.js 的 Post 请求进行监听。\x3c\/p\x3e\n\x3cp\x3e  在我们的 app.js 文件中添加一个POST监听，并将获取的结果输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/用于处理所有进入 3000 端口 post 的连接请求\napp.post(\x27\/\x27,function(req,res){\n    var buffer = [];\n    \/\/监听 data 事件 用于接收数据\n    req.on(\x27data\x27,function(data){\n        buffer.push(data);\n    });\n    \/\/监听 end 事件 用于处理接收完成的数据\n    req.on(\x27end\x27,function(){\n    \/\/输出接收完成的数据   \n         console.log(Buffer.concat(buffer).toString(\x27utf-8\x27));\n    });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/用于处理所有进入 3000 端口 post 的连接请求\x3c\/span\x3e\napp.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq,res\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e buffer = [];\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/监听 data 事件 用于接收数据\x3c\/span\x3e\n    req.on(\x3cspan class=\x22hljs-string\x22\x3e\x27data\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n        buffer.push(data);\n    });\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/监听 end 事件 用于处理接收完成的数据\x3c\/span\x3e\n    req.on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/输出接收完成的数据   \x3c\/span\x3e\n         \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(Buffer.concat(buffer).toString(\x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e));\n    });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e  随后将 Node.js 启动后映射至外网，关注我们的微信公众号，在控制台中则会看到：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441024?w=933\x26amp;h=220\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441024?w=933\x26amp;h=220\x22 alt=\x22输出结果\x22 title=\x22输出结果\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e  打开 \x3ca href=\x22https:\/\/mp.weixin.qq.com\/wiki\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e微信帮助文档 \x3c\/a\x3e，点击左侧菜单的消息管理，选择其子菜单 接收事件推送，如图：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441025?w=277\x26amp;h=390\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441025?w=277\x26amp;h=390\x22 alt=\x22消息管理 -  接收事件推送\x22 title=\x22消息管理 -  接收事件推送\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441026?w=919\x26amp;h=406\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441026?w=919\x26amp;h=406\x22 alt=\x22微信接收事件推送\x22 title=\x22微信接收事件推送\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e  从上图我们不难看出，微信 接收事件推送 确实很多，而我们最终目标是要实现，在用户触发事件时返回其相应的回复消息。因此我们总结一下我们要实现的步骤：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e解析 XML ，使用 Event 参数判断事件类型\x3c\/li\x3e\n\x3cli\x3e返回相应的事件信息\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e总结完实现步骤后，我们就开始动手实现第一个被动回复消息吧。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441027?w=180\x26amp;h=191\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441027?w=180\x26amp;h=191\x22 alt=\x22别拦我，让我去装逼\x22 title=\x22别拦我，让我去装逼\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e2.以关注事件为例，实现第一个被动回复\x3c\/p\x3e\n\x3cp\x3e  解析 XML 我这里使用了 第三方的包 xml2js(npm install xml2js )，并在 wechat.js 中引入。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 parseString = require(\x27xml2js\x27).parseString;\/\/引入xml2js包\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e parseString = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27xml2js\x27\x3c\/span\x3e).parseString;\x3cspan class=\x22hljs-comment\x22\x3e\/\/引入xml2js包\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e  为 WeChat 对象添加一个消息处理的方法 handleMsg，将 app.js 中捕获 POST 实现的写入在其代码块中，并使用 xml2js 解析，代码如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 微信消息\n *\/\nWeChat.prototype.handleMsg = function(req,res){\n    var buffer = [];\n    \/\/监听 data 事件 用于接收数据\n    req.on(\x27data\x27,function(data){\n        buffer.push(data);\n    });\n    \/\/监听 end 事件 用于处理接收完成的数据\n    req.on(\x27end\x27,function(){\n        var msgXml = Buffer.concat(buffer).toString(\x27utf-8\x27);\n        \/\/解析xml\n        parseString(msgXml,{explicitArray : false},function(err,result){\n            if(!err){\n                \/\/打印解析结果\n                console.log(result);\n            }else{\n                 \/\/打印错误信息\n                console.log(err);\n            }\n        })\n    });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 微信消息\n *\/\x3c\/span\x3e\nWeChat.prototype.handleMsg = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq,res\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e buffer = [];\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/监听 data 事件 用于接收数据\x3c\/span\x3e\n    req.on(\x3cspan class=\x22hljs-string\x22\x3e\x27data\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n        buffer.push(data);\n    });\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/监听 end 事件 用于处理接收完成的数据\x3c\/span\x3e\n    req.on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e msgXml = Buffer.concat(buffer).toString(\x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/解析xml\x3c\/span\x3e\n        parseString(msgXml,{\x3cspan class=\x22hljs-attr\x22\x3eexplicitArray\x3c\/span\x3e : \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e},\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr,result\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!err){\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/打印解析结果\x3c\/span\x3e\n                \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(result);\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                 \x3cspan class=\x22hljs-comment\x22\x3e\/\/打印错误信息\x3c\/span\x3e\n                \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(err);\n            }\n        })\n    });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e  在 app.js 中调用 handleMsg 方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/用于处理所有进入 3000 端口 post 的连接请求\napp.post(\x27\/\x27,function(req,res){\n    wechatApp.handleMsg(req,res);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/用于处理所有进入 3000 端口 post 的连接请求\x3c\/span\x3e\napp.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq,res\x3c\/span\x3e)\x3c\/span\x3e{\n    wechatApp.handleMsg(req,res);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e  完成了代码的编写后，将公众号重新关注\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441028?w=887\x26amp;h=362\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441028?w=887\x26amp;h=362\x22 alt=\x22运行结果\x22 title=\x22运行结果\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e最后打印为一个 JSON 格式的结果，也就是预示着我们第1步工作已经完成。下面开始我们的第2步，微信被动回复。\x3c\/p\x3e\n\x3cp\x3e  在文章的第一句话的后边提到 开发者可以在响应包（Get）中返回特定XML结构，那么这个特定的 XML 结构在哪呢？再次打开\x3ca href=\x22https:\/\/mp.weixin.qq.com\/wiki\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e微信帮助文档 \x3c\/a\x3e，点击左侧菜单的消息管理，选择其子菜单 被动回复消息，如图：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441029?w=388\x26amp;h=441\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441029?w=388\x26amp;h=441\x22 alt=\x22消息管理 - 被动回复消息\x22 title=\x22消息管理 - 被动回复消息\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e  直接来到 回复文本消息：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441030?w=940\x26amp;h=632\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441030?w=940\x26amp;h=632\x22 alt=\x22回复文本消息\x22 title=\x22回复文本消息\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e  拿到回复文本消息格式后，我们就来为关注我们公众号的同学打声招呼吧。在 wechat 文件中 创建 msg.js 文件用于消息的管理。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441031?w=829\x26amp;h=530\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441031?w=829\x26amp;h=530\x22 alt=\x22这里写图片描述\x22 title=\x22这里写图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e并在 msg.js 中添加处理文本消息的接口，并在 wechat.js 中引用\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x27use strict\x27 \/\/设置为严格模式\n\n\/\/回复文本消息\nexports.txtMsg = function(toUser,fromUser,content){\n    var xmlContent =  \x26quot;\x3cxml\x3e\x3cToUserName\x3e\x3c![CDATA[\x26quot;\x2b toUser \x2b\x26quot;]]\x3e\x3c\/ToUserName\x3e\x26quot;;\n        xmlContent \x2b= \x26quot;\x3cFromUserName\x3e\x3c![CDATA[\x26quot;\x2b fromUser \x2b\x26quot;]]\x3e\x3c\/FromUserName\x3e\x26quot;;\n        xmlContent \x2b= \x26quot;\x3cCreateTime\x3e\x26quot;\x2b new Date().getTime() \x2b\x26quot;\x3c\/CreateTime\x3e\x26quot;;\n        xmlContent \x2b= \x26quot;\x3cMsgType\x3e\x3c![CDATA[text]]\x3e\x3c\/MsgType\x3e\x26quot;;\n        xmlContent \x2b= \x26quot;\x3cContent\x3e\x3c![CDATA[\x26quot;\x2b content \x2b\x26quot;]]\x3e\x3c\/Content\x3e\x3c\/xml\x3e\x26quot;;\n    return xmlContent;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x27use strict\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置为严格模式\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/回复文本消息\x3c\/span\x3e\nexports.txtMsg = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etoUser,fromUser,content\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e xmlContent =  \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;xml\x26gt;\x26lt;ToUserName\x26gt;\x26lt;![CDATA[\x22\x3c\/span\x3e\x2b toUser \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22]]\x26gt;\x26lt;\/ToUserName\x26gt;\x22\x3c\/span\x3e;\n        xmlContent \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;FromUserName\x26gt;\x26lt;![CDATA[\x22\x3c\/span\x3e\x2b fromUser \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22]]\x26gt;\x26lt;\/FromUserName\x26gt;\x22\x3c\/span\x3e;\n        xmlContent \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;CreateTime\x26gt;\x22\x3c\/span\x3e\x2b \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime() \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;\/CreateTime\x26gt;\x22\x3c\/span\x3e;\n        xmlContent \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;MsgType\x26gt;\x26lt;![CDATA[text]]\x26gt;\x26lt;\/MsgType\x26gt;\x22\x3c\/span\x3e;\n        xmlContent \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;Content\x26gt;\x26lt;![CDATA[\x22\x3c\/span\x3e\x2b content \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22]]\x26gt;\x26lt;\/Content\x26gt;\x26lt;\/xml\x26gt;\x22\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e xmlContent;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e修改 wechat.js 中 handleMsg 方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 微信消息\n *\/\nWeChat.prototype.handleMsg = function(req,res){\n    var buffer = [];\n    \/\/监听 data 事件 用于接收数据\n    req.on(\x27data\x27,function(data){\n        buffer.push(data);\n    });\n    \/\/监听 end 事件 用于处理接收完成的数据\n    req.on(\x27end\x27,function(){\n        var msgXml = Buffer.concat(buffer).toString(\x27utf-8\x27);\n        \/\/解析xml\n        parseString(msgXml,{explicitArray : false},function(err,result){\n            if(!err){\n                   result = result.xml;\n                   var toUser = result.ToUserName; \/\/接收方微信\n                   var fromUser = result.FromUserName;\/\/发送仿微信\n                   \/\/判断事件类型\n                   switch(result.Event.toLowerCase()){\n                      case \x27subscribe\x27:\n                             \/\/回复消息\n                             res.send(msg.txtMsg(fromUser,toUser,\x27欢迎关注 hvkcoder 公众号，一起斗图吧\x27));\n                             break;\n                   }\n            }else{\n                 \/\/打印错误信息\n                console.log(err);\n            }\n        })\n    });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 微信消息\n *\/\x3c\/span\x3e\nWeChat.prototype.handleMsg = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq,res\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e buffer = [];\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/监听 data 事件 用于接收数据\x3c\/span\x3e\n    req.on(\x3cspan class=\x22hljs-string\x22\x3e\x27data\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n        buffer.push(data);\n    });\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/监听 end 事件 用于处理接收完成的数据\x3c\/span\x3e\n    req.on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e msgXml = Buffer.concat(buffer).toString(\x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/解析xml\x3c\/span\x3e\n        parseString(msgXml,{\x3cspan class=\x22hljs-attr\x22\x3eexplicitArray\x3c\/span\x3e : \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e},\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr,result\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!err){\n                   result = result.xml;\n                   \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e toUser = result.ToUserName; \x3cspan class=\x22hljs-comment\x22\x3e\/\/接收方微信\x3c\/span\x3e\n                   \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fromUser = result.FromUserName;\x3cspan class=\x22hljs-comment\x22\x3e\/\/发送仿微信\x3c\/span\x3e\n                   \x3cspan class=\x22hljs-comment\x22\x3e\/\/判断事件类型\x3c\/span\x3e\n                   \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(result.Event.toLowerCase()){\n                      \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27subscribe\x27\x3c\/span\x3e:\n                             \x3cspan class=\x22hljs-comment\x22\x3e\/\/回复消息\x3c\/span\x3e\n                             res.send(msg.txtMsg(fromUser,toUser,\x3cspan class=\x22hljs-string\x22\x3e\x27欢迎关注 hvkcoder 公众号，一起斗图吧\x27\x3c\/span\x3e));\n                             \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                   }\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                 \x3cspan class=\x22hljs-comment\x22\x3e\/\/打印错误信息\x3c\/span\x3e\n                \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(err);\n            }\n        })\n    });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441032?w=587\x26amp;h=514\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441032?w=587\x26amp;h=514\x22 alt=\x22实现结果\x22 title=\x22实现结果\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e   没错就是这么简单。这里有个逻辑是这样的 toUser 表示接收方，也就是咱们的微信公众号；fromUser 表示发送方，也就是触发事件的用户。而我们要回复用户时，此时 接收方 就是 触发事件的用户，而发送方则是 我们的微信公众号。这块比较绕，大家可以慢慢去理解。\x3c\/p\x3e\n\x3cp\x3e  由于我们还没有对微信的素材管理进行讲解，这里我们暂时跳过 图片消息、语音消息、视频消息、以及音乐消息。直接实现图文消息的推送。\x3c\/p\x3e\n\x3cp\x3e3.图文消息\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441033?w=809\x26amp;h=591\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441033?w=809\x26amp;h=591\x22 alt=\x22这里写图片描述\x22 title=\x22这里写图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e  在 msg.js 文件中添加图文XML模板\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/回复图文消息\nexports.graphicMsg = function(toUser,fromUser,contentArr){\n     var xmlContent =  \x26quot;\x3cxml\x3e\x3cToUserName\x3e\x3c![CDATA[\x26quot;\x2b toUser \x2b\x26quot;]]\x3e\x3c\/ToUserName\x3e\x26quot;;\n        xmlContent \x2b= \x26quot;\x3cFromUserName\x3e\x3c![CDATA[\x26quot;\x2b fromUser \x2b\x26quot;]]\x3e\x3c\/FromUserName\x3e\x26quot;;\n        xmlContent \x2b= \x26quot;\x3cCreateTime\x3e\x26quot;\x2b new Date().getTime() \x2b\x26quot;\x3c\/CreateTime\x3e\x26quot;;\n        xmlContent \x2b= \x26quot;\x3cMsgType\x3e\x3c![CDATA[news]]\x3e\x3c\/MsgType\x3e\x26quot;;\n        xmlContent \x2b= \x26quot;\x3cArticleCount\x3e\x26quot;\x2bcontentArr.length\x2b\x26quot;\x3c\/ArticleCount\x3e\x26quot;;\n        xmlContent \x2b= \x26quot;\x3cArticles\x3e\x26quot;;\n        contentArr.map(function(item,index){\n            xmlContent\x2b=\x26quot;\x3citem\x3e\x26quot;;\n            xmlContent\x2b=\x26quot;\x3cTitle\x3e\x3c![CDATA[\x26quot;\x2b item.Title \x2b\x26quot;]]\x3e\x3c\/Title\x3e\x26quot;;\n            xmlContent\x2b=\x26quot;\x3cDescription\x3e\x3c![CDATA[\x26quot;\x2b item.Description \x2b\x26quot;]]\x3e\x3c\/Description\x3e\x26quot;;\n            xmlContent\x2b=\x26quot;\x3cPicUrl\x3e\x3c![CDATA[\x26quot;\x2b item.PicUrl \x2b\x26quot;]]\x3e\x3c\/PicUrl\x3e\x26quot;;\n            xmlContent\x2b=\x26quot;\x3cUrl\x3e\x3c![CDATA[\x26quot;\x2b item.Url \x2b\x26quot;]]\x3e\x3c\/Url\x3e\x26quot;;\n            xmlContent\x2b=\x26quot;\x3c\/item\x3e\x26quot;;\n        });\n        xmlContent \x2b= \x26quot;\x3c\/Articles\x3e\x3c\/xml\x3e\x26quot;;\n    return xmlContent;\n}\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/回复图文消息\x3c\/span\x3e\nexports.graphicMsg = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etoUser,fromUser,contentArr\x3c\/span\x3e)\x3c\/span\x3e{\n     \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e xmlContent =  \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;xml\x26gt;\x26lt;ToUserName\x26gt;\x26lt;![CDATA[\x22\x3c\/span\x3e\x2b toUser \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22]]\x26gt;\x26lt;\/ToUserName\x26gt;\x22\x3c\/span\x3e;\n        xmlContent \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;FromUserName\x26gt;\x26lt;![CDATA[\x22\x3c\/span\x3e\x2b fromUser \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22]]\x26gt;\x26lt;\/FromUserName\x26gt;\x22\x3c\/span\x3e;\n        xmlContent \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;CreateTime\x26gt;\x22\x3c\/span\x3e\x2b \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime() \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;\/CreateTime\x26gt;\x22\x3c\/span\x3e;\n        xmlContent \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;MsgType\x26gt;\x26lt;![CDATA[news]]\x26gt;\x26lt;\/MsgType\x26gt;\x22\x3c\/span\x3e;\n        xmlContent \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;ArticleCount\x26gt;\x22\x3c\/span\x3e\x2bcontentArr.length\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;\/ArticleCount\x26gt;\x22\x3c\/span\x3e;\n        xmlContent \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;Articles\x26gt;\x22\x3c\/span\x3e;\n        contentArr.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem,index\x3c\/span\x3e)\x3c\/span\x3e{\n            xmlContent\x2b=\x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;item\x26gt;\x22\x3c\/span\x3e;\n            xmlContent\x2b=\x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;Title\x26gt;\x26lt;![CDATA[\x22\x3c\/span\x3e\x2b item.Title \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22]]\x26gt;\x26lt;\/Title\x26gt;\x22\x3c\/span\x3e;\n            xmlContent\x2b=\x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;Description\x26gt;\x26lt;![CDATA[\x22\x3c\/span\x3e\x2b item.Description \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22]]\x26gt;\x26lt;\/Description\x26gt;\x22\x3c\/span\x3e;\n            xmlContent\x2b=\x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;PicUrl\x26gt;\x26lt;![CDATA[\x22\x3c\/span\x3e\x2b item.PicUrl \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22]]\x26gt;\x26lt;\/PicUrl\x26gt;\x22\x3c\/span\x3e;\n            xmlContent\x2b=\x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;Url\x26gt;\x26lt;![CDATA[\x22\x3c\/span\x3e\x2b item.Url \x2b\x3cspan class=\x22hljs-string\x22\x3e\x22]]\x26gt;\x26lt;\/Url\x26gt;\x22\x3c\/span\x3e;\n            xmlContent\x2b=\x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;\/item\x26gt;\x22\x3c\/span\x3e;\n        });\n        xmlContent \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22\x26lt;\/Articles\x26gt;\x26lt;\/xml\x26gt;\x22\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e xmlContent;\n}\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e  更改 wechat.js 文件中的 handleMsg 方法，将图消息推送响应在点击事件中\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  case \x27click\x27:\n                                var contentArr = [\n                                    {Title:\x26quot;Node.js 微信自定义菜单\x26quot;,Description:\x26quot;使用Node.js实现自定义微信菜单\x26quot;,PicUrl:\x26quot;http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x26quot;,Url:\x26quot;http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72868520\x26quot;},\n                                    {Title:\x26quot;Node.js access_token的获取、存储及更新\x26quot;,Description:\x26quot;Node.js access_token的获取、存储及更新\x26quot;,PicUrl:\x26quot;http:\/\/img.blog.csdn.net\/20170528151333883?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x26quot;,Url:\x26quot;http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72783631\x26quot;},\n                                    {Title:\x26quot;Node.js 接入微信公众平台开发\x26quot;,Description:\x26quot;Node.js 接入微信公众平台开发\x26quot;,PicUrl:\x26quot;http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x26quot;,Url:\x26quot;http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72765279\x26quot;}\n                                ];\n                               \/\/回复图文消息\n                               res.send(msg.graphicMsg(fromUser,toUser,contentArr));\n                            break;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e:\n                                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e contentArr = [\n                                    {\x3cspan class=\x22hljs-attr\x22\x3eTitle\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js 微信自定义菜单\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eDescription\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22使用Node.js实现自定义微信菜单\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3ePicUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72868520\x22\x3c\/span\x3e},\n                                    {\x3cspan class=\x22hljs-attr\x22\x3eTitle\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js access_token的获取、存储及更新\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eDescription\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js access_token的获取、存储及更新\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3ePicUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/img.blog.csdn.net\/20170528151333883?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72783631\x22\x3c\/span\x3e},\n                                    {\x3cspan class=\x22hljs-attr\x22\x3eTitle\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js 接入微信公众平台开发\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eDescription\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js 接入微信公众平台开发\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3ePicUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72765279\x22\x3c\/span\x3e}\n                                ];\n                               \x3cspan class=\x22hljs-comment\x22\x3e\/\/回复图文消息\x3c\/span\x3e\n                               res.send(msg.graphicMsg(fromUser,toUser,contentArr));\n                            \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e  点击菜单下的 今日推荐\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441034?w=583\x26amp;h=506\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441034?w=583\x26amp;h=506\x22 alt=\x22今日推荐\x22 title=\x22今日推荐\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e  图文推送就是这么简单的被我们给实现了。\x3c\/p\x3e\n\x3cp\x3e4.接收普通消息\x3c\/p\x3e\n\x3cp\x3e  微信除了为我们接收事件推送外，千万不要忘了微信还能通过发送文字。而这一节我们也就来玩玩微信接收普通消息。\x3c\/p\x3e\n\x3cp\x3e  打开 \x3ca href=\x22https:\/\/mp.weixin.qq.com\/wiki\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e微信帮助文档 \x3c\/a\x3e，点击左侧菜单的消息管理，选择其子菜单 接收普通消息，如图：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441035\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441035\x22 alt=\x22消息管理 - 接收普通消息\x22 title=\x22消息管理 - 接收普通消息\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e  依然如接收事件推送的套路，不同的是参数发生了改变，但这并步影响我们的开发，只需要几步就能够完美的解决。更改 wechat.js 文件 handleMsg方法，这里我先暂时只针对用户输入的文本消息做处理，其他的跟其类似。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/判断消息类型\n                   if(result.MsgType.toLowerCase() === \x26quot;event\x26quot;){\n                        \/\/判断事件类型\n                        switch(result.Event.toLowerCase()){\n                            case \x27subscribe\x27:\n                                    \/\/回复消息\n                                    var content = \x26quot;欢迎关注 hvkcoder 公众号，一起斗图吧。回复以下数字：\\n\x26quot;;\n                                        content \x2b= \x26quot;1.你是谁\\n\x26quot;;\n                                        content \x2b= \x26quot;2.关于Node.js\\n\x26quot;;\n                                        content \x2b= \x26quot;回复 “文章”  可以得到图文推送哦~\\n\x26quot;;\n                                    res.send(msg.txtMsg(fromUser,toUser,\x27\x27));\n                                    break;\n                            case \x27click\x27:\n                                        var contentArr = [\n                                            {Title:\x26quot;Node.js 微信自定义菜单\x26quot;,Description:\x26quot;使用Node.js实现自定义微信菜单\x26quot;,PicUrl:\x26quot;http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x26quot;,Url:\x26quot;http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72868520\x26quot;},\n                                            {Title:\x26quot;Node.js access_token的获取、存储及更新\x26quot;,Description:\x26quot;Node.js access_token的获取、存储及更新\x26quot;,PicUrl:\x26quot;http:\/\/img.blog.csdn.net\/20170528151333883?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x26quot;,Url:\x26quot;http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72783631\x26quot;},\n                                            {Title:\x26quot;Node.js 接入微信公众平台开发\x26quot;,Description:\x26quot;Node.js 接入微信公众平台开发\x26quot;,PicUrl:\x26quot;http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x26quot;,Url:\x26quot;http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72765279\x26quot;}\n                                        ];\n                                    \/\/回复图文消息\n                                    res.send(msg.graphicMsg(fromUser,toUser,contentArr));\n                                    break;\n                        }\n                   }else{\n                       \/\/判断消息类型为 文本消息\n                       if(result.MsgType.toLowerCase() === \x26quot;text\x26quot;){\n                           \/\/根据消息内容返回消息信息\n                           switch(result.Content){\n                               case \x271\x27:\n                                        res.send(msg.txtMsg(fromUser,toUser,\x27Hello ！我的英文名字叫 H-VK\x27));\n                                    break;\n                               case \x272\x27:\n                                        res.send(msg.txtMsg(fromUser,toUser,\x27Node.js是一个开放源代码、跨平台的JavaScript语言运行环境，采用Google开发的V8运行代码,使用事件驱动、非阻塞和异步输入输出模型等技术来提高性能，可优化应用程序的传输量和规模。这些技术通常用于数据密集的事实应用程序\x27));\n                                    break;\n                               case \x27文章\x27:\n                                      var contentArr = [\n                                            {Title:\x26quot;Node.js 微信自定义菜单\x26quot;,Description:\x26quot;使用Node.js实现自定义微信菜单\x26quot;,PicUrl:\x26quot;http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x26quot;,Url:\x26quot;http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72868520\x26quot;},\n                                            {Title:\x26quot;Node.js access_token的获取、存储及更新\x26quot;,Description:\x26quot;Node.js access_token的获取、存储及更新\x26quot;,PicUrl:\x26quot;http:\/\/img.blog.csdn.net\/20170528151333883?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x26quot;,Url:\x26quot;http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72783631\x26quot;},\n                                            {Title:\x26quot;Node.js 接入微信公众平台开发\x26quot;,Description:\x26quot;Node.js 接入微信公众平台开发\x26quot;,PicUrl:\x26quot;http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x26quot;,Url:\x26quot;http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72765279\x26quot;}\n                                        ];\n                                        \/\/回复图文消息\n                                        res.send(msg.graphicMsg(fromUser,toUser,contentArr));\n                                    break;\n                                default :\n                                         res.send(msg.txtMsg(fromUser,toUser,\x27没有这个选项哦\x27));\n                                    break;\n                           }\n                       }\n                   }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/判断消息类型\x3c\/span\x3e\n                   \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(result.MsgType.toLowerCase() === \x3cspan class=\x22hljs-string\x22\x3e\x22event\x22\x3c\/span\x3e){\n                        \x3cspan class=\x22hljs-comment\x22\x3e\/\/判断事件类型\x3c\/span\x3e\n                        \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(result.Event.toLowerCase()){\n                            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27subscribe\x27\x3c\/span\x3e:\n                                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/回复消息\x3c\/span\x3e\n                                    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e content = \x3cspan class=\x22hljs-string\x22\x3e\x22欢迎关注 hvkcoder 公众号，一起斗图吧。回复以下数字：\\n\x22\x3c\/span\x3e;\n                                        content \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x221.你是谁\\n\x22\x3c\/span\x3e;\n                                        content \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x222.关于Node.js\\n\x22\x3c\/span\x3e;\n                                        content \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x22回复 “文章”  可以得到图文推送哦~\\n\x22\x3c\/span\x3e;\n                                    res.send(msg.txtMsg(fromUser,toUser,\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e));\n                                    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e:\n                                        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e contentArr = [\n                                            {\x3cspan class=\x22hljs-attr\x22\x3eTitle\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js 微信自定义菜单\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eDescription\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22使用Node.js实现自定义微信菜单\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3ePicUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72868520\x22\x3c\/span\x3e},\n                                            {\x3cspan class=\x22hljs-attr\x22\x3eTitle\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js access_token的获取、存储及更新\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eDescription\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js access_token的获取、存储及更新\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3ePicUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/img.blog.csdn.net\/20170528151333883?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72783631\x22\x3c\/span\x3e},\n                                            {\x3cspan class=\x22hljs-attr\x22\x3eTitle\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js 接入微信公众平台开发\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eDescription\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js 接入微信公众平台开发\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3ePicUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72765279\x22\x3c\/span\x3e}\n                                        ];\n                                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/回复图文消息\x3c\/span\x3e\n                                    res.send(msg.graphicMsg(fromUser,toUser,contentArr));\n                                    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                        }\n                   }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                       \x3cspan class=\x22hljs-comment\x22\x3e\/\/判断消息类型为 文本消息\x3c\/span\x3e\n                       \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(result.MsgType.toLowerCase() === \x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e){\n                           \x3cspan class=\x22hljs-comment\x22\x3e\/\/根据消息内容返回消息信息\x3c\/span\x3e\n                           \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(result.Content){\n                               \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x271\x27\x3c\/span\x3e:\n                                        res.send(msg.txtMsg(fromUser,toUser,\x3cspan class=\x22hljs-string\x22\x3e\x27Hello ！我的英文名字叫 H-VK\x27\x3c\/span\x3e));\n                                    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                               \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x272\x27\x3c\/span\x3e:\n                                        res.send(msg.txtMsg(fromUser,toUser,\x3cspan class=\x22hljs-string\x22\x3e\x27Node.js是一个开放源代码、跨平台的JavaScript语言运行环境，采用Google开发的V8运行代码,使用事件驱动、非阻塞和异步输入输出模型等技术来提高性能，可优化应用程序的传输量和规模。这些技术通常用于数据密集的事实应用程序\x27\x3c\/span\x3e));\n                                    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                               \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27文章\x27\x3c\/span\x3e:\n                                      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e contentArr = [\n                                            {\x3cspan class=\x22hljs-attr\x22\x3eTitle\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js 微信自定义菜单\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eDescription\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22使用Node.js实现自定义微信菜单\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3ePicUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72868520\x22\x3c\/span\x3e},\n                                            {\x3cspan class=\x22hljs-attr\x22\x3eTitle\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js access_token的获取、存储及更新\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eDescription\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js access_token的获取、存储及更新\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3ePicUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/img.blog.csdn.net\/20170528151333883?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72783631\x22\x3c\/span\x3e},\n                                            {\x3cspan class=\x22hljs-attr\x22\x3eTitle\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js 接入微信公众平台开发\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eDescription\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22Node.js 接入微信公众平台开发\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3ePicUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/img.blog.csdn.net\/20170605162832842?watermark\/2\/text\/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHZrQ29kZXI=\/font\/5a6L5L2T\/fontsize\/400\/fill\/I0JBQkFCMA==\/dissolve\/70\/gravity\/SouthEast\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-attr\x22\x3eUrl\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/blog.csdn.net\/hvkcoder\/article\/details\/72765279\x22\x3c\/span\x3e}\n                                        ];\n                                        \x3cspan class=\x22hljs-comment\x22\x3e\/\/回复图文消息\x3c\/span\x3e\n                                        res.send(msg.graphicMsg(fromUser,toUser,contentArr));\n                                    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                                \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e :\n                                         res.send(msg.txtMsg(fromUser,toUser,\x3cspan class=\x22hljs-string\x22\x3e\x27没有这个选项哦\x27\x3c\/span\x3e));\n                                    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                           }\n                       }\n                   }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441036?w=570\x26amp;h=559\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441036?w=570\x26amp;h=559\x22 alt=\x22微信消息 文本消息处理\x22 title=\x22微信消息 文本消息处理\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441037?w=568\x26amp;h=546\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441037?w=568\x26amp;h=546\x22 alt=\x22微信消息 文本消息处理\x22 title=\x22微信消息 文本消息处理\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012441038?w=430\x26amp;h=430\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012441038?w=430\x26amp;h=430\x22 alt=\x22测试微信公众号\x22 title=\x22测试微信公众号\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e  OK ！至此我们就完成了微信消息管理的讲解，似乎真的没有什么难度。预留了一章，主要想要去细说一下说消息加解密，因为在网上涉及 Node.js 微信消息加解密的文章确实很少，微信帮助文档给的案例也没有 Node.js 的详细说明。\x3c\/p\x3e\n\x3cp\x3e  最后文章代码部分，由于网上编辑器的代码换行做的不是很好可能有些乱，建议可以去我的 github 上查看源码。\x3c\/p\x3e\n\x3cp\x3e  文章源代码：\x3ca href=\x22https:\/\/github.com\/SilenceHVK\/wechatByNode\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/SilenceHVK...\x3c\/a\x3e 。对文章有不正确之处，请给予纠正。github源代码请顺手给个 Star，最后感谢您的阅读。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>【Node.js 微信公众号实战】4.Node.js 微信消息管理</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012441020">https://segmentfault.com/a/1190000012441020</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/78n7amdph6s/" target="_blank">https://alili.tech/archive/78n7amdph6s/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>