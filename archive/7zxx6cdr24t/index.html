<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="node.js与比特币"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>node.js与比特币 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/7zxx6cdr24t/",
				"appid": "1613049289050283", 
				"title": "node.js与比特币 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-08T02:30:30"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/k5dxkv9wlt/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/sa7bszl2ne9/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f7zxx6cdr24t%2f&text=node.js%e4%b8%8e%e6%af%94%e7%89%b9%e5%b8%81"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f7zxx6cdr24t%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f7zxx6cdr24t%2f&text=node.js%e4%b8%8e%e6%af%94%e7%89%b9%e5%b8%81"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f7zxx6cdr24t%2f&title=node.js%e4%b8%8e%e6%af%94%e7%89%b9%e5%b8%81"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f7zxx6cdr24t%2f&is_video=false&description=node.js%e4%b8%8e%e6%af%94%e7%89%b9%e5%b8%81"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=node.js%e4%b8%8e%e6%af%94%e7%89%b9%e5%b8%81&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f7zxx6cdr24t%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f7zxx6cdr24t%2f&title=node.js%e4%b8%8e%e6%af%94%e7%89%b9%e5%b8%81"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f7zxx6cdr24t%2f&title=node.js%e4%b8%8e%e6%af%94%e7%89%b9%e5%b8%81"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f7zxx6cdr24t%2f&title=node.js%e4%b8%8e%e6%af%94%e7%89%b9%e5%b8%81"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f7zxx6cdr24t%2f&title=node.js%e4%b8%8e%e6%af%94%e7%89%b9%e5%b8%81"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">node.js与比特币</h1><div class="meta"><div class="postdate"><time datetime="2018-12-08" itemprop="datePublished">2018-12-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3eBTC中的utxo模型\x3c\/h2\x3e\n\x3cp\x3eBTC中引入了许多创新的概念与技术，\x3cstrong\x3e区块链、PoW共识、RSA加密、萌芽阶段的智能合约\x3c\/strong\x3e等名词是经常被圈内人所提及，诚然这些创新的实现使得BTC变成了一种有可靠性和安全性保证的封闭生态系统，但是在这个BTC生态中如果没有搭配区块链模式的转账模块，那么货币的流通属性也就无从谈起了。若要实现转账交易模块， “是否采用传统的账户模型实现交易；如何在区块链上存储交易信息，如何实现信息压缩；如何验证交易信息；系统的最大交易并发量”等问题确实值得思考。\x3c\/p\x3e\n\x3cp\x3eBTC一一解决了这些，它放弃了传统的基于账户的交易模型，而是采用基于区块链存储的utxo（unspent transaction output）模型。笔者尝试分析了为什么不使用传统的账户模型：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3eBTC的存储单元为区块链，区块链的数据结构本质上是单向链表，它并不是传统的关系型数据库，无法新建账户表\x3c\/li\x3e\n\x3cli\x3e存储压力。如果采用传统的方式，则账户表会随着时间的推移不停地增大，为后续的表的分片与备份造成很大困难\x3c\/li\x3e\n\x3cli\x3e易造成隐私泄露。账户表的信息会直观的暴露余额等敏感信息\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3eutxo模型则很有技巧的避免了这些，在utxo模型下实现的每一笔交易，都不需要显式的提供转账地址和接收地址（utxo中没有账户，也不需要提供地址），只需提供这比交易的 \x3cstrong\x3e交易输入\x3c\/strong\x3e 和 \x3cstrong\x3e交易输出\x3c\/strong\x3e 即可，而交易输入与交易输出又是什么？\x3c\/p\x3e\n\x3cp\x3e交易输入指向一笔交易输出，而且 “这笔交易输出是可以供转账者消费的，因此这笔交易输出也被称作utxo（未花费交易输出）”，它包括“某一笔交易、指向这笔交易的某个可用交易输出的索引值和一个解锁脚本”。这个解锁脚本用来验证某笔可用的消费输出是否可以被提供解锁脚本的人所使用。\x3c\/p\x3e\n\x3cp\x3e交易输出则是存储BTC“余额”的一个数据结构，它广义上包括两部分：BTC的数量和一个锁定脚本。 BTC的数量可以理解为余额，表示这笔交易产生的结果；而锁定脚本则是用某种算法锁定这个BTC余额，直到某人可以提供解锁该脚本的数据钥匙，这比数额BTC才会被这个人所消费。\x3c\/p\x3e\n\x3cp\x3e从这个角度看，一笔交易会包含若干个交易输入，同时产生若干个交易输出。这些交易输入都会指向之前某笔交易的未被消费输出（utxo），并提供各自的解锁脚本以证明这些utxo里的BTC是属于转账方；同时将转账产生的所有交易输出用对应方的公钥进行加密（此处是为了更好的理解才解释为公钥加密，实质上是公钥哈希，即btc地址进行逆向base58编码的一段字符串），锁定这几笔交易输出，等待交易输入中的解锁脚本解锁。\x3c\/p\x3e\n\x3cp\x3e所以，BTC没有账户的概念，所有的“余额”都在区块链上，不过这些余额都已经被加密了，只有提供私钥和签名的人才可以使用对应的utxo的余额，因此这就是为什么BTC持有者必须保存好自己的私钥的原因。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eUTXO的node.js实现\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e交易输入\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export class Input {\n    private txId: string;\n    private outputIndex: number;\n    private unlockScript: string;\n\n    public get $txId(): string {\n        return this.txId;\n    }\n\n    public set $txId(value: string) {\n        this.txId = value;\n    }\n    \n    public get $outputIndex(): number {\n        return this.outputIndex;\n    }\n\n    public set $outputIndex(value: number) {\n        this.outputIndex = value;\n    }\n\n    public get $unlockScript(): string {\n        return this.unlockScript;\n    }\n\n    public set $unlockScript(value: string) {\n        this.unlockScript = value;\n    }\n    \n    constructor(txId: string, index: number, unlockScript: string){\n        this.txId = txId;\n        this.outputIndex = index;\n        this.unlockScript = unlockScript;\n    }\n\n    \/\/ 反序列化，进行类型转换\n    public static createInputsFromUnserialize(objs: Array\x3cInput\x3e){\n        let ins = [];\n        objs.forEach((obj)=\x3e{\n            ins.push(new Input(obj.txId,obj.outputIndex,obj.unlockScript));\n        });\n        return ins;\n    }\n    \n    canUnlock (privateKey: string): boolean{\n        if(privateKey == this.unlockScript){\n            return true;\n        }else{\n            return false;\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e Input {\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e txId: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e outputIndex: \x3cspan class=\x22hljs-built_in\x22\x3enumber\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e unlockScript: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e $txId(): \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.txId;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e $txId(value: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.txId = value;\n    }\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e $outputIndex(): \x3cspan class=\x22hljs-built_in\x22\x3enumber\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputIndex;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e $outputIndex(value: \x3cspan class=\x22hljs-built_in\x22\x3enumber\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputIndex = value;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e $unlockScript(): \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unlockScript;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e $unlockScript(value: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unlockScript = value;\n    }\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etxId: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e, index: \x3cspan class=\x22hljs-built_in\x22\x3enumber\x3c\/span\x3e, unlockScript: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.txId = txId;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputIndex = index;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unlockScript = unlockScript;\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 反序列化，进行类型转换\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e createInputsFromUnserialize(objs: \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e\x26lt;Input\x26gt;){\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ins = [];\n        objs.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n            ins.push(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Input(obj.txId,obj.outputIndex,obj.unlockScript));\n        });\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e ins;\n    }\n    \n    canUnlock (privateKey: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e): \x3cspan class=\x22hljs-built_in\x22\x3eboolean\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(privateKey == \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unlockScript){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e私有属性txId标识 “某个可用的utxo所属的交易”，是一串sha256编码的字符串；\x3cbr\x3eoutputIndex表示 “这个可用的utxo在对应交易的序号值”；\x3cbr\x3eunlockScript则是解锁脚本，此处并未完全按照BTC的原型去实现，而是简单的验证使用者的私钥来实现鉴权，原理上仍遵从BTC的思想。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e交易输出\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import * as rsaConfig from \x27..\/..\/rsa.json\x27;\nexport class Output {\n    private value: number;\n    \/\/ 锁定脚本，需要使用UTXO归属者用私钥进行签名通过\n    \/\/ 当解锁UTXO成功后，此UTXO变为下一个交易的交易输入，同时使用接收方的地址（公钥）锁定本次交易的交易输出，\n    \/\/ 等待接收方使用私钥签名使用该UTXO\n    \/\/ 因此，btc没有账户的概念，所有的“钱”由自己的公钥所加密保存，只有用自己的私钥才能使用这些钱（即解锁了UTXO的解锁脚本）\n    private lockScript: string;\n\n    \/\/ 该属性仅仅在交易时使用，设置属性\n    private txId: string;\n\n    \/\/ 该属性仅仅在交易时使用，设置属性\n    private index: number;\n\n    public get $index(): number {\n        return this.index;\n    }\n\n    public set $index(value: number) {\n        this.index = value;\n    }\n    \n    public get $txId(): string {\n        return this.txId;\n    }\n\n    public set $txId(value: string) {\n        this.txId = value;\n    }\n    \n\n    public get $value(): number {\n        return this.value;\n    }\n\n    public set $value(value: number) {\n        this.value = value;\n    }\n\n    \/* public get $lockScript(): string {\n        return this.lockScript;\n    }\n\n    public set $lockScript(value: string) {\n        this.lockScript = value;\n    } *\/\n    \n    constructor(value: number,publicKey: string){\n        this.value = value;\n        this.lockScript = publicKey;\n    }\n\n    \/\/ 反序列化，进行类型转换\n    public static createOnputsFromUnserialize(objs: Array\x3cOutput\x3e){\n        let outs = [];\n        objs.forEach((obj)=\x3e{\n            outs.push(new Output(obj.value,obj.lockScript));\n        });\n        return outs;\n    }\n\n    public canUnlock(privateKey: string): boolean{\n        if(privateKey == rsaConfig[this.lockScript]){\n            return true;\n        }else{\n            return false;\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3eimport * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e rsaConfig \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/..\/rsa.json\x27\x3c\/span\x3e;\nexport \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eOutput\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e: number;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 锁定脚本，需要使用UTXO归属者用私钥进行签名通过\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当解锁UTXO成功后，此UTXO变为下一个交易的交易输入，同时使用接收方的地址（公钥）锁定本次交易的交易输出，\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 等待接收方使用私钥签名使用该UTXO\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 因此，btc没有账户的概念，所有的“钱”由自己的公钥所加密保存，只有用自己的私钥才能使用这些钱（即解锁了UTXO的解锁脚本）\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e lockScript: \x3cspan class=\x22hljs-keyword\x22\x3estring\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 该属性仅仅在交易时使用，设置属性\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e txId: \x3cspan class=\x22hljs-keyword\x22\x3estring\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 该属性仅仅在交易时使用，设置属性\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e index: number;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e $index(): number {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.index;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e $index(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e: number) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.index = \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e;\n    }\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e $txId(): \x3cspan class=\x22hljs-keyword\x22\x3estring\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.txId;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e $txId(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3estring\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.txId = \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e;\n    }\n    \n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e $\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e(): number {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e $\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e: number) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e;\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/* public get $lockScript(): string {\n        return this.lockScript;\n    }\n\n    public set $lockScript(value: string) {\n        this.lockScript = value;\n    } *\/\x3c\/span\x3e\n    \n    constructor(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e: number,publicKey: \x3cspan class=\x22hljs-keyword\x22\x3estring\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lockScript = publicKey;\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 反序列化，进行类型转换\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateOnputsFromUnserialize\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobjs: Array\x26lt;Output\x26gt;\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e outs = [];\n        objs.forEach((obj)=\x26gt;{\n            outs.push(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Output(obj.\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e,obj.lockScript));\n        });\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e outs;\n    }\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecanUnlock\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eprivateKey: \x3cspan class=\x22hljs-keyword\x22\x3estring\x3c\/span\x3e\x3c\/span\x3e): boolean\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(privateKey == rsaConfig[\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lockScript]){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e交易输出中的value属性标识当前utxo的余额，即BTC个数；\x3cbr\x3elockScript属性为锁定脚本，在我们的简易实现中就为接收方的公钥，并不是BTC中的逆波兰式，但大体原理相同，都需要提供私钥来进行解密。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e一笔交易\x3c\/h2\x3e\n\x3cp\x3e一笔交易，包含了若干个交易输入和交易输出，同时也提供了一个txId唯一的标识这比交易。从结构上看是这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export class Transaction {\n    private txId: string;\n    private inputTxs: Array\x3cInput\x3e;\n    private outputTxs: Array\x3cOutput\x3e;\n\n    constructor(txId: string, inputs: Array\x3cInput\x3e, outputs: Array\x3cOutput\x3e){\n        this.txId = txId;\n        this.inputTxs = inputs;\n        this.outputTxs = outputs;\n    }\n\n    public get $txId(): string {\n        return this.txId;\n    }\n\n    public set $txId(value: string) {\n        this.txId = value;\n    }\n\n    public get $inputTxs(): Array\x3cInput\x3e {\n        return this.inputTxs;\n    }\n\n    public set $inputTxs(value: Array\x3cInput\x3e) {\n        this.inputTxs = value;\n    }\n\n    public get $outputTxs(): Array\x3cOutput\x3e {\n        return this.outputTxs;\n    }\n\n    public set $outputTxs(value: Array\x3cOutput\x3e) {\n        this.outputTxs = value;\n    }\n    \/* \n        1.交易结构各字段序列化为字节数组\n        2.把字节数组拼接为支付串\n        3.对支付串计算两次SHA256 得到交易hash \n    *\/\n    public setTxId(){\n        let sha256 = crypto.createHash(\x27sha256\x27);\n        sha256.update(JSON.stringify(this.inputTxs) \x2b JSON.stringify(this.outputTxs) \x2b Date.now(),\x27utf8\x27);\n        this.txId = sha256.digest(\x27hex\x27);\n    }\n\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e Transaction {\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e txId: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e inputTxs: \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e\x26lt;Input\x26gt;;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e outputTxs: \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e\x26lt;Output\x26gt;;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etxId: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e, inputs: \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e\x26lt;Input\x26gt;, outputs: \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e\x26lt;Output\x26gt;\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.txId = txId;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.inputTxs = inputs;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputTxs = outputs;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e $txId(): \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.txId;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e $txId(value: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.txId = value;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e $inputTxs(): \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e\x26lt;Input\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.inputTxs;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e $inputTxs(value: \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e\x26lt;Input\x26gt;) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.inputTxs = value;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e $outputTxs(): \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e\x26lt;Output\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputTxs;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e $outputTxs(value: \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e\x26lt;Output\x26gt;) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputTxs = value;\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/* \n        1.交易结构各字段序列化为字节数组\n        2.把字节数组拼接为支付串\n        3.对支付串计算两次SHA256 得到交易hash \n    *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e setTxId(){\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e sha256 = crypto.createHash(\x3cspan class=\x22hljs-string\x22\x3e\x27sha256\x27\x3c\/span\x3e);\n        sha256.update(\x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.inputTxs) \x2b \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.outputTxs) \x2b \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now(),\x3cspan class=\x22hljs-string\x22\x3e\x27utf8\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.txId = sha256.digest(\x3cspan class=\x22hljs-string\x22\x3e\x27hex\x27\x3c\/span\x3e);\n    }\n\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中 txId的计算这里并没有严格按照BTC实现的那样进行计算，而是简单的进行对象序列化进行一次sha256。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3ecoinbase交易\x3c\/h3\x3e\n\x3cp\x3e我们都知道得到比特币需要挖矿，其实挖矿也属于一种交易，不过是一种没有确定交易输入的一种交易，它也被称作coinbase交易。coinbase交易在每一个区块中都会存在，它的总额包括了系统针对矿工打包交易过程的奖励以及其他转账方提供的手续费，如下图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014088254?w=2378\x26amp;h=1230\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014088254?w=2378\x26amp;h=1230\x22 alt=\x22coinbase交易\x22 title=\x22coinbase交易\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e因此，创建一个coinbase交易也很容易\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ coinbase交易用于给矿工奖励，input为空，output为矿工报酬\n    public static createCoinbaseTx(pubKey: string, info: string){\n        let input = new Input(\x27\x27,-1,info);\n        let output = new Output(AWARD, pubKey);\n        let tx = new Transaction(\x27\x27,[input],[output])\n        tx.setTxId();\n        return tx;\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ coinbase交易用于给矿工奖励，input为空，output为矿工报酬\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateCoinbaseTx\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epubKey: \x3cspan class=\x22hljs-keyword\x22\x3estring\x3c\/span\x3e, info: \x3cspan class=\x22hljs-keyword\x22\x3estring\x3c\/span\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e input = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Input(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e,info);\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e output = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Output(AWARD, pubKey);\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e tx = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Transaction(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,[input],[output])\n        tx.setTxId();\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e tx;\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在我们的实现中，只需提供锁定utxo的公钥以及一串描述字符串即可，最后设置交易的txId，完成coinbase交易的创建。\x3c\/p\x3e\n\x3cp\x3e也提供了识别coinbase交易的方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22public static isCoinbaseTx(tx: Transaction){\n    if(tx.$inputTxs.length == 1 \x26amp;\x26amp; tx.$inputTxs[0].$outputIndex == -1 \x26amp;\x26amp; tx.$inputTxs[0].$txId == \x27\x27){\n        return true;\n    }else{\n        return false;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e isCoinbaseTx(tx: Transaction){\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(tx.$inputTxs.length == \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x26amp;\x26amp; tx.$inputTxs[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].$outputIndex == \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e \x26amp;\x26amp; tx.$inputTxs[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].$txId == \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e;\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e;\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e至此，coinbase交易就完成了，这是最简单的一种交易，并没有涉及到转账方，也就是交易输入。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e转账交易\x3c\/h3\x3e\n\x3cp\x3e使用BTC就避免不了转账，转账事务在utxo模型的实现就是添加了一笔Transaction到某个区块而已。每一笔交易都需要交易输入和交易输出，因此在BTC中，转账的核心就是找到转账方的utxo进行消费，同时将指定数量的BTC划到指定的消费输出上，如果仍有剩余，则找零至自己的消费输出。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 创建转账交易\npublic static createTransaction(from: string, fromPubkey: string, fromKey: string, to: string, toPubkey: string, coin: number){\n    let outputs = this.findUTXOToTransfer(fromKey, coin);\n    console.log(`UTXOToTransfer： ${JSON.stringify(outputs)}, from: ${from} to ${to} transfer ${coin}`)\n    let inputTx = [], sum = 0, outputTx = [];\n    outputs.forEach((o)=\x3e{\n        sum \x2b= o.$value;\n        inputTx.push(new Input(o.$txId,o.$index,fromKey));\n    });\n\n    if(sum \x3c coin){\n        throw Error(`余额不足，转账失败! from ${from} to ${to} transfer ${coin}btc, but only have ${sum}btc`);\n    }\n\n    \/\/ 公钥锁住脚本\n    outputTx.push(new Output(coin,toPubkey));\n    if(sum \x3e coin){\n        outputTx.push(new Output(sum-coin,fromPubkey));\n    }\n    let tx = new Transaction(\x27\x27,inputTx,outputTx);\n    tx.setTxId();\n    return tx;\n}   \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建转账交易\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e createTransaction(\x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e, fromPubkey: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e, fromKey: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e, to: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e, toPubkey: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e, coin: \x3cspan class=\x22hljs-built_in\x22\x3enumber\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e outputs = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.findUTXOToTransfer(fromKey, coin);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`UTXOToTransfer： \x3cspan class=\x22hljs-subst\x22\x3e${JSON.stringify(outputs)}\x3c\/span\x3e, from: \x3cspan class=\x22hljs-subst\x22\x3e${from}\x3c\/span\x3e to \x3cspan class=\x22hljs-subst\x22\x3e${to}\x3c\/span\x3e transfer \x3cspan class=\x22hljs-subst\x22\x3e${coin}\x3c\/span\x3e`\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e inputTx = [], sum = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, outputTx = [];\n    outputs.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eo\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n        sum \x2b= o.$value;\n        inputTx.push(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Input(o.$txId,o.$index,fromKey));\n    });\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(sum \x26lt; coin){\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e`余额不足，转账失败! from \x3cspan class=\x22hljs-subst\x22\x3e${from}\x3c\/span\x3e to \x3cspan class=\x22hljs-subst\x22\x3e${to}\x3c\/span\x3e transfer \x3cspan class=\x22hljs-subst\x22\x3e${coin}\x3c\/span\x3ebtc, but only have \x3cspan class=\x22hljs-subst\x22\x3e${sum}\x3c\/span\x3ebtc`\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 公钥锁住脚本\x3c\/span\x3e\n    outputTx.push(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Output(coin,toPubkey));\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(sum \x26gt; coin){\n        outputTx.push(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Output(sum-coin,fromPubkey));\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e tx = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Transaction(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,inputTx,outputTx);\n    tx.setTxId();\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e tx;\n}   \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e创建一个交易，需要提供转账方的地址（公钥哈希）、转账方的公钥和私钥、接收方的地址、接收方的公钥以及转账的BTC数量。这笔交易由转账发发起，因此需要提供转账方的私钥进行解锁脚本。\x3c\/p\x3e\n\x3cp\x3e首先，通过 \x3cstrong\x3efindUTXOToTransfer\x3c\/strong\x3e 找到满足转账数量的可用的utxo，它需要提供转账方的私钥以及转账数量；\x3cbr\x3e接下来根据获得的可用utxo，进行创建对应的交易输入；\x3cbr\x3e然后用接收方的公钥加密交易输出，同时如果有余额的化找零给自己，用自己的公钥加密；\x3cbr\x3e最后根据得到的交易输入与交易输出，创建一笔交易，计算txId，加入到区块中（我们的demo是在单机下进行模拟，并未实现多播），等待挖矿。\x3c\/p\x3e\n\x3cp\x3e转账的核心在于 \x3cstrong\x3efindUTXOToTransfer\x3c\/strong\x3e，在findUTXOToTransfer中，通过调用 \x3cstrong\x3egetAllUnspentOutputTx\x3c\/strong\x3e拿到所有的可用的utxo，并筛选出满足给定数量BTC的utxo。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22public static getAllUnspentOutputTx(secreteKey: string): Array\x3cTransaction\x3e{\n    let outputIndexHash: Object = this.getAllSpentOutput(secreteKey);\n    let unspentOutputsTx = [];\n    let keys = Object.keys(outputIndexHash);\n    let block = BlockDao.getSingletonInstance().getBlock(chain.$lastACKHash);\n    while(block \x26amp;\x26amp; block instanceof Block){\n        block.$txs \x26amp;\x26amp; block.$txs.forEach((tx)=\x3e{\n            if(keys.includes(tx.$txId)){\n                tx.$outputTxs.forEach((output,i)=\x3e{\n                    \/\/ 过滤已消费的output\n                    if(i == outputIndexHash[tx.$txId])\n                        return;\n                    \n                    if(output.canUnlock(secreteKey)){\n                        unspentOutputsTx.push(tx);\n                    }    \n                });\n            }else{\n                for(let i=0,len=tx.$outputTxs.length;i\x3clen;i\x2b\x2b){\n                    let output = tx.$outputTxs[i];\n                    if(output.canUnlock(secreteKey)){\n                        unspentOutputsTx.push(tx);\n                        break;\n                    }    \n                }\n            }\n        });\n        block = BlockDao.getSingletonInstance().getBlock(block.$prevHash);\n    }\n    return unspentOutputsTx;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e getAllUnspentOutputTx(secreteKey: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e): \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e\x26lt;Transaction\x26gt;{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e outputIndexHash: \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getAllSpentOutput(secreteKey);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e unspentOutputsTx = [];\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e keys = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(outputIndexHash);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e block = BlockDao.getSingletonInstance().getBlock(chain.$lastACKHash);\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(block \x26amp;\x26amp; block \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e Block){\n        block.$txs \x26amp;\x26amp; block.$txs.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3etx\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(keys.includes(tx.$txId)){\n                tx.$outputTxs.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eoutput,i\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 过滤已消费的output\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(i == outputIndexHash[tx.$txId])\n                        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n                    \n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(output.canUnlock(secreteKey)){\n                        unspentOutputsTx.push(tx);\n                    }    \n                });\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i=\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,len=tx.$outputTxs.length;i\x26lt;len;i\x2b\x2b){\n                    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e output = tx.$outputTxs[i];\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(output.canUnlock(secreteKey)){\n                        unspentOutputsTx.push(tx);\n                        \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                    }    \n                }\n            }\n        });\n        block = BlockDao.getSingletonInstance().getBlock(block.$prevHash);\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e unspentOutputsTx;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在getAllUnspentOutputTx中，通过 \x3cstrong\x3egetAllSpentOutput\x3c\/strong\x3e 遍历本地持久化的区块链，拿到所有的可供消费utxo，这些utxo并不仅仅属于转账方，因此需要在针对每个utxo尝试进行验证逻辑，即output.canUnlock(secreteKey)。验证通过则证明这是属于转账方的BTC，可以用于交易。\x3c\/p\x3e\n\x3cp\x3e在getAllSpentOutput中，通过遍历每一个交易输入获取它指向前面交易的某个utxo来得到所有的utxo，当然对于coinbase交易我们无法找到他的交易输入，因此会进行过滤。\x3c\/p\x3e\n\x3cp\x3e至此，utxo的转账流程已经完成，下面需要做的就是把这比交易加入到区块中了，这已不是本文的核心。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e尾声\x3c\/h2\x3e\n\x3cp\x3e本文所讲的utxo示例是基于作者对BTC实现的基础上的简单实现，有不当之处还请读者指出。另外，本文的代码开源在 \x3ca href=\x22https:\/\/github.com\/royalrover\/ts-btc\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/royalrover...\x3c\/a\x3e 的 \x3cstrong\x3efeature\/utxo分支\x3c\/strong\x3e 上，希望大家一起提建议！\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>node.js与比特币</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014088249">https://segmentfault.com/a/1190000014088249</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/7zxx6cdr24t/" target="_blank">https://alili.tech/archive/7zxx6cdr24t/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>