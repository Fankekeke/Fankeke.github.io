<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="在浏览器端用H5实现图片压缩上传"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>在浏览器端用H5实现图片压缩上传 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/82ln1zh06r3/",
				"appid": "1613049289050283", 
				"title": "在浏览器端用H5实现图片压缩上传 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-20T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/7afqimd3bwe/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/t1594q23ki/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f82ln1zh06r3%2f&text=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e7%94%a8H5%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9%e4%b8%8a%e4%bc%a0"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f82ln1zh06r3%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f82ln1zh06r3%2f&text=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e7%94%a8H5%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9%e4%b8%8a%e4%bc%a0"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f82ln1zh06r3%2f&title=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e7%94%a8H5%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9%e4%b8%8a%e4%bc%a0"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f82ln1zh06r3%2f&is_video=false&description=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e7%94%a8H5%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9%e4%b8%8a%e4%bc%a0"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e7%94%a8H5%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9%e4%b8%8a%e4%bc%a0&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f82ln1zh06r3%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f82ln1zh06r3%2f&title=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e7%94%a8H5%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9%e4%b8%8a%e4%bc%a0"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f82ln1zh06r3%2f&title=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e7%94%a8H5%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9%e4%b8%8a%e4%bc%a0"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f82ln1zh06r3%2f&title=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e7%94%a8H5%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9%e4%b8%8a%e4%bc%a0"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f82ln1zh06r3%2f&title=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e7%94%a8H5%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9%e4%b8%8a%e4%bc%a0"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">在浏览器端用H5实现图片压缩上传</h1><div class="meta"><div class="postdate"><time datetime="2018-12-20" itemprop="datePublished">2018-12-20</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cstrong\x3e一、需求的场景：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e在我们的需求中需要有一个在手机浏览器端，用户实现上传证件照片的功能，我们第一版上了一个最简版，直接让用户在本地选择图片，然后上传到公司公共的服务器上。\x3cbr\x3e   功能实现后我们发现一个问题，公司公共的服务器有2M图片的限制，而用户手机目前绝大多数都支持高清拍照，尺寸普遍在3000\x2b x 2000\x2b的大小；\x3c\/blockquote\x3e\n\x3cblockquote\x3e所以我们采用了在浏览器端通过HTML5的fileReader接口来处理上传文件的大小，将重新处理压缩后的文件在传给后端，这样在保证了图片基本质量（由于证件图片，我们只关心证件号码是否清晰）的情况下，也能够做到网络传输内容的最小化，让上传变得更快，给用户较好的体验。\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e二、逐步分析\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e首先我们上传的文件在input事件的默认参数里面是一个file类型，他是Binary Large Object的一个子集，需要将Blob类型转换成DataUrl，能够被HTML5本地的Canvas画布解析，通过Canvas画布根据一定的压缩比例重新压缩后，再将图片转换成Blob传到公司公共的图片服务器上。\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22select local file -\x3e Blob -\x3e DataUrl -\x3e Canvas compress -\x3e DataUrl -\x3e Blob -\x3e Upload file\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xl\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3eselect\x3c\/span\x3e local file -\x26gt;\x3c\/span\x3e B\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3elob\x3c\/span\x3e -\x26gt;\x3c\/span\x3e D\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3eataUrl\x3c\/span\x3e -\x26gt;\x3c\/span\x3e C\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3eanvas\x3c\/span\x3e compress -\x26gt;\x3c\/span\x3e D\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3eataUrl\x3c\/span\x3e -\x26gt;\x3c\/span\x3e B\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3elob\x3c\/span\x3e -\x26gt;\x3c\/span\x3e Upload file\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e三、具体实现逻辑\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e1，监听本地input框change事件，当内容变化，从回调函数的参数中拿到file文件；\x3cbr\x3e2，判断当前浏览器是否支持本地压缩（是否支持HTML5的fileReader方法）；\x3cbr\x3e3，如果不支持本地压缩，采用传统方式直接将原始图片上传到服务器上；\x3cbr\x3e4，如果支持浏览器的本地压缩，那么进入到本地压缩的流程；\x3cbr\x3e5，压缩完成后将最新的blob类型文件传递到公司服务器上；\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22        \/\/ 用户在浏览器本地选择上传图片\n        \/*\n        * option = {\n        *       el: element, \/\/ input file element\n        *       width: 800,\n        *       height: 600,\n        *       rate: 1,\n        *       cb: callback\n        * }\n        *\n        *\/\n        function compressUploadImageAsClient(option) {\n            var opt = {\n                el: option.el,\n                width: option.width || 800,\n                height: option.height || 600,\n                rate: option.rate || 1,\n                cb: option.cb || function() {},\n                postUrl: option.postUrl || \x27\x27,\n                postLoad: option.postLoad || function() {},\n                postError: option.postError || function() {},\n                postAbort: option.postAbort || function() {}\n            };\n\n            opt.el.addEventListener(\x27change\x27, function(e) {\n                \/\/ 如果不支持H5的filereader方法，直接用原图上传\n                if(typeof FileReader != \x27function\x27) {\n                    \/\/ sendFile(e.target.files);\n                    postFileToServer([e.target.files[0]], opt.postUrl, opt.postLoad, opt.postError, opt.postAbort);\n                    return;\n                }\n\n                \/\/ 将blob类型转换成DataUrl\n                readBlobAsDataURL(e.target.files[0], function(url, size) {\n                      \/\/ 拿到url类型的图片之后，通过canvas进行压缩转换\n                    readBase64AsBlob({\n                        url: url,\n                        size: size,\n                        width: 800,\n                        height: 600,\n                        rate: 1,\n                        callback: function(dataUrl) {\n                            \/\/ 在压缩完成的回调函数中得到最新的图片DataUrl，将其转换成服务端接口能够识别的Blob类型\n                            var blob = dataURLtoBlob(dataUrl);\n                            \/\/ 调用上传服务器图片的接口\n                            postFileToServer([blob], opt.postUrl, opt.postLoad, opt.postError, opt.postAbort);\n                        }\n                    });\n                    \n                });\n            }, false)\n        }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用户在浏览器本地选择上传图片\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*\n        * option = {\n        *       el: element, \/\/ input file element\n        *       width: 800,\n        *       height: 600,\n        *       rate: 1,\n        *       cb: callback\n        * }\n        *\n        *\/\x3c\/span\x3e\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecompressUploadImageAsClient\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoption\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e opt = {\n                \x3cspan class=\x22hljs-attribute\x22\x3eel\x3c\/span\x3e: option.el,\n                \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: option.width || \x3cspan class=\x22hljs-number\x22\x3e800\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: option.height || \x3cspan class=\x22hljs-number\x22\x3e600\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attribute\x22\x3erate\x3c\/span\x3e: option.rate || \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attribute\x22\x3ecb\x3c\/span\x3e: option.cb || \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{},\n                \x3cspan class=\x22hljs-attribute\x22\x3epostUrl\x3c\/span\x3e: option.postUrl || \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attribute\x22\x3epostLoad\x3c\/span\x3e: option.postLoad || \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{},\n                \x3cspan class=\x22hljs-attribute\x22\x3epostError\x3c\/span\x3e: option.postError || \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{},\n                \x3cspan class=\x22hljs-attribute\x22\x3epostAbort\x3c\/span\x3e: option.postAbort || \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{}\n            };\n\n            opt.el.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27change\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果不支持H5的filereader方法，直接用原图上传\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e FileReader != \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ sendFile(e.target.files);\x3c\/span\x3e\n                    postFileToServer([e.target.files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]], opt.postUrl, opt.postLoad, opt.postError, opt.postAbort);\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n                }\n\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将blob类型转换成DataUrl\x3c\/span\x3e\n                readBlobAsDataURL(e.target.files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e], \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, size\x3c\/span\x3e) \x3c\/span\x3e{\n                      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 拿到url类型的图片之后，通过canvas进行压缩转换\x3c\/span\x3e\n                    readBase64AsBlob({\n                        \x3cspan class=\x22hljs-attribute\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e,\n                        \x3cspan class=\x22hljs-attribute\x22\x3esize\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3esize\x3c\/span\x3e,\n                        \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e800\x3c\/span\x3e,\n                        \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e600\x3c\/span\x3e,\n                        \x3cspan class=\x22hljs-attribute\x22\x3erate\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n                        \x3cspan class=\x22hljs-attribute\x22\x3ecallback\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edataUrl\x3c\/span\x3e) \x3c\/span\x3e{\n                            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在压缩完成的回调函数中得到最新的图片DataUrl，将其转换成服务端接口能够识别的Blob类型\x3c\/span\x3e\n                            \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e blob = dataURLtoBlob(dataUrl);\n                            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用上传服务器图片的接口\x3c\/span\x3e\n                            postFileToServer([blob], opt.postUrl, opt.postLoad, opt.postError, opt.postAbort);\n                        }\n                    });\n                    \n                });\n            }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n        }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22        \/\/ file对象转换成dataurl\n        function readBlobAsDataURL(blob, callback) {\n            var a = new FileReader();\n            a.onload = function(e) {\n                callback(e.target.result, blob.size);\n            };\n            a.readAsDataURL(blob);\n        }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ file对象转换成dataurl\x3c\/span\x3e\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereadBlobAsDataURL\x3c\/span\x3e\x3c\/span\x3e(blob, \x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e a = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eFileReader\x3c\/span\x3e();\n            a.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(e) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e(e.target.result, blob.size);\n            };\n            a.readAsDataURL(blob);\n        }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22        \/\/ dataurl转换成blob\n        function dataURLtoBlob(dataurl) {\n        var arr = dataurl.split(\x27,\x27), mime = arr[0].match(\/:(.*?);\/)[1],\n            bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\n            while(n--){\n                u8arr[n] = bstr.charCodeAt(n);\n            }\n            return new Blob([u8arr], {type:mime});\n        }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ dataurl转换成blob\x3c\/span\x3e\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edataURLtoBlob\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edataurl\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e arr = dataurl.split(\x3cspan class=\x22hljs-string\x22\x3e\x27,\x27\x3c\/span\x3e), mime = arr[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].match(\x3cspan class=\x22hljs-regexp\x22\x3e\/:(.*?);\/\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\n            bstr = atob(arr[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]), n = bstr.length, u8arr = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eUint8Array\x3c\/span\x3e(n);\n            \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(n--){\n                u8arr[n] = bstr.charCodeAt(n);\n            }\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Blob([u8arr], {\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e:mime});\n        }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22        \/\/ blob转换成dataUrl，并且通过canvas画布压缩重新生成新的dataUrl\n        \/*\n        * option: {\n        *     url: image url,\n        *     size: image size,\n        *     width: 800,\n        *     height: 600,\n        *     rate: 1,\n        *     callback: callback\n        * }\n        *\/\n        function readBase64AsBlob(option) {\n\n            var opt = {\n                url: option.url,\n                size: option.size,\n                width: option.width || 800,\n                height: option.height || 600,\n                rate: option.rate || 0.6,\n                callback: option.callback || function(url) {}\n            };\n\n            var img = new Image();\n            img.src = opt.url;\n            img.onload = function(){\n                var canvas = document.createElement(\x26quot;canvas\x26quot;), \/\/创建canvas元素\n                    width = img.width, \/\/确保canvas的尺寸和图片一样\n                    height = img.height;\n\n                console.log(\x27压缩前图片的尺寸大小：\x27, width, height);\n                \/\/ 根据最大尺寸 800x600的大小，按比例重新设置图片的尺寸\n                var neww = opt.width;\n                var newh = opt.height;\n                \/\/ 当图片的宽高分别大于800，600的情况下，在对其进行尺寸的压缩（尺寸压缩对最终size的减小有很大作用）\n                if(width \x3e opt.width \x26amp;\x26amp; height \x3e opt.height) {\n                    if(height\/width \x3e opt.height\/opt.width) {\n                        newh = opt.height;\n                        neww = (opt.height\/height) * width;\n                    } else {\n                        newh = (opt.width\/width) * height;\n                        neww = opt.width;\n                    }\n                }\n\n                \/\/ 压缩率\n                var rate = opt.rate;\n                if(opt.size \x3c 1024*1024*2) {\n                    \/\/ 小于2m处理;\n                    rate = opt.rate * 0.6;\n                } else if(opt.size \x3c 1024*1024*4) {\n                    \/\/ 2m到4m之间\n                    rate = opt.rate * 0.4;\n                } else if(opt.size \x3c 1024*1024*8) {\n                    \/\/ 4m到8m之间\n                    rate = opt.rate * 0.3;\n                } else {\n                    \/\/ 大于8m的图片\n                    rate = opt.rate * 0.2;\n                }\n\n                canvas.width = neww;\n                canvas.height = newh;\n                canvas.getContext(\x26quot;2d\x26quot;).drawImage(img, 0, 0, neww, newh); \/\/将图片绘制到canvas中\n                var dataURL = canvas.toDataURL(\x27image\/jpeg\x27, rate); \/\/转换图片为dataURL\n                \n                opt.callback(dataURL);\n            }\n        }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ blob转换成dataUrl，并且通过canvas画布压缩重新生成新的dataUrl\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*\n        * option: {\n        *     url: image url,\n        *     size: image size,\n        *     width: 800,\n        *     height: 600,\n        *     rate: 1,\n        *     callback: callback\n        * }\n        *\/\x3c\/span\x3e\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereadBase64AsBlob\x3c\/span\x3e\x3c\/span\x3e(option) {\n\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e opt = {\n                url: \x3cspan class=\x22hljs-type\x22\x3eoption\x3c\/span\x3e.url,\n                size: \x3cspan class=\x22hljs-type\x22\x3eoption\x3c\/span\x3e.size,\n                width: \x3cspan class=\x22hljs-type\x22\x3eoption\x3c\/span\x3e.width || \x3cspan class=\x22hljs-number\x22\x3e800\x3c\/span\x3e,\n                height: \x3cspan class=\x22hljs-type\x22\x3eoption\x3c\/span\x3e.height || \x3cspan class=\x22hljs-number\x22\x3e600\x3c\/span\x3e,\n                rate: \x3cspan class=\x22hljs-type\x22\x3eoption\x3c\/span\x3e.rate || \x3cspan class=\x22hljs-number\x22\x3e0.6\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e: \x3cspan class=\x22hljs-type\x22\x3eoption\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e || \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(url) {}\n            };\n\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e img = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eImage\x3c\/span\x3e();\n            img.src = opt.url;\n            img.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(){\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e canvas = document.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x22canvas\x22\x3c\/span\x3e), \x3cspan class=\x22hljs-comment\x22\x3e\/\/创建canvas元素\x3c\/span\x3e\n                    width = img.width, \x3cspan class=\x22hljs-comment\x22\x3e\/\/确保canvas的尺寸和图片一样\x3c\/span\x3e\n                    height = img.height;\n\n                console.log(\x3cspan class=\x22hljs-string\x22\x3e\x27压缩前图片的尺寸大小：\x27\x3c\/span\x3e, width, height);\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 根据最大尺寸 800x600的大小，按比例重新设置图片的尺寸\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ew\x3c\/span\x3e = opt.width;\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eh\x3c\/span\x3e = opt.height;\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当图片的宽高分别大于800，600的情况下，在对其进行尺寸的压缩（尺寸压缩对最终size的减小有很大作用）\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(width \x26gt; opt.width \x26amp;\x26amp; height \x26gt; opt.height) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(height\/width \x26gt; opt.height\/opt.width) {\n                        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eh\x3c\/span\x3e = opt.height;\n                        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ew\x3c\/span\x3e = (opt.height\/height) * width;\n                    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eh\x3c\/span\x3e = (opt.width\/width) * height;\n                        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ew\x3c\/span\x3e = opt.width;\n                    }\n                }\n\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 压缩率\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e rate = opt.rate;\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(opt.size \x26lt; \x3cspan class=\x22hljs-number\x22\x3e1024\x3c\/span\x3e*\x3cspan class=\x22hljs-number\x22\x3e1024\x3c\/span\x3e*\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) {\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 小于2m处理;\x3c\/span\x3e\n                    rate = opt.rate * \x3cspan class=\x22hljs-number\x22\x3e0.6\x3c\/span\x3e;\n                } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(opt.size \x26lt; \x3cspan class=\x22hljs-number\x22\x3e1024\x3c\/span\x3e*\x3cspan class=\x22hljs-number\x22\x3e1024\x3c\/span\x3e*\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e) {\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 2m到4m之间\x3c\/span\x3e\n                    rate = opt.rate * \x3cspan class=\x22hljs-number\x22\x3e0.4\x3c\/span\x3e;\n                } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(opt.size \x26lt; \x3cspan class=\x22hljs-number\x22\x3e1024\x3c\/span\x3e*\x3cspan class=\x22hljs-number\x22\x3e1024\x3c\/span\x3e*\x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e) {\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 4m到8m之间\x3c\/span\x3e\n                    rate = opt.rate * \x3cspan class=\x22hljs-number\x22\x3e0.3\x3c\/span\x3e;\n                } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 大于8m的图片\x3c\/span\x3e\n                    rate = opt.rate * \x3cspan class=\x22hljs-number\x22\x3e0.2\x3c\/span\x3e;\n                }\n\n                canvas.width = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ew\x3c\/span\x3e;\n                canvas.height = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eh\x3c\/span\x3e;\n                canvas.getContext(\x3cspan class=\x22hljs-string\x22\x3e\x222d\x22\x3c\/span\x3e).drawImage(img, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3ew\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eh\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/将图片绘制到canvas中\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dataURL = canvas.toDataURL(\x3cspan class=\x22hljs-string\x22\x3e\x27image\/jpeg\x27\x3c\/span\x3e, rate); \x3cspan class=\x22hljs-comment\x22\x3e\/\/转换图片为dataURL\x3c\/span\x3e\n                \n                opt.\x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e(dataURL);\n            }\n        }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22        \/\/ 通过ajax上传图片到公司服务器上\n        function postFileToServer(files, posturl, success, fail, abort) {\n            if (!files || files.length \x3c 1) {\n                alert(\x27上传的文件不能为空\x27);\n                return;\n            }\n\n            alert(\x27压缩后的图片对象：\x27 \x2b files[0].size);\n         \n            var formData = new FormData();     \/\/ 创建一个表单对象FormData\n            \/\/ formData.append(\x27submit\x27, \x27Submit\x27);  \/\/ 往表单对象添加文本字段\n             \n             var fileNames = \x27\x27;\n            for (var i = 0; i \x3c files.length; i\x2b\x2b) {\n                var file = files[i];    \/\/ file 对象有 name, size 属性\n                formData.append( \x27file[\x27 \x2b i \x2b \x27]\x27, file);       \/\/ 往FormData对象添加File对象\n                fileNames \x2b= file.name \x2b \x27 \x27;\n            }\n\n            var xhr = new XMLHttpRequest();\n            xhr.addEventListener(\x27load\x27, function(e) {\n                success(e);\n            }, false);\n\n            xhr.addEventListener(\x27error\x27, function(e) {\n                error(e);\n            }, false);\n\n            xhr.addEventListener(\x27abort\x27, function(e) {\n                abort(e);\n            });\n\n            xhr.open(\x27post\x27, posturl, true);\n            xhr.send(formData);\n        }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过ajax上传图片到公司服务器上\x3c\/span\x3e\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epostFileToServer\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(files, posturl, success, fail, abort)\x3c\/span\x3e \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!files || files.length \x26lt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n                alert(\x3cspan class=\x22hljs-string\x22\x3e\x27上传的文件不能为空\x27\x3c\/span\x3e);\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n            }\n\n            alert(\x3cspan class=\x22hljs-string\x22\x3e\x27压缩后的图片对象：\x27\x3c\/span\x3e \x2b files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].size);\n         \n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e formData = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FormData();     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建一个表单对象FormData\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ formData.append(\x27submit\x27, \x27Submit\x27);  \/\/ 往表单对象添加文本字段\x3c\/span\x3e\n             \n             \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fileNames = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; files.length; i\x2b\x2b) {\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e file = files[i];    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ file 对象有 name, size 属性\x3c\/span\x3e\n                formData.append( \x3cspan class=\x22hljs-string\x22\x3e\x27file[\x27\x3c\/span\x3e \x2b i \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27]\x27\x3c\/span\x3e, file);       \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 往FormData对象添加File对象\x3c\/span\x3e\n                fileNames \x2b= file.name \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e;\n            }\n\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e xhr = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e XMLHttpRequest();\n            xhr.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(e)\x3c\/span\x3e \x3c\/span\x3e{\n                success(e);\n            }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\n            xhr.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(e)\x3c\/span\x3e \x3c\/span\x3e{\n                error(e);\n            }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\n            xhr.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27abort\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(e)\x3c\/span\x3e \x3c\/span\x3e{\n                abort(e);\n            });\n\n            xhr.open(\x3cspan class=\x22hljs-string\x22\x3e\x27post\x27\x3c\/span\x3e, posturl, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n            xhr.send(formData);\n        }\x3c\/code\x3e\x3c\/pre\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>在浏览器端用H5实现图片压缩上传</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012608763">https://segmentfault.com/a/1190000012608763</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/82ln1zh06r3/" target="_blank">https://alili.tech/archive/82ln1zh06r3/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>