<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Express 实战（三）：Express 基础"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Express 实战（三）：Express 基础 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/89u6woy7q88/",
				"appid": "1613049289050283", 
				"title": "Express 实战（三）：Express 基础 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-03T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/bgzrztky2v/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/e6a7t0crjp7/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f89u6woy7q88%2f&text=Express%20%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9aExpress%20%e5%9f%ba%e7%a1%80"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f89u6woy7q88%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f89u6woy7q88%2f&text=Express%20%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9aExpress%20%e5%9f%ba%e7%a1%80"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f89u6woy7q88%2f&title=Express%20%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9aExpress%20%e5%9f%ba%e7%a1%80"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f89u6woy7q88%2f&is_video=false&description=Express%20%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9aExpress%20%e5%9f%ba%e7%a1%80"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Express%20%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9aExpress%20%e5%9f%ba%e7%a1%80&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f89u6woy7q88%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f89u6woy7q88%2f&title=Express%20%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9aExpress%20%e5%9f%ba%e7%a1%80"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f89u6woy7q88%2f&title=Express%20%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9aExpress%20%e5%9f%ba%e7%a1%80"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f89u6woy7q88%2f&title=Express%20%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9aExpress%20%e5%9f%ba%e7%a1%80"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f89u6woy7q88%2f&title=Express%20%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9aExpress%20%e5%9f%ba%e7%a1%80"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Express 实战（三）：Express 基础</h1><div class="meta"><div class="postdate"><time datetime="2019-01-03" itemprop="datePublished">2019-01-03</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3eExpress 框架的初衷是为了拓展 Node 内置模块的功能提高开发效率。当你深入研究后就会发现，Express 其实是在 Node 内置的 HTTP 模块上构建了一层抽象。理论上所有 Express 实现的功能，同样可以使用纯 Node 实现。\x3c\/p\x3e\n\x3cp\x3e在本文中，我们将基于前面的 Node 内容去探究 Express 和 Node 之间的关系，其中包括：中间件和路由等概念。当然，这里只会进行一些综述具体的细节会在后面带来。\x3c\/p\x3e\n\x3cp\x3e总的来说，Express 提供了 4 个主要特性：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e与纯 Node 中使用一个函数处理所有请求的代码不同， Express 则使用“中间件栈”处理流。\x3c\/li\x3e\n\x3cli\x3e路由与中间件类似，只有当你通过特定 HTTP 方法访问特定 URL 时才会触发处理函数的调用。\x3c\/li\x3e\n\x3cli\x3e对 request 和 response 对象方法进行了拓展。\x3c\/li\x3e\n\x3cli\x3e视图模块允许你动态渲染和改变 HTML 内容，并且使用其他语言编写 HTML 。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x26lt;!--more--\x26gt;\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e中间件\x3c\/h2\x3e\n\x3cp\x3e中间件是 Express 中最大的特性之一。中间件与原生的 Node 处理函数非常类似（接受一个请求并做出响应），但是与原生不同的是，中间件将处理过程进行划分，并且使用多个函数构成一个完整的处理流程。\x3c\/p\x3e\n\x3cp\x3e我们将会看到中间件在代码中的各种应用。例如，首先使用一个中间件记录所有的请求，接着在其他的中间件中设置 HTTP 头部信息，然后继续处理流程。虽然在一个“大函数”中也可以完成请求处理，但是将任务进行拆分为多个功能明确独立的中间件明显更符合软件开发中的 SRP 规则。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e中间件并不是 Express 特有，Python 的 Django 或者 PHP 的 Laravel 也有同样的概念存在。同样的 Ruby 的 Web 框架中也有被称为 Rack 中间件概念。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e现在我们就用 Express 中间件来重新实现 Hello World 应用。你将会发现只需几行代码就能完成开发，在提高效率的同时还消除了一些隐藏 bug。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3eExpress 版 Hello World\x3c\/h3\x3e\n\x3cp\x3e首先新建一个Express工程：新建一个文件夹并在其中新建 package.json 文件。回想一下 package.json 的工作原理，其中完整的列出了该工程的依赖、项目名称、作者等信息。我们新工程中的  package.json 大致如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n\x26nbsp; \x26quot;name\x26quot;: \x26quot;hello-world\x26quot;,\n\x26nbsp; \x26quot;author\x26quot;: \x26quot;Your Name Here!\x26quot;,\n\x26nbsp; \x26quot;private\x26quot;: true,\n\x26nbsp; \x26quot;dependencies\x26quot;: {}\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22JSON\x22\x3e{\n\x26nbsp; \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22hello-world\x22\x3c\/span\x3e,\n\x26nbsp; \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Your Name Here!\x22\x3c\/span\x3e,\n\x26nbsp; \x3cspan class=\x22hljs-attr\x22\x3e\x22private\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n\x26nbsp; \x3cspan class=\x22hljs-attr\x22\x3e\x22dependencies\x22\x3c\/span\x3e: {}\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来执行命令，安装最新的 Express 并且将其保存到 package.json 中：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3enpm install express -sava\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e命令执行完成后，Express 会自动安装到 \x3cem\x3enode_modules\x3c\/em\x3e 的文件下，并且会在 package.json 明确列出改依赖。此时 package.json  中的内容如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n\x26nbsp; \x26quot;name\x26quot;: \x26quot;hello-world\x26quot;,\n\x26nbsp; \x26quot;author\x26quot;: \x26quot;Your Name Here!\x26quot;,\n\x26nbsp; \x26quot;private\x26quot;: true,\n\x26nbsp; \x26quot;dependencies\x26quot;: {\n\x26nbsp;       \x26quot;express\x26quot;: \x26quot;^5.0.0\x26quot;\n\x26nbsp; }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22JSON\x22\x3e{\n\x26nbsp; \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22hello-world\x22\x3c\/span\x3e,\n\x26nbsp; \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Your Name Here!\x22\x3c\/span\x3e,\n\x26nbsp; \x3cspan class=\x22hljs-attr\x22\x3e\x22private\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n\x26nbsp; \x3cspan class=\x22hljs-attr\x22\x3e\x22dependencies\x22\x3c\/span\x3e: {\n\x26nbsp;       \x3cspan class=\x22hljs-attr\x22\x3e\x22express\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22^5.0.0\x22\x3c\/span\x3e\n\x26nbsp; }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来将下列代码复制到 app.js 中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var express = require(\x26quot;express\x26quot;);\x26nbsp; \nvar http = require(\x26quot;http\x26quot;);\nvar app = express();\x26nbsp;\x26nbsp; \n\x26nbsp;\napp.use(function(request, response) {\x26nbsp; \n    response.writeHead(200, { \x26quot;Content-Type\x26quot;: \x26quot;text\/plain\x26quot; });\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp; \n\x26nbsp;   response.end(\x26quot;Hello, World!\x26quot;);\x26nbsp; \n});\x26nbsp;\n\x26nbsp;\nhttp.createServer(app).listen(3000);\x26nbsp; \n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22express\x22\x3c\/span\x3e);\x26nbsp; \n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e http = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22http\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\x26nbsp;\x26nbsp; \n\x26nbsp;\napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\x26nbsp; \n    response.writeHead(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e, { \x3cspan class=\x22hljs-string\x22\x3e\x22Content-Type\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22text\/plain\x22\x3c\/span\x3e });\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp; \n\x26nbsp;   response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22Hello, World!\x22\x3c\/span\x3e);\x26nbsp; \n});\x26nbsp;\n\x26nbsp;\nhttp.createServer(app).listen(\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e);\x26nbsp; \n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e首先，我们依次引入了 Express 和 HTTP 模块。\x3c\/p\x3e\n\x3cp\x3e然后，使用 \x3cem\x3eexpress()\x3c\/em\x3e 方法创建变量 \x3cem\x3eapp\x3c\/em\x3e ，该方法会返回一个请求处理函数闭包。这一点非常重要，因为它意味着我可以像之前一样将其传递给 \x3cem\x3ehttp.createServer\x3c\/em\x3e 方法。\x3c\/p\x3e\n\x3cp\x3e还记得前一章提到的原生 Node 请求处理吗？它大致如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var app = http.createServer(function(request, response) {\n    response.writeHead(200, { \x26quot;Content-Type\x26quot;: \x26quot;text\/plain\x26quot; });\n\x26nbsp;   response.end(\x26quot;Hello, world!\x26quot;);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = http.createServer(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    response.writeHead(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e, { \x3cspan class=\x22hljs-string\x22\x3e\x22Content-Type\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22text\/plain\x22\x3c\/span\x3e });\n\x26nbsp;   response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22Hello, world!\x22\x3c\/span\x3e);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e两段代码非常相似，回调闭包都包含两个参数并且响应也一样。\x3c\/p\x3e\n\x3cp\x3e最后，我们创建了一个服务并且启动了它。\x3cem\x3ehttp.createServer\x3c\/em\x3e 接受的参数是一个函数，所以合理猜测 app 也只是一个函数，只不过该函数表示的是 Express 中一个完整的中间件处理流程。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e中间件如何在高层工作\x3c\/h3\x3e\n\x3cp\x3e在原生的 Node 代码中，所有的 HTTP 请求处理都在一个函数中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function requestHandler(request, response) {\n    console.log(\x26quot;In comes a request to: \x26quot; \x2b request.url);\n    response.end(\x26quot;Hello, world!\x26quot;);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erequestHandler\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22In comes a request to: \x22\x3c\/span\x3e \x2b request.url);\n    response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22Hello, world!\x22\x3c\/span\x3e);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果抽象成流程图的话，它看起来就像：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010819806\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010819806\x22 alt=\x2203_01\x22 title=\x2203_01\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这并不是说在处理过程中不能调用其它函数，而是所有的请求响应都由该函数发送。\x3c\/p\x3e\n\x3cp\x3e而中间件则使用一组中间件栈函数来处理这些请求，处理过程如下图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010819807\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010819807\x22 alt=\x2203_02\x22 title=\x2203_02\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e那么，接下来我们就有必要了解 Express 使用一组中间件函数的缘由，以及这些函数作用。\x3c\/p\x3e\n\x3cp\x3e现在我们回顾一下前面用户验证的例子：只有验证通过才会展示用户的私密信息，与此同时每次访问请求都要进行记录。\x3c\/p\x3e\n\x3cp\x3e在这个应用中存在三个中间件函数：请求记录、用户验证、信息展示。中间件工作流为：先记录每个请求，然后进行用户验证，验证通过进行信息展示，最后对请求做出响应。所以，整个工作流有两种可能情形：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010819808\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010819808\x22 alt=\x2203_03\x22 title=\x2203_03\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e另外，这些中间件函数中部分函数需要对响应做出响应。如果没有做出任何响应的话，那么服务器会挂起请求而浏览器也会干等。\x3c\/p\x3e\n\x3cp\x3e这样做的好处就是，我们可以将应用进行拆分。而拆分后的组件不仅利于后期维护，并且组件之间还可以进行不同组合。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e不做任何修改的中间件\x3c\/h3\x3e\n\x3cp\x3e中间件函数可以对  request、response 进行修改，但它并不是必要操作。例如，前面的日志记录中间件代码：它只需要进行记录操作。而一个不做任何修改，纯功能性的中间函数代码大致如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function myFunMiddleware(request, response, next) {\n  ...     \n  nest(); \n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emyFunMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response, next\x3c\/span\x3e) \x3c\/span\x3e{\n  ...     \n  nest(); \n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e因为中间件函数的执行是从上到下的。所以，加入纯功能性的请求记录中间件后，代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var express = require(\x26quot;express\x26quot;);\nvar http = require(\x26quot;http\x26quot;);\nvar app = express();\n\/\/ 日志记录中间件\napp.use(function(request, response, next) {\n  console.log(\x26quot;In comes a \x26quot; \x2b request.method \x2b \x26quot; to \x26quot; \x2b request.url);\n  next();\n});\n\n\/\/ 发送实际响应\napp.use(function(request, response) {\n  response.writeHead(200, { \x26quot;Content-Type\x26quot;: \x26quot;text\/plain\x26quot; });\n  response.end(\x26quot;Hello, world!\x26quot;);\n});\nhttp.createServer(app).listen(3000);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22express\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e http = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22http\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 日志记录中间件\x3c\/span\x3e\napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response, next\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22In comes a \x22\x3c\/span\x3e \x2b request.method \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22 to \x22\x3c\/span\x3e \x2b request.url);\n  next();\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送实际响应\x3c\/span\x3e\napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n  response.writeHead(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e, { \x3cspan class=\x22hljs-string\x22\x3e\x22Content-Type\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22text\/plain\x22\x3c\/span\x3e });\n  response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22Hello, world!\x22\x3c\/span\x3e);\n});\nhttp.createServer(app).listen(\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e修改 request、response 的中间件\x3c\/h3\x3e\n\x3cp\x3e并不是所有的中间件都和上面一样，在部分中间件函数需要对 request、response  进行处理，尤其是后者。\x3c\/p\x3e\n\x3cp\x3e下面我们来实现前面提到的验证中间件函数。为了简单起见，这里只允许当前分钟数为偶数的情况通过验证。那么，该中间件函数代码大致如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22app.use(function(request, response, next) {\n  console.log(\x26quot;In comes a \x26quot; \x2b request.method \x2b \x26quot; to \x26quot; \x2b request.url);\n  next();\n});\napp.use(function(request, response, next) {\n  var minute = (new Date()).getMinutes();\n  \/\/ 如果在这个小时的第一分钟访问，那么调用next()继续\n  if ((minute % 2) === 0) {\n    next();\n  } else {\n    \/\/ 如果没有通过验证，发送一个403的状态码并进行响应\n    response.statusCode = 403;\n    response.end(\x26quot;Not authorized.\x26quot;);\n  }\n});\napp.use(function(request, response) {\n  response.end(\x27Secret info: the password is \x26quot;swordfish\x26quot;!\x27); \/\/ 发送密码信息\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3eapp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response, next\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22In comes a \x22\x3c\/span\x3e \x2b request.method \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22 to \x22\x3c\/span\x3e \x2b request.url);\n  next();\n});\napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response, next\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e minute = (\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e()).getMinutes();\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果在这个小时的第一分钟访问，那么调用next()继续\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((minute % \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n    next();\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果没有通过验证，发送一个403的状态码并进行响应\x3c\/span\x3e\n    response.statusCode = \x3cspan class=\x22hljs-number\x22\x3e403\x3c\/span\x3e;\n    response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22Not authorized.\x22\x3c\/span\x3e);\n  }\n});\napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n  response.end(\x3cspan class=\x22hljs-string\x22\x3e\x27Secret info: the password is \x22swordfish\x22!\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送密码信息\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e第三方中间件类库\x3c\/h3\x3e\n\x3cp\x3e在大多数情况下，你正在尝试的工作可能已经被人实现过了。也就是说，对于一些常用的功能社区中可能已经存在成熟的解决方案了。下面，我们就来介绍一些 Express 中常用的第三方模块。\x3c\/p\x3e\n\x3ch4\x3eMORGAN：日志记录中间件\x3c\/h4\x3e\n\x3cp\x3e\x3cstrong\x3eMorgan\x3c\/strong\x3e 是一个功能非常强大的日志中间件。它能对用户的行为和请求时间进行记录。而这对于分析异常行为和可能的站点崩溃来说非常有用。大多数时候 \x3cstrong\x3eMorgan\x3c\/strong\x3e 也是 Express 中日志中间件的首选。\x3c\/p\x3e\n\x3cp\x3e使用命令 \x3cem\x3enpm install morgan --save\x3c\/em\x3e 安装该中间件，并修改 app.js 中的代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var express = require(\x26quot;express\x26quot;);\nvar logger = require(\x26quot;morgan\x26quot;);\nvar http = require(\x26quot;http\x26quot;);\nvar app = express();\napp.use(logger(\x26quot;short\x26quot;)); \napp.use(function(request, response){\n    response.writeHead(200, {\x26quot;Content-Type\x26quot;: \x26quot;text\/plain\x26quot;});\n    response.end(\x26quot;Hello, world!\x26quot;);\n});\nhttp.createServer(app).listen(3000);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22express\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e logger = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22morgan\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e http = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22http\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\napp.use(logger(\x3cspan class=\x22hljs-string\x22\x3e\x22short\x22\x3c\/span\x3e)); \napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e)\x3c\/span\x3e{\n    response.writeHead(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e, {\x3cspan class=\x22hljs-string\x22\x3e\x22Content-Type\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22text\/plain\x22\x3c\/span\x3e});\n    response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22Hello, world!\x22\x3c\/span\x3e);\n});\nhttp.createServer(app).listen(\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e再次访问 \x3cem\x3e\x3ca href=\x22http:\/\/localhost:3000\/em\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost:3000\x3c\/a\x3e\x3c\/em\x3e 你就会看到 Morgan 记录的日志了。\x3c\/p\x3e\n\x3ch4\x3eExpress 的静态文件中间件\x3c\/h4\x3e\n\x3cp\x3e通过网络发送静态文件对 Web 应用来说是一个常见的需求场景。这些资源通常包括图片资源、CSS 文件以及静态 HTML 文件。但是一个简单的文件发送行为其实代码量很大，因为需要检查大量的边界情况以及性能问题的考量。而 Express 内置的 \x3cem\x3eexpress.static\x3c\/em\x3e 模块能最大程度简化工作。\x3c\/p\x3e\n\x3cp\x3e假设现在需要对 \x3cem\x3epublic\x3c\/em\x3e 文件夹提供文件服务，只需通过静态文件中间件我们就能极大压缩代码量：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var express = require(\x26quot;express\x26quot;);\nvar path = require(\x26quot;path\x26quot;);\nvar http = require(\x26quot;http\x26quot;);\nvar app = express();\nvar publicPath = path.resolve(__dirname, \x26quot;public\x26quot;); \napp.use(express.static(publicPath)); \napp.use(function(request, response) {\n    response.writeHead(200, { \x26quot;Content-Type\x26quot;: \x26quot;text\/plain\x26quot; });\n    response.end(\x26quot;Looks like you didn\x27t find a static file.\x26quot;);\n});\nhttp.createServer(app).listen(3000);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22express\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e path = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22path\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e http = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22http\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e publicPath = path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x22public\x22\x3c\/span\x3e); \napp.use(express.static(publicPath)); \napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    response.writeHead(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e, { \x3cspan class=\x22hljs-string\x22\x3e\x22Content-Type\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22text\/plain\x22\x3c\/span\x3e });\n    response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22Looks like you didn\x27t find a static file.\x22\x3c\/span\x3e);\n});\nhttp.createServer(app).listen(\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在，任何在 \x3cem\x3epublic\x3c\/em\x3e 目录下的静态文件都能直接请求了，所以你可以将所有需要的文件的放在该目录下。如果 \x3cem\x3epublic\x3c\/em\x3e 文件夹中没有任何匹配的文件存在，它将继续执行下一个中间件并响应一段 \x3cstrong\x3e没有匹配的文件\x3c\/strong\x3e信息。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e为什么使用  path.resolve ？\x3cbr\x3e之所以不直接使用 \x3cem\x3e\/public\x3c\/em\x3e  是因为 Mac 和 Linux 中目录为 \x3cem\x3e\/public\x3c\/em\x3e 而 Windows 使用万恶的反斜杠 \x3cem\x3epublic\x3c\/em\x3e 。path.resolve 就是用来解决多平台目录路径问题。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch4\x3e更多中间件\x3c\/h4\x3e\n\x3cp\x3e除此上面介绍的 Morgan 中间件和 Express 静态中间之外，还有很多其他功能强大的中间件，例如：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3econnect-ratelimit：可以让你控制每小时的连接数。如果某人向服务发起大量请求，那么可以直接返回错误停止处理这些请求。\x3c\/li\x3e\n\x3cli\x3ehelmet：可以添加 HTTP 头部信息来应对一些网络攻击。具体内容会在后面关于安全的章节讲到。\x3c\/li\x3e\n\x3cli\x3ecookie-parses：用于解析浏览器中的 cookie 信息。\x3c\/li\x3e\n\x3cli\x3eresponse-time：通过发送 X-Response-Time 信息，让你能够更好的调试应用的性能。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e路由\x3c\/h2\x3e\n\x3cp\x3e路由是一种将 URL 和 HTTP 方法映射到特定处理回调函数的技术。假设工程里有一个主页，一个关于页面以及一个 404 页面，接下来看看路由是如何进行映射的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar express = require(\x26quot;express\x26quot;);\nvar path = require(\x26quot;path\x26quot;);\nvar http = require(\x26quot;http\x26quot;);\nvar app = express();\n\n\/\/ 像之前一样设置静态文件中间件。\n\/\/ 所有的请求通过这个中间件，如果没有文件被找到的话会继续前进\nvar publicPath = path.resolve(__dirname, \x26quot;public\x26quot;);\napp.use(express.static(publicPath));\n\n\/\/ 当请求根目录的时候被调用\napp.get(\x26quot;\/\x26quot;, function(request, response) {\n    response.end(\x26quot;Welcome to my homepage!\x26quot;);\n});\n\n\/\/ 当请求\/about的时候被调用\napp.get(\x26quot;\/about\x26quot;, function(request, response) {\n    response.end(\x26quot;Welcome to the about page!\x26quot;);\n});\n\n\/\/ 当请求\/weather的时候被调用\napp.get(\x26quot;\/weather\x26quot;, function(request, response) {\n    response.end(\x26quot;The current weather is NICE.\x26quot;);\n});\n\n\/\/ 前面都不匹配，则路由错误。返回 404 页面\napp.use(function(request, response) {\n    response.statusCode = 404;\n    response.end(\x26quot;404\x26quot;);\n});\nhttp.createServer(app).listen(3000);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22express\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e path = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22path\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e http = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22http\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 像之前一样设置静态文件中间件。\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所有的请求通过这个中间件，如果没有文件被找到的话会继续前进\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e publicPath = path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x22public\x22\x3c\/span\x3e);\napp.use(express.static(publicPath));\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当请求根目录的时候被调用\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x22\/\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22Welcome to my homepage!\x22\x3c\/span\x3e);\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当请求\/about的时候被调用\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x22\/about\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22Welcome to the about page!\x22\x3c\/span\x3e);\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当请求\/weather的时候被调用\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x22\/weather\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22The current weather is NICE.\x22\x3c\/span\x3e);\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 前面都不匹配，则路由错误。返回 404 页面\x3c\/span\x3e\napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    response.statusCode = \x3cspan class=\x22hljs-number\x22\x3e404\x3c\/span\x3e;\n    response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22404\x22\x3c\/span\x3e);\n});\nhttp.createServer(app).listen(\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面代码中除了添加前面提到的中间件之外，后面三个 \x3cem\x3eapp.get\x3c\/em\x3e 函数就是 Express 中强大的路由系统了。它们使用 app.post 来响应一个 POST 或者 PUT 等所有网络请求。函数中第一个参数是一个路径，例如 \/about 或者 \/weather 或者简单的根目录 \/ ，第二个参数是一个请求处理函数。该处理函数与之前的中间件工作方式一样，唯一的区别就是调用时机。\x3c\/p\x3e\n\x3cp\x3e除了固定路由形式外，它还可以匹配更复杂的路由（使用正则等方式）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 指定“hello”为路由的固定部分\napp.get(\x26quot;\/hello\/:who\x26quot;, function(request, response) {\n    \/\/ :who 并不是固定住，它表示 URL 中传递过来的名字\n    response.end(\x26quot;Hello, \x26quot; \x2b request.params.who \x2b \x26quot;.\x26quot;);\n   \n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 指定“hello”为路由的固定部分\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x22\/hello\/:who\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ :who 并不是固定住，它表示 URL 中传递过来的名字\x3c\/span\x3e\n    response.end(\x3cspan class=\x22hljs-string\x22\x3e\x22Hello, \x22\x3c\/span\x3e \x2b request.params.who \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22.\x22\x3c\/span\x3e);\n   \n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e重启服务并访问 \x3cem\x3elocalhost:3000\/hello\/earth\x3c\/em\x3e 等到的响应信息为：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eHello, earth\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e注意到如果你在 URL 后面插入多个 \x3cem\x3e\/\x3c\/em\x3e 的话，例如：\x3cem\x3elocalhost:3000\/hello\/entire\/earth\x3c\/em\x3e 将会返回一个 404 错误。\x3c\/p\x3e\n\x3cp\x3e你应该在日常生活中见过这种 URL 链接，特定的用户能够访问特定的 URL 。例如，有一个用户为 \x3cem\x3eExpressSuperHero\x3c\/em\x3e ，那么他的个人信息页面 URL 可能是：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3ca href=\x22https:\/\/mywebsite.com\/users\/ExpressSuperHero\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/mywebsite.com\/users\/E...\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e在 Express 中你可以通过这种通配方式简化路由定义，而不必将所有用户的特定路由都一一列举出来。\x3c\/p\x3e\n\x3cp\x3e官方文档中还展示了一个使用正则表达式来进行复杂匹配的例子，并且你可以通过路由做更多其它的事情。不过这章中只需要知道路由概念就行了，更多的内容将会在第五章中深入讲解。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e扩展 request 和 response\x3c\/h2\x3e\n\x3cp\x3eExpress 在原来基础上对 request 和 response 对象进行了功能扩展。你可以在官方\x3ca href=\x22http:\/\/expressjs.com\/en\/api.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e文档\x3c\/a\x3e中找到所有细节内容，不过我们可以先来领略其中的一部分：\x3c\/p\x3e\n\x3cp\x3eExpress 提供的功能中 redirect 算一个非常棒的功能，使用方法如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22response.redirect(\x26quot;\/hello\/world\x26quot;);\nresponse.redirect(\x26quot;http:\/\/expressjs.com\x26quot;);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3eresponse.redirect(\x3cspan class=\x22hljs-string\x22\x3e\x22\/hello\/world\x22\x3c\/span\x3e);\nresponse.redirect(\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/expressjs.com\x22\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e原生 Node 中并没有重定向 redirect 方法。虽然我们也能够使用原生代码实现重定向功能，但明显它的代码量会更多。\x3c\/p\x3e\n\x3cp\x3e另外，在 Express 中文件发送也变的更加简单，只需一行代码就能实现：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22response.sendFile(\x26quot;path\/to\/cool_song.mp3\x26quot;)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3eresponse.sendFile(\x3cspan class=\x22hljs-string\x22\x3e\x22path\/to\/cool_song.mp3\x22\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e与之前一样，该功能的原生实现代码也比较复杂。\x3c\/p\x3e\n\x3cp\x3e除了对响应对象 response 进行了拓展之外，Express 也对请求对象 request 进行了拓展。例如：你可以通过 \x3cem\x3erequest.ip\x3c\/em\x3e 获取发送请求的机器 IP 地址或者通过 \x3cem\x3erequest.get\x3c\/em\x3e 获取 HTTP 头部。\x3c\/p\x3e\n\x3cp\x3e下面我们使用它实现 IP 黑名单功能，代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var express = require(\x26quot;express\x26quot;);\nvar app = express();\n\nvar EVIL_IP = \x26quot;123.45.67.89\x26quot;;\n\napp.use(function(request, response, next) {\n    if (request.ip === EVIL_IP) {\n        response.status(401).send(\x26quot;Not allowed!\x26quot;);\n    } else {\n        next();\n    }\n});\n\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22express\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e EVIL_IP = \x3cspan class=\x22hljs-string\x22\x3e\x22123.45.67.89\x22\x3c\/span\x3e;\n\napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response, next\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (request.ip === EVIL_IP) {\n        response.status(\x3cspan class=\x22hljs-number\x22\x3e401\x3c\/span\x3e).send(\x3cspan class=\x22hljs-string\x22\x3e\x22Not allowed!\x22\x3c\/span\x3e);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        next();\n    }\n});\n\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里使用到了 \x3cem\x3ereq.ip\x3c\/em\x3e 以及 \x3cem\x3eres.status()\x3c\/em\x3e 和 \x3cem\x3eres.send()\x3c\/em\x3e ，而这些方法全都来自于 Express 的拓展。\x3c\/p\x3e\n\x3cp\x3e理论上来说，我们只需要知道 Express 拓展了 request 和 response 并知道如何使用就行了，至于细节可以不去做了解。\x3c\/p\x3e\n\x3cp\x3e上面的例子，只是 Express 所有拓展中的冰山一角，你可以在\x3ca href=\x22http:\/\/expressjs.com\/en\/api.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e文档\x3c\/a\x3e中看到更多的示例。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e视图\x3c\/h2\x3e\n\x3cp\x3e几乎所有的网站内容都是基于 HTML 进行展示的，并且大多时候这些 HTML 内容都是动态生成的。你可能需要为当前登录用户提供特定欢迎页或者需要在页面中动态生成数据表。为了应对动态内容的渲染，社区中出现了大量的 Express 模版引擎，例如：  EJS、Handlebars、Pug。\x3c\/p\x3e\n\x3cp\x3e下面是 EJS 模版引擎使用示例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var express = require(\x26quot;express\x26quot;);\nvar path = require(\x26quot;path\x26quot;);\nvar app = express();\n\n\/\/ 告诉 Express 你的视图存在于一个名为 views 的文件夹中\napp.set(\x26quot;views\x26quot;, path.resolve(__dirname, \x26quot;views\x26quot;));\n\n\/\/ 告诉 Express 你将使用EJS模板引擎\napp.set(\x26quot;view engine\x26quot;, \x26quot;ejs\x26quot;);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22express\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e path = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22path\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 告诉 Express 你的视图存在于一个名为 views 的文件夹中\x3c\/span\x3e\napp.set(\x3cspan class=\x22hljs-string\x22\x3e\x22views\x22\x3c\/span\x3e, path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x22views\x22\x3c\/span\x3e));\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 告诉 Express 你将使用EJS模板引擎\x3c\/span\x3e\napp.set(\x3cspan class=\x22hljs-string\x22\x3e\x22view engine\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22ejs\x22\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在代码中，首先我们导入了必要的模块。然后设置了视图文件所在的路径。紧接着，我们将模版引擎设置为 EJS （\x3ca href=\x22https:\/\/github.com\/tj\/ejs\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e文档\x3c\/a\x3e）。当然在使用 EJS  执行，我们还需要通过 \x3cem\x3enpm install ejs --save\x3c\/em\x3e 命令进行安装。\x3c\/p\x3e\n\x3cp\x3e安装并设置好 EJS 引擎之后，接下里就是如何使用的问题了。\x3c\/p\x3e\n\x3cp\x3e首先，我们在 \x3cem\x3eviews\x3c\/em\x3e 文件夹下面创建一个 \x3cem\x3eindex.ejs\x3c\/em\x3e 文件，并拷贝下面的内容：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n\x3chead\x3e\n    \x3cmeta charset=\x26quot;utf-8\x26quot;\x3e\n    \x3ctitle\x3eHello, world!\x3c\/title\x3e\n\x3c\/head\x3e\n\x3cbody\x3e\n    \x3c%= message %\x3e\n\x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22HTML\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3eHello, world!\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%=\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e %\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eEJS 实质上是 HTML 的一个超集，所有 HTML 的语法都可以直接使用并且完全兼容。但是 EJS 对语法进行了部分拓展。 例如，你可以通过 \x3cem\x3e\x26lt;%= message %\x26gt;\x3c\/em\x3e 语法将传递过来的参数 \x3cem\x3emessage\x3c\/em\x3e 插入到标签中。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22app.get(\x26quot;\/\x26quot;, function(request, response) {\n    response.render(\x26quot;index\x26quot;, {\n        message: \x26quot;Hey everyone! This is my webpage.\x26quot;\n    });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3eapp.get(\x3cspan class=\x22hljs-string\x22\x3e\x22\/\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    response.render(\x3cspan class=\x22hljs-string\x22\x3e\x22index\x22\x3c\/span\x3e, {\n        \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Hey everyone! This is my webpage.\x22\x3c\/span\x3e\n    });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eExpress 给 response 对象添加了一个名为 \x3cem\x3erender\x3c\/em\x3e 的方法。该方法在视图目录下查找第一个参数对应的模版视图文件并将第二个参数传递给该模版文件。\x3c\/p\x3e\n\x3cp\x3e下面是经过引擎渲染动态生成后的 HTML 文件内容：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n\x3chead\x3e\n    \x3cmeta charset=\x26quot;utf-8\x26quot;\x3e\n    \x3ctitle\x3eHello, world!\x3c\/title\x3e\n\x3c\/head\x3e\n\x3cbody\x3e\n    Hey everyone! This is my webpage. \n\x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22HTML\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3eHello, world!\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    Hey everyone! This is my webpage. \n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e实例：一个留言板的实现\x3c\/h2\x3e\n\x3cp\x3e最后这部分，我们将会使用到前面的技术来构建一个完整的留言板 web 程序。通过这个示例来加深对上面内容的掌握，该应用主要包含两个页面：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e一个主页：主要用于列出之前所有的留言\x3c\/li\x3e\n\x3cli\x3e一个编辑页面：用于编辑新的留言\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e准备工作\x3c\/h3\x3e\n\x3cp\x3e首先，我们新建一个文件夹并新建项目，并复制下面内容到新建的 \x3cem\x3epackage.json\x3c\/em\x3e 文件中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;name\x26quot;: \x26quot;express-guestbook\x26quot;,\n    \x26quot;private\x26quot;: true,\n    \x26quot;scripts\x26quot;: {\n        \x26quot;start\x26quot;: \x26quot;node app\x26quot; \n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22JSON\x22\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22express-guestbook\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22private\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22start\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22node app\x22\x3c\/span\x3e \n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你可以在文件中添加其他字段信息（例如作者或者版本），但是在本例中这并不是必要信息。接下来，我们安装依赖文件，输入命令：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3enpm install express morgan body-parser ejs --save\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e因为需要实现留言新建动作，所以这里需要使用 \x3cem\x3ebody-parser\x3c\/em\x3e 对 POST 请求进行解析。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e核心代码\x3c\/h3\x3e\n\x3cp\x3e准备工作完成后，接下来就创建 \x3cem\x3eapp.js\x3c\/em\x3e 文件并复制下面的代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar http = require(\x26quot;http\x26quot;);\nvar path = require(\x26quot;path\x26quot;);\nvar express = require(\x26quot;express\x26quot;);\nvar logger = require(\x27morgan\x27);\nvar bodyParser = require(\x26quot;body-parser\x26quot;);\n\nvar app = express();\n\n\/\/ 设置引擎\napp.set(\x26quot;views\x26quot;, path.resolve(__dirname, \x26quot;views\x26quot;));\napp.set(\x26quot;view engine\x26quot;, \x26quot;ejs\x26quot;);\n\n\/\/ 设置留言的全局变量\nvar entries = [];\napp.locals.entries = entries;\n\n\/\/ 使用 Morgan 进行日志记录\napp.use(logger(\x26quot;dev\x26quot;));\n\n\/\/ 设置用户表单提交动作信息的中间件，所有信息会保存在 req.body 里\napp.use(bodyParser.urlencoded({ extended: false }));\n\n\/\/ 当访问了网站根目录，就渲染主页（位于views\/index.ejs）\napp.get(\x26quot;\/\x26quot;, function(request, response) {\n    response.render(\x26quot;index\x26quot;);\n});\n\n\/\/ 渲染“新留言”页面（位于views\/index.ejs）当get访问这个URL的时候\napp.get(\x26quot;\/new-entry\x26quot;, function(request, response) {\n    response.render(\x26quot;new-entry\x26quot;);\n});\n\n\/\/ POST 动作进行留言新建的路由处理\napp.post(\x26quot;\/new-entry\x26quot;, function(request, response) {\n    \/\/ 如果用户提交的表单没有标题或者内容，则返回一个 400 的错误\n    if (!request.body.title || !request.body.body) {\n        response.status(400).send(\x26quot;Entries must have a title and a body.\x26quot;);\n        return;\n    }\n    \n    \/\/ 添加新留言到 entries 中\n    entries.push({\n        title: request.body.title,\n        content: request.body.body,\n        published: new Date()\n    });\n    \/\/ 重定向到主页来查看你的新条目\n    response.redirect(\x26quot;\/\x26quot;);\n});\n\n\/\/ 渲染404页面，因为你请求了未知资源\napp.use(function(request, response) {\n    response.status(404).render(\x26quot;404\x26quot;);\n});\n\n\/\/ 在3000端口启动服务器\nhttp.createServer(app).listen(3000, function() {\n    console.log(\x26quot;Guestbook app started on port 3000.\x26quot;);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e http = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22http\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e path = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22path\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22express\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e logger = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27morgan\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e bodyParser = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22body-parser\x22\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置引擎\x3c\/span\x3e\napp.set(\x3cspan class=\x22hljs-string\x22\x3e\x22views\x22\x3c\/span\x3e, path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x22views\x22\x3c\/span\x3e));\napp.set(\x3cspan class=\x22hljs-string\x22\x3e\x22view engine\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22ejs\x22\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置留言的全局变量\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e entries = [];\napp.locals.entries = entries;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用 Morgan 进行日志记录\x3c\/span\x3e\napp.use(logger(\x3cspan class=\x22hljs-string\x22\x3e\x22dev\x22\x3c\/span\x3e));\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置用户表单提交动作信息的中间件，所有信息会保存在 req.body 里\x3c\/span\x3e\napp.use(bodyParser.urlencoded({ \x3cspan class=\x22hljs-attr\x22\x3eextended\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e }));\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当访问了网站根目录，就渲染主页（位于views\/index.ejs）\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x22\/\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    response.render(\x3cspan class=\x22hljs-string\x22\x3e\x22index\x22\x3c\/span\x3e);\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染“新留言”页面（位于views\/index.ejs）当get访问这个URL的时候\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x22\/new-entry\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    response.render(\x3cspan class=\x22hljs-string\x22\x3e\x22new-entry\x22\x3c\/span\x3e);\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ POST 动作进行留言新建的路由处理\x3c\/span\x3e\napp.post(\x3cspan class=\x22hljs-string\x22\x3e\x22\/new-entry\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果用户提交的表单没有标题或者内容，则返回一个 400 的错误\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!request.body.title || !request.body.body) {\n        response.status(\x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e).send(\x3cspan class=\x22hljs-string\x22\x3e\x22Entries must have a title and a body.\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n    }\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加新留言到 entries 中\x3c\/span\x3e\n    entries.push({\n        \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: request.body.title,\n        \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e: request.body.body,\n        \x3cspan class=\x22hljs-attr\x22\x3epublished\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e()\n    });\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重定向到主页来查看你的新条目\x3c\/span\x3e\n    response.redirect(\x3cspan class=\x22hljs-string\x22\x3e\x22\/\x22\x3c\/span\x3e);\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染404页面，因为你请求了未知资源\x3c\/span\x3e\napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest, response\x3c\/span\x3e) \x3c\/span\x3e{\n    response.status(\x3cspan class=\x22hljs-number\x22\x3e404\x3c\/span\x3e).render(\x3cspan class=\x22hljs-string\x22\x3e\x22404\x22\x3c\/span\x3e);\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在3000端口启动服务器\x3c\/span\x3e\nhttp.createServer(app).listen(\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Guestbook app started on port 3000.\x22\x3c\/span\x3e);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e新建视图\x3c\/h3\x3e\n\x3cp\x3e最后我们需要将页面的视图文件补全，新建 \x3cem\x3eviews\x3c\/em\x3e 文件夹，然后复制下面内容到新建 \x3cem\x3eheader.ejs\x3c\/em\x3e 文件中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n\x3chead\x3e\n\x3cmeta charset=\x26quot;utf-8\x26quot;\x3e\n\x3ctitle\x3eExpress Guestbook\x3c\/title\x3e\n\x3clink rel=\x26quot;stylesheet\x26quot; href=\x26quot;\/\/maxcdn.bootstrapcdn.com\/bootstrap\/3.3.6\/css\/bootstrap.min.css\x26quot;\x3e\n\x3c\/head\x3e\n\x3cbody class=\x26quot;container\x26quot;\x3e\n    \x3ch1\x3e\n        Express Guestbook\n        \x3ca href=\x26quot;\/new-entry\x26quot; class=\x26quot;btn btn-primary pull-right\x26quot;\x3e\n            Write in the guestbook\n        \x3c\/a\x3e\n    \x3c\/h1\x3e\n    \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22HTML\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3eExpress Guestbook\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/\/maxcdn.bootstrapcdn.com\/bootstrap\/3.3.6\/css\/bootstrap.min.css\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22container\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eh1\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        Express Guestbook\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/new-entry\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22btn btn-primary pull-right\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            Write in the guestbook\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eh1\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里使用了 Twitter 的 Bootstrap 框架，当然你也可以进行任意替换。最重要的一点是，该文件会做为所有页面的通用头部。\x3c\/p\x3e\n\x3cp\x3e接下来，在相同目录下新建 \x3cem\x3efooter.ejs\x3c\/em\x3e 作为通用的 footer：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22HTML\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通用部分完成后，接下来就是 \x3cem\x3eindex\x3c\/em\x3e、\x3cem\x3enew-entry\x3c\/em\x3e、\x3cem\x3e404\x3c\/em\x3e 页面文件了。复制下面代码到文件 \x3cem\x3eviews\/index.ejs\x3c\/em\x3e 中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c% include header %\x3e\n\x3c% if (entries.length) { %\x3e\n    \x3c% entries.forEach(function(entry) { %\x3e\n        \x3cdiv class=\x26quot;panel panel-default\x26quot;\x3e\n            \x3cdiv class=\x26quot;panel-heading\x26quot;\x3e\n                \x3cdiv class=\x26quot;text-muted pull-right\x26quot;\x3e\n                    \x3c%= entry.published %\x3e\n                \x3c\/div\x3e\n                \x3c%= entry.title %\x3e\n             \x3c\/div\x3e\n             \x3cdiv class=\x26quot;panel-body\x26quot;\x3e\n                \x3c%= entry.body %\x3e\n             \x3c\/div\x3e\n         \x3c\/div\x3e\n     \x3c% }) %\x3e\n\x3c% } else { %\x3e\n    No entries! \x3ca href=\x26quot;\/new-entry\x26quot;\x3eAdd one!\x3c\/a\x3e\n\x3c% } %\x3e\n\x3c% include footer %\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22HTML\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eheader\x3c\/span\x3e %\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-attr\x22\x3eentries.length\x3c\/span\x3e) { %\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eentries.forEach\x3c\/span\x3e(\x3cspan class=\x22hljs-attr\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-attr\x22\x3eentry\x3c\/span\x3e) { %\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22panel panel-default\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22panel-heading\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n                \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text-muted pull-right\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%=\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eentry.published\x3c\/span\x3e %\x26gt;\x3c\/span\x3e\n                \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n                \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%=\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eentry.title\x3c\/span\x3e %\x26gt;\x3c\/span\x3e\n             \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n             \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22panel-body\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n                \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%=\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eentry.body\x3c\/span\x3e %\x26gt;\x3c\/span\x3e\n             \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n         \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n     \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e }) %\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e } \x3cspan class=\x22hljs-attr\x22\x3eelse\x3c\/span\x3e { %\x26gt;\x3c\/span\x3e\n    No entries! \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/new-entry\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eAdd one!\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e } %\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3efooter\x3c\/span\x3e %\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e同时将下面的代码复制到 \x3cem\x3eviews\/new-entry.ejs\x3c\/em\x3e 中\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c% include header %\x3e\n\x3ch2\x3eWrite a new entry\x3c\/h2\x3e\n\x3cform method=\x26quot;post\x26quot; role=\x26quot;form\x26quot;\x3e\n    \x3cdiv class=\x26quot;form-group\x26quot;\x3e\n        \x3clabel for=\x26quot;title\x26quot;\x3eTitle\x3c\/label\x3e\n        \x3cinput type=\x26quot;text\x26quot; class=\x26quot;form-control\x26quot; id=\x26quot;title\x26quot; name=\x26quot;title\x26quot; placeholder=\x26quot;Entry title\x26quot; required\x3e\n    \x3c\/div\x3e\n    \x3cdiv class=\x26quot;form-group\x26quot;\x3e\n        \x3clabel for=\x26quot;content\x26quot;\x3eEntry text\x3c\/label\x3e\n        \x3ctextarea class=\x26quot;form-control\x26quot; id=\x26quot;body\x26quot; name=\x26quot;body\x26quot; placeholder=\x26quot;Love Express! It\x27s a great tool for building websites.\x26quot; rows=\x26quot;3\x26quot; required\x3e\x3c\/textarea\x3e\n    \x3c\/div\x3e\n    \x3cdiv class=\x26quot;form-group\x26quot;\x3e\n        \x3cinput type=\x26quot;submit\x26quot; value=\x26quot;Post entry\x26quot; class=\x26quot;btn btn-primary\x26quot;\x3e\n    \x3c\/div\x3e\n\x3c\/form\x3e\n\x3c% include footer %\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22HTML\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eheader\x3c\/span\x3e %\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eh2\x3c\/span\x3e\x26gt;\x3c\/span\x3eWrite a new entry\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eh2\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eform\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22post\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22form\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22form-group\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elabel\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3efor\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22title\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eTitle\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3elabel\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22form-control\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22title\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22title\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eplaceholder\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22Entry title\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erequired\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22form-group\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elabel\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3efor\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22content\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eEntry text\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3elabel\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etextarea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22form-control\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22body\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22body\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eplaceholder\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22Love Express! It\x27s a great tool for building websites.\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erows\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x223\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erequired\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etextarea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22form-group\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22submit\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22Post entry\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22btn btn-primary\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eform\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3efooter\x3c\/span\x3e %\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后就是 \x3cem\x3eviews\/404.ejs\x3c\/em\x3e 文件了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c% include header %\x3e\n\x3ch2\x3e404! Page not found.\x3c\/h2\x3e\n\x3c% include footer %\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22HTML\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eheader\x3c\/span\x3e %\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eh2\x3c\/span\x3e\x26gt;\x3c\/span\x3e404! Page not found.\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eh2\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3efooter\x3c\/span\x3e %\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e所有的视图文件都创建完成了，接下来就是运行服务了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e运行服务\x3c\/h3\x3e\n\x3cp\x3e如果你现在就使用 \x3cem\x3enpm start\x3c\/em\x3e 拉起服务，然后访问对应的 URL ，你就能见到下图所示的场景了。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010819809\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010819809\x22 alt=\x2203_04\x22 title=\x2203_04\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010819810\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010819810\x22 alt=\x2203_05\x22 title=\x2203_05\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e最后，我们回顾一下这个小项目的几个关键点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e使用了一个中间件来记录所有的请求，并且对不匹配的 URL 链接进行了 404 页面响应。\x3c\/li\x3e\n\x3cli\x3e在新建留言后，我们将页面重定向到了主页。\x3c\/li\x3e\n\x3cli\x3e在该工程里使用了 EJS 作为 Express 的模版引擎。并使用它实现了 HTML 文件的动态渲染。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader14\x22\x3e总结\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3eExpress 基于 Node 进行了工程拓展，使得开发过程更为流畅高效。\x3c\/li\x3e\n\x3cli\x3eExpress 主要有四个部分构成。\x3c\/li\x3e\n\x3cli\x3eExpress 的请求处理流程可以由多个中间件进行构建。\x3c\/li\x3e\n\x3cli\x3eExpress 中流行的模版引擎为 EJS ，它能实现对 HTML 的动态渲染并且语法也更为友好。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cblockquote\x3e\x3cp\x3e原文\x3ca href=\x22https:\/\/bignerdcoding.com\/archives\/43.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e地址\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Express 实战（三）：Express 基础</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010819801">https://segmentfault.com/a/1190000010819801</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/89u6woy7q88/" target="_blank">https://alili.tech/archive/89u6woy7q88/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>