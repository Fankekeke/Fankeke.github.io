<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="VS Code、ATOM这些开源文本编辑器的代码实现中有哪些奇技淫巧？"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>VS Code、ATOM这些开源文本编辑器的代码实现中有哪些奇技淫巧？ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/8tthqhcnbfl/",
				"appid": "1613049289050283", 
				"title": "VS Code、ATOM这些开源文本编辑器的代码实现中有哪些奇技淫巧？ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-04T02:30:05"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/tguc2fjhebo/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/18wpz39xcbg/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f8tthqhcnbfl%2f&text=VS%20Code%e3%80%81ATOM%e8%bf%99%e4%ba%9b%e5%bc%80%e6%ba%90%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%e5%99%a8%e7%9a%84%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e4%b8%ad%e6%9c%89%e5%93%aa%e4%ba%9b%e5%a5%87%e6%8a%80%e6%b7%ab%e5%b7%a7%ef%bc%9f"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f8tthqhcnbfl%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f8tthqhcnbfl%2f&text=VS%20Code%e3%80%81ATOM%e8%bf%99%e4%ba%9b%e5%bc%80%e6%ba%90%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%e5%99%a8%e7%9a%84%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e4%b8%ad%e6%9c%89%e5%93%aa%e4%ba%9b%e5%a5%87%e6%8a%80%e6%b7%ab%e5%b7%a7%ef%bc%9f"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f8tthqhcnbfl%2f&title=VS%20Code%e3%80%81ATOM%e8%bf%99%e4%ba%9b%e5%bc%80%e6%ba%90%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%e5%99%a8%e7%9a%84%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e4%b8%ad%e6%9c%89%e5%93%aa%e4%ba%9b%e5%a5%87%e6%8a%80%e6%b7%ab%e5%b7%a7%ef%bc%9f"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f8tthqhcnbfl%2f&is_video=false&description=VS%20Code%e3%80%81ATOM%e8%bf%99%e4%ba%9b%e5%bc%80%e6%ba%90%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%e5%99%a8%e7%9a%84%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e4%b8%ad%e6%9c%89%e5%93%aa%e4%ba%9b%e5%a5%87%e6%8a%80%e6%b7%ab%e5%b7%a7%ef%bc%9f"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=VS%20Code%e3%80%81ATOM%e8%bf%99%e4%ba%9b%e5%bc%80%e6%ba%90%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%e5%99%a8%e7%9a%84%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e4%b8%ad%e6%9c%89%e5%93%aa%e4%ba%9b%e5%a5%87%e6%8a%80%e6%b7%ab%e5%b7%a7%ef%bc%9f&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f8tthqhcnbfl%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f8tthqhcnbfl%2f&title=VS%20Code%e3%80%81ATOM%e8%bf%99%e4%ba%9b%e5%bc%80%e6%ba%90%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%e5%99%a8%e7%9a%84%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e4%b8%ad%e6%9c%89%e5%93%aa%e4%ba%9b%e5%a5%87%e6%8a%80%e6%b7%ab%e5%b7%a7%ef%bc%9f"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f8tthqhcnbfl%2f&title=VS%20Code%e3%80%81ATOM%e8%bf%99%e4%ba%9b%e5%bc%80%e6%ba%90%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%e5%99%a8%e7%9a%84%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e4%b8%ad%e6%9c%89%e5%93%aa%e4%ba%9b%e5%a5%87%e6%8a%80%e6%b7%ab%e5%b7%a7%ef%bc%9f"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f8tthqhcnbfl%2f&title=VS%20Code%e3%80%81ATOM%e8%bf%99%e4%ba%9b%e5%bc%80%e6%ba%90%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%e5%99%a8%e7%9a%84%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e4%b8%ad%e6%9c%89%e5%93%aa%e4%ba%9b%e5%a5%87%e6%8a%80%e6%b7%ab%e5%b7%a7%ef%bc%9f"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f8tthqhcnbfl%2f&title=VS%20Code%e3%80%81ATOM%e8%bf%99%e4%ba%9b%e5%bc%80%e6%ba%90%e6%96%87%e6%9c%ac%e7%bc%96%e8%be%91%e5%99%a8%e7%9a%84%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e4%b8%ad%e6%9c%89%e5%93%aa%e4%ba%9b%e5%a5%87%e6%8a%80%e6%b7%ab%e5%b7%a7%ef%bc%9f"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">VS Code、ATOM这些开源文本编辑器的代码实现中有哪些奇技淫巧？</h1><div class="meta"><div class="postdate"><time datetime="2018-12-04" itemprop="datePublished">2018-12-04</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e这篇是我在知乎的回答，原文在这里：\x3ca href=\x22https:\/\/www.zhihu.com\/question\/272156541\/answer\/367784539\x22 rel=\x22nofollow noreferrer\x22\x3ejustjavac: VS Code、ATOM这些开源文本编辑器的代码实现中有哪些奇技淫巧？\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e研究 V8 比较多，也关注了一下 vscode 和 atom 的性能，每次 vscode、atom 的 change log 我都会看一遍。印象最深的是 vscode 1.14 的一次更新日志，\x3ca href=\x22https:\/\/github.com\/Microsoft\/monaco-editor\/issues\/351\x22 rel=\x22nofollow noreferrer\x22\x3edoApplyEdits Lines inserted using splice · Issue #351 · Microsoft\/monaco-editor\x3c\/a\x3e：\x3cstrong\x3e不要在循环中使用 splice\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e下图是我一年前跑的测试结果：\x3ca href=\x22https:\/\/jsperf.com\/inserting-an-array-within-an-array\x22 rel=\x22nofollow noreferrer\x22\x3eInserting an array within an array\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9bJY?w=241\x26amp;h=122\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9bJY?w=241\x26amp;h=122\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e300\x2b倍的差距。\x3c\/p\x3e\n\x3cp\x3e在之前 vscode 还有一次很大的性能提升，在版本 1.9 的时候，改进了语法高亮的算法。\x3c\/p\x3e\n\x3cp\x3e语法高亮的过程通常分为 2 个阶段(tokenization 和 render)：先将源码分割为 token，然后使用不同的主题对分割后的 token 进行着色。\x3c\/p\x3e\n\x3cp\x3etokenization 的过程是：从上到下逐行运行。tokenizer 在行的末尾存储一些状态，在 tokenize 下一行时会用到这些状态。这样，在用户进行编辑时仅需要重新 tokenize 行的一小部分，而不需要扫描整个文件内容。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9bK9?w=686\x26amp;h=356\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9bK9?w=686\x26amp;h=356\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e还有一种情况是当前行的输入会影响到后面（甚至是前面）的行，这时会用到结束状态：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9bLf?w=686\x26amp;h=356\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9bLf?w=686\x26amp;h=356\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e在 1.9 之前的版本，vscode 如何 tokenization 呢？\x3c\/p\x3e\n\x3cp\x3e比如上面的代码：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9bLM?w=651\x26amp;h=65\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9bLM?w=651\x26amp;h=65\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e在 vscode 种这样存储：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22js\x22\x3etokens = [\n    { startIndex:  0, type: \x27keyword.js\x27 },\n    { startIndex:  8, type: \x27\x27 },\n    { startIndex:  9, type: \x27identifier.js\x27 },\n    { startIndex: 11, type: \x27delimiter.paren.js\x27 },\n    { startIndex: 12, type: \x27delimiter.paren.js\x27 },\n    { startIndex: 13, type: \x27\x27 },\n    { startIndex: 14, type: \x27delimiter.curly.js\x27 },\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e{ startIndex: 0, type: \x27keyword.js\x27 } 表示从 0 开始的 token 是一个 keyword。\x3c\/p\x3e\n\x3cp\x3eVSCode 团队在博客种指出这在 Chrome 中占据 648 个字节，因此存储这样的对象在内存方面的代价非常高（每个对象实例必须保留指向其原型的空间，以及其属性列表等）。为 15 个字符存储 648 字节是不可接受的。\x3c\/p\x3e\n\x3cp\x3e所以，vscode 使用二进制来存储token：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22js\x22\x3e\/\/     0        1               2                  3                      4\nmap = [\x27\x27, \x27keyword.js\x27, \x27identifier.js\x27, \x27delimiter.paren.js\x27, \x27delimiter.curly.js\x27];\ntokens = [\n    { startIndex:  0, type: 1 },\n    { startIndex:  8, type: 0 },\n    { startIndex:  9, type: 2 },\n    { startIndex: 11, type: 3 },\n    { startIndex: 12, type: 3 },\n    { startIndex: 13, type: 0 },\n    { startIndex: 14, type: 4 },\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e和上面的表示法相比，只是把 type 由字符串变成了数字，本质上并没有节约太多的内存。但是别着急，vscode 还有黑科技。\x3c\/p\x3e\n\x3cp\x3e我们都知道 JavaScript 使用 IEEE-754 标准存储双精度浮点数，尾数为 53bit。能够在不丢失精度的情况下处理的最大整数为 2^53-1。因此 vscode 使用其中的 48big 进行编码：使用 32bit 来存储 startIndex，16bit 来存储type。 于是上面的对象在 vscode 种被存储为：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22js\x22\x3etokens = [\n                 \/\/       type                 startIndex\n     4294967296, \/\/ 0000000000000001 00000000000000000000000000000000\n              8, \/\/ 0000000000000000 00000000000000000000000000001000\n     8589934601, \/\/ 0000000000000010 00000000000000000000000000001001\n    12884901899, \/\/ 0000000000000011 00000000000000000000000000001011\n    12884901900, \/\/ 0000000000000011 00000000000000000000000000001100\n             13, \/\/ 0000000000000000 00000000000000000000000000001101\n    17179869198, \/\/ 0000000000000100 00000000000000000000000000001110\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e每个数字是 64bit(8字节)，一共是 7 个数字，存储这些元素一共需要 7*8 = 56 字节，再加上数组的额外开销共需要 104 个字节，只有之前的 648 字节的 1\/6。\x3c\/p\x3e\n\x3cp\x3e而主题的渲染则用到了 \x3ca href=\x22https:\/\/en.wikipedia.org\/wiki\/Trie\x22 rel=\x22nofollow noreferrer\x22\x3eTrie\x3c\/a\x3e 数据结构。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9bMs?w=601\x26amp;h=431\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9bMs?w=601\x26amp;h=431\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这个学过《数据结构》的都懂，算不上奇技淫巧，就不展开了。\x3c\/p\x3e\n\x3cp\x3e这一切都是 2017 年 3 月发布的 vscode 1.9。\x3c\/p\x3e\n\x3cp\x3e而今年 3 月，vscode 又重写了 \x3ca href=\x22https:\/\/code.visualstudio.com\/blogs\/2018\/03\/23\/text-buffer-reimplementation\x22 rel=\x22nofollow noreferrer\x22\x3eText Buffer\x3c\/a\x3e。用户使用编辑器，大部分时间就是写新代码，改旧代码，说到底还是对 text 进行编辑。\x3c\/p\x3e\n\x3cp\x3e对于高性能的文本操作，vscode 最初尝试使用 C\x2b\x2b 进行编写，毕竟 C\x2b\x2b 的性能要比 JavaScript 高出不少，但是事实却不够理想，使用 C\x2b\x2b 确实节约了内存，但是在使用 C\x2b\x2b 模块时，需要在 JavaScript 和 C\x2b\x2b 之间往返数次，这大大减慢了 vscode 的性能。\x3c\/p\x3e\n\x3cp\x3evscode 团队从 Vyacheslav Egorov  的一篇文章 \x3ca href=\x22https:\/\/mrale.ph\/blog\/2018\/02\/03\/maybe-you-dont-need-rust-to-speed-up-your-js.html\x22 rel=\x22nofollow noreferrer\x22\x3eMaybe you don\x27t need Rust and WASM to speed up your JS\x3c\/a\x3e 收到了启发，如何充分压榨 V8 引擎的性能。mrale.ph 的博客我几乎每篇都看，非常经典，也非常难懂 。\x3c\/p\x3e\n\x3cp\x3e大多编辑器都是基于行的。程序员逐行编写代码，编译器提供基于行的反馈信息，堆栈跟踪包含行号，tokenization 引擎逐行运行…… 在 vscode 的早期版本中也是直接把每行代码作为字符串存储在数组中。\x3c\/p\x3e\n\x3cp\x3e但是这种方式存在一些问题：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e无法打开大文件，因为把所有内容读入数组中可能导致内存不足。\x3c\/li\x3e\n\x3cli\x3e即使文件不大，但是行数太多也无法打开。例如，一个用户无法打开一个 \x3ca href=\x22https:\/\/github.com\/Microsoft\/vscode\/issues\/13187\x22 rel=\x22nofollow noreferrer\x22\x3e35 MB 的文件\x3c\/a\x3e。根本原因是该文件的行数太多，1370 万行。引擎将为ModelLine每行和每个对象使用大约 40-60 个字节，因此整个数组使用大约 600MB 内存来存储文档。也就是说打开这个 35M 的文件需要 600M 的内容，20 倍啊！！！\x3c\/li\x3e\n\x3cli\x3e另一个问题就是速度。为了构建这个数组，必须通过换行符分割内容，以便每行获得一个字符串对象。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e于是 vscode 开始寻找新的数据结果，最终选择了 \x3ca href=\x22https:\/\/en.wikipedia.org\/wiki\/Piece_table\x22 rel=\x22nofollow noreferrer\x22\x3ePiece table\x3c\/a\x3e。不知道为什么这么晚才选择 piece table，要知道在微软的 office word 中早就已经使用了 piece table。我也是在一次 Java 读取 word 的 jar 包源码中第一次知道的 piece table 数据结构。\x3c\/p\x3e\n\x3cp\x3e推荐几篇延伸阅读的文章：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eEmacs 编辑器的 buffer 论文：\x3ca href=\x22https:\/\/www.common-lisp.net\/project\/flexichain\/download\/StrandhVilleneuveMoore.pdf\x22 rel=\x22nofollow noreferrer\x22\x3eFlexichain: An editable sequence and its gap-buffer implementation\x3c\/a\x3e 2004-04-05\x3c\/li\x3e\n\x3cli\x3epiece table 的：\x3ca href=\x22https:\/\/www.cs.unm.edu\/~crowley\/papers\/sds.pdf\x22 rel=\x22nofollow noreferrer\x22\x3eData Structures for Text Sequences\x3c\/a\x3e 1998-06-10\x3c\/li\x3e\n\x3cli\x3eRopes: \x3ca href=\x22https:\/\/www.cs.rit.edu\/usr\/local\/pub\/jeh\/courses\/QUARTERS\/FP\/Labs\/CedarRope\/rope-paper.pdf\x22 rel=\x22nofollow noreferrer\x22\x3eAn Alternative to Strings\x3c\/a\x3e 1995-12\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e目前主要的三种编辑方式有 gap buffer, rope, piece table。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e最近用 Atom 少了。\x3c\/p\x3e\n\x3cp\x3e上一次让我兴奋的地方是：\x3ca href=\x22http:\/\/blog.atom.io\/2018\/01\/10\/the-state-of-atoms-performance.html\x22 rel=\x22nofollow noreferrer\x22\x3eThe State of Atom\x27s Performance\x3c\/a\x3e。在2017年6月 Atom 使用了 piece table 数据结构，使用 C\x2b\x2b 重新实现了 text buffer：\x3ca href=\x22http:\/\/blog.atom.io\/2017\/10\/12\/atoms-new-buffer-implementation.html\x22 rel=\x22nofollow noreferrer\x22\x3eAtom\x27s new concurrency-friendly buffer implementation\x3c\/a\x3e。比 vscode 还要早半年，但是为什么还是这么慢呢？？？\x3c\/p\x3e\n\x3cp\x3eAtom 使用 V8 的自定义快照（snapshot）提升启动性能，最终删除了影响性能的 jQuery 和自定义 element。就连 V8 的\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9bM7?w=720\x26amp;h=309\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9bM7?w=720\x26amp;h=309\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eAtom 还更新了 DOM 渲染的方式：\x3ca href=\x22http:\/\/blog.atom.io\/2017\/06\/22\/a-new-approach-to-text-rendering.html\x22 rel=\x22nofollow noreferrer\x22\x3eA new approach to text rendering\x3c\/a\x3e，而这个新算法包括一个类似 React 的 vdom，从 issue 来看这是一个大工程啊，包含了近 \x3ca href=\x22https:\/\/github.com\/atom\/atom\/pull\/13880\x22 rel=\x22nofollow noreferrer\x22\x3e100 个 task\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9Alb?w=727\x26amp;h=314\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9Alb?w=727\x26amp;h=314\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e经过一系列优化，官方说道：\x3c\/p\x3e\n\x3cblockquote\x3ewe made loading Atom almost 50% faster and snapshots were a crucial tool that enabled some otherwise impossible optimizations.\x3c\/blockquote\x3e\n\x3cp\x3e我们使 Atom 快了 50%，snapshot 功不可没。（PS：我一定是使用了假的 Atom）\x3c\/p\x3e\n\x3cp\x3e不过 snapshot 确实是 V8 的神器，Nodejs 也看到了 Atom 的成果，于 2017-11-16 开了 issue ：speeding up Node.js startup using V8 snapshot · Issue #17058 · nodejs\/node。这在我之前的专栏里面有介绍：Node.js 新计划：\x3ca href=\x22https:\/\/zhuanlan.zhihu.com\/p\/31139813\x22 rel=\x22nofollow noreferrer\x22\x3e使用 V8 snapshot 将启动速度提升 8 倍\x3c\/a\x3e。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e最近一次关注 Atom 是 \x3ca href=\x22https:\/\/github.com\/atom\/xray\x22 rel=\x22nofollow noreferrer\x22\x3eatom\/xray\x3c\/a\x3e。知乎上也有相关的讨论，atom 开发的下一代编辑器（莫非已经定义 atom 为上一代编辑器了吗）。大概就是一种“大号废了，开小号重练”的感觉。\x3c\/p\x3e\n\x3cp\x3e值得学习的地方是 text 处理使用 copy-on-write CRDT：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9bNK?w=720\x26amp;h=405\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9bNK?w=720\x26amp;h=405\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如果一直关注 Atom，对于 CRDT 应该不会陌生。Atom 的多人实时共同编辑插件 \x3ca href=\x22https:\/\/teletype.atom.io\/\x22 rel=\x22nofollow noreferrer\x22\x3ehttps:\/\/teletype.atom.io\/\x3c\/a\x3e 就是使用的 CRDT。\x3c\/p\x3e\n\x3cp\x3eCRDT 全称：Conflict-Free Replicated Data Types，强行翻译过来就是“无冲突可复制数据类型”。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3eCRDT 论文： \x3ca href=\x22https:\/\/hal.inria.fr\/file\/index\/docid\/555588\/filename\/techreport.pdf\x22 rel=\x22nofollow noreferrer\x22\x3eA comprehensive study of Convergent and Commutative Replicated Data Types\x3c\/a\x3e 2011-01-13\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3eCAP定理：在分布式系统中，最多只能同时满足一致性（Consistency）、可用性（Availability）和分区容错性（Partition tolerance）这三项中的两项。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9bNX?w=345\x26amp;h=300\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9bNX?w=345\x26amp;h=300\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e很多分布式系统都舍弃了C（一致性）：允许可以在某些时刻不一致，转而求其次要求系统满足最终一致性。这也是目前很多 nosql 数据库追求的方式（另一种是传统的符合 ACID 特性的数据库系统，放弃了A(可用性)，这种系统称为强一致性）。\x3c\/p\x3e\n\x3cp\x3e而在最终一致性分布式系统中，一个最基本的问题就是，应该采用什么样的数据结构来保证最终一致性？ 答案就是 CRDT。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/atom\/teletype-crdt\x22 rel=\x22nofollow noreferrer\x22\x3eatom\/teletype-crdt\x3c\/a\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3chr\x3e\n\x3cp\x3e这篇文章只是一个提纲，里面的每个知识点都可以展开了讲上三天三夜。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>VS Code、ATOM这些开源文本编辑器的代码实现中有哪些奇技淫巧？</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014544333">https://segmentfault.com/a/1190000014544333</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/8tthqhcnbfl/" target="_blank">https://alili.tech/archive/8tthqhcnbfl/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>