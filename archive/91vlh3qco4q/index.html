<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="[翻译]基于Webpack4使用懒加载分离打包React代码"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>[翻译]基于Webpack4使用懒加载分离打包React代码 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/91vlh3qco4q/",
				"appid": "1613049289050283", 
				"title": "[翻译]基于Webpack4使用懒加载分离打包React代码 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-11T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/anwfhx5tgnf/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/lqk8zxa0cio/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f91vlh3qco4q%2f&text=%5b%e7%bf%bb%e8%af%91%5d%e5%9f%ba%e4%ba%8eWebpack4%e4%bd%bf%e7%94%a8%e6%87%92%e5%8a%a0%e8%bd%bd%e5%88%86%e7%a6%bb%e6%89%93%e5%8c%85React%e4%bb%a3%e7%a0%81"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f91vlh3qco4q%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f91vlh3qco4q%2f&text=%5b%e7%bf%bb%e8%af%91%5d%e5%9f%ba%e4%ba%8eWebpack4%e4%bd%bf%e7%94%a8%e6%87%92%e5%8a%a0%e8%bd%bd%e5%88%86%e7%a6%bb%e6%89%93%e5%8c%85React%e4%bb%a3%e7%a0%81"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f91vlh3qco4q%2f&title=%5b%e7%bf%bb%e8%af%91%5d%e5%9f%ba%e4%ba%8eWebpack4%e4%bd%bf%e7%94%a8%e6%87%92%e5%8a%a0%e8%bd%bd%e5%88%86%e7%a6%bb%e6%89%93%e5%8c%85React%e4%bb%a3%e7%a0%81"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f91vlh3qco4q%2f&is_video=false&description=%5b%e7%bf%bb%e8%af%91%5d%e5%9f%ba%e4%ba%8eWebpack4%e4%bd%bf%e7%94%a8%e6%87%92%e5%8a%a0%e8%bd%bd%e5%88%86%e7%a6%bb%e6%89%93%e5%8c%85React%e4%bb%a3%e7%a0%81"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%5b%e7%bf%bb%e8%af%91%5d%e5%9f%ba%e4%ba%8eWebpack4%e4%bd%bf%e7%94%a8%e6%87%92%e5%8a%a0%e8%bd%bd%e5%88%86%e7%a6%bb%e6%89%93%e5%8c%85React%e4%bb%a3%e7%a0%81&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f91vlh3qco4q%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f91vlh3qco4q%2f&title=%5b%e7%bf%bb%e8%af%91%5d%e5%9f%ba%e4%ba%8eWebpack4%e4%bd%bf%e7%94%a8%e6%87%92%e5%8a%a0%e8%bd%bd%e5%88%86%e7%a6%bb%e6%89%93%e5%8c%85React%e4%bb%a3%e7%a0%81"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f91vlh3qco4q%2f&title=%5b%e7%bf%bb%e8%af%91%5d%e5%9f%ba%e4%ba%8eWebpack4%e4%bd%bf%e7%94%a8%e6%87%92%e5%8a%a0%e8%bd%bd%e5%88%86%e7%a6%bb%e6%89%93%e5%8c%85React%e4%bb%a3%e7%a0%81"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f91vlh3qco4q%2f&title=%5b%e7%bf%bb%e8%af%91%5d%e5%9f%ba%e4%ba%8eWebpack4%e4%bd%bf%e7%94%a8%e6%87%92%e5%8a%a0%e8%bd%bd%e5%88%86%e7%a6%bb%e6%89%93%e5%8c%85React%e4%bb%a3%e7%a0%81"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f91vlh3qco4q%2f&title=%5b%e7%bf%bb%e8%af%91%5d%e5%9f%ba%e4%ba%8eWebpack4%e4%bd%bf%e7%94%a8%e6%87%92%e5%8a%a0%e8%bd%bd%e5%88%86%e7%a6%bb%e6%89%93%e5%8c%85React%e4%bb%a3%e7%a0%81"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">[翻译]基于Webpack4使用懒加载分离打包React代码</h1><div class="meta"><div class="postdate"><time datetime="2018-12-11" itemprop="datePublished">2018-12-11</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e原文地址：\x3ca href=\x22https:\/\/engineering.innovid.com\/code-splitting-using-lazy-loading-with-react-redux-typescript-and-webpack-4-3ec60140ec5a\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/engineering.innovid.com\/code-splitting-using-lazy-loading-with-react-redux-typescript-and-webpack-4-3ec60140ec5a\x3c\/a\x3e  \x3cbr\x3e作者：\x3ca href=\x22https:\/\/engineering.innovid.com\/@avivshafir\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAviv Shafir\x3c\/a\x3e  \x3cbr\x3e摘要：Innovid网站使用Webpack4对一个React项目进行了优化改造。主要使用了新的optimization配置和动态注入功能。\x3c\/blockquote\x3e\n\x3cp\x3eHey，这里是\x3ca href=\x22http:\/\/www.innovid.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eInnovid\x3c\/a\x3e，一个领先的视频广告平台。我们每天处理130万小时的视频，而在我们的web项目中，经常会使用到Webpack。我们非常喜欢这个工具。\x3c\/p\x3e\n\x3cp\x3e最近，我们将一个项目迁移到了最新的Webpack4。它给我们带来了一些开箱即用的新特性，比如在构建时间上进行了非常大的优化。\x3c\/p\x3e\n\x3cp\x3e在本次迁移中，我们决定使用懒加载这一Webpack最吸引人的特性来分割app中的主要代码部分。\x3c\/p\x3e\n\x3cblockquote\x3e代码分割能够帮助你延迟加载用户当前需要的内容，同时也能显著地提升用户体验。尽管你没有减少app的总代码量，但你已经避免加载一些用户也许永远也用不到的代码了。而且还能够在初始加载时减少加载的代码数量。  \x3cbr\x3e——\x3ca href=\x22https:\/\/reactjs.org\/docs\/code-splitting.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact 文档\x3c\/a\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3eWebpack根据你的应用程序构建了一个依赖关系图。从你的入口文件开始，它递归遍历所有文件和它们的依赖文件，使用loader和plugin对你的文件施了点魔法，最后就输出了提供给用户的生成包。\x3c\/p\x3e\n\x3cp\x3e我们现在将生成包分为app.js（我们的应用代码）和vendors.js(第三方库)。  \x3cbr\x3e我们使用webpack-bundle-analyzer插件来可视化两个生成包：  \x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013654185?w=1600\x26amp;h=758\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013654185?w=1600\x26amp;h=758\x22 alt=\x22初始包\x22 title=\x22初始包\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3eapp.js大小116KB，vendors.js大小399KB\x3c\/blockquote\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3eWebpack配置\x3c\/h1\x3e\n\x3cp\x3eapp.js是我们程序的入口，所以自动打包成app.js。而第三方包vendors.js是使用了新的\x3ccode\x3eoptimization\x3c\/code\x3e配置，将从\x3ccode\x3enode_modules\x3c\/code\x3e文件夹中引入的所有文件打包生成的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22mode: \x26quot;production\x26quot;,\n  entry: {\n    app: path.join(__dirname, \x26quot;index.tsx\x26quot;),\n  },\n  output: {\n    path: path.resolve(__dirname, \x26quot;public\/dist\x26quot;),\n    publicPath: \x26quot;\x26quot;,\n    chunkFilename: \x26quot;[name].js\x26quot;,\n    filename: \x26quot;[name].js\x26quot;\n  },\n  optimization: {\n        runtimeChunk: {\n            name: \x26quot;manifest\x26quot;\n        },\n        splitChunks: {\n            cacheGroups: {\n                vendor: {\n                    test: \/[\\\\\/]node_modules[\\\\\/]\/,\n                    name: \x26quot;vendors\x26quot;,\n                    priority: -20,\n                    chunks: \x26quot;all\x26quot;\n                }\n            }\n        }\n   }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3emode: \x3cspan class=\x22hljs-string\x22\x3e\x22production\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eentry\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3eapp\x3c\/span\x3e: path.join(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x22index.tsx\x22\x3c\/span\x3e),\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eoutput\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x22public\/dist\x22\x3c\/span\x3e),\n    \x3cspan class=\x22hljs-attr\x22\x3epublicPath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3echunkFilename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22[name].js\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3efilename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22[name].js\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eoptimization\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3eruntimeChunk\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22manifest\x22\x3c\/span\x3e\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3esplitChunks\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3ecacheGroups\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3evendor\x3c\/span\x3e: {\n                    \x3cspan class=\x22hljs-attr\x22\x3etest\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/[\\\\\/]node_modules[\\\\\/]\/\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22vendors\x22\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-attr\x22\x3epriority\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e-20\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-attr\x22\x3echunks\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22all\x22\x3c\/span\x3e\n                }\n            }\n        }\n   }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cem\x3e注意：\x3c\/em\x3e 在Webpack4中，我们不再使用\x3ccode\x3eCommonChunkPlugin\x3c\/code\x3e了，它被\x3ccode\x3esplitChunks\x3c\/code\x3e和\x3ccode\x3eruntimeChunk\x3c\/code\x3e这两个新API所取代。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e懒加载React组件\x3c\/h1\x3e\n\x3cp\x3e现在的vendors和app包都是用户在第一次打开页面室加载的。我们发现可以将一些“重量级”的组件懒加载来提升首屏体验，并且减少初始包的体积。\x3c\/p\x3e\n\x3cp\x3e比如说：redux-form是一个管理react应用表单的库，它只在一个名为\x3ccode\x3eGenerateTags\x3c\/code\x3e的大型组件中使用。由于它体积较大并且只在特定场景下被使用，所以用它来作为懒加载的实验对象是再好不过了。redux-form和GenerateTags组件可以被抽取到单独一个chunk中，这样我们在渲染首屏时请求的包体积更小。\x3c\/p\x3e\n\x3cp\x3e让我们看看现在流行的动态导入工具库：\x3ccode\x3ereact-loadable\x3c\/code\x3e。它基础封装了未来JS的新语法\x3ccode\x3eimport()\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const GenerateTags = Loadable({\n  loader: () =\x3e\n    import(\/* webpackChunkName: \x26quot;generateTags\x26quot; *\/ \x26quot;.\/GenerateTags\x26quot;),\n    loading: LoadingSpinner\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e GenerateTags = Loadable({\n  \x3cspan class=\x22hljs-attr\x22\x3eloader\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-comment\x22\x3e\/* webpackChunkName: \x22generateTags\x22 *\/\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22.\/GenerateTags\x22\x3c\/span\x3e),\n    \x3cspan class=\x22hljs-attr\x22\x3eloading\x3c\/span\x3e: LoadingSpinner\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用之后，我们的包变成了下面这样：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013654186?w=1600\x26amp;h=759\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013654186?w=1600\x26amp;h=759\x22 alt=\x22抽取组件\x22 title=\x22抽取组件\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3eGenerateTags已经被抽取到单独的一个chunk中，但redux-form仍然在vendor.js包里。\x3c\/blockquote\x3e\n\x3cp\x3e结果不尽如人意，因为redux-form仍然在vendors.js包中，但我们希望它跟GenerateTags都被抽取到一个不同的chunk中来实现按需加载。\x3c\/p\x3e\n\x3cp\x3e之所以会出现这样的情况，是因为我们在别的文件中也引用了redux-form。比如说我们在\x3ccode\x3ecombineReducers \x3c\/code\x3e中编写了下面的代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { reducer as formReducer } from \x26quot;redux-form\x26quot;;\nconst applicationReducer: Reducer\x3cany\x3e = combineReducers({\n    user,\n    sidenav,\n    navigation,\n    \/\/...\n    form: formReducer\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { reducer \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e formReducer } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22redux-form\x22\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e applicationReducer: Reducer\x26lt;any\x26gt; = combineReducers({\n    user,\n    sidenav,\n    navigation,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n    form: formReducer\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码顶部的静态导入语句导致redux-form库成了我们vendors包的一部分。也就是说，Webpack认为它已经被静态导入成我们的app入口依赖树的一部分，所以不能被懒加载。\x3c\/p\x3e\n\x3cp\x3e为了解决这个问题，我们决定动态注入redux-form reducer。首先，我们移除了导入redux-form reducer的语句，并且加了下面的代码来实现动态注入redux reducer：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export function injectAsyncReducer(store, name, asyncReducer) {\n  if (store.asyncReducers[name]) {\n    return;\n  }\n  store.asyncReducers[name] = asyncReducer;\n  store.replaceReducer(createReducer(store.asyncReducers));\n}\n\nexport const configureStore = (initialState: AppState) =\x3e {\n  const enhancer = compose(applyMiddleware(...getMiddleware()));\n  const store: any = createStore(createReducer(), initialState, enhancer);\n  store.asyncReducers = {};\n  return store;\n};\n\n\nconst createReducer = (asyncReducers = {}) =\x3e {\n    return combineReducers({\n        user,\n        sidenav,\n        navigation,\n        \/\/...\n        ...asyncReducers\n    });\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einjectAsyncReducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estore, name, asyncReducer\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (store.asyncReducers[name]) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n  }\n  store.asyncReducers[name] = asyncReducer;\n  store.replaceReducer(createReducer(store.asyncReducers));\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e configureStore = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3einitialState: AppState\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e enhancer = compose(applyMiddleware(...getMiddleware()));\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e store: any = createStore(createReducer(), initialState, enhancer);\n  store.asyncReducers = {};\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e store;\n};\n\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e createReducer = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3easyncReducers = {}\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e combineReducers({\n        user,\n        sidenav,\n        navigation,\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n        ...asyncReducers\n    });\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后，我们在GenerateTags组件的componentDidMount中调用injectAsyncReducer方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22public componentDidMount() {\n    const reduxFormReducer = require(\x26quot;redux-form\x26quot;).reducer;\n    injectAsyncReducer(store, \x26quot;form\x26quot;, reduxFormReducer);\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3epublic componentDidMount() {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e reduxFormReducer = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22redux-form\x22\x3c\/span\x3e).reducer;\n    injectAsyncReducer(store, \x3cspan class=\x22hljs-string\x22\x3e\x22form\x22\x3c\/span\x3e, reduxFormReducer);\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意，不推荐从组件直接获取一个store的引用，因为这样会导致你在做服务端渲染时出现一些问题。  \x3cbr\x3e在\x3ca href=\x22https:\/\/tylergaw.com\/articles\/dynamic-redux-reducers\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e你可以阅读更多注入异步代码和使用HOC的知识。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3eTypeScript配置\x3c\/h1\x3e\n\x3cp\x3e我们在项目中使用了typescript。我们必须在\x3ccode\x3etsconfig.json\x3c\/code\x3e中更新esnext的module配置，以及设置\x3ccode\x3eremoveComments\x3c\/code\x3e为\x3ccode\x3efalse\x3c\/code\x3e（要支持动态注入，TS的版本必须高于2.4）。这样，之前的动态注入才会起作用。通过“告诉”typescript编译器避开我们的import语句，并且不要对它们进行转码来让Webpack正常工作。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;compilerOptions\x26quot;: {\n    \x26quot;target\x26quot;: \x26quot;es5\x26quot;,\n    \x26quot;sourceMap\x26quot;: false,\n    \x26quot;inlineSourceMap\x26quot;: true,\n    \x26quot;module\x26quot;: \x26quot;esnext\x26quot;,\n    \x26quot;moduleResolution\x26quot;: \x26quot;node\x26quot;,\n    \x26quot;jsx\x26quot;: \x26quot;react\x26quot;,\n    \x26quot;preserveConstEnums\x26quot;: true,\n    \x26quot;removeComments\x26quot;: false,\n    \x26quot;lib\x26quot;: [\x26quot;es6\x26quot;, \x26quot;dom\x26quot;]\n  },\n  \x26quot;types\x26quot;: [\x26quot;node\x26quot;]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22JSON\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22compilerOptions\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22target\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22es5\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22sourceMap\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22inlineSourceMap\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22module\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22esnext\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22moduleResolution\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22node\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22jsx\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22react\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22preserveConstEnums\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22removeComments\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22lib\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22es6\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22dom\x22\x3c\/span\x3e]\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22types\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22node\x22\x3c\/span\x3e]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后的结果就像下面这样：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013654187\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013654187\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3evendors.js 314 KiB, app.js 96.6 KiB, generateTags.js 23.2 KiB, vendors~generateTags.js 90.2 KiB\x3c\/blockquote\x3e\n\x3cp\x3e最后我们成功了，GenerateTags和它的依赖文件redux-form被提取出vendor.js并且能够被按需加载。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3e总结\x3c\/h1\x3e\n\x3cp\x3e我们推荐你阅读\x3ca href=\x22https:\/\/developers.google.com\/web\/fundamentals\/performance\/webpack\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这个文章\x3c\/a\x3e来优化Webpack。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e使用动态注入可以减少最终包的体积。还能疼痛感异步加载提供更快的首屏加载速度。\x3c\/li\x3e\n\x3cli\x3etypescript从2.4版本开始支持动态注入，你只需要记住修改一部分配置就能使用这个功能。\x3c\/li\x3e\n\x3cli\x3e迁移到Webpack4并不不复杂，但是目前还没有关于新配置和API的介绍文档。但我相信很快它们都会有的。\x3c\/li\x3e\n\x3cli\x3e动态注入redux reducer是一个很有用的小技巧，它能够帮助我们的app在使用redux reducer时延迟加载一些库。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cblockquote\x3e查看更多我翻译的Medium文章请访问：  \x3cbr\x3e项目地址：\x3ca href=\x22https:\/\/github.com\/WhiteYin\/translation\/tree\/master\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/WhiteYin\/translation\x3c\/a\x3e  \x3cbr\x3eSF专栏：\x3ca href=\x22https:\/\/segmentfault.com\/blog\/yin-translation\x22\x3ehttps:\/\/segmentfault.com\/blog\/yin-translation\x3c\/a\x3e\n\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>[翻译]基于Webpack4使用懒加载分离打包React代码</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013654180">https://segmentfault.com/a/1190000013654180</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/91vlh3qco4q/" target="_blank">https://alili.tech/archive/91vlh3qco4q/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>