<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="前端图形——绘图、截图、合成动图"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>前端图形——绘图、截图、合成动图 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/96l3pjzb8dk/",
				"appid": "1613049289050283", 
				"title": "前端图形——绘图、截图、合成动图 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-06T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/kv2eu84qg5m/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/669h79k8bdu/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f96l3pjzb8dk%2f&text=%e5%89%8d%e7%ab%af%e5%9b%be%e5%bd%a2%e2%80%94%e2%80%94%e7%bb%98%e5%9b%be%e3%80%81%e6%88%aa%e5%9b%be%e3%80%81%e5%90%88%e6%88%90%e5%8a%a8%e5%9b%be"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f96l3pjzb8dk%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f96l3pjzb8dk%2f&text=%e5%89%8d%e7%ab%af%e5%9b%be%e5%bd%a2%e2%80%94%e2%80%94%e7%bb%98%e5%9b%be%e3%80%81%e6%88%aa%e5%9b%be%e3%80%81%e5%90%88%e6%88%90%e5%8a%a8%e5%9b%be"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f96l3pjzb8dk%2f&title=%e5%89%8d%e7%ab%af%e5%9b%be%e5%bd%a2%e2%80%94%e2%80%94%e7%bb%98%e5%9b%be%e3%80%81%e6%88%aa%e5%9b%be%e3%80%81%e5%90%88%e6%88%90%e5%8a%a8%e5%9b%be"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f96l3pjzb8dk%2f&is_video=false&description=%e5%89%8d%e7%ab%af%e5%9b%be%e5%bd%a2%e2%80%94%e2%80%94%e7%bb%98%e5%9b%be%e3%80%81%e6%88%aa%e5%9b%be%e3%80%81%e5%90%88%e6%88%90%e5%8a%a8%e5%9b%be"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%89%8d%e7%ab%af%e5%9b%be%e5%bd%a2%e2%80%94%e2%80%94%e7%bb%98%e5%9b%be%e3%80%81%e6%88%aa%e5%9b%be%e3%80%81%e5%90%88%e6%88%90%e5%8a%a8%e5%9b%be&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f96l3pjzb8dk%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f96l3pjzb8dk%2f&title=%e5%89%8d%e7%ab%af%e5%9b%be%e5%bd%a2%e2%80%94%e2%80%94%e7%bb%98%e5%9b%be%e3%80%81%e6%88%aa%e5%9b%be%e3%80%81%e5%90%88%e6%88%90%e5%8a%a8%e5%9b%be"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f96l3pjzb8dk%2f&title=%e5%89%8d%e7%ab%af%e5%9b%be%e5%bd%a2%e2%80%94%e2%80%94%e7%bb%98%e5%9b%be%e3%80%81%e6%88%aa%e5%9b%be%e3%80%81%e5%90%88%e6%88%90%e5%8a%a8%e5%9b%be"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f96l3pjzb8dk%2f&title=%e5%89%8d%e7%ab%af%e5%9b%be%e5%bd%a2%e2%80%94%e2%80%94%e7%bb%98%e5%9b%be%e3%80%81%e6%88%aa%e5%9b%be%e3%80%81%e5%90%88%e6%88%90%e5%8a%a8%e5%9b%be"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f96l3pjzb8dk%2f&title=%e5%89%8d%e7%ab%af%e5%9b%be%e5%bd%a2%e2%80%94%e2%80%94%e7%bb%98%e5%9b%be%e3%80%81%e6%88%aa%e5%9b%be%e3%80%81%e5%90%88%e6%88%90%e5%8a%a8%e5%9b%be"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">前端图形——绘图、截图、合成动图</h1><div class="meta"><div class="postdate"><time datetime="2018-12-06" itemprop="datePublished">2018-12-06</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e前言\x3c\/h1\x3e\n\x3cp\x3e本文主要是前端图形处理相关，主题围绕canvas进行展开。包括canvas动效、html2Canvas截图、gif.js合成动图。研究这些东西，有工作需要也有兴趣使然，研究的不深、不过还是有点成果的，欢迎有兴趣的小伙伴一起交流探讨。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e主线\x3c\/h2\x3e\n\x3cp\x3e图形相关的主要包括两个方面：绘图、截图。\x3c\/p\x3e\n\x3cp\x3e技术实现上截图又分拆出静态图、动图两大类。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e总的来说也就是三个方面：动效、截图、动图。\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e关键点\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e动效：主要是创意、实践、优化（封装等）\x3c\/li\x3e\n\x3cli\x3e截图：主要是canvas转图片、dom元素解析。此外还有衍生的模糊问题、跨域图片、样式兼容等难点\x3c\/li\x3e\n\x3cli\x3e动图：主要是截图、延时播放。技术实现上则主要是worker多线程的概念和在vue框架下的使用。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3ecanvas动效\x3c\/h1\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/Canvas_API\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCanvas_API\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000009396591\x22\x3e常见的canvas优化——模糊问题、旋转效果\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e动效制作思路\x3c\/h2\x3e\n\x3cp\x3e关于前端动效这块，主要包括三部分：css3、svg、canvas。\x3c\/p\x3e\n\x3cp\x3e其中css3最轻量、canvas功能最强大，svg对客户端性能的需求比canvas低，手机端常用svg代替canvas、或替canvas实现前置步骤（如html2Canvas1.0.0）。\x3c\/p\x3e\n\x3cp\x3e鉴于我对canvas比较熟悉，接下来将针对canvas进行展开。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e首先要了解相应API，知道能干什么。\x3c\/h3\x3e\n\x3cp\x3e比如canvas就要先通览它的api，才知道原来可以绘制图形、制作动效，还可以转成图片！\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e其次要有创意，知道要做成什么。\x3c\/h3\x3e\n\x3cp\x3e比如网上的树镜动效，效果很酷炫，实现也不难，但是没有这个创意也是做不出来的，很遗憾创意这块我也没什么好的思路。当然创意是建立在已有事物基础上的，兴许了解的多了，自然就有了吧……\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e然后要有好的逻辑思维能力，把创意变成可实现的方案。\x3c\/h3\x3e\n\x3cp\x3e最好能有良好的代码风格，实现可复用，这样开发10个动效的成本就不至于是开发1个动效的10倍。目前想到的一个思路是：创意用逻辑实现，具体绘图实现封装成公用方式，按需引用。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e动效实现\x3c\/h2\x3e\n\x3cp\x3e这里强烈建议找一个网上的好的动效，照着实现一遍，然后再仔细品味改进。我是研究的树镜动效，也从中学到了很多东西，在此非常感谢该动效创作者分享出这么好的动效。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.htmlwest.com\/500\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e树镜动效\x3c\/a\x3e在vue框架下整理后大概长这样子：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV764P?w=550\x26amp;h=534\x22 src=\x22https:\/\/static.alili.tech\/img\/bV764P?w=550\x26amp;h=534\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV768o?w=545\x26amp;h=770\x22 src=\x22https:\/\/static.alili.tech\/img\/bV768o?w=545\x26amp;h=770\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV768v?w=728\x26amp;h=828\x22 src=\x22https:\/\/static.alili.tech\/img\/bV768v?w=728\x26amp;h=828\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e关于这个动效所涉及到的知识点，我分了几个模块：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e树镜分支构造函数TreeBranch\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e这个对应于“创意变成可实现的方案”这条，复杂的动效拆分后，本质上就是一个树（分支设为2就是二叉树了，有没有很熟悉），通过改变树的树枝长度、分叉角度等实现如此酷炫的动效，真正需要画的只是点和线而已。\x3c\/p\x3e\n\x3cp\x3e原理搞清楚之后，就可以用js计算出点和线的坐标、色值等参数，也就是这里TreeBranch的作用，之后直接从变量中取参绘图即可。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e绘图实现模块drawTree\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e这个方法接收树的各项参数branch，然后调用基础API画点画线，最终画出树某一状态下的图案。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e循环绘图实现动效loop\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e这个方法用来循环调用drawTree绘制图形，并修改相关参数修改树的状态，实现树镜动效。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e交互事件interEvent\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e这个方法是用来绑定用户事件的，这样用户可以通过鼠标或触屏的方式主动修改相关参数、控制树的状态。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader9\x22\x3ehtml2Canvas截图\x3c\/h1\x3e\n\x3cp\x3e首次接触html2Canvas是2017年11月底，当时给的任务是要在微信中实现图片分享，因为种种原因，最后任务定为“实现前端截屏，并可添加自定义标签”。而很巧合的12月初作者来了次大改版，兼容了很多css3样式、并且对此前0.5.0版本的一些不足也进行了相关优化。针对html2Canvas的研究也在出了1.0.0-alpha.3之后的12月11号结束了。\x3c\/p\x3e\n\x3cp\x3e鉴于对低版本手机的兼容，最终没有用吊炸天的1.0.0的版本，而是用了0.5.0的版本，也就需要研究0.5.0相对1.0.0有哪些不足，然后自行修复……\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e截图原理\x3c\/h2\x3e\n\x3cp\x3e鉴于要自行修复0.5.0的不足，所以就愉（悲）快（催）的去扒html2Canvas的源码了，自然也就了解了一点html2Canvas实现截图功能的原理。\x3c\/p\x3e\n\x3cp\x3e对比两个版本，以及网上查阅资料，发现了两大亮点：\x3cbr\x3e1、前端截图依赖于canvas转为图片资源的功能。\x3cbr\x3e截图结束会返回一个canvas对象，这个canvas对象上绘制的正是我们的截图区域。然后再将canvas转成图片即可。\x3cbr\x3e2、截图区域怎么绘制到canvas上呢——通过对dom对象解析，变成canvas能理解的语言，在canvas上绘制一遍即可。\x3c\/p\x3e\n\x3cp\x3e理解到这两点，也就掌握了前端截图的精髓（是不是很厉害~）。然后按你需要去研究要优化的点即可。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e优化点\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e截图模糊\x3c\/h3\x3e\n\x3cp\x3e这个问题是1.0.0版本之前讨论最多的一个了，可以说凡是涉及到canvas几乎必谈模糊问题。\x3c\/p\x3e\n\x3cp\x3e这里就不讲演进过程了，直接说最终解决方案：获取dom的scale，用dom的scale去设置canvas的scale（缩放比例）。\x3c\/p\x3e\n\x3cp\x3e原因可以去了解下手机端devicePixelRatio参数。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e样式兼容\x3c\/h3\x3e\n\x3cp\x3e项目中很多地方用到flex布局，后面发现html2Canvas-0.5.0竟然不兼容！！！\x3c\/p\x3e\n\x3cp\x3e如果了解了截图原理的第二点，相信你就清楚是怎么回事了。前端截图其实并不是真正的截图，而是理解了要截图区域的dom之后，仿照着在canvas画布上实现了一遍。这里有个很关键的就是要能解析dom结构，扒源码就会发现，并没有对flex样式的解析支持。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV77Xk?w=1480\x26amp;h=322\x22 src=\x22https:\/\/static.alili.tech\/img\/bV77Xk?w=1480\x26amp;h=322\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV77XK?w=750\x26amp;h=722\x22 src=\x22https:\/\/static.alili.tech\/img\/bV77XK?w=750\x26amp;h=722\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e虽然找到了样式不兼容的原因，然而并不能针对性的解决——毕竟在旧版本上开发解析样式的任务还是太大了点、也不实用，只能期望什么时候能用新版本。\x3c\/p\x3e\n\x3cp\x3e最终我们还是老老实实的把需要截图的dom中的flex布局都替换掉了（万恶的兼容）。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e跨域图片\x3c\/h3\x3e\n\x3cp\x3e当时截图元素包括微信头像和微信生成的带参二维码，结果图片出不来，好气哦！\x3c\/p\x3e\n\x3cp\x3e因为已经悟到了截图原理的第一条——最终图片是通过canvas转过来的，而且canvas上是能画出来的，转成图片后才加载不出来微信头像和带参二维码，所以就针对性的研究canvas转图片的环节。这里要了解两点：\x3cbr\x3e1、跨域图片会污染canvas\x3cbr\x3e2、被污染的canvas不能转成图片（麻烦的同源策略）\x3c\/p\x3e\n\x3cp\x3e而html2Canvas就提供了这两个参数的配置：useCORS、allowTaint，默认不加载跨域图片、不允许污染。\x3cbr\x3e如果要转成图片allowTaint就必须为false，如果要加载跨域图片useCORS就必须为true。\x3c\/p\x3e\n\x3cp\x3e所以要么我们能把图片变成不跨域的，要不然就要解决跨域图片污染canvas的问题。\x3c\/p\x3e\n\x3cp\x3e索性跨域图片的问题是仅此与截图模糊的一个问题，自然也有很多成熟方案。通过修改html2Canvas的源码，可以解决跨域图片污染canvas的问题。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8aSX?w=1366\x26amp;h=332\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8aSX?w=1366\x26amp;h=332\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e通过这个方案，我们解决了微信头像的问题，然而带参二维码还是不行。这里还要了解一点：加载跨域资源是需要后端支持的。而显然带参二维码的配置是不允许这样使用的。    那就只能把图片变成不跨域的了……\x3cbr\x3e很幸运的，前端生成二维码的能力还是有的，所以前端不再请求二维码的url，而是直接在前端生成二维码。\x3c\/p\x3e\n\x3cp\x3e经过一系列努力，跨域图片的问题总算也是圆满解决了。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader15\x22\x3egif.js生成动图\x3c\/h1\x3e\n\x3cp\x3e研究这个的动力来源于网上看到的一个例子\x3ca href=\x22http:\/\/www.cnblogs.com\/imgss\/p\/7727132.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecanvas\x2bgif.js打造自己的数字雨头像\x3c\/a\x3e。而我的初步目标是实现在vue框架下实现gif.js的使用，从而方便之后研究调试（不用一直刷新浏览器），成果可以看\x3ca href=\x22https:\/\/github.com\/sunhuili\/vueExplore\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e我的github\x3c\/a\x3e，路由是‘#\/test\/testCtxGif’。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader16\x22\x3e踩过的坑\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3e要有url才能使用，不能用本地文件路径\x3c\/h3\x3e\n\x3cp\x3e研究的最初自然是扒网上的代码放到本地访问，但是竟然不能生成动图！自此开始研究gif.js。\x3cbr\x3e\x3cstrong\x3egif.js是一个可直接在浏览器上运行的JS GIF编码器。使用类型化数组和web workers来渲染背景中的每一帧，速度非常快。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e对比网上可正常使用的实例和本地无法正常使用的复制版，结合报错信息，尝试把实例挂到一个服务器上运行——IIS服务器，见证奇迹的时刻来了，方案可行！！！\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader18\x22\x3e移植代码到vue框架下\x3c\/h3\x3e\n\x3cp\x3e验证方案可行，只是需要挂在服务器上之后，就着手搬到vue框架下了。然而过程并不轻松。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3eWeb Worker——前端多线程\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e首先是文件不能正常加载。gif.js倒是好说，直接import就可以用了，GIF对象会挂载到window上；但是gif.worker.js却是怎么都不能正常加载，所以也就总是不能正常执行。\x3cbr\x3e然后开始探究gif.worker.js究竟是何方神圣，能不能改造一下。\x3cbr\x3e再然后就认识了webworkers这尊大佛，简直就是前端的一大利器啊！\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Web Workers API 的 Worker 接口代表一个可以轻松创建的后台任务，并可以将消息发送回其创建者。创建一个工作程序只要简单的调用Worker() 构造函数，并指定一个要在工作线程中运行的脚本。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gcode\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3eWeb Workers API 的 Worker 接口代表一个可以轻松创建的后台任务，并可以将消息发送回其创建者。创建一个工作程序只要简单的调用Worker\x3cspan class=\x22hljs-comment\x22\x3e()\x3c\/span\x3e 构造函数，并指定一个要在工作线程中运行的脚本。\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e前端也可以多线程了？这简直是神迹了！\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3egif.worker.js文件加载\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e而gif.worker.js显然就是运用了Worker这个，Worker的创建是要传入要执行脚本的url，然后由worker去加载调用。那问题很明显了，就是worker的加载机制，不能正确加载到vue框架下的gif.worker.js文件——相对路径、hash路由，问题多多。\x3c\/p\x3e\n\x3cp\x3e尝试了修改路径、改路由配置等方法失败后，灵光一闪——这不是webpack给的配置吗？加载失败我应该去找webpack啊！\x3c\/p\x3e\n\x3cp\x3e然后就查到了worker-loader，配置好webpack的配置并适当修改gif.js的源码之后，文件终于加载成功了。vue框架下跑成功了！\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e但是也发现了个严重的问题：用worker-loader方式加载会严重影响worker的性能，对比不用vue框架，速度反而慢下来了。这可就大条了，搬到vue框架下是要提升开发效率的，可不能越搞越慢啊~\x3c\/p\x3e\n\x3cp\x3e具体原因没有深究，但通过实现效果来看，应该是webpack的这种引用方式破坏了worker的多线程的性能，竟然会阻塞用户操作。于是乎开始抛开webpack去加载gif.worker.js。\x3c\/p\x3e\n\x3cp\x3e事实证明，有梦想总是好的。把gif.js和gif.worker.js移到static文件夹下之后，终于成功了，速度贼快、性能贼好。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader19\x22\x3e使用gif.js实现合成动图\x3c\/h2\x3e\n\x3cp\x3e可行性验证通过、开发环境配置完成之后，终于可以实践一下了，成品如下图。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8aFr?w=375\x26amp;h=375\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8aFr?w=375\x26amp;h=375\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader20\x22\x3e制作canvas动效-用作截动图\x3c\/h3\x3e\n\x3cp\x3e仿照网上的例子，我也实现了一个简单的canvas动效作为素材。也就是动图中的效果，具体实现可以看github上的代码。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader21\x22\x3egif.js实现动图合成\x3c\/h3\x3e\n\x3cp\x3egif.js支持我们加载canvas对象、image对象或直接拷贝从ctx中拷贝像素点，设置帧延迟、采样间隔、循环方式等。\x3c\/p\x3e\n\x3cp\x3e而原理则是gif相关的：截取多张图片、按照设置的时间间隔依次展示，从而实现动图的效果。\x3c\/p\x3e\n\x3cp\x3e具体的参数设置比如：画图尺寸（主要是缩放效果）、canvas对象截图间隔等等，还有待进一步探究。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader22\x22\x3e结语\x3c\/h1\x3e\n\x3cp\x3e从接触canvas到现在也有将近一年，也许是从canvas开始入门前端的缘故，总是会对图形相关的比较有兴趣。现在也算是对这系列的研究有个小结，希望之后有机会接触更酷炫的效果或者游戏相关的，当然前端、算法这些也希望都有突破。嗯，总要有点梦想的，说不定就实现了呢~\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8aP5?w=1440\x26amp;h=1080\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8aP5?w=1440\x26amp;h=1080\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>前端图形——绘图、截图、合成动图</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014303325">https://segmentfault.com/a/1190000014303325</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/96l3pjzb8dk/" target="_blank">https://alili.tech/archive/96l3pjzb8dk/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>