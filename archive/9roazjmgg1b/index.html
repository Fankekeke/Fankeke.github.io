<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="PWA介绍及快速上手搭建一个PWA应用"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>PWA介绍及快速上手搭建一个PWA应用 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/9roazjmgg1b/",
				"appid": "1613049289050283", 
				"title": "PWA介绍及快速上手搭建一个PWA应用 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-03T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/17toial1q2b/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/yb53pyijqpg/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f9roazjmgg1b%2f&text=PWA%e4%bb%8b%e7%bb%8d%e5%8f%8a%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b%e6%90%ad%e5%bb%ba%e4%b8%80%e4%b8%aaPWA%e5%ba%94%e7%94%a8"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f9roazjmgg1b%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f9roazjmgg1b%2f&text=PWA%e4%bb%8b%e7%bb%8d%e5%8f%8a%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b%e6%90%ad%e5%bb%ba%e4%b8%80%e4%b8%aaPWA%e5%ba%94%e7%94%a8"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f9roazjmgg1b%2f&title=PWA%e4%bb%8b%e7%bb%8d%e5%8f%8a%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b%e6%90%ad%e5%bb%ba%e4%b8%80%e4%b8%aaPWA%e5%ba%94%e7%94%a8"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f9roazjmgg1b%2f&is_video=false&description=PWA%e4%bb%8b%e7%bb%8d%e5%8f%8a%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b%e6%90%ad%e5%bb%ba%e4%b8%80%e4%b8%aaPWA%e5%ba%94%e7%94%a8"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=PWA%e4%bb%8b%e7%bb%8d%e5%8f%8a%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b%e6%90%ad%e5%bb%ba%e4%b8%80%e4%b8%aaPWA%e5%ba%94%e7%94%a8&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f9roazjmgg1b%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f9roazjmgg1b%2f&title=PWA%e4%bb%8b%e7%bb%8d%e5%8f%8a%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b%e6%90%ad%e5%bb%ba%e4%b8%80%e4%b8%aaPWA%e5%ba%94%e7%94%a8"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f9roazjmgg1b%2f&title=PWA%e4%bb%8b%e7%bb%8d%e5%8f%8a%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b%e6%90%ad%e5%bb%ba%e4%b8%80%e4%b8%aaPWA%e5%ba%94%e7%94%a8"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f9roazjmgg1b%2f&title=PWA%e4%bb%8b%e7%bb%8d%e5%8f%8a%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b%e6%90%ad%e5%bb%ba%e4%b8%80%e4%b8%aaPWA%e5%ba%94%e7%94%a8"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f9roazjmgg1b%2f&title=PWA%e4%bb%8b%e7%bb%8d%e5%8f%8a%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b%e6%90%ad%e5%bb%ba%e4%b8%80%e4%b8%aaPWA%e5%ba%94%e7%94%a8"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">PWA介绍及快速上手搭建一个PWA应用</h1><div class="meta"><div class="postdate"><time datetime="2018-12-03" itemprop="datePublished">2018-12-03</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1\x3ePWA初次体验\x3c\/h1\x3e\n\x3cblockquote\x3e​    前言：本示例不用安装任何东西\x3cp\x3e部分资源来自网络资源及PWA官网，不要把PWA想象的太复杂，跟着示例走一下，你行的。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch2\x3ePWA介绍\x3c\/h2\x3e\n\x3cp\x3e一个新的前端技术，PWA（ 全称：Progressive Web App ）也就是说这是个渐进式的网页应用程序。\x3c\/p\x3e\n\x3cp\x3e官网：\x3ca href=\x22https:\/\/developers.google.com\/web\/progressive-web-apps\/\x22 rel=\x22nofollow noreferrer\x22\x3ehttps:\/\/developers.google.com...\x3c\/a\x3e \x3c\/p\x3e\n\x3cp\x3e是 Google 在 2015 年提出，2016年6月才推广的项目。是结合了一系列现代Web技术的组合，在网页应用中实现和原生应用相近的用户体验。\x3c\/p\x3e\n\x3cp\x3e官网上给出 PWA 的宣传是 ： \x3cstrong\x3eReliable\x3c\/strong\x3e （ 可靠的 ）、\x3cstrong\x3eFast\x3c\/strong\x3e（ 快速的 ）、\x3cstrong\x3eEngaging\x3c\/strong\x3e（ 可参与的 ）\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eReliable\x3c\/strong\x3e ：当用户从手机主屏幕启动时，不用考虑网络的状态是如何，都可以立刻加载出 PWA。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eFast\x3c\/strong\x3e：这一点应该都很熟悉了吧，站在用户的角度来考虑，如果一个网页加载速度有点长的话，那么我们会放弃浏览该网站，所以 PWA 在这一点上做的很好，他的加载速度是很快的。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eEngaging\x3c\/strong\x3e ： PWA 可以添加在用户的主屏幕上，不用从应用商店进行下载，他们通过网络应用程序 Manifest file 提供类似于 APP 的使用体验（ 在 Android 上可以设置全屏显示哦，由于 Safari 支持度的问题，所以在 IOS 上并不可以 ），并且还能进行 ”推送通知” 。\x3c\/p\x3e\n\x3ch2\x3ePWA关键技术\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3eService Worker\x3c\/strong\x3e （可以理解为服务工厂）\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3eManifest\x3c\/strong\x3e （应用清单）\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3ePush Notification\x3c\/strong\x3e（推送通知）\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3\x3eService Worker\x3c\/h3\x3e\n\x3cp\x3e以下用SW来表示\x3c\/p\x3e\n\x3cp\x3eSW 是什么呢？这个是离线缓存文件。我们 PWA 技术使用的就是它！SW 是浏览器在后台独立于网页运行的脚本，它打开了通向不需要网页或用户交互的功能的大门，因为使用了它，才会有的那个 Reliable 特性吧，SW 作用于 浏览器于服务器之间，相当于一个代理服务器。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e浏览器支持\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e顺便带一句：目前只能在 HTTPS 环境下才能使用SW，因为SW 的权利比较大，能够直接截取和返回用户的请求，所以要考虑一下安全性问题。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639478?w=2048\x26amp;h=498\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639478?w=2048\x26amp;h=498\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e事件机制\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639479?w=598\x26amp;h=164\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639479?w=598\x26amp;h=164\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e功能\x3c\/strong\x3e(还是比较逆天的)\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e后台数据的同步\x3c\/li\x3e\n\x3cli\x3e从其他域获取资源请求\x3c\/li\x3e\n\x3cli\x3e接受计算密集型数据的更新，多页面共享该数据\x3c\/li\x3e\n\x3cli\x3e客户端编译与依赖管理\x3c\/li\x3e\n\x3cli\x3e后端服务的hook机制\x3c\/li\x3e\n\x3cli\x3e根据URL模式，自定义模板\x3c\/li\x3e\n\x3cli\x3e性能优化\x3c\/li\x3e\n\x3cli\x3e消息推送\x3c\/li\x3e\n\x3cli\x3e定时默认更新\x3c\/li\x3e\n\x3cli\x3e地理围栏\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e生命周期\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639480?w=772\x26amp;h=232\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639480?w=772\x26amp;h=232\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eParsed （ 解析成功 ）： 首次注册 SW 时，浏览器解决脚本并获得入口点，如果解析成功，就可以访问到 SW 注册对象，在这一点中我们需要在 HTML 页面中添加一个判断，判断该浏览器是否支持 SW 。\x3c\/li\x3e\n\x3cli\x3eInstalling （ 正在安装 ）：SW 脚本解析完成之后，浏览器会尝试进行安装，installing 中 install 事件被执行，如果其中有 event.waitUntil ( ) 方法，则 installing 事件会一直等到该方法中的 Promise 完成之后才会成功，如果 Promise 被拒绝，则安装失败，SW会进入 Redundant（ 废弃 ）状态。\x3c\/li\x3e\n\x3cli\x3eInstalled \/ Waiting （安装成功\/等待中）：如果安装成功，SW 将会进入这个状态。\x3c\/li\x3e\n\x3cli\x3eActivating （ 正在激活 ）：处于 waiting 状态的 SW 发生以下情况，将会进入 activating 状态中：\x3cp\x3e当前已无激活状态的 worker 、 SW脚本中的 self.skipWaiting（）方法被调用 （ ps： self 是 SW 中作用于全局的对象，这个方法根据英文翻译过来也能明白什么意思啦，跳过等待状态 ）、用户已关闭 SW 作用域下的所有页面，从而释放了当前处于激活状态的 worker、超出指定时间，从而释放当前处于激活状态的 worker\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3eActivated （ 激活成功 ）：该状态，其成功接收了 document 全面控制的激活态 worker 。\x3c\/li\x3e\n\x3cli\x3eRedundant （ 废弃 ）：这个状态的出现时有原因的，如果 installing 事件失败或者 activating 事件失败或者新的 SW 替换其成为激活态 worker 。installing 事件失败和 activating 事件失败的信息我们可以在 Chrome 浏览器的 DevTools 中查看\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e一个很不错的全面介绍sw的教程：\x3ca href=\x22https:\/\/www.villainhr.com\/page\/2017\/01\/08\/Service%20Worker%20%E5%85%A8%E9%9D%A2%E8%BF%9B%E9%98%B6\x22 rel=\x22nofollow noreferrer\x22\x3ehttps:\/\/www.villainhr.com\/page\/2017\/01\/08\/Service%20Worker%20%E5%85%A8%E9%9D%A2%E8%BF%9B%E9%98%B6\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3\x3eManifest\x3c\/h3\x3e\n\x3cp\x3eWeb App Manifest 是一个 W3C 规范，它定义了一个基于 JSON 的 List 。Manifest 在 PWA 中的作用有：\x3c\/p\x3e\n\x3cp\x3e​                  能够将你浏览的网页添加到你的手机屏幕上\x3c\/p\x3e\n\x3cp\x3e​                  在 Android 上能够全屏启动，不显示地址栏 （ 由于 Iphone 手机的浏览器是 Safari ，所以不支持哦）\x3c\/p\x3e\n\x3cp\x3e​                  控制屏幕 横屏 \/ 竖屏 展示\x3c\/p\x3e\n\x3cp\x3e​                  定义启动画面\x3c\/p\x3e\n\x3cp\x3e​                  可以设置你的应用启动是从主屏幕启动还是从 URL 启动\x3c\/p\x3e\n\x3cp\x3e​                  可以设置你添加屏幕上的应用程序图标、名字、图标大小\x3c\/p\x3e\n\x3ch3\x3ePush Notification\x3c\/h3\x3e\n\x3cp\x3ePush 和 Notification 是两个不同的功能，涉及到两个 API 。\x3c\/p\x3e\n\x3cp\x3e​    Notification 是浏览器发出的通知消息。\x3c\/p\x3e\n\x3cp\x3e​    Push 和 Notification 的关系，Push：服务器端将更新的信息传递给 SW ，Notification： SW 将更新的信息推送给用户。\x3c\/p\x3e\n\x3ch2\x3ePWA示例\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e准备\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e我们先创建一个关于 PWA 的项目文件夹，\x3c\/p\x3e\n\x3cp\x3e进入文件夹下我们准备一张 120x120的图片一张，作为我们的应用程序图标。\x3c\/p\x3e\n\x3cp\x3e创建一个 index.html  文件\x3c\/p\x3e\n\x3cp\x3e创建一个 main.css 文件\x3c\/p\x3e\n\x3cp\x3e创建一个 manifest.json 文件\x3c\/p\x3e\n\x3cp\x3e创建一个 sw.js 文件\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639481?w=340\x26amp;h=143\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639481?w=340\x26amp;h=143\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eindex.html\x3c\/strong\x3e\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22html\x22\x3e\x26lt;!DOCTYPE html\x26gt;\n\x26lt;html lang=\x22en\x22\x26gt;\n\x26lt;head\x26gt;\n  \x26lt;meta charset=\x22UTF-8\x22\x26gt;\n  \x26lt;title\x26gt;Hello PWA\x26lt;\/title\x26gt;\n  \x26lt;meta name=\x22viewport\x22 content=\x22width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\x22\x26gt;\n  \x26lt;link rel=\x22stylesheet\x22 href=\x22main.css\x22\x26gt;\n  \x26lt;link rel=\x22manifest\x22 href=\x22manifest.json\x22\x26gt;\n\x26lt;\/head\x26gt;\n\x26lt;body\x26gt;\n  \x26lt;h3\x26gt;Hello PWA\x26lt;\/h3\x26gt;\n\x26lt;\/body\x26gt;\n\x26lt;script\x26gt;\n  \/\/ 检测浏览器是否支持SW\n  if(navigator.serviceWorker != null){\n    navigator.serviceWorker.register(\x27sw.js\x27)\n    .then(function(registartion){\n      console.log(\x27支持sw:\x27,registartion.scope)\n    })\n  }\n\x26lt;\/script\x26gt;\n\x26lt;\/html\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3emain.css\x3c\/strong\x3e\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22css\x22\x3eh3{\n  color: #f00;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3emanifest.json\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3eshort_name: “ \x22 用户主屏幕上的应用名字\x3c\/p\x3e\n\x3cp\x3edisplay : “standalone\x22  设置启动样式，让您的网络应用隐藏浏览器的 URL 地址栏\x3c\/p\x3e\n\x3cp\x3estart_url : “\/“ 设置启动网址，如果不提供的话，默认是使用当前页面\x3c\/p\x3e\n\x3cp\x3etheme_color : “ “  用来告知浏览器用什么颜色来为地址栏等 UI 元素着色\x3c\/p\x3e\n\x3cp\x3ebackground_color: “ ” 设置启动页面的背景颜色\x3c\/p\x3e\n\x3cp\x3eicons：””  就是添加到主屏幕之后的图标\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22json\x22\x3e{\n  \x22name\x22: \x22一个PWA示例\x22,\n  \x22short_name\x22: \x22PWA示例\x22,\n  \x22start_url\x22: \x22\/index.html\x22,\n  \x22display\x22: \x22standalone\x22,\n  \x22background_color\x22: \x22#fff\x22,\n  \x22theme_color\x22: \x22#3eaf7c\x22,\n  \x22icons\x22: [\n    {\n      \x22src\x22: \x22\/youhun.jpg\x22,\n      \x22sizes\x22: \x22120x120\x22,\n      \x22type\x22: \x22image\/png\x22\n    }\n  ],\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3esw.js\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e看网上很多人都安装的hs和ngrok去调试，在这里为了照顾新手我是直接引用的sw\x3c\/p\x3e\n\x3cp\x3e处理静态缓存，首先定义需要缓存的路径，以及需要缓存的静态文件的列表。\x3c\/p\x3e\n\x3cp\x3e借助 SW 注册完成安装 SW 时，抓取资源写入缓存中。使用了一个方法那就是 self.skipWaiting( ) ，为了在页面更新的过程当中，新的 SW 脚本能够立刻激活和生效。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3eimportScripts(\x22https:\/\/storage.googleapis.com\/workbox-cdn\/releases\/3.1.0\/workbox-sw.js\x22);\nvar cacheStorageKey = \x27minimal-pwa-1\x27\nvar cacheList=[\n  \x27\/\x27,\n  \x27index.html\x27,\n  \x27main.css\x27,\n  \x27youhun.jpg\x27\n]\nself.addEventListener(\x27install\x27,e =\x26gt;{\n  e.waitUntil(\n    caches.open(cacheStorageKey)\n    .then(cache =\x26gt; cache.addAll(cacheList))\n    .then(() =\x26gt; self.skipWaiting())\n  )\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e处理动态缓存，我们监听 fetch 事件，在 caches 中去 match 事件的 request ，如果 response 不为空的话就返回 response ，最后返回 fetch 请求，在 fetch 事件中我们可以手动生成 response 返回给页面。\x3c\/p\x3e\n\x3cp\x3e更新静态资源，缓存的资源会跟随着版本的更新会过期的，所以会根据缓存的字符串名称清除旧缓存。在新安装的 SW 中通过调用 self.clients.claim( ) 取得页面的控制权，这样之后打开页面都会使用版本更新的缓存。旧的 SW 脚本不在控制着页面之后会被停止，也就是会进入 Redundant 期。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3eself.addEventListener(\x27fetch\x27,function(e){\n  e.respondWith(\n    caches.match(e.request).then(function(response){\n      if(response != null){\n        return response\n      }\n      return fetch(e.request.url)\n    })\n  )\n})\nself.addEventListener(\x27activate\x27,function(e){\n  e.waitUntil(\n    \/\/获取所有cache名称\n    caches.keys().then(cacheNames =\x26gt; {\n      return Promise.all(\n        \/\/ 获取所有不同于当前版本名称cache下的内容\n        cacheNames.filter(cacheNames =\x26gt; {\n          return cacheNames !== cacheStorageKey\n        }).map(cacheNames =\x26gt; {\n          return caches.delete(cacheNames)\n        })\n      )\n    }).then(() =\x26gt; {\n      return self.clients.claim()\n    })\n  )\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e部署\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e我们可以把当前pwa目录的所有内容都扔进服务器中，或者coding Pages和gitHub Pages也是可以的，当然，记得开启https。在上变介绍过SW的权利比较大，为了安全性，我们使用https协议来访问。\x3c\/p\x3e\n\x3cp\x3e试着访问一下，我们这里用的coding Pages并且绑定了自己的域名\x3c\/p\x3e\n\x3cp\x3e打开 chrom 的调试工具，打开 application ，点击 service workers 之后我们会发现 sw.js 脚本已经存到了 SW 中 。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639482?w=1617\x26amp;h=863\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639482?w=1617\x26amp;h=863\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们打开 Network 刷新页面一下，看看，我们的页面资源来自 SW 而不是其他的地方，在 Console 中也打印出了我们在 index.html 中判断的语句，浏览器支持就会打印出这一句话。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639483?w=1032\x26amp;h=368\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639483?w=1032\x26amp;h=368\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e接下来我们断网操作，在 Application 中给 Offline 打上对勾就行啦。然后刷新页面，我们仍然能看到之前的页面，原因就是我们在上图看到，他的资源是从 SW 上获得到的。当我们第一次打开这个页面的时候，Resopnse 对象被存到了 Cache Storage （ 定义在 SW 规范中 ，相关资料请同学们自行查询啦 ）中，我们看下图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639484?w=827\x26amp;h=461\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639484?w=827\x26amp;h=461\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e通过存放到 Cache Storage 中，我们下次访问的时候如果是弱网或者断网的情况下，就可以不走网络请求，而直接就能将本地缓存的内容展示给用户，优化用户的弱网及断网体验。\x3c\/p\x3e\n\x3cp\x3e这个时候肯定会有同学在想，如果内容更新了，那么页面展示的内容是新内容呢还是旧内容呢？下面我们操作一下，打开 index.html 文件，我们在 body 中添加一个 p 标签 ，然后回到页面刷新。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639485?w=713\x26amp;h=258\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639485?w=713\x26amp;h=258\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639486?w=1731\x26amp;h=715\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639486?w=1731\x26amp;h=715\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们看到，页面上的内容并没有显示出我刚刚添加的那个 p 标签。这说明了，我们拿到的数据还是从 Cache Storage 中获取到的，Cache Storage中的内容并没有更新，强制刷新也不行哦，那么我们怎么才能让我刚刚添加的那个 p 标签显示出来呢。\x3c\/p\x3e\n\x3cp\x3e我们打开 sw.js 脚本文件，我们修改一下 cacheStorageKey。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639487?w=765\x26amp;h=330\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639487?w=765\x26amp;h=330\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e修改后，我们再次打开该网址，强制刷新下或者关掉浏览器重新打开。\x3c\/p\x3e\n\x3cp\x3e页面中出现了刚刚添加的P标签，我们再看一下 Cache Storage 中的缓存名字，已经被修改。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014639488?w=1473\x26amp;h=548\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014639488?w=1473\x26amp;h=548\x22 alt=\x22\x22 title=\x22\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2\x3e总结\x3c\/h2\x3e\n\x3cp\x3e如果是使用coding或者gitHub提供的pages服务，则需要注意最好绑定下独立域名。如果不绑定则注意下文件请求路径即可。\x3c\/p\x3e\n\x3cp\x3e研究PWA门槛不低，部署的服务器要求HTTPS，ServiceWorker涉及API众多，需要单独学习，另外npm中也已经有这个包了\x3ca href=\x22https:\/\/www.npmjs.com\/package\/web-pwa\x22 rel=\x22nofollow noreferrer\x22\x3ehttps:\/\/www.npmjs.com\/package...\x3c\/a\x3e ，玩玩可以，真正部署到项目生产环境可能坑很多，但有坑填坑，不折腾还叫前端么。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>PWA介绍及快速上手搭建一个PWA应用</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014639473">https://segmentfault.com/a/1190000014639473</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/9roazjmgg1b/" target="_blank">https://alili.tech/archive/9roazjmgg1b/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>