<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Weex 开发小游戏是件很 high 的事儿"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Weex 开发小游戏是件很 high 的事儿 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/bsw7ctkpjgj/",
				"appid": "1613049289050283", 
				"title": "Weex 开发小游戏是件很 high 的事儿 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-28T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/qzpfeltbqm/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/igkenm2gei/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fbsw7ctkpjgj%2f&text=Weex%20%e5%bc%80%e5%8f%91%e5%b0%8f%e6%b8%b8%e6%88%8f%e6%98%af%e4%bb%b6%e5%be%88%20high%20%e7%9a%84%e4%ba%8b%e5%84%bf"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fbsw7ctkpjgj%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fbsw7ctkpjgj%2f&text=Weex%20%e5%bc%80%e5%8f%91%e5%b0%8f%e6%b8%b8%e6%88%8f%e6%98%af%e4%bb%b6%e5%be%88%20high%20%e7%9a%84%e4%ba%8b%e5%84%bf"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fbsw7ctkpjgj%2f&title=Weex%20%e5%bc%80%e5%8f%91%e5%b0%8f%e6%b8%b8%e6%88%8f%e6%98%af%e4%bb%b6%e5%be%88%20high%20%e7%9a%84%e4%ba%8b%e5%84%bf"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fbsw7ctkpjgj%2f&is_video=false&description=Weex%20%e5%bc%80%e5%8f%91%e5%b0%8f%e6%b8%b8%e6%88%8f%e6%98%af%e4%bb%b6%e5%be%88%20high%20%e7%9a%84%e4%ba%8b%e5%84%bf"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Weex%20%e5%bc%80%e5%8f%91%e5%b0%8f%e6%b8%b8%e6%88%8f%e6%98%af%e4%bb%b6%e5%be%88%20high%20%e7%9a%84%e4%ba%8b%e5%84%bf&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fbsw7ctkpjgj%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fbsw7ctkpjgj%2f&title=Weex%20%e5%bc%80%e5%8f%91%e5%b0%8f%e6%b8%b8%e6%88%8f%e6%98%af%e4%bb%b6%e5%be%88%20high%20%e7%9a%84%e4%ba%8b%e5%84%bf"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbsw7ctkpjgj%2f&title=Weex%20%e5%bc%80%e5%8f%91%e5%b0%8f%e6%b8%b8%e6%88%8f%e6%98%af%e4%bb%b6%e5%be%88%20high%20%e7%9a%84%e4%ba%8b%e5%84%bf"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbsw7ctkpjgj%2f&title=Weex%20%e5%bc%80%e5%8f%91%e5%b0%8f%e6%b8%b8%e6%88%8f%e6%98%af%e4%bb%b6%e5%be%88%20high%20%e7%9a%84%e4%ba%8b%e5%84%bf"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbsw7ctkpjgj%2f&title=Weex%20%e5%bc%80%e5%8f%91%e5%b0%8f%e6%b8%b8%e6%88%8f%e6%98%af%e4%bb%b6%e5%be%88%20high%20%e7%9a%84%e4%ba%8b%e5%84%bf"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Weex 开发小游戏是件很 high 的事儿</h1><div class="meta"><div class="postdate"><time datetime="2018-12-28" itemprop="datePublished">2018-12-28</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e前言\x3c\/h1\x3e\n\x3cp\x3e作为一个移动端初学者、爱好者，能使用前端技术开发原生游戏一直是一件渴望而不可及的事情，暂且不说游戏逻辑的复杂度，算法的健壮性，单单是场景、画布、布局就让我们无处下手。\x3c\/p\x3e\n\x3cp\x3e几年前曾经参与 Appcan 技术的技术孵化和推广，尝试使用 Hybrid 技术写过一个小游戏，\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000011007935\x22\x3e《Hybrid混合实现app小游戏》\x3c\/a\x3e，由于此游戏结构场景比较简单，所以未使用大型的游戏引擎，\x3ca href=\x22http:\/\/www.cocos.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCocos2d-x游戏引擎\x3c\/a\x3e，所有逻辑全部手工。同样也是可「三端同构」，但本质上还是一个 H5小游戏，只是在真机上，执行环境是一个 UIWebview，所以，H5可以做的，他都可以做，H5不能做到，他未必不能做，如摄像头、陀螺仪等。但缺点也很致命，执行效率完全受限于原生控件 UIWebview，要知道对于一个游戏来讲，流畅度是第一要义。\x3c\/p\x3e\n\x3cp\x3e总的来讲，使用 Hybrid 技术开发游戏的方案虽然可行，但是，效果并不是我想要的。\x3c\/p\x3e\n\x3cp\x3e自从 ReactNative 开源以来，一直想着要使用 ReactNative 开发游戏。个人原因，一直未付诸实践。直到上周有网友问我，「Weex是否能拿来做游戏开发」，试试就知道，那就先拿 Weex 开刀，来挑战下 game app 同构的能力，给还没上车的朋友带波节奏。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e准备工作\x3c\/h1\x3e\n\x3cp\x3e如果你还未入门，没关系，就当看个热闹了，知道 Weex 能不能快速开发游戏就可以了。\x3c\/p\x3e\n\x3cp\x3e如果你想先入门，以下几篇文章你可以当作是导读。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000011154120\x22\x3e《Native、Web App、Hybrid、React Native 和 Weex》\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000010984857\x22 target=\x22_blank\x22\x3e《Weex 快速创建工程 Hello World》\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000011027225\x22\x3e《网易严选 App 感受 Weex 开发》\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e扫雷游戏 Demo\x3c\/h1\x3e\n\x3cp\x3e官方提供的 WeexPlayground 中也提供了一个游戏 demo 扫雷，如下图\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011654088?w=252\x26amp;h=451\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011654088?w=252\x26amp;h=451\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e此 demo 是为了实践以下三件事：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e界面指示器\x3c\/li\x3e\n\x3cli\x3e动态数据绑定\x3c\/li\x3e\n\x3cli\x3e更复杂的事件\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e总体表现还是不错的。更多细节，可详读\x3ca href=\x22https:\/\/yq.aliyun.com\/articles\/42627?spm=5176.100240.searchblog.35.XuBful\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《Weex版扫雷游戏开发》\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3e我的小游戏\x3c\/h1\x3e\n\x3cp\x3e别人的东西再炫酷也始终是别人的，不自己动手码一个说话都不硬气！\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e没有实践就没有发言权，此处献上源码的 Github 链接：\x3ca href=\x22https:\/\/github.com\/zwwill\/just-do-8\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/zwwill\/just-do-8\x3c\/a\x3e，欢迎「Star」「Fork」，支持瞎搞 ψ(｀∇´)ψ\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e先来感受下最终的效果\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e界面\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011657670?w=1240\x26amp;h=537\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011657670?w=1240\x26amp;h=537\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e体验\x3c\/h2\x3e\n\x3cp\x3eIOS已上线 \x3ca href=\x22https:\/\/itunes.apple.com\/cn\/app\/id1299422482\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/itunes.apple.com\/cn\/a...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e也可以直接使用 Weex Playground 扫码体验\x26nbsp;\x3ca href=\x22http:\/\/weex.apache.org\/cn\/playground.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWeex Playground下载地址\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011654090?w=280\x26amp;h=280\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011654090?w=280\x26amp;h=280\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e近期将发布到应用市场，届时还望大家多多支持。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e规则\x3c\/h3\x3e\n\x3cp\x3e规则很简单，会玩「俄罗斯方块」和「2048」就一定会玩这款小游戏\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e一期功能\x3c\/h3\x3e\n\x3cp\x3e由于要快速产出，界面随便就别太在意了，另外很多功能还没有开发，如，全球排名、分享、游戏设置等，这些都放在后面慢慢迭代吧（如果有第二版的话(￣.￣)）\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e源码分析\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e接下来是一大波源码分析，不感冒？那就直接跳过。\x3cbr\x3e由于篇幅有限，此处只做简要介绍，详细请见工程源码，地址请爬楼\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e项目结构\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011654091?w=535\x26amp;h=305\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011654091?w=535\x26amp;h=305\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e只有三个文件（一个场景两个组件）。我来逐一讲解下每个文件的职能。\x3c\/p\x3e\n\x3ch4\x3eindex.vue\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3cstrong\x3e【index.vue】\x3c\/strong\x3e是一个场景文件，用于根据状态切换场景，以及监听处理所有的手势\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e【模版 | 简码】\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ctemplate\x3e\n  \x3cdiv class=\x26quot;wrapper\x26quot; @swipe=\x26quot;onSwipe\x26quot; @click=\x26quot;onClick\x26quot; @panstart=\x26quot;onPanstart\x26quot; @panend=\x26quot;onPanend\x26quot; @horizontalpan=\x26quot;onHorizontalpan\x26quot;\x3e\n    \x3c!-- 此处省略一堆代码 --\x3e\n    \x3cstoneMap v-if=\x26quot;stoneMapShow\x26quot; ref=\x26quot;rStoneMap\x26quot; class=\x26quot;stone-map\x26quot; @screenLock=\x26quot;onScreenLock\x26quot; @screenUnlock=\x26quot;onScreenUnlock\x26quot; @over=\x26quot;onGameover\x26quot; @win=\x26quot;onGameWin\x26quot;\x3e\x3c\/stoneMap\x3e\n    \x3c!-- 此处省略一堆代码 --\x3e\n  \x3c\/div\x3e\n\x3c\/template\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22wrapper\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3eswipe\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onSwipe\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3eclick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onClick\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3epanstart\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onPanstart\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3epanend\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onPanend\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3ehorizontalpan\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onHorizontalpan\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- 此处省略一堆代码 --\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estoneMap\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-if\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stoneMapShow\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22rStoneMap\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stone-map\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3escreenLock\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onScreenLock\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3escreenUnlock\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onScreenUnlock\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3eover\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onGameover\x22\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3ewin\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onGameWin\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estoneMap\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- 此处省略一堆代码 --\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们监听了 Weex 的一堆事件来「合成」我们需要的【切换】【左右滑动】【下降】等主要游戏操作。如\x3ccode\x3e@swipe\x3c\/code\x3e、\x3ccode\x3e@click\x3c\/code\x3e、\x3ccode\x3e@panstart\x3c\/code\x3e、\x3ccode\x3e@panend\x3c\/code\x3e和\x3ccode\x3e@horizontalpan\x3c\/code\x3e，同时给\x3ccode\x3e\x26lt;stoneMap \/\x26gt;\x3c\/code\x3e组件注册\x3ccode\x3e@screenLock\x3c\/code\x3e、\x3ccode\x3e@screenUnlock\x3c\/code\x3e、\x3ccode\x3e@over\x3c\/code\x3e和\x3ccode\x3e@win\x3c\/code\x3e等事件，用于游戏场景切换。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3e@swipe\x3c\/strong\x3e：\x3ccode\x3eswipe\x3c\/code\x3e的属性\x3ccode\x3edirection\x3c\/code\x3e提供在屏幕上滑动时触发的方向，本项目用到\x3ccode\x3eup\x3c\/code\x3e、\x3ccode\x3edown\x3c\/code\x3e，官方给的说法是『\x3ccode\x3edirection\x3c\/code\x3e的值可能为\x3ccode\x3eup\x3c\/code\x3e、\x3ccode\x3eleft\x3c\/code\x3e、\x3ccode\x3ebottom\x3c\/code\x3e、\x3ccode\x3eright\x3c\/code\x3e』但实际上我得到的却是\x3ccode\x3edown\x3c\/code\x3e而不是\x3ccode\x3ebottom\x3c\/code\x3e，具体请客还在和Weex的开发团队进行沟通，确认后会更新上来。另外要注意的是\x3ccode\x3e@swipe\x3c\/code\x3e、\x3ccode\x3e@click\x3c\/code\x3e、\x3ccode\x3e@panstart\x3c\/code\x3e、\x3ccode\x3e@panend\x3c\/code\x3e和\x3ccode\x3e@horizontalpan\x3c\/code\x3e这些事件同时使用时会出现冲突问题，Android 平台下问题比较多，具体大家在做的时候需要做好兼容\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e@click\x3c\/strong\x3e：常规的\x3ccode\x3eclick\x3c\/code\x3e事件\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e@panstart、@panend、@horizontalpan\x3c\/strong\x3e：用于计算左右滑动距离，每滑动40个显示像素就向\x3ccode\x3e\x26lt;stoneMap \/\x26gt;\x3c\/code\x3e组件发起滑块左右滑动的指令\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e具体事件的使用姿势，大家可以详读\x3ca href=\x22https:\/\/weex.apache.org\/cn\/references\/gesture.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e官方文档\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e每一个事件方法的功能实现和视觉此处就略去了。\x3c\/p\x3e\n\x3ch4\x3estoneMap.vue\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3cstrong\x3e【stoneMap.vue】\x3c\/strong\x3e就像是「大内总管」，一切闲杂喽啰的事都归他管。主要管理的数字块的布局、状态、游戏分值等\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e【简码】\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ctemplate\x3e\n    \x3cdiv class=\x26quot;u-slider\x26quot;\x3e\n        \x3c!-- 此处省略一些记录分值等无关紧要的代码 --\x3e\n        \x3ctemplate v-for=\x26quot;i in stones\x26quot;\x3e\n            \x3cstone :ref=\x26quot;i.id\x26quot; :id=\x26quot;i.id\x26quot; :p0=\x26quot;i.p0\x26quot; :num0=\x26quot;i.s\x26quot;\x3e\x3c\/stone\x3e\n        \x3c\/template\x3e\n    \x3c\/div\x3e\n\x3c\/template\x3e\n\x3cscript\x3e\n   export default {\n        components: {\n            stone: stone\n        },\n        data() {\n            return {\n                MAX_H: 9,\n                stones: [],\n                map: [],\n                \/\/ 此处省略一些无关紧要的data\n            }\n        },\n        mounted() {\n            \/\/ 绘制画布矩阵\n            for (let _i = 0; _i \x3c this.MAX_H; _i\x2b\x2b) {\n                this.map.push([\x27\x27, \x27\x27, \x27\x27, \x27\x27, \x27\x27, \x27\x27]);\n            }\n            \/\/ 开始游戏\n            this.pushStones();\n        },\n        methods: {\n            \/**\n             * 事件控制\n             * *\/\n            action(_action) { \/* ... *\/ },\n            \/**\n             * 新增三个单元数字块\n             * *\/\n            pushStones() { \/* ... *\/ },\n            \/**\n             * 滑块切换\n             * *\/\n            actionChange() { \/* ... *\/ },\n            \/**\n             * 滑块左右滚动\n             * *\/\n            actionSliderMove(_d) { \/* ... *\/ },\n            \/**\n             * 单元块位置移动\x2b权重加码\n             * *\/\n            actionDown() { \/* ... *\/ },\n            \/**\n             * 重新计算map并更新\n             * *\/\n            mapUpdate() { \/* ... *\/ },\n            \/**\n             * 计算map\n             * *\/\n            mapCalculator: (function () { \/* ... *\/ })(),\n            \/**\n             * 整理数字块，堆积下降\n             * *\/\n            stonesTrim() { \/* ... *\/ },\n            \/**\n             * 单元块位置移动\x2b权重加码\n             * *\/\n            sChange(_id, _p, _score) { \/* ... *\/ }\n        }\n    }\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22u-slider\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- 此处省略一些记录分值等无关紧要的代码 --\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-for\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22i in stones\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estone\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e:ref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22i.id\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e:id\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22i.id\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e:p0\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22i.p0\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e:num0\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22i.s\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estone\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n   \x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponents\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3estone\x3c\/span\x3e: stone\n        },\n        data() {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-attr\x22\x3eMAX_H\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e9\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3estones\x3c\/span\x3e: [],\n                \x3cspan class=\x22hljs-attr\x22\x3emap\x3c\/span\x3e: [],\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 此处省略一些无关紧要的data\x3c\/span\x3e\n            }\n        },\n        mounted() {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 绘制画布矩阵\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e _i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; _i \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.MAX_H; _i\x2b\x2b) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.map.push([\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e]);\n            }\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 开始游戏\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.pushStones();\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3emethods\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 事件控制\n             * *\/\x3c\/span\x3e\n            action(_action) { \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 新增三个单元数字块\n             * *\/\x3c\/span\x3e\n            pushStones() { \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 滑块切换\n             * *\/\x3c\/span\x3e\n            actionChange() { \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 滑块左右滚动\n             * *\/\x3c\/span\x3e\n            actionSliderMove(_d) { \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 单元块位置移动\x2b权重加码\n             * *\/\x3c\/span\x3e\n            actionDown() { \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 重新计算map并更新\n             * *\/\x3c\/span\x3e\n            mapUpdate() { \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 计算map\n             * *\/\x3c\/span\x3e\n            mapCalculator: (\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e })(),\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 整理数字块，堆积下降\n             * *\/\x3c\/span\x3e\n            stonesTrim() { \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 单元块位置移动\x2b权重加码\n             * *\/\x3c\/span\x3e\n            sChange(_id, _p, _score) { \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e }\n        }\n    }\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3ethis.stones\x3c\/strong\x3e：用于管理所有实例进来的数字块，将他们投影到界面上\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3ethis.map\x3c\/strong\x3e：是一个6*9的逻辑网，标记 this.stones 中的的数字块的逻辑位置\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e此处主要介绍下事件的控制分发和逻辑网的计算，讲解在注释中\x3c\/p\x3e\n\x3cp\x3e【action() | 简码】\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 事件的控制分发\n * *\/\naction(_action) {\n    if (!!this.actionLock) return;\n    switch (_action) {\n        case \x27click\x27:\n        case \x27up\x27:\n            \/\/ click 和 up 触发上方三个活动数字块的互相切换\n            this.actionChange();\n            break;\n        case \x27left\x27:\n        case \x27right\x27:\n            \/\/ left 和 right 触发上方三个活动数字块的的整体平移\n            this.actionSliderMove(_action);\n            break;\n        case \x27down\x27:\n        case \x27bottom\x27:\n            \/\/ down 触发上方三个活动数字块进场\n            \/\/ bottom 起到兼容的作用\n            this.actionDown();\n            break;\n        default:\n            break;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 事件的控制分发\n * *\/\x3c\/span\x3e\naction(_action) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.actionLock) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (_action) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e:\n        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27up\x27\x3c\/span\x3e:\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ click 和 up 触发上方三个活动数字块的互相切换\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.actionChange();\n            \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27left\x27\x3c\/span\x3e:\n        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27right\x27\x3c\/span\x3e:\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ left 和 right 触发上方三个活动数字块的的整体平移\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.actionSliderMove(_action);\n            \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27down\x27\x3c\/span\x3e:\n        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27bottom\x27\x3c\/span\x3e:\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ down 触发上方三个活动数字块进场\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ bottom 起到兼容的作用\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.actionDown();\n            \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n            \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e【mapCalculator() | 全码】\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 计算map\n * *\/\nmapCalculator: (function () {\n    var updateStone = function (_stones, _id, _s) {\n        \/** \n         * 此方法控制得分规则\n         * 横竖对角线\x2b1分\n         * 十字、X型\x2b2分\n         * 8字型、9宫格分别\x2b3分、\x2b4分，当然，不可能存在这两种情况\n         * *\/\n        if (_stones[_id]) {\n            _s != 0 \x26amp;\x26amp; _s \x3c 8 \x26amp;\x26amp; (_stones[_id][\x27score\x27] == 0 ? _stones[_id][\x27score\x27] = _s : _stones[_id][\x27score\x27]\x2b\x2b);\n        } else {\n            _stones[_id] = {\n                id: _id,\n                score: _s\n            }\n        }\n    };\n    \n    return function (_map) {\n        let hasChange = false,\n            activeStones = {},\n            height = _map.length - 1,\n            width = _map[0].length - 1,\n            _tp_id, _s;\n        \/\/ 全逻辑网遍历\n        for (let y = height; y \x3e= 0; y--) {\n            for (let x = 0; x \x3c= width; x\x2b\x2b) {\n                _tp_id = _map[y][x] || \x26quot;\x26quot;;\n                \/\/ 排除四角\n                if (!_tp_id || (x == 0 || x == width) \x26amp;\x26amp; (y == 0 || y == height)) continue; \n                \n                _s = parseInt(this.$refs[_tp_id][0].num);\n                let _p1, _p2;\n                if (x == 0 || x == width || y == 0 || y == height) {\n                    \/\/ 侧边，将其单独提炼出来是为了减少计算量三分之一的计算量\n                    if (x == 0 || x == width) {\n                        \/\/ 竖排\n                        if (!_map[y - 1][x] || !_map[y \x2b 1][x]) continue;\n                        _p1 = this.$refs[_map[y - 1][x]][0];\n                        _p2 = this.$refs[_map[y \x2b 1][x]][0];\n                    } else if (y == 0 || y == height) {\n                        \/\/ 横排\n                        if (!_map[y][x - 1] || !_map[y][x \x2b 1]) continue;\n                        _p1 = this.$refs[_map[y][x - 1]][0];\n                        _p2 = this.$refs[_map[y][x \x2b 1]][0];\n                    }\n                    if (_p1 \x26amp;\x26amp; _p2 \x26amp;\x26amp; _p1.num == _s \x26amp;\x26amp; _p2.num == _s) {\n                        hasChange = true;\n                        updateStone(activeStones, _tp_id, \x2b\x2b_s);\n                        updateStone(activeStones, _p1.id, 0);\n                        updateStone(activeStones, _p2.id, 0);\n                    }\n                } else {\n                    \/\/ 中间可形成九宫格区域\n                    const _map_matrix = [\n                        [[0, 1], [0, -1]],\n                        [[-1, 1], [1, -1]],\n                        [[-1, 0], [1, 0]],\n                        [[-1, -1], [1, 1]]\n                    ];\n                    for (let _i = 0, _mm; _i \x3c _map_matrix.length; _i\x2b\x2b) {\n                        _mm = _map_matrix[_i];\n                        if (!_map[y \x2b _mm[0][0]][x \x2b _mm[0][1]] || !_map[y \x2b _mm[1][0]][x \x2b _mm[1][1]]) continue;\n                        _p1 = this.$refs[_map[y \x2b _mm[0][0]][x \x2b _mm[0][1]]][0];\n                        _p2 = this.$refs[_map[y \x2b _mm[1][0]][x \x2b _mm[1][1]]][0];\n                        if (_p1 \x26amp;\x26amp; _p2 \x26amp;\x26amp; _p1.num == _s \x26amp;\x26amp; _p2.num == _s) {\n                            hasChange = true;\n                            updateStone(activeStones, _tp_id, _s \x2b 1);\n                            updateStone(activeStones, _p1.id, 0);\n                            updateStone(activeStones, _p2.id, 0);\n                        }\n                    }\n                }\n            }\n        }\n\n        \/\/ 存在更新块\n        if (hasChange) {\n            setTimeout(() =\x3e {\n                for (let s in activeStones) {\n                    this.sChange(s, undefined, activeStones[s].score);\n                }\n                \/\/ 数字块整理\n                setTimeout(() =\x3e {\n                    this.stonesTrim();\n                }, 100)\n            }, 400)\n        } else {\n            let _errorStone = \x26quot;\x26quot;;\n            for (let _i = 0; _i \x3c this.map[0].length; _i\x2b\x2b) {\n                if (this.map[0][_i]) {\n                    _errorStone = this.$refs[this.map[0][_i]][0].$refs[\x27stone\x27];\n                    break;\n                }\n            }\n            if (!!_errorStone) {\n                this.$emit(\x27over\x27, this.totalScore, this.highScore, _errorStone);\n                if (this.totalScore \x3e this.highScore) {\n                    storage.setItem(\x27H-SCORE\x27, this.totalScore)\n                }\n            } else {\n                this.$emit(\x27screenUnlock\x27);\n                setTimeout(() =\x3e {\n                    this.pushStones();\n                }, 100);\n            }\n        }\n    }\n})()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 计算map\n * *\/\x3c\/span\x3e\nmapCalculator: (\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e updateStone = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e_stones, _id, _s\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/** \n         * 此方法控制得分规则\n         * 横竖对角线\x2b1分\n         * 十字、X型\x2b2分\n         * 8字型、9宫格分别\x2b3分、\x2b4分，当然，不可能存在这两种情况\n         * *\/\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (_stones[_id]) {\n            _s != \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x26amp;\x26amp; _s \x26lt; \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e \x26amp;\x26amp; (_stones[_id][\x3cspan class=\x22hljs-string\x22\x3e\x27score\x27\x3c\/span\x3e] == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ? _stones[_id][\x3cspan class=\x22hljs-string\x22\x3e\x27score\x27\x3c\/span\x3e] = _s : _stones[_id][\x3cspan class=\x22hljs-string\x22\x3e\x27score\x27\x3c\/span\x3e]\x2b\x2b);\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            _stones[_id] = {\n                \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: _id,\n                \x3cspan class=\x22hljs-attr\x22\x3escore\x3c\/span\x3e: _s\n            }\n        }\n    };\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e_map\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e hasChange = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n            activeStones = {},\n            height = _map.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n            width = _map[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n            _tp_id, _s;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 全逻辑网遍历\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e y = height; y \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; y--) {\n            \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e x = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; x \x26lt;= width; x\x2b\x2b) {\n                _tp_id = _map[y][x] || \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 排除四角\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!_tp_id || (x == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e || x == width) \x26amp;\x26amp; (y == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e || y == height)) \x3cspan class=\x22hljs-keyword\x22\x3econtinue\x3c\/span\x3e; \n                \n                _s = \x3cspan class=\x22hljs-built_in\x22\x3eparseInt\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[_tp_id][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].num);\n                \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e _p1, _p2;\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (x == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e || x == width || y == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e || y == height) {\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 侧边，将其单独提炼出来是为了减少计算量三分之一的计算量\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (x == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e || x == width) {\n                        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 竖排\x3c\/span\x3e\n                        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!_map[y - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e][x] || !_map[y \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e][x]) \x3cspan class=\x22hljs-keyword\x22\x3econtinue\x3c\/span\x3e;\n                        _p1 = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[_map[y - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e][x]][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n                        _p2 = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[_map[y \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e][x]][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n                    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (y == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e || y == height) {\n                        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 横排\x3c\/span\x3e\n                        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!_map[y][x - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e] || !_map[y][x \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]) \x3cspan class=\x22hljs-keyword\x22\x3econtinue\x3c\/span\x3e;\n                        _p1 = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[_map[y][x - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n                        _p2 = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[_map[y][x \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n                    }\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (_p1 \x26amp;\x26amp; _p2 \x26amp;\x26amp; _p1.num == _s \x26amp;\x26amp; _p2.num == _s) {\n                        hasChange = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n                        updateStone(activeStones, _tp_id, \x2b\x2b_s);\n                        updateStone(activeStones, _p1.id, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n                        updateStone(activeStones, _p2.id, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n                    }\n                } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 中间可形成九宫格区域\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e _map_matrix = [\n                        [[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e], [\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e]],\n                        [[\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e], [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e]],\n                        [[\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e], [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]],\n                        [[\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e], [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]]\n                    ];\n                    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e _i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, _mm; _i \x26lt; _map_matrix.length; _i\x2b\x2b) {\n                        _mm = _map_matrix[_i];\n                        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!_map[y \x2b _mm[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]][x \x2b _mm[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e][\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]] || !_map[y \x2b _mm[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]][x \x2b _mm[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e][\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]]) \x3cspan class=\x22hljs-keyword\x22\x3econtinue\x3c\/span\x3e;\n                        _p1 = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[_map[y \x2b _mm[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]][x \x2b _mm[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e][\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]]][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n                        _p2 = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[_map[y \x2b _mm[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]][x \x2b _mm[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e][\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]]][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n                        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (_p1 \x26amp;\x26amp; _p2 \x26amp;\x26amp; _p1.num == _s \x26amp;\x26amp; _p2.num == _s) {\n                            hasChange = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n                            updateStone(activeStones, _tp_id, _s \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n                            updateStone(activeStones, _p1.id, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n                            updateStone(activeStones, _p2.id, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n                        }\n                    }\n                }\n            }\n        }\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 存在更新块\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hasChange) {\n            setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e s \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e activeStones) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.sChange(s, \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e, activeStones[s].score);\n                }\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数字块整理\x3c\/span\x3e\n                setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.stonesTrim();\n                }, \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e)\n            }, \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e)\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e _errorStone = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e _i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; _i \x26lt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.map[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].length; _i\x2b\x2b) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.map[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e][_i]) {\n                    _errorStone = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.map[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e][_i]][\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].$refs[\x3cspan class=\x22hljs-string\x22\x3e\x27stone\x27\x3c\/span\x3e];\n                    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                }\n            }\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!!_errorStone) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$emit(\x3cspan class=\x22hljs-string\x22\x3e\x27over\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.totalScore, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.highScore, _errorStone);\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.totalScore \x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.highScore) {\n                    storage.setItem(\x3cspan class=\x22hljs-string\x22\x3e\x27H-SCORE\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.totalScore)\n                }\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$emit(\x3cspan class=\x22hljs-string\x22\x3e\x27screenUnlock\x27\x3c\/span\x3e);\n                setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.pushStones();\n                }, \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e);\n            }\n        }\n    }\n})()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e【stonesTrim | 全码】\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 整理数字块，堆积下降\n * *\/\nstonesTrim() {\n    let hasChange = false,\n        height = this.map.length - 1,\n        width = this.map[0].length - 1,\n        _tp_id, _step = 0;\n    for (let x = 0; x \x3c= width; x\x2b\x2b) {\n        _step = 0;\n        for (let y = height; y \x3e= 0; y--) {\n            _tp_id = this.map[y][x] || \x26quot;\x26quot;;\n            if (!_tp_id) {\n                _step\x2b\x2b;\n                continue;\n            } else if (_step \x3e 0) {\n                hasChange = true;\n                this.sChange(_tp_id, {y: _step});\n                this.map[y \x2b _step][x] = _tp_id;\n                this.map[y][x] = \x26quot;\x26quot;;\n            }\n        }\n    }\n    setTimeout(() =\x3e {\n        this.mapUpdate();\n    }, hasChange ? 200 : 0);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 整理数字块，堆积下降\n * *\/\x3c\/span\x3e\nstonesTrim() {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e hasChange = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n        height = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.map.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n        width = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.map[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n        _tp_id, _step = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e x = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; x \x26lt;= width; x\x2b\x2b) {\n        _step = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e y = height; y \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; y--) {\n            _tp_id = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.map[y][x] || \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!_tp_id) {\n                _step\x2b\x2b;\n                \x3cspan class=\x22hljs-keyword\x22\x3econtinue\x3c\/span\x3e;\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (_step \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n                hasChange = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.sChange(_tp_id, {\x3cspan class=\x22hljs-attr\x22\x3ey\x3c\/span\x3e: _step});\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.map[y \x2b _step][x] = _tp_id;\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.map[y][x] = \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n            }\n        }\n    }\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.mapUpdate();\n    }, hasChange ? \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3estone.vue\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3cstrong\x3e【stone.vue】\x3c\/strong\x3e就像被「大内总管」管理着的「小太监」（数字块），「小太监」的一举一动都是被「总管」支配的，包括其长相（颜色）、品级（数字）以及生死（生命周期），但状态的改变都是由自己执行，直接自己整容，自己升级，还要。。自杀。底层人民好无奈 ╮(╯_╰)╭\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e【简码】\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ctemplate\x3e\n    \x3ctext ref=\x26quot;stone\x26quot; class=\x26quot;u-stone\x26quot; :style=\x26quot;{color:color,visibility:visibility,backgroundColor:backgroundColor0}\x26quot; v-if=\x26quot;show\x26quot; \x3e\x22{{\x22score\x22}}\x22\x3c\/text\x3e\n\x3c\/template\x3e\n\n\x3cscript\x3e\n    const animation = weex.requireModule(\x27animation\x27);\n    export default {\n        props: [\x27id\x27, \x27p0\x27, \x27num0\x27],\n        data(){\n            return {\n                show: true,\n                p: \x270,8\x27,\n                visibility: \x27\x27,\n                num: -1,\n                colors: [\x26quot;#333\x26quot;,\x26quot;#666\x26quot;,\x26quot;#eee\x26quot;,\x26quot;#b9e3ee\x26quot;,\x26quot;#ebe94b\x26quot;,\x26quot;#46cafb\x26quot;,\x26quot;#eca48f\x26quot;,\x26quot;#decb3d\x26quot;,\x26quot;#8d1894\x26quot;],\n                backgroundColors: [\x26quot;#222\x26quot;,\x26quot;#ddd\x26quot;,\x26quot;#999\x26quot;,\x26quot;#379dc3\x26quot;,\x26quot;#36be0d\x26quot;,\x26quot;#001cc6\x26quot;,\x26quot;#da4324\x26quot;,\x26quot;#56125a\x26quot;,\x26quot;#ffffff\x26quot;]\n            }\n        },\n        computed: {\n            color: function () {\n                return this.colors[this.num];\n            },\n            score: function () {\n                this.num\x3c0 \x26amp;\x26amp; (this.num = this.num0 || 1);\n                return this.num\x3c9\x26amp;\x26amp;this.num\x3e0?this.num:0\n            },\n            backgroundColor0: function () {\n                return this.backgroundColors[this.num];\n            }\n        },\n        watch: {\n            p: function (val) {\n                \/\/ 移动数字块\n                var _x = 125*val.charAt(0)\x2b\x26quot;px\x26quot;,\n                    _y = 125*val.charAt(2)\x2b\x26quot;px\x26quot;;\n                \/\/ 使用animation库实现过度动画\n                animation.transition(this.$refs[\x27stone\x27],{\n                    styles: {\n                        transform: \x27translate(\x27\x2b_x \x2b\x27,-\x27\x2b_y\x2b\x27)\x27\n                    },\n                    duration: 200,\n                    timingFunction: \x27ease-in\x27,\n                    delay: 0\n                });\n            }\n        },\n        mounted(){\n            this.initState(this.p0);\n        },\n        methods: {\n            \/**\n             * 移动数字块\n             * *\/\n            move(_x, _y){ \/* ... *\/ },\n            \/**\n             * 更新数字块的分值，即显示数字\n             * *\/\n            scoreChange(_num){ \/* ... *\/ },\n            \/**\n             * 初始化数字块的位置\n             * *\/\n            initState(_p){ \/* ... *\/ }\n        }\n    }\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etext\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stone\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22u-stone\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e:style\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22{color:color,visibility:visibility,backgroundColor:backgroundColor0}\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-if\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22show\x22\x3c\/span\x3e \x26gt;\x3c\/span\x3e\x22{{\x22score\x22}}\x22\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etext\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e animation = weex.requireModule(\x3cspan class=\x22hljs-string\x22\x3e\x27animation\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-attr\x22\x3eprops\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27p0\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27num0\x27\x3c\/span\x3e],\n        data(){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-attr\x22\x3eshow\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3ep\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x270,8\x27\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3evisibility\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3enum\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3ecolors\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22#333\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#666\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#eee\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#b9e3ee\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#ebe94b\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#46cafb\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#eca48f\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#decb3d\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#8d1894\x22\x3c\/span\x3e],\n                \x3cspan class=\x22hljs-attr\x22\x3ebackgroundColors\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22#222\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#ddd\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#999\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#379dc3\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#36be0d\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#001cc6\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#da4324\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#56125a\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22#ffffff\x22\x3c\/span\x3e]\n            }\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3ecomputed\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3ecolor\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.colors[\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.num];\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3escore\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.num\x26lt;\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x26amp;\x26amp; (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.num = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.num0 || \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.num\x26lt;\x3cspan class=\x22hljs-number\x22\x3e9\x3c\/span\x3e\x26amp;\x26amp;\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.num\x26gt;\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e?\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.num:\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3ebackgroundColor0\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.backgroundColors[\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.num];\n            }\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3ewatch\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3ep\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eval\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 移动数字块\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _x = \x3cspan class=\x22hljs-number\x22\x3e125\x3c\/span\x3e*val.charAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22px\x22\x3c\/span\x3e,\n                    _y = \x3cspan class=\x22hljs-number\x22\x3e125\x3c\/span\x3e*val.charAt(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22px\x22\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用animation库实现过度动画\x3c\/span\x3e\n                animation.transition(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs[\x3cspan class=\x22hljs-string\x22\x3e\x27stone\x27\x3c\/span\x3e],{\n                    \x3cspan class=\x22hljs-attr\x22\x3estyles\x3c\/span\x3e: {\n                        \x3cspan class=\x22hljs-attr\x22\x3etransform\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27translate(\x27\x3c\/span\x3e\x2b_x \x2b\x3cspan class=\x22hljs-string\x22\x3e\x27,-\x27\x3c\/span\x3e\x2b_y\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27)\x27\x3c\/span\x3e\n                    },\n                    \x3cspan class=\x22hljs-attr\x22\x3eduration\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-attr\x22\x3etimingFunction\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27ease-in\x27\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-attr\x22\x3edelay\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n                });\n            }\n        },\n        mounted(){\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.initState(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.p0);\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3emethods\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 移动数字块\n             * *\/\x3c\/span\x3e\n            move(_x, _y){ \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 更新数字块的分值，即显示数字\n             * *\/\x3c\/span\x3e\n            scoreChange(_num){ \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n            \x3cspan class=\x22hljs-comment\x22\x3e\/**\n             * 初始化数字块的位置\n             * *\/\x3c\/span\x3e\n            initState(_p){ \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e }\n        }\n    }\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e好了，辣么乐色的代码我都不好意思再唠叨了。换个话题，来讲讲这个小游戏从无到有中间的一些方案的变更吧。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader10\x22\x3e各种尝试\x3c\/h1\x3e\n\x3cp\x3e由于对 Weex 的过高期望，导致很多最初的方案都被「阉割」或者「整容」。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e动画\x3c\/h2\x3e\n\x3cp\x3e想让元素动起来，传统前端一般有两种方式\x3c\/p\x3e\n\x3cp\x3e1、CSS 动画\x3cbr\x3e2、JS 动画\x3cbr\x3e在 Weex 上由多了一个 \x3cbr\x3e3、animation 内建模块，可执行原生动画\x3c\/p\x3e\n\x3cp\x3e由于 css3 的 transition 在 Weex 的 0.16.0\x2b 版本才能使用，官方提供的 demo 框架引用的 SDK 版本低于此版本，方案1，无效！\x3c\/p\x3e\n\x3cp\x3eWeex 上的视觉是通过解析 VDom，在调用原生控件渲染成的，完全没有 DOM ，所以 JS 动画的方案，无效！\x3c\/p\x3e\n\x3cp\x3e看了只剩下 Weex 的 animation 内建动画模块了。\x3c\/p\x3e\n\x3cp\x3e虽然不太喜欢，用起来也很别扭，但是没办法，有总比没有强。知促常乐吧。\x3c\/p\x3e\n\x3cp\x3e来看一下 animation 的使用姿势\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22animation.transition(this.$refs.test, {\n        styles: {\n            color: \x27#000\x27,\n            transform: \x27translate(100px, 100px) sacle(1.3)\x27,\n            backgroundColor: \x27#CCC\x27\n        },\n            duration: 800, \/\/ ms\n            timingFunction: \x27ease\x27,\n            needLayout:false,\n            delay: 0 \/\/ ms\n        }, function () {\n            \/\/ animation finished.\n        })\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eanimation.transition(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.test, {\n        \x3cspan class=\x22hljs-attr\x22\x3estyles\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3ecolor\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27#000\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3etransform\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27translate(100px, 100px) sacle(1.3)\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3ebackgroundColor\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27#CCC\x27\x3c\/span\x3e\n        },\n            \x3cspan class=\x22hljs-attr\x22\x3eduration\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e800\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ms\x3c\/span\x3e\n            timingFunction: \x3cspan class=\x22hljs-string\x22\x3e\x27ease\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3eneedLayout\x3c\/span\x3e:\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3edelay\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ms\x3c\/span\x3e\n        }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ animation finished.\x3c\/span\x3e\n        })\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e想实现一个多态循环的动画，还要写一个方法，想想就难受\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e音乐\x3c\/h2\x3e\n\x3cp\x3e没有声音还能算是游戏吗？！\x3c\/p\x3e\n\x3cp\x3e嗯 ~ ~ ~ 好像可以算 \x3c\/p\x3e\n\x3cp\x3e无所谓啦~ 开心最重要 ︿(￣︶￣)︿\x3c\/p\x3e\n\x3cp\x3e尴尬的是 Weex 官方压根就没给咱们提供这样的 API，好在有三方的插件可用，\x3ca href=\x22http:\/\/natjs.com\/#\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNat\x3c\/a\x3e， 刚好可以用上。\x3c\/p\x3e\n\x3cp\x3eWeex 提倡使用网络资源，所有我把音频文件上传到了 CDN 上，为了能快一点。。\x3c\/p\x3e\n\x3cp\x3e当然不可能一路顺风！\x3c\/p\x3e\n\x3cp\x3e我们来看看 Nat Audio 模块的使用方式\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Nat.audio.play(\x27http:\/\/cdn.instapp.io\/nat\/samples\/audio.mp3\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3eNat.audio.play(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/cdn.instapp.io\/nat\/samples\/audio.mp3\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然而 \x3cstrong\x3eNat.audio\x3c\/strong\x3e 只提供了 play() | pause() | stop() 三个 API。\x3c\/p\x3e\n\x3cp\x3e为什么没有 replay() 重放？我想用的就是重放。这都不是事儿，使用 play() 硬着头皮上吧！\x3c\/p\x3e\n\x3cp\x3e由于 \x3cstrong\x3eNat.audio\x3c\/strong\x3e 不支持 Web 端，每次修改都是真机调试，那个速度，唉~~~我终于理解原生小伙伴们的痛苦了。。 \x3c\/p\x3e\n\x3cp\x3e这也不是事儿，最气愤的就是，Nat.audio.play() 每次播放相同的音频竟然不是走的缓存！难道缓存机制还要自己做？！？！ヽ(｀⌒´)ﾉ 我的天！\x3c\/p\x3e\n\x3cp\x3e最后还是乖乖的用背地文件吧。还要写平台路径适配。。\x3c\/p\x3e\n\x3cp\x3e没想到音频的槽点这么多！还要我没用 Weex 做网易云音乐。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e手势指令\x3c\/h2\x3e\n\x3cp\x3e前文也有讲过，小游戏用到了\x3ccode\x3e@swipe\x3c\/code\x3e、\x3ccode\x3e@click\x3c\/code\x3e、\x3ccode\x3e@panstart\x3c\/code\x3e、\x3ccode\x3e@panend\x3c\/code\x3e和\x3ccode\x3e@horizontalpan\x3c\/code\x3e这么多事件监听。官方也有友情提醒「horizontalpan 手势在 Android 下会与 click 事件冲突」，但实际上 ios 平台上也会有冲突。\x3c\/p\x3e\n\x3cp\x3e具体的我就不再描述了。此处只想说明，Weex 在手势指令上虽然可以满足游戏的基础指令要求，但细节上还是不太理想。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader14\x22\x3e总结\x3c\/h1\x3e\n\x3cp\x3e总的来讲，Weex 算是满足了我做小游戏的要求。如果想做大游戏，就不建议使用 Weex 了，Weex 确实做不了，但者也不是 Weex 诞生的意义。\x3c\/p\x3e\n\x3cp\x3e好了，此次尝试就到这吧。为了不让思路断掉，我又通宵了，罪过，罪过 ~ ~ ~，希望此文对感兴趣的小伙伴有所帮助。\x3c\/p\x3e\n\x3cp\x3emark: 03:05\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Weex 开发小游戏是件很 high 的事儿</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011671135">https://segmentfault.com/a/1190000011671135</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/bsw7ctkpjgj/" target="_blank">https://alili.tech/archive/bsw7ctkpjgj/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>