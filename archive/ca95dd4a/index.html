<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React v16.3.0：新的生命周期和上下文API - React Blog"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React v16.3.0：新的生命周期和上下文API - React Blog | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ca95dd4a/",
				"appid": "1613049289050283", 
				"title": "React v16.3.0：新的生命周期和上下文API - React Blog | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-10-18T00:00:00"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/a6086f2b/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/b8f53d6/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fca95dd4a%2f&text=React%20v16.3.0%ef%bc%9a%e6%96%b0%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e4%b8%8a%e4%b8%8b%e6%96%87API%20-%20React%20Blog"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fca95dd4a%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fca95dd4a%2f&text=React%20v16.3.0%ef%bc%9a%e6%96%b0%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e4%b8%8a%e4%b8%8b%e6%96%87API%20-%20React%20Blog"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fca95dd4a%2f&title=React%20v16.3.0%ef%bc%9a%e6%96%b0%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e4%b8%8a%e4%b8%8b%e6%96%87API%20-%20React%20Blog"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fca95dd4a%2f&is_video=false&description=React%20v16.3.0%ef%bc%9a%e6%96%b0%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e4%b8%8a%e4%b8%8b%e6%96%87API%20-%20React%20Blog"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%20v16.3.0%ef%bc%9a%e6%96%b0%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e4%b8%8a%e4%b8%8b%e6%96%87API%20-%20React%20Blog&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fca95dd4a%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fca95dd4a%2f&title=React%20v16.3.0%ef%bc%9a%e6%96%b0%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e4%b8%8a%e4%b8%8b%e6%96%87API%20-%20React%20Blog"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fca95dd4a%2f&title=React%20v16.3.0%ef%bc%9a%e6%96%b0%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e4%b8%8a%e4%b8%8b%e6%96%87API%20-%20React%20Blog"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fca95dd4a%2f&title=React%20v16.3.0%ef%bc%9a%e6%96%b0%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e4%b8%8a%e4%b8%8b%e6%96%87API%20-%20React%20Blog"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fca95dd4a%2f&title=React%20v16.3.0%ef%bc%9a%e6%96%b0%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e4%b8%8a%e4%b8%8b%e6%96%87API%20-%20React%20Blog"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React v16.3.0：新的生命周期和上下文API - React Blog</h1><div class="meta"><div class="postdate"><time datetime="2018-10-18" itemprop="datePublished">2018-10-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3cp\x3e作者 \x3ca href=\x22https:\/\/github.com\/bvaughn\x22\x3eBrian Vaughn\x3c\/a\x3e     2018年3月29日 \x3c\/p\x3e\n\x3cp\x3e几天前， 我们 \x3ca href=\x22https:\/\/reactjs.org\/blog\/2018\/03\/27\/update-on-async-rendering.html\x22\x3e写了一篇关于对以前的生命周期方法进行更改的文章\x3c\/a\x3e, 包括逐步迁移策略。 在React 16.3.0中， 我们正在添加一些新的生命周期方法来辅助迁移。我们还为长期被要求的功能引入了新的API： 一个官方的context API，一个转发的ref API和一个更符合人类使用的ref API.\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/reactjs.org\/#official-context-api\x22\x3e继续阅读以了解更多关于该版本的信息。\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2\x3e官方 Context API\x3c\/h2\x3e\n\x3cp\x3e多年来，React仅提供了一个实验性的context API。尽管它是一个非常强大的API，但是，因为它固有问题以及我们打算用一个更好的API来替换这个实验的API，所以这个API一般不被推荐使用。\x3c\/p\x3e\n\x3cp\x3e版本16.3引入了一个新的context API，它非常高效并且支持静态类型检查和深度更新。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e旧的context API将继续适用于所有React 1.6x版本，所以你将有足够的时间进行迁移。 \x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e下面是一个例子，说明如何使用新的context API注入一个『theme』：  \x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs scala\x22\x3econst \x3cspan class=\x22hljs-type\x22\x3eThemeContext\x3c\/span\x3e = \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.createContext(\x3cspan class=\x22hljs-symbol\x22\x3e\x27ligh\x3c\/span\x3et\x27);\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eThemeProvider\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  state = {theme: \x3cspan class=\x22hljs-symbol\x22\x3e\x27ligh\x3c\/span\x3et\x27};\n\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      `\x26lt;\x3cspan class=\x22hljs-type\x22\x3eThemeContext\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3eProvider\x3c\/span\x3e value={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.theme}\x26gt;`\n        {\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.children}\n      `\x26lt;\/\x3cspan class=\x22hljs-type\x22\x3eThemeContext\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3eProvider\x3c\/span\x3e\x26gt;`\n    );\n  }\n}\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eThemedButton\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      `\x26lt;\x3cspan class=\x22hljs-type\x22\x3eThemeContext\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3eConsumer\x3c\/span\x3e\x26gt;`\n        {theme =\x26gt; `\x26lt;\x3cspan class=\x22hljs-type\x22\x3eButton\x3c\/span\x3e theme={theme} \/\x26gt;`}\n      `\x26lt;\/\x3cspan class=\x22hljs-type\x22\x3eThemeContext\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3eConsumer\x3c\/span\x3e\x26gt;`\n    );\n  }\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e\x3ca href=\x22https:\/\/reactjs.org\/docs\/context.html\x22\x3e了解更多关于新的context API的信息。\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2\x3e\x3ca href=\x22https:\/\/reactjs.org\/#createref-api\x22\x3e\x3ccode\x3ecreateRef\x3c\/code\x3e API\x3c\/a\x3e\x3c\/h2\x3e\n\x3cp\x3e先前, React 提交供了两种管理refs的方法：传统的字符串形式API和回调函数API。尽管字符串引用API是两者中使用最方便的，但它也有\x3ca href=\x22https:\/\/github.com\/facebook\/react\/issues\/1373\x22\x3e几个缺点\x3c\/a\x3e ，所有我们官方的建议是使用回调函数形式代替它。\x3c\/p\x3e\n\x3cp\x3e版本16.3增加了一个管理refs的新的选项，它提供了使用字符串形式ref的便利性而且没有任务缺点：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs scala\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMyComponent\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  constructor(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.inputRef = \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.createRef();\n  }\n\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e `\x26lt;input \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e ref={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.inputRef} \/\x26gt;`;\n  }\n\n  componentDidMount() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.inputRef.current.focus();\n  }\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e除了新的\x3ccode\x3ecreateRef\x3c\/code\x3e API，Callback refs 将会继续得到支持。\x3c\/p\x3e\n\x3cp\x3e你没有必要替换掉你组件中的callback refs。它们稍微的更灵活一点，所以它们仍然是一个比较先进的功能。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/reactjs.org\/docs\/refs-and-the-dom.html\x22\x3e了解更多关于新的 \x3ccode\x3ecreateRef\x3c\/code\x3e API 的信息.\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2\x3e\x3ca href=\x22https:\/\/reactjs.org\/#forwardref-api\x22\x3e\x3ccode\x3eforwardRef\x3c\/code\x3e API\x3c\/a\x3e\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/reactjs.org\/docs\/higher-order-components.html\x22\x3e高阶组件\x3c\/a\x3e (or HOCs) 是在组件间复用的代码的常用方法。基于上面的主题背景示例，我们中以创建一个HOC，它以属性的方式将当前『theme』进行注入：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewithTheme\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eComponent\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eThemedComponent\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eprops\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22hljs-string\x22\x3e`\x26lt;ThemeContext.Consumer\x26gt;`\x3c\/span\x3e\n        {theme =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e`\x26lt;Component {...props} theme={theme} \/\x26gt;`\x3c\/span\x3e}\n      \x3cspan class=\x22hljs-string\x22\x3e`\x26lt;\/ThemeContext.Consumer\x26gt;`\x3c\/span\x3e\n    );\n  };\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e我们可以使用上面的HOC将组件直接连接到主体上下文，而无需直接使用 \x3ccode\x3eThemeContext\x3c\/code\x3e。例如：  \x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs scala\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eFancyButton\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  buttonRef = \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.createRef();\n\n  focus() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.buttonRef.current.focus();\n  }\n\n  render() {\n    const {label, theme, ...rest} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      `\x26lt;button\n        {...rest}\n        className={`${theme}-button`}\n        ref={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.buttonRef}\x26gt;`\n        {label}\n      `\x26lt;\/button\x26gt;`\n    );\n  }\n}\n\nconst \x3cspan class=\x22hljs-type\x22\x3eFancyThemedButton\x3c\/span\x3e = withTheme(\x3cspan class=\x22hljs-type\x22\x3eFancyButton\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 我们可以渲染FancyThemedButton，就好像它是一个FancyButton\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 它将会自动接收当前『theme』,\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 同时HOC也会传递我们其它的props。\x3c\/span\x3e\n`\x26lt;\x3cspan class=\x22hljs-type\x22\x3eFancyThemedButton\x3c\/span\x3e\n  label=\x3cspan class=\x22hljs-string\x22\x3e\x22Click me!\x22\x3c\/span\x3e\n  onClick={handleClick}\n\/\x26gt;`;\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3eHOCs通常将会把\x3ca href=\x22https:\/\/reactjs.org\/docs\/higher-order-components.html#convention-pass-unrelated-props-through-to-the-wrapped-component\x22\x3eprops传递\x3c\/a\x3e给它们包裹着的组件。不幸的是, \x3ca href=\x22https:\/\/reactjs.org\/docs\/higher-order-components.html#refs-arent-passed-through\x22\x3erefs不会被传递\x3c\/a\x3e。这意味着，如果我们使用\x3ccode\x3eFancyThemedButton\x3c\/code\x3e，我们将无法通过ref和\x3ccode\x3eFancyButton\x3c\/code\x3e进行连接，所以我们无法调用\x3ccode\x3efocus()\x3c\/code\x3e。 \x3c\/p\x3e\n\x3cp\x3e新的\x3ccode\x3eforwardRef\x3c\/code\x3e API解决了这个问题，它提供了一个方法来拦截\x3ccode\x3eref\x3c\/code\x3e，并将它作为了普通的prop进行传递：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs actionscript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewithTheme\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(Component)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eThemedComponent\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e({forwardedRef, \x3cspan class=\x22hljs-rest_arg\x22\x3e...rest\x3c\/span\x3e})\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      `\x26lt;ThemeContext.Consumer\x26gt;`\n        {theme =\x26gt; (\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Assign the custom prop \x22forwardedRef\x22 as a ref\x3c\/span\x3e\n          `\x26lt;Component\n            {...rest}\n            ref={forwardedRef}\n            theme={theme}\n          \/\x26gt;`\n        )}\n      `\x26lt;\/ThemeContext.Consumer\x26gt;`\n    );\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注意第二个参数\x22ref\x22是由React.forwardRef提供的。\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 我们可以将它作为变通的props传递给ThemedComponent，例如 \x22forwardedRef\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 然后它可以被连接到这个组件。\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e React.forwardRef((props, ref) =\x26gt; (\n    `\x26lt;ThemedComponent {...props} forwardedRef={ref} \/\x26gt;`\n  ));\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在这里，我们假设FancyButton已经被导入到当前上下文\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e FancyThemedButton = withTheme(FancyButton);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过Referenace API创建一个ref，\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fancyButtonRef = React.createRef();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ fancyButtonRef 现在指向 FancyButton\x3c\/span\x3e\n`\x26lt;FancyThemedButton\n  label=\x3cspan class=\x22hljs-string\x22\x3e\x22Click me!\x22\x3c\/span\x3e\n  onClick={handleClick}\n  ref={fancyButtonRef}\n\/\x26gt;`;\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch2\x3e\x3ca href=\x22https:\/\/reactjs.org\/#component-lifecycle-changes\x22\x3e组件生命周期变更\x3c\/a\x3e\x3c\/h2\x3e\n\x3cp\x3eReact类组件的API已经有好多年了，而且几乎没有变化。但是，当我们添加对更高级功能的支持时（比如\x3ca href=\x22https:\/\/reactjs.org\/docs\/react-component.html#componentdidcatch\x22\x3e错误边界\x3c\/a\x3e和\x3ca href=\x22https:\/\/reactjs.org\/blog\/2018\/03\/01\/sneak-peek-beyond-react-16.html\x22\x3e即将到来的异步渲染模式\x3c\/a\x3e），我们会以不是我们想要的方式来扩展此模型。\x3c\/p\x3e\n\x3cp\x3e例如，使用当前的API，可以很容易的阻止非必要的逻辑进行初始渲染。部分原因是因为完成某项任务的方式太多，而且哪一个最好也不清楚。我们已经观察到错误中断的处理行通常不被考虑在内，并且可能导致内存泄漏（它会影响到即将到来的异步渲染模式）。目前的类组件API也使其他工作复杂化，就像我们在\x3ca href=\x22https:\/\/twitter.com\/trueadm\/status\/944908776896978946\x22\x3e原型化React编译器\x3c\/a\x3e方面的工作一样。\x3c\/p\x3e\n\x3cp\x3e这些问题在组件生命周期（\x3ccode\x3ecomponentWillMount\x3c\/code\x3e, \x3ccode\x3ecomponentWillReceiveProps\x3c\/code\x3e, and \x3ccode\x3ecomponentWillUpdate\x3c\/code\x3e）的一个子集中更加的恶化。这些也恰好是造成React社区最混乱的生命周期问题。出于这些原因的考虑，我们将会降低这些方法的使用，转而使用更好的方法代替。\x3c\/p\x3e\n\x3cp\x3e我们意识到这些变更将会影响到现有的组件。因此，迁移路径将会是渐进式的，并且会提供补救措施。（在Facebook上，我们维护了超过50,000个React组件。 我们也依赖于一个渐进的发布周期！\n） \x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e弃用警告将在未来的16.x版本中启用，但旧版生命周期将继续运行至17.x版。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cblockquote\x3e\n\x3cp\x3e即使在17.x版中，仍然可以使用它们，但它们会以『UNSAFE_』为前缀被重命名，以表明它们可能会引起问题。我们还准备了一个\x3ca href=\x22https:\/\/github.com\/reactjs\/react-codemod#rename-unsafe-lifecycles\x22\x3e自动化的脚本\x3c\/a\x3e来在现有代码中对它们重新命名。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e除了摒弃不安全的生命周期外，我们还增加了一些新的生命周期：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/reactjs.org\/docs\/react-component.html#static-getderivedstatefromprops\x22\x3e\x3ccode\x3egetDerivedStateFromProps\x3c\/code\x3e\x3c\/a\x3e 是一个比较安全的方法来替代以前 \x3ccode\x3ecomponentWillReceiveProps\x3c\/code\x3e.\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/reactjs.org\/docs\/react-component.html#getsnapshotbeforeupdate\x22\x3e\x3ccode\x3egetSnapshotBeforeUpdate\x3c\/code\x3e\x3c\/a\x3e 用于更安全的读取属性，比如在更新之前获取DOM。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/reactjs.org\/blog\/2018\/03\/27\/update-on-async-rendering.html\x22\x3e了解更多关于生命周期的变更。\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2\x3e\x3ca href=\x22https:\/\/reactjs.org\/#strictmode-component\x22\x3e\x3ccode\x3eStrictMode\x3c\/code\x3e Component\x3c\/a\x3e\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3eStrictMode\x3c\/code\x3e是一个突出显示应用潜在问题的工具。像Fragment一样，StrictMode不会呈现任何可见的UI。它会为子组件作额外的检查并发出警告。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eStrictMode\x3c\/code\x3e 检查仅仅运行在开发模式下； \x3cem\x3e它们不影响生产构建\x3c\/em\x3e。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e尽管在严格模式下不可能捕获所有的问题（例如：某些类型的突变），但在它在大多数情况下还是很有用的。如果你在严格模式下看到警告，这些东西可能会引起异步渲染的错误。\x3c\/p\x3e\n\x3cp\x3e在16.3版中，\x3ccode\x3eStrictMode\x3c\/code\x3e提供以下帮助：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e识别不安全的生命周期组件\x3c\/li\x3e\n\x3cli\x3e对使用字符串ref API进行警告\x3c\/li\x3e\n\x3cli\x3e检测潜在副作用\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e随着未来React的发版，将会添加更多的功能。  \x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/reactjs.org\/docs\/strict-mode.html\x22\x3e了解更多关于\x3ccode\x3eStrictMode\x3c\/code\x3e 组件的信息.\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/reactjs\/reactjs.org\/tree\/master\/content\/blog\/2018-03-29-react-v-16-3.md\x22\x3e编辑此页面\x3c\/a\x3e\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>原文链接: <a href="https://www.zcfy.cc/article/react-v16-3-0-new-lifecycles-and-context-api-react-blog">https://www.zcfy.cc/article/react-v16-3-0-new-lifecycles-and-context-api-react-blog</a> 原文标题: React v16.3.0：新的生命周期和上下文API - React Blog 本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2>本文链接：</h2><a href="https://alili.tech/archive/ca95dd4a/" target="_blank">https://alili.tech/archive/ca95dd4a/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>