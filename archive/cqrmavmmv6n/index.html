<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React-联合组件"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React-联合组件 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/cqrmavmmv6n/",
				"appid": "1613049289050283", 
				"title": "React-联合组件 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-11-30T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/3ijbeiu2oqh/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/5jc0sx1w2vs/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fcqrmavmmv6n%2f&text=React-%e8%81%94%e5%90%88%e7%bb%84%e4%bb%b6"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fcqrmavmmv6n%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fcqrmavmmv6n%2f&text=React-%e8%81%94%e5%90%88%e7%bb%84%e4%bb%b6"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fcqrmavmmv6n%2f&title=React-%e8%81%94%e5%90%88%e7%bb%84%e4%bb%b6"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fcqrmavmmv6n%2f&is_video=false&description=React-%e8%81%94%e5%90%88%e7%bb%84%e4%bb%b6"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React-%e8%81%94%e5%90%88%e7%bb%84%e4%bb%b6&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fcqrmavmmv6n%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fcqrmavmmv6n%2f&title=React-%e8%81%94%e5%90%88%e7%bb%84%e4%bb%b6"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fcqrmavmmv6n%2f&title=React-%e8%81%94%e5%90%88%e7%bb%84%e4%bb%b6"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fcqrmavmmv6n%2f&title=React-%e8%81%94%e5%90%88%e7%bb%84%e4%bb%b6"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fcqrmavmmv6n%2f&title=React-%e8%81%94%e5%90%88%e7%bb%84%e4%bb%b6"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React-联合组件</h1><div class="meta"><div class="postdate"><time datetime="2018-11-30" itemprop="datePublished">2018-11-30</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e本文讲的如何利用context，将多个组件串联起来，实现一个更大的联合组件。最具有这个特性的就是表单组件，所以本文例子就是一个表单组件。本文例子参考 \x3ca href=\x22http:\/\/ant.design\/components\/form-cn\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAnt Design\x3c\/a\x3e 。本次不讲 context 知识，需要的话等到下一次分享。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e准备\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3ees6 基本知识。\x3ca href=\x22http:\/\/es6.ruanyifeng.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e参考地址\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3ereact 基本知识。\x3ca href=\x22https:\/\/doc.react-china.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e参考地址\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3ecreate-react-app 脚手架。 \x3ca href=\x22https:\/\/www.npmjs.com\/package\/create-react-app\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e参考地址\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3ereact context 知识。 \x3ca href=\x22https:\/\/doc.react-china.org\/docs\/legacy-context.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e参考地址\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3ereact prop-types 相关知识。 \x3ca href=\x22https:\/\/doc.react-china.org\/docs\/typechecking-with-proptypes.html#proptypes\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e参考地址\x3c\/a\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e或者直接使用本文 demo  \x3ca href=\x22https:\/\/gitee.com\/qunyou\/react-advance-components\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGitee地址\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e基本代码\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cForm onSubmit={(e, v) =\x3e {\n  console.log(e, \x27error\x27);\n  console.log(v, \x27value\x27);\n\x22}}\x22\x3e\n  \x3cForm.Item label={\x27手机号\x27}\x3e\n    \x3cForm.Input name={\x27phone\x27} rules={[{validator: (e) =\x3e \/^1[3-9]\\d\x2b$\/.test(e), message: \x27手机号格式错误\x27}]}\/\x3e\n  \x3c\/Form.Item\x3e\n  \x3cForm.Item label={\x27年龄\x27}\x3e\n    \x3cForm.Input name={\x27age\x27} rules={[{validator: (e) =\x3e \/^\\d\x2b$\/.test(e), message: \x27只允许输入数字\x27}]}\/\x3e\n  \x3c\/Form.Item\x3e\n    \x3cForm.Button\x3e提交\x3c\/Form.Button\x3e\n  \x3cForm.Button type={\x27reset\x27}\x3e重置\x3c\/Form.Button\x3e\n\x3c\/Form\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode\x3e\x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e onSubmit={(\x3cspan class=\x22hljs-keyword\x22\x3ee\x3c\/span\x3e, v) =\x26gt; {\n  console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ee\x3c\/span\x3e, \x27\x3cspan class=\x22hljs-keyword\x22\x3eerror\x3c\/span\x3e\x27);\n  console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(v, \x27value\x27);\n\x22}}\x22\x26gt;\n  \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e.Item \x3cspan class=\x22hljs-keyword\x22\x3elabel\x3c\/span\x3e={\x27手机号\x27}\x26gt;\n    \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eInput\x3c\/span\x3e name={\x27phone\x27} rules={[{validator: (\x3cspan class=\x22hljs-keyword\x22\x3ee\x3c\/span\x3e) =\x26gt; \/^1[3-9]\\\x3cspan class=\x22hljs-keyword\x22\x3ed\x3c\/span\x3e\x2b$\/.\x3cspan class=\x22hljs-keyword\x22\x3etest\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ee\x3c\/span\x3e), message: \x27手机号格式错误\x27}]}\/\x26gt;\n  \x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e.Item\x26gt;\n  \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e.Item \x3cspan class=\x22hljs-keyword\x22\x3elabel\x3c\/span\x3e={\x27年龄\x27}\x26gt;\n    \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eInput\x3c\/span\x3e name={\x27age\x27} rules={[{validator: (\x3cspan class=\x22hljs-keyword\x22\x3ee\x3c\/span\x3e) =\x26gt; \/^\\\x3cspan class=\x22hljs-keyword\x22\x3ed\x3c\/span\x3e\x2b$\/.\x3cspan class=\x22hljs-keyword\x22\x3etest\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ee\x3c\/span\x3e), message: \x27只允许输入数字\x27}]}\/\x26gt;\n  \x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e.Item\x26gt;\n    \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e.Button\x26gt;提交\x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e.Button\x26gt;\n  \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e.Button \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e={\x27reset\x27}\x26gt;重置\x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e.Button\x26gt;\n\x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3eForm\x3c\/span\x3e\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e需求\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e自定义校验规则\x3c\/li\x3e\n\x3cli\x3e表单内容组件不限组合方式\x3c\/li\x3e\n\x3cli\x3e点击提交按钮就可以提交\x3c\/li\x3e\n\x3cli\x3e提交时候可以校验值并且可以自动拦截，然后将错误信息下发给 FormItem 组件并且显示出来\x3c\/li\x3e\n\x3cli\x3e通过传入 Form 组件的 onSubmit 参数就可以获取到内容\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e实现\x3c\/h2\x3e\n\x3cp\x3e明白自己所需要的内容后，我们创建基本代码中的几个组件，Form ， FormItem ，Input , 以及 Button。\x3cbr\x3e具体内容看代码中的注释\x3c\/p\x3e\n\x3ch4\x3eForm\x3c\/h4\x3e\n\x3cp\x3e首先我们要知道 Form 组件在联合组件中的负责的内容\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e数据收集\x3c\/li\x3e\n\x3cli\x3e数据校验\x3c\/li\x3e\n\x3cli\x3e提交、重置动作处理\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e代码如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React, {Component} from \x27React\x27;\nimport PropTypes from \x27prop-types\x27;\nimport {Item} from \x27.\/Item\x27;\nimport {Button} from \x27.\/Button\x27;\nimport {Input} from \x27.\/Input\x27;\n\nexport class Form extends Component{\n  static propTypes = {\n    onSubmit: PropTypes.func.isRequired, \/\/ 需要该参数因为，如果没有该参数，整个组件就没有意义\n    defaultValues: PropTypes.object, \/\/ 如果有些需要默认参数的，就需要该参数\n    children: PropTypes.any,\n  };\n  \n  static defaultProps = {\n    defaultValues: {},\n  };\n\n  static childContextTypes = {\n    form: PropTypes.any, \/\/ 定义上下文参数名称和格式，格式太麻烦，直接any了或者 object也可以。\n  };\n\n  state = {\n    validates: {},\n    change: 0,\n  };\n  \n  \/\/ 为什么不将数据全部放在 state 里面，在本文最后会讲到\n  registerState = {\n    form: {},\n    rules: {},\n    label: {},\n  };\n\n  getChildContext() {\n    \/\/ 定义上下文返回内容\n    const {validates} = this.state;\n    const {form} = this.registerState;\n    return {\n      form: {\n        submit: this.submit.bind(this),\n        reset: this.reset.bind(this),\n        register: this.register.bind(this),\n        registerLabel: this.registerLabel.bind(this),\n        setFieldValue: this.setFieldValue.bind(this),\n        data: form,\n        validates,\n      },\n    };\n  }\n\n  submit() {\n    \/\/ 提交动作\n    const {onSubmit} = this.props;\n    if (onSubmit) {\n      const validates = [];\n      const {form, rules, label} = this.registerState;\n      Object.keys(form).forEach(key =\x3e {\n        const item = form[key];\n        const itemRules = rules[key];\n\n        itemRules.forEach(rule =\x3e {\n          \/\/To do something validator 简单列出几种基本校验方法，可自行添加\n          let res = true;\n          \/\/ 如果校验规则里面有基本规则时候，使用基本规则\n          if (rule.hasOwnProperty(\x27type\x27)) {\n            switch (rule) {\n              case \x27phone\x27:\n                \/^1[3-9]\\d\x2b$\/.test(item);\n                res = false;\n                break;\n              default:\n                break;\n            }\n          }\n          \/\/ 如果校验规则里面有 校验函数时候，使用它\n          if (rule.hasOwnProperty(\x27validator\x27)) {\n            res = rule.validator(item);\n          }\n          \/\/ 校验不通过，向校验结果数组里面增加，并且结束本次校验\n          if (!res) {\n            validates.push({key, message: rule.message, label: label.hasOwnProperty(key) ? label[key] : \x27\x27});\n            return false;\n          }\n        });\n      });\n        \n      if (validates.length \x3e 0) {\n        \/\/ 在控制台打印出来\n        validates.forEach(item =\x3e {\n          console.warn(`item: ${item.label ? item.label : item.key}; message: ${item.message}`);\n        });\n        \/\/ 将错误信息返回到 state 并且由 context 向下文传递内容，例如 FormItem 收集到该信息，就可以显示出错误内容和样式\n        this.setState({\n          validates,\n        });\n      }\n      \/\/ 最后触发 onSubmit 参数，将错误信息和数据返回\n      onSubmit(validates, this.registerState.form);\n    }\n  }\n\n  reset() {\n    \/\/ 重置表单内容\n    const {form} = this.registerState;\n    const {defaultValues} = this.props;\n    this.registerState.form = Object.keys(form).reduce((t, c) =\x3e {\n      t[c] = defaultValues.hasOwnProperty(c) ? defaultValues[c] : \x27\x27;\n      return t;\n    }, {});\n    \/\/ 因为值不在 state 中，需要刷新一下state，完成值在 context 中的更新\n    this.change();\n  }\n  \n  \/\/更新某一个值\n  setFieldValue(name, value) {\n    this.registerState.form[name] = value;\n    this.change();\n  }\n\n  \/\/ 值和规则都不在state中，需要借助次方法更新内容\n  change() {\n    this.setState({\n      change: this.state.change \x2b 1,\n    });\n  }\n  \n  \/\/ 注册参数，最后数据收集和规则校验都是通过该方法向里面添加的内容完成\n  register(name, itemRules) {\n    if (this.registerFields.indexOf(name) === -1) {\n      this.registerFields.push(name);\n      const {defaultValues} = this.props;\n      this.registerState.form[name] = defaultValues.hasOwnProperty(name) ? defaultValues[name] : \x27\x27;\n      this.registerState.rules[name] = itemRules;\n    } else {\n      \/\/ 重复的话提示错误\n      console.warn(`\\`${name}\\` has repeat`);\n    }\n  }\n  \n  \/\/ 添加 字段名称，优化体验\n  registerLabel(name, label) {\n    this.registerState.label[name] = label;\n  }\n\n  render() {\n    return (\n      \x3cdiv className=\x26quot;form\x26quot;\x3e\n        {this.props.children}\n      \x3c\/div\x3e\n    ); \/\/ 这里使用括号因为在 webStrom 下格式化代码后的格式看起来更舒服。\n  }\n}\n\n\/\/ 将子组件加入到 Form 中 表示关联关系\nForm.Item = Item;\nForm.Button = Button;\nForm.Input = Input;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React, {Component} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27React\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e PropTypes \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27prop-types\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {Item} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/Item\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {Button} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/Button\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {Input} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/Input\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eForm\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e propTypes = {\n    \x3cspan class=\x22hljs-attr\x22\x3eonSubmit\x3c\/span\x3e: PropTypes.func.isRequired, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 需要该参数因为，如果没有该参数，整个组件就没有意义\x3c\/span\x3e\n    defaultValues: PropTypes.object, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果有些需要默认参数的，就需要该参数\x3c\/span\x3e\n    children: PropTypes.any,\n  };\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e defaultProps = {\n    \x3cspan class=\x22hljs-attr\x22\x3edefaultValues\x3c\/span\x3e: {},\n  };\n\n  \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e childContextTypes = {\n    \x3cspan class=\x22hljs-attr\x22\x3eform\x3c\/span\x3e: PropTypes.any, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 定义上下文参数名称和格式，格式太麻烦，直接any了或者 object也可以。\x3c\/span\x3e\n  };\n\n  state = {\n    \x3cspan class=\x22hljs-attr\x22\x3evalidates\x3c\/span\x3e: {},\n    \x3cspan class=\x22hljs-attr\x22\x3echange\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  };\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 为什么不将数据全部放在 state 里面，在本文最后会讲到\x3c\/span\x3e\n  registerState = {\n    \x3cspan class=\x22hljs-attr\x22\x3eform\x3c\/span\x3e: {},\n    \x3cspan class=\x22hljs-attr\x22\x3erules\x3c\/span\x3e: {},\n    \x3cspan class=\x22hljs-attr\x22\x3elabel\x3c\/span\x3e: {},\n  };\n\n  getChildContext() {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 定义上下文返回内容\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {validates} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state;\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {form} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerState;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attr\x22\x3eform\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3esubmit\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.submit.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e),\n        \x3cspan class=\x22hljs-attr\x22\x3ereset\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.reset.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e),\n        \x3cspan class=\x22hljs-attr\x22\x3eregister\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.register.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e),\n        \x3cspan class=\x22hljs-attr\x22\x3eregisterLabel\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerLabel.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e),\n        \x3cspan class=\x22hljs-attr\x22\x3esetFieldValue\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setFieldValue.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e),\n        \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: form,\n        validates,\n      },\n    };\n  }\n\n  submit() {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 提交动作\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {onSubmit} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (onSubmit) {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e validates = [];\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {form, rules, label} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerState;\n      \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(form).forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ekey\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e item = form[key];\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e itemRules = rules[key];\n\n        itemRules.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3erule\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/To do something validator 简单列出几种基本校验方法，可自行添加\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e res = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果校验规则里面有基本规则时候，使用基本规则\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (rule.hasOwnProperty(\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e)) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (rule) {\n              \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27phone\x27\x3c\/span\x3e:\n                \x3cspan class=\x22hljs-regexp\x22\x3e\/^1[3-9]\\d\x2b$\/\x3c\/span\x3e.test(item);\n                res = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n              \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            }\n          }\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果校验规则里面有 校验函数时候，使用它\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (rule.hasOwnProperty(\x3cspan class=\x22hljs-string\x22\x3e\x27validator\x27\x3c\/span\x3e)) {\n            res = rule.validator(item);\n          }\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 校验不通过，向校验结果数组里面增加，并且结束本次校验\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!res) {\n            validates.push({key, \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: rule.message, \x3cspan class=\x22hljs-attr\x22\x3elabel\x3c\/span\x3e: label.hasOwnProperty(key) ? label[key] : \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e});\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n          }\n        });\n      });\n        \n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (validates.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在控制台打印出来\x3c\/span\x3e\n        validates.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.warn(\x3cspan class=\x22hljs-string\x22\x3e`item: \x3cspan class=\x22hljs-subst\x22\x3e${item.label ? item.label : item.key}\x3c\/span\x3e; message: \x3cspan class=\x22hljs-subst\x22\x3e${item.message}\x3c\/span\x3e`\x3c\/span\x3e);\n        });\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将错误信息返回到 state 并且由 context 向下文传递内容，例如 FormItem 收集到该信息，就可以显示出错误内容和样式\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n          validates,\n        });\n      }\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 最后触发 onSubmit 参数，将错误信息和数据返回\x3c\/span\x3e\n      onSubmit(validates, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerState.form);\n    }\n  }\n\n  reset() {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重置表单内容\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {form} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerState;\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {defaultValues} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerState.form = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(form).reduce(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3et, c\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      t[c] = defaultValues.hasOwnProperty(c) ? defaultValues[c] : \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e t;\n    }, {});\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 因为值不在 state 中，需要刷新一下state，完成值在 context 中的更新\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.change();\n  }\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/更新某一个值\x3c\/span\x3e\n  setFieldValue(name, value) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerState.form[name] = value;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.change();\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 值和规则都不在state中，需要借助次方法更新内容\x3c\/span\x3e\n  change() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n      \x3cspan class=\x22hljs-attr\x22\x3echange\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.change \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    });\n  }\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注册参数，最后数据收集和规则校验都是通过该方法向里面添加的内容完成\x3c\/span\x3e\n  register(name, itemRules) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerFields.indexOf(name) === \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerFields.push(name);\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {defaultValues} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerState.form[name] = defaultValues.hasOwnProperty(name) ? defaultValues[name] : \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerState.rules[name] = itemRules;\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重复的话提示错误\x3c\/span\x3e\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.warn(\x3cspan class=\x22hljs-string\x22\x3e`\\`\x3cspan class=\x22hljs-subst\x22\x3e${name}\x3c\/span\x3e\\` has repeat`\x3c\/span\x3e);\n    }\n  }\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加 字段名称，优化体验\x3c\/span\x3e\n  registerLabel(name, label) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.registerState.label[name] = label;\n  }\n\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22form\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        {this.props.children}\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    ); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里使用括号因为在 webStrom 下格式化代码后的格式看起来更舒服。\x3c\/span\x3e\n  }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将子组件加入到 Form 中 表示关联关系\x3c\/span\x3e\nForm.Item = Item;\nForm.Button = Button;\nForm.Input = Input;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3eFormItem\x3c\/h4\x3e\n\x3cp\x3e它的功能不多\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e向 Form 中注册 输入框的关联名称\x3c\/li\x3e\n\x3cli\x3e从 Form 中获取 校验结果并且展示出来\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e代码如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React, {Component} from \x27react\x27;\nimport PropTypes from \x27prop-types\x27;\n\nexport class Item extends Component {\n  \/\/ 这个值在 FormItem 组件 被包裹在 Form 组件中时，必须有\n  name;\n\n  static propTypes = {\n    label: PropTypes.string,\n  };\n\n  static childContextTypes = {\n    formItem: PropTypes.any,\n    children: PropTypes.any,\n  };\n\n  static contextTypes = {\n    form: PropTypes.object,\n  };\n\n  \/\/ 防止重复覆盖 name 的值\n  lock = false;\n\n  \/\/ 获取到 包裹的输入组件的 name值，如果在存在 Form 中，则向 Form 注册name值相对的label值\n  setName(name) {\n    if (!this.lock) {\n      this.lock = true;\n      this.name = name;\n\n      const {form} = this.context;\n      if (form) {\n        form.registerLabel(name, this.props.label);\n      }\n    } else {\n      \/\/ 同样，一个 FormItem 只允许操作一个值\n      console.warn(\x27Allows only once `setName`\x27);\n    }\n\n  }\n\n  getChildContext() {\n    return {\n      formItem: {\n        setName: this.setName.bind(this),\n      },\n    };\n  }\n\n  render() {\n    const {label} = this.props;\n    const {form} = this.context;\n\n    let className = \x27form-item\x27;\n    let help = false;\n    if (form) {\n      const error = form.validates.find(err =\x3e err.key === this.name);\n      \/\/ 如果有找到属于自己错误，就修改状态\n      if (error) {\n        className \x2b= \x27 form-item-warning\x27;\n        help = error.message;\n        return false;\n      }\n    }\n\n    return (\n        \x3cdiv className={className}\x3e\n          \x3cdiv className=\x26quot;label\x26quot;\x3e\n            {label}\n          \x3c\/div\x3e\n          \x3cdiv className=\x26quot;input\x26quot;\x3e\n            {this.props.children}\n          \x3c\/div\x3e\n          {help ? (\n              \x3cdiv className=\x26quot;help\x26quot;\x3e\n                {help}\n              \x3c\/div\x3e\n          ) : \x27\x27}\n        \x3c\/div\x3e\n    );\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React, {Component} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e PropTypes \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27prop-types\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eItem\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这个值在 FormItem 组件 被包裹在 Form 组件中时，必须有\x3c\/span\x3e\n  name;\n\n  \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e propTypes = {\n    \x3cspan class=\x22hljs-attr\x22\x3elabel\x3c\/span\x3e: PropTypes.string,\n  };\n\n  \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e childContextTypes = {\n    \x3cspan class=\x22hljs-attr\x22\x3eformItem\x3c\/span\x3e: PropTypes.any,\n    \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: PropTypes.any,\n  };\n\n  \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e contextTypes = {\n    \x3cspan class=\x22hljs-attr\x22\x3eform\x3c\/span\x3e: PropTypes.object,\n  };\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 防止重复覆盖 name 的值\x3c\/span\x3e\n  lock = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取到 包裹的输入组件的 name值，如果在存在 Form 中，则向 Form 注册name值相对的label值\x3c\/span\x3e\n  setName(name) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lock) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.lock = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name = name;\n\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {form} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context;\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (form) {\n        form.registerLabel(name, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.label);\n      }\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 同样，一个 FormItem 只允许操作一个值\x3c\/span\x3e\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.warn(\x3cspan class=\x22hljs-string\x22\x3e\x27Allows only once `setName`\x27\x3c\/span\x3e);\n    }\n\n  }\n\n  getChildContext() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attr\x22\x3eformItem\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3esetName\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setName.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e),\n      },\n    };\n  }\n\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {label} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {form} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e className = \x3cspan class=\x22hljs-string\x22\x3e\x27form-item\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e help = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (form) {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e error = form.validates.find(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e err.key === \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name);\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果有找到属于自己错误，就修改状态\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (error) {\n        className \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x27 form-item-warning\x27\x3c\/span\x3e;\n        help = error.message;\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n      }\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n        \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{className}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22label\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            {label}\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22input\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            {this.props.children}\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          {help ? (\n              \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22help\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n                {help}\n              \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          ) : \x27\x27}\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    );\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3eInput\x3c\/h4\x3e\n\x3cp\x3e暂时演示输入组件为 Input ，后面可以按照该组件内容，继续增加其他操作组件\x3cbr\x3e该类型组件负责的东西很多\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e唯一name，通知 FormItem 它所包裹的是谁\x3c\/li\x3e\n\x3cli\x3eForm 组件里面，收集的数据\x3c\/li\x3e\n\x3cli\x3e校验规则\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e代码如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React, {Component} from \x27react\x27;\nimport PropTypes from \x27prop-types\x27;\n\nexport class Input extends Component {\n  constructor(props, context) {\n    super(props);\n    \/\/ 如果在 Form 中，或者在 FormItem 中，name值为必填\n    if ((context.form || context.formItem) \x26amp;\x26amp; !props.name) {\n      throw new Error(\x27You should set the `name` props\x27);\n    }\n    \/\/ 如果在 Form 中，不在 FormItem 中，提示一下，不在 FormItem 中不影响最后的值\n    if (context.form \x26amp;\x26amp; !context.formItem) {\n      console.warn(\x27Maybe used `Input` in `FormItem` can be better\x27);\n    }\n\n    \/\/ 在 FormItem 中，就要通知它自己是谁\n    if (context.formItem) {\n      context.formItem.setName(props.name);\n    }\n    \/\/ 在 Form 中，就向 Form 注册自己的 name 和 校验规则\n    if (context.form) {\n      context.form.register(props.name, props.rules);\n    }\n  }\n\n  shouldComponentUpdate(nextProps) {\n    const {form} = this.context;\n    const {name} = this.props;\n    \/\/ 当 有 onChange 事件 或者外部使用组件，强行更改了 Input 值，就需要通知 Form 更新值\n    if (form \x26amp;\x26amp; this.changeLock \x26amp;\x26amp; form.data[name] !== nextProps.value) {\n      form.setFieldValue(name, nextProps.value);\n      return false;\n    }\n    return true;\n  }\n\n  static propTypes = {\n    name: PropTypes.string,\n    value: PropTypes.string,\n    onChange: PropTypes.func,\n    rules: PropTypes.arrayOf(PropTypes.shape({\n      type: PropTypes.oneOf([\x27phone\x27]),\n      validator: PropTypes.func,\n      message: PropTypes.string.isRequired,\n    })),\n    type: PropTypes.oneOf([\x27text\x27, \x27tel\x27, \x27number\x27, \x27color\x27, \x27date\x27]),\n  };\n\n  static defaultProps = {\n    value: \x27\x27,\n    rules: [],\n  };\n\n  static contextTypes = {\n    form: PropTypes.object,\n    formItem: PropTypes.object,\n  };\n\n  onChange(e) {\n    const val = e.currentTarget.value;\n    const {onChange, name} = this.props;\n    const {form} = this.context;\n    if (onChange) {\n      this.changeLock = true;\n      onChange(val);\n    } else {\n      if (form) {\n        form.setFieldValue(name, val);\n      }\n    }\n  }\n\n  render() {\n    let {value, name, type} = this.props;\n    const {form} = this.context;\n    if (form) {\n      value = form.data[name] || \x27\x27;\n    }\n    return (\n        \x3cinput onChange={this.onChange.bind(this)} type={type} value={value}\/\x3e\n    );\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e, {\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e} from \x3cspan class=\x22hljs-symbol\x22\x3e\x27reac\x3c\/span\x3et\x27;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e from \x3cspan class=\x22hljs-symbol\x22\x3e\x27prop\x3c\/span\x3e-types\x27;\n\nexport \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eInput\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  constructor(props, context) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果在 Form 中，或者在 FormItem 中，name值为必填\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((context.form || context.formItem) \x26amp;\x26amp; !props.name) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-symbol\x22\x3e\x27You\x3c\/span\x3e should set the `name` props\x27);\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果在 Form 中，不在 FormItem 中，提示一下，不在 FormItem 中不影响最后的值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (context.form \x26amp;\x26amp; !context.formItem) {\n      console.warn(\x3cspan class=\x22hljs-symbol\x22\x3e\x27Maybe\x3c\/span\x3e used `\x3cspan class=\x22hljs-type\x22\x3eInput\x3c\/span\x3e` in `\x3cspan class=\x22hljs-type\x22\x3eFormItem\x3c\/span\x3e` can be better\x27);\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在 FormItem 中，就要通知它自己是谁\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (context.formItem) {\n      context.formItem.setName(props.name);\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在 Form 中，就向 Form 注册自己的 name 和 校验规则\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (context.form) {\n      context.form.register(props.name, props.rules);\n    }\n  }\n\n  shouldComponentUpdate(nextProps) {\n    const {form} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context;\n    const {name} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当 有 onChange 事件 或者外部使用组件，强行更改了 Input 值，就需要通知 Form 更新值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (form \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.changeLock \x26amp;\x26amp; form.data[name] !== nextProps.value) {\n      form.setFieldValue(name, nextProps.value);\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n  }\n\n  static propTypes = {\n    name: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.string,\n    value: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.string,\n    onChange: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.func,\n    rules: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.arrayOf(\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.shape({\n      \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.oneOf([\x3cspan class=\x22hljs-symbol\x22\x3e\x27phon\x3c\/span\x3ee\x27]),\n      validator: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.func,\n      message: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.string.isRequired,\n    })),\n    \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.oneOf([\x3cspan class=\x22hljs-symbol\x22\x3e\x27tex\x3c\/span\x3et\x27, \x3cspan class=\x22hljs-symbol\x22\x3e\x27te\x3c\/span\x3el\x27, \x3cspan class=\x22hljs-symbol\x22\x3e\x27numbe\x3c\/span\x3er\x27, \x3cspan class=\x22hljs-symbol\x22\x3e\x27colo\x3c\/span\x3er\x27, \x3cspan class=\x22hljs-symbol\x22\x3e\x27dat\x3c\/span\x3ee\x27]),\n  };\n\n  static defaultProps = {\n    value: \x27\x27,\n    rules: [],\n  };\n\n  static contextTypes = {\n    form: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eobject\x3c\/span\x3e,\n    formItem: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eobject\x3c\/span\x3e,\n  };\n\n  onChange(e) {\n    const \x3cspan class=\x22hljs-keyword\x22\x3eval\x3c\/span\x3e = e.currentTarget.value;\n    const {onChange, name} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    const {form} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (onChange) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.changeLock = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      onChange(\x3cspan class=\x22hljs-keyword\x22\x3eval\x3c\/span\x3e);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (form) {\n        form.setFieldValue(name, \x3cspan class=\x22hljs-keyword\x22\x3eval\x3c\/span\x3e);\n      }\n    }\n  }\n\n  render() {\n    let {value, name, \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e} \x3c\/span\x3e= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    const {form} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (form) {\n      value = form.data[name] || \x27\x27;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n        \x26lt;input onChange={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onChange.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)} \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e={\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e} \x3cspan class=\x22hljs-title\x22\x3evalue=\x3c\/span\x3e\x3c\/span\x3e{value}\/\x26gt;\n    );\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3eButton\x3c\/h4\x3e\n\x3cp\x3e负责内容很简单\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e提交，触发 submit\x3c\/li\x3e\n\x3cli\x3e重置，触发 reset\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e代码如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React, {Component} from \x27react\x27;\nimport PropTypes from \x27prop-types\x27;\n\nexport class Button extends Component {\n\n  componentWillMount() {\n    const {form} = this.context;\n    \/\/ 该组件只能用于 Form\n    if (!form) {\n      throw new Error(\x27You should used `FormButton` in the `Form`\x27);\n    }\n  }\n\n  static propTypes = {\n    children: PropTypes.any,\n    type: PropTypes.oneOf([\x27submit\x27, \x27reset\x27]),\n  };\n\n  static defaultProps = {\n    type: \x27submit\x27,\n  };\n\n  static contextTypes = {\n    form: PropTypes.any,\n  };\n\n  onClick() {\n    const {form} = this.context;\n    const {type} = this.props;\n    if (type === \x27reset\x27) {\n      form.reset();\n    } else {\n      form.submit();\n    }\n  }\n\n  render() {\n    return (\n        \x3cbutton onClick={this.onClick.bind(this)} className={\x27form-button\x27}\x3e\n          {this.props.children}\n        \x3c\/button\x3e\n    );\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e, {\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e} from \x3cspan class=\x22hljs-symbol\x22\x3e\x27reac\x3c\/span\x3et\x27;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e from \x3cspan class=\x22hljs-symbol\x22\x3e\x27prop\x3c\/span\x3e-types\x27;\n\nexport \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eButton\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n\n  componentWillMount() {\n    const {form} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 该组件只能用于 Form\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!form) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-symbol\x22\x3e\x27You\x3c\/span\x3e should used `\x3cspan class=\x22hljs-type\x22\x3eFormButton\x3c\/span\x3e` in the `\x3cspan class=\x22hljs-type\x22\x3eForm\x3c\/span\x3e`\x27);\n    }\n  }\n\n  static propTypes = {\n    children: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.any,\n    \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.oneOf([\x3cspan class=\x22hljs-symbol\x22\x3e\x27submi\x3c\/span\x3et\x27, \x3cspan class=\x22hljs-symbol\x22\x3e\x27rese\x3c\/span\x3et\x27]),\n  };\n\n  static defaultProps = {\n    \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-symbol\x22\x3e\x27submi\x3c\/span\x3et\x27,\n  };\n\n  static contextTypes = {\n    form: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.any,\n  };\n\n  onClick() {\n    const {form} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context;\n    const {\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e} \x3c\/span\x3e= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e===\x3c\/span\x3e \x27\x3cspan class=\x22hljs-title\x22\x3ereset\x3c\/span\x3e\x27) \x3c\/span\x3e{\n      form.reset();\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      form.submit();\n    }\n  }\n\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n        \x26lt;button onClick={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onClick.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)} className={\x3cspan class=\x22hljs-symbol\x22\x3e\x27form\x3c\/span\x3e-button\x27}\x26gt;\n          {\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.children}\n        \x26lt;\/button\x26gt;\n    );\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e后言\x3c\/h2\x3e\n\x3cp\x3e首先先讲明为何 不将label 和数据不放在state 里面因为多个组件同时注册时候，state更新来不及，会导致部分值初始化不成功，所以最后将值收集在 另外的 object 里面，并且是直接赋值\x3cbr\x3e看了上面几个组件的代码，应该有所明确，这些组件组合起来使用就是一个大的组件。同时又可以单独使用，知道该如何使用后，又可以按照规则，更新整个各个组件，而不会说，一个巨大无比的单独组件，无法拆分，累赘又复杂。通过联合组件，可以达成很多奇妙的组合方式。上文的例子中，如果没有 Form 组件， 单独的 FormInput 加 Input，这两个组合起来，也可以是一个单独的验证器。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React-联合组件</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014851189">https://segmentfault.com/a/1190000014851189</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/cqrmavmmv6n/" target="_blank">https://alili.tech/archive/cqrmavmmv6n/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>