<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="SpringBoot&#43;Vue前后端分离，使用SpringSecurity完美处理权限问题(二)"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>SpringBoot&#43;Vue前后端分离，使用SpringSecurity完美处理权限问题(二) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/cthvetxyf4c/",
				"appid": "1613049289050283", 
				"title": "SpringBoot&#43;Vue前后端分离，使用SpringSecurity完美处理权限问题(二) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-18T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/fwx881mqj/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/bqmuvtzq9dc/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fcthvetxyf4c%2f&text=SpringBoot%2bVue%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%ef%bc%8c%e4%bd%bf%e7%94%a8SpringSecurity%e5%ae%8c%e7%be%8e%e5%a4%84%e7%90%86%e6%9d%83%e9%99%90%e9%97%ae%e9%a2%98%28%e4%ba%8c%29"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fcthvetxyf4c%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fcthvetxyf4c%2f&text=SpringBoot%2bVue%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%ef%bc%8c%e4%bd%bf%e7%94%a8SpringSecurity%e5%ae%8c%e7%be%8e%e5%a4%84%e7%90%86%e6%9d%83%e9%99%90%e9%97%ae%e9%a2%98%28%e4%ba%8c%29"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fcthvetxyf4c%2f&title=SpringBoot%2bVue%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%ef%bc%8c%e4%bd%bf%e7%94%a8SpringSecurity%e5%ae%8c%e7%be%8e%e5%a4%84%e7%90%86%e6%9d%83%e9%99%90%e9%97%ae%e9%a2%98%28%e4%ba%8c%29"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fcthvetxyf4c%2f&is_video=false&description=SpringBoot%2bVue%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%ef%bc%8c%e4%bd%bf%e7%94%a8SpringSecurity%e5%ae%8c%e7%be%8e%e5%a4%84%e7%90%86%e6%9d%83%e9%99%90%e9%97%ae%e9%a2%98%28%e4%ba%8c%29"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=SpringBoot%2bVue%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%ef%bc%8c%e4%bd%bf%e7%94%a8SpringSecurity%e5%ae%8c%e7%be%8e%e5%a4%84%e7%90%86%e6%9d%83%e9%99%90%e9%97%ae%e9%a2%98%28%e4%ba%8c%29&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fcthvetxyf4c%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fcthvetxyf4c%2f&title=SpringBoot%2bVue%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%ef%bc%8c%e4%bd%bf%e7%94%a8SpringSecurity%e5%ae%8c%e7%be%8e%e5%a4%84%e7%90%86%e6%9d%83%e9%99%90%e9%97%ae%e9%a2%98%28%e4%ba%8c%29"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fcthvetxyf4c%2f&title=SpringBoot%2bVue%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%ef%bc%8c%e4%bd%bf%e7%94%a8SpringSecurity%e5%ae%8c%e7%be%8e%e5%a4%84%e7%90%86%e6%9d%83%e9%99%90%e9%97%ae%e9%a2%98%28%e4%ba%8c%29"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fcthvetxyf4c%2f&title=SpringBoot%2bVue%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%ef%bc%8c%e4%bd%bf%e7%94%a8SpringSecurity%e5%ae%8c%e7%be%8e%e5%a4%84%e7%90%86%e6%9d%83%e9%99%90%e9%97%ae%e9%a2%98%28%e4%ba%8c%29"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fcthvetxyf4c%2f&title=SpringBoot%2bVue%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%ef%bc%8c%e4%bd%bf%e7%94%a8SpringSecurity%e5%ae%8c%e7%be%8e%e5%a4%84%e7%90%86%e6%9d%83%e9%99%90%e9%97%ae%e9%a2%98%28%e4%ba%8c%29"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">SpringBoot&#43;Vue前后端分离，使用SpringSecurity完美处理权限问题(二)</h1><div class="meta"><div class="postdate"><time datetime="2018-12-18" itemprop="datePublished">2018-12-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e当前后端分离时，权限问题的处理也和我们传统的处理方式有一点差异。笔者前几天刚好在负责一个项目的权限管理模块，现在权限管理模块已经做完了，我想通过5-6篇文章，来介绍一下项目中遇到的问题以及我的解决方案，希望这个系列能够给小伙伴一些帮助。本系列文章并不是手把手的教程，主要介绍了核心思路并讲解了核心代码，完整的代码小伙伴们可以在GitHub上star并clone下来研究。另外，原本计划把项目跑起来放到网上供小伙伴们查看，但是之前买服务器为了省钱，内存只有512M，两个应用跑不起来(已经有一个\x3ca href=\x22https:\/\/github.com\/lenve\/VBlog\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eV部落开源项目\x3c\/a\x3e在运行)，因此小伙伴们只能将就看一下下面的截图了，GitHub上有部署教程，部署到本地也可以查看完整效果。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e项目地址：\x3ca href=\x22https:\/\/github.com\/lenve\/vhr\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/lenve\/vhr\x3c\/a\x3e  \x3c\/p\x3e\n\x3cp\x3e上篇文章我们对项目做了一个整体的介绍，从本文开始，我们就来实现我们的权限管理模块。由于前后端分离，因此我们先来完成后台接口，完成之后，可以先用POSTMAN或者RESTClient等工具进行测试，测试成功之后，我们再来着手开发前端。  \x3c\/p\x3e\n\x3cp\x3e本文是本系列的第二篇，建议先阅读前面的文章有助于更好的理解本文：  \x3c\/p\x3e\n\x3cp\x3e1.\x3ca href=\x22http:\/\/mp.weixin.qq.com\/s\/lpznrVx6Bh9X7ZnunrWQSA\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSpringBoot\x2bVue前后端分离，使用SpringSecurity完美处理权限问题(一)\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e创建SpringBoot项目\x3c\/h2\x3e\n\x3cp\x3e在IDEA中创建SpringBoot项目，创建完成之后，添加如下依赖：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdependencies\x3e\n    \x3cdependency\x3e\n        \x3cgroupId\x3eorg.mybatis.spring.boot\x3c\/groupId\x3e\n        \x3cartifactId\x3emybatis-spring-boot-starter\x3c\/artifactId\x3e\n        \x3cversion\x3e1.3.1\x3c\/version\x3e\n    \x3c\/dependency\x3e\n    \x3cdependency\x3e\n        \x3cgroupId\x3eorg.springframework.boot\x3c\/groupId\x3e\n        \x3cartifactId\x3espring-boot-starter-security\x3c\/artifactId\x3e\n    \x3c\/dependency\x3e\n    \x3cdependency\x3e\n        \x3cgroupId\x3eorg.springframework.boot\x3c\/groupId\x3e\n        \x3cartifactId\x3espring-boot-starter-web\x3c\/artifactId\x3e\n    \x3c\/dependency\x3e\n    \x3cdependency\x3e\n        \x3cgroupId\x3ecom.alibaba\x3c\/groupId\x3e\n        \x3cartifactId\x3edruid\x3c\/artifactId\x3e\n        \x3cversion\x3e1.0.29\x3c\/version\x3e\n    \x3c\/dependency\x3e\n    \x3cdependency\x3e\n        \x3cgroupId\x3emysql\x3c\/groupId\x3e\n        \x3cartifactId\x3emysql-connector-java\x3c\/artifactId\x3e\n    \x3c\/dependency\x3e\n\x3c\/dependencies\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3edependencies\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3edependency\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3egroupId\x3c\/span\x3e\x26gt;\x3c\/span\x3eorg.mybatis.spring.boot\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3egroupId\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eartifactId\x3c\/span\x3e\x26gt;\x3c\/span\x3emybatis-spring-boot-starter\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eartifactId\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eversion\x3c\/span\x3e\x26gt;\x3c\/span\x3e1.3.1\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eversion\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3edependency\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3edependency\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3egroupId\x3c\/span\x3e\x26gt;\x3c\/span\x3eorg.springframework.boot\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3egroupId\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eartifactId\x3c\/span\x3e\x26gt;\x3c\/span\x3espring-boot-starter-security\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eartifactId\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3edependency\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3edependency\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3egroupId\x3c\/span\x3e\x26gt;\x3c\/span\x3eorg.springframework.boot\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3egroupId\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eartifactId\x3c\/span\x3e\x26gt;\x3c\/span\x3espring-boot-starter-web\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eartifactId\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3edependency\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3edependency\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3egroupId\x3c\/span\x3e\x26gt;\x3c\/span\x3ecom.alibaba\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3egroupId\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eartifactId\x3c\/span\x3e\x26gt;\x3c\/span\x3edruid\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eartifactId\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eversion\x3c\/span\x3e\x26gt;\x3c\/span\x3e1.0.29\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eversion\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3edependency\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3edependency\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3egroupId\x3c\/span\x3e\x26gt;\x3c\/span\x3emysql\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3egroupId\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eartifactId\x3c\/span\x3e\x26gt;\x3c\/span\x3emysql-connector-java\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eartifactId\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3edependency\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3edependencies\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这些都是常规的依赖，有SpringBoot、SpringSecurity、Druid数据库连接池，还有数据库驱动。  \x3c\/p\x3e\n\x3cp\x3e然后在application.properties中配置数据库，如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22spring.datasource.type=com.alibaba.druid.pool.DruidDataSource\nspring.datasource.url=jdbc:mysql:\/\/127.0.0.1:3306\/vhr?useUnicode=true\x26amp;characterEncoding=UTF-8\nspring.datasource.username=root\nspring.datasource.password=123\n\nserver.port=8082\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3espring\x3cspan class=\x22hljs-selector-class\x22\x3e.datasource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.type\x3c\/span\x3e=com\x3cspan class=\x22hljs-selector-class\x22\x3e.alibaba\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.druid\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.pool\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.DruidDataSource\x3c\/span\x3e\nspring\x3cspan class=\x22hljs-selector-class\x22\x3e.datasource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.url\x3c\/span\x3e=jdbc:mysql:\x3cspan class=\x22hljs-comment\x22\x3e\/\/127.0.0.1:3306\/vhr?useUnicode=true\x26amp;characterEncoding=UTF-8\x3c\/span\x3e\nspring\x3cspan class=\x22hljs-selector-class\x22\x3e.datasource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.username\x3c\/span\x3e=root\nspring\x3cspan class=\x22hljs-selector-class\x22\x3e.datasource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.password\x3c\/span\x3e=\x3cspan class=\x22hljs-number\x22\x3e123\x3c\/span\x3e\n\nserver.port=\x3cspan class=\x22hljs-number\x22\x3e8082\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eOK，至此，我们的工程就创建好了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e创建Hr和HrService\x3c\/h2\x3e\n\x3cp\x3e首先我们需要创建Hr类，即我们的用户类，该类实现了UserDetails接口，该类的属性如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22public class Hr implements UserDetails {\n    private Long id;\n    private String name;\n    private String phone;\n    private String telephone;\n    private String address;\n    private boolean enabled;\n    private String username;\n    private String password;\n    private String remark;\n    private List\x3cRole\x3e roles;\n    private String userface;\n    \/\/getter\/setter省略\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHr\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimplements\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eUserDetails\x3c\/span\x3e\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e Long id;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eString\x3c\/span\x3e name;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eString\x3c\/span\x3e phone;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eString\x3c\/span\x3e telephone;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eString\x3c\/span\x3e address;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e boolean enabled;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eString\x3c\/span\x3e username;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eString\x3c\/span\x3e password;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eString\x3c\/span\x3e remark;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e List\x26lt;Role\x26gt; roles;\n    \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eString\x3c\/span\x3e userface;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/getter\/setter省略\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e如果小伙伴对属性的含义有疑问，可以参考\x3ca href=\x22https:\/\/github.com\/lenve\/vhr\/wiki\/1.%E6%9D%83%E9%99%90%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e1.权限数据库设计\x3c\/a\x3e.\x3c\/blockquote\x3e\n\x3cp\x3eUserDetails接口默认有几个方法需要实现，这几个方法中，除了isEnabled返回了正常的enabled之外，其他的方法我都统一返回true，因为我这里的业务逻辑并不涉及到账户的锁定、密码的过期等等，只有账户是否被禁用，因此只处理了isEnabled方法，这一块小伙伴可以根据自己的实际情况来调整。另外，UserDetails中还有一个方法叫做getAuthorities，该方法用来获取当前用户所具有的角色，但是小伙伴也看到了，我的Hr中有一个roles属性用来描述当前用户的角色，因此我的getAuthorities方法的实现如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22public Collection\x3c? extends GrantedAuthority\x3e getAuthorities() {\n    List\x3cGrantedAuthority\x3e authorities = new ArrayList\x3c\x3e();\n    for (Role role : roles) {\n        authorities.add(new SimpleGrantedAuthority(role.getName()));\n    }\n    return authorities;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e Collection\x26lt;? extends GrantedAuthority\x26gt; getAuthorities() {\n    List\x26lt;GrantedAuthority\x26gt; authorities = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eArrayList\x3c\/span\x3e\x26lt;\x26gt;();\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (Role role : \x3cspan class=\x22hljs-type\x22\x3eroles\x3c\/span\x3e) {\n        authorities.add(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eSimpleGrantedAuthority\x3c\/span\x3e(role.getName()));\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e authorities;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e即直接从roles中获取当前用户所具有的角色，构造SimpleGrantedAuthority然后返回即可。  \x3c\/p\x3e\n\x3cp\x3e创建好Hr之后，接下来我们需要创建HrService，用来执行登录等操作，HrService需要实现UserDetailsService接口，如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@Service\n@Transactional\npublic class HrService implements UserDetailsService {\n\n    @Autowired\n    HrMapper hrMapper;\n\n    @Override\n    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {\n        Hr hr = hrMapper.loadUserByUsername(s);\n        if (hr == null) {\n            throw new UsernameNotFoundException(\x26quot;用户名不对\x26quot;);\n        }\n        return hr;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs java\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e@Service\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e@Transactional\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHrService\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimplements\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eUserDetailsService\x3c\/span\x3e \x3c\/span\x3e{\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Autowired\x3c\/span\x3e\n    HrMapper hrMapper;\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e UserDetails \x3cspan class=\x22hljs-title\x22\x3eloadUserByUsername\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(String s)\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethrows\x3c\/span\x3e UsernameNotFoundException \x3c\/span\x3e{\n        Hr hr = hrMapper.loadUserByUsername(s);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hr == \x3cspan class=\x22hljs-keyword\x22\x3enull\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e UsernameNotFoundException(\x3cspan class=\x22hljs-string\x22\x3e\x22用户名不对\x22\x3c\/span\x3e);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e hr;\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里最主要是实现了UserDetailsService接口中的loadUserByUsername方法，在执行登录的过程中，这个方法将根据用户名去查找用户，如果用户不存在，则抛出UsernameNotFoundException异常，否则直接将查到的Hr返回。HrMapper用来执行数据库的查询操作，这个不在本系列的介绍范围内，所有涉及到数据库的操作都将只介绍方法的作用。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e自定义FilterInvocationSecurityMetadataSource\x3c\/h2\x3e\n\x3cp\x3eFilterInvocationSecurityMetadataSource有一个默认的实现类DefaultFilterInvocationSecurityMetadataSource，该类的主要功能就是通过当前的请求地址，获取该地址需要的用户角色，我们照猫画虎，自己也定义一个FilterInvocationSecurityMetadataSource，如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@Component\npublic class UrlFilterInvocationSecurityMetadataSource implements FilterInvocationSecurityMetadataSource {\n    @Autowired\n    MenuService menuService;\n    AntPathMatcher antPathMatcher = new AntPathMatcher();\n\n    @Override\n    public Collection\x3cConfigAttribute\x3e getAttributes(Object o) throws IllegalArgumentException {\n        \/\/获取请求地址\n        String requestUrl = ((FilterInvocation) o).getRequestUrl();\n        if (\x26quot;\/login_p\x26quot;.equals(requestUrl)) {\n            return null;\n        }\n        List\x3cMenu\x3e allMenu = menuService.getAllMenu();\n        for (Menu menu : allMenu) {\n            if (antPathMatcher.match(menu.getUrl(), requestUrl)\x26amp;\x26amp;menu.getRoles().size()\x3e0) {\n                List\x3cRole\x3e roles = menu.getRoles();\n                int size = roles.size();\n                String[] values = new String[size];\n                for (int i = 0; i \x3c size; i\x2b\x2b) {\n                    values[i] = roles.get(i).getName();\n                }\n                return SecurityConfig.createList(values);\n            }\n        }\n        \/\/没有匹配上的资源，都是登录访问\n        return SecurityConfig.createList(\x26quot;ROLE_LOGIN\x26quot;);\n    }\n\n    @Override\n    public Collection\x3cConfigAttribute\x3e getAllConfigAttributes() {\n        return null;\n    }\n\n    @Override\n    public boolean supports(Class\x3c?\x3e aClass) {\n        return FilterInvocation.class.isAssignableFrom(aClass);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs java\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e@Component\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eUrlFilterInvocationSecurityMetadataSource\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimplements\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eFilterInvocationSecurityMetadataSource\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-meta\x22\x3e@Autowired\x3c\/span\x3e\n    MenuService menuService;\n    AntPathMatcher antPathMatcher = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AntPathMatcher();\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e Collection\x26lt;ConfigAttribute\x26gt; \x3cspan class=\x22hljs-title\x22\x3egetAttributes\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(Object o)\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethrows\x3c\/span\x3e IllegalArgumentException \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/获取请求地址\x3c\/span\x3e\n        String requestUrl = ((FilterInvocation) o).getRequestUrl();\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x22\/login_p\x22\x3c\/span\x3e.equals(requestUrl)) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enull\x3c\/span\x3e;\n        }\n        List\x26lt;Menu\x26gt; allMenu = menuService.getAllMenu();\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (Menu menu : allMenu) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (antPathMatcher.match(menu.getUrl(), requestUrl)\x26amp;\x26amp;menu.getRoles().size()\x26gt;\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n                List\x26lt;Role\x26gt; roles = menu.getRoles();\n                \x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e size = roles.size();\n                String[] values = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e String[size];\n                \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; size; i\x2b\x2b) {\n                    values[i] = roles.get(i).getName();\n                }\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e SecurityConfig.createList(values);\n            }\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/没有匹配上的资源，都是登录访问\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e SecurityConfig.createList(\x3cspan class=\x22hljs-string\x22\x3e\x22ROLE_LOGIN\x22\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e Collection\x26lt;ConfigAttribute\x26gt; \x3cspan class=\x22hljs-title\x22\x3egetAllConfigAttributes\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enull\x3c\/span\x3e;\n    }\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eboolean\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esupports\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(Class\x26lt;?\x26gt; aClass)\x3c\/span\x3e \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e FilterInvocation.class.isAssignableFrom(aClass);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e关于自定义这个类，我说如下几点：  \x3c\/p\x3e\n\x3cp\x3e1.一开始注入了MenuService，MenuService的作用是用来查询数据库中url pattern和role的对应关系，查询结果是一个List集合，集合中是Menu类，Menu类有两个核心属性，一个是url pattern，即匹配规则(比如\x3ccode\x3e\/admin\/**\x3c\/code\x3e)，还有一个是List\x26lt;Role\x26gt;,即这种规则的路径需要哪些角色才能访问。  \x3c\/p\x3e\n\x3cp\x3e2.我们可以从getAttributes(Object o)方法的参数o中提取出当前的请求url，然后将这个请求url和数据库中查询出来的所有url pattern一一对照，看符合哪一个url pattern，然后就获取到该url pattern所对应的角色，当然这个角色可能有多个，所以遍历角色，最后利用SecurityConfig.createList方法来创建一个角色集合。  \x3c\/p\x3e\n\x3cp\x3e3.第二步的操作中，涉及到一个优先级问题，比如我的地址是\x3ccode\x3e\/employee\/basic\/hello\x3c\/code\x3e,这个地址既能被\x3ccode\x3e\/employee\/**\x3c\/code\x3e匹配，也能被\x3ccode\x3e\/employee\/basic\/**\x3c\/code\x3e匹配，这就要求我们从数据库查询的时候对数据进行排序，将\x3ccode\x3e\/employee\/basic\/**\x3c\/code\x3e类型的url pattern放在集合的前面去比较。  \x3c\/p\x3e\n\x3cp\x3e4.如果getAttributes(Object o)方法返回null的话，意味着当前这个请求不需要任何角色就能访问，甚至不需要登录。但是在我的整个业务中，并不存在这样的请求，我这里的要求是，所有未匹配到的路径，都是认证(登录)后可访问，因此我在这里返回一个\x3ccode\x3eROLE_LOGIN\x3c\/code\x3e的角色，这种角色在我的角色数据库中并不存在，因此我将在下一步的角色比对过程中特殊处理这种角色。  \x3c\/p\x3e\n\x3cp\x3e5.如果地址是\/login_p，这个是登录页，不需要任何角色即可访问，直接返回null。  \x3c\/p\x3e\n\x3cp\x3e6.getAttributes(Object o)方法返回的集合最终会来到AccessDecisionManager类中，接下来我们再来看AccessDecisionManager类。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e自定义AccessDecisionManager\x3c\/h2\x3e\n\x3cp\x3e自定义UrlAccessDecisionManager类实现AccessDecisionManager接口，如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@Component\npublic class UrlAccessDecisionManager implements AccessDecisionManager {\n    @Override\n    public void decide(Authentication authentication, Object o, Collection\x3cConfigAttribute\x3e collection) throws AccessDeniedException, AuthenticationException {\n        Iterator\x3cConfigAttribute\x3e iterator = collection.iterator();\n        while (iterator.hasNext()) {\n            ConfigAttribute ca = iterator.next();\n            \/\/当前请求需要的权限\n            String needRole = ca.getAttribute();\n            if (\x26quot;ROLE_LOGIN\x26quot;.equals(needRole)) {\n                if (authentication instanceof AnonymousAuthenticationToken) {\n                    throw new BadCredentialsException(\x26quot;未登录\x26quot;);\n                } else\n                    return;\n            }\n            \/\/当前用户所具有的权限\n            Collection\x3c? extends GrantedAuthority\x3e authorities = authentication.getAuthorities();\n            for (GrantedAuthority authority : authorities) {\n                if (authority.getAuthority().equals(needRole)) {\n                    return;\n                }\n            }\n        }\n        throw new AccessDeniedException(\x26quot;权限不足!\x26quot;);\n    }\n\n    @Override\n    public boolean supports(ConfigAttribute configAttribute) {\n        return true;\n    }\n\n    @Override\n    public boolean supports(Class\x3c?\x3e aClass) {\n        return true;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs aspectj\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e@Component\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eUrlAccessDecisionManager\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimplements\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eAccessDecisionManager\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edecide\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(Authentication authentication, Object o, Collection\x26lt;ConfigAttribute\x26gt; collection)\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethrows\x3c\/span\x3e AccessDeniedException, AuthenticationException \x3c\/span\x3e{\n        Iterator\x26lt;ConfigAttribute\x26gt; iterator = collection.iterator();\n        \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (iterator.hasNext()) {\n            ConfigAttribute ca = iterator.next();\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/当前请求需要的权限\x3c\/span\x3e\n            String needRole = ca.getAttribute();\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x22ROLE_LOGIN\x22\x3c\/span\x3e.equals(needRole)) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (authentication \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e AnonymousAuthenticationToken) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e BadCredentialsException(\x3cspan class=\x22hljs-string\x22\x3e\x22未登录\x22\x3c\/span\x3e);\n                } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n            }\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/当前用户所具有的权限\x3c\/span\x3e\n            Collection\x26lt;? \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e GrantedAuthority\x26gt; authorities = authentication.getAuthorities();\n            \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (GrantedAuthority authority : authorities) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (authority.getAuthority().equals(needRole)) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n                }\n            }\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AccessDeniedException(\x3cspan class=\x22hljs-string\x22\x3e\x22权限不足!\x22\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eboolean\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esupports\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(ConfigAttribute configAttribute)\x3c\/span\x3e \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e;\n    }\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eboolean\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esupports\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(Class\x26lt;?\x26gt; aClass)\x3c\/span\x3e \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e;\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e关于这个类，我说如下几点：  \x3c\/p\x3e\n\x3cp\x3e1.decide方法接收三个参数，其中第一个参数中保存了当前登录用户的角色信息，第三个参数则是UrlFilterInvocationSecurityMetadataSource中的getAttributes方法传来的，表示当前请求需要的角色（可能有多个）。  \x3c\/p\x3e\n\x3cp\x3e2.如果当前请求需要的权限为\x3ccode\x3eROLE_LOGIN\x3c\/code\x3e则表示登录即可访问，和角色没有关系，此时我需要判断authentication是不是AnonymousAuthenticationToken的一个实例，如果是，则表示当前用户没有登录，没有登录就抛一个BadCredentialsException异常，登录了就直接返回，则这个请求将被成功执行。  \x3c\/p\x3e\n\x3cp\x3e3.遍历collection，同时查看当前用户的角色列表中是否具备需要的权限，如果具备就直接返回，否则就抛异常。   \x3c\/p\x3e\n\x3cp\x3e4.这里涉及到一个all和any的问题：假设当前用户具备角色A、角色B，当前请求需要角色B、角色C，那么是要当前用户要包含所有请求角色才算授权成功还是只要包含一个就算授权成功？我这里采用了第二种方案，即只要包含一个即可。小伙伴可根据自己的实际情况调整decide方法中的逻辑。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e自定义AccessDeniedHandler\x3c\/h2\x3e\n\x3cp\x3e通过自定义AccessDeniedHandler我们可以自定义403响应的内容，如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@Component\npublic class AuthenticationAccessDeniedHandler implements AccessDeniedHandler {\n    @Override\n    public void handle(HttpServletRequest httpServletRequest, HttpServletResponse resp, AccessDeniedException e) throws IOException, ServletException {\n        resp.setStatus(HttpServletResponse.SC_FORBIDDEN);\n        resp.setCharacterEncoding(\x26quot;UTF-8\x26quot;);\n        PrintWriter out = resp.getWriter();\n        out.write(\x26quot;{\\\x26quot;status\\\x26quot;:\\\x26quot;error\\\x26quot;,\\\x26quot;msg\\\x26quot;:\\\x26quot;权限不足，请联系管理员!\\\x26quot;}\x26quot;);\n        out.flush();\n        out.close();\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ceylon\x22\x3e\x3ccode\x3e@Component\npublic \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e AuthenticationAccessDeniedHandler implements AccessDeniedHandler {\n    @Override\n    public \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e handle(HttpServletRequest httpServletRequest, HttpServletResponse resp, AccessDeniedException e) \x3cspan class=\x22hljs-meta\x22\x3ethrows\x3c\/span\x3e IOException, ServletException {\n        resp.setStatus(HttpServletResponse.SC\x3cspan class=\x22hljs-number\x22\x3e_\x3c\/span\x3eFORBIDDEN);\n        resp.setCharacterEncoding(\x3cspan class=\x22hljs-string\x22\x3e\x22UTF-8\x22\x3c\/span\x3e);\n        PrintWriter \x3cspan class=\x22hljs-keyword\x22\x3eout\x3c\/span\x3e = resp.getWriter();\n        \x3cspan class=\x22hljs-keyword\x22\x3eout\x3c\/span\x3e.write(\x3cspan class=\x22hljs-string\x22\x3e\x22{\\\x22\x3c\/span\x3estatus\\\x3cspan class=\x22hljs-string\x22\x3e\x22:\\\x22\x3c\/span\x3eerror\\\x3cspan class=\x22hljs-string\x22\x3e\x22,\\\x22\x3c\/span\x3emsg\\\x3cspan class=\x22hljs-string\x22\x3e\x22:\\\x22\x3c\/span\x3e权限不足，请联系管理员!\\\x3cspan class=\x22hljs-string\x22\x3e\x22}\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3eout\x3c\/span\x3e.flush();\n        \x3cspan class=\x22hljs-keyword\x22\x3eout\x3c\/span\x3e.close();\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e配置WebSecurityConfig\x3c\/h2\x3e\n\x3cp\x3e最后在webSecurityConfig中完成简单的配置即可，如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@Configuration\npublic class WebSecurityConfig extends WebSecurityConfigurerAdapter {\n\n    @Autowired\n    HrService hrService;\n    @Autowired\n    UrlFilterInvocationSecurityMetadataSource urlFilterInvocationSecurityMetadataSource;\n    @Autowired\n    UrlAccessDecisionManager urlAccessDecisionManager;\n    @Autowired\n    AuthenticationAccessDeniedHandler authenticationAccessDeniedHandler;\n\n    @Override\n    protected void configure(AuthenticationManagerBuilder auth) throws Exception {\n        auth.userDetailsService(hrService);\n    }\n\n    @Override\n    public void configure(WebSecurity web) throws Exception {\n        web.ignoring().antMatchers(\x26quot;\/index.html\x26quot;, \x26quot;\/static\/**\x26quot;);\n    }\n\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.authorizeRequests()\n                .withObjectPostProcessor(new ObjectPostProcessor\x3cFilterSecurityInterceptor\x3e() {\n                    @Override\n                    public \x3cO extends FilterSecurityInterceptor\x3e O postProcess(O o) {\n                        o.setSecurityMetadataSource(urlFilterInvocationSecurityMetadataSource);\n                        o.setAccessDecisionManager(urlAccessDecisionManager);\n                        return o;\n                    }\n                }).and().formLogin().loginPage(\x26quot;\/login_p\x26quot;).loginProcessingUrl(\x26quot;\/login\x26quot;).usernameParameter(\x26quot;username\x26quot;).passwordParameter(\x26quot;password\x26quot;).permitAll().failureHandler(new AuthenticationFailureHandler() {\n            @Override\n            public void onAuthenticationFailure(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e) throws IOException, ServletException {\n                httpServletResponse.setContentType(\x26quot;application\/json;charset=utf-8\x26quot;);\n                PrintWriter out = httpServletResponse.getWriter();\n                StringBuffer sb = new StringBuffer();\n                sb.append(\x26quot;{\\\x26quot;status\\\x26quot;:\\\x26quot;error\\\x26quot;,\\\x26quot;msg\\\x26quot;:\\\x26quot;\x26quot;);\n                if (e instanceof UsernameNotFoundException || e instanceof BadCredentialsException) {\n                    sb.append(\x26quot;用户名或密码输入错误，登录失败!\x26quot;);\n                } else if (e instanceof DisabledException) {\n                    sb.append(\x26quot;账户被禁用，登录失败，请联系管理员!\x26quot;);\n                } else {\n                    sb.append(\x26quot;登录失败!\x26quot;);\n                }\n                sb.append(\x26quot;\\\x26quot;}\x26quot;);\n                out.write(sb.toString());\n                out.flush();\n                out.close();\n            }\n        }).successHandler(new AuthenticationSuccessHandler() {\n            @Override\n            public void onAuthenticationSuccess(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication) throws IOException, ServletException {\n                httpServletResponse.setContentType(\x26quot;application\/json;charset=utf-8\x26quot;);\n                PrintWriter out = httpServletResponse.getWriter();\n                ObjectMapper objectMapper = new ObjectMapper();\n                String s = \x26quot;{\\\x26quot;status\\\x26quot;:\\\x26quot;success\\\x26quot;,\\\x26quot;msg\\\x26quot;:\x26quot; \x2b objectMapper.writeValueAsString(HrUtils.getCurrentHr()) \x2b \x26quot;}\x26quot;;\n                out.write(s);\n                out.flush();\n                out.close();\n            }\n        }).and().logout().permitAll().and().csrf().disable().exceptionHandling().accessDeniedHandler(authenticationAccessDeniedHandler);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs aspectj\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e@Configuration\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eWebSecurityConfig\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eWebSecurityConfigurerAdapter\x3c\/span\x3e \x3c\/span\x3e{\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Autowired\x3c\/span\x3e\n    HrService hrService;\n    \x3cspan class=\x22hljs-meta\x22\x3e@Autowired\x3c\/span\x3e\n    UrlFilterInvocationSecurityMetadataSource urlFilterInvocationSecurityMetadataSource;\n    \x3cspan class=\x22hljs-meta\x22\x3e@Autowired\x3c\/span\x3e\n    UrlAccessDecisionManager urlAccessDecisionManager;\n    \x3cspan class=\x22hljs-meta\x22\x3e@Autowired\x3c\/span\x3e\n    AuthenticationAccessDeniedHandler authenticationAccessDeniedHandler;\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eprotected\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3econfigure\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(AuthenticationManagerBuilder auth)\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethrows\x3c\/span\x3e Exception \x3c\/span\x3e{\n        auth.userDetailsService(hrService);\n    }\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3econfigure\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(WebSecurity web)\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethrows\x3c\/span\x3e Exception \x3c\/span\x3e{\n        web.ignoring().antMatchers(\x3cspan class=\x22hljs-string\x22\x3e\x22\/index.html\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22\/static\/**\x22\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eprotected\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3econfigure\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(HttpSecurity http)\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethrows\x3c\/span\x3e Exception \x3c\/span\x3e{\n        http.authorizeRequests()\n                .withObjectPostProcessor(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ObjectPostProcessor\x26lt;FilterSecurityInterceptor\x26gt;() {\n                    \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x26lt;O \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e FilterSecurityInterceptor\x26gt; \x3cspan class=\x22hljs-function\x22\x3eO \x3cspan class=\x22hljs-title\x22\x3epostProcess\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(O o)\x3c\/span\x3e \x3c\/span\x3e{\n                        o.setSecurityMetadataSource(urlFilterInvocationSecurityMetadataSource);\n                        o.setAccessDecisionManager(urlAccessDecisionManager);\n                        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e o;\n                    }\n                }).and().formLogin().loginPage(\x3cspan class=\x22hljs-string\x22\x3e\x22\/login_p\x22\x3c\/span\x3e).loginProcessingUrl(\x3cspan class=\x22hljs-string\x22\x3e\x22\/login\x22\x3c\/span\x3e).usernameParameter(\x3cspan class=\x22hljs-string\x22\x3e\x22username\x22\x3c\/span\x3e).passwordParameter(\x3cspan class=\x22hljs-string\x22\x3e\x22password\x22\x3c\/span\x3e).permitAll().failureHandler(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AuthenticationFailureHandler() {\n            \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonAuthenticationFailure\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e)\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethrows\x3c\/span\x3e IOException, ServletException \x3c\/span\x3e{\n                httpServletResponse.setContentType(\x3cspan class=\x22hljs-string\x22\x3e\x22application\/json;charset=utf-8\x22\x3c\/span\x3e);\n                PrintWriter out = httpServletResponse.getWriter();\n                StringBuffer sb = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e StringBuffer();\n                sb.append(\x3cspan class=\x22hljs-string\x22\x3e\x22{\\\x22status\\\x22:\\\x22error\\\x22,\\\x22msg\\\x22:\\\x22\x22\x3c\/span\x3e);\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (e \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e UsernameNotFoundException || e \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e BadCredentialsException) {\n                    sb.append(\x3cspan class=\x22hljs-string\x22\x3e\x22用户名或密码输入错误，登录失败!\x22\x3c\/span\x3e);\n                } \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eif\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(e \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e DisabledException)\x3c\/span\x3e \x3c\/span\x3e{\n                    sb.append(\x3cspan class=\x22hljs-string\x22\x3e\x22账户被禁用，登录失败，请联系管理员!\x22\x3c\/span\x3e);\n                } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                    sb.append(\x3cspan class=\x22hljs-string\x22\x3e\x22登录失败!\x22\x3c\/span\x3e);\n                }\n                sb.append(\x3cspan class=\x22hljs-string\x22\x3e\x22\\\x22}\x22\x3c\/span\x3e);\n                out.write(sb.toString());\n                out.flush();\n                out.close();\n            }\n        }).successHandler(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AuthenticationSuccessHandler() {\n            \x3cspan class=\x22hljs-meta\x22\x3e@Override\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonAuthenticationSuccess\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethrows\x3c\/span\x3e IOException, ServletException \x3c\/span\x3e{\n                httpServletResponse.setContentType(\x3cspan class=\x22hljs-string\x22\x3e\x22application\/json;charset=utf-8\x22\x3c\/span\x3e);\n                PrintWriter out = httpServletResponse.getWriter();\n                ObjectMapper objectMapper = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ObjectMapper();\n                String s = \x3cspan class=\x22hljs-string\x22\x3e\x22{\\\x22status\\\x22:\\\x22success\\\x22,\\\x22msg\\\x22:\x22\x3c\/span\x3e \x2b objectMapper.writeValueAsString(HrUtils.getCurrentHr()) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22}\x22\x3c\/span\x3e;\n                out.write(s);\n                out.flush();\n                out.close();\n            }\n        }).and().logout().permitAll().and().csrf().disable().exceptionHandling().accessDeniedHandler(authenticationAccessDeniedHandler);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e关于这个配置，我说如下几点：  \x3c\/p\x3e\n\x3cp\x3e1.在configure(HttpSecurity http)方法中，通过withObjectPostProcessor将刚刚创建的UrlFilterInvocationSecurityMetadataSource和UrlAccessDecisionManager注入进来。到时候，请求都会经过刚才的过滤器（除了configure(WebSecurity web)方法忽略的请求）。  \x3c\/p\x3e\n\x3cp\x3e2.successHandler中配置登录成功时返回的JSON，登录成功时返回当前用户的信息。  \x3c\/p\x3e\n\x3cp\x3e3.failureHandler表示登录失败，登录失败的原因可能有多种，我们根据不同的异常输出不同的错误提示即可。  \x3c\/p\x3e\n\x3cp\x3eOK，这些操作都完成之后，我们可以通过POSTMAN或者RESTClient来发起一个登录请求，看到如下结果则表示登录成功:  \x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV1Iup?w=794\x26amp;h=342\x22 src=\x22https:\/\/static.alili.tech\/img\/bV1Iup?w=794\x26amp;h=342\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e关注公众号，可以及时接收到最新文章:  \x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVUERD?w=258\x26amp;h=258\x22 src=\x22https:\/\/static.alili.tech\/img\/bVUERD?w=258\x26amp;h=258\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>SpringBoot+Vue前后端分离，使用SpringSecurity完美处理权限问题(二)</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012763317">https://segmentfault.com/a/1190000012763317</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/cthvetxyf4c/" target="_blank">https://alili.tech/archive/cthvetxyf4c/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>