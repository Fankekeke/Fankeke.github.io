<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="移动端 Modal 组件开发杂谈"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>移动端 Modal 组件开发杂谈 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/dcyz88e783t/",
				"appid": "1613049289050283", 
				"title": "移动端 Modal 组件开发杂谈 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-21T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/1ga5x1zwy5jj/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/4q3kmaekx52/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fdcyz88e783t%2f&text=%e7%a7%bb%e5%8a%a8%e7%ab%af%20Modal%20%e7%bb%84%e4%bb%b6%e5%bc%80%e5%8f%91%e6%9d%82%e8%b0%88"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fdcyz88e783t%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fdcyz88e783t%2f&text=%e7%a7%bb%e5%8a%a8%e7%ab%af%20Modal%20%e7%bb%84%e4%bb%b6%e5%bc%80%e5%8f%91%e6%9d%82%e8%b0%88"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fdcyz88e783t%2f&title=%e7%a7%bb%e5%8a%a8%e7%ab%af%20Modal%20%e7%bb%84%e4%bb%b6%e5%bc%80%e5%8f%91%e6%9d%82%e8%b0%88"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fdcyz88e783t%2f&is_video=false&description=%e7%a7%bb%e5%8a%a8%e7%ab%af%20Modal%20%e7%bb%84%e4%bb%b6%e5%bc%80%e5%8f%91%e6%9d%82%e8%b0%88"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%a7%bb%e5%8a%a8%e7%ab%af%20Modal%20%e7%bb%84%e4%bb%b6%e5%bc%80%e5%8f%91%e6%9d%82%e8%b0%88&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fdcyz88e783t%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fdcyz88e783t%2f&title=%e7%a7%bb%e5%8a%a8%e7%ab%af%20Modal%20%e7%bb%84%e4%bb%b6%e5%bc%80%e5%8f%91%e6%9d%82%e8%b0%88"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdcyz88e783t%2f&title=%e7%a7%bb%e5%8a%a8%e7%ab%af%20Modal%20%e7%bb%84%e4%bb%b6%e5%bc%80%e5%8f%91%e6%9d%82%e8%b0%88"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdcyz88e783t%2f&title=%e7%a7%bb%e5%8a%a8%e7%ab%af%20Modal%20%e7%bb%84%e4%bb%b6%e5%bc%80%e5%8f%91%e6%9d%82%e8%b0%88"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdcyz88e783t%2f&title=%e7%a7%bb%e5%8a%a8%e7%ab%af%20Modal%20%e7%bb%84%e4%bb%b6%e5%bc%80%e5%8f%91%e6%9d%82%e8%b0%88"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">移动端 Modal 组件开发杂谈</h1><div class="meta"><div class="postdate"><time datetime="2018-12-21" itemprop="datePublished">2018-12-21</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3ca href=\x22https:\/\/www.youzanyun.com\/zanui\/vant\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVant\x3c\/a\x3e 是有赞开发的一套基于 \x3ccode\x3eVue 2.0\x3c\/code\x3e 的 \x3ccode\x3eMobile\x3c\/code\x3e 组件库，在开发的过程中也踩了很多坑，今天我们就来聊一聊开发一个移动端 Modal 组件（在有赞该组件被称为 \x3ccode\x3ePopup\x3c\/code\x3e ）需要注意的一些\x3ccode\x3e坑\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e在任何一个合格的UI组件库中，\x3ccode\x3eModal\x3c\/code\x3e 组件应该是必备的组件之一。它一般用于用户处理事物，但又不希望跳转页面时，可以使用 \x3ccode\x3eModal\x3c\/code\x3e 在当前页面中打开一个浮层，承载对应的操作。相比PC端，移动端的 \x3ccode\x3eModal\x3c\/code\x3e 组件坑会更多，比如滚动穿透问题就不像PC端在 \x3ccode\x3ebody\x3c\/code\x3e 上添加 \x3ccode\x3eoverflow: hidden\x3c\/code\x3e 那么简单。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e目录\x3c\/h2\x3e\n\x3cp\x3e一、API定义\x3cbr\x3e\x3cbr\x3e二、水平垂直居中的方案\x3cbr\x3e\x3cbr\x3e三、可恶的滚动穿透\x3cbr\x3e\x3cbr\x3e四、\x3ccode\x3eposition: fixed\x3c\/code\x3e 失效\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e一、API定义\x3c\/h2\x3e\n\x3cp\x3e任何一个组件开始编码前都需要首先将API先定义好，才好根据API来提供对应的功能。\x3ccode\x3eModal\x3c\/code\x3e 组件提供了以下API：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012506056?w=1303\x26amp;h=360\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012506056?w=1303\x26amp;h=360\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e更具体的 Api 介绍可以访问该链接查看：\x3ca href=\x22https:\/\/www.youzanyun.com\/zanui\/vant#\/zh-CN\/component\/popup\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePopup\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e二、水平垂直居中方案\x3c\/h2\x3e\n\x3cp\x3e垂直居中的方案网上谷歌一下就能找到很多种，主流的方案有：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3eabsolute(fixed) \x2b 负边距\x3c\/li\x3e\n\x3cli\x3eabsolute(fixed) \x2b transform\x3c\/li\x3e\n\x3cli\x3eflex\x3c\/li\x3e\n\x3cli\x3etable \x2b vertical-align\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e首先说一下我们选择的是第二种：\x3ccode\x3eabsolute(fixed) \x2b transform\x3c\/code\x3e，它是以上方案中最简单最方便的方案，代码实现量也很少。实现代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.modal {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22css hljs\x22\x3e\x3ccode class=\x22css\x22\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.modal\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: fixed;\n  \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50%\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50%\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3etranslate\x3c\/span\x3e(-50%, -50%);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但是 \x3ccode\x3etransform\x3c\/code\x3e 会导致一个巨大的\x3ccode\x3e坑\x3c\/code\x3e，这个\x3ccode\x3e坑\x3c\/code\x3e的具体细节会在下面的章节中详细讲到。\x3c\/p\x3e\n\x3cp\x3e说完了我们选择的方案，再来说说为啥不选择其他的方案呢？\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eabsolute(fixed) \x2b 负边距\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e只能适合定高的场景，果断抛弃。如果要实现不定高度就要通过JS来计算了，增加了实现的复杂度。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eflex\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eflex\x3c\/code\x3e 布局一是在某些老版本的安卓浏览器上还不是很兼容，还有就是需要包裹一个父级才能水平垂直居中。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3etable \x2b vertical-middle\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e在 \x3ccode\x3eCSS2\x3c\/code\x3e 时代用这个方案来实现垂直居中是比较常见的方案，不足的地方就是代码实现量相对较大。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e三、可恶的滚动穿透\x3c\/h2\x3e\n\x3cp\x3e开发过移动端UI组件的都知道，在移动端有个可恶的滚动穿透问题。这个问题可以描述为：在弹窗上滑动会导致下层的页面跟着滚动。\x3c\/p\x3e\n\x3cp\x3e网上谷歌一下\x3ccode\x3e滚动穿透\x3c\/code\x3e关键字其实可以发现很多种解决方案，每个方案也各有优缺点，但我们选择的解决方案是团队的一姐一篇移动端体验优化的博文中得到的启示（博文地址：\x3ca href=\x22http:\/\/www.wytiny.com\/2016\/12\/15\/%E8%8A%B1%E5%BC%8F%E6%8F%90%E5%8D%87%E7%A7%BB%E5%8A%A8%E7%AB%AF%E4%BA%A4%E4%BA%92%E4%BD%93%E9%AA%8C\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e花式提升移动端交互体验 | TinySymphony\x3c\/a\x3e）。\x3c\/p\x3e\n\x3cp\x3e具体的思路是：当容器可以滑动时，若已经在顶部，禁止下滑；若在底部，禁止上滑；容器无法滚动时，禁止上下滑。实现的方式就是在 \x3ccode\x3edocument\x3c\/code\x3e 上监听 \x3ccode\x3etouchstart\x3c\/code\x3e 和 \x3ccode\x3etouchmove\x3c\/code\x3e 事件，如滑动时，祖先元素并没有可滑动元素，直接阻止冒泡即可；否则判断手指滑动的方向，若向下滑动，判断是否滑动到了滑动元素的底部，若已经到达底部，阻止冒泡，向上滑动也类似。具体的代码实现可以看下面的代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const _ = require(\x27src\/util\x27)\nexport default function (option) {\n  const scrollSelector = option.scroll || \x27.scroller\x27\n  const pos = {\n    x: 0,\n    y: 0\n  }\n\n  function stopEvent (e) {\n    e.preventDefault()\n    e.stopPropagation()\n  }\n\n  function recordPosition (e) {\n    pos.x = e.touches[0].clientX\n    pos.y = e.touches[0].clientY\n  }\n\n  function watchTouchMove (e) {\n    const target = e.target\n    const parents = _.parents(target, scrollSelector)\n    let el = null\n    if (target.classList.contains(scrollSelector)) el = target\n    else if (parents.length) el = parents[0]\n    else return stopEvent(e)\n    const dx = e.touches[0].clientX - pos.x\n    const dy = e.touches[0].clientY - pos.y\n    const direction = dy \x3e 0 ? \x2710\x27 : \x2701\x27\n    const scrollTop = el.scrollTop\n    const scrollHeight = el.scrollHeight\n    const offsetHeight = el.offsetHeight\n    const isVertical = Math.abs(dx) \x3c Math.abs(dy)\n    let status = \x2711\x27\n    if (scrollTop === 0) {\n      status = offsetHeight \x3e= scrollHeight ? \x2700\x27 : \x2701\x27\n    } else if (scrollTop \x2b offsetHeight \x3e= scrollHeight) {\n      status = \x2710\x27\n    }\n    if (status !== \x2711\x27 \x26amp;\x26amp; isVertical \x26amp;\x26amp; !(parseInt(status, 2) \x26amp; parseInt(direction, 2))) return stopEvent(e)\n  }\n  document.addEventListener(\x27touchstart\x27, recordPosition, false)\n  document.addEventListener(\x27touchmove\x27, watchTouchMove, false)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e _ = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27src\/util\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eoption\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e scrollSelector = option.scroll || \x3cspan class=\x22hljs-string\x22\x3e\x27.scroller\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e pos = {\n    \x3cspan class=\x22hljs-attr\x22\x3ex\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ey\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3estopEvent\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault()\n    e.stopPropagation()\n  }\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erecordPosition\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    pos.x = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientX\n    pos.y = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientY\n  }\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewatchTouchMove\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e target = e.target\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e parents = _.parents(target, scrollSelector)\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e el = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (target.classList.contains(scrollSelector)) el = target\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (parents.length) el = parents[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e stopEvent(e)\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dx = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientX - pos.x\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dy = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientY - pos.y\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e direction = dy \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x2710\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x2701\x27\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e scrollTop = el.scrollTop\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e scrollHeight = el.scrollHeight\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e offsetHeight = el.offsetHeight\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e isVertical = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.abs(dx) \x26lt; \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.abs(dy)\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e status = \x3cspan class=\x22hljs-string\x22\x3e\x2711\x27\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (scrollTop === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n      status = offsetHeight \x26gt;= scrollHeight ? \x3cspan class=\x22hljs-string\x22\x3e\x2700\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x2701\x27\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (scrollTop \x2b offsetHeight \x26gt;= scrollHeight) {\n      status = \x3cspan class=\x22hljs-string\x22\x3e\x2710\x27\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (status !== \x3cspan class=\x22hljs-string\x22\x3e\x2711\x27\x3c\/span\x3e \x26amp;\x26amp; isVertical \x26amp;\x26amp; !(\x3cspan class=\x22hljs-built_in\x22\x3eparseInt\x3c\/span\x3e(status, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) \x26amp; \x3cspan class=\x22hljs-built_in\x22\x3eparseInt\x3c\/span\x3e(direction, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e))) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e stopEvent(e)\n  }\n  \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27touchstart\x27\x3c\/span\x3e, recordPosition, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27touchmove\x27\x3c\/span\x3e, watchTouchMove, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e四、\x3ccode\x3eposition: fixed\x3c\/code\x3e 失效\x3c\/h2\x3e\n\x3cp\x3e在前端工程师的世界观里，\x3ccode\x3eposition: fixed\x3c\/code\x3e 一直是相对浏览器视口来定位的。有一天，你在固定定位元素的父元素上应用了 \x3ccode\x3etransform\x3c\/code\x3e 属性，当你刷新浏览器想看看最新的页面效果时，你竟然发现固定定位的元素竟然相对于父元素来定位了。是不是感觉人生观都崩塌了。\x3c\/p\x3e\n\x3cp\x3e这个问题，目前只在Chrome浏览器\/FireFox浏览器下有。也有人给 \x3ccode\x3eChrome\x3c\/code\x3e 提bug：\x3ca href=\x22https:\/\/bugs.chromium.org\/p\/chromium\/issues\/detail?id=20574\x26amp;desc=2\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eFixed-position element uses transformed ancestor as the container\x3c\/a\x3e，但至今尚未解决。\x3c\/p\x3e\n\x3cp\x3e例如下面的代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cstyle\x3e\n  body {\n    padding: 50px;\n  }\n  .demo {\n    background: #ccc;\n    height: 100px;\n    transform: scale(1);\n  }\n  .fixed-box {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100px;\n    height: 100px;\n    background: red;\n  }\n\x3c\/style\x3e\n\n\x3cdiv class=\x26quot;demo\x26quot;\x3e\n  \x3cdiv class=\x26quot;fixed-box\x26quot;\x3e\x3c\/div\x3e\n\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n  \x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attribute\x22\x3epadding\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50px\x3c\/span\x3e;\n  }\n  \x3cspan class=\x22hljs-selector-class\x22\x3e.demo\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e#ccc\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3etransform\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3escale\x3c\/span\x3e(1);\n  }\n  \x3cspan class=\x22hljs-selector-class\x22\x3e.fixed-box\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: fixed;\n    \x3cspan class=\x22hljs-attribute\x22\x3etop\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eleft\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: red;\n  }\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22demo\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22fixed-box\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e垂直居中方案 \x3ccode\x3eposition: fixed \x2b transform\x3c\/code\x3e 的选择导致了 \x3ccode\x3eModal\x3c\/code\x3e 组件使用上的一个坑。当我们在 \x3ccode\x3eModal\x3c\/code\x3e 组件里面嵌套了一个 \x3ccode\x3eModal\x3c\/code\x3e 时，内层的\x3ccode\x3eModal\x3c\/code\x3e 就是相对外层的 \x3ccode\x3eModal\x3c\/code\x3e 来定位，而不是浏览器的 viewport。这也限制了我们 \x3ccode\x3eModal\x3c\/code\x3e 的使用场景，如果你想实现嵌套的 \x3ccode\x3eModal\x3c\/code\x3e，就要选择其他的垂直居中方案了，有舍必有得嘛。\x3c\/p\x3e\n\x3cp\x3e关于 \x3ccode\x3eposition: fixed\x3c\/code\x3e 失效的更多细节可以参考以下几篇博文：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/meyerweb.com\/eric\/thoughts\/2011\/09\/12\/un-fixing-fixed-elements-with-css-transforms\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eEric’s Archived Thoughts:   Un-fixing Fixed Elements with CSS Transforms\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/www.zhangxinxu.com\/wordpress\/2015\/05\/css3-transform-affect\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCSS3 transform对普通元素的N多渲染影响\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e开发组件库不易，开发移动端组件库更不易。移动端组件库相对PC端会有更多的奇葩的坑。当遇到坑，肯定是要选择跨越它，而不是逃避它，因此也才有了我们这篇文章，后续我们也还会有一些介绍 \x3ca href=\x22https:\/\/www.youzanyun.com\/zanui\/vant\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVant\x3c\/a\x3e 组件库开发过程中遇到的坑，或者一些优化相关的文章，敬请期待。\x3c\/p\x3e\n\x3cp\x3e如果觉得这篇文章讲的还不够，完整源代码实现请移步Github：\x3ca href=\x22https:\/\/github.com\/youzan\/vant\/tree\/dev\/packages\/popup\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epopup\x3c\/a\x3e。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>移动端 Modal 组件开发杂谈</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012506051">https://segmentfault.com/a/1190000012506051</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/dcyz88e783t/" target="_blank">https://alili.tech/archive/dcyz88e783t/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>