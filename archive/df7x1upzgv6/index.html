<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="flutter笔记8：实战聊天页面嵌入交互动画和IOS风格适配"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>flutter笔记8：实战聊天页面嵌入交互动画和IOS风格适配 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/df7x1upzgv6/",
				"appid": "1613049289050283", 
				"title": "flutter笔记8：实战聊天页面嵌入交互动画和IOS风格适配 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-10T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/xguyruf1y4/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/edc0zkvict/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fdf7x1upzgv6%2f&text=flutter%e7%ac%94%e8%ae%b08%ef%bc%9a%e5%ae%9e%e6%88%98%e8%81%8a%e5%a4%a9%e9%a1%b5%e9%9d%a2%e5%b5%8c%e5%85%a5%e4%ba%a4%e4%ba%92%e5%8a%a8%e7%94%bb%e5%92%8cIOS%e9%a3%8e%e6%a0%bc%e9%80%82%e9%85%8d"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fdf7x1upzgv6%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fdf7x1upzgv6%2f&text=flutter%e7%ac%94%e8%ae%b08%ef%bc%9a%e5%ae%9e%e6%88%98%e8%81%8a%e5%a4%a9%e9%a1%b5%e9%9d%a2%e5%b5%8c%e5%85%a5%e4%ba%a4%e4%ba%92%e5%8a%a8%e7%94%bb%e5%92%8cIOS%e9%a3%8e%e6%a0%bc%e9%80%82%e9%85%8d"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fdf7x1upzgv6%2f&title=flutter%e7%ac%94%e8%ae%b08%ef%bc%9a%e5%ae%9e%e6%88%98%e8%81%8a%e5%a4%a9%e9%a1%b5%e9%9d%a2%e5%b5%8c%e5%85%a5%e4%ba%a4%e4%ba%92%e5%8a%a8%e7%94%bb%e5%92%8cIOS%e9%a3%8e%e6%a0%bc%e9%80%82%e9%85%8d"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fdf7x1upzgv6%2f&is_video=false&description=flutter%e7%ac%94%e8%ae%b08%ef%bc%9a%e5%ae%9e%e6%88%98%e8%81%8a%e5%a4%a9%e9%a1%b5%e9%9d%a2%e5%b5%8c%e5%85%a5%e4%ba%a4%e4%ba%92%e5%8a%a8%e7%94%bb%e5%92%8cIOS%e9%a3%8e%e6%a0%bc%e9%80%82%e9%85%8d"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=flutter%e7%ac%94%e8%ae%b08%ef%bc%9a%e5%ae%9e%e6%88%98%e8%81%8a%e5%a4%a9%e9%a1%b5%e9%9d%a2%e5%b5%8c%e5%85%a5%e4%ba%a4%e4%ba%92%e5%8a%a8%e7%94%bb%e5%92%8cIOS%e9%a3%8e%e6%a0%bc%e9%80%82%e9%85%8d&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fdf7x1upzgv6%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fdf7x1upzgv6%2f&title=flutter%e7%ac%94%e8%ae%b08%ef%bc%9a%e5%ae%9e%e6%88%98%e8%81%8a%e5%a4%a9%e9%a1%b5%e9%9d%a2%e5%b5%8c%e5%85%a5%e4%ba%a4%e4%ba%92%e5%8a%a8%e7%94%bb%e5%92%8cIOS%e9%a3%8e%e6%a0%bc%e9%80%82%e9%85%8d"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdf7x1upzgv6%2f&title=flutter%e7%ac%94%e8%ae%b08%ef%bc%9a%e5%ae%9e%e6%88%98%e8%81%8a%e5%a4%a9%e9%a1%b5%e9%9d%a2%e5%b5%8c%e5%85%a5%e4%ba%a4%e4%ba%92%e5%8a%a8%e7%94%bb%e5%92%8cIOS%e9%a3%8e%e6%a0%bc%e9%80%82%e9%85%8d"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdf7x1upzgv6%2f&title=flutter%e7%ac%94%e8%ae%b08%ef%bc%9a%e5%ae%9e%e6%88%98%e8%81%8a%e5%a4%a9%e9%a1%b5%e9%9d%a2%e5%b5%8c%e5%85%a5%e4%ba%a4%e4%ba%92%e5%8a%a8%e7%94%bb%e5%92%8cIOS%e9%a3%8e%e6%a0%bc%e9%80%82%e9%85%8d"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdf7x1upzgv6%2f&title=flutter%e7%ac%94%e8%ae%b08%ef%bc%9a%e5%ae%9e%e6%88%98%e8%81%8a%e5%a4%a9%e9%a1%b5%e9%9d%a2%e5%b5%8c%e5%85%a5%e4%ba%a4%e4%ba%92%e5%8a%a8%e7%94%bb%e5%92%8cIOS%e9%a3%8e%e6%a0%bc%e9%80%82%e9%85%8d"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">flutter笔记8：实战聊天页面嵌入交互动画和IOS风格适配</h1><div class="meta"><div class="postdate"><time datetime="2018-12-10" itemprop="datePublished">2018-12-10</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e熟悉了flutter的各种控件和相互嵌套的代码结构后，可以再加深一点难度：加入动画特效。\x3c\/p\x3e\n\x3cp\x3e虽然flutter的内置Metarial控件已经封装好了符合其设计语言的动画特效，使开发者节约了不少视觉处理上的精力，比如点击或长按listTile控件时自带水波纹动画、页面切换时切入向上或向下的动画、列表上拉或下拉到尽头有回弹波纹等。flutter也提供了用户可自定义的动画处理方案，使产品交互更加生动亲切、富有情趣。\x3c\/p\x3e\n\x3cp\x3eFlutter中封装了包含有值和状态（如向前，向后，完成和退出）的\x3ca href=\x22https:\/\/docs.flutter.io\/flutter\/animation\/Animation-class.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAnimation\x3c\/a\x3e对象。把\x3ccode\x3eAnimation\x3c\/code\x3e对象附加到控件中或直接监听动画对象属性， Flutter会根据对\x3ccode\x3eAnimation\x3c\/code\x3e对象属性的变化，修改控件的呈现效果并重新构建控件树。\x3c\/p\x3e\n\x3cp\x3e这次，敲一个APP的聊天页面，试试加入\x3ccode\x3eAnimation\x3c\/code\x3e后的效果，再尝试APP根据运行的操作系统进行风格适配。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e第一步 构建一个聊天界面\x3c\/h2\x3e\n\x3cp\x3e先创建一个新项目：\x3c\/p\x3e\n\x3cblockquote\x3eflutter create chatPage\x3c\/blockquote\x3e\n\x3cp\x3e进入\x3cstrong\x3emain.dart\x3c\/strong\x3e，贴入如下代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import \x27package:flutter\/material.dart\x27;\n\/\/程序入口\nvoid main() {\n  runApp(new FriendlychatApp());\n}\n\nconst String _name = \x26quot;CYC\x26quot;;    \/\/聊天帐号昵称\n\nclass FriendlychatApp extends StatelessWidget {\n @override\n Widget build(BuildContext context) {\n    return new MaterialApp(        \/\/创建一个MaterialApp控件对象，其下可塞入支持Material设计语言特性的控件\n      title: \x26quot;Friendlychat\x26quot;,\n      home: new ChatScreen(),    \/\/主页面为用户自定义ChatScreen控件\n    );\n  }\n}\n\n\/\/单条聊天信息控件\nclass ChatMessage extends StatelessWidget {\n  ChatMessage({this.text});\n  final String text;\n  @override\n  Widget build(BuildContext context) {\n    return new Container(\n      margin: const EdgeInsets.symmetric(vertical: 10.0),\n      child: new Row(                                   \/\/聊天记录的头像和文本信息横向排列\n        crossAxisAlignment: CrossAxisAlignment.start,\n        children: \x3cWidget\x3e[\n          new Container(\n            margin: const EdgeInsets.only(right: 16.0),\n            child: new CircleAvatar(child: new Text(_name[0])),      \/\/显示头像圆圈\n          ),\n          new Column(                                    \/\/单条消息记录，昵称和消息内容垂直排列\n            crossAxisAlignment: CrossAxisAlignment.start,\n            children: \x3cWidget\x3e[\n              new Text(_name, style: Theme.of(context).textTheme.subhead),    \/\/昵称\n              new Container(\n                margin: const EdgeInsets.only(top: 5.0),\n                child: new Text(text),                    \/\/消息文字\n              ),\n            ],\n          ),\n        ],\n      ),\n    );\n  }\n}\n\n\/\/聊天主页面ChatScreen控件定义为一个有状态控件\nclass ChatScreen extends StatefulWidget {\n  @override\n  State createState() =\x3e new ChatScreenState();   \/\/ChatScreenState作为控制ChatScreen控件状态的子类\n}\n\n\/\/ChatScreenState状态中实现聊天内容的动态更新\nclass ChatScreenState extends State\x3cChatScreen\x3e {\n  final List\x3cChatMessage\x3e _messages = \x3cChatMessage\x3e[];    \/\/存放聊天记录的数组，数组类型为无状态控件ChatMessage\n  final TextEditingController _textController = new TextEditingController();    \/\/聊天窗口的文本输入控件\n\n  \/\/定义发送文本事件的处理函数\n  void _handleSubmitted(String text) {\n    _textController.clear();        \/\/清空输入框\n    ChatMessage message = new ChatMessage(    \/\/定义新的消息记录控件对象\n      text: text,\n    );\n    \/\/状态变更，向聊天记录中插入新记录\n    setState(() {\n      _messages.insert(0, message);      \/\/插入新的消息记录\n    });\n  }\n\n  \/\/定义文本输入框控件\n  Widget _buildTextComposer() {\n   return new Container(\n       margin: const EdgeInsets.symmetric(horizontal: 8.0),  \n       child: new Row(                    \/\/文本输入和发送按钮都在同一行，使用Row控件包裹实现\n          children: \x3cWidget\x3e[\n            new Flexible(                    \n              child: new TextField( \n                controller: _textController,              \/\/载入文本输入控件\n                onSubmitted: _handleSubmitted, \n                decoration: new InputDecoration.collapsed(hintText: \x26quot;Send a message\x26quot;),      \/\/输入框中默认提示文字\n              ),\n            ),\n            new Container(\n              margin: new EdgeInsets.symmetric(horizontal: 4.0),\n              child: new IconButton(            \/\/发送按钮\n                icon: new Icon(Icons.send),    \/\/发送按钮图标\n                onPressed: () =\x3e _handleSubmitted(_textController.text)),      \/\/触发发送消息事件执行的函数_handleSubmitted\n           ),\n         ]\n       )\n    );\n  }\n  \/\/定义整个聊天窗口的页面元素布局\n  Widget build(BuildContext context) {\n    return new Scaffold(              \/\/页面脚手架\n      appBar: new AppBar(title: new Text(\x26quot;Friendlychat\x26quot;)),      \/\/页面标题\n      body: new Column(             \/\/Column使消息记录和消息输入框垂直排列\n        children: \x3cWidget\x3e[\n        new Flexible(                     \/\/子控件可柔性填充，如果下方弹出输入框，使消息记录列表可适当缩小高度\n          child: new ListView.builder(        \/\/可滚动显示的消息列表\n            padding: new EdgeInsets.all(8.0),\n            reverse: true,                  \/\/反转排序，列表信息从下至上排列\n            itemBuilder: (_, int index) =\x3e _messages[index],    \/\/插入聊天信息控件\n            itemCount: _messages.length,\n          )\n        ),\n        new Divider(height: 1.0),      \/\/聊天记录和输入框之间的分隔\n        new Container(\n          decoration: new BoxDecoration(\n            color: Theme.of(context).cardColor),\n          child: _buildTextComposer(),        \/\/页面下方的文本输入控件\n        ),\n       ]\n     ),\n   );\n  }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e\x27package\x3c\/span\x3e:flutter\/material.dart\x27;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/程序入口\x3c\/span\x3e\nvoid main() {\n  runApp(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eFriendlychatApp\x3c\/span\x3e());\n}\n\nconst \x3cspan class=\x22hljs-type\x22\x3eString\x3c\/span\x3e _name = \x3cspan class=\x22hljs-string\x22\x3e\x22CYC\x22\x3c\/span\x3e;    \x3cspan class=\x22hljs-comment\x22\x3e\/\/聊天帐号昵称\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eFriendlychatApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eStatelessWidget\x3c\/span\x3e \x3c\/span\x3e{\n \x3cspan class=\x22hljs-meta\x22\x3e@override\x3c\/span\x3e\n \x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e build(\x3cspan class=\x22hljs-type\x22\x3eBuildContext\x3c\/span\x3e context) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eMaterialApp\x3c\/span\x3e(        \x3cspan class=\x22hljs-comment\x22\x3e\/\/创建一个MaterialApp控件对象，其下可塞入支持Material设计语言特性的控件\x3c\/span\x3e\n      title: \x3cspan class=\x22hljs-string\x22\x3e\x22Friendlychat\x22\x3c\/span\x3e,\n      home: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eChatScreen\x3c\/span\x3e(),    \x3cspan class=\x22hljs-comment\x22\x3e\/\/主页面为用户自定义ChatScreen控件\x3c\/span\x3e\n    );\n  }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/单条聊天信息控件\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eChatMessage\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eStatelessWidget\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-type\x22\x3eChatMessage\x3c\/span\x3e({\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.text});\n  \x3cspan class=\x22hljs-keyword\x22\x3efinal\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eString\x3c\/span\x3e text;\n  \x3cspan class=\x22hljs-meta\x22\x3e@override\x3c\/span\x3e\n  \x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e build(\x3cspan class=\x22hljs-type\x22\x3eBuildContext\x3c\/span\x3e context) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eContainer\x3c\/span\x3e(\n      margin: const \x3cspan class=\x22hljs-type\x22\x3eEdgeInsets\x3c\/span\x3e.symmetric(vertical: \x3cspan class=\x22hljs-number\x22\x3e10.0\x3c\/span\x3e),\n      child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eRow\x3c\/span\x3e(                                   \x3cspan class=\x22hljs-comment\x22\x3e\/\/聊天记录的头像和文本信息横向排列\x3c\/span\x3e\n        crossAxisAlignment: \x3cspan class=\x22hljs-type\x22\x3eCrossAxisAlignment\x3c\/span\x3e.start,\n        children: \x26lt;\x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e\x26gt;[\n          \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eContainer\x3c\/span\x3e(\n            margin: const \x3cspan class=\x22hljs-type\x22\x3eEdgeInsets\x3c\/span\x3e.only(right: \x3cspan class=\x22hljs-number\x22\x3e16.0\x3c\/span\x3e),\n            child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eCircleAvatar\x3c\/span\x3e(child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eText\x3c\/span\x3e(_name[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e])),      \x3cspan class=\x22hljs-comment\x22\x3e\/\/显示头像圆圈\x3c\/span\x3e\n          ),\n          \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eColumn\x3c\/span\x3e(                                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/单条消息记录，昵称和消息内容垂直排列\x3c\/span\x3e\n            crossAxisAlignment: \x3cspan class=\x22hljs-type\x22\x3eCrossAxisAlignment\x3c\/span\x3e.start,\n            children: \x26lt;\x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e\x26gt;[\n              \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eText\x3c\/span\x3e(_name, style: \x3cspan class=\x22hljs-type\x22\x3eTheme\x3c\/span\x3e.of(context).textTheme.subhead),    \x3cspan class=\x22hljs-comment\x22\x3e\/\/昵称\x3c\/span\x3e\n              \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eContainer\x3c\/span\x3e(\n                margin: const \x3cspan class=\x22hljs-type\x22\x3eEdgeInsets\x3c\/span\x3e.only(top: \x3cspan class=\x22hljs-number\x22\x3e5.0\x3c\/span\x3e),\n                child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eText\x3c\/span\x3e(text),                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/消息文字\x3c\/span\x3e\n              ),\n            ],\n          ),\n        ],\n      ),\n    );\n  }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/聊天主页面ChatScreen控件定义为一个有状态控件\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eChatScreen\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eStatefulWidget\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-meta\x22\x3e@override\x3c\/span\x3e\n  \x3cspan class=\x22hljs-type\x22\x3eState\x3c\/span\x3e createState() =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eChatScreenState\x3c\/span\x3e();   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ChatScreenState作为控制ChatScreen控件状态的子类\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ChatScreenState状态中实现聊天内容的动态更新\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eChatScreenState\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eState\x26lt;ChatScreen\x26gt;\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3efinal\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eList\x3c\/span\x3e\x26lt;\x3cspan class=\x22hljs-type\x22\x3eChatMessage\x3c\/span\x3e\x26gt; _messages = \x26lt;\x3cspan class=\x22hljs-type\x22\x3eChatMessage\x3c\/span\x3e\x26gt;[];    \x3cspan class=\x22hljs-comment\x22\x3e\/\/存放聊天记录的数组，数组类型为无状态控件ChatMessage\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3efinal\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eTextEditingController\x3c\/span\x3e _textController = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eTextEditingController\x3c\/span\x3e();    \x3cspan class=\x22hljs-comment\x22\x3e\/\/聊天窗口的文本输入控件\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/定义发送文本事件的处理函数\x3c\/span\x3e\n  void _handleSubmitted(\x3cspan class=\x22hljs-type\x22\x3eString\x3c\/span\x3e text) {\n    _textController.clear();        \x3cspan class=\x22hljs-comment\x22\x3e\/\/清空输入框\x3c\/span\x3e\n    \x3cspan class=\x22hljs-type\x22\x3eChatMessage\x3c\/span\x3e message = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eChatMessage\x3c\/span\x3e(    \x3cspan class=\x22hljs-comment\x22\x3e\/\/定义新的消息记录控件对象\x3c\/span\x3e\n      text: text,\n    );\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/状态变更，向聊天记录中插入新记录\x3c\/span\x3e\n    setState(() {\n      _messages.insert(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, message);      \x3cspan class=\x22hljs-comment\x22\x3e\/\/插入新的消息记录\x3c\/span\x3e\n    });\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/定义文本输入框控件\x3c\/span\x3e\n  \x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e _buildTextComposer() {\n   \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eContainer\x3c\/span\x3e(\n       margin: const \x3cspan class=\x22hljs-type\x22\x3eEdgeInsets\x3c\/span\x3e.symmetric(horizontal: \x3cspan class=\x22hljs-number\x22\x3e8.0\x3c\/span\x3e),  \n       child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eRow\x3c\/span\x3e(                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/文本输入和发送按钮都在同一行，使用Row控件包裹实现\x3c\/span\x3e\n          children: \x26lt;\x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e\x26gt;[\n            \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eFlexible\x3c\/span\x3e(                    \n              child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eTextField\x3c\/span\x3e( \n                controller: _textController,              \x3cspan class=\x22hljs-comment\x22\x3e\/\/载入文本输入控件\x3c\/span\x3e\n                onSubmitted: _handleSubmitted, \n                decoration: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eInputDecoration\x3c\/span\x3e.collapsed(hintText: \x3cspan class=\x22hljs-string\x22\x3e\x22Send a message\x22\x3c\/span\x3e),      \x3cspan class=\x22hljs-comment\x22\x3e\/\/输入框中默认提示文字\x3c\/span\x3e\n              ),\n            ),\n            \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eContainer\x3c\/span\x3e(\n              margin: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eEdgeInsets\x3c\/span\x3e.symmetric(horizontal: \x3cspan class=\x22hljs-number\x22\x3e4.0\x3c\/span\x3e),\n              child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eIconButton\x3c\/span\x3e(            \x3cspan class=\x22hljs-comment\x22\x3e\/\/发送按钮\x3c\/span\x3e\n                icon: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eIcon\x3c\/span\x3e(\x3cspan class=\x22hljs-type\x22\x3eIcons\x3c\/span\x3e.send),    \x3cspan class=\x22hljs-comment\x22\x3e\/\/发送按钮图标\x3c\/span\x3e\n                onPressed: () =\x26gt; _handleSubmitted(_textController.text)),      \x3cspan class=\x22hljs-comment\x22\x3e\/\/触发发送消息事件执行的函数_handleSubmitted\x3c\/span\x3e\n           ),\n         ]\n       )\n    );\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/定义整个聊天窗口的页面元素布局\x3c\/span\x3e\n  \x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e build(\x3cspan class=\x22hljs-type\x22\x3eBuildContext\x3c\/span\x3e context) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eScaffold\x3c\/span\x3e(              \x3cspan class=\x22hljs-comment\x22\x3e\/\/页面脚手架\x3c\/span\x3e\n      appBar: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eAppBar\x3c\/span\x3e(title: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eText\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22Friendlychat\x22\x3c\/span\x3e)),      \x3cspan class=\x22hljs-comment\x22\x3e\/\/页面标题\x3c\/span\x3e\n      body: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eColumn\x3c\/span\x3e(             \x3cspan class=\x22hljs-comment\x22\x3e\/\/Column使消息记录和消息输入框垂直排列\x3c\/span\x3e\n        children: \x26lt;\x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e\x26gt;[\n        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eFlexible\x3c\/span\x3e(                     \x3cspan class=\x22hljs-comment\x22\x3e\/\/子控件可柔性填充，如果下方弹出输入框，使消息记录列表可适当缩小高度\x3c\/span\x3e\n          child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eListView\x3c\/span\x3e.builder(        \x3cspan class=\x22hljs-comment\x22\x3e\/\/可滚动显示的消息列表\x3c\/span\x3e\n            padding: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eEdgeInsets\x3c\/span\x3e.all(\x3cspan class=\x22hljs-number\x22\x3e8.0\x3c\/span\x3e),\n            reverse: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,                  \x3cspan class=\x22hljs-comment\x22\x3e\/\/反转排序，列表信息从下至上排列\x3c\/span\x3e\n            itemBuilder: (_, int index) =\x26gt; _messages[index],    \x3cspan class=\x22hljs-comment\x22\x3e\/\/插入聊天信息控件\x3c\/span\x3e\n            itemCount: _messages.length,\n          )\n        ),\n        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eDivider\x3c\/span\x3e(height: \x3cspan class=\x22hljs-number\x22\x3e1.0\x3c\/span\x3e),      \x3cspan class=\x22hljs-comment\x22\x3e\/\/聊天记录和输入框之间的分隔\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eContainer\x3c\/span\x3e(\n          decoration: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eBoxDecoration\x3c\/span\x3e(\n            color: \x3cspan class=\x22hljs-type\x22\x3eTheme\x3c\/span\x3e.of(context).cardColor),\n          child: _buildTextComposer(),        \x3cspan class=\x22hljs-comment\x22\x3e\/\/页面下方的文本输入控件\x3c\/span\x3e\n        ),\n       ]\n     ),\n   );\n  }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e运行上面的代码，可以看到这个聊天窗口已经生成，并且可以实现文本输入和发送了：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013712305\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013712305\x22 alt=\x22没有加入动画的聊天窗口\x22 title=\x22没有加入动画的聊天窗口\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如上图标注的控件，最终通过放置在状态对象\x3ccode\x3eChatScreenState\x3c\/code\x3e控件中的\x3ccode\x3eScaffold\x3c\/code\x3e脚手架完成安置，小伙伴可以输入一些文本，点击发送按钮试试\x3ccode\x3eListView\x3c\/code\x3e控件发生的变化。\x3c\/p\x3e\n\x3cp\x3e当发送按钮\x3ccode\x3eIconButton\x3c\/code\x3e触发\x3cstrong\x3eonPressed\x3c\/strong\x3e事件后调用\x3ccode\x3e_handleSubmitted\x3c\/code\x3e函数，在\x3ccode\x3e_handleSubmitted\x3c\/code\x3e中执行了\x3ccode\x3esetState()\x3c\/code\x3e方法，此时flutter根据\x3ccode\x3esetState()\x3c\/code\x3e中的变量\x3ccode\x3e_messages\x3c\/code\x3e变更重新渲染\x3ccode\x3e_messages\x3c\/code\x3e对象，然后大家就可以看到消息记录框\x3ccode\x3eListView\x3c\/code\x3e中底部新增了一行消息。\x3c\/p\x3e\n\x3cp\x3e由于\x3ccode\x3eListView\x3c\/code\x3e中的每一行都是瞬间添加完成，没有过度动画，使交互显得非常生硬，因此向\x3ccode\x3eListView\x3c\/code\x3e中的每个\x3cstrong\x3eItem\x3c\/strong\x3e的加入添加动画效果，提升一下交互体验。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e第二步 消息记录加入动效\x3c\/h2\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader2\x22\x3e改造\x3ccode\x3eChatScreen\x3c\/code\x3e控件\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e要让主页面\x3ccode\x3eChatScreen\x3c\/code\x3e支持动效，要在它的定义中附加mixin类型的对象\x3ccode\x3eTickerProviderStateMixin\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class ChatScreenState extends State\x3cChatScreen\x3e with TickerProviderStateMixin { \/\/ modified\n  final List\x3cChatMessage\x3e _messages = \x3cChatMessage\x3e[];\n  final TextEditingController _textController = new TextEditingController();\n  ...\n  }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eChatScreenState\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eState\x26lt;ChatScreen\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ewith\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTickerProviderStateMixin\x3c\/span\x3e \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ modified\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3efinal\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eList\x3c\/span\x3e\x26lt;\x3cspan class=\x22hljs-type\x22\x3eChatMessage\x3c\/span\x3e\x26gt; _messages = \x26lt;\x3cspan class=\x22hljs-type\x22\x3eChatMessage\x3c\/span\x3e\x26gt;[];\n  \x3cspan class=\x22hljs-keyword\x22\x3efinal\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eTextEditingController\x3c\/span\x3e _textController = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eTextEditingController\x3c\/span\x3e();\n  ...\n  }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader3\x22\x3e向ChatMessage中植入动画控制器控制动画效果\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class ChatMessage extends StatelessWidget {\n  ChatMessage({this.text, this.animationController});        \/\/new 加入动画控制器对象\n  final String text;\n  final AnimationController animationController;\n  @override\n  Widget build(BuildContext context) {\n    return new SizeTransition(             \/\/new  用SizeTransition动效控件包裹整个控件，定义从小变大的动画效果\n      sizeFactor: new CurvedAnimation(                              \/\/new  CurvedAnimation定义动画播放的时间曲线\n        parent: animationController, curve: Curves.easeOut),      \/\/new  指定曲线类型\n      axisAlignment: 0.0,                                           \/\/new  对齐\n      child: new Container(                                    \/\/modified  Container控件被包裹到SizeTransition中\n        margin: const EdgeInsets.symmetric(vertical: 10.0),\n          child: new Row(\n            crossAxisAlignment: CrossAxisAlignment.start,\n            children: \x3cWidget\x3e[\n            new Container(\n              margin: const EdgeInsets.only(right: 16.0),\n              child: new CircleAvatar(child: new Text(_name[0])),\n            ),\n            new Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: \x3cWidget\x3e[\n              new Text(_name, style: Theme.of(context).textTheme.subhead),\n              new Container(\n                margin: const EdgeInsets.only(top: 5.0),\n                child: new Text(text),\n              ),\n            ],\n          ),\n        ],\n      ),\n    )                                                           \/\/new\n  );\n}\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eChatMessage\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eStatelessWidget\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-type\x22\x3eChatMessage\x3c\/span\x3e({\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.text, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.animationController});        \x3cspan class=\x22hljs-comment\x22\x3e\/\/new 加入动画控制器对象\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3efinal\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eString\x3c\/span\x3e text;\n  \x3cspan class=\x22hljs-keyword\x22\x3efinal\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eAnimationController\x3c\/span\x3e animationController;\n  \x3cspan class=\x22hljs-meta\x22\x3e@override\x3c\/span\x3e\n  \x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e build(\x3cspan class=\x22hljs-type\x22\x3eBuildContext\x3c\/span\x3e context) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eSizeTransition\x3c\/span\x3e(             \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  用SizeTransition动效控件包裹整个控件，定义从小变大的动画效果\x3c\/span\x3e\n      sizeFactor: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eCurvedAnimation\x3c\/span\x3e(                              \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  CurvedAnimation定义动画播放的时间曲线\x3c\/span\x3e\n        parent: animationController, curve: \x3cspan class=\x22hljs-type\x22\x3eCurves\x3c\/span\x3e.easeOut),      \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  指定曲线类型\x3c\/span\x3e\n      axisAlignment: \x3cspan class=\x22hljs-number\x22\x3e0.0\x3c\/span\x3e,                                           \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  对齐\x3c\/span\x3e\n      child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eContainer\x3c\/span\x3e(                                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/modified  Container控件被包裹到SizeTransition中\x3c\/span\x3e\n        margin: const \x3cspan class=\x22hljs-type\x22\x3eEdgeInsets\x3c\/span\x3e.symmetric(vertical: \x3cspan class=\x22hljs-number\x22\x3e10.0\x3c\/span\x3e),\n          child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eRow\x3c\/span\x3e(\n            crossAxisAlignment: \x3cspan class=\x22hljs-type\x22\x3eCrossAxisAlignment\x3c\/span\x3e.start,\n            children: \x26lt;\x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e\x26gt;[\n            \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eContainer\x3c\/span\x3e(\n              margin: const \x3cspan class=\x22hljs-type\x22\x3eEdgeInsets\x3c\/span\x3e.only(right: \x3cspan class=\x22hljs-number\x22\x3e16.0\x3c\/span\x3e),\n              child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eCircleAvatar\x3c\/span\x3e(child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eText\x3c\/span\x3e(_name[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e])),\n            ),\n            \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eColumn\x3c\/span\x3e(\n              crossAxisAlignment: \x3cspan class=\x22hljs-type\x22\x3eCrossAxisAlignment\x3c\/span\x3e.start,\n              children: \x26lt;\x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e\x26gt;[\n              \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eText\x3c\/span\x3e(_name, style: \x3cspan class=\x22hljs-type\x22\x3eTheme\x3c\/span\x3e.of(context).textTheme.subhead),\n              \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eContainer\x3c\/span\x3e(\n                margin: const \x3cspan class=\x22hljs-type\x22\x3eEdgeInsets\x3c\/span\x3e.only(top: \x3cspan class=\x22hljs-number\x22\x3e5.0\x3c\/span\x3e),\n                child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eText\x3c\/span\x3e(text),\n              ),\n            ],\n          ),\n        ],\n      ),\n    )                                                           \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n  );\n}\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader4\x22\x3e修改_handleSubmitted()处理函数\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e由于ChatMessage对象的构造函数中添加了动画控制器对象animationController，因此创建新ChatMessage对象时也需要加入animationController的定义：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22void _handleSubmitted(String text) {\n  _textController.clear();\n  ChatMessage message = new ChatMessage(\n    text: text,\n    animationController: new AnimationController(                  \/\/new\n      duration: new Duration(milliseconds: 700),                   \/\/new  动画持续时间\n      vsync: this,                                                 \/\/new  默认属性和参数\n    ),                                                             \/\/new\n  );                                                               \/\/new\n  setState(() {\n    _messages.insert(0, message);\n  });\n  message.animationController.forward();                           \/\/new  启动动画\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs arduino\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e _handleSubmitted(\x3cspan class=\x22hljs-keyword\x22\x3eString\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3etext\x3c\/span\x3e) {\n  _textController.\x3cspan class=\x22hljs-built_in\x22\x3eclear\x3c\/span\x3e();\n  ChatMessage message = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ChatMessage(\n    \x3cspan class=\x22hljs-built_in\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3etext\x3c\/span\x3e,\n    animationController: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AnimationController(                  \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n      duration: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Duration(milliseconds: \x3cspan class=\x22hljs-number\x22\x3e700\x3c\/span\x3e),                   \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  动画持续时间\x3c\/span\x3e\n      vsync: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e,                                                 \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  默认属性和参数\x3c\/span\x3e\n    ),                                                             \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n  );                                                               \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n  setState(() {\n    _messages.insert(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, message);\n  });\n  message.animationController.forward();                           \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  启动动画\x3c\/span\x3e\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader5\x22\x3e释放控件\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e由于附加了动效的控件比较耗费内存，当不需要用到此页面时最好释放掉这些控件，Flutter会在复杂页面中自动调用\x3ccode\x3edispose()\x3c\/code\x3e释放冗余的对象，玩家可以通过重写\x3ccode\x3edispose()\x3c\/code\x3e指定页面中需要释放的内容，当然由于本案例只有这一个页面，因此Flutter不会自动执行到\x3ccode\x3edispose()\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@override\nvoid dispose() {                                                   \/\/new\n  for (ChatMessage message in _messages)                           \/\/new  遍历_messages数组\n    message.animationController.dispose();                         \/\/new  释放动效\n  super.dispose();                                                 \/\/new\n} \n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e@\x3cspan class=\x22hljs-keyword\x22\x3eoverride\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e dispose() {                                                   \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (ChatMessage message \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e _messages)                           \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  遍历_messages数组\x3c\/span\x3e\n    message.animationController.dispose();                         \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  释放动效\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e.dispose();                                                 \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n} \n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e按上面的代码改造完后，用\x3cstrong\x3eR\x3c\/strong\x3e而不是\x3cstrong\x3er\x3c\/strong\x3e重启一下APP，可以把之前没有加入动效的ChatMessage对象清除掉，使整体显示效果更和谐。这时候试试点击发送按钮后的效果吧~\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e可以通过调整在\x3ccode\x3e_handleSubmitted\x3c\/code\x3e中\x3ccode\x3eAnimationController\x3c\/code\x3e对象的\x3ccode\x3eDuration\x3c\/code\x3e函数参数值（单位：毫秒），改变动效持续时间。\x3c\/li\x3e\n\x3cli\x3e可通过改变\x3ccode\x3eCurvedAnimation\x3c\/code\x3e对象的\x3ccode\x3ecurve\x3c\/code\x3e参数值，改变动效时间曲线（和CSS的贝塞尔曲线类似），参数值可参考\x3ca href=\x22http:\/\/docs.flutter.io\/flutter\/animation\/Curves-class.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3cstrong\x3eCurves\x3c\/strong\x3e\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e可以尝试使用\x3ca href=\x22https:\/\/docs.flutter.io\/flutter\/widgets\/FadeTransition-class.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3cstrong\x3eFadeTransition\x3c\/strong\x3e\x3c\/a\x3e替代\x3ca href=\x22https:\/\/docs.flutter.io\/flutter\/widgets\/SizeTransition-class.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3cstrong\x3eSizeTransition\x3c\/strong\x3e\x3c\/a\x3e，试试动画效果如何\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e实现了消息列表的滑动，但是这个聊天窗口还有很多问题，比如输入框的文本只能横向增加不会自动换行，可以空字符发送消息等，接下来就修复这些交互上的BUG，顺便再复习下setState()的用法。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e第三步 优化交互\x3c\/h2\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader7\x22\x3e杜绝发送空字符\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e当\x3ccode\x3eTextField\x3c\/code\x3e控件中的文本正在被编辑时，会触发\x3cstrong\x3eonChanged\x3c\/strong\x3e事件，我们通过这个事件检查文本框中是否有字符串，如果没有则点击发送按钮失效，如果有则可以发送消息。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class ChatScreenState extends State\x3cChatScreen\x3e with TickerProviderStateMixin {\n  final List\x3cChatMessage\x3e _messages = \x3cChatMessage\x3e[];\n  final TextEditingController _textController = new TextEditingController();\n  bool _isComposing = false;                                      \/\/new  到ChatScreenState对象中定义一个标志位\n  ...\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eChatScreenState\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eState\x26lt;ChatScreen\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ewith\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTickerProviderStateMixin\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3efinal\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eList\x3c\/span\x3e\x26lt;\x3cspan class=\x22hljs-type\x22\x3eChatMessage\x3c\/span\x3e\x26gt; _messages = \x26lt;\x3cspan class=\x22hljs-type\x22\x3eChatMessage\x3c\/span\x3e\x26gt;[];\n  \x3cspan class=\x22hljs-keyword\x22\x3efinal\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eTextEditingController\x3c\/span\x3e _textController = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eTextEditingController\x3c\/span\x3e();\n  bool _isComposing = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;                                      \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  到ChatScreenState对象中定义一个标志位\x3c\/span\x3e\n  ...\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e向文本输入控件_buildTextComposer中加入这个标志位的控制：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Widget _buildTextComposer() {\n  return new IconTheme(\n    data: new IconThemeData(color: Theme.of(context).accentColor),\n    child: new Container(\n      margin: const EdgeInsets.symmetric(horizontal: 8.0),\n      child: new Row(\n        children: \x3cWidget\x3e[\n          new Flexible(\n            child: new TextField(\n              controller: _textController,\n              onChanged: (String text) {          \/\/new  通过onChanged事件更新_isComposing 标志位的值\n                setState(() {                     \/\/new  调用setState函数重新渲染受到_isComposing变量影响的IconButton控件\n                  _isComposing = text.length \x3e 0; \/\/new  如果文本输入框中的字符串长度大于0则允许发送消息\n                });                               \/\/new\n              },                                  \/\/new\n              onSubmitted: _handleSubmitted,\n              decoration:\n                  new InputDecoration.collapsed(hintText: \x26quot;Send a message\x26quot;),\n            ),\n          ),\n          new Container(\n            margin: new EdgeInsets.symmetric(horizontal: 4.0),\n            child: new IconButton(\n              icon: new Icon(Icons.send),\n              onPressed: _isComposing\n                  ? () =\x3e _handleSubmitted(_textController.text)    \/\/modified\n                  : null,                             \/\/modified  当没有为onPressed绑定处理函数时，IconButton默认为禁用状态\n            ),\n          ),\n        ],\n      ),\n    ),\n  );\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3eWidget\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3e_buildTextComposer\x3c\/span\x3e() {\n  \x3cspan class=\x22hljs-selector-tag\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eIconTheme\x3c\/span\x3e(\n    \x3cspan class=\x22hljs-attribute\x22\x3edata\x3c\/span\x3e: new IconThemeData(\x3cspan class=\x22hljs-attribute\x22\x3ecolor\x3c\/span\x3e: Theme.of(context).accentColor),\n    \x3cspan class=\x22hljs-attribute\x22\x3echild\x3c\/span\x3e: new Container(\n      \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: const EdgeInsets.symmetric(\x3cspan class=\x22hljs-attribute\x22\x3ehorizontal\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e8.0\x3c\/span\x3e),\n      \x3cspan class=\x22hljs-attribute\x22\x3echild\x3c\/span\x3e: new Row(\n        \x3cspan class=\x22hljs-attribute\x22\x3echildren\x3c\/span\x3e: \x26lt;Widget\x26gt;[\n          new Flexible(\n            \x3cspan class=\x22hljs-attribute\x22\x3echild\x3c\/span\x3e: new TextField(\n              \x3cspan class=\x22hljs-attribute\x22\x3econtroller\x3c\/span\x3e: _textController,\n              \x3cspan class=\x22hljs-attribute\x22\x3eonChanged\x3c\/span\x3e: (String text) {          \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  通过onChanged事件更新_isComposing 标志位的值\x3c\/span\x3e\n                setState(() {                     \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  调用setState函数重新渲染受到_isComposing变量影响的IconButton控件\x3c\/span\x3e\n                  _isComposing = text.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  如果文本输入框中的字符串长度大于0则允许发送消息\x3c\/span\x3e\n                });                               \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n              },                                  \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n              \x3cspan class=\x22hljs-attribute\x22\x3eonSubmitted\x3c\/span\x3e: _handleSubmitted,\n              \x3cspan class=\x22hljs-attribute\x22\x3edecoration\x3c\/span\x3e:\n                  new InputDecoration.collapsed(\x3cspan class=\x22hljs-attribute\x22\x3ehintText\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Send a message\x22\x3c\/span\x3e),\n            ),\n          ),\n          new Container(\n            \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: new EdgeInsets.symmetric(\x3cspan class=\x22hljs-attribute\x22\x3ehorizontal\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e4.0\x3c\/span\x3e),\n            \x3cspan class=\x22hljs-attribute\x22\x3echild\x3c\/span\x3e: new IconButton(\n              \x3cspan class=\x22hljs-attribute\x22\x3eicon\x3c\/span\x3e: new Icon(Icons.send),\n              \x3cspan class=\x22hljs-attribute\x22\x3eonPressed\x3c\/span\x3e: _isComposing\n                  ? () =\x26gt; _handleSubmitted(_textController.text)    \x3cspan class=\x22hljs-comment\x22\x3e\/\/modified\x3c\/span\x3e\n                  : null,                             \x3cspan class=\x22hljs-comment\x22\x3e\/\/modified  当没有为onPressed绑定处理函数时，IconButton默认为禁用状态\x3c\/span\x3e\n            ),\n          ),\n        ],\n      ),\n    ),\n  );\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当点击发送按钮后，重置标志位为false：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22void _handleSubmitted(String text) {\n  _textController.clear();\n  setState(() {                                                    \/\/new  你们懂的\n    _isComposing = false;                                          \/\/new  重置_isComposing 值\n  });                                                              \/\/new\n  ChatMessage message = new ChatMessage(\n    text: text,\n    animationController: new AnimationController(\n      duration: new Duration(milliseconds: 700),\n      vsync: this,\n    ),\n  );\n  setState(() {\n    _messages.insert(0, message);\n  });\n  message.animationController.forward();\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs processing\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e _handleSubmitted(\x3cspan class=\x22hljs-keyword\x22\x3eString\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3etext\x3c\/span\x3e) {\n  _textController.\x3cspan class=\x22hljs-built_in\x22\x3eclear\x3c\/span\x3e();\n  setState(() {                                                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  你们懂的\x3c\/span\x3e\n    _isComposing = \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e;                                          \x3cspan class=\x22hljs-comment\x22\x3e\/\/new  重置_isComposing 值\x3c\/span\x3e\n  });                                                              \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n  ChatMessage message = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ChatMessage(\n    \x3cspan class=\x22hljs-built_in\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3etext\x3c\/span\x3e,\n    animationController: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e AnimationController(\n      duration: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Duration(milliseconds: \x3cspan class=\x22hljs-number\x22\x3e700\x3c\/span\x3e),\n      vsync: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e,\n    ),\n  );\n  setState(() {\n    _messages.insert(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, message);\n  });\n  message.animationController.forward();\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这时候热更新一下，再发送一条消息试试：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013712306\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013712306\x22 alt=\x22禁止发送空文本\x22 title=\x22禁止发送空文本\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader8\x22\x3e自动换行\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e当发送的文本消息超出一行时，会看到以下效果：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013712307\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013712307\x22 alt=\x22无法自动换行\x22 title=\x22无法自动换行\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e遇到这种情况，使用\x3ccode\x3eExpanded\x3c\/code\x3e控件包裹一下ChatMessage的消息内容区域即可：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22...\n\nnew Expanded(                                               \/\/new  Expanded控件\n  child: new Column(                                   \/\/modified  Column被Expanded包裹起来，使其内部文本可自动换行\n    crossAxisAlignment: CrossAxisAlignment.start,\n    children: \x3cWidget\x3e[\n      new Text(_name, style: Theme.of(context).textTheme.subhead),\n      new Container(\n        margin: const EdgeInsets.only(top: 5.0),\n        child: new Text(text),\n      ),\n    ],\n  ),\n),                                                          \/\/new\n\n...\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs vhdl\x22\x3e\x3ccode\x3e...\n\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Expanded(                                               \/\/\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e  Expanded控件\n  child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Column(                                   \/\/modified  Column被Expanded包裹起来，使其内部文本可自动换行\n    crossAxisAlignment: CrossAxisAlignment.start,\n    children: \x26lt;Widget\x26gt;[\n      \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eText\x3c\/span\x3e(_name, style: Theme.\x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3econtext\x3c\/span\x3e).textTheme.subhead),\n      \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Container(\n        margin: const EdgeInsets.only(top: \x3cspan class=\x22hljs-number\x22\x3e5.0\x3c\/span\x3e),\n        child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eText\x3c\/span\x3e(\x3cspan class=\x22hljs-literal\x22\x3etext\x3c\/span\x3e),\n      ),\n    ],\n  ),\n),                                                          \/\/\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\n\n...\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e第四步 IOS和安卓风格适配\x3c\/h2\x3e\n\x3cp\x3eflutter虽然可以一套代码生成安卓和IOS的APP，但是这两者有着各自的设计语言：Material和Cupertino。因此为了让APP能够更好的融合进对应的系统设计语言，我们要对页面中的控件进行一些处理。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013712308\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013712308\x22 alt=\x22Cupertino和Material的设计风格\x22 title=\x22Cupertino和Material的设计风格\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader10\x22\x3e引入IOS控件库：\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e前面已经引入\x3cstrong\x3eMaterial.dart\x3c\/strong\x3e控件库，但还缺少了IOS的Cupertino控件库，因此在\x3cstrong\x3emain.dart\x3c\/strong\x3e的头部中引入：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import \x27package:flutter\/cupertino.dart\x27; \n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x3cspan class=\x22hljs-meta-keyword\x22\x3eimport\x3c\/span\x3e \x27package:flutter\/cupertino.dart\x27;\x3c\/span\x3e \n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader11\x22\x3e定义Material和Cupertino的主题风格\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3eMaterial为默认主题，当检测到APP运行在IOS时使用Cupertino主题：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22final ThemeData kIOSTheme = new ThemeData(    \/\/Cupertino主题风格\n  primarySwatch: Colors.orange,\n  primaryColor: Colors.grey[100],\n  primaryColorBrightness: Brightness.light,\n);\n\nfinal ThemeData kDefaultTheme = new ThemeData(    \/\/默认的Material主题风格\n  primarySwatch: Colors.purple,\n  accentColor: Colors.orangeAccent[400],\n);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dts\x22\x3e\x3ccode\x3efinal ThemeData kIOSTheme = new ThemeData(    \x3cspan class=\x22hljs-comment\x22\x3e\/\/Cupertino主题风格\x3c\/span\x3e\n\x3cspan class=\x22hljs-symbol\x22\x3e  primarySwatch:\x3c\/span\x3e Colors.orange,\n\x3cspan class=\x22hljs-symbol\x22\x3e  primaryColor:\x3c\/span\x3e Colors.grey[\x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e],\n\x3cspan class=\x22hljs-symbol\x22\x3e  primaryColorBrightness:\x3c\/span\x3e Brightness.light,\n);\n\nfinal ThemeData kDefaultTheme = new ThemeData(    \x3cspan class=\x22hljs-comment\x22\x3e\/\/默认的Material主题风格\x3c\/span\x3e\n\x3cspan class=\x22hljs-symbol\x22\x3e  primarySwatch:\x3c\/span\x3e Colors.purple,\n\x3cspan class=\x22hljs-symbol\x22\x3e  accentColor:\x3c\/span\x3e Colors.orangeAccent[\x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e],\n);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader12\x22\x3e根据运行的操作系统判断对应的主题：\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e首先要引入一个用于识别操作系统的工具库，其内的defaultTargetPlatform值可帮助我们识别操作系统：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import \x27package:flutter\/foundation.dart\x27;\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x3cspan class=\x22hljs-meta-keyword\x22\x3eimport\x3c\/span\x3e \x27package:flutter\/foundation.dart\x27;\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e到程序的入口控件\x3ccode\x3eFriendlychatApp\x3c\/code\x3e中应用对应的操作系统主题：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class FriendlychatApp extends StatelessWidget {\n  @override\n  Widget build(BuildContext context) {\n    return new MaterialApp(\n      title: \x26quot;Friendlychat\x26quot;,\n      theme: defaultTargetPlatform == TargetPlatform.iOS         \/\/newdefaultTargetPlatform用于识别操作系统\n        ? kIOSTheme                                              \/\/new\n        : kDefaultTheme,                                         \/\/new\n      home: new ChatScreen(),\n    );\n  }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eFriendlychatApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eStatelessWidget\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-meta\x22\x3e@override\x3c\/span\x3e\n  \x3cspan class=\x22hljs-type\x22\x3eWidget\x3c\/span\x3e build(\x3cspan class=\x22hljs-type\x22\x3eBuildContext\x3c\/span\x3e context) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eMaterialApp\x3c\/span\x3e(\n      title: \x3cspan class=\x22hljs-string\x22\x3e\x22Friendlychat\x22\x3c\/span\x3e,\n      theme: defaultTargetPlatform == \x3cspan class=\x22hljs-type\x22\x3eTargetPlatform\x3c\/span\x3e.iOS         \x3cspan class=\x22hljs-comment\x22\x3e\/\/newdefaultTargetPlatform用于识别操作系统\x3c\/span\x3e\n        ? kIOSTheme                                              \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n        : kDefaultTheme,                                         \x3cspan class=\x22hljs-comment\x22\x3e\/\/new\x3c\/span\x3e\n      home: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eChatScreen\x3c\/span\x3e(),\n    );\n  }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader13\x22\x3e页面标题的风格适配\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e页面顶部显示Friendlychat的标题栏的下方，在IOS的Cupertino设计语言中没有阴影，与下面的应用主体通过一条灰色的线分隔开，而Material则通过标题栏下方的阴影达到这一效果，因此将两种特性应用到代码中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22   \/\/ Modify the build() method of the ChatScreenState class.\n   Widget build(BuildContext context) {\n      return new Scaffold(\n        appBar: new AppBar(\n          title: new Text(\x26quot;Friendlychat\x26quot;),\n          elevation: Theme.of(context).platform == TargetPlatform.iOS ? 0.0 : 4.0),    \/\/new  适配IOS的扁平化无阴影效果\n          body: new Container(                    \/\/modified    使用Container控件，方便加入主题风格装饰\n            child: new Column(                      \/\/modified\n              children: \x3cWidget\x3e[\n                new Flexible(\n                  child: new ListView.builder(\n                    padding: new EdgeInsets.all(8.0),\n                    reverse: true,\n                    itemBuilder: (_, int index) =\x3e _messages[index],\n                    itemCount: _messages.length,\n                  ),\n                ),\n              new Divider(height: 1.0),\n              new Container(\n              decoration: new BoxDecoration(color: Theme.of(context).cardColor),\n              child: _buildTextComposer(),\n            ),\n          ],\n        ),\n          decoration: Theme.of(context).platform == TargetPlatform.iOS \/\/new    加入主题风格\n        ? new BoxDecoration(                                     \/\/new\n            border: new Border(                                  \/\/new  为适应IOS加入边框特性\n              top: new BorderSide(color: Colors.grey[200]),      \/\/new  顶部加入灰色边框\n            ),                                                   \/\/new\n          )                                                      \/\/new\n        : null),                                                 \/\/modified  \n      );\n    }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs maxima\x22\x3e\x3ccode\x3e   \/\/ Modify the build() \x3cspan class=\x22hljs-built_in\x22\x3emethod\x3c\/span\x3e of the ChatScreenState class.\n   Widget build(BuildContext \x3cspan class=\x22hljs-built_in\x22\x3econtext\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e Scaffold(\n        appBar: \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e AppBar(\n          \x3cspan class=\x22hljs-built_in\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e Text(\x3cspan class=\x22hljs-string\x22\x3e\x22Friendlychat\x22\x3c\/span\x3e),\n          \x3cspan class=\x22hljs-built_in\x22\x3eelevation\x3c\/span\x3e: Theme.of(\x3cspan class=\x22hljs-built_in\x22\x3econtext\x3c\/span\x3e).platform == TargetPlatform.iOS ? \x3cspan class=\x22hljs-number\x22\x3e0.0\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e4.0\x3c\/span\x3e),    \/\/\x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e  适配IOS的扁平化无阴影效果\n          body: \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e Container(                    \/\/modified    使用Container控件，方便加入主题风格装饰\n            child: \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e Column(                      \/\/modified\n              children: \x26lt;Widget\x26gt;[\n                \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e Flexible(\n                  child: \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e ListView.builder(\n                    padding: \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e EdgeInsets.all(\x3cspan class=\x22hljs-number\x22\x3e8.0\x3c\/span\x3e),\n                    \x3cspan class=\x22hljs-built_in\x22\x3ereverse\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n                    itemBuilder: (\x3cspan class=\x22hljs-symbol\x22\x3e_\x3c\/span\x3e, int index) =\x26gt; _messages[index],\n                    itemCount: _messages.\x3cspan class=\x22hljs-built_in\x22\x3elength\x3c\/span\x3e,\n                  ),\n                ),\n              \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e Divider(\x3cspan class=\x22hljs-built_in\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1.0\x3c\/span\x3e),\n              \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e Container(\n              decoration: \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e BoxDecoration(\x3cspan class=\x22hljs-built_in\x22\x3ecolor\x3c\/span\x3e: Theme.of(\x3cspan class=\x22hljs-built_in\x22\x3econtext\x3c\/span\x3e).cardColor),\n              child: _buildTextComposer(),\n            ),\n          ],\n        ),\n          decoration: Theme.of(\x3cspan class=\x22hljs-built_in\x22\x3econtext\x3c\/span\x3e).platform == TargetPlatform.iOS \/\/\x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e    加入主题风格\n        ? \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e BoxDecoration(                                     \/\/\x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e\n            \x3cspan class=\x22hljs-built_in\x22\x3eborder\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e Border(                                  \/\/\x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e  为适应IOS加入边框特性\n              top: \x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e BorderSide(\x3cspan class=\x22hljs-built_in\x22\x3ecolor\x3c\/span\x3e: Colors.grey[\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e]),      \/\/\x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e  顶部加入灰色边框\n            ),                                                   \/\/\x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e\n          )                                                      \/\/\x3cspan class=\x22hljs-built_in\x22\x3enew\x3c\/span\x3e\n        : null),                                                 \/\/modified  \n      );\n    }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader14\x22\x3e发送按钮的风格适配\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e发送按钮在APP遇到IOS时，使用Cupertino风格的按钮：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ Modify the _buildTextComposer method.\n\nnew Container(\n   margin: new EdgeInsets.symmetric(horizontal: 4.0),\n   child: Theme.of(context).platform == TargetPlatform.iOS ?  \/\/modified\n   new CupertinoButton(                              \/\/new  使用Cupertino控件库的CupertinoButton控件作为IOS端的发送按钮\n     child: new Text(\x26quot;Send\x26quot;),                         \/\/new\n     onPressed: _isComposing                                  \/\/new\n         ? () =\x3e  _handleSubmitted(_textController.text)      \/\/new\n         : null,) :                                           \/\/new\n   new IconButton(                                            \/\/modified\n       icon: new Icon(Icons.send),\n       onPressed: _isComposing ?\n           () =\x3e  _handleSubmitted(_textController.text) : null,\n       )\n   ),\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs aspectj\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Modify the _buildTextComposer method.\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Container(\n   margin: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e EdgeInsets.symmetric(horizontal: 4.0),\n   child: Theme.of(context).platform == TargetPlatform.iOS ?  \/\/modified\n   \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e CupertinoButton(                              \/\/\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e  使用Cupertino控件库的CupertinoButton控件作为IOS端的发送按钮\n     child: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Text(\x3cspan class=\x22hljs-string\x22\x3e\x22Send\x22\x3c\/span\x3e),                         \/\/\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\n     onPressed: _isComposing                                  \/\/\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\n         ? () =\x26gt;  _handleSubmitted(_textController.text)      \/\/\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\n         : \x3cspan class=\x22hljs-keyword\x22\x3enull\x3c\/span\x3e,) :                                           \/\/\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\n   \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e IconButton(                                            \/\/modified\n       icon: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Icon(Icons.send),\n       onPressed: _isComposing ?\n           () =\x26gt;  _handleSubmitted(_textController.text) : \x3cspan class=\x22hljs-keyword\x22\x3enull\x3c\/span\x3e,\n       )\n   ),\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e总结一下，为控件加入动画效果，就是把控件用动画控件包裹起来实现目的。动画控件有很多种，今天只选用了一个大小变化的控件\x3ccode\x3eSizeTransition\x3c\/code\x3e作为示例，由于每种动画控件内部的属性不同，都需要单独配置，大家可\x3ca href=\x22https:\/\/docs.flutter.io\/flutter\/widgets\/AnimatedWidget-class.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e参考官网\x3c\/a\x3e了解这些动画控件的详情。\x3c\/p\x3e\n\x3cp\x3e除此之外为了适应不同操作系统的设计语言，用到了IOS的控件库和操作系统识别的控件库，这是跨平台开发中常用的功能。\x3c\/p\x3e\n\x3cp\x3e好啦，flutter的入门笔记到本篇就结束了，今后将更新flutter的进阶篇和实战，由于近期工作任务较重，加上日常还有跟前端大神\x3ca href=\x22https:\/\/segmentfault.com\/u\/feihu\x22\x3e狐神\x3c\/a\x3e学习\x3cstrong\x3egolang\x3c\/strong\x3e的任务，以后的更新会比较慢，因此也欢迎大家到我的\x3ca href=\x22https:\/\/www.jianshu.com\/c\/ebc9d2e84214\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eFlutter圈子\x3c\/a\x3e中投稿，分享自己的成果，把这个专题热度搞起来，赶上谷歌这次跨平台的小火车，也可以加入\x3cstrong\x3eflutter 中文社区（官方QQ群：338252156）\x3c\/strong\x3e共同成长，谢谢大家~\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>flutter笔记8：实战聊天页面嵌入交互动画和IOS风格适配</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013712300">https://segmentfault.com/a/1190000013712300</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/df7x1upzgv6/" target="_blank">https://alili.tech/archive/df7x1upzgv6/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>