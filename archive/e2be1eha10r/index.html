<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JavaScript异步编程：Generator与Async"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JavaScript异步编程：Generator与Async | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/e2be1eha10r/",
				"appid": "1613049289050283", 
				"title": "JavaScript异步编程：Generator与Async | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-02T02:30:15"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/1aybfu1xgj/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/6mb09wx36xx/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fe2be1eha10r%2f&text=JavaScript%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%ef%bc%9aGenerator%e4%b8%8eAsync"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fe2be1eha10r%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fe2be1eha10r%2f&text=JavaScript%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%ef%bc%9aGenerator%e4%b8%8eAsync"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fe2be1eha10r%2f&title=JavaScript%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%ef%bc%9aGenerator%e4%b8%8eAsync"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fe2be1eha10r%2f&is_video=false&description=JavaScript%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%ef%bc%9aGenerator%e4%b8%8eAsync"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JavaScript%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%ef%bc%9aGenerator%e4%b8%8eAsync&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fe2be1eha10r%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fe2be1eha10r%2f&title=JavaScript%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%ef%bc%9aGenerator%e4%b8%8eAsync"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fe2be1eha10r%2f&title=JavaScript%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%ef%bc%9aGenerator%e4%b8%8eAsync"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fe2be1eha10r%2f&title=JavaScript%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%ef%bc%9aGenerator%e4%b8%8eAsync"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fe2be1eha10r%2f&title=JavaScript%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b%ef%bc%9aGenerator%e4%b8%8eAsync"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JavaScript异步编程：Generator与Async</h1><div class="meta"><div class="postdate"><time datetime="2018-12-02" itemprop="datePublished">2018-12-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e从\x3ccode\x3ePromise\x3c\/code\x3e开始，JavaScript就在引入新功能，来帮助更简单的方法来处理异步编程，帮助我们远离回调地狱。  \x3cbr\x3e\x3ccode\x3ePromise\x3c\/code\x3e是下边要讲的\x3ccode\x3eGenerator\x3c\/code\x3e\/\x3ccode\x3eyield\x3c\/code\x3e与\x3ccode\x3easync\x3c\/code\x3e\/\x3ccode\x3eawait\x3c\/code\x3e的基础，希望你已经提前了解了它。  \x3c\/p\x3e\n\x3cp\x3e在大概\x3ccode\x3eES6\x3c\/code\x3e的时代，推出了\x3ccode\x3eGenerator\x3c\/code\x3e\/\x3ccode\x3eyield\x3c\/code\x3e两个关键字，使用\x3ccode\x3eGenerator\x3c\/code\x3e可以很方便的帮助我们建立一个处理\x3ccode\x3ePromise\x3c\/code\x3e的解释器。\x3c\/p\x3e\n\x3cp\x3e然后，在\x3ccode\x3eES7\x3c\/code\x3e左右，我们又得到了\x3ccode\x3easync\x3c\/code\x3e\/\x3ccode\x3eawait\x3c\/code\x3e这样的语法，可以让我们以接近编写同步代码的方式来编写异步代码（无需使用\x3ccode\x3e.then()\x3c\/code\x3e或者回调函数）。\x3c\/p\x3e\n\x3cp\x3e两者都能够帮助我们很方便的进行异步编程，但同样，这两者之间也是有不少区别的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eGenerator\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3eGenerator\x3c\/code\x3e是一个函数，可以在函数内部通过\x3ccode\x3eyield\x3c\/code\x3e返回一个值（\x3cstrong\x3e此时，\x3ccode\x3eGenerator\x3c\/code\x3e函数的执行会暂定，直到下次触发\x3ccode\x3e.next()\x3c\/code\x3e\x3c\/strong\x3e）  \x3cbr\x3e创建一个\x3ccode\x3eGenerator\x3c\/code\x3e函数的方法是在\x3ccode\x3efunction\x3c\/code\x3e关键字后添加\x3ccode\x3e*\x3c\/code\x3e标识。\x3c\/p\x3e\n\x3cp\x3e在调用一个\x3ccode\x3eGenerator\x3c\/code\x3e函数后，并不会立即执行其中的代码，函数会返回一个\x3ccode\x3eGenerator\x3c\/code\x3e对象，通过调用对象的\x3ccode\x3enext\x3c\/code\x3e函数，可以获得\x3ccode\x3eyield\x3c\/code\x3e\/\x3ccode\x3ereturn\x3c\/code\x3e的返回值。  \x3cbr\x3e无论是触发了\x3ccode\x3eyield\x3c\/code\x3e还是\x3ccode\x3ereturn\x3c\/code\x3e，\x3ccode\x3enext()\x3c\/code\x3e函数总会返回一个带有\x3ccode\x3evalue\x3c\/code\x3e和\x3ccode\x3edone\x3c\/code\x3e属性的对象。  \x3cbr\x3e\x3ccode\x3evalue\x3c\/code\x3e为返回值，\x3ccode\x3edone\x3c\/code\x3e则是一个\x3ccode\x3eBoolean\x3c\/code\x3e对象，用来标识\x3ccode\x3eGenerator\x3c\/code\x3e是否还能继续提供返回值。  \x3cbr\x3e\x3cem\x3eP.S. \x3ccode\x3eGenerator\x3c\/code\x3e函数的执行时惰性的，\x3ccode\x3eyield\x3c\/code\x3e后的代码只在触发\x3ccode\x3enext\x3c\/code\x3e时才会执行\x3c\/em\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function * oddGenerator () {\n  yield 1\n  yield 3\n\n  return 5\n}\n\nlet iterator = oddGenerator()\n\nlet first = iterator.next()  \/\/ { value: 1, done: false }\nlet second = iterator.next() \/\/ { value: 3, done: false }\nlet third = iterator.next()  \/\/ { value: 5, done: true  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e * \x3cspan class=\x22hljs-title\x22\x3eoddGenerator\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e iterator = oddGenerator()\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e first = iterator.next()  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { value: 1, done: false }\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e second = iterator.next() \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { value: 3, done: false }\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e third = iterator.next()  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { value: 5, done: true  }\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3enext的参数传递\x3c\/h3\x3e\n\x3cp\x3e我们可以在调用\x3ccode\x3enext()\x3c\/code\x3e的时候传递一个参数，可以在上次\x3ccode\x3eyield\x3c\/code\x3e前接收到这个参数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function * outputGenerator () {\n  let ret1 = yield 1\n  console.log(`got ret1: ${ret1}`)\n  let ret2 = yield 2\n  console.log(`got ret2: ${ret2}`)\n}\n\nlet iterator = outputGenerator()\n\niterator.next(1)\niterator.next(2) \/\/ got ret1: 2\niterator.next(3) \/\/ got ret2: 3\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e * \x3cspan class=\x22hljs-title\x22\x3eoutputGenerator\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ret1 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`got ret1: \x3cspan class=\x22hljs-subst\x22\x3e${ret1}\x3c\/span\x3e`\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ret2 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`got ret2: \x3cspan class=\x22hljs-subst\x22\x3e${ret2}\x3c\/span\x3e`\x3c\/span\x3e)\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e iterator = outputGenerator()\n\niterator.next(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\niterator.next(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ got ret1: 2\x3c\/span\x3e\niterator.next(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ got ret2: 3\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第一眼看上去可能会有些诡异，为什么第一条\x3ccode\x3elog\x3c\/code\x3e是在第二次调用\x3ccode\x3enext\x3c\/code\x3e时才进行输出的  \x3cbr\x3e这就又要说到上边的\x3ccode\x3eGenerator\x3c\/code\x3e的实现了，上边说到了，\x3ccode\x3eyield\x3c\/code\x3e与\x3ccode\x3ereturn\x3c\/code\x3e都是用来返回值的语法。  \x3cbr\x3e函数在执行时遇到这两个关键字后就会暂停执行，等待下次激活。  \x3cbr\x3e然后\x3ccode\x3elet ret1 = yield 1\x3c\/code\x3e，这是一个赋值表达式，也就是说会先执行\x3ccode\x3e=\x3c\/code\x3e右边的部分，在\x3ccode\x3e=\x3c\/code\x3e右边执行的过程中遇到了\x3ccode\x3eyield\x3c\/code\x3e关键字，函数也就在此处暂停了，在下次触发\x3ccode\x3enext()\x3c\/code\x3e时才被激活，此时，我们继续进行上次未完成的赋值语句\x3ccode\x3elet ret1 = XXX\x3c\/code\x3e，并在再次遇到\x3ccode\x3eyield\x3c\/code\x3e时暂停。  \x3cbr\x3e这也就解释了为什么\x3cstrong\x3e第二次调用\x3ccode\x3enext()\x3c\/code\x3e的参数\x3c\/strong\x3e会被\x3cstrong\x3e第一次\x3ccode\x3eyield\x3c\/code\x3e赋值的变量接收到\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e用作迭代器使用\x3c\/h3\x3e\n\x3cp\x3e因为\x3ccode\x3eGenerator\x3c\/code\x3e对象是一个迭代器，所以我们可以直接用于\x3ccode\x3efor of\x3c\/code\x3e循环：\x3c\/p\x3e\n\x3cblockquote\x3e但是要注意的是，用作迭代器中的使用，则只会作用于\x3ccode\x3eyield\x3c\/code\x3e  \x3cbr\x3e\x3ccode\x3ereturn\x3c\/code\x3e的返回值不计入迭代\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function * oddGenerator () {\n  yield 1\n  yield 3\n  yield 5\n\n  return \x27won\\\x27t be iterate\x27\n}\n\nfor (let value of oddGenerator()) {\n  console.log(value)\n}\n\/\/ \x3e 1\n\/\/ \x3e 3\n\/\/ \x3e 5\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e * \x3cspan class=\x22hljs-title\x22\x3eoddGenerator\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27won\\\x27t be iterate\x27\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e oddGenerator()) {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value)\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; 1\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; 3\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; 5\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eGenerator函数内部的Generator\x3c\/h3\x3e\n\x3cp\x3e除了\x3ccode\x3eyield\x3c\/code\x3e语法以外，其实还有一个\x3ccode\x3eyield*\x3c\/code\x3e语法，可以粗略的理解为是\x3ccode\x3eGenerator\x3c\/code\x3e函数版的\x3ccode\x3e[...]\x3c\/code\x3e  \x3cbr\x3e用来展开\x3ccode\x3eGenerator\x3c\/code\x3e迭代器的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function * gen1 () {\n  yield 1\n  yield* gen2()\n  yield 5\n}\n\nfunction * gen2 () {\n  yield 2\n  yield 3\n  yield 4\n  return \x27won\\\x27t be iterate\x27\n}\n\nfor (let value of gen1()) {\n  console.log(value)\n}\n\/\/ \x3e 1\n\/\/ \x3e 2\n\/\/ \x3e 3\n\/\/ \x3e 4\n\/\/ \x3e 5\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e * \x3cspan class=\x22hljs-title\x22\x3egen1\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e* gen2()\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e * \x3cspan class=\x22hljs-title\x22\x3egen2\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27won\\\x27t be iterate\x27\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e gen1()) {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value)\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; 1\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; 2\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; 3\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; 4\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; 5\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e模拟实现Promise执行器\x3c\/h3\x3e\n\x3cp\x3e然后我们结合着\x3ccode\x3ePromise\x3c\/code\x3e，来实现一个简易的执行器。\x3c\/p\x3e\n\x3cblockquote\x3e最受欢迎的类似的库是： \x3ca href=\x22https:\/\/www.npmjs.com\/package\/co\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eco\x3c\/a\x3e\n\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function run (gen) {\n  gen = gen()\n  return next(gen.next())\n\n  function next ({done, value}) {\n    return new Promise(resolve =\x3e {\n     if (done) { \/\/ finish\n       resolve(value)\n     } else { \/\/ not yet\n       value.then(data =\x3e {\n         next(gen.next(data)).then(resolve)\n       })\n     }\n   })\n  }\n}\n\nfunction getRandom () {\n  return new Promise(resolve =\x3e {\n    setTimeout(_ =\x3e resolve(Math.random() * 10 | 0), 1000)\n  })\n}\n\nfunction * main () {\n  let num1 = yield getRandom()\n  let num2 = yield getRandom()\n\n  return num1 \x2b num2\n}\n\nrun(main).then(data =\x3e {\n  console.log(`got data: ${data}`);\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erun\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3egen\x3c\/span\x3e) \x3c\/span\x3e{\n  gen = gen()\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(gen.next())\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enext\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e{done, value}\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n     \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (done) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ finish\x3c\/span\x3e\n       resolve(value)\n     } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ not yet\x3c\/span\x3e\n       value.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n         next(gen.next(data)).then(resolve)\n       })\n     }\n   })\n  }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetRandom\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e_\x3c\/span\x3e =\x26gt;\x3c\/span\x3e resolve(\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e | \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e), \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n  })\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e * \x3cspan class=\x22hljs-title\x22\x3emain\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e num1 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e getRandom()\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e num2 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e getRandom()\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num1 \x2b num2\n}\n\nrun(main).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`got data: \x3cspan class=\x22hljs-subst\x22\x3e${data}\x3c\/span\x3e`\x3c\/span\x3e);\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e一个简单的解释器的模拟（仅作举例说明）\x3c\/blockquote\x3e\n\x3cp\x3e在例子中，我们约定\x3ccode\x3eyield\x3c\/code\x3e后边的必然是一个\x3ccode\x3ePromise\x3c\/code\x3e函数  \x3cbr\x3e我们只看\x3ccode\x3emain()\x3c\/code\x3e函数的代码，使用\x3ccode\x3eGenerator\x3c\/code\x3e确实能够让我们让近似同步的方式来编写异步代码  \x3cbr\x3e但是，这样写就意味着我们必须有一个外部函数负责帮我们执行\x3ccode\x3emain()\x3c\/code\x3e函数这个\x3ccode\x3eGenerator\x3c\/code\x3e，并处理其中生成的\x3ccode\x3ePromise\x3c\/code\x3e，然后在\x3ccode\x3ethen\x3c\/code\x3e回调中将结果返回到\x3ccode\x3eGenerator\x3c\/code\x3e函数，以便可以执行下边的代码。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3eAsync\x3c\/h2\x3e\n\x3cp\x3e我们使用\x3ccode\x3easync\x3c\/code\x3e\/\x3ccode\x3eawait\x3c\/code\x3e来重写上边的\x3ccode\x3eGenerator\x3c\/code\x3e例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function getRandom () {\n  return new Promise(resolve =\x3e {\n    setTimeout(_ =\x3e resolve(Math.random() * 10 | 0), 1000)\n  })\n}\n\nasync function main () {\n  let num1 = await getRandom()\n  let num2 = await getRandom()\n\n  return num1 \x2b num2\n}\n\nconsole.log(`got data: ${await main()}`)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetRandom\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e_\x3c\/span\x3e =\x26gt;\x3c\/span\x3e resolve(\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e | \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e), \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n  })\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emain\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e num1 = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getRandom()\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e num2 = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getRandom()\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num1 \x2b num2\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`got data: \x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e main()}\x3c\/span\x3e`\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样看上去，好像我们从\x3ccode\x3eGenerator\x3c\/code\x3e\/\x3ccode\x3eyield\x3c\/code\x3e换到\x3ccode\x3easync\x3c\/code\x3e\/\x3ccode\x3eawait\x3c\/code\x3e只需要把\x3ccode\x3e*\x3c\/code\x3e都改为\x3ccode\x3easync\x3c\/code\x3e，\x3ccode\x3eyield\x3c\/code\x3e都改为\x3ccode\x3eawait\x3c\/code\x3e就可以了。\x3cbr\x3e所以很多人都直接拿\x3ccode\x3eGenerator\x3c\/code\x3e\/\x3ccode\x3eyield\x3c\/code\x3e来解释\x3ccode\x3easync\x3c\/code\x3e\/\x3ccode\x3eawait\x3c\/code\x3e的行为，但这会带来如下几个问题：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3ccode\x3eGenerator\x3c\/code\x3e有其他的用途，而不仅仅是用来帮助你处理\x3ccode\x3ePromise\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e这样的解释让那些不熟悉这两者的人理解起来更困难（因为你还要去解释那些类似\x3ccode\x3eco\x3c\/code\x3e的库）\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3e\n\x3ccode\x3easync\x3c\/code\x3e\/\x3ccode\x3eawait\x3c\/code\x3e是处理\x3ccode\x3ePromise\x3c\/code\x3e的一个极其方便的方法，但如果使用不当的话，也会造成一些令人头疼的问题\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eAsync函数始终返回一个Promise\x3c\/h3\x3e\n\x3cp\x3e一个\x3ccode\x3easync\x3c\/code\x3e函数，无论你\x3ccode\x3ereturn 1\x3c\/code\x3e或者\x3ccode\x3ethrow new Error()\x3c\/code\x3e。  \x3cbr\x3e在调用方来讲，接收到的始终是一个\x3ccode\x3ePromise\x3c\/code\x3e对象：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22async function throwError () {\n  throw new Error()\n}\nasync function returnNumber () {\n  return 1\n}\n\nconsole.log(returnNumber() instanceof Promise) \/\/ true\nconsole.log(throwError() instanceof Promise)   \/\/ true\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ethrowError\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e()\n}\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereturnNumber\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(returnNumber() \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ true\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(throwError() \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e)   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ true\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e也就是说，无论函数是做什么用的，你都要按照\x3ccode\x3ePromise\x3c\/code\x3e的方式来处理它。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eAwait是按照顺序执行的，并不能并行执行\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3eJavaScript\x3c\/code\x3e是单线程的，这就意味着\x3ccode\x3eawait\x3c\/code\x3e一只能一次处理一个，如果你有多个\x3ccode\x3ePromise\x3c\/code\x3e需要处理，则就意味着，你要等到前一个\x3ccode\x3ePromise\x3c\/code\x3e处理完成才能进行下一个的处理，这就意味着，如果我们同时发送大量的请求，这样处理就会非常慢，\x3ccode\x3eone by one\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const bannerImages = []\n\nasync function getImageInfo () {\n  return bannerImages.map(async banner =\x3e await getImageInfo(banner))\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e bannerImages = []\n\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetImageInfo\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e bannerImages.map(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e banner =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getImageInfo(banner))\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e就像这样的四个定时器，我们需要等待\x3ccode\x3e4s\x3c\/code\x3e才能执行完毕：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function delay () {\n  return new Promise(resolve =\x3e setTimeout(resolve, 1000))\n}\n\nlet tasks = [1, 2, 3, 4]\n\nasync function runner (tasks) {\n  for (let task of tasks) {\n    await delay()\n  }\n}\n\nconsole.time(\x27runner\x27)\nawait runner(tasks)\nconsole.timeEnd(\x27runner\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edelay\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e setTimeout(resolve, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e))\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e tasks = [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e]\n\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erunner\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3etasks\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e task \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e tasks) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e delay()\n  }\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.time(\x3cspan class=\x22hljs-string\x22\x3e\x27runner\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e runner(tasks)\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.timeEnd(\x3cspan class=\x22hljs-string\x22\x3e\x27runner\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e像这种情况，我们可以进行如下优化：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function delay () {\n  return new Promise(resolve =\x3e setTimeout(resolve, 1000))\n}\n\nlet tasks = [1, 2, 3, 4]\n\nasync function runner (tasks) {\n  tasks = tasks.map(delay)\n  await Promise.all(tasks)\n}\n\nconsole.time(\x27runner\x27)\nawait runner(tasks)\nconsole.timeEnd(\x27runner\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edelay\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e setTimeout(resolve, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e))\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e tasks = [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e]\n\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erunner\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3etasks\x3c\/span\x3e) \x3c\/span\x3e{\n  tasks = tasks.map(delay)\n  \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all(tasks)\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.time(\x3cspan class=\x22hljs-string\x22\x3e\x27runner\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e runner(tasks)\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.timeEnd(\x3cspan class=\x22hljs-string\x22\x3e\x27runner\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e草案中提到过\x3ccode\x3eawait*\x3c\/code\x3e，但现在貌似还不是标准，所以还是采用\x3ccode\x3ePromise.all\x3c\/code\x3e包裹一层的方法来实现\x3c\/blockquote\x3e\n\x3cp\x3e我们知道，\x3ccode\x3ePromise\x3c\/code\x3e对象在创建时就会执行函数内部的代码，也就意味着，在我们使用\x3ccode\x3emap\x3c\/code\x3e创建这个数组时，所有的\x3ccode\x3ePromise\x3c\/code\x3e代码都会执行，也就是说，所有的请求都会同时发出去，然后我们通过\x3ccode\x3eawait Promise.all\x3c\/code\x3e来监听所有\x3ccode\x3ePromise\x3c\/code\x3e的响应。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e结论\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3eGenerator\x3c\/code\x3e与\x3ccode\x3easync function\x3c\/code\x3e都是返回一个特定类型的对象：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3ccode\x3eGenerator\x3c\/code\x3e: 一个类似\x3ccode\x3e{ value: XXX, done: true }\x3c\/code\x3e这样结构的\x3ccode\x3eObject\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eAsync\x3c\/code\x3e: 始终返回一个\x3ccode\x3ePromise\x3c\/code\x3e，使用\x3ccode\x3eawait\x3c\/code\x3e或者\x3ccode\x3e.then()\x3c\/code\x3e来获取返回值\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3ccode\x3eGenerator\x3c\/code\x3e是属于生成器，一种特殊的迭代器，用来解决异步回调问题感觉有些不务正业了。。\x3cbr\x3e而\x3ccode\x3easync\x3c\/code\x3e则是为了更简洁的使用\x3ccode\x3ePromise\x3c\/code\x3e而提出的语法，相比\x3ccode\x3eGenerator \x2b co\x3c\/code\x3e这种的实现方式，更为专注，生来就是为了处理异步编程。\x3c\/p\x3e\n\x3cp\x3e现在已经是\x3ccode\x3e2018\x3c\/code\x3e年了，\x3ccode\x3easync\x3c\/code\x3e也是用了好久，就让\x3ccode\x3eGenerator\x3c\/code\x3e去做他该做的事情吧。。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e参考资料\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/medium.com\/front-end-hacking\/modern-javascript-and-asynchronous-programming-generators-yield-vs-async-await-550275cbe433\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emodern-javascript-and-asynchronous-programming-generators-yield-vs-async-await\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/2ality.com\/2016\/10\/async-function-tips.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3easync-function-tips\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e示例代码：\x3ca href=\x22https:\/\/github.com\/Jiasm\/code-demo-resource\/tree\/master\/generator-async\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecode-resource\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JavaScript异步编程：Generator与Async</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014747477">https://segmentfault.com/a/1190000014747477</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/e2be1eha10r/" target="_blank">https://alili.tech/archive/e2be1eha10r/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>