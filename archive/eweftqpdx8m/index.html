<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="一块小饼干(Cookie)的故事-上篇"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>一块小饼干(Cookie)的故事-上篇 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/eweftqpdx8m/",
				"appid": "1613049289050283", 
				"title": "一块小饼干(Cookie)的故事-上篇 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-14T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/e90bnxu6bmu/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/i9f8gg837si/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2feweftqpdx8m%2f&text=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8a%e7%af%87"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2feweftqpdx8m%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2feweftqpdx8m%2f&text=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8a%e7%af%87"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2feweftqpdx8m%2f&title=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8a%e7%af%87"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2feweftqpdx8m%2f&is_video=false&description=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8a%e7%af%87"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8a%e7%af%87&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2feweftqpdx8m%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2feweftqpdx8m%2f&title=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8a%e7%af%87"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2feweftqpdx8m%2f&title=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8a%e7%af%87"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2feweftqpdx8m%2f&title=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8a%e7%af%87"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2feweftqpdx8m%2f&title=%e4%b8%80%e5%9d%97%e5%b0%8f%e9%a5%bc%e5%b9%b2%28Cookie%29%e7%9a%84%e6%95%85%e4%ba%8b-%e4%b8%8a%e7%af%87"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">一块小饼干(Cookie)的故事-上篇</h1><div class="meta"><div class="postdate"><time datetime="2018-12-14" itemprop="datePublished">2018-12-14</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3ecookie 如果非要用汉语理解的话应该是 一段小型文本文件，由网景的创始人之一的\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/%E7%9B%A7%C2%B7%E8%92%99%E7%89%B9%E5%88%A9\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e卢 蒙特利\x3c\/a\x3e在93年发明。\x3cp\x3e上篇是熟悉一下注册的大致流程，下篇熟悉登录流程以及真正的Cookie\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e实现基本的注册功能\x3c\/h2\x3e\n\x3cp\x3e我们打开网站，浏览网站，最常见的两个操作就是注册以及登录，所以有必要探索一下这两个功能如何实现的。\x3c\/p\x3e\n\x3cp\x3e本地模拟，当输入\x3ccode\x3elocalhost:8080\/sign_up\x3c\/code\x3e的时候，浏览器发起\x3ccode\x3eget\x3c\/code\x3e请求，服务器给你响应\x3ccode\x3esign_up.html\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/服务器端代码\nif (path === \x27\/sign_up\x27 \x26amp;\x26amp; method === \x27GET\x27) {\n    let string = fs.readFileSync(\x27.\/sign_up.html\x27, \x27utf8\x27)\n    response.statusCode = 200\n    response.setHeader(\x27Content-Type\x27, \x27text\/html;charset=utf-8\x27)\n    response.write(string)\n    response.end()\n }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/服务器端代码\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (path === \x3cspan class=\x22hljs-string\x22\x3e\x27\/sign_up\x27\x3c\/span\x3e \x26amp;\x26amp; method === \x3cspan class=\x22hljs-string\x22\x3e\x27GET\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e string = fs.readFileSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/sign_up.html\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27utf8\x27\x3c\/span\x3e)\n    response.statusCode = \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e\n    response.setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27text\/html;charset=utf-8\x27\x3c\/span\x3e)\n    response.write(string)\n    response.end()\n }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3eCSS布局的几个小坑\x3c\/h3\x3e\n\x3cp\x3e在写\x3ccode\x3esign_up.html\x3c\/code\x3e的时候，注意几点css知识：\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e如果想让你的登录页面的body占满整个屏幕，随着窗口的大小变化而变化的话，可以写\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22body, html{height: 100%}\n\/\/或者\nbody{min-height: 100%}\nhtml{height: 100%}\n\/\/不能这么写\nbody, html{min-height: 100%}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22css hljs\x22\x3e\x3ccode class=\x22css\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-tag\x22\x3ehtml\x3c\/span\x3e{\x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e}\n\/\/或者\n\x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e{\x3cspan class=\x22hljs-attribute\x22\x3emin-height\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e}\n\x3cspan class=\x22hljs-selector-tag\x22\x3ehtml\x3c\/span\x3e{\x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e}\n\/\/不能这么写\n\x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-tag\x22\x3ehtml\x3c\/span\x3e{\x3cspan class=\x22hljs-attribute\x22\x3emin-height\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100%\x3c\/span\x3e}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当然了，实际上这么写就可以了\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22body{min-height: 100vh}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22css hljs\x22\x3e\x3ccode class=\x22css\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e{\x3cspan class=\x22hljs-attribute\x22\x3emin-height\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100vh\x3c\/span\x3e}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\x3cli\x3e\n\x3ccode\x3elabel\x3c\/code\x3e标签是\x3ccode\x3edisplay: inline\x3c\/code\x3e，不能设置宽度，\x3cstrong\x3e行内元素则会根据行内内容自适应宽度\x3c\/strong\x3e，所以行内元素设置width是没有效果的。改成\x3ccode\x3einline-block就可以了\x3c\/code\x3e\n\x3c\/li\x3e\x3c\/ol\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013231822?w=709\x26amp;h=581\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013231822?w=709\x26amp;h=581\x22 alt=\x22很丑的界面的\x22 title=\x22很丑的界面的\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e获得用户的数据\x3c\/h3\x3e\n\x3cp\x3e既然是注册的需求，那么我们首要关注的点就是--用户的注册信息我们如何获得呢\x3c\/p\x3e\n\x3cp\x3e选择合理的数据结构存储数据是很重要的。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e每个\x3ccode\x3einput\x3c\/code\x3e的\x3ccode\x3ename\x3c\/code\x3e可以使用数组存储\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3einput\x3c\/code\x3e的\x3ccode\x3evalue\x3c\/code\x3e应该使用\x3ccode\x3ehash\x3c\/code\x3e,也就是对象来存储。\x3c\/li\x3e\n\x3cli\x3e上述的套路会一直用下去，\x3cstrong\x3e\x3ccode\x3ehash\x2b[]\x3c\/code\x3e\x3c\/strong\x3e的组合。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/使用jq来写\nlet hash = {}\nlet $form = $(\x27#signUpForm\x27)\n$form.on(\x27submit\x27, (e) =\x3e {\n  e.preventDefault() \/\/不用form表单的默认提交，而是使用我们的的ajax提交\n  let need = [\x27email\x27, \x27password\x27, \x27password_confirmation\x27]\n  need.forEach((name) =\x3e {\n  let value = $form.find(`[name=${name}]`).val()\n  hash[name] = value\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/使用jq来写\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e hash = {}\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e $form = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#signUpForm\x27\x3c\/span\x3e)\n$form.on(\x3cspan class=\x22hljs-string\x22\x3e\x27submit\x27\x3c\/span\x3e, (e) =\x26gt; {\n  e.preventDefault() \x3cspan class=\x22hljs-comment\x22\x3e\/\/不用form表单的默认提交，而是使用我们的的ajax提交\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e need = [\x3cspan class=\x22hljs-string\x22\x3e\x27email\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27password\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27password_confirmation\x27\x3c\/span\x3e]\n  need.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ename\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value = $form.find(\x3cspan class=\x22hljs-string\x22\x3e`[name=\x3cspan class=\x22hljs-subst\x22\x3e${name}\x3c\/span\x3e]`\x3c\/span\x3e).val()\n  hash[name] = value\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最终\x3ccode\x3ehash\x3c\/code\x3e里面存储的就是\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x27email\x27: \x27...\x27,\n  \x27password\x27: \x27...\x27,\n  \x27password_confirmation\x27: \x27...\x27\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-string\x22\x3e\x27email\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27password\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27password_confirmation\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e到目前为止我们把用户的数据封装到了一个对象里面了。\x3c\/p\x3e\n\x3cp\x3e不过在把hash用ajax发出去之前要先进行一些必要的非空验证\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e非空验证\x3c\/h3\x3e\n\x3cp\x3e主要是检测邮箱是否为空、密码是否为空、两次输入的密码是否一致。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/发起请求之前验证是否为空\nif (hash[\x27email\x27] === \x27\x27) {\n  $form.find(\x27[name=\x26quot;email\x26quot;]\x27).siblings(\x27.errors\x27).text(\x27请您输入邮箱\x27)\n  return false \/\/精髓啊，不然没用了\n}\nif (hash[\x27password\x27] === \x27\x27) {\n  $form.find(\x27[name=\x26quot;password\x26quot;]\x27).siblings(\x27.errors\x27).text(\x27请您输入密码\x27)\n  return false \/\/精髓啊，不然没用了\n}\nif (hash[\x27password_confirmation\x27] === \x27\x27) {\n    $form.find(\x27[name=\x26quot;password_confirmation\x26quot;]\x27).siblings(\x27.errors\x27).text(\x27请您再次输入确认密码\x27)\n    return false \/\/精髓啊，不然没用了\n}\nif (hash[\x27password\x27] !== hash[\x27password_confirmation\x27]) {\n  $form.find(\x27[name=\x26quot;password_confirmation\x26quot;]\x27).siblings(\x27.errors\x27).text(\x27两次输入密码不匹配\x27)\n  return false \/\/精髓啊，不然没用了\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/发起请求之前验证是否为空\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hash[\x3cspan class=\x22hljs-string\x22\x3e\x27email\x27\x3c\/span\x3e] === \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e) {\n  $form.find(\x3cspan class=\x22hljs-string\x22\x3e\x27[name=\x22email\x22]\x27\x3c\/span\x3e).siblings(\x3cspan class=\x22hljs-string\x22\x3e\x27.errors\x27\x3c\/span\x3e).text(\x3cspan class=\x22hljs-string\x22\x3e\x27请您输入邮箱\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/精髓啊，不然没用了\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hash[\x3cspan class=\x22hljs-string\x22\x3e\x27password\x27\x3c\/span\x3e] === \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e) {\n  $form.find(\x3cspan class=\x22hljs-string\x22\x3e\x27[name=\x22password\x22]\x27\x3c\/span\x3e).siblings(\x3cspan class=\x22hljs-string\x22\x3e\x27.errors\x27\x3c\/span\x3e).text(\x3cspan class=\x22hljs-string\x22\x3e\x27请您输入密码\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/精髓啊，不然没用了\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hash[\x3cspan class=\x22hljs-string\x22\x3e\x27password_confirmation\x27\x3c\/span\x3e] === \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e) {\n    $form.find(\x3cspan class=\x22hljs-string\x22\x3e\x27[name=\x22password_confirmation\x22]\x27\x3c\/span\x3e).siblings(\x3cspan class=\x22hljs-string\x22\x3e\x27.errors\x27\x3c\/span\x3e).text(\x3cspan class=\x22hljs-string\x22\x3e\x27请您再次输入确认密码\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/精髓啊，不然没用了\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hash[\x3cspan class=\x22hljs-string\x22\x3e\x27password\x27\x3c\/span\x3e] !== hash[\x3cspan class=\x22hljs-string\x22\x3e\x27password_confirmation\x27\x3c\/span\x3e]) {\n  $form.find(\x3cspan class=\x22hljs-string\x22\x3e\x27[name=\x22password_confirmation\x22]\x27\x3c\/span\x3e).siblings(\x3cspan class=\x22hljs-string\x22\x3e\x27.errors\x27\x3c\/span\x3e).text(\x3cspan class=\x22hljs-string\x22\x3e\x27两次输入密码不匹配\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/精髓啊，不然没用了\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\n\x3cli\x3e如果忘记写return的话，即使你为空了还是会直接越过这一步检测，去发起ajax请求的，所以一定不要忘了写上return false.\x3c\/li\x3e\n\x3cli\x3e如果仅仅这么写的话会有一个bug。当出现错误提示后，你把信息填对了，错误信息依然显示，这显然是不合理的。应该填入信息后，错误信息就消失的。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013231823?w=562\x26amp;h=270\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013231823?w=562\x26amp;h=270\x22 alt=\x22bug\x22 title=\x22bug\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 $form.find(\x27.errors\x27).each((index, span) =\x3e {\n     $(span).text(\x27\x27)\n }) \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e $form.find(\x3cspan class=\x22hljs-string\x22\x3e\x27.errors\x27\x3c\/span\x3e).each(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eindex, span\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n     $(span).text(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)\n }) \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用上述的jq代码来解决这个bug即可。\x3c\/p\x3e\n\x3cp\x3e非空验证完了之后，意味着浏览器收集用户数据的工作完成了，可以把hash发到服务器端了，接下来就是ajax请求了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e使用ajax提交数据\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$.post(\x27\/sign_up\x27, hash)\n.then((response) =\x3e {\n  \/\/成功了就打印这个  \n  console.log(response)\n},\n() =\x3e {\n  \/\/错误了打印这个\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/sign_up\x27\x3c\/span\x3e, hash)\n.then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/成功了就打印这个  \x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(response)\n},\n() =\x26gt; {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/错误了打印这个\x3c\/span\x3e\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e服务器端解析formData\x3c\/h3\x3e\n\x3cp\x3e因为formData是一段一段上传的(具体原因略复杂，可以取极限法，如果formdata很多，不可能一下子上传过来)，自己不会写，就去搜索代码片段解析formdata\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3egoogle: node get post data\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e把获得的代码封装成了一个函数\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function readBody(request) {\n  return new Promise((resolve, reject) =\x3e {\n      let body = []\n      request.on(\x27data\x27, (chunk) =\x3e {\n        body.push(chunk)\n      }).on(\x27end\x27, () =\x3e {\n        body = Buffer.concat(body).toString();\n          resolve(body)\n      })\n    }\n  )\n\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereadBody\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e body = []\n      request.on(\x3cspan class=\x22hljs-string\x22\x3e\x27data\x27\x3c\/span\x3e, (chunk) =\x26gt; {\n        body.push(chunk)\n      }).on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e, () =\x26gt; {\n        body = Buffer.concat(body).toString();\n          resolve(body)\n      })\n    }\n  )\n\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如何使用上述代码片段呢\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22...\nif (path === \x27\/sign_up\x27 \x26amp;\x26amp; method === \x27POST\x27) {\n    readBody(request).then((body) =\x3e {\n      let strings = body.split(\x27\x26amp;\x27) \/\/[\x27email=1\x27, \x27password=2\x27, \x27password_confirmmation=3\x27]\n      let hash = {}\n      strings.forEach(string =\x3e {\n        \/\/想得到类似这种的 string == \x27email=1\x27\n        let parts = string.split(\x27=\x27) \/\/再用=分割,得到[\x27email\x27, \x271\x27]\n        let key = parts[0]\n        let value = parts[1]\n        hash[key] = decodeURIComponent(value)\/\/hash[\x27email\x27] = \x271\x27\n      })\n      let {email, password, password_confirmation} = hash \/\/ES6的解构赋值\n  }\n  ...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e...\nif (path === \x3cspan class=\x22hljs-string\x22\x3e\x27\/sign_up\x27\x3c\/span\x3e \x26amp;\x26amp; method === \x3cspan class=\x22hljs-string\x22\x3e\x27POST\x27\x3c\/span\x3e) {\n    readBody(request).then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ebody\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e strings = body.split(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/[\x27email=1\x27, \x27password=2\x27, \x27password_confirmmation=3\x27]\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e hash = {}\n      strings.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estring\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/想得到类似这种的 string == \x27email=1\x27\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e parts = string.split(\x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/再用=分割,得到[\x27email\x27, \x271\x27]\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key = parts[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value = parts[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n        hash[key] = \x3cspan class=\x22hljs-built_in\x22\x3edecodeURIComponent\x3c\/span\x3e(value)\x3cspan class=\x22hljs-comment\x22\x3e\/\/hash[\x27email\x27] = \x271\x27\x3c\/span\x3e\n      })\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {email, password, password_confirmation} = hash \x3cspan class=\x22hljs-comment\x22\x3e\/\/ES6的解构赋值\x3c\/span\x3e\n  }\n  ...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当服务器端接收到了所有的formdata数据后，其实是一串形如\x3ccode\x3eemail=1\x26amp;password=2\x26amp;password_confirmation=3\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e的字符串，所以我们考虑使用\x3ccode\x3e\x26amp;\x3c\/code\x3e字符分割成数组。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e得到一个形如\x3ccode\x3e[\x27email=1\x27, \x27password=2\x27, \x27confirmation=3\x27]\x3c\/code\x3e的数组之后，我们为了得到\x3ccode\x3estring = \x27email=1\x27\x3c\/code\x3e这种形式的，开始遍历数组，把数组的每个元素按照\x3ccode\x3e=\x3c\/code\x3e分割，得到 \x3ccode\x3e[email, 1]\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e用第二小节提供的\x3ccode\x3ehash\x2b[]\x3c\/code\x3e方法，处理成hash\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e服务器端简单的校验\x3c\/h2\x3e\n\x3cp\x3e既然服务器端已经获得了\x3ccode\x3eformdata\x3c\/code\x3e了，那么应该进行一下简单的校验，比如邮箱的格式，没有问题了就把数据存到数据库里面。(目前校验水平很入门，没有涉及到完备的注册校验功能)\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e校验前的准备工作\x3c\/h3\x3e\n\x3cp\x3e上一节我们把formdata完美的封装到了hash里面，为了校验我们要把hash再拆开一个一个的看\x3c\/p\x3e\n\x3cp\x3e或许这么做是最直接的\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let email = hash[\x27emai\x27]\nlet password = hash[\x27password\x27]\nlet password_confirmation = hash[\x27password_confirmation\x27]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e email = hash[\x3cspan class=\x22hljs-string\x22\x3e\x27emai\x27\x3c\/span\x3e]\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e password = hash[\x3cspan class=\x22hljs-string\x22\x3e\x27password\x27\x3c\/span\x3e]\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e password_confirmation = hash[\x3cspan class=\x22hljs-string\x22\x3e\x27password_confirmation\x27\x3c\/span\x3e]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e不过ES6提供了一种解构赋值的语法糖，很甜很贴心……\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let {email, password, password_confirmation} = hash\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {email, password, password_confirmation} = hash\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e由@编码引发的bug\x3c\/h3\x3e\n\x3cp\x3e好了，我们这一步就先看看邮箱格式是否正确。\x3c\/p\x3e\n\x3cp\x3e我是菜鸟级校验邮箱，看到了邮箱的独特标志---\x3ccode\x3e@\x3c\/code\x3e，最起码有这个标志才叫邮箱吧，也就是说没有这个标志，我就可以认为邮箱格式不对啊，翻译成代码就是\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (email.indexOf(\x27@\x27) === -1) {\n  response.statusCode = 400\n  response.write(\x27email is bad\x27) \/\/单引号只是为了标记这是一个字符串\n} \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (email.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27@\x27\x3c\/span\x3e) === \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n  response.statusCode = \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e\n  response.write(\x3cspan class=\x22hljs-string\x22\x3e\x27email is bad\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/单引号只是为了标记这是一个字符串\x3c\/span\x3e\n} \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e很好，目前来说，事情的发展都很正常，直到一个bug的到来。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013231824?w=563\x26amp;h=288\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013231824?w=563\x26amp;h=288\x22 alt=\x22正常的也报错了\x22 title=\x22正常的也报错了\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e一个合法的邮箱，却进入了非法邮箱处理的代码片段里面……\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013231825\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013231825\x22 alt=\x22很疑惑\x22 title=\x22很疑惑\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e毫无疑问，邮箱是合法的，代码也是合理的，那么出问题的必然是我，某个地方的理解有问题。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e找bug,把可能出错的代码片段分成几个区间，打log.\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22console.log(email.indexOf(\x27@\x27))\nconsole.log(email)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(email.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27@\x27\x3c\/span\x3e))\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(email)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013231826\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013231826\x22 alt=\x22真的是-1\x22 title=\x22真的是-1\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e没错，\x3ccode\x3eemail\x3c\/code\x3e这个字符串的\x3ccode\x3e@\x3c\/code\x3e索引真的是-1，可是我的邮箱写的明明有\x3ccode\x3e@\x3c\/code\x3e啊。\x3c\/p\x3e\n\x3cp\x3e为啥呢，接着又打印出了\x3ccode\x3eemail\x3c\/code\x3e的内容，终于真相大白了，\x3ccode\x3eemail\x3c\/code\x3e字符串里面真的没有\x3ccode\x3e@\x3c\/code\x3e，\x3c\/p\x3e\n\x3cp\x3e却发现了一串你没想到的\x3ccode\x3e%40\x3c\/code\x3e，(⊙v⊙)嗯，没错了，这就是我认为的那个\x3ccode\x3e@\x3c\/code\x3e的另一个形态。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e我在浏览器看到的只是浏览器想让我看到的东西而已，既然已经被浏览器处理了，那到了服务器端自然无法处理。\x3c\/li\x3e\n\x3cli\x3e那这个\x3ccode\x3e%40\x3c\/code\x3e哪来的呢\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3eGoogle走起，在\x3ca href=\x22https:\/\/www.w3schools.com\/tags\/ref_urlencode.asp\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ew3schools的HTML URL Encoding Reference\x3c\/a\x3e找到了解释(不是国内的w3school……)\x3c\/p\x3e\n\x3cblockquote\x3eURL encoding converts characters into a format that can be transmitted over the Internet.\x3c\/blockquote\x3e\n\x3cp\x3eURL编码把字符转化成了一种可以在互联网上传播的格式，也就是说，我在网页上看到的字符是被URL编码处理的结果。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e那接下来就去搞定什么是URL编码\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e搞定这个之前，文档先要让你明白啥是\x3ccode\x3eURL\x3c\/code\x3e\x3c\/p\x3e\n\x3cblockquote\x3eWeb browsers request pages from web servers by using a URL.\x3cp\x3eThe URL is the address of a web page, like: \x3cstrong\x3e\x3ca href=\x22https:\/\/www.w3schools.com.\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/www.w3schools.com.\x3c\/a\x3e\x3c\/strong\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3eWeb浏览器通过使用URL从Web服务器请求页面。 该网址是网页的地址，例如：https：\/\/www.w3schools.com。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e复习一下URL的组成6部分：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.baidu.com\/s?wd=hello\x26amp;rsv_spt=1#5\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/www.baidu.com\/s?wd=he...\x3c\/a\x3e 通过这个你就可以访问到一个 \x22唯一的\x22 网址\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e名字\x3c\/th\x3e\n\x3cth\x3e作用\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3ehttps:\x3c\/td\x3e\n\x3ctd\x3e协议\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ewww.baidu.com\x3c\/td\x3e\n\x3ctd\x3e域名\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\/s\x3c\/td\x3e\n\x3ctd\x3e路径\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ewd=hello\x26amp;rsv_spt=1\x3c\/td\x3e\n\x3ctd\x3e查询参数\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e#5\x3c\/td\x3e\n\x3ctd\x3e锚点\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e端口\x3c\/td\x3e\n\x3ctd\x3e默认80\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3chr\x3e\n\x3cp\x3e复习完了\x3ccode\x3eURL\x3c\/code\x3e，继续搞\x3ccode\x3eURL编码\x3c\/code\x3e\x3c\/p\x3e\n\x3cblockquote\x3eURLs can only be sent over the Internet using the \x3ca href=\x22https:\/\/www.w3schools.com\/charsets\/ref_html_ascii.asp\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eASCII character-set\x3c\/a\x3e.\x3cp\x3eSince URLs often contain characters outside the ASCII set, the URL has to be converted into a valid ASCII format.\x3c\/p\x3e\n\x3cp\x3eURL encoding replaces unsafe ASCII characters with a \x22%\x22 followed by two hexadecimal digits.\x3c\/p\x3e\n\x3cp\x3eURLs cannot contain spaces. URL encoding normally replaces a space with a plus (\x2b) sign or with %20.\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cul\x3e\n\x3cli\x3eURL只能用ASCII编码在互联网之间发送。\x3c\/li\x3e\n\x3cli\x3e既然URL通常包括ASCII字符编码集之外的字符(很明显嘛，ASCII码表太少)，所以URL必须转化成有效的ASCII格式。\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e这是重点\x3c\/strong\x3e，URL编码使用\x3ccode\x3e%\x3c\/code\x3e后面紧跟着两个16进制数字的编码格式来代替不安全的ASCII码表\x3c\/li\x3e\n\x3cli\x3eURL不能包括空格。所以URL编码通常使用\x2b号或者\x3ccode\x3e20%\x3c\/code\x3e来代替空格。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e继续往下翻，找到了\x3ccode\x3e%40\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013231827\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013231827\x22 alt=\x22@符号的解释\x22 title=\x22@符号的解释\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e所以要把\x3ccode\x3evalue\x3c\/code\x3e的值解码回去\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22hash[key] = decodeURIComponent(value)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3ehash[key] = \x3cspan class=\x22hljs-built_in\x22\x3edecodeURIComponent\x3c\/span\x3e(value)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3edecodeURIComponent()\x3c\/code\x3e 方法用于解码由 \x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/JavaScript\/Reference\/Global_Objects\/encodeURIComponent\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3eencodeURIComponent\x3c\/code\x3e\x3c\/a\x3e 方法或者其它类似方法编码的部分统一资源标识符（URI）。毕竟\x3ccode\x3eURL\x3c\/code\x3e属于\x3ccode\x3eURI\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e错误信息的提示方法\x3c\/h3\x3e\n\x3cp\x3e如果有了错，需要提示用户错了，后端写的代码，用户不一定看的懂，需要前端润色一下使用户看懂，或者前端和后端沟通一下，maybe后端脾气不好，前端也是暴脾气，所以应该选择一个前后端都要用的东西做桥梁，很明显\x3ccode\x3eJSON\x3c\/code\x3e是完美的候选人。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (email.indexOf(\x27@\x27) === -1) {\n  response.statusCode = 400\n  response.setHeader(\x27Content-Type\x27, \x27application\/json;charset=utf-8\x27) \/\/直接告诉浏览器我是json\n  response.write(`\n    {\n      \x26quot;errors\x26quot;: {\n      \x26quot;email\x26quot;: \x26quot;invalid\x26quot;\n      }\n    }\n  `)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (email.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27@\x27\x3c\/span\x3e) === \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n  response.statusCode = \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e\n  response.setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json;charset=utf-8\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/直接告诉浏览器我是json\x3c\/span\x3e\n  response.write(\x3cspan class=\x22hljs-string\x22\x3e`\n    {\n      \x22errors\x22: {\n      \x22email\x22: \x22invalid\x22\n      }\n    }\n  `\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这就合理多了，后台只管写个json给前台看，其他不管了，前台翻译一下给用户看喽～\x3c\/p\x3e\n\x3cp\x3e那么前台如何获得这个\x3ccode\x3ejson\x3c\/code\x3e呢\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$.post(\x27\/sign_up\x27, hash)\n.then((response) =\x3e {\n  \/\/成功了就打印这个  \n  console.log(response)\n},\n(request, b, c) =\x3e {\n   console.log(request)\n   console.log(b)\n   console.log(c)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/sign_up\x27\x3c\/span\x3e, hash)\n.then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/成功了就打印这个  \x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(response)\n},\n(request, b, c) =\x26gt; {\n   \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(request)\n   \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(b)\n   \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(c)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e忘记了错误函数里面的参数是啥了，那就都打印出来看看。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013231828?w=1063\x26amp;h=380\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013231828?w=1063\x26amp;h=380\x22 alt=\x22如果没用JSON的话\x22 title=\x22如果没用JSON的话\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以看到，如果没用JSON的话，request对象里面有一个后端写的responseText属性可以利用。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013231829?w=946\x26amp;h=533\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013231829?w=946\x26amp;h=533\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e设置了\x3ccode\x3eContent-Type:application\/json;charset=utf-8\x3c\/code\x3e之后，可以利用多出来的\x3ccode\x3eresponseJSON\x3c\/code\x3e属性，获得json的内容啊。\x3c\/p\x3e\n\x3cp\x3e最终失败函数里面写\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(request) =\x3e {\n  let {errors} = request.responseJSON    \n  if (errors.email \x26amp;\x26amp; errors.email === \x27invalid\x27) {\n    $form.find(\x27[name=\x26quot;email\x26quot;]\x27).siblings(\x27.errors\x27).text(\x27您输入的邮箱错啦\x27)\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e(request) =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {errors} = request.responseJSON    \n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (errors.email \x26amp;\x26amp; errors.email === \x3cspan class=\x22hljs-string\x22\x3e\x27invalid\x27\x3c\/span\x3e) {\n    $form.find(\x3cspan class=\x22hljs-string\x22\x3e\x27[name=\x22email\x22]\x27\x3c\/span\x3e).siblings(\x3cspan class=\x22hljs-string\x22\x3e\x27.errors\x27\x3c\/span\x3e).text(\x3cspan class=\x22hljs-string\x22\x3e\x27您输入的邮箱错啦\x27\x3c\/span\x3e)\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e校验邮箱是否已经存在了\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var users = fs.readFileSync(\x27.\/db\/users\x27, \x27utf8\x27)\ntry {\n  users = JSON.parse(users) \/\/[] JSON也支持数组\n} catch (exception) {\n  users = []\n}\nlet inUse = false\nfor (let i = 0; i \x3c users.length; i\x2b\x2b) {\n  let user = users[i]\n  if (user.email === email) {\n    inUse = true\n    break\n  }\n}\nif (inUse) {\n  response.statusCode = 400\n  response.setHeader(\x27Content-Type\x27, \x27application\/json;charset=utf-8\x27)\n  response.write(`\n    {\n      \x26quot;errors\x26quot;: {\n      \x26quot;email\x26quot;: \x26quot;inUse\x26quot;\n      }\n    }\n  `)\n} \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e users = fs.readFileSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/db\/users\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27utf8\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n  users = \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.parse(users) \x3cspan class=\x22hljs-comment\x22\x3e\/\/[] JSON也支持数组\x3c\/span\x3e\n} \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (exception) {\n  users = []\n}\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e inUse = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; users.length; i\x2b\x2b) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e user = users[i]\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (user.email === email) {\n    inUse = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e\n  }\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (inUse) {\n  response.statusCode = \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e\n  response.setHeader(\x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json;charset=utf-8\x27\x3c\/span\x3e)\n  response.write(\x3cspan class=\x22hljs-string\x22\x3e`\n    {\n      \x22errors\x22: {\n      \x22email\x22: \x22inUse\x22\n      }\n    }\n  `\x3c\/span\x3e)\n} \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e本文并没有使用真正意义上的数据库，只是使用了简单的db文件做数据库，其实就是存的数组，也就是users其实就是数组\x3ccode\x3e[]\x3c\/code\x3e。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e之所以使用了\x3ccode\x3etry{}catch(){}\x3c\/code\x3e，是因为一旦除了错，可以将其初始化为空数组，后续代码可以继续执行，可能并不严谨，不过本文是侧重了解注册的思路的。\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e同样的，如果邮箱已经存在了，就提示用户\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (errors.email \x26amp;\x26amp; errors.email === \x27inUse\x27) {\n    $form.find(\x27[name=\x26quot;email\x26quot;]\x27).siblings(\x27.errors\x27).text(\x27这个邮箱已被注册啦\x27)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (errors.email \x26amp;\x26amp; errors.email === \x3cspan class=\x22hljs-string\x22\x3e\x27inUse\x27\x3c\/span\x3e) {\n    $form.find(\x3cspan class=\x22hljs-string\x22\x3e\x27[name=\x22email\x22]\x27\x3c\/span\x3e).siblings(\x3cspan class=\x22hljs-string\x22\x3e\x27.errors\x27\x3c\/span\x3e).text(\x3cspan class=\x22hljs-string\x22\x3e\x27这个邮箱已被注册啦\x27\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3chr\x3e\n\x3cp\x3e后端校验必须很严格，因为可以通过\x3ccode\x3ecurl\x3c\/code\x3e越过前端的校验。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013231830?w=1352\x26amp;h=254\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013231830?w=1352\x26amp;h=254\x22 alt=\x22curl\x22 title=\x22curl\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013231831?w=1600\x26amp;h=864\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013231831?w=1600\x26amp;h=864\x22 alt=\x22使用curl发起请求\x22 title=\x22使用curl发起请求\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e把信息写入数据库\x3c\/h3\x3e\n\x3cp\x3e没有错误之后，就可以把信息写到数据库里面啦\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 users.push({email: email, password: password})\/\/是个对象啊\n var usersString = JSON.stringify(users)\n fs.writeFileSync(\x27.\/db\/users\x27, usersString)\n response.statusCode = 200\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e users.push({\x3cspan class=\x22hljs-attr\x22\x3eemail\x3c\/span\x3e: email, \x3cspan class=\x22hljs-attr\x22\x3epassword\x3c\/span\x3e: password})\x3cspan class=\x22hljs-comment\x22\x3e\/\/是个对象啊\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e usersString = \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(users)\n fs.writeFileSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/db\/users\x27\x3c\/span\x3e, usersString)\n response.statusCode = \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eusers实现是个对象，而对象是内存里面的东西，数据库里面应该存储的是字符串，所以用了\x3ccode\x3eJSON.stringify(users)\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e好啦，上篇注册篇结束啦，下篇讲一讲如何登录以及\x3ccode\x3eCookie\x3c\/code\x3e登场\x3c\/p\x3e\n\x3cp\x3e相关代码见\x3ca href=\x22https:\/\/github.com\/codevvvv9\/AJAXDemo_nodeJsServer\/blob\/master\/sign_up.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esign_up.html\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/codevvvv9\/AJAXDemo_nodeJsServer\/blob\/master\/server.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eserver.js\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>一块小饼干(Cookie)的故事-上篇</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013231817">https://segmentfault.com/a/1190000013231817</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/eweftqpdx8m/" target="_blank">https://alili.tech/archive/eweftqpdx8m/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>