<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="3D GIS 应用开发 —— 基于 Mapbox GL 的实践总结"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>3D GIS 应用开发 —— 基于 Mapbox GL 的实践总结 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ezp43zxff4/",
				"appid": "1613049289050283", 
				"title": "3D GIS 应用开发 —— 基于 Mapbox GL 的实践总结 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-02T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/yncddz4mg5f/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/ecghj2n0gph/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fezp43zxff4%2f&text=3D%20GIS%20%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%20%e2%80%94%e2%80%94%20%e5%9f%ba%e4%ba%8e%20Mapbox%20GL%20%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fezp43zxff4%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fezp43zxff4%2f&text=3D%20GIS%20%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%20%e2%80%94%e2%80%94%20%e5%9f%ba%e4%ba%8e%20Mapbox%20GL%20%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fezp43zxff4%2f&title=3D%20GIS%20%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%20%e2%80%94%e2%80%94%20%e5%9f%ba%e4%ba%8e%20Mapbox%20GL%20%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fezp43zxff4%2f&is_video=false&description=3D%20GIS%20%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%20%e2%80%94%e2%80%94%20%e5%9f%ba%e4%ba%8e%20Mapbox%20GL%20%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=3D%20GIS%20%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%20%e2%80%94%e2%80%94%20%e5%9f%ba%e4%ba%8e%20Mapbox%20GL%20%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fezp43zxff4%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fezp43zxff4%2f&title=3D%20GIS%20%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%20%e2%80%94%e2%80%94%20%e5%9f%ba%e4%ba%8e%20Mapbox%20GL%20%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fezp43zxff4%2f&title=3D%20GIS%20%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%20%e2%80%94%e2%80%94%20%e5%9f%ba%e4%ba%8e%20Mapbox%20GL%20%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fezp43zxff4%2f&title=3D%20GIS%20%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%20%e2%80%94%e2%80%94%20%e5%9f%ba%e4%ba%8e%20Mapbox%20GL%20%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fezp43zxff4%2f&title=3D%20GIS%20%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%20%e2%80%94%e2%80%94%20%e5%9f%ba%e4%ba%8e%20Mapbox%20GL%20%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">3D GIS 应用开发 —— 基于 Mapbox GL 的实践总结</h1><div class="meta"><div class="postdate"><time datetime="2019-01-02" itemprop="datePublished">2019-01-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e最近在折腾的 web 端的可视化项目，由于相关业务的需要，用到了 Mapbox 这一地图开发的神器。在此先奉上一个基于mapbox-gl实现的demo（来源：\x3ca href=\x22https:\/\/uber.github.io\/deck.gl\/#\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3euber的deck.gl项目\x3c\/a\x3e）：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012748416\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012748416\x22 alt=\x22demo\x22 title=\x22demo\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e下面我们从这个项目一步步来介绍 Mapbox 的前端 GIS 引擎\x26nbsp;\x3ca href=\x22https:\/\/github.com\/mapbox\/mapbox-gl-js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMapbox GL JS\x3c\/a\x3e.\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3e一、简单了解\x3c\/h1\x3e\n\x3cp\x3e首先，Mapbox 在地图领域是一家很 Newbee 的公司。已为 Foursquare、Pinterest、Evernote、金融时报、天气频道、优步科技 等公司的网站提供了订制在线地图服务。\x3c\/p\x3e\n\x3cp\x3e自2010年起，该公司快速地拓展了订制地图的市场地位，以回应 Google地图 等地图供应商提供的有限选择。Mapbox 是一些开放源代码地图库及应用程序的创建者或最大的贡献者，其中包含了MBTiles 规范、TileMill 制图 IDE、Leaflet JavaScript 库，以及 CartoCSS 地图格式化语言与语法分析器等。\x3c\/p\x3e\n\x3cp\x3e该公司的数据同时从开放与专有的来源获取，开放的数据源如 开放街图（OSM, Open Street Map） 以及 NASA 等，而专有的数据源则包含了 DigitalGlobe。其技术奠基于 Node.js、CouchDB、Mapnik、GDAL 与 Leafletjs。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010975074\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010975074\x22 alt=\x22Mapbox官网\x22 title=\x22Mapbox官网\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eMapbox 针对不同平台均开发了相应的 GIS 引擎以满足开发者或相关用户的需要，如：iOS SDK（用于iOS端开发）、Android SDK（用于Andriod端开发）、Navigation SDK（用于Navigation端开发）、Unity SDK（用于Unity端开发）、GL JS（用于web端开发）。不同平台的SDK，除使用方式不同外，功能特性上也多多少少存在不同。此外，Uber还针对react开发了\x26nbsp;\x3ca href=\x22https:\/\/github.com\/uber\/react-map-gl\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-map-gl\x3c\/a\x3e。总的来说，Mapbox的开源技术栈是非常全面的。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e二、轻松上手\x3c\/h1\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010975075\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010975075\x22 alt=\x22Mapbox文档\x22 title=\x22Mapbox文档\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3emapbox-gl 的 \x3ca href=\x22https:\/\/www.mapbox.com\/mapbox-gl-js\/api\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e文档\x3c\/a\x3e 由 API、Style Specification、Example、Plugins 四部分内容组成。\x3c\/p\x3e\n\x3cp\x3e顾名思义，API 是一般框架(类库)提供给用户的全部接口（方法）的说明书；Style Specification 是 Mapbox 地图的样式规范；Example 是一些常用功能或常见业务的代码示例，囊括了使用 Mapbox 所能实现的大部分功能效果；Plugins 则是官方推荐的可与 mapbox-gl 一同使用的一些增效插件和开源项目，如一些第三方的UI控件、显示类插件、框架集成工具、开发辅助工具、实用工具类库等等。\x3c\/p\x3e\n\x3cp\x3e对于初了解 Mapbox 的童鞋，建议先从官网的 Example 入手，能够较快掌握 mapbox-gl 的使用并投入开发实践。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e三、快速实践\x3c\/h1\x3e\n\x3cp\x3e下面以文章开头展示的项目为主，介绍其实战步骤。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e1. 加载地图：\x3c\/h2\x3e\n\x3cp\x3e由于使用在线地图服务和 \x3ccode\x3estyle\x3c\/code\x3e 时需要验证用户 \x3ccode\x3etoken\x3c\/code\x3e，所以在使用 \x3ccode\x3emapboxgl\x3c\/code\x3e 时需要先配置用户 \x3ccode\x3etoken\x3c\/code\x3e（在Mapbox官网注册用户即可获取）。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import mapboxgl from \x27mapbox-gl\x27;\nmapboxgl.accessToken = \x27\x3cYour Token Here\x3e\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs vbnet\x22\x3e\x3ccode\x3eimport mapboxgl \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\x27mapbox-gl\x27;\x3c\/span\x3e\nmapboxgl.accessToken = \x3cspan class=\x22hljs-comment\x22\x3e\x27\x3cspan class=\x22hljs-doctag\x22\x3e\x26lt;Your Token Here\x26gt;\x3c\/span\x3e\x27;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来使用创建地图实例。主要配置项如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const myMap = new mapboxgl.Map({\n  container: \x27\x3cId of Container Element\x3e\x27,\n  style: \x27\x3cYour Style Here\x3e\x27,\n  center: [112.508203125, 37.97980872872457],\n  zoom: 4,\n  pitch: 0,\n  bearing: 0,\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs yaml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-string\x22\x3econst\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3emyMap\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e=\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3emapboxgl.Map({\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  container:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;Id of Container Element\x26gt;\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  style:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;Your Style Here\x26gt;\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  center:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[112.508203125,\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e37.97980872872457\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e],\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  zoom:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  pitch:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e  bearing:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-string\x22\x3e});\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中，\x3ccode\x3econtainer\x3c\/code\x3e 是地图容器的元素 \x3ccode\x3eid\x3c\/code\x3e，\x3ccode\x3estyle\x3c\/code\x3e 是地图样式的 \x3ccode\x3eurl\x3c\/code\x3e，或者你自己定义的 \x3ccode\x3estyle\x3c\/code\x3e（需遵循Mapbox样式规范），\x3ccode\x3ecenter\x3c\/code\x3e 是地图加载后默认的中心点位置，用以定位地图加载时的位置。\x3ccode\x3ezoom\x3c\/code\x3e \x3ccode\x3epitch\x3c\/code\x3e \x3ccode\x3ebearing\x3c\/code\x3e 分别指缩放级别、地面法线偏移角、地轴偏移角等，用以确定当前视窗所显示的地图区域和空间关系。配置项的意义均可查看官网文档。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e2. 绘制图形\x3c\/h2\x3e\n\x3cp\x3e这里主要介绍视频中的3D建筑、飞线动画等是如何实现的。这里以相关代码片段来介绍实践的方法。\x3c\/p\x3e\n\x3cp\x3e在Mapbox中绘制图形时， \x3ccode\x3elayer\x3c\/code\x3e 和 \x3ccode\x3esource\x3c\/code\x3e 是最重要的一组概念，后者用于存储图形的数据内容，前者则是图形在3D场景中的表现（图层）。在Mapbox中，图层一旦被创建，与其同名（\x3ccode\x3eid\x3c\/code\x3e相同）的数据源源（即\x3ccode\x3esource\x3c\/code\x3e）也必然被创建。反之，也可以在创建source后再创建一个图层使用这个已创建的数据源，这时数据源与图层间并不要求同名。而我们通过改变数据来驱动图形变化，便是才去的第二种方式：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 创建id为buildings的数据源\nmyMap.addSource(\x27buildings\x27, {\n type: \x27geojson\x27,\n data: \x27\x3cGeoJson Contents\x3e\x27,\n});\n\n\/\/ 使用buildings的数据来绘制id为building_layer的图形\nmyMap.addLayer({\n  id: \x27building_layer\x27,\n  type: \x27fill-extrusion\x27,\n  source: \x27buildings\x27,\n  ...\x3cOther Options\x3e,\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lasso\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建id为buildings的数据源\x3c\/span\x3e\nmyMap.addSource(\x3cspan class=\x22hljs-string\x22\x3e\x27buildings\x27\x3c\/span\x3e, {\n \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27geojson\x27\x3c\/span\x3e,\n \x3cspan class=\x22hljs-built_in\x22\x3edata\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;GeoJson Contents\x26gt;\x27\x3c\/span\x3e,\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用buildings的数据来绘制id为building_layer的图形\x3c\/span\x3e\nmyMap.addLayer({\n  id: \x3cspan class=\x22hljs-string\x22\x3e\x27building_layer\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27fill-extrusion\x27\x3c\/span\x3e,\n  source: \x3cspan class=\x22hljs-string\x22\x3e\x27buildings\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-params\x22\x3e...\x3c\/span\x3e\x26lt;Other Options\x26gt;,\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e基于上面的方式，当数据改变时，我们只需要重设数据源的数据，即可驱动图层重绘：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (myMap.getLayer(\x27building_layer\x27)) {\n  myMap.getSource(\x27buildings\x27).setData(\x3cNew GeoJson Contents\x3e);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3eif\x3c\/span\x3e (myMap.getLayer(\x3cspan class=\x22hljs-string\x22\x3e\x27building_layer\x27\x3c\/span\x3e)) {\n  \x3cspan class=\x22hljs-selector-tag\x22\x3emyMap\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.getSource\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27buildings\x27\x3c\/span\x3e)\x3cspan class=\x22hljs-selector-class\x22\x3e.setData\x3c\/span\x3e(\x26lt;New GeoJson Contents\x26gt;);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e至于3D效果及动画的具体实现，这里给出两个官网上的示例，相信大家能一目了然：\x3c\/p\x3e\n\x3cblockquote\x3ei.\x26nbsp;\x3ca href=\x22https:\/\/www.mapbox.com\/mapbox-gl-js\/example\/3d-buildings\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e用3D形式呈现建筑\x3c\/a\x3e\x26nbsp;\x3cbr\x3eii.\x26nbsp;\x3ca href=\x22https:\/\/www.mapbox.com\/mapbox-gl-js\/example\/animate-point-along-route\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e给路径中的一个点添加动画效果\x3c\/a\x3e\n\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e3. 图形交互\x3c\/h2\x3e\n\x3cp\x3eMapbox提供的交互方法是比较灵活的，活学活用API文档便能实现各种炫酷、实用的交互效果。比如：使用\x3cbr\x3e\x3ccode\x3emyMap.on(\x27zoom\x27, callback)\x3c\/code\x3e 可以将图形与地图的缩放相绑定，当缩放系数小于某个值时，可以隐藏掉一些图形元素：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22myMap.on(\x27zoom\x27, () =\x3e {\n  if (myMap.getZoom() \x3c= 4) {\n    myMap.setLayoutProperty(\x27building_layer\x27, \x27visibility\x27, \x27none\x27);\n  } else {\n    myMap.setLayoutProperty(\x27building_layer\x27, \x27visibility\x27, \x27visible\x27);\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3emyMap.\x3cspan class=\x22hljs-literal\x22\x3eon\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27zoom\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (myMap.getZoom() \x26lt;= \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e) {\n    myMap.setLayoutProperty(\x3cspan class=\x22hljs-string\x22\x3e\x27building_layer\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27visibility\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27none\x27\x3c\/span\x3e);\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    myMap.setLayoutProperty(\x3cspan class=\x22hljs-string\x22\x3e\x27building_layer\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27visibility\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27visible\x27\x3c\/span\x3e);\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e再比如，连续调用 \x3ccode\x3emyMap.flyTo()\x3c\/code\x3e 的方法使视图在地图上按照一定的轨迹缓慢移动，可以给用户一种模拟飞行的体验。视频中的自动巡视的效果正是这样实现的。\x3c\/p\x3e\n\x3cp\x3e诸如 \x3ccode\x3eclick\x3c\/code\x3e \x3ccode\x3emouseover\x3c\/code\x3e \x3ccode\x3epopup\x3c\/code\x3e 等效果，官网文档中的示例已经具体呈现，这里就不详细展开了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e4. tiles-server的本地化\x3c\/h2\x3e\n\x3cp\x3e由于 Mapbox 地图服务使用 MBTiles 存储数据，目前很多地图服务都接受了这套标准（如：OSM，Open Street Map）。所以可以通过搭建自己的 tiles-server 以替代直接使用 Mapbox 的在线地图服务。\x3c\/p\x3e\n\x3cp\x3e这样做的好处是显而易见的：一是可以通过负载均衡等手段提高数据接口的访问速度，有效提高数据的加载速度；一是保障应用能在零带宽的环境下仍能有效部署和使用。\x3c\/p\x3e\n\x3cp\x3e这里墙裂安利一个docker开源镜像：openmaptiles-server ，在其 \x3ca href=\x22https:\/\/openmaptiles.com\/server\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e官网\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/hub.docker.com\/r\/klokantech\/openmaptiles-server\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edockerhub\x3c\/a\x3e 上均可下载。个人认为其最大的亮点在于——即使不了解内部实现，也不影响其使用。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010975076\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010975076\x22 alt=\x22openmaptiles.com\x22 title=\x22openmaptiles.com\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e运行 tiles-server 服务的 docker 命令如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ docker run --rm -it -v $(pwd):\/data -p 8080:80\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs elixir\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-variable\x22\x3e$ \x3c\/span\x3edocker run --rm -it -v \x3cspan class=\x22hljs-variable\x22\x3e$(\x3c\/span\x3epwd)\x3cspan class=\x22hljs-symbol\x22\x3e:\/data\x3c\/span\x3e -p \x3cspan class=\x22hljs-number\x22\x3e8080\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e:\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e80\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后剩下来需要做的事情就是打开其导航页面 \x3ca href=\x22http:\/\/localhost:8080\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost:8080\/\x3c\/a\x3e（端口号取决于你的启动命令），然后跟着页面上的提示一步一步设置就好了（最后一步设置后会从OSM走动下载地图，所以一开始你不用担心数据从哪来），完全是傻瓜式的部署。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader7\x22\x3e四、性能调优\x3c\/h1\x3e\n\x3cp\x3e在 Mapbox GL 实践的过程中，发现了一些影响应用整体性能的因素，故而在此陈述一番，为之后填坑的童鞋提供一些经验：\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e使用geo数据（如 GeoJson 格式数据）来定义图形的时候，若数据量过大，则会拖慢数据加载的速度，此时可考虑：\x3c\/li\x3e\x3c\/ol\x3e\n\x3cblockquote\x3ei. 在 http 请求前后对数据进行合理的压缩和解压，以尽可能节省 http 请求传输的数据量；\x3cbr\x3eii. 条件允许的情况下，可将一组数据分片加载，以空间换时间。\x3c\/blockquote\x3e\n\x3col\x3e\n\x3cli\x3e在 Mapboox 中绘制的图层不宜过多，一是不方便管理（当然，github上有很多管理Mapbox图层的第三方工具），一是图层过多会明显降低GL的渲染和响应性能。所以在绘制图形前，可以先考虑一下图层的划分，以最少的图层实现尽可能多的效果。\x3c\/li\x3e\n\x3cli\x3e数据量相同的情况下，使用 \x3ccode\x3emapboxgl.Marker\x3c\/code\x3e 来添加标记，其性能不如使用 \x3ccode\x3etype\x3c\/code\x3e 为 \x3ccode\x3esymbol\x3c\/code\x3e 类型的图层来添加标记。原因在于前者生成的标记是一个个 DOM 元素，如果你可以想象在一个 web 页面中同时操作成百上千个 DOM 节点会是什么结果，那么你或许能明白我的建议。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch1 id=\x22articleHeader8\x22\x3e五、一点总结\x3c\/h1\x3e\n\x3cp\x3e最后，在此总结下个人对 Mapbox 的一些感观。\x3c\/p\x3e\n\x3cp\x3eMapbox 的产品定位是随时随地的 GIS（跨平台、应用），它为我们提供了一系列的简单操作的 API，使得 GIS 开发变得灵活而有趣。尤其对于开发 GIS 类型的数据可视化应用，Mapbox 是绝佳的选择。\x3c\/p\x3e\n\x3cp\x3e然而，如果你只是为了那些绚丽的 3D 效果的话，或许选择专门的框架更为合适。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>3D GIS 应用开发 —— 基于 Mapbox GL 的实践总结</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010975065">https://segmentfault.com/a/1190000010975065</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ezp43zxff4/" target="_blank">https://alili.tech/archive/ezp43zxff4/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>