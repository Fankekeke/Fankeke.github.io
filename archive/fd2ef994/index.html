<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="如何避免async await地狱"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>如何避免async await地狱 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/fd2ef994/",
				"appid": "1613049289050283", 
				"title": "如何避免async await地狱 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-10-18T00:00:00"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/7f16801f/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/dfdfe0ee/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ffd2ef994%2f&text=%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8dasync%20await%e5%9c%b0%e7%8b%b1"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ffd2ef994%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ffd2ef994%2f&text=%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8dasync%20await%e5%9c%b0%e7%8b%b1"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ffd2ef994%2f&title=%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8dasync%20await%e5%9c%b0%e7%8b%b1"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ffd2ef994%2f&is_video=false&description=%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8dasync%20await%e5%9c%b0%e7%8b%b1"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8dasync%20await%e5%9c%b0%e7%8b%b1&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ffd2ef994%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ffd2ef994%2f&title=%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8dasync%20await%e5%9c%b0%e7%8b%b1"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffd2ef994%2f&title=%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8dasync%20await%e5%9c%b0%e7%8b%b1"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffd2ef994%2f&title=%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8dasync%20await%e5%9c%b0%e7%8b%b1"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffd2ef994%2f&title=%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8dasync%20await%e5%9c%b0%e7%8b%b1"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">如何避免async await地狱</h1><div class="meta"><div class="postdate"><time datetime="2018-10-18" itemprop="datePublished">2018-10-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3cp\x3easync\/await 让我们摆脱了回调地狱，但人们开始滥用它 - 这就导致async\/await 地狱的诞生。\x3c\/p\x3e\n\x3cp\x3e在本文中，我将尝试解释什么是async\/await hell，我也会分享一些提示来避免它。\x3c\/p\x3e\n\x3ch3\x3e什么是async\/await hell\x3c\/h3\x3e\n\x3cp\x3e在使用异步JavaScript时，人们通常会依次编写多个语句，并在函数调用之前进行等待。这会导致性能问题，因为一个语句多次不依赖于前一个语句 - 但是您仍然必须等待前一个语句完成。\x3c\/p\x3e\n\x3ch3\x3e举个关于async\/await hell的例子\x3c\/h3\x3e\n\x3cp\x3e假如你是写了一个脚本来订购比萨饼和饮料，那这个脚本可能是这个样子的：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dart\x22\x3e(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e () =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e pizzaData = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getPizzaData()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e drinkData = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getDrinkData()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e chosenPizza = choosePizza()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ sync call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e chosenDrink = chooseDrink()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ sync call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e addPizzaToCart(chosenPizza)    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e addDrinkToCart(chosenDrink)    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n  orderItems()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n})()\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e表面上它看起来是正确的，它确实有效。但是这不是一个好的实现，因为他并没有考虑到并发性。让我们了解它在做什么，以便我们能够确定问题\x3c\/p\x3e\n\x3ch4\x3e说明：\x3c\/h4\x3e\n\x3cp\x3e我们将我们的代码封装在一个 async \x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Glossary\/IIFE\x22\x3eIIFE\x3c\/a\x3e. （IIFE（立即调用函数表达式）是一个JavaScript函数，它在定义时就运行。）那么它将按照以下顺序执行：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3eGet the list of pizzas.（获取一个披萨的列表）\x3c\/li\x3e\n\x3cli\x3eGet the list of drinks.（获取一个饮料的列表）\x3c\/li\x3e\n\x3cli\x3eChoose one pizza from the list.（在这个列表中选择一个披萨）\x3c\/li\x3e\n\x3cli\x3eChoose one drink from the list.（在这个列表中选择一个饮料）\x3c\/li\x3e\n\x3cli\x3eAdd the chosen pizza to the cart.（将选中的比萨加入购物车）\x3c\/li\x3e\n\x3cli\x3eAdd the chosen drink to the cart.（将选中的饮料加入购物车）\x3c\/li\x3e\n\x3cli\x3eOrder the items in the cart.（订购购物车中的物品）\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch4\x3e那么现在有个什么问题了 ?\x3c\/h4\x3e\n\x3cp\x3e正如我先前强调的那样，所有这些陈述都是一一执行的。这里没有并发。仔细想想：为什么我们在尝试获得饮料清单之前等待获得比萨饼列表？我们应该试着将这两个列表放在一起。然而，当我们需要选择比萨时，我们确实需要事先得到比萨饼的名单。这同样适用于饮料。\x3c\/p\x3e\n\x3cp\x3e所以我们可以得出结论，披萨相关的工作和饮料相关的工作可以并行进行，但涉及披萨相关工作的各个步骤需要按顺序（逐个）进行。\x3c\/p\x3e\n\x3ch4\x3e另一个糟糕的实施例子\x3c\/h4\x3e\n\x3cp\x3e此JavaScript代码将获取购物车中的商品并发出订购请求。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eorderItems\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e items = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getCartItems()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e noOfItems = items.length\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; noOfItems; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e sendRequest(items[i])    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n  }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在这种情况下，for循环必须等待sendRequest（）函数完成后才能继续下一次迭代。但是，我们并不需要等待。我们希望尽快发送所有请求，然后我们可以等待所有请求完成。\x3c\/p\x3e\n\x3cp\x3e我希望现在你越来越接近理解什么是async\/await hell，以及它对程序性能的影响有多严重。现在我想问你一个问题。\x3c\/p\x3e\n\x3ch3\x3e如果我们忘记了await关键字会怎么样 ?\x3c\/h3\x3e\n\x3cp\x3e如果在调用异步函数时忘记使用await，则该函数开始执行。这意味着执行该功能不需要等待。异步函数将返回一个promise，您可以稍后使用。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs clojure\x22\x3e(\x3cspan class=\x22hljs-name\x22\x3easync\x3c\/span\x3e () =\x26gt; {\n  const value = doSomeAsyncTask()\n  console.log(\x3cspan class=\x22hljs-name\x22\x3evalue\x3c\/span\x3e) \/\/ an unresolved promise\n})()\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e另一个结果是编译器不会知道你想等待函数完全执行。因此，编译器将退出程序而不完成异步任务。所以我们确实需要\x3cstrong\x3eawait\x3c\/strong\x3e关键字。\x3c\/p\x3e\n\x3cp\x3epromises的一个有趣属性是，你可以在一行中得到promise，并等待它在另一行中解决。这是避免async\/await hel的关键。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs clojure\x22\x3e(\x3cspan class=\x22hljs-name\x22\x3easync\x3c\/span\x3e () =\x26gt; {\n  const promise = doSomeAsyncTask()\n  const value = await promise\n  console.log(\x3cspan class=\x22hljs-name\x22\x3evalue\x3c\/span\x3e) \/\/ the actual value\n})()\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e正如你所看到的，doSomeAsyncTask（）正在返回一个promises。此时doSomeAsyncTask（）已经开始执行。为了得到promise的解析值，我们使用await关键字，它会告诉JavaScript不要立即执行下一行，而是等待promises解决，然后执行下一行。\x3c\/p\x3e\n\x3ch3\x3e如何摆脱 async\/await地狱 ?\x3c\/h3\x3e\n\x3cp\x3e你应该按照这些步骤来避免async\/await地狱。\x3c\/p\x3e\n\x3ch4\x3e查找依赖于其他语句执行的语句\x3c\/h4\x3e\n\x3cp\x3e在我们的第一个例子中，我们选择了一个披萨和一杯饮料。我们的结论是，在选择比萨饼之前，我们需要有比萨饼的名单。在将比萨加入购物车之前，我们需要选择比萨饼。所以我们可以说这三个步骤取决于对方。在完成前一件事之前我们不能做一件事。\x3c\/p\x3e\n\x3cp\x3e但如果我们更广泛地来看，我们发现选择比萨不依赖于选择饮料，所以我们可以并行选择它们。\x3c\/p\x3e\n\x3cp\x3e因此我们发现了一些依赖于其他语句执行的语句，有些则没有。\x3c\/p\x3e\n\x3ch4\x3eGroup-dependent statements in async functions将需要async的函数封装在一起\x3c\/h4\x3e\n\x3cp\x3e将需要async的函数封装在一起\x3c\/p\x3e\n\x3cp\x3e正如我们所看到的，选择比萨包括从属陈述，比如获得比萨饼列表，选择一个，然后将选择的比​​萨加入购物车。我们应该将这些语句分组为异步函数。这样我们就得到了两个异步函数selectPizza（）和selectDrink（）。\x3c\/p\x3e\n\x3ch4\x3e同时执行这些异步功能\x3c\/h4\x3e\n\x3cp\x3e然后我们利用事件循环同时运行这些异步非阻塞函数。这样做的两种常见模式是早日返回Promise和Promise.all方法。\x3c\/p\x3e\n\x3ch3\x3e我们来修复这些例子\x3c\/h3\x3e\n\x3cp\x3e遵循这三个步骤，让我们将它们应用于我们的示例\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eselectPizza\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e pizzaData = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getPizzaData()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e chosenPizza = choosePizza()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ sync call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e addPizzaToCart(chosenPizza)    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eselectDrink\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e drinkData = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getDrinkData()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e chosenDrink = chooseDrink()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ sync call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e addDrinkToCart(chosenDrink)    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n}\n\n(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e () =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e pizzaPromise = selectPizza()\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e drinkPromise = selectDrink()\n  \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e pizzaPromise\n  \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e drinkPromise\n  orderItems()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n})()\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Although I prefer it this way \x3c\/span\x3e\n\n(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e () =\x26gt; {\n  \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all([selectPizza(), selectDrink()]).then(orderItems)   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n})()\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e现在我们将这些语句分成两个函数。在函数内部，每个语句都依赖于前一个语句的执行。然后我们同时执行函数selectPizza（）和selectDrink（）。\x3c\/p\x3e\n\x3cp\x3e在第二个例子中，我们需要处理未知数量的promises。处理这种情况非常简单：我们只需创建一个数组并在其中实现承诺。然后使用Promise.all（）我们同时等待所有的承诺解决。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eorderItems\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e items = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getCartItems()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e noOfItems = items.length\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e promises = []\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; noOfItems; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e orderPromise = sendRequest(items[i])    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n    promises.push(orderPromise)    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ sync call\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all(promises)    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call\x3c\/span\x3e\n}\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e我希望这篇文章能够帮助您超越async \/ await的基础知识，并帮助您提高应用程序的性能。\x3c\/p\x3e\n\x3cp\x3e如果你喜欢这篇文章，请点赞。提示 - 你可以点50次！ \n也请分享Fb和Twitter。如果您想获得更新，请在 \x3ca href=\x22https:\/\/twitter.com\/dev__adi\x22\x3eTwitter\x3c\/a\x3e和\x3ca href=\x22https:\/\/medium.com\/@adityaa803\/\x22\x3eMedium\x3c\/a\x3e上关注我。如果有什么不清楚或者你想指出什么，请在下面评论。\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>原文链接: <a href="https://www.zcfy.cc/article/how-to-escape-async-await-hell">https://www.zcfy.cc/article/how-to-escape-async-await-hell</a> 原文标题: 如何避免async/await地狱 本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2>本文链接：</h2><a href="https://alili.tech/archive/fd2ef994/" target="_blank">https://alili.tech/archive/fd2ef994/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>