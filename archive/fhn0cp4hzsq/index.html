<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="记一次基于mpvue的小程序开发及上线实战"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>记一次基于mpvue的小程序开发及上线实战 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/fhn0cp4hzsq/",
				"appid": "1613049289050283", 
				"title": "记一次基于mpvue的小程序开发及上线实战 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-04T02:30:05"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/9owegk001xd/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/56ok98cdu1p/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ffhn0cp4hzsq%2f&text=%e8%ae%b0%e4%b8%80%e6%ac%a1%e5%9f%ba%e4%ba%8empvue%e7%9a%84%e5%b0%8f%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91%e5%8f%8a%e4%b8%8a%e7%ba%bf%e5%ae%9e%e6%88%98"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ffhn0cp4hzsq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ffhn0cp4hzsq%2f&text=%e8%ae%b0%e4%b8%80%e6%ac%a1%e5%9f%ba%e4%ba%8empvue%e7%9a%84%e5%b0%8f%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91%e5%8f%8a%e4%b8%8a%e7%ba%bf%e5%ae%9e%e6%88%98"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ffhn0cp4hzsq%2f&title=%e8%ae%b0%e4%b8%80%e6%ac%a1%e5%9f%ba%e4%ba%8empvue%e7%9a%84%e5%b0%8f%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91%e5%8f%8a%e4%b8%8a%e7%ba%bf%e5%ae%9e%e6%88%98"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ffhn0cp4hzsq%2f&is_video=false&description=%e8%ae%b0%e4%b8%80%e6%ac%a1%e5%9f%ba%e4%ba%8empvue%e7%9a%84%e5%b0%8f%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91%e5%8f%8a%e4%b8%8a%e7%ba%bf%e5%ae%9e%e6%88%98"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e8%ae%b0%e4%b8%80%e6%ac%a1%e5%9f%ba%e4%ba%8empvue%e7%9a%84%e5%b0%8f%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91%e5%8f%8a%e4%b8%8a%e7%ba%bf%e5%ae%9e%e6%88%98&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ffhn0cp4hzsq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ffhn0cp4hzsq%2f&title=%e8%ae%b0%e4%b8%80%e6%ac%a1%e5%9f%ba%e4%ba%8empvue%e7%9a%84%e5%b0%8f%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91%e5%8f%8a%e4%b8%8a%e7%ba%bf%e5%ae%9e%e6%88%98"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffhn0cp4hzsq%2f&title=%e8%ae%b0%e4%b8%80%e6%ac%a1%e5%9f%ba%e4%ba%8empvue%e7%9a%84%e5%b0%8f%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91%e5%8f%8a%e4%b8%8a%e7%ba%bf%e5%ae%9e%e6%88%98"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffhn0cp4hzsq%2f&title=%e8%ae%b0%e4%b8%80%e6%ac%a1%e5%9f%ba%e4%ba%8empvue%e7%9a%84%e5%b0%8f%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91%e5%8f%8a%e4%b8%8a%e7%ba%bf%e5%ae%9e%e6%88%98"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffhn0cp4hzsq%2f&title=%e8%ae%b0%e4%b8%80%e6%ac%a1%e5%9f%ba%e4%ba%8empvue%e7%9a%84%e5%b0%8f%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91%e5%8f%8a%e4%b8%8a%e7%ba%bf%e5%ae%9e%e6%88%98"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">记一次基于mpvue的小程序开发及上线实战</h1><div class="meta"><div class="postdate"><time datetime="2018-12-04" itemprop="datePublished">2018-12-04</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cul\x3e\n\x3cli\x3e小程序名称：一起打车吧\x3c\/li\x3e\n\x3cli\x3e项目地址：\x3cp\x3e客户端：\x3ca href=\x22https:\/\/github.com\/jrainlau\/taxi-together-client\x22 rel=\x22nofollow noreferrer\x22\x3ehttps:\/\/github.com\/jrainlau\/t...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e服务端：\x3ca href=\x22https:\/\/github.com\/jrainlau\/taxi-together-server\x22 rel=\x22nofollow noreferrer\x22\x3ehttps:\/\/github.com\/jrainlau\/t...\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e小程序二维码：\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV80yH?w=258\x26amp;h=258\x22 src=\x22https:\/\/static.alili.tech\/img\/bV80yH?w=258\x26amp;h=258\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e经过为期两个晚上下班时间的努力，终于把我第一个小程序开发完成并发布上线了。整个过程还算顺利，由于使用了\x3ccode\x3empvue\x3c\/code\x3e方案进行开发，故可以享受和\x3ccode\x3evue\x3c\/code\x3e一致的流畅开发体验；后台系统使用了\x3ccode\x3epython3\x3c\/code\x3e\x2b\x3ccode\x3eflask\x3c\/code\x3e框架进行，使用最少的代码完成了小程序的后台逻辑。除了开发之外，还实实在在地体验了一把微信小程序的开发流程，包括开发者工具的使用、体验版的发布、上线的申请等等。这些开发体验都非常值得被记录下来，于是便趁热打铁，写下这篇文章。\x3c\/p\x3e\n\x3ch1\x3e一、需求\x26amp;功能\x3c\/h1\x3e\n\x3cp\x3e由于公司里有相当多的同事都住在同一个小区，所以上下班的时候经常会在公司群里组织拼车。但是由于完全依赖聊天记录，且上下班拼车的同事也很多，依赖群聊很容易把消息刷走，而且容易造成信息错乱。既然如此，那么完全可以开发一个小工具把这些问题解决。\x3c\/p\x3e\n\x3cp\x3e发起拼车的人把出发地点、目的地点、打车信息以卡片的形式分享出来，参与拼车的人点击卡片就能选择参加拼车，并且能看到同车拼友是谁，拼单的信息等等内容。\x3c\/p\x3e\n\x3cp\x3e交互流程如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV80SJ?w=576\x26amp;h=984\x22 src=\x22https:\/\/static.alili.tech\/img\/bV80SJ?w=576\x26amp;h=984\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以看到，逻辑是非常简单的，我们只需要保证生成拼单、分享拼单、进入拼单和退出拼单这四个功能就好。\x3c\/p\x3e\n\x3cp\x3e需求和功能已经确定好，首先按照\x3ca href=\x22https:\/\/developers.weixin.qq.com\/miniprogram\/dev\/\x22 rel=\x22nofollow noreferrer\x22\x3e小程序官网\x3c\/a\x3e的介绍，注册好小程序并拿到\x3ccode\x3eappId\x3c\/code\x3e，接下来可以开始进行后台逻辑的开发。\x3c\/p\x3e\n\x3ch1\x3e二、后台逻辑开发\x3c\/h1\x3e\n\x3cp\x3e由于时间仓促，功能又简单，所以并没有考虑任何高并发等复杂场景，仅仅考虑功能的实现。从需求的逻辑可以知道，其实后台只需要维护两个列表，分别存储\x3cstrong\x3e当前所有拼车单\x3c\/strong\x3e以及\x3cstrong\x3e当前所有参与了拼车的用户\x3c\/strong\x3e即可，其数据结构如下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e当前所有拼单列表\x3ccode\x3ebillsList\x3c\/code\x3e\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV801c?w=1436\x26amp;h=492\x22 src=\x22https:\/\/static.alili.tech\/img\/bV801c?w=1436\x26amp;h=492\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e当前所有参与了拼车的用户列表\x3ccode\x3einBillUsers\x3c\/code\x3e\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV802B?w=1562\x26amp;h=448\x22 src=\x22https:\/\/static.alili.tech\/img\/bV802B?w=1562\x26amp;h=448\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e当用户确定并分享了一个拼单之后，会直接新建一个拼单，同时把该用户添加到\x3cstrong\x3e当前所有参与了拼车的用户列表\x3c\/strong\x3e列表里面，并且添加到该拼单的成员列表当中：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV809B?w=1654\x26amp;h=464\x22 src=\x22https:\/\/static.alili.tech\/img\/bV809B?w=1654\x26amp;h=464\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e只要维护好这两个列表，接下来就是具体的业务逻辑了。\x3c\/p\x3e\n\x3cp\x3e为了快速开发，这里我使用了\x3ccode\x3epython3\x3c\/code\x3e\x2b\x3ccode\x3eflask\x3c\/code\x3e框架的方案。不懂\x3ccode\x3epython\x3c\/code\x3e的读者看到这里也不用紧张，代码非常简单且直白，看看也无妨。\x3c\/p\x3e\n\x3cp\x3e首先新建一个\x3ccode\x3eBillController\x3c\/code\x3e类：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22python\x22\x3eclass BillController:\n    billsList = []\n    inBillUsers = []\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来会在这个类的内部添加\x3cstrong\x3e创建拼单\x3c\/strong\x3e、\x3cstrong\x3e获取拼单\x3c\/strong\x3e、\x3cstrong\x3e参与拼单\x3c\/strong\x3e、\x3cstrong\x3e退出拼单\x3c\/strong\x3e、\x3cstrong\x3e判断用户是否在某一拼单中\x3c\/strong\x3e、\x3cstrong\x3e图片上传\x3c\/strong\x3e的功能。\x3c\/p\x3e\n\x3ch3\x3e1、获取拼单\x3ccode\x3egetBill()\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e该方法接收客户端传来的拼单ID，然后拿这个ID去检索是否存在对应的拼单。若存在则返回对应的拼单，否则报错给客户端。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22python\x22\x3e    def getBill(self, ctx):\n        ctxBody = ctx.form\n        billId = ctxBody[\x27billId\x27]\n        try: \n            return response([item for item in self.billsList if item[\x27billId\x27] == billId][0])\n        except IndexError:\n            return response({\n                \x27errMsg\x27: \x27拼单不存在！\x27,\n                \x27billsList\x27: self.billsList,\n            }, 1)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3\x3e2、创建拼单\x3ccode\x3ecreateBill()\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e该方法会接收来自客户端的\x3cstrong\x3e用户信息\x3c\/strong\x3e和\x3cstrong\x3e拼单信息\x3c\/strong\x3e，分别添加到\x3ccode\x3ebillsList\x3c\/code\x3e和\x3ccode\x3einBillUsers\x3c\/code\x3e当中。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22python\x22\x3e    def createBill(self, ctx):\n        ctxBody = ctx.form\n        user = {\n            \x27userId\x27: ctxBody[\x27userId\x27],\n            \x27billId\x27: ctxBody[\x27billId\x27],\n            \x27name\x27: ctxBody[\x27name\x27],\n            \x27avatar\x27: ctxBody[\x27avatar\x27]\n        }\n        bill = {\n            \x27billId\x27: ctxBody[\x27billId\x27],\n            \x27from\x27: ctxBody[\x27from\x27],\n            \x27to\x27: ctxBody[\x27to\x27],\n            \x27time\x27: ctxBody[\x27time\x27],\n            \x27members\x27: [user]\n        }\n\n        if ctxBody[\x27userId\x27] in [item[\x27userId\x27] for item in self.inBillUsers]:\n            return response({\n                \x27errMsg\x27: \x27用户已经在拼单中！\x27\n            }, 1)\n\n        self.billsList.append(bill)\n        self.inBillUsers.append(user)\n        return response({\n            \x27billsList\x27: self.billsList,\n            \x27inBillUsers\x27: self.inBillUsers\n        })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e创建完成后，会返回当前的\x3ccode\x3ebillsList\x3c\/code\x3e和\x3ccode\x3einBillUsers\x3c\/code\x3e到客户端。\x3c\/p\x3e\n\x3ch3\x3e3、参与拼单\x3ccode\x3ejoinBill()\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e接收客户端传来的\x3cstrong\x3e用户信息\x3c\/strong\x3e和\x3cstrong\x3e拼单ID\x3c\/strong\x3e，把用户添加到拼单和\x3ccode\x3einBillUsers\x3c\/code\x3e列表中。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22python\x22\x3e    def joinBill(self, ctx):\n        ctxBody = ctx.form\n        billId = ctxBody[\x27billId\x27]\n        user = {\n            \x27userId\x27: ctxBody[\x27userId\x27],\n            \x27name\x27: ctxBody[\x27name\x27],\n            \x27avatar\x27: ctxBody[\x27avatar\x27],\n            \x27billId\x27: ctxBody[\x27billId\x27]\n        }\n        if ctxBody[\x27userId\x27] in [item[\x27userId\x27] for item in self.inBillUsers]:\n            return response({\n                \x27errMsg\x27: \x27用户已经在拼单中！\x27\n            }, 1)\n        theBill = [item for item in self.billsList if item[\x27billId\x27] == billId]\n        if not theBill:\n            return response({\n                \x27errMsg\x27: \x27拼单不存在\x27\n            }, 1)\n        theBill[0][\x27members\x27].append(user)\n        self.inBillUsers.append(user)\n        return response({\n            \x27billsList\x27: self.billsList,\n            \x27inBillUsers\x27: self.inBillUsers\n        })\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3\x3e4、退出拼单\x3ccode\x3eleaveBill()\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e接收客户端传来的\x3cstrong\x3e用户ID\x3c\/strong\x3e和\x3cstrong\x3e拼单ID\x3c\/strong\x3e，然后删除掉两个列表里面的该用户。\x3c\/p\x3e\n\x3cp\x3e这个函数还有一个功能，如果判断到这个拼单ID所对应的拼单成员为空，会认为该拼单已经作废，会直接删除掉这个拼单以及所对应的车辆信息图片。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22python\x22\x3e    def leaveBill(self, ctx):\n        ctxBody = ctx.form\n        billId = ctxBody[\x27billId\x27]\n        userId = ctxBody[\x27userId\x27]\n        indexOfUser = [i for i, member in enumerate(self.inBillUsers) if member[\x27userId\x27] == userId][0]\n        indexOfTheBill = [i for i, bill in enumerate(self.billsList) if bill[\x27billId\x27] == billId][0]\n        indexOfUserInBill = [i for i, member in enumerate(self.billsList[indexOfTheBill][\x27members\x27]) if member[\x27userId\x27] == userId][0]\n        # 删除拼单里面的该用户\n        self.billsList[indexOfTheBill][\x27members\x27].pop(indexOfUserInBill)\n        # 删除用户列表里面的该用户\n        self.inBillUsers.pop(indexOfUser)\n        # 如果拼单里面用户为空，则直接删除这笔拼单\n        if len(self.billsList[indexOfTheBill][\x27members\x27]) == 0:\n            imgPath = \x27.\/imgs\/\x27 \x2b self.billsList[indexOfTheBill][\x27img\x27].split(\x27\/getImg\x27)[1]\n            if os.path.exists(imgPath):\n                os.remove(imgPath)\n            self.billsList.pop(indexOfTheBill)\n        return response({\n            \x27billsList\x27: self.billsList,\n            \x27inBillUsers\x27: self.inBillUsers\n        })\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3\x3e5、判断用户是否在某一拼单中\x3ccode\x3einBill()\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e接收客户端传来的\x3cstrong\x3e用户ID\x3c\/strong\x3e，接下来会根据这个用户ID去\x3ccode\x3einBillUsers\x3c\/code\x3e里面去检索该用户所对应的拼单，如果能检索到，会返回其所在的拼单。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22python\x22\x3e    def inBill(self, ctx):\n        ctxBody = ctx.form\n        userId = ctxBody[\x27userId\x27]\n        if ctxBody[\x27userId\x27] in [item[\x27userId\x27] for item in self.inBillUsers]:\n            return response({\n                \x27inBill\x27: [item for item in self.inBillUsers if ctxBody[\x27userId\x27] == item[\x27userId\x27]][0],\n                \x27billsList\x27: self.billsList,\n                \x27inBillUsers\x27: self.inBillUsers\n            })\n        return response({\n            \x27inBill\x27: False,\n            \x27billsList\x27: self.billsList,\n            \x27inBillUsers\x27: self.inBillUsers\n        })\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3\x3e6、图片上传\x3ccode\x3euploadImg()\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e接收客户端传来的\x3cstrong\x3e拼单ID\x3c\/strong\x3e和\x3cstrong\x3e图片资源\x3c\/strong\x3e，先存储图片，然后把该图片的路径写入对应拼单ID的拼单当中。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22python\x22\x3e    def uploadImg(self, ctx):\n        billId = ctx.form[\x27billId\x27]\n        file = ctx.files[\x27file\x27]\n        filename = file.filename\n        file.save(os.path.join(\x27.\/imgs\x27, filename))\n        # 把图片信息挂载到对应的拼单\n        indexOfTheBill = [i for i, bill in enumerate(self.billsList) if bill[\x27billId\x27] == billId][0]\n        self.billsList[indexOfTheBill][\x27img\x27] = url_for(\x27getImg\x27, filename=filename)\n        return response({\n            \x27billsList\x27: self.billsList\n        })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e完成了业务逻辑的功能，接下来就是把它们分发给不同的路由了：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22python\x22\x3e@app.route(\x27\/create\x27, methods = [\x27POST\x27])\ndef create():\n    return controller.createBill(request)\n\n@app.route(\x27\/join\x27, methods = [\x27POST\x27])\ndef join():\n    return controller.joinBill(request)\n\n@app.route(\x27\/leave\x27, methods = [\x27POST\x27])\ndef leave():\n    return controller.leaveBill(request)\n\n@app.route(\x27\/getBill\x27, methods = [\x27POST\x27])\ndef getBill():\n    return controller.getBill(request)\n\n@app.route(\x27\/inBill\x27, methods = [\x27POST\x27])\ndef inBill():\n    return controller.inBill(request)\n\n@app.route(\x27\/uploadImg\x27, methods = [\x27POST\x27])\ndef uploadImg():\n    return controller.uploadImg(request)\n\n@app.route(\x27\/getImg\/\x26lt;filename\x26gt;\x27)\ndef getImg(filename):\n  return send_from_directory(\x27.\/imgs\x27, filename)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e完整的代码可以直接到\x3ca href=\x22https:\/\/github.com\/jrainlau\/taxi-together-server\x22 rel=\x22nofollow noreferrer\x22\x3e仓库\x3c\/a\x3e查看，这里仅展示关键的内容。\x3c\/p\x3e\n\x3ch1\x3e三、前端业务开发\x3c\/h1\x3e\n\x3cp\x3e前端借助\x3ccode\x3evue-cli\x3c\/code\x3e直接使用了mpvue的\x3ca href=\x22https:\/\/github.com\/mpvue\/mpvue-quickstart\x22 rel=\x22nofollow noreferrer\x22\x3empvue-quickstart\x3c\/a\x3e来初始化项目，具体过程不再细述，直接进入业务开发部分。\x3c\/p\x3e\n\x3cp\x3e首先，微信小程序的API都是callback风格，为了使用方便，我把用到的小程序API都包装成了\x3ccode\x3ePromise\x3c\/code\x3e，统一放在\x3ccode\x3esrc\/utils\/wx.js\x3c\/code\x3e内部，类似下面这样：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3eexport const request = obj =\x26gt; new Promise((resolve, reject) =\x26gt; {\n  wx.request({\n    url: obj.url,\n    data: obj.data,\n    header: { \x27content-type\x27: \x27application\/x-www-form-urlencoded\x27, ...obj.header },\n    method: obj.method,\n    success (res) {\n      resolve(res.data.data)\n    },\n    fail (e) {\n      console.log(e)\n      reject(e)\n    }\n  })\n})\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3\x3e1、注册全局Store\x3c\/h3\x3e\n\x3cp\x3e由于开发习惯，我喜欢把所有接口请求都放在store里面的\x3ccode\x3eactions\x3c\/code\x3e当中，所以这个小程序也是需要用到\x3ccode\x3eVuex\x3c\/code\x3e。但由于小程序每一个Page都是一个新的Vue实例，所以按照Vue的方式，用全局\x3ccode\x3eVue.use(Vuex)\x3c\/code\x3e是不会把\x3ccode\x3e$store\x3c\/code\x3e注册到实例当中的，这一步要手动来。\x3c\/p\x3e\n\x3cp\x3e在\x3ccode\x3esrc\/\x3c\/code\x3e目录下新建一个\x3ccode\x3estore.js\x3c\/code\x3e文件，然后在里面进行使用注册：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode\x3eimport Vue from \x27vue\x27\nimport Vuex from \x27vuex\x27\n\n\nVue.use(Vuex)\n\nexport default new Vuex.Store({})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来在\x3ccode\x3esrc\/main.js\x3c\/code\x3e当中，手动在Vue的原型里注册一个\x3ccode\x3e$store\x3c\/code\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3eimport Vue from \x27vue\x27\nimport App from \x27.\/App\x27\nimport Store from \x27.\/store\x27\n\nVue.prototype.$store = Store\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样，以后在任何的Page里都可以通过\x3ccode\x3ethis.$store\x3c\/code\x3e来操作这个全局Store了。\x3c\/p\x3e\n\x3ch3\x3e2、构建好请求的API接口\x3c\/h3\x3e\n\x3cp\x3e和后台系统的逻辑对应，前端也要构造好各个请求的API接口，这样的做法能够避免把API逻辑分散到页面四处，具有清晰、易维护的优势。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3e    \/**\n     * @param  {} {commit}\n     * 获取用户公开信息\n     *\/\n    async getUserInfo ({ commit }) {\n      const { userInfo } = await getUserInfo({\n        withCredenitals: false\n      })\n      userInfo.avatar = userInfo.avatarUrl\n      userInfo.name = userInfo.nickName\n      userInfo.userId = encodeURIComponent(userInfo.nickName \x2b userInfo.city \x2b userInfo.gender \x2b userInfo.country)\n      commit(\x27GET_USER_INFO\x27, userInfo)\n      return userInfo\n    },\n    \/**\n     * @param  {} {commit}\n     * @param  { String } userId 用户ID\n     * 检查用户是否已经存在于某一拼单中\n     *\/\n    async checkInBill ({ commit }, userId) {\n      const res = await request({\n        method: \x27post\x27,\n        url: `${apiDomain}\/inBill`,\n        data: {\n          userId\n        }\n      })\n      return res\n    },\n    \/**\n     * @param  {} {commit}\n     * @param  { String } userId 用户ID\n     * @param  { String } name   用户昵称\n     * @param  { String } avatar 用户头像\n     * @param  { String } time   出发时间\n     * @param  { String } from   出发地点\n     * @param  { String } to     目的地点\n     * @param  { String } billId 拼单ID\n     * 创建拼单\n     *\/\n    async createBill ({ commit }, { userId, name, avatar, time, from, to, billId }) {\n      const res = await request({\n        method: \x27post\x27,\n        url: `${apiDomain}\/create`,\n        data: {\n          userId,\n          name,\n          avatar,\n          time,\n          from,\n          to,\n          billId\n        }\n      })\n      commit(\x27GET_BILL_INFO\x27, res)\n      return res\n    },\n    \/**\n     * @param  {} {commit}\n     * @param  { String } billId 拼单ID\n     * 获取拼单信息\n     *\/\n    async getBillInfo ({ commit }, billId) {\n      const res = await request({\n        method: \x27post\x27,\n        url: `${apiDomain}\/getBill`,\n        data: {\n          billId\n        }\n      })\n      return res\n    },\n    \/**\n     * @param  {} {commit}\n     * @param  { String } userId 用户ID\n     * @param  { String } name   用户昵称\n     * @param  { String } avatar 用户头像\n     * @param  { String } billId 拼单ID\n     * 参加拼单\n     *\/\n    async joinBill ({ commit }, { userId, name, avatar, billId }) {\n      const res = await request({\n        method: \x27post\x27,\n        url: `${apiDomain}\/join`,\n        data: {\n          userId,\n          name,\n          avatar,\n          billId\n        }\n      })\n      return res\n    },\n    \/**\n     * @param  {} {commit}\n     * @param  { String } userId 用户ID\n     * @param  { String } billId 拼单ID\n     * 退出拼单\n     *\/\n    async leaveBill ({ commit }, { userId, billId }) {\n      const res = await request({\n        method: \x27post\x27,\n        url: `${apiDomain}\/leave`,\n        data: {\n          userId,\n          billId\n        }\n      })\n      return res\n    },\n    \/**\n     * @param  {} {commit}\n     * @param  { String } filePath 图片路径\n     * @param  { String } billId   拼单ID\n     * 参加拼单\n     *\/\n    async uploadImg ({ commit }, { filePath, billId }) {\n      const res = await uploadFile({\n        url: `${apiDomain}\/uploadImg`,\n        header: {\n          \x27content-type\x27: \x27multipart\/form-data\x27\n        },\n        filePath,\n        name: \x27file\x27,\n        formData: {\n          \x27billId\x27: billId\n        }\n      })\n      return res\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3\x3e3、填写拼单并实现分享功能实现\x3c\/h3\x3e\n\x3cp\x3e新建一个\x3ccode\x3esrc\/pages\/index\x3c\/code\x3e目录，作为小程序的首页。\x3c\/p\x3e\n\x3cp\x3e该首页的业务逻辑如下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e进入首页的时候先获取用户信息，得到userId\x3c\/li\x3e\n\x3cli\x3e然后用userId去请求判断是否已经处于拼单\x3c\/li\x3e\n\x3cli\x3e若是，则跳转到对应拼单Id的详情页\x3c\/li\x3e\n\x3cli\x3e若否，才允许新建拼单\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e在\x3ccode\x3eonShow\x3c\/code\x3e的生命周期钩子中实现上述逻辑：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode\x3e  async onShow () {\n    this.userInfo = await this.$store.dispatch(\x27getUserInfo\x27)\n    const inBill = await this.$store.dispatch(\x27checkInBill\x27, this.userInfo.userId)\n\n    if (inBill.inBill) {\n      wx.redirectTo(`..\/join\/main?billId=${inBill.inBill.billId}\x26amp;fromIndex=true`)\n    }\n  },\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当用户填写完拼单后，会点击一个带有\x3ccode\x3eopen-type=\x22share\x22\x3c\/code\x3e属性的button，然后会触发\x3ccode\x3eonShareAppMessage\x3c\/code\x3e生命周期钩子的逻辑把拼单构造成卡片分享出去。当分享成功后会跳转到对应拼单ID的参加拼单页。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode\x3e  onShareAppMessage (result) {\n    let title = \x27一起拼车\x27\n    let path = \x27\/pages\/index\x27\n    if (result.from === \x27button\x27) {\n      this.billId = \x27billId-\x27 \x2b new Date().getTime()\n      title = \x27我发起了一个拼车\x27\n      path = `pages\/join\/main?billId=${this.billId}`\n    }\n    return {\n      title,\n      path,\n      success: async (res) =\x26gt; {\n        await this.$store.dispatch(\x27createBill\x27, { ...this.userInfo, ...this.billInfo })\n\n        \/\/ 上传图片\n        await this.$store.dispatch(\x27uploadImg\x27, {\n          filePath: this.imgSrc,\n          billId: this.billId\n        })\n        \n        \/\/ 分享成功后，会带着billId跳转到参加拼单页\n        wx.redirectTo(`..\/join\/main?billId=${this.billId}`)\n      },\n      fail (e) {\n        console.log(e)\n      }\n    }\n  },\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3\x3e4、参与拼单\x26amp;退出拼单功能实现\x3c\/h3\x3e\n\x3cp\x3e新建一个\x3ccode\x3esrc\/pages\/join\x3c\/code\x3e目录，作为小程序的“参加拼单页”。\x3c\/p\x3e\n\x3cp\x3e该页面的运行逻辑如下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e首先会获取从url里面带来的billId\x3c\/li\x3e\n\x3cli\x3e其次会请求一次userInfo，获取userId\x3c\/li\x3e\n\x3cli\x3e然后拿这个userId去检查该用户是否已经处于拼单\x3c\/li\x3e\n\x3cli\x3e如果已经处于拼单，那么就会获取一个新的billId代替从url获取的\x3c\/li\x3e\n\x3cli\x3e拿当前的billId去查询对应的拼单信息\x3c\/li\x3e\n\x3cli\x3e如果billId都无效，则redirect到首页\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e由于要获取url携带的内容，亲测\x3ccode\x3eonShow()\x3c\/code\x3e是不行的，只能在\x3ccode\x3eonLoad()\x3c\/code\x3e里面获取：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode\x3e  async onLoad (options) {\n    \/\/ 1. 首先会获取从url里面带来的billId\n    this.billId = options.billId\n    \/\/ 2. 其次会请求一次userInfo，获取userId\n    this.userInfo = await this.$store.dispatch(\x27getUserInfo\x27)\n    \/\/ 3. 然后拿这个userId去检查该用户是否已经处于拼单\n    const inBill = await this.$store.dispatch(\x27checkInBill\x27, this.userInfo.userId)\n    \/\/ 4. 如果已经处于拼单，那么就会有一个billId\n    if (inBill.inBill) {\n      this.billId = inBill.inBill.billId\n    }\n    \/\/ 5. 如果没有处于拼单，那么将请求当前billId的拼单\n    \/\/ 6. 如果billId都无效，则redirect到首页，否则检查当前用户是否处于该拼单当中\n    await this.getBillInfo()\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e此外，当用户点击“参与拼车”后，需要重新请求拼单信息，以刷新视图拼车人员列表；当用户点击“退出拼车”后，要重定向到首页。\x3c\/p\x3e\n\x3cp\x3e经过上面几个步骤，客户端的逻辑已经完成，可以进行预发布了。\x3c\/p\x3e\n\x3ch1\x3e四、预发布\x26amp;申请上线\x3c\/h1\x3e\n\x3cp\x3e如果要发布预发布版本，需要运行\x3ccode\x3enpm run build\x3c\/code\x3e命令，打包出一个生产版本的包，然后通过小程序开发者工具的\x3cstrong\x3e上传\x3c\/strong\x3e按钮上传代码，并填写测试版本号：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV81YU?w=1428\x26amp;h=486\x22 src=\x22https:\/\/static.alili.tech\/img\/bV81YU?w=1428\x26amp;h=486\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e接下来可以在小程序管理后台→开发管理→开发版本当中看到体验版小程序的信息，然后选择发布体验版即可：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV81Y8?w=1304\x26amp;h=228\x22 src=\x22https:\/\/static.alili.tech\/img\/bV81Y8?w=1304\x26amp;h=228\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e当确定预发布测试无误之后，就可以点击“提交审核”，正式把小程序提交给微信团队进行审核。审核的时间非常快，在3小时内基本都能够有答复。\x3c\/p\x3e\n\x3cp\x3e值得注意的是，小程序所有请求的API，都必须经过\x3cstrong\x3e域名备案\x3c\/strong\x3e和\x3cstrong\x3e使用https\x3c\/strong\x3e证书，同时要在设置→开发设置→服务器域名里面把API添加到白名单才可以正常使用。\x3c\/p\x3e\n\x3ch1\x3e五、后记\x3c\/h1\x3e\n\x3cp\x3e这个小程序现在已经发布上线了，算是完整体验了一把小程序的开发乐趣。小程序得到了微信团队的大力支持，以后的生态只会越来越繁荣。当初小程序上线的时候我也对它有一些抵触，但后来想了想，这只不过是前端工程师所需面对的又一个“端“而已，没有必要为它戴上有色眼镜，多掌握一些总是好的。\x3c\/p\x3e\n\x3cp\x3e“一起打车吧”微信小程序依然是一个玩具般的存在，仅供自己学习和探索，当然也欢迎各位读者能够贡献代码，参与开发~\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>记一次基于mpvue的小程序开发及上线实战</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014506757">https://segmentfault.com/a/1190000014506757</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/fhn0cp4hzsq/" target="_blank">https://alili.tech/archive/fhn0cp4hzsq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>