<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="【Geek议题】当年那些风骚的跨域操作"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>【Geek议题】当年那些风骚的跨域操作 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/fvsu3n9kl9d/",
				"appid": "1613049289050283", 
				"title": "【Geek议题】当年那些风骚的跨域操作 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-06T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/f4myl7767yl/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/e40pc1365nk/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ffvsu3n9kl9d%2f&text=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%bd%93%e5%b9%b4%e9%82%a3%e4%ba%9b%e9%a3%8e%e9%aa%9a%e7%9a%84%e8%b7%a8%e5%9f%9f%e6%93%8d%e4%bd%9c"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ffvsu3n9kl9d%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ffvsu3n9kl9d%2f&text=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%bd%93%e5%b9%b4%e9%82%a3%e4%ba%9b%e9%a3%8e%e9%aa%9a%e7%9a%84%e8%b7%a8%e5%9f%9f%e6%93%8d%e4%bd%9c"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ffvsu3n9kl9d%2f&title=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%bd%93%e5%b9%b4%e9%82%a3%e4%ba%9b%e9%a3%8e%e9%aa%9a%e7%9a%84%e8%b7%a8%e5%9f%9f%e6%93%8d%e4%bd%9c"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ffvsu3n9kl9d%2f&is_video=false&description=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%bd%93%e5%b9%b4%e9%82%a3%e4%ba%9b%e9%a3%8e%e9%aa%9a%e7%9a%84%e8%b7%a8%e5%9f%9f%e6%93%8d%e4%bd%9c"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%bd%93%e5%b9%b4%e9%82%a3%e4%ba%9b%e9%a3%8e%e9%aa%9a%e7%9a%84%e8%b7%a8%e5%9f%9f%e6%93%8d%e4%bd%9c&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ffvsu3n9kl9d%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ffvsu3n9kl9d%2f&title=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%bd%93%e5%b9%b4%e9%82%a3%e4%ba%9b%e9%a3%8e%e9%aa%9a%e7%9a%84%e8%b7%a8%e5%9f%9f%e6%93%8d%e4%bd%9c"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffvsu3n9kl9d%2f&title=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%bd%93%e5%b9%b4%e9%82%a3%e4%ba%9b%e9%a3%8e%e9%aa%9a%e7%9a%84%e8%b7%a8%e5%9f%9f%e6%93%8d%e4%bd%9c"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffvsu3n9kl9d%2f&title=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%bd%93%e5%b9%b4%e9%82%a3%e4%ba%9b%e9%a3%8e%e9%aa%9a%e7%9a%84%e8%b7%a8%e5%9f%9f%e6%93%8d%e4%bd%9c"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffvsu3n9kl9d%2f&title=%e3%80%90Geek%e8%ae%ae%e9%a2%98%e3%80%91%e5%bd%93%e5%b9%b4%e9%82%a3%e4%ba%9b%e9%a3%8e%e9%aa%9a%e7%9a%84%e8%b7%a8%e5%9f%9f%e6%93%8d%e4%bd%9c"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">【Geek议题】当年那些风骚的跨域操作</h1><div class="meta"><div class="postdate"><time datetime="2018-12-06" itemprop="datePublished">2018-12-06</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e现在cross-origin resource sharing（跨域资源共享，下简称CORS）已经十分普及，算上IE8的不标准兼容（XDomainRequest），各大浏览器基本都已支持，当年为了前后端分离、iframe交互和第三方插件开发而头疼跨域是时代已经过去，但当年为了跨域无所不用其极的风骚操作却依然值得学习。  \x3cbr\x3e本篇文章不是从实用的角度考量这些旧时代的跨域手段，而是更偏向理论的阐述，并引发对浏览器安全的思考，因为跨域实际上也是各类攻击的核心。  \x3cbr\x3e本人个人能力有限，欢迎大牛一起讨论，批评指正。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e同源策略\x3c\/h2\x3e\n\x3cp\x3e1995年，同源政策由Netscape公司引入浏览器。目前，所有浏览器都实行这个安全策略。  \x3cbr\x3e核心是确保不同源提供的文件（资源）之间是相互独立的。换句话说，只有当不同的文件脚本是由相同的域、端口、HTTP协议提供时，才没有特殊的限制。特殊限制可以细分为两个方面：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e对象访问限制：主要体现在iframe，如果父子页面的源是不同的，那就不可以访问对方的DOM方法和属性（包括Cookie、LocalStorage和IndexDB等）。不同来源便抛出异常。\x3c\/li\x3e\n\x3cli\x3e网络访问限制：主要体现在AJAX请求，如果发起的请求目标源与当前页面不同，浏览器就会限制了发起跨站请求，或拦截返回的请求。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e一个表格看懂什么是同源？\x3c\/strong\x3e\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3eorigin(URL)\x3c\/th\x3e\n\x3cth\x3eresult\x3c\/th\x3e\n\x3cth\x3ereason\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3ehttp:\/\/example.com\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3esuccess\x3c\/td\x3e\n\x3ctd\x3e协议，域名和端口号80均相同\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3ehttp:\/\/example.com:8080\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3efail\x3c\/td\x3e\n\x3ctd\x3e端口不同\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3ehttps:\/\/example.com\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3efail\x3c\/td\x3e\n\x3ctd\x3e协议不同\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3ehttp:\/\/sub.example.com\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3efail\x3c\/td\x3e\n\x3ctd\x3e域名不同\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e\x3cstrong\x3e至于为什么说这是个安全策略？\x3c\/strong\x3e  \x3cbr\x3e这个就要提到cookie-session机制，众所周知HTTP是无状态协议，而服务器如何知晓用户的登录状态？传统上是使用了cookie-session这一机制，也就是服务器为每个访问者生成了一个session标识，而session标识会被服务器包含在应答头中返回，浏览器解析到应答头中的set-cookie就把这串session标识保存到本地cookie中，利用cookie每次请求同一个域都会带上的特性，服务器器就能知晓当前的用户登录状态。  \x3cbr\x3e所以如果让浏览器向不同源发起请求，就会造成很大的危险。比如用户登录了银行的网站A，也就是说A站已经在浏览器留下了cookie，这时候用户又访问了B站，如果能在B站页面上发起A站的请求，就相当于B站可以冒充用户，在A站为所欲为。  \x3cbr\x3e由此可见，\x22同源策略\x22是必需的，否则cookie可以共享，互联网就毫无安全可言了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e跨域方案\x3c\/h2\x3e\n\x3cp\x3e同源策略提出的时代还是传统MVC架构（jsp，asp）盛行的年代，那时候的页面靠服务器渲染完成了大部分填充，内容也比较简单，开发者也不会维护独立的API工程，所以其实跨域的需求是比较少的。  \x3cbr\x3e新时代前后端的分离和第三方JSSDK的兴起，我们才开始发现这个策略虽然大大提高了浏览器的安全性，但有时很不方便，合理的用途也受到影响。比如：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e独立的API工程部署为了方便管理使用了独立的域名；\x3c\/li\x3e\n\x3cli\x3e前端开发者本地调试需要使用远程的API；\x3c\/li\x3e\n\x3cli\x3e第三方开发的JSSDK需要嵌入到别人的页面中使用；\x3c\/li\x3e\n\x3cli\x3e公共平台的开放API。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e于是乎，在没有标准规范的时代，如何解决这些问题的跨域方案就被纷纷提出，可谓百家争鸣，其中不乏令人惊叹的骚操作，这样的极客精神依然值得我们敬佩和学习。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eJSON-P\x3c\/h3\x3e\n\x3cp\x3eJSON-P是各类跨域方案中流行度较高的一个，现在在某些要兼容旧浏览器的环境下还会被使用，著名的jQuery也封装其方法。请勿见名知义，名字中的P是padding“带填充”的意思，这个方法在通信过程中使用的并不是普通的json，而是\x3cstrong\x3e自带填充功能的JavaScript脚本\x3c\/strong\x3e。  \x3cbr\x3e如何理解“自带填充功能的JavaScript脚本”，看看下面的例子或许比较简单，如果一个js文件里这样写并被引入，则全局下就会有data对象，也就是说\x3cstrong\x3e利用js脚本的引入和解析可以用来传递数据\x3c\/strong\x3e，如果把js脚本换成函数运行命令岂不是可以调用全局函数了。这就是JSON-P方法的核心思想，它填充的是全局函数的数据。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var data = {\n  a: 1,\n  b: 2\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = {\n  \x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eb\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e【PS】\x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e标签不受同源策略限制，但只能发起get请求。\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e原理及流程\x3c\/strong\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e先定义好回调函数，也就是引入的js脚本中要调用的函数；\x3c\/li\x3e\n\x3cli\x3e新建\x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e标签，将标签插入页面浏览器便会发起get请求；\x3c\/li\x3e\n\x3cli\x3e服务器根据请求返回js脚本，其中调用了回调函数。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV7Qk6?w=1358\x26amp;h=540\x22 src=\x22https:\/\/static.alili.tech\/img\/bV7Qk6?w=1358\x26amp;h=540\x22 alt=\x22jsonp流程图\x22 title=\x22jsonp流程图\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 定义回调函数\nfunction getTheAnimal(data){\n    var myAnimal = data.animal;\n}\n\/\/ 新建标签\nvar script = document.createElement(\x26quot;script\x26quot;);\nscript.type = \x26quot;text\/javascript\x26quot;;\n\/\/ 常用的在url参数部分跟服务器约定号回调函数名\nscript.src = \x26quot;http:\/\/demo.com\/animal.json?callback=getTheAnimal\x26quot;;\ndocument.getElementByTagName(\x27head\x27)[0].appendChild(script);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 定义回调函数\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetTheAnimal\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e myAnimal = data.animal;\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新建标签\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e script = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x22script\x22\x3c\/span\x3e);\nscript.type = \x3cspan class=\x22hljs-string\x22\x3e\x22text\/javascript\x22\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 常用的在url参数部分跟服务器约定号回调函数名\x3c\/span\x3e\nscript.src = \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/demo.com\/animal.json?callback=getTheAnimal\x22\x3c\/span\x3e;\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementByTagName(\x3cspan class=\x22hljs-string\x22\x3e\x27head\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].appendChild(script);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e总结\x3c\/strong\x3e  \x3c\/p\x3e\n\x3cp\x3e优点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e简单，有现成的工具库（jQuery）支持；\x3c\/li\x3e\n\x3cli\x3e支持上古级别的浏览器（IE8-）。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e缺点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e只能是GET方法；\x3c\/li\x3e\n\x3cli\x3e受浏览器URL最大长度2083字符限制；\x3c\/li\x3e\n\x3cli\x3e无法调试，服务器错误无法检测到具体原因；\x3c\/li\x3e\n\x3cli\x3e有CSRF的安全风险；\x3c\/li\x3e\n\x3cli\x3e只能是异步，无法同步阻塞；\x3c\/li\x3e\n\x3cli\x3e需要特殊接口支持，不能基于REST的API规范。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e子域名代理\x3c\/h3\x3e\n\x3cp\x3e这个方法实际上是利用浏览器允许iframe内的页面只要是跟父页面是同个一级域名下，就能被父页面修改和调用的特点。也许你会疑问，上面讲同源策略的表格中很明确二级域名不同也是算不同源，这岂不矛盾了？  \x3cbr\x3e这其实不矛盾，如果正常操作确实会被同源策略限制，但浏览器的\x3ccode\x3edocument.domain\x3c\/code\x3e\x3cstrong\x3e允许网站将主机部分更改为原始值的后缀\x3c\/strong\x3e。这意味着，寄放在sub.example.com的页面可以将它的源设置为example.com，但是并不能将其设置为alt.example.com或google.com。\x3c\/p\x3e\n\x3cblockquote\x3e【PS】这里有一个细节，父子页面均要设置\x3ccode\x3edocument.domain\x3c\/code\x3e才能被互相访问，单一一个是无法跨域的。\x3ccode\x3edocument.domain\x3c\/code\x3e的特点：只能设置一次；只能更改域名部分，不能修改端口号和协议；重置源的端口为协议默认端口。\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e原理及流程\x3c\/strong\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e新建一个子域，比如api.demo.com（页面在主域名demo.com下）；\x3c\/li\x3e\n\x3cli\x3e子域下需要一个代理文件proxy.html，设置其\x3ccode\x3edocument.domain = \x27demo.com\x27\x3c\/code\x3e，并可以包含发起ajax的工具；\x3c\/li\x3e\n\x3cli\x3e所有API地址都是在api.demo.com；\x3c\/li\x3e\n\x3cli\x3e把需要发请求的主域页面设置其\x3ccode\x3edocument.domain = \x27demo.com\x27\x3c\/code\x3e；\x3c\/li\x3e\n\x3cli\x3e新建iframe标签链接到代理页；\x3c\/li\x3e\n\x3cli\x3e当iframe内的子页面就绪时，父页面就可以使用子页面发起ajax请求。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV7Qle?w=1386\x26amp;h=758\x22 src=\x22https:\/\/static.alili.tech\/img\/bV7Qle?w=1386\x26amp;h=758\x22 alt=\x22子域名代理流程图\x22 title=\x22子域名代理流程图\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 最简单的代理文件proxy.html\n\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n    \x3cscript\x3e\n        document.domain = \x27demo.com\x27;\n    \x3c\/script\x3e\n    \x3cscript src=\x26quot;jquery.min.js\x26quot;\x3e\x3c\/script\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\/\/ 最简单的代理文件proxy.html\n\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.domain = \x3cspan class=\x22hljs-string\x22\x3e\x27demo.com\x27\x3c\/span\x3e;\n    \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22jquery.min.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 新建iframe\nvar iframe = document.createElement(\x27iframe\x27);\n\/\/ 链接到代理页\niframe.src = \x27http:\/\/api.demo.com\/proxy.html\x27;\n\/\/ 代理页就绪时触发\niframe.onload = function(){\n  \/\/ 由于代理页已经和父页设置了相同的源，父的脚本可以调用代理页的ajax工具；\n  \/\/ 由于是在子页面发起，其请求地址就跟子页面同源了。\n  iframe.contentWindow.jQuery.ajax({\n    method: \x27POST\x27,\n    url: \x27http:\/\/api.demo.com\/products\x27,\n    data: {\n      product: id,\n    },\n    success: function(){\n      document.body.removeChild(iframe);\n      \/*...*\/\n    }\n  })\n}\ndocument.getElementsByTagName(\x27head\x27)[0].appendChild(iframe);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新建iframe\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e iframe = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 链接到代理页\x3c\/span\x3e\niframe.src = \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/api.demo.com\/proxy.html\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 代理页就绪时触发\x3c\/span\x3e\niframe.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 由于代理页已经和父页设置了相同的源，父的脚本可以调用代理页的ajax工具；\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 由于是在子页面发起，其请求地址就跟子页面同源了。\x3c\/span\x3e\n  iframe.contentWindow.jQuery.ajax({\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27POST\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/api.demo.com\/products\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3eproduct\x3c\/span\x3e: id,\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.removeChild(iframe);\n      \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e\n    }\n  })\n}\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementsByTagName(\x3cspan class=\x22hljs-string\x22\x3e\x27head\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].appendChild(iframe);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e总结\x3c\/strong\x3e  \x3c\/p\x3e\n\x3cp\x3e优点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e可以发送任意类型的请求；\x3c\/li\x3e\n\x3cli\x3e可以使用基于REST的API规范。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e缺点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e不太适合第三方API，给第二方使用较麻烦；\x3c\/li\x3e\n\x3cli\x3eiframe对浏览器性能影响较大；\x3c\/li\x3e\n\x3cli\x3e无法使用非协议默认端口的API。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e模拟form表单\x3c\/h3\x3e\n\x3cp\x3eform表单的target属性可以指定一个iframe，使主页面不跳转，而iframe内跳转，所以这个方法的核心就是\x3cstrong\x3e利用表单提交，并在iframe中获取数据\x3c\/strong\x3e。  \x3cbr\x3e要访问iframe内外页面互访也是必须设置同源，这点与子域代理是相似的；而iframe内回调父页面，又与JSON-P相似，可以说是两个思路的合体版。  \x3cbr\x3eform表单提交后返回的是页面，所以与JSON-P不同的是，返回的是\x3cstrong\x3e包含了自带填充功能的JavaScript脚本的页面\x3c\/strong\x3e，说起来有点绕，简单来说就是把JSON-P返回的脚本放到一个html页面里自运行。  \x3cbr\x3e相比子域代理的方法，它\x3cstrong\x3e不需要代理页\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cblockquote\x3e【PS】form表单提交的特点就是会导致整个页面跳转，返回数据是在新的页面上，这样自然不会产生跨域的问题。\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e原理及流程\x3c\/strong\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e新建一个子域，比如api.demo.com（页面在主域名demo.com下）；\x3c\/li\x3e\n\x3cli\x3e所有API地址都是在api.demo.com；\x3c\/li\x3e\n\x3cli\x3e把需要发请求的主域页面设置其\x3ccode\x3edocument.domain = \x27demo.com\x27\x3c\/code\x3e；\x3c\/li\x3e\n\x3cli\x3e先定义好父页面上的回调函数；\x3c\/li\x3e\n\x3cli\x3e新建iframe标签并指定名字；\x3c\/li\x3e\n\x3cli\x3e新建表单form标签，指定target为刚才的iframe，并添加数据；\x3c\/li\x3e\n\x3cli\x3e提交表单，iframe内跳转，其中自运行脚本调用了父页面的回调函数。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV7Qlk?w=1480\x26amp;h=734\x22 src=\x22https:\/\/static.alili.tech\/img\/bV7Qlk?w=1480\x26amp;h=734\x22 alt=\x22模拟form表单流程图\x22 title=\x22模拟form表单流程图\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 新建并隐藏iframe\nvar frame = document.createElement(\x27iframe\x27);\niframe.name = \x27post-review\x27;\nframe.style.display = \x27none\x27;\n\n\/\/ 新建表单\nvar form = document.createElement(\x27form\x27);\nform.action = \x27http:\/\/api.demo.com\/products\x27;\nform.method = \x27POST\x27;\nform.target = \x27post-review\x27;\n\/\/ 添加数据\nvar score = document.createElement(\x27input\x27);\nscore.name = \x27score\x27;\nscore.value = \x275\x27;\n\/\/ 添加数据\nvar message = document.createElement(\x27input\x27);\nmessage.name = \x27message\x27;\nmessage.value = \x27hello world\x27;\n\/\/ 把数据加到表单\nform.appendChild(score);\nform.appendChild(message);\n\/\/ 渲染iframe和表单\ndocument.body.appendChild(frame);\ndocument.body.appendChild(form);\n\/\/ 提交表单发起请求\nform.submit();\n\/\/ 完成清理元素\ndocument.body.removeChild(form);\ndocument.body.removeChild(frame);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新建并隐藏iframe\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e frame = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe\x27\x3c\/span\x3e);\niframe.name = \x3cspan class=\x22hljs-string\x22\x3e\x27post-review\x27\x3c\/span\x3e;\nframe.style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27none\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新建表单\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e form = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27form\x27\x3c\/span\x3e);\nform.action = \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/api.demo.com\/products\x27\x3c\/span\x3e;\nform.method = \x3cspan class=\x22hljs-string\x22\x3e\x27POST\x27\x3c\/span\x3e;\nform.target = \x3cspan class=\x22hljs-string\x22\x3e\x27post-review\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加数据\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e score = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e);\nscore.name = \x3cspan class=\x22hljs-string\x22\x3e\x27score\x27\x3c\/span\x3e;\nscore.value = \x3cspan class=\x22hljs-string\x22\x3e\x275\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加数据\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e message = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e);\nmessage.name = \x3cspan class=\x22hljs-string\x22\x3e\x27message\x27\x3c\/span\x3e;\nmessage.value = \x3cspan class=\x22hljs-string\x22\x3e\x27hello world\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 把数据加到表单\x3c\/span\x3e\nform.appendChild(score);\nform.appendChild(message);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染iframe和表单\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.appendChild(frame);\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.appendChild(form);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 提交表单发起请求\x3c\/span\x3e\nform.submit();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 完成清理元素\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.removeChild(form);\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.removeChild(frame);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 最简单返回html\n\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n    \x3cscript\x3e\n        document.domain = \x27demo.com\x27;\n        window.parent.jsonpCallback(\x27{\x26quot;status\x26quot;:\x26quot;success\x26quot;}\x27);\n    \x3c\/script\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\/\/ 最简单返回html\n\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.domain = \x3cspan class=\x22hljs-string\x22\x3e\x27demo.com\x27\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.parent.jsonpCallback(\x3cspan class=\x22hljs-string\x22\x3e\x27{\x22status\x22:\x22success\x22}\x27\x3c\/span\x3e);\n    \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e总结\x3c\/strong\x3e  \x3c\/p\x3e\n\x3cp\x3e由于这个方法是JSON-P与子域名代理的结合版，可以说即拥有两者的优点，也保留了两者一些缺点。  \x3c\/p\x3e\n\x3cp\x3e优点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e可以发送任意类型的请求；\x3c\/li\x3e\n\x3cli\x3e不需要代理页；\x3c\/li\x3e\n\x3cli\x3e支持上古级别的浏览器（IE8-）。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e缺点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e不太适合第三方API，给第二方使用较麻烦；\x3c\/li\x3e\n\x3cli\x3eiframe对浏览器性能影响较大；\x3c\/li\x3e\n\x3cli\x3e无法使用非协议默认端口的API；\x3c\/li\x3e\n\x3cli\x3e需要特殊接口支持，不能基于REST的API规范。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3ewindow.name\x3c\/h3\x3e\n\x3cp\x3e这方法利用了\x3ccode\x3ewindow.name\x3c\/code\x3e的特性：一旦被赋值后，当窗口被重定向到一个新的URL时不会改变它的值。这一行为使得不同域的特定文档可以读取该属性值，因此可以绕过同源策略并使跨域消息通信成为可能。\x3c\/p\x3e\n\x3cblockquote\x3e【PS】例子里演示的是发起get请求，只要把请求地址直接写到src里就行了。如果想要发起其他类型的请求，可以类比采用模拟的form的方式进行改造。\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e原理及流程\x3c\/strong\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e新建iframe，使用iframe访问一个非同源的地址（发请求）；\x3c\/li\x3e\n\x3cli\x3e当页面加载完成后，iframe内脚本给window.name属性赋值，这时父页面还是不能读取到子页面的属性（因为不同源）；\x3c\/li\x3e\n\x3cli\x3eiframe自身回调到一个同源的地址（可能只是个空白页），这时候window.name没有改变；\x3c\/li\x3e\n\x3cli\x3e父页面顺利读取window.name的值。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV7Qln?w=1330\x26amp;h=594\x22 src=\x22https:\/\/static.alili.tech\/img\/bV7Qln?w=1330\x26amp;h=594\x22 alt=\x22window.name流程图\x22 title=\x22window.name流程图\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 新建iframe\nvar iframe = document.createElement(\x27iframe\x27);\nvar body = document.getElementByTagName(\x27body\x27);\n\/\/ 隐藏iframe并链接地址\niframe.style.display = \x27none\x27;\niframe.src = \x27http:\/\/api.demo.com\/server.html?id=1\x27;\n\/\/ 因为需要两次跳转，这里有个完成标记\nvar done = fasle;\n\/\/ 这里会触发至少两次，一次由于非同源是取不到值的。\niframe.onload = iframe.onreadystatechange = function(){\n    if(! this.readyState \x26amp;\x26amp; (iframe.readyState !== \x27complete\x27 || done)){\n        return;\n    }\n    console.log(\x27Listening\x27);\n    var name = iframe.contentWindow.name;\n    if(name){\n        console.log(iframe.contentWindow.name);\n        done = true;\n    }\n};\nbody.appendChild(iframe);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新建iframe\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e iframe = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e body = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementByTagName(\x3cspan class=\x22hljs-string\x22\x3e\x27body\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 隐藏iframe并链接地址\x3c\/span\x3e\niframe.style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27none\x27\x3c\/span\x3e;\niframe.src = \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/api.demo.com\/server.html?id=1\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 因为需要两次跳转，这里有个完成标记\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e done = fasle;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里会触发至少两次，一次由于非同源是取不到值的。\x3c\/span\x3e\niframe.onload = iframe.onreadystatechange = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(! \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.readyState \x26amp;\x26amp; (iframe.readyState !== \x3cspan class=\x22hljs-string\x22\x3e\x27complete\x27\x3c\/span\x3e || done)){\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Listening\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e name = iframe.contentWindow.name;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(name){\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(iframe.contentWindow.name);\n        done = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    }\n};\nbody.appendChild(iframe);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 最简单返回html\n\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n    \x3cscript\x3e\n    function init(){\n        window.name = \x27hello\x27;\n        window.location = \x27http:\/\/demo.com\/empty.html\x27\n    }\n    \x3c\/script\x3e\n    \x3cbody onload=\x26quot;init();\x26quot;\x3e\x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\/\/ 最简单返回html\n\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einit\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.name = \x3cspan class=\x22hljs-string\x22\x3e\x27hello\x27\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location = \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/demo.com\/empty.html\x27\x3c\/span\x3e\n    }\n    \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonload\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22init();\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e总结\x3c\/strong\x3e  \x3c\/p\x3e\n\x3cp\x3e优点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e可以发送任意类型的请求；\x3c\/li\x3e\n\x3cli\x3e不需要设置子域名。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e缺点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eiframe对浏览器性能影响较大；\x3c\/li\x3e\n\x3cli\x3e需要特殊接口支持，不能基于REST的API规范；\x3c\/li\x3e\n\x3cli\x3e每当你想要获取一条新的消息时都不得不发起两次网络请求，网络成本大；\x3c\/li\x3e\n\x3cli\x3e需要准备空白页，对它的访问是无意义的，影响流量统计。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3ewindow.hash\x3c\/h3\x3e\n\x3cp\x3e这个方法利用了location的特性：不同域的页面，可以写不可读。而只改变哈希部分（井号后面）不会导致页面跳转。也就是可以让父、子页面互相写对方的location的哈希部分，进行通讯。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e原理及流程\x3c\/strong\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e新建iframe，使用iframe访问一个非同源的地址（发请求），参数里带上父页面url；\x3c\/li\x3e\n\x3cli\x3e当页面加载完成后，iframe内脚本设置父页面的url并在哈希部分带上数据；\x3c\/li\x3e\n\x3cli\x3e父页面的脚本循环检查哈希值的变化，如果检查到有值就取值并清空哈希值；\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3e【PS】父页面会循环检查哈希是否改变来读取值，因为这种降级方案的使用环境一般是不会有hashchange事件的。演示里是最简单的get方法，如果想要发起其他类型的请求，可以类比采用模拟的form的方式进行改造，但记住不要丢失父页面的url。\x3c\/blockquote\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV7Qls?w=1346\x26amp;h=470\x22 src=\x22https:\/\/static.alili.tech\/img\/bV7Qls?w=1346\x26amp;h=470\x22 alt=\x22window.hash流程图\x22 title=\x22window.hash流程图\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 获取当前url\nvar url = window.location.href;\n\/\/ 新建iframe\nvar iframe = document.createElement(\x27iframe\x27);\n\/\/ 隐藏iframe并设置链接，把当前url带上\niframe.style.display = \x27none\x27;\niframe.src = \x27http:\/\/api.demo.com\/server.html?id=1\x26amp;url=\x27 \x2b encodeURIComponent(url);\n\nvar body = document.getElementByTagName(\x27body\x27)[0];\nbody.appendChild(iframe);\n\/\/ 循环监听处理\nvar listener = function(){\n    \/\/ 读取\n    var hash = location.hash;\n    \/\/ 还原\n    if(hash \x26amp;\x26amp; hash !== \x27#\x27){\n        console.log(hash.replace(\x27#\x27, \x27\x27));\n        window.loacation.href = url \x2b \x27#\x27;\n    }\n    \/\/ 继续监听\n    setTimeout(listener, 100);\n};\nlistener();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取当前url\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新建iframe\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e iframe = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 隐藏iframe并设置链接，把当前url带上\x3c\/span\x3e\niframe.style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27none\x27\x3c\/span\x3e;\niframe.src = \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/api.demo.com\/server.html?id=1\x26amp;url=\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-built_in\x22\x3eencodeURIComponent\x3c\/span\x3e(url);\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e body = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementByTagName(\x3cspan class=\x22hljs-string\x22\x3e\x27body\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\nbody.appendChild(iframe);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 循环监听处理\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e listener = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 读取\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e hash = location.hash;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 还原\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(hash \x26amp;\x26amp; hash !== \x3cspan class=\x22hljs-string\x22\x3e\x27#\x27\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(hash.replace(\x3cspan class=\x22hljs-string\x22\x3e\x27#\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e));\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.loacation.href = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27#\x27\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 继续监听\x3c\/span\x3e\n    setTimeout(listener, \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e);\n};\nlistener();\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 最简单返回html\n\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n    \x3cscript\x3e\n    function init(){\n        \/\/ 剪裁出父页面的url\n        var parentUrl = \x27\x27;\n        var url = window.location.href;\n        var str = url.split(\x27?\x27)[1].replace(\x27?\x27, \x27\x27);\n        strs = str.split(\x26quot;\x26amp;\x26quot;);\n        for(var i = 0; i \x3c strs.length; i \x2b\x2b) {\n            if(strs.split(\x26quot;=\x26quot;)[0] === \x27url\x27){\n                parentUrl = strs.split(\x26quot;=\x26quot;)[1];\n            }\n        }\n        \/\/ 设置到父页面上\n        window.parent.location = decodeURIComponent(parentUrl) \x2b \x27#helloworld\x27;\n    }\n    \x3c\/script\x3e\n    \x3cbody onload=\x26quot;init();\x26quot;\x3e\x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\/\/ 最简单返回html\n\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einit\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 剪裁出父页面的url\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e parentUrl = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e str = url.split(\x3cspan class=\x22hljs-string\x22\x3e\x27?\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].replace(\x3cspan class=\x22hljs-string\x22\x3e\x27?\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e);\n        strs = str.split(\x3cspan class=\x22hljs-string\x22\x3e\x22\x26amp;\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; strs.length; i \x2b\x2b) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(strs.split(\x3cspan class=\x22hljs-string\x22\x3e\x22=\x22\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] === \x3cspan class=\x22hljs-string\x22\x3e\x27url\x27\x3c\/span\x3e){\n                parentUrl = strs.split(\x3cspan class=\x22hljs-string\x22\x3e\x22=\x22\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n            }\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置到父页面上\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.parent.location = \x3cspan class=\x22hljs-built_in\x22\x3edecodeURIComponent\x3c\/span\x3e(parentUrl) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27#helloworld\x27\x3c\/span\x3e;\n    }\n    \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonload\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22init();\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e总结\x3c\/strong\x3e  \x3c\/p\x3e\n\x3cp\x3e优点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e可以发送任意类型的请求；\x3c\/li\x3e\n\x3cli\x3e不需要设置子域名。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e缺点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eiframe对浏览器性能影响较大；\x3c\/li\x3e\n\x3cli\x3e需要特殊接口支持，不能基于REST的API规范；\x3c\/li\x3e\n\x3cli\x3e循环检查哈希需要消耗性能；\x3c\/li\x3e\n\x3cli\x3e返回数据受浏览器URL最大长度2083字符限制。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e现代的标准\x3c\/h2\x3e\n\x3cp\x3eW3C的标准化跨域方案，让现代浏览器跨域已经不是什么复杂的事。这部分网上资料已经很多，这里就只是简单介绍。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3eCORS\x3c\/h3\x3e\n\x3cp\x3eCORS是一个W3C标准，全称是\x22跨域资源共享\x22（Cross-origin resource sharing）。  \x3cbr\x3e它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。  \x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/HTTP\/Access_control_CORS\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCORS参考文档\x3c\/a\x3e  \x3cbr\x3e\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2016\/04\/cors.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e跨域资源共享 CORS 详解\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3epostMessage\x3c\/h3\x3e\n\x3cp\x3eH5的window.postMessage为浏览器带来了一个安全的。基于事件的消息api。  \x3cbr\x3e只要是window对象，基本都可以使用这个方法，也就是说window.name、window.hash这类风骚的操作都已成为降级方案。  \x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/Window\/postMessage\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epostMessage参考文档\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e安全问题\x3c\/h2\x3e\n\x3cp\x3e上述的各类非标准的骚操作，都算是对同源策略的破解办法，在方便开发者完成跨域目的的同时，各类恶意的攻击者也自然会利用这些方案为非作歹。  \x3cbr\x3e其中子域名代理的风险最低，因为需要服务器设置特定的子域名，也就是已经是两个源的协商结果，一般黑客是难以模拟的。  \x3cbr\x3e风险最高的要算JSON-P的方案，因为这是任何客户端都可随意使用的办法，CSRF攻击的核心也是利用了特定标签的跨域性发起请求，所以JSON-P最好用在无用户状态的低安全性API上。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>【Geek议题】当年那些风骚的跨域操作</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014223524">https://segmentfault.com/a/1190000014223524</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/fvsu3n9kl9d/" target="_blank">https://alili.tech/archive/fvsu3n9kl9d/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>