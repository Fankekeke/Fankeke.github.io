<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="从不用 try-catch 实现的 async/await 语法说错误处理"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>从不用 try-catch 实现的 async/await 语法说错误处理 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/fw5oddg4aw4/",
				"appid": "1613049289050283", 
				"title": "从不用 try-catch 实现的 async/await 语法说错误处理 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-27T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/z4npqsk2bth/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/3n2g17cntpp/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ffw5oddg4aw4%2f&text=%e4%bb%8e%e4%b8%8d%e7%94%a8%20try-catch%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20async%2fawait%20%e8%af%ad%e6%b3%95%e8%af%b4%e9%94%99%e8%af%af%e5%a4%84%e7%90%86"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ffw5oddg4aw4%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ffw5oddg4aw4%2f&text=%e4%bb%8e%e4%b8%8d%e7%94%a8%20try-catch%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20async%2fawait%20%e8%af%ad%e6%b3%95%e8%af%b4%e9%94%99%e8%af%af%e5%a4%84%e7%90%86"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ffw5oddg4aw4%2f&title=%e4%bb%8e%e4%b8%8d%e7%94%a8%20try-catch%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20async%2fawait%20%e8%af%ad%e6%b3%95%e8%af%b4%e9%94%99%e8%af%af%e5%a4%84%e7%90%86"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ffw5oddg4aw4%2f&is_video=false&description=%e4%bb%8e%e4%b8%8d%e7%94%a8%20try-catch%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20async%2fawait%20%e8%af%ad%e6%b3%95%e8%af%b4%e9%94%99%e8%af%af%e5%a4%84%e7%90%86"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bb%8e%e4%b8%8d%e7%94%a8%20try-catch%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20async%2fawait%20%e8%af%ad%e6%b3%95%e8%af%b4%e9%94%99%e8%af%af%e5%a4%84%e7%90%86&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ffw5oddg4aw4%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ffw5oddg4aw4%2f&title=%e4%bb%8e%e4%b8%8d%e7%94%a8%20try-catch%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20async%2fawait%20%e8%af%ad%e6%b3%95%e8%af%b4%e9%94%99%e8%af%af%e5%a4%84%e7%90%86"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffw5oddg4aw4%2f&title=%e4%bb%8e%e4%b8%8d%e7%94%a8%20try-catch%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20async%2fawait%20%e8%af%ad%e6%b3%95%e8%af%b4%e9%94%99%e8%af%af%e5%a4%84%e7%90%86"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffw5oddg4aw4%2f&title=%e4%bb%8e%e4%b8%8d%e7%94%a8%20try-catch%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20async%2fawait%20%e8%af%ad%e6%b3%95%e8%af%b4%e9%94%99%e8%af%af%e5%a4%84%e7%90%86"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffw5oddg4aw4%2f&title=%e4%bb%8e%e4%b8%8d%e7%94%a8%20try-catch%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20async%2fawait%20%e8%af%ad%e6%b3%95%e8%af%b4%e9%94%99%e8%af%af%e5%a4%84%e7%90%86"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">从不用 try-catch 实现的 async/await 语法说错误处理</h1><div class="meta"><div class="postdate"><time datetime="2018-12-27" itemprop="datePublished">2018-12-27</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e前不久看到 \x3ca href=\x22http:\/\/blog.grossman.io\/author\/dima\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eDima Grossman\x3c\/a\x3e 写的 \x3ca href=\x22http:\/\/blog.grossman.io\/how-to-write-async-await-without-try-catch-blocks-in-javascript\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHow to write async await without try-catch blocks in Javascript\x3c\/a\x3e。看到标题的时候，我感到非常好奇。我知道虽然在异步程序中可以不使用 try-catch 配合 async\/await 来处理错误，但是处理方式并不能与 async\/await 配合得很好，所以很想知道到底有什么办法会比 try-catch 更好用。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eDima 去除 try-catch 的方法\x3c\/h2\x3e\n\x3cp\x3e当然套路依旧，Dima 讲到了回调地狱，Promise 链并最终引出了 async\/await。而在处理错误的时候，他并不喜欢 try-catch 的方式，所以写了一个 \x3ccode\x3eto(promise)\x3c\/code\x3e 来对 Promise 进行封装，辅以解构语法，实现了同步写法但类似 Node 错误标准的代码。摘抄代码如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ to.js\nexport default function to(promise) {\n    return promise\n        .then(data =\x3e {\n            return [null, data];\n        })\n        .catch(err =\x3e [err]);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ to.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eto\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epromise\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e promise\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e [\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, data];\n        })\n        .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e [err]);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e应用示例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import to from \x26quot;.\/to.js\x26quot;;\n\nasync function asyncTask(cb) {\n    let err, user, savedTask;\n\n    [err, user] = await to(UserModel.findById(1));\n    if (!user) return cb(\x26quot;No user found\x26quot;);\n\n    [err, savedTask] = await to(TaskModel({ userId: user.id, name: \x26quot;Demo Task\x26quot; }));\n    if (err) return cb(\x26quot;Error occurred while saving task\x26quot;);\n\n    if (user.notificationsEnabled) {\n        const [err] = await to(NotificationService.sendNotification(user.id, \x26quot;Task Created\x26quot;));\n        if (err) return cb(\x26quot;Error while sending notification\x26quot;);\n    }\n\n    cb(null, savedTask);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e to \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22.\/to.js\x22\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3easyncTask\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e err, user, savedTask;\n\n    [err, user] = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e to(UserModel.findById(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e));\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!user) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cb(\x3cspan class=\x22hljs-string\x22\x3e\x22No user found\x22\x3c\/span\x3e);\n\n    [err, savedTask] = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e to(TaskModel({ \x3cspan class=\x22hljs-attr\x22\x3euserId\x3c\/span\x3e: user.id, \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Demo Task\x22\x3c\/span\x3e }));\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cb(\x3cspan class=\x22hljs-string\x22\x3e\x22Error occurred while saving task\x22\x3c\/span\x3e);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (user.notificationsEnabled) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e [err] = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e to(NotificationService.sendNotification(user.id, \x3cspan class=\x22hljs-string\x22\x3e\x22Task Created\x22\x3c\/span\x3e));\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cb(\x3cspan class=\x22hljs-string\x22\x3e\x22Error while sending notification\x22\x3c\/span\x3e);\n    }\n\n    cb(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, savedTask);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eDima 的办法让人产生的了熟悉的感觉，Node 的回调中不是经常都这样写吗？\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(err, data) =\x3e {\n    if (err) {\n        \/\/ deal with error\n    } else {\n        \/\/ deal with data\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e(err, data) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ deal with error\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ deal with data\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e所以这个方法真的很有意思。不过回过头来想一想，这段代码中每当遇到错误，都是将错误消息通过 \x3ccode\x3ecb()\x3c\/code\x3e 调用推出去，同时中断后续过程。像这种中断式的错误处理，其实正适合采用 try-catch。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e使用 try-catch 改写上面的代码\x3c\/h2\x3e\n\x3cp\x3e要用 try-catch 改写上面的代码，首先要去掉 \x3ccode\x3eto()\x3c\/code\x3e 封装。这样，一旦发生错误，需要使用 \x3ccode\x3ePromise.prototype.catch()\x3c\/code\x3e 进行捕捉，或者使用 try-catch 对 \x3ccode\x3eawait promise\x3c\/code\x3e 语句进行捕捉。捕捉到的，当然是每个业务代码里 \x3ccode\x3ereject\x3c\/code\x3e 出来的 \x3ccode\x3eerr\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e然而注意，上面的代码中并没有直接使用 \x3ccode\x3eerr\x3c\/code\x3e，而是使用了自定义的错误消息。所以需要对 reject 出来的 \x3ccode\x3eerr\x3c\/code\x3e 进一步处理成指定的错误消息。当然这难不到谁，比如\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22someAsync().catch(err =\x3e Promise.reject(\x26quot;specified message\x26quot;));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3esomeAsync().catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-string\x22\x3e\x22specified message\x22\x3c\/span\x3e));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后再最外层加上 try-catch 就好。所以改写之后的代码是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22async function asyncTask(cb) {\n    try {\n        const user = await UserModel.findById(1)\n            .catch(err =\x3e Promise.reject(\x26quot;No user found\x26quot;));\n\n        const savedTask = await TaskModel({ userId: user.id, name: \x26quot;Demo Task\x26quot; })\n            .catch(err =\x3e Promise.reject(\x26quot;Error occurred while saving task\x26quot;));\n\n        if (user.notificationsEnabled) {\n            await NotificationService.sendNotification(user.id, \x26quot;Task Created\x26quot;)\n                .catch(err =\x3e Promise.reject(\x26quot;Error while sending notification\x26quot;));\n        }\n\n        cb(null, savedTask);\n    } catch (err) {\n        cb(err);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3easyncTask\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e user = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e UserModel.findById(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\n            .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-string\x22\x3e\x22No user found\x22\x3c\/span\x3e));\n\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e savedTask = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e TaskModel({ \x3cspan class=\x22hljs-attr\x22\x3euserId\x3c\/span\x3e: user.id, \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Demo Task\x22\x3c\/span\x3e })\n            .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-string\x22\x3e\x22Error occurred while saving task\x22\x3c\/span\x3e));\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (user.notificationsEnabled) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e NotificationService.sendNotification(user.id, \x3cspan class=\x22hljs-string\x22\x3e\x22Task Created\x22\x3c\/span\x3e)\n                .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-string\x22\x3e\x22Error while sending notification\x22\x3c\/span\x3e));\n        }\n\n        cb(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, savedTask);\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n        cb(err);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面这段代码，从代码量上来说，并没有比 Dima 的代码减少了多少工作量，只是去掉了大量 \x3ccode\x3eif (err) {}\x3c\/code\x3e 结构。不习惯使用 try-catch 的程序员找找不到中断点，但习惯了 try-catch 的程序员都知道，业务过程中一旦发生错误（异步代码里指 reject），代码就会跳到 \x3ccode\x3ecatch\x3c\/code\x3e 块去处理 reject 出来的值。\x3c\/p\x3e\n\x3cp\x3e但是，一般业务代码 reject 出来的信息通常都是有用的。假如上面的每个业务 reject 出来的 err 本身就是错误消息，那么，用 Dima 的模式，仍然需要写\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (err) return cb(err);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cb(err);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而用 try-catch 的模式，就简单多了\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22async function asyncTask(cb) {\n    try {\n        const user = await UserModel.findById(1);\n        const savedTask = await TaskModel({ userId: user.id, name: \x26quot;Demo Task\x26quot; });\n\n        if (user.notificationsEnabled) {\n            await NotificationService.sendNotification(user.id, \x26quot;Task Created\x26quot;);\n        }\n\n        cb(null, savedTask);\n    } catch (err) {\n        cb(err);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3easyncTask\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e user = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e UserModel.findById(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e savedTask = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e TaskModel({ \x3cspan class=\x22hljs-attr\x22\x3euserId\x3c\/span\x3e: user.id, \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Demo Task\x22\x3c\/span\x3e });\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (user.notificationsEnabled) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e NotificationService.sendNotification(user.id, \x3cspan class=\x22hljs-string\x22\x3e\x22Task Created\x22\x3c\/span\x3e);\n        }\n\n        cb(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, savedTask);\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n        cb(err);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为什么？因为在 Dima 的模式中，\x3ccode\x3eif (err)\x3c\/code\x3e 实际上处理了两个业务：一是捕捉会引起中断的 \x3ccode\x3eerr\x3c\/code\x3e ，并将其转换为错误消息，二是通过 \x3ccode\x3ereturn\x3c\/code\x3e 中断业务过程。所以当 \x3ccode\x3eerr\x3c\/code\x3e 转换为错误消息这一过程不再需要的时候，这种捕捉中断再重新引起中断的处理就显得多余了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e继续改进\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e用函数表达式改善 try-catch 逻辑\x3c\/h3\x3e\n\x3cp\x3e当然还有改进的空间，比如 \x3ccode\x3etry {}\x3c\/code\x3e 块中的代码比较长，会造成阅读不太方便，try-catch 的逻辑有被“切断”的感觉。这种情况下可以使用函数表达式来改善\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22async function asyncTask(cb) {\n    async function process() {\n        const user = await UserModel.findById(1);\n        const savedTask = await TaskModel({ userId: user.id, name: \x26quot;Demo Task\x26quot; });\n\n        if (user.notificationsEnabled) {\n            await NotificationService.sendNotification(user.id, \x26quot;Task Created\x26quot;);\n        }\n        return savedTask;\n    }\n\n    try {\n        cb(null, await process());\n    } catch (err) {\n        cb(err);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3easyncTask\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eprocess\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e user = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e UserModel.findById(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e savedTask = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e TaskModel({ \x3cspan class=\x22hljs-attr\x22\x3euserId\x3c\/span\x3e: user.id, \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Demo Task\x22\x3c\/span\x3e });\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (user.notificationsEnabled) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e NotificationService.sendNotification(user.id, \x3cspan class=\x22hljs-string\x22\x3e\x22Task Created\x22\x3c\/span\x3e);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e savedTask;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        cb(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e process());\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n        cb(err);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果对错误的处理代码比较长，也可以写成单独的函数表达式。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e如果过程中每一步的错误处理逻辑不同怎么办\x3c\/h3\x3e\n\x3cp\x3e如果发生错误，不再转换为错误消息，而是特定的错误处理逻辑，怎么办？\x3c\/p\x3e\n\x3cp\x3e思考一下，我们用字符串来表示错误消息，以后可以通过 \x3ccode\x3econsole.log()\x3c\/code\x3e 来处理处理。而逻辑，最适合的表示当然是函数表达式，最终可以通过调用来进行统一处理\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22async function asyncTask(cb) {\n    async function process() {\n        const user = await UserModel.findById(1)\n            .catch(err =\x3e Promise.reject(() =\x3e {\n                \/\/ deal with error on looking for the user\n                return \x26quot;No user found\x26quot;;\n            }));\n\n        const savedTask = await TaskModel({ userId: user.id, name: \x26quot;Demo Task\x26quot; })\n            .catch(err =\x3e Promise.reject(() =\x3e {\n                \/\/ making model error\n                \/\/ deal with it\n                return err === 1\n                    ? \x26quot;Error occurred while saving task\x26quot;\n                    : \x26quot;Error occurred while making model\x26quot;;\n            }));\n\n        if (user.notificationsEnabled) {\n            await NotificationService.sendNotification(user.id, \x26quot;Task Created\x26quot;)\n                .catch(err =\x3e Promise.reject(() =\x3e {\n                    \/\/ just print a message\n                    logger.log(err);\n                    return \x26quot;Error while sending notification\x26quot;;\n                }));\n        }\n\n        return savedTask;\n    }\n\n    try {\n        cb(null, await process());\n    } catch (func) {\n        cb(func());\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3easyncTask\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eprocess\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e user = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e UserModel.findById(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\n            .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ deal with error on looking for the user\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22No user found\x22\x3c\/span\x3e;\n            }));\n\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e savedTask = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e TaskModel({ \x3cspan class=\x22hljs-attr\x22\x3euserId\x3c\/span\x3e: user.id, \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Demo Task\x22\x3c\/span\x3e })\n            .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ making model error\x3c\/span\x3e\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ deal with it\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e err === \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n                    ? \x3cspan class=\x22hljs-string\x22\x3e\x22Error occurred while saving task\x22\x3c\/span\x3e\n                    : \x3cspan class=\x22hljs-string\x22\x3e\x22Error occurred while making model\x22\x3c\/span\x3e;\n            }));\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (user.notificationsEnabled) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e NotificationService.sendNotification(user.id, \x3cspan class=\x22hljs-string\x22\x3e\x22Task Created\x22\x3c\/span\x3e)\n                .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ just print a message\x3c\/span\x3e\n                    logger.log(err);\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22Error while sending notification\x22\x3c\/span\x3e;\n                }));\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e savedTask;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        cb(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e process());\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (func) {\n        cb(func());\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e甚至还可以处理更复杂的情况\x3c\/h3\x3e\n\x3cp\x3e现在应该都知道 \x3ccode\x3e.catch(err =\x26gt; Promise.reject(xx))\x3c\/code\x3e，这里的 \x3ccode\x3exx\x3c\/code\x3e 就是 try-catch 的 catch 块捕捉到的对象，所以如果不同的业务 reject 出来不同的对象，比如有些是函数（表示错误处理逻辑），有些是字符串（表示错误消息），有些是数字（表示错误代码）——其实只需要改 catch 块就行\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    try {\n        \/\/ ...   \n    } catch(something) {\n        switch (typeof something) {\n            case \x26quot;string\x26quot;:\n                \/\/ show message something\n                break;\n            case \x26quot;function\x26quot;:\n                something();\n                break;\n            case \x26quot;number\x26quot;:\n                \/\/ look up something as code\n                \/\/ and show correlative message\n                break;\n            default:\n                \/\/ deal with unknown error\n        }\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...   \x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(something) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e something) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22string\x22\x3c\/span\x3e:\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ show message something\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22function\x22\x3c\/span\x3e:\n                something();\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22number\x22\x3c\/span\x3e:\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ look up something as code\x3c\/span\x3e\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ and show correlative message\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ deal with unknown error\x3c\/span\x3e\n        }\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e小结\x3c\/h2\x3e\n\x3cp\x3e我没有批判 Dima 的错误处理方式，这个错误处理方式很好，很符合 Node 错误处理的风格，也一定会受到很多人的喜爱。由于 Dima 的错误处理方式给带灵感，同时也让我再次审视了一直比较喜欢的 try-catch 方式。\x3c\/p\x3e\n\x3cp\x3e用什么方式取决于适用场景、团队约定和个人喜好等多种因素，在不同的情况下需要采用不同的处理方式，并不是说哪一种就一定好于另一种——合适的才是最好的！\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>从不用 try-catch 实现的 async/await 语法说错误处理</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011802045">https://segmentfault.com/a/1190000011802045</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/fw5oddg4aw4/" target="_blank">https://alili.tech/archive/fw5oddg4aw4/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>