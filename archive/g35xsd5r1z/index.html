<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="一篇文章吃透Jsonp"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>一篇文章吃透Jsonp | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/g35xsd5r1z/",
				"appid": "1613049289050283", 
				"title": "一篇文章吃透Jsonp | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-17T02:30:06"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/0lk8ykuj573s/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/hpogz836fy/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fg35xsd5r1z%2f&text=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e5%90%83%e9%80%8fJsonp"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fg35xsd5r1z%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fg35xsd5r1z%2f&text=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e5%90%83%e9%80%8fJsonp"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fg35xsd5r1z%2f&title=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e5%90%83%e9%80%8fJsonp"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fg35xsd5r1z%2f&is_video=false&description=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e5%90%83%e9%80%8fJsonp"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e5%90%83%e9%80%8fJsonp&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fg35xsd5r1z%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fg35xsd5r1z%2f&title=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e5%90%83%e9%80%8fJsonp"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fg35xsd5r1z%2f&title=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e5%90%83%e9%80%8fJsonp"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fg35xsd5r1z%2f&title=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e5%90%83%e9%80%8fJsonp"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fg35xsd5r1z%2f&title=%e4%b8%80%e7%af%87%e6%96%87%e7%ab%a0%e5%90%83%e9%80%8fJsonp"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">一篇文章吃透Jsonp</h1><div class="meta"><div class="postdate"><time datetime="2018-12-17" itemprop="datePublished">2018-12-17</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch3 id=\x22articleHeader0\x22\x3e前言\x3c\/h3\x3e\n\x3cp\x3e最近因为工作的缘故，几乎把市面上所有Jsonp库都下载了一遍，却发现没有百分百让我满意的，最后自己手动改写了\x3ca href=\x22https:\/\/www.npmjs.com\/package\/jsonp\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eJsonp\x3c\/a\x3e，才符合了要求，也因此有了这篇文章。本文示例详实，代码简单，想弄明白Jsonp, 这一篇文章就够了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e什么是Jsonp\x3c\/h3\x3e\n\x3cp\x3e因为AJAX收到\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/Security\/Same-origin_policy\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e浏览器同源策略\x3c\/a\x3e的限制，导致在跨域上有心无力，经常需要后台同学的帮助。而在浏览器中，所有带有src的标签都是不受同源策略限制的，如image, script。Jsonp上就是利用了script标签的这个特点，来实现跨域的。\x3c\/p\x3e\n\x3cp\x3e其中，\x3cstrong\x3eJsonp和AJAX的原理完全不同，只不过Jquery带了个很不好的头，把两个东西封装在一起了，所以经常让新的同学混淆了。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3eJsonp的原理：script src\x3cbr\x3eAJAX的原理：xhr\x3c\/blockquote\x3e\n\x3cp\x3e举一个最简单的Jsonp的例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE html\x3e\n\x3chtml lang=\x26quot;en\x26quot;\x3e\n\n\x3chead\x3e\n    \x3cmeta charset=\x26quot;UTF-8\x26quot;\x3e\n    \x3cmeta name=\x26quot;viewport\x26quot; content=\x26quot;width=device-width, initial-scale=1.0\x26quot;\x3e\n    \x3cmeta http-equiv=\x26quot;X-UA-Compatible\x26quot; content=\x26quot;ie=edge\x26quot;\x3e\n    \x3ctitle\x3eJsonp简单示例\x3c\/title\x3e\n\x3c\/head\x3e\n\n\x3cbody\x3e\n\x3c\/body\x3e\n\x3cscript type=\x26quot;text\/javascript\x26quot;\x3e\n    \/\/ Jsonp回调\n    function jsonCallback(data) {\n        console.log(data);\n    }\n\n    \/\/添加\x3cscript\x3e标签的方法\n    function addScriptTag(src) {\n        var script = document.createElement(\x27script\x27);\n        script.setAttribute(\x26quot;type\x26quot;, \x26quot;text\/javascript\x26quot;);\n        script.src = src;\n        document.body.appendChild(script);\n    }\n\n    \/\/ 向后台发起请求（链接是胡乱写的）\n    addScriptTag(\x27http:\/\/www.qq.com\/getJsonp?callback=jsonCallback\x27)\n\x3c\/script\x3e\n\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elang\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22en\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22UTF-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22viewport\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22width=device-width, initial-scale=1.0\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehttp-equiv\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22X-UA-Compatible\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22ie=edge\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3eJsonp简单示例\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\/javascript\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Jsonp回调\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ejsonCallback\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data);\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/添加\x26lt;script\x26gt;标签的方法\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eaddScriptTag\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esrc\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e script = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e);\n        script.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x22type\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22text\/javascript\x22\x3c\/span\x3e);\n        script.src = src;\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.appendChild(script);\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 向后台发起请求（链接是胡乱写的）\x3c\/span\x3e\n    addScriptTag(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/www.qq.com\/getJsonp?callback=jsonCallback\x27\x3c\/span\x3e)\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ehttp:\/\/www.qq.com\/getJsonp?callback=jsonCallback\x3c\/code\x3e这个链接返回的内容应该是\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22jsonpCallback({\n    msg: success\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3ejsonpCallback\x3c\/span\x3e({\n    \x3cspan class=\x22hljs-attribute\x22\x3emsg\x3c\/span\x3e: success\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样，相当于后台调用了前台提前写好的callback函数，将要返回的数据当做callback函数的参数传入，这样前端就拿到后台传回来的数据了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e改写Jsonp\x3c\/h3\x3e\n\x3cp\x3e但是坦白来说，单纯的拿到数据并不能让我们满意。一个合适的请求函数，必然包含对成功、失败、超时的处理，就像我们上面写的那个简单示例，一旦出现异常，就不能让我们满意了。\x3c\/p\x3e\n\x3cp\x3e在这一点上不得不说Jquery做的很好，Jquery的Jsonp函数包含了对各种情况的处理，还伪造了一个http状态码的返回。\x3c\/p\x3e\n\x3cblockquote\x3eJsonp和AJAX不同，是拿不到状态码的，但是Jquery对于所有的错误都赋予了一个404的状态码，也是机智\x3c\/blockquote\x3e\n\x3cp\x3e对比其他的组件库（axios-jsonp, axios-jsonp-pro, jsonp, fetch=jsonp-es6）, 要不就是完全没有对超时的处理，要不然就是把错误和超时混成一谭，更有甚者，有些都不能自定义callback函数的名字。这简直太过分了。\x3c\/p\x3e\n\x3cp\x3e那我为什么不选择Jquery呢？因为太大了，webpack引入JQuery后瞬间大了80K, 而且单独将Jsonp打包出来也有70K的样子，而我的源码只有20K，这是我不能接受的。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.npmjs.com\/package\/jsonp\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ejsonp\x3c\/a\x3e这个组件的问题是没有对错误的处理，理解了Jsonp的原理，我们能很容易的添加上这块的逻辑，以下是添加后的源码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * Module exports.\n *\/\n\nmodule.exports = jsonp;\n\n\/**\n * Callback index.\n *\/\n\nvar count = 0;\n\n\/**\n * Noop function.\n *\/\n\nfunction noop(){}\n\n\/**\n * JSONP handler\n *\n * Options:\n *  - param {String} qs parameter (`callback`)\n *  - prefix {String} qs parameter (`__jp`)\n *  - name {String} qs parameter (`prefix` \x2b incr)\n *  - timeout {Number} how long after a timeout error is emitted (`60000`)\n *\n * @param {String} url\n * @param {Object|Function} optional options \/ callback\n * @param {Function} optional callback\n *\/\n\nfunction jsonp(url, opts, fn){\n  if (\x27function\x27 == typeof opts) {\n    fn = opts;\n    opts = {};\n  }\n  if (!opts) opts = {};\n\n  var prefix = opts.prefix || \x27__jp\x27;\n\n  \/\/ use the callback name that was passed if one was provided.\n  \/\/ otherwise generate a unique name by incrementing our counter.\n  var id = opts.name || (prefix \x2b (count\x2b\x2b));\n\n  var param = opts.param || \x27callback\x27;\n  var timeout = null != opts.timeout ? opts.timeout : 60000;\n  var enc = encodeURIComponent;\n  var target = document.getElementsByTagName(\x27script\x27)[0] || document.head;\n  var script;\n  var timer;\n\n\n  if (timeout) {\n    timer = setTimeout(function(){\n      cleanup();\n      if (fn) fn(new Error(\x27Timeout\x27));\n    }, timeout);\n  }\n\n  function cleanup(){\n    if (script.parentNode) script.parentNode.removeChild(script);\n    window[id] = noop;\n    if (timer) clearTimeout(timer);\n  }\n\n  function cancel(){\n    if (window[id]) {\n      cleanup();\n    }\n  }\n\n  window[id] = function(data){\n    cleanup();\n    if (fn) fn(null, data);\n  };\n\n  \/\/ add qs component\n  url \x2b= (~url.indexOf(\x27?\x27) ? \x27\x26amp;\x27 : \x27?\x27) \x2b param \x2b \x27=\x27 \x2b enc(id);\n  url = url.replace(\x27?\x26amp;\x27, \x27?\x27);\n\n  \/\/ create script\n  script = document.createElement(\x27script\x27);\n  script.src = url;\n  \n  \/\/ 添加对错误的处理\n  script.onerror = function (evt) {\n      if (fn) fn(new Error(\x27Error\x27));\n      if (timer) clearTimeout(timer)\n  }\n  target.parentNode.insertBefore(script, target);\n\n  return cancel;\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * Module exports.\n *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = jsonp;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * Callback index.\n *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e count = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * Noop function.\n *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enoop\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * JSONP handler\n *\n * Options:\n *  - param {String} qs parameter (`callback`)\n *  - prefix {String} qs parameter (`__jp`)\n *  - name {String} qs parameter (`prefix` \x2b incr)\n *  - timeout {Number} how long after a timeout error is emitted (`60000`)\n *\n * @param {String} url\n * @param {Object|Function} optional options \/ callback\n * @param {Function} optional callback\n *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ejsonp\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, opts, fn\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e == \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e opts) {\n    fn = opts;\n    opts = {};\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!opts) opts = {};\n\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e prefix = opts.prefix || \x3cspan class=\x22hljs-string\x22\x3e\x27__jp\x27\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ use the callback name that was passed if one was provided.\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ otherwise generate a unique name by incrementing our counter.\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e id = opts.name || (prefix \x2b (count\x2b\x2b));\n\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e param = opts.param || \x3cspan class=\x22hljs-string\x22\x3e\x27callback\x27\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e timeout = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e != opts.timeout ? \x3cspan class=\x22hljs-attribute\x22\x3eopts.timeout\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e60000\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e enc = \x3cspan class=\x22hljs-built_in\x22\x3eencodeURIComponent\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e target = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementsByTagName(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] || \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.head;\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e script;\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e timer;\n\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (timeout) {\n    timer = setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n      cleanup();\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (fn) fn(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Timeout\x27\x3c\/span\x3e));\n    }, timeout);\n  }\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecleanup\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (script.parentNode) script.parentNode.removeChild(script);\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e[id] = noop;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (timer) clearTimeout(timer);\n  }\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecancel\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e[id]) {\n      cleanup();\n    }\n  }\n\n  \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e[id] = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    cleanup();\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (fn) fn(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, data);\n  };\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ add qs component\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e \x2b= (~\x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27?\x27\x3c\/span\x3e) ? \x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27?\x27\x3c\/span\x3e) \x2b param \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e \x2b enc(id);\n  \x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e = \x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e.replace(\x3cspan class=\x22hljs-string\x22\x3e\x27?\x26amp;\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27?\x27\x3c\/span\x3e);\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ create script\x3c\/span\x3e\n  script = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e);\n  script.src = \x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e;\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加对错误的处理\x3c\/span\x3e\n  script.onerror = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eevt\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (fn) fn(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Error\x27\x3c\/span\x3e));\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (timer) clearTimeout(timer)\n  }\n  target.parentNode.insertBefore(script, target);\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cancel;\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e因为大部分是人家的代码，我也就不班门弄斧了，\x3cstrong\x3e有需要的可以直接npm install jsonp, 然后比对node_modules\/jsonp\/index.js进行修改\x3c\/strong\x3e；有需要对Jsonp有更详细的处理的，也可以在我的基础上继续添加。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e总结\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3eJsonp的本质就是创建一个回调函数，然后在远程服务上调用这个函数并且将JSON数据形式作为参数传递，完成回调。\x3c\/strong\x3e比起另外两种后台无感知的跨域方案：image src、fetch no-cor，Jsonp可以对错误和超时进行处理，也能对后台返回的数据进行分析；而对于AJAX，Jsonp免去了后台添加跨域头的烦恼，后台的改动较小，一次写好，终生受用（跨域头还要不断维护白名单）。这三种方案都有各自的使用场景，要在不同的场景进行恰当的选用，以上。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>一篇文章吃透Jsonp</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012922875">https://segmentfault.com/a/1190000012922875</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/g35xsd5r1z/" target="_blank">https://alili.tech/archive/g35xsd5r1z/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>