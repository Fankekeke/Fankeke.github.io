<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React 可视化开发工具 shadow-widget 最佳实践（上）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React 可视化开发工具 shadow-widget 最佳实践（上） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/gq78r0n66b/",
				"appid": "1613049289050283", 
				"title": "React 可视化开发工具 shadow-widget 最佳实践（上） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-29T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/a1udipj7esa/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/250rayg7guu/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fgq78r0n66b%2f&text=React%20%e5%8f%af%e8%a7%86%e5%8c%96%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7%20shadow-widget%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fgq78r0n66b%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fgq78r0n66b%2f&text=React%20%e5%8f%af%e8%a7%86%e5%8c%96%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7%20shadow-widget%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fgq78r0n66b%2f&title=React%20%e5%8f%af%e8%a7%86%e5%8c%96%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7%20shadow-widget%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fgq78r0n66b%2f&is_video=false&description=React%20%e5%8f%af%e8%a7%86%e5%8c%96%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7%20shadow-widget%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%20%e5%8f%af%e8%a7%86%e5%8c%96%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7%20shadow-widget%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%ef%bc%88%e4%b8%8a%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fgq78r0n66b%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fgq78r0n66b%2f&title=React%20%e5%8f%af%e8%a7%86%e5%8c%96%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7%20shadow-widget%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgq78r0n66b%2f&title=React%20%e5%8f%af%e8%a7%86%e5%8c%96%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7%20shadow-widget%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgq78r0n66b%2f&title=React%20%e5%8f%af%e8%a7%86%e5%8c%96%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7%20shadow-widget%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgq78r0n66b%2f&title=React%20%e5%8f%af%e8%a7%86%e5%8c%96%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7%20shadow-widget%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5%ef%bc%88%e4%b8%8a%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React 可视化开发工具 shadow-widget 最佳实践（上）</h1><div class="meta"><div class="postdate"><time datetime="2018-12-29" itemprop="datePublished">2018-12-29</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e本文介绍 \x22React \x2b Shadow Widget\x22 应用于通用 GUI 开发的最佳实践，只聚焦于典型场景下最优开发方法。分上、下两篇讲解，上篇概述最佳实践，介绍功能块划分。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVWu3d?w=600\x26amp;h=400\x22 src=\x22https:\/\/static.alili.tech\/img\/bVWu3d?w=600\x26amp;h=400\x22 alt=\x22Thumbnail\x22 title=\x22Thumbnail\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e1. 最佳实践概述\x3c\/h2\x3e\n\x3cp\x3e按遵循 ES5 与 ES6\x2b 区分，Shadow Widget 支持两种开发方式，一是用 ES5 做开发，二是搭建 Babel 转译环境用 ES6\x2b 做开发，之所以划分两大类，因为它们之间差别不仅仅是 javascript 代码转译，而是涉及在哪个层面定义 React Class，进而与源码在上层还是下层维护，以及与他人如何协作等相关。\x3c\/p\x3e\n\x3cp\x3e如本系列博客《shadow-widget 的非可视开发方法》一文介绍，用 ES5 定义 React class 的方式是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var MyButton = T.Button._createClass( {\n  getDefaultProps: function() {\n    var props = T.Button.getDefaultProps();\n    \/\/ props.attr = value;\n    return props;\n  },\n  \n  getInitialState: function() {\n    var state = this._getInitialState(this);\n    \/\/ ...\n    return state;\n  }\n  \n  $onClick: function(event) {\n    alert(\x27clicked\x27);\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e MyButton = T.Button._createClass( {\n  \x3cspan class=\x22hljs-attr\x22\x3egetDefaultProps\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e props = T.Button.getDefaultProps();\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ props.attr = value;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e props;\n  },\n  \n  \x3cspan class=\x22hljs-attr\x22\x3egetInitialState\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e state = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._getInitialState(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e state;\n  }\n  \n  $onClick: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n    alert(\x3cspan class=\x22hljs-string\x22\x3e\x27clicked\x27\x3c\/span\x3e);\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而用 ES6\x2b 开发，这么定义 React class：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class MyButton_ extends T.Button_ {\n  constructor(name,desc) {\n    super(name,desc);\n  }\n  \n  getDefaultProps() {\n    var props = super.getDefaultProps();\n    \/\/ props.attr = value;\n    return props;\n  }\n  \n  getInitialState() {\n    var state = super.getInitialState();\n    \/\/ ...\n    return state;\n  }\n\n  $onClick: function(event) {\n    alert(\x27clicked\x27);\n  }\n}\n\nvar AbstractButton = new MyButton_();  \/\/ MyButton_ is WTC\nvar MyButton = AbstractButton._createClass(); \/\/ MyButton is React class\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMyButton_\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eT\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eButton_\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(name,desc) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(name,desc);\n  }\n  \n  getDefaultProps() {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e props = \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e.getDefaultProps();\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ props.attr = value;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e props;\n  }\n  \n  getInitialState() {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e state = \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e.getInitialState();\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e state;\n  }\n\n  $onClick: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n    alert(\x3cspan class=\x22hljs-string\x22\x3e\x27clicked\x27\x3c\/span\x3e);\n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e AbstractButton = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e MyButton_();  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ MyButton_ is WTC\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e MyButton = AbstractButton._createClass(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ MyButton is React class\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由于 ES6\x2b 语法能兼容 ES5，所以，即使采用 ES6\x2b 开发方式，前一种 ES5 的 React class 定义方法仍然适用。但，自定义扩展一个 WTC 类必须用 ES6\x2b，就象上面 \x3ccode\x3e\x22class MyButton_ extends T.Button_\x22\x3c\/code\x3e 语法，只能在 ES6\x2b 下书写。\x3c\/p\x3e\n\x3cp\x3e考虑到用 ES5 编程不必搭建 Babel 开发环境，ES5 能被 ES6\x2b 兼容，向 ES6\x2b 迁移只是整体平移，不必改源码。加上 Shadow Widget 及第 3 方类库，已提供够用的基础 WTC 类（这意味着我们并不迫切依赖于用 ES6\x2b 扩展 WTC），所以，我们将 Shadow Widget 最佳实践确定为：\x3cstrong\x3e用 ES5 实施主体开发\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3eShadow Widget 最佳开发实践的大致操作过程如下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e创建一个新的工程，参见《Shadow Widget 用户手册》（下面简称《手册》）中 “5.1.1 创建工程” 一节   \x3cbr\x3e应选择一个合适的 \x22网页样板\x22 来创建，Shadow Widget 是一个可继承重用的 lib 库体系，最基础的是 \x3ca href=\x22https:\/\/github.com\/rewgt\/shadow-server\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3eshadow-widget\x3c\/code\x3e\x3c\/a\x3e 库自身，其上还有 \x3ca href=\x22https:\/\/github.com\/rewgt\/shadow-slide\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3eshadow-slide\x3c\/code\x3e\x3c\/a\x3e，\x3ca href=\x22https:\/\/github.com\/rewgt\/blogs\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3epinp-blogs\x3c\/code\x3e\x3c\/a\x3e 等扩展库，各个扩展项目一般会提供它本层的网页样板（通常放在 \x3ccode\x3e\x26lt;project\x26gt;\/output\/shared\/pages\/\x3c\/code\x3e 目录下）。\x3c\/li\x3e\n\x3cli\x3e在创建的网页文件追加 \x3ccode\x3e\x26lt;script src=\x27your_file.js\x27\x26gt;\x26lt;\/script\x26gt;\x3c\/code\x3e 代码   \x3cbr\x3e然后在 \x3ccode\x3eyour_file.js\x3c\/code\x3e 文件编写 ES5 代码。\x3c\/li\x3e\n\x3cli\x3e使用 Shadow Widget 的可视设计器设计用户界面   \x3cbr\x3e用户界面设计的结果以转义标签的形式，保存在你的 \x3ccode\x3e\x22*.html\x22\x3c\/code\x3e 网页文件中，然后你可以在 \x3ccode\x3eyour_file.js\x3c\/code\x3e 同步编写 JS 代码。\x3c\/li\x3e\n\x3cli\x3e完成开发与测试后，把相关的 \x3ccode\x3ehtml, js, css\x3c\/code\x3e 等文件上传发布到服务器发布   \x3cbr\x3e因为不必做 ES6 转译，发布操作很直接。或许您要调整 \x3ccode\x3ejs, css, png\x3c\/code\x3e 等文件位置，或许您需 minify 某个 JS 文件，这些都是前端开发的基本技能，不是 Shadow Widget 特有的。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e最佳实践还建议多用 idSetter 函数定义各 component 的行为，不用（或少用）在 \x3ccode\x3emain[path]\x3c\/code\x3e 定义投影类的方式，因为 idSetter 的函数式风格，让 MVVM 与 Flux 两种框架的交汇点处理起来更便利。\x3c\/p\x3e\n\x3cp\x3e接下来，在展开细节介绍之前，我们先梳理一下 Shadow Widget 技术体系的几个特色概念。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e2. \x3ccode\x3ep-state\x3c\/code\x3e 与 \x3ccode\x3ev-state\x3c\/code\x3e\n\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3ep-state\x3c\/code\x3e 与 \x3ccode\x3ev-state\x3c\/code\x3e 是 uglee 在 \x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000008592692\x22\x3e《少妇白洁系列之 React StateUp Pattern, Explained》\x3c\/a\x3e 一文提出的概念，我们借用过来解释 React 中的数据流转模式。\x3ccode\x3ep-state\x3c\/code\x3e 指 \x3cstrong\x3epersistent state\x3c\/strong\x3e，是生命周期超过组件本身的 state 数据，即使组件从 DOM 上销毁，这些数据仍然需要在组件外部持久化。\x3ccode\x3ev-state\x3c\/code\x3e 指 \x3cstrong\x3evolatile state\x3c\/strong\x3e，是生命周期和组件一样的 state 数据，如果组件从 DOM 上销毁，这些 state 将一起销毁。\x3c\/p\x3e\n\x3cp\x3e结合 Flux 框架，\x3ccode\x3ev-state\x3c\/code\x3e 就是 \x3ccode\x3ecomp.props.xxx\x3c\/code\x3e 与 \x3ccode\x3ecomp.state.xxx\x3c\/code\x3e 数据，\x3ccode\x3ep-state\x3c\/code\x3e 就是 store 里的数据，这么说虽有失严谨，但大致如此。如果未使用 Flux 框架，对 \x3ccode\x3ecomp\x3c\/code\x3e 的 \x3ccode\x3erender()\x3c\/code\x3e 过程产生影响的所有数据中，全局变量或其它节点（包括上级节点）中的属性，都算当前节点的 \x3ccode\x3ep-state\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e不过，\x3cstrong\x3e\x3ccode\x3ev-state\x3c\/code\x3e 与 \x3ccode\x3ep-state\x3c\/code\x3e 划分是静态的，相对而言的\x3c\/strong\x3e。比如，初始设计界面只要求显示摄氏度（Celsius）格式的温度值，然后觉得要适应全球化应用，摄氏度与华氏度（Fahrenheit）都得显示，再往后发现，Celsius 与 Fahrenheit 并列显示不够友好，就改成动态可配置，取国别信息后自动设成两者中一个。这种设计变迁中，“当前温度格式” 与 “并列显示或只显示一种” 的配置数据经常在 \x3ccode\x3ev-state\x3c\/code\x3e 与 \x3ccode\x3ep-state\x3c\/code\x3e 之间变迁。\x3c\/p\x3e\n\x3cp\x3eReact 工具链上几个 Flux 框架主要区别在于，如何定位与使用 \x3ccode\x3ep-state\x3c\/code\x3e，它们对 \x3ccode\x3ev-state\x3c\/code\x3e 使用基本一致，我们拿 reflux、redux、shadow-widget 三者分别举例。\x3c\/p\x3e\n\x3cp\x3eReflux 采用多 store，其 store 设计与 component 很接近，可以这么简单理解：既然跨 Component 存在数据交互，父子关系可以用 \x3ccode\x3eprops\x3c\/code\x3e 传递，非父子关系传不了，怎么办呢？那就设立第三方实体（也就是 store）处理此事。Redux 采用单 store，把它理解成一大坨全局变量就好，它以 action 设计为提纲，围绕 action 组织 reducer 函数，而 Reflux 中提纲挈领的东西则是 store 中的数据，围绕数据组织 action 定义。若对比这两者，Reflux 方式更易理解，需求分解与设计展开过程更人性化，不过，Reflux 没有突破 React 固有限制，因为多 store 模式，实践中大家经常很纠结某项数据该放在 component 中，还是放在 store 中呢？如前所述，一项数据是否为 \x3ccode\x3ev-state\x3c\/code\x3e 是相对的，产品功能叠代后，数据经常要从 \x3ccode\x3ev-state\x3c\/code\x3e 提升到 \x3ccode\x3ep-state\x3c\/code\x3e，或者，若原设计偏于宽泛，还需将 \x3ccode\x3ep-state\x3c\/code\x3e 降回 \x3ccode\x3ev-state\x3c\/code\x3e。Reflux 困境在于 Store 设计与 Component 不对称，顺应来回变迁的成本较高。\x3c\/p\x3e\n\x3cp\x3eShadow Widget 也是多 Store，Component 自身就是 store，这克服了 Reflux 主要不足。另外结合 MVVM 架构的可视化特点，Shadow Widget 还克服了 redux 主要不足。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e3. 几种 Lift State Up 方式\x3c\/h2\x3e\n\x3cp\x3eShadow Widget 介绍了一种 “逆向同步 \x26amp; 单向依赖” 的机制，在如下节点树中，nodeE 要使用 nodeC 中的数据，但 nodeC 生存周期与 nodeE 并不一致，所以，引入一种机制，在它们共同的父节点 nodeA 设置一个属性（比如 \x3ccode\x3eattrX\x3c\/code\x3e），nodeC 中的该数据能自动同步到 nodeA 中，然后让 nodeE 只依赖 nodeA 中的数据（比如 \x3ccode\x3eattrX\x3c\/code\x3e），只要 NodeE 还存活，父节点 nodeD 与 nodeA 必然存活。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  nodeA\n  \x2b-- nodeB\n  |   \x2b-- nodeC\n  \x2b-- nodeD\n  |   \x2b-- nodeE\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3e  nodeA\n  \x2b\x3cspan class=\x22hljs-comment\x22\x3e-- nodeB\x3c\/span\x3e\n  |   \x2b\x3cspan class=\x22hljs-comment\x22\x3e-- nodeC\x3c\/span\x3e\n  \x2b\x3cspan class=\x22hljs-comment\x22\x3e-- nodeD\x3c\/span\x3e\n  |   \x2b\x3cspan class=\x22hljs-comment\x22\x3e-- nodeE\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eReact 官方介绍了一种 \x3ca href=\x22https:\/\/facebook.github.io\/react\/docs\/lifting-state-up.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x22Lifting State Up\x22\x3c\/a\x3e 方法，借助函数式编程的特点，把控制界面显示效果的变量，从子节点提升到父节点，子节点的事件函数改在父节点定义，就达到 \x3ccode\x3eLift State Up\x3c\/code\x3e 的效果。\x3c\/p\x3e\n\x3cp\x3e既然提升 state 能突破 React 对数据传递的限制，那么，极端一点，能否把所有用到的数据都改成全局变量呢？答案当然可以，不过缺少意义，这么做，无非将分散在各节点的逻辑，转移到处理一堆全局变量而己，设计过程本该分解，而非合并。可视节点分层分布本是天然的功能划分方式，放弃它改换门庭无疑把事情搞复杂了，可恶的 Redux 就是这么干的。\x3c\/p\x3e\n\x3cp\x3e从本质上看，Redux 把 state 数据全局化了（成为单 store），但它又以 action 主导切割数据，你并不能直接存取全局 store，而是改由 action 驱动各个 reducer，各 reducer 只孤立处理它自身可见的 state。由此我有两点推论：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e弃用界面现成的分解方式，改建另一套体系并不明智   \x3cbr\x3e就像描述双人博击，最直接的方式是先区分场上谁是谁，谁出击，谁防守，出击者挥拳，防守者缩头躲避。Redux 行事风格是先设计 “挥拳”、“缩头” 之类的 action，然后分解实施这些 action，来驱动各种 state 变化。该模式之所以行得通，不是 Redux 有多好，而是人脑太奇妙，编程中除了脑补产品应用场景，偶尔还会插帧处理俊男靓女图片 :)\x3c\/li\x3e\n\x3cli\x3e数据隔离是必需的，否则无法应对大规模产品开发   \x3cbr\x3e后文我们将介绍最佳实践中的数据隔离方法，以功能场景为依据。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e4. 功能块\x3c\/h2\x3e\n\x3cp\x3e为方便说明问题，我们取 React 官方 \x3ca href=\x22https:\/\/facebook.github.io\/react\/docs\/lifting-state-up.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x22Lifting State Up\x22\x3c\/a\x3e 一文介绍的，判断温度是否达到沸点的应用场景，编写一段样例代码。\x3c\/p\x3e\n\x3cp\x3e我们想设计如下界面：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVWu5b?w=305\x26amp;h=106\x22 src=\x22https:\/\/static.alili.tech\/img\/bVWu5b?w=305\x26amp;h=106\x22 alt=\x22Temperature\x22 title=\x22Temperature\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e4.1 样例程序的功能\x3c\/h3\x3e\n\x3cp\x3e如果输入温度未超沸点，界面显示 \x3ccode\x3e\x22The water would not boil\x22\x3c\/code\x3e，若超沸点则显示 \x3ccode\x3e\x22would boil\x22\x3c\/code\x3e。另外，用于输入温度的方框（即后述的 \x3ccode\x3efield\x3c\/code\x3e 节点）要求可配置，用 \x3ccode\x3escale=\x27c\x27\x3c\/code\x3e 指示以摄氏度表示，标题提示 \x3ccode\x3e\x22Temperature in Celsius\x22\x3c\/code\x3e，否则 \x3ccode\x3escal=\x27f\x27\x3c\/code\x3e 指示华氏度，提示 \x3ccode\x3e\x22in Fahrenheit\x22\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e我们在 Shadow Widget 可视设计器中完成设计，存盘后生成的转义标签如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv $=BodyPanel key=\x27body\x27 klass=\x27S5\x27\x3e\n  \x3cdiv $=Panel key=\x27calculator\x27 klass=\x27hidden-visible-auto row-reverse\x27 \n      height=\x27{null}\x27 width=\x27{300}\x27 $id__=\x27calculator\x27\x3e\n    \x3cdiv $=Fieldset key=\x27field\x27 width=\x27{0.9999}\x27 scale=\x27c\x27\x3e\n      \x3cspan $=Legend key=\x27legend\x27\x3elegend\x3c\/span\x3e\n      \x3cspan $=Input key=\x27input\x27 type=\x27text\x27 default-value=\x270\x27\x3e\x3c\/span\x3e\n    \x3c\/div\x3e\n    \x3cdiv $=P key=\x27verdict\x27 klass=\x27visible-auto-hidden\x27 width=\x27{0.9999}\x27\x3e\x3c\/div\x3e\n  \x3c\/div\x3e\n\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e $=\x3cspan class=\x22hljs-string\x22\x3eBodyPanel\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27body\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eklass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27S5\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e $=\x3cspan class=\x22hljs-string\x22\x3ePanel\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27calculator\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eklass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27hidden-visible-auto row-reverse\x27\x3c\/span\x3e \n      \x3cspan class=\x22hljs-attr\x22\x3eheight\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27{null}\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ewidth\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27{300}\x27\x3c\/span\x3e $\x3cspan class=\x22hljs-attr\x22\x3eid__\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27calculator\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e $=\x3cspan class=\x22hljs-string\x22\x3eFieldset\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27field\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ewidth\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27{0.9999}\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3escale\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27c\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e $=\x3cspan class=\x22hljs-string\x22\x3eLegend\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27legend\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3elegend\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e $=\x3cspan class=\x22hljs-string\x22\x3eInput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27text\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edefault-value\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e $=\x3cspan class=\x22hljs-string\x22\x3eP\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27verdict\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eklass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27visible-auto-hidden\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ewidth\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27{0.9999}\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后在 JS 文件编写如下代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (!window.W) { window.W = new Array(); W.$modules = [];}\nW.$modules.push( function(require,module,exports) {\n\nvar React = require(\x27react\x27);\nvar ReactDOM = require(\x27react-dom\x27);\nvar W = require(\x27shadow-widget\x27);\n\nvar main = W.$main, utils = W.$utils, ex = W.$ex;\nvar idSetter = W.$idSetter;\n\nif (W.__design__) return;\n\n(function() { \/\/ functionarity block\n\nvar selfComp = null, verdictComp = null;\nvar scaleNames = { c:\x27Celsius\x27, f:\x27Fahrenheit\x27 };\n\nidSetter[\x27calculator\x27] = function(value,oldValue) {\n  if (value \x3c= 2) {\n    if (value == 1) {      \/\/ init\n      selfComp = this;\n      this.defineDual(\x27temperature\x27, function(value,oldValue) {\n        if (Array.isArray(value) \x26amp;\x26amp; verdictComp) {\n          var scale = value[0], degree = value[1];\n          var isBoil = degree \x3e= (scale == \x27c\x27?100:212);\n          verdictComp.duals[\x27html.\x27] = isBoil?\n            \x27The water would boil.\x27:\n            \x27The water would not boil.\x27;\n        }\n      });\n    }\n    else if (value == 2) { \/\/ mount\n      verdictComp = this.componentOf(\x27verdict\x27);\n      \n      var field = this.componentOf(\x27field\x27);\n      var inputComp = field.componentOf(\x27input\x27);\n      var legend = field.componentOf(\x27legend\x27);\n      var sScale = field.props.scale || \x27c\x27;\n      legend.duals[\x27html.\x27] = \x27Temperature in \x27 \x2b scaleNames[sScale];\n      \n      inputComp.listen(\x27value\x27,onInputChange.bind(inputComp));\n      this.duals.temperature = [ sScale,\n        parseFloat(inputComp.duals.value) || 0\n      ];\n    }\n    else if (value == 0) { \/\/ unmount\n      selfComp = verdictComp = null;\n    }\n    return;\n  }\n  \n  function onInputChange(value,oldValue) {\n    var scale = this.parentOf().props.scale || \x27c\x27;  \/\/ \x27c\x27 or \x27f\x27\n    var degree = parseFloat(value) || 0; \/\/ take NaN as 0\n    selfComp.duals.temperature = [scale,degree];\n  }\n};\n\n})();\n\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.W) { \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.W = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e(); W.$modules = [];}\nW.$modules.push( \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequire,module,exports\x3c\/span\x3e) \x3c\/span\x3e{\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e React = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ReactDOM = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27react-dom\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e W = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27shadow-widget\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e main = W.$main, utils = W.$utils, ex = W.$ex;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e idSetter = W.$idSetter;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (W.__design__) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n\n(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ functionarity block\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e selfComp = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, verdictComp = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e scaleNames = { \x3cspan class=\x22hljs-attr\x22\x3ec\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27Celsius\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ef\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27Fahrenheit\x27\x3c\/span\x3e };\n\nidSetter[\x3cspan class=\x22hljs-string\x22\x3e\x27calculator\x27\x3c\/span\x3e] = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue,oldValue\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (value \x26lt;= \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (value == \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ init\x3c\/span\x3e\n      selfComp = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.defineDual(\x3cspan class=\x22hljs-string\x22\x3e\x27temperature\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue,oldValue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.isArray(value) \x26amp;\x26amp; verdictComp) {\n          \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e scale = value[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e], degree = value[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n          \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isBoil = degree \x26gt;= (scale == \x3cspan class=\x22hljs-string\x22\x3e\x27c\x27\x3c\/span\x3e?\x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e212\x3c\/span\x3e);\n          verdictComp.duals[\x3cspan class=\x22hljs-string\x22\x3e\x27html.\x27\x3c\/span\x3e] = isBoil?\n            \x3cspan class=\x22hljs-string\x22\x3e\x27The water would boil.\x27\x3c\/span\x3e:\n            \x3cspan class=\x22hljs-string\x22\x3e\x27The water would not boil.\x27\x3c\/span\x3e;\n        }\n      });\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (value == \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ mount\x3c\/span\x3e\n      verdictComp = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.componentOf(\x3cspan class=\x22hljs-string\x22\x3e\x27verdict\x27\x3c\/span\x3e);\n      \n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e field = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.componentOf(\x3cspan class=\x22hljs-string\x22\x3e\x27field\x27\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e inputComp = field.componentOf(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e legend = field.componentOf(\x3cspan class=\x22hljs-string\x22\x3e\x27legend\x27\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sScale = field.props.scale || \x3cspan class=\x22hljs-string\x22\x3e\x27c\x27\x3c\/span\x3e;\n      legend.duals[\x3cspan class=\x22hljs-string\x22\x3e\x27html.\x27\x3c\/span\x3e] = \x3cspan class=\x22hljs-string\x22\x3e\x27Temperature in \x27\x3c\/span\x3e \x2b scaleNames[sScale];\n      \n      inputComp.listen(\x3cspan class=\x22hljs-string\x22\x3e\x27value\x27\x3c\/span\x3e,onInputChange.bind(inputComp));\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.duals.temperature = [ sScale,\n        \x3cspan class=\x22hljs-built_in\x22\x3eparseFloat\x3c\/span\x3e(inputComp.duals.value) || \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n      ];\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (value == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ unmount\x3c\/span\x3e\n      selfComp = verdictComp = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n  }\n  \n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonInputChange\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue,oldValue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e scale = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.parentOf().props.scale || \x3cspan class=\x22hljs-string\x22\x3e\x27c\x27\x3c\/span\x3e;  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x27c\x27 or \x27f\x27\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e degree = \x3cspan class=\x22hljs-built_in\x22\x3eparseFloat\x3c\/span\x3e(value) || \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ take NaN as 0\x3c\/span\x3e\n    selfComp.duals.temperature = [scale,degree];\n  }\n};\n\n})();\n\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面 \x3ccode\x3eif (W.__design__) return\x3c\/code\x3e 一句，让其后代码在 \x3ccode\x3e__design__\x3c\/code\x3e 态时（即，在可视设计器中）不生效。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e4.2 功能块\x3c\/h3\x3e\n\x3cp\x3e按我们最佳实践的做法，界面可视化设计的结果保存在页面 \x3ccode\x3e*.html\x3c\/code\x3e 文件，而界面的代码实现（包括定义事件响应、绑捆数据驱动等）在 JS 文件编写。所以，上面例子的设计结果包括两部分：\x3ccode\x3e*.html\x3c\/code\x3e 文件中的转义标签与 \x3ccode\x3e*.js\x3c\/code\x3e 文件中的 javascript 脚本。\x3c\/p\x3e\n\x3cp\x3e多个组件共同完成某项特定功能，他们合起来形成逻辑上的整体叫做 “功能块” （Functionarity Block）。典型的 JS 文件通常按这个样式编写：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (!window.W) { window.W = new Array(); W.$modules = [];}\nW.$modules.push( function(require,module,exports) {\n\n\/\/ 全局变量定义\nvar React = require(\x27react\x27);\nvar ReactDOM = require(\x27react-dom\x27);\nvar W = require(\x27shadow-widget\x27);\n\nvar main = W.$main, utils = W.$utils, ex = W.$ex;\nvar idSetter = W.$idSetter;\n\nif (W.__design__) return;\n\n\/\/ 功能块定义\n(function() {\n\n\/\/ ....\n\n})()\n\n\/\/ 初始化定义\nmain.$onLoad.push( function() {\n  \/\/ ...\n});\n\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.W) { \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.W = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e(); W.$modules = [];}\nW.$modules.push( \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequire,module,exports\x3c\/span\x3e) \x3c\/span\x3e{\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 全局变量定义\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e React = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ReactDOM = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27react-dom\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e W = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27shadow-widget\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e main = W.$main, utils = W.$utils, ex = W.$ex;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e idSetter = W.$idSetter;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (W.__design__) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 功能块定义\x3c\/span\x3e\n(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ....\x3c\/span\x3e\n\n})()\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 初始化定义\x3c\/span\x3e\nmain.$onLoad.push( \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n});\n\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e头部用来定义若干全局变量，然后定义功能块，功能块可能有多个，上面举例的判断温度是否超沸点，比较简单，定义一个功能块就够了，最后定义 \x3ccode\x3emain.$onLoad\x3c\/code\x3e 全局初始化函数。\x3c\/p\x3e\n\x3cp\x3e之所以将一个功能块用一个函数包裹，主要为了构造独立的命名空间（Namespace），比如前面举例的代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(function() { \/\/ functionarity block\n\nvar selfComp = null, verdictComp = null;\nvar scaleNames = { c:\x27Celsius\x27, f:\x27Fahrenheit\x27 };\n\nidSetter[\x27calculator\x27] = function(value,oldValue) {\n  \/\/ ...\n};\n\n})();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ functionarity block\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e selfComp = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, verdictComp = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e scaleNames = { \x3cspan class=\x22hljs-attr\x22\x3ec\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27Celsius\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ef\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27Fahrenheit\x27\x3c\/span\x3e };\n\nidSetter[\x3cspan class=\x22hljs-string\x22\x3e\x27calculator\x27\x3c\/span\x3e] = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue,oldValue\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n};\n\n})();\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由功能块函数构造的 Namespace 也称 “功能块空间”（Functionarity Block Space），在功能块内共享的变量在此定义，比如这里的 \x3ccode\x3eselfComp, verdictComp, scaleNames\x3c\/code\x3e 变量。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e4.3 功能块入口节点\x3c\/h3\x3e\n\x3cp\x3e一个功能块的入口节点是特殊节点，它的生存周期反映了功能块的生存周期。它的各层子节点若还存在（即在 unmount 之前），入口节点必然存在。因为入口节点的生存期能完整覆盖它各级子节点的生存期，所以，我们一般在入口节点定义 idSetter 函数，承担本功能块的主体逻辑处理。\x3c\/p\x3e\n\x3cp\x3e上例的功能块定义了如下节点树：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 Panel (key=calculator)\n  \x2b-- Fieldset (key=field)\n  |   \x2b-- Legend (key=legend)\n  |   \x2b-- Input (key=input)\n  \x2b-- P (key=verdict)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs maxima\x22\x3e\x3ccode\x3e Panel (\x3cspan class=\x22hljs-built_in\x22\x3ekey\x3c\/span\x3e=calculator)\n  \x2b-- Fieldset (\x3cspan class=\x22hljs-built_in\x22\x3ekey\x3c\/span\x3e=field)\n  |   \x2b-- Legend (\x3cspan class=\x22hljs-built_in\x22\x3ekey\x3c\/span\x3e=\x3cspan class=\x22hljs-built_in\x22\x3elegend\x3c\/span\x3e)\n  |   \x2b-- Input (\x3cspan class=\x22hljs-built_in\x22\x3ekey\x3c\/span\x3e=input)\n  \x2b-- P (\x3cspan class=\x22hljs-built_in\x22\x3ekey\x3c\/span\x3e=verdict)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e入口节点是 \x3ccode\x3ecalculator\x3c\/code\x3e 面板，结合该节点的 idSetter 函数书写特点，我们接着介绍 Shadow Widget 最佳实践如何处理 \x22功能块\x22 之内的编程。\x3c\/p\x3e\n\x3cp\x3e\x26nbsp;\x3c\/p\x3e\n\x3cp\x3e1) 为方便编程，不妨在 “功能块空间” 多定义变量\x3c\/p\x3e\n\x3cp\x3e因为 “功能块空间” 的变量不外泄到其它功能块，我们不必担心多定义变量会给其它部分编码带来 Side Effects。功能块里各个节点，只要不是动态创建、删除、再创建那种，都可定义成 “功能块空间” 的变量，我们一般在入口节点 idSetter 函数的 unmount 代码段（即 \x3ccode\x3eif (value == 0)\x3c\/code\x3e），把各个节点的变量置回 \x3ccode\x3enull\x3c\/code\x3e 值。\x3c\/p\x3e\n\x3cp\x3e对于动态增删的节点，不妨用 \x3ccode\x3ethis.componentOf(sPath)\x3c\/code\x3e 动态方式定位。\x3c\/p\x3e\n\x3cp\x3e\x26nbsp;\x3c\/p\x3e\n\x3cp\x3e2) 功能块内的数据主体流向，宜在界面设计时就指定\x3c\/p\x3e\n\x3cp\x3e在功能块的 idSetter 函数也能以编程方式设计节点间数据流向，考虑到界面设计与数据流规则直接相关，能以描述方式（转义标签形式）表达数据流的，尽量用描述方式，不方便的才用 JS 编程方式去实现。因为，一方面，Shadow Widget 的指令式 UI 描述能力够强，另一方面，这么做有助于让 MVVM 中的 \x3ccode\x3eViewModel\x3c\/code\x3e 集中，从而降低设计复杂度。\x3c\/p\x3e\n\x3cp\x3e界面设计时，不妨多用下述技巧：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e以 \x3ccode\x3e$for=\x27\x27\x3c\/code\x3e 或 \x3ccode\x3e$$for=\x27\x27\x3c\/code\x3e 开启一层 callspace，方便其下节点的可计算属性用 \x3ccode\x3eduals.attr\x3c\/code\x3e 引用数据。\x3c\/li\x3e\n\x3cli\x3e善用 \x3ccode\x3e$trigger\x3c\/code\x3e 同步数据\x3c\/li\x3e\n\x3cli\x3e如果节点层次复杂，不妨采用导航面板（\x3ccode\x3eNavPanel\x3c\/code\x3e 与 \x3ccode\x3eNavDiv\x3c\/code\x3e），用 \x3ccode\x3e\x22.\/xx.xx\x22\x3c\/code\x3e 相对路径方式让节点定位更方便\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x26nbsp;\x3c\/p\x3e\n\x3cp\x3e3) 善用变量共享机制\x3c\/p\x3e\n\x3cp\x3e若按 React 原始开发方式编码，不借助任何 Flux 框架工具，大家肯定觉得编程很不方便，因为各节点除了能往子节点单向传递 \x3ccode\x3eprops\x3c\/code\x3e 外，与其它节点的交互几乎隔了一道黑幕。然而，不幸的是，React 几个主流的 Flux 工具，均没有妥善解决几个主要问题，上面提到的 Reflux、Redux 均如此，React 官方的 \x3ccode\x3ereact-flux\x3c\/code\x3e 更难用。\x3c\/p\x3e\n\x3cp\x3e相对而言，Shadow Widget 的解决方案好很多，一方面，在 Component 节点引入 “双源属性”，功能强大，能让基于过程组装的 UI 渲染，过渡到 \x3cstrong\x3e以属性变化来驱动渲染\x3c\/strong\x3e，即：除了 “功能块” 的入口节点需集中编写控制逻辑，其它节点的编程，基本简化为定制若干 duals 函数（用 \x3ccode\x3edefineDual()\x3c\/code\x3e 注册）。另一方面，Shadow Widget 借助 Functionarity Block 抽象层来重组数据，\x3cstrong\x3e以功能远近作聚合依据\x3c\/strong\x3e，明显比以 Action 驱动的 Reducer 分割要高明。\x3c\/p\x3e\n\x3cp\x3e从本质上讲，拎取 “功能块抽象层” 也是 \x3ccode\x3eLift State Up\x3c\/code\x3e 的一种手段，限制更少，结合于 JS 编程也更自然。虚拟 DOM 树中的各 component 节点有隔离措拖，不能互相识别，但函数编程没什么限制，比如上面例子，\x3ccode\x3eselfComp = this\x3c\/code\x3e 把一个 Component 赋给 “功能块空间” 的变量 \x3ccode\x3eselfComp\x3c\/code\x3e 后，同在一个功能块的其它函数都能使用它了。\x3c\/p\x3e\n\x3cp\x3e（未完，下篇待续...）\x3c\/p\x3e\n\x3cp\x3e\x26nbsp;\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React 可视化开发工具 shadow-widget 最佳实践（上）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011520268">https://segmentfault.com/a/1190000011520268</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/gq78r0n66b/" target="_blank">https://alili.tech/archive/gq78r0n66b/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>