<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="用 Electron 打造 Win/Mac 应用，从「代码」到可下载的「安装包」，可能比你想得麻烦一点"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>用 Electron 打造 Win/Mac 应用，从「代码」到可下载的「安装包」，可能比你想得麻烦一点 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/gy01jgdooc5/",
				"appid": "1613049289050283", 
				"title": "用 Electron 打造 Win/Mac 应用，从「代码」到可下载的「安装包」，可能比你想得麻烦一点 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-26T02:30:14"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/nyy120srg5r/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/1kx8ys5mfxf/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fgy01jgdooc5%2f&text=%e7%94%a8%20Electron%20%e6%89%93%e9%80%a0%20Win%2fMac%20%e5%ba%94%e7%94%a8%ef%bc%8c%e4%bb%8e%e3%80%8c%e4%bb%a3%e7%a0%81%e3%80%8d%e5%88%b0%e5%8f%af%e4%b8%8b%e8%bd%bd%e7%9a%84%e3%80%8c%e5%ae%89%e8%a3%85%e5%8c%85%e3%80%8d%ef%bc%8c%e5%8f%af%e8%83%bd%e6%af%94%e4%bd%a0%e6%83%b3%e5%be%97%e9%ba%bb%e7%83%a6%e4%b8%80%e7%82%b9"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fgy01jgdooc5%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fgy01jgdooc5%2f&text=%e7%94%a8%20Electron%20%e6%89%93%e9%80%a0%20Win%2fMac%20%e5%ba%94%e7%94%a8%ef%bc%8c%e4%bb%8e%e3%80%8c%e4%bb%a3%e7%a0%81%e3%80%8d%e5%88%b0%e5%8f%af%e4%b8%8b%e8%bd%bd%e7%9a%84%e3%80%8c%e5%ae%89%e8%a3%85%e5%8c%85%e3%80%8d%ef%bc%8c%e5%8f%af%e8%83%bd%e6%af%94%e4%bd%a0%e6%83%b3%e5%be%97%e9%ba%bb%e7%83%a6%e4%b8%80%e7%82%b9"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fgy01jgdooc5%2f&title=%e7%94%a8%20Electron%20%e6%89%93%e9%80%a0%20Win%2fMac%20%e5%ba%94%e7%94%a8%ef%bc%8c%e4%bb%8e%e3%80%8c%e4%bb%a3%e7%a0%81%e3%80%8d%e5%88%b0%e5%8f%af%e4%b8%8b%e8%bd%bd%e7%9a%84%e3%80%8c%e5%ae%89%e8%a3%85%e5%8c%85%e3%80%8d%ef%bc%8c%e5%8f%af%e8%83%bd%e6%af%94%e4%bd%a0%e6%83%b3%e5%be%97%e9%ba%bb%e7%83%a6%e4%b8%80%e7%82%b9"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fgy01jgdooc5%2f&is_video=false&description=%e7%94%a8%20Electron%20%e6%89%93%e9%80%a0%20Win%2fMac%20%e5%ba%94%e7%94%a8%ef%bc%8c%e4%bb%8e%e3%80%8c%e4%bb%a3%e7%a0%81%e3%80%8d%e5%88%b0%e5%8f%af%e4%b8%8b%e8%bd%bd%e7%9a%84%e3%80%8c%e5%ae%89%e8%a3%85%e5%8c%85%e3%80%8d%ef%bc%8c%e5%8f%af%e8%83%bd%e6%af%94%e4%bd%a0%e6%83%b3%e5%be%97%e9%ba%bb%e7%83%a6%e4%b8%80%e7%82%b9"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%94%a8%20Electron%20%e6%89%93%e9%80%a0%20Win%2fMac%20%e5%ba%94%e7%94%a8%ef%bc%8c%e4%bb%8e%e3%80%8c%e4%bb%a3%e7%a0%81%e3%80%8d%e5%88%b0%e5%8f%af%e4%b8%8b%e8%bd%bd%e7%9a%84%e3%80%8c%e5%ae%89%e8%a3%85%e5%8c%85%e3%80%8d%ef%bc%8c%e5%8f%af%e8%83%bd%e6%af%94%e4%bd%a0%e6%83%b3%e5%be%97%e9%ba%bb%e7%83%a6%e4%b8%80%e7%82%b9&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fgy01jgdooc5%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fgy01jgdooc5%2f&title=%e7%94%a8%20Electron%20%e6%89%93%e9%80%a0%20Win%2fMac%20%e5%ba%94%e7%94%a8%ef%bc%8c%e4%bb%8e%e3%80%8c%e4%bb%a3%e7%a0%81%e3%80%8d%e5%88%b0%e5%8f%af%e4%b8%8b%e8%bd%bd%e7%9a%84%e3%80%8c%e5%ae%89%e8%a3%85%e5%8c%85%e3%80%8d%ef%bc%8c%e5%8f%af%e8%83%bd%e6%af%94%e4%bd%a0%e6%83%b3%e5%be%97%e9%ba%bb%e7%83%a6%e4%b8%80%e7%82%b9"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgy01jgdooc5%2f&title=%e7%94%a8%20Electron%20%e6%89%93%e9%80%a0%20Win%2fMac%20%e5%ba%94%e7%94%a8%ef%bc%8c%e4%bb%8e%e3%80%8c%e4%bb%a3%e7%a0%81%e3%80%8d%e5%88%b0%e5%8f%af%e4%b8%8b%e8%bd%bd%e7%9a%84%e3%80%8c%e5%ae%89%e8%a3%85%e5%8c%85%e3%80%8d%ef%bc%8c%e5%8f%af%e8%83%bd%e6%af%94%e4%bd%a0%e6%83%b3%e5%be%97%e9%ba%bb%e7%83%a6%e4%b8%80%e7%82%b9"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgy01jgdooc5%2f&title=%e7%94%a8%20Electron%20%e6%89%93%e9%80%a0%20Win%2fMac%20%e5%ba%94%e7%94%a8%ef%bc%8c%e4%bb%8e%e3%80%8c%e4%bb%a3%e7%a0%81%e3%80%8d%e5%88%b0%e5%8f%af%e4%b8%8b%e8%bd%bd%e7%9a%84%e3%80%8c%e5%ae%89%e8%a3%85%e5%8c%85%e3%80%8d%ef%bc%8c%e5%8f%af%e8%83%bd%e6%af%94%e4%bd%a0%e6%83%b3%e5%be%97%e9%ba%bb%e7%83%a6%e4%b8%80%e7%82%b9"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgy01jgdooc5%2f&title=%e7%94%a8%20Electron%20%e6%89%93%e9%80%a0%20Win%2fMac%20%e5%ba%94%e7%94%a8%ef%bc%8c%e4%bb%8e%e3%80%8c%e4%bb%a3%e7%a0%81%e3%80%8d%e5%88%b0%e5%8f%af%e4%b8%8b%e8%bd%bd%e7%9a%84%e3%80%8c%e5%ae%89%e8%a3%85%e5%8c%85%e3%80%8d%ef%bc%8c%e5%8f%af%e8%83%bd%e6%af%94%e4%bd%a0%e6%83%b3%e5%be%97%e9%ba%bb%e7%83%a6%e4%b8%80%e7%82%b9"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">用 Electron 打造 Win/Mac 应用，从「代码」到可下载的「安装包」，可能比你想得麻烦一点</h1><div class="meta"><div class="postdate"><time datetime="2018-12-26" itemprop="datePublished">2018-12-26</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e首发于\x3ca href=\x22https:\/\/webfe.kujiale.com\/build-electron-app-gulp-workflow\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e酷家乐前端博客\x3c\/a\x3e，作者@摘星（segmentfault @StinsonZhao）\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e我们能从很多地方学习到怎么起一个 Electron 项目，有些还会介绍怎么打包或构建你的代码，但距离「真正地发行一款 Electron 产品」这一目标，还有很多工作需要做...\x3c\/p\x3e\n\x3cp\x3e这是 Electron 系列文章的第二篇，这一篇文章将和大家分享我是怎么去构建\x3cstrong\x3e自动化的 Electron 开发构建工程\x3c\/strong\x3e的，说白了，就是\x3cstrong\x3e怎么把敲的代码变成一个用户可以下载安装的包\x3c\/strong\x3e，当然随着之后应用复杂度的提升和技术再选型，工程体系可能随时会重构或演进，但至少可以给大家一些参考，欢迎留言交流。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e这是一篇很长的文章（手册），写得比较「唐僧」（知我者可以说我写得比较用心），至少会花你一天时间（没开玩笑），适用场景是「用 Electron 打造 \x3cstrong\x3eWindows 或 Mac\x3c\/strong\x3e 应用」，是的，你没看错，同时会讲清楚兼容 Win 和 Mac 两个系统的流程。文中提及的技术方案绝对不是最佳的（我保证），因为几乎每隔几天我都会发现某个环节可以做得更好，但要明白\x3cstrong\x3e要唱多大的戏，就先搭多大的台，够用就好，不要为了搭台耽误演出时间\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e工程自动化，应该是所有开发者的一种基础追求，当你搭建建好工程体系，以后你将专注于产品功能的开发，而不会花大量不必要的时间去手动构建。作为前端，可能我们已经熟悉了 web 应用的构建和部署，但是客户端程序有其本身的特点，相比较 web 应用最大也是我认为最根本的一点区别在于「\x3cstrong\x3e你的应用是被用户下载过去安装在用户本地再跑起来的\x3c\/strong\x3e」。\x3c\/p\x3e\n\x3cp\x3e这一区别对工程的影响在于，你不可能把你的代码部署到「用户的电脑」，你需要构建安装包，你需要针对不同的用户系统构建不同的安装包，你需要让你的应用被系统认为是安全的... \x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011908327?w=1280\x26amp;h=600\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011908327?w=1280\x26amp;h=600\x22 alt=\x22本文目的\x22 title=\x22本文目的\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e本文需要做的是，\x3cstrong\x3e把客户端的打包构建发行这一流程做到像「把大象放进冰箱」一样的简单：打开命令行，敲一个 \x3ccode\x3enpm run xxx\x3c\/code\x3e，喝一口咖啡，咪哩嘛哩哄，安装包出现\x3c\/strong\x3e（一开始打造这个流程时，剧本可能是「喝一口咖啡，啪，Error 了，又 Error 了」，take it easy，生活需要慢慢品味 —— 来自一位25岁的仙风道骨白胡子程序员）。\x3c\/p\x3e\n\x3cp\x3e本文将分以下小节和大家分享「从本地的代码到云端可下载的安装包」这一路的风景，你会有漫步月球般的感觉（因为月球全是坑啊，还没氧气）：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e第一节是关于目录结构的讨论，合适的目录结构会是一个良好的开端\x3c\/li\x3e\n\x3cli\x3e第二节是之后几个小节的概述，阐述了怎么把这一整个过程分成多个环节，每个环节又大致要做什么事\x3c\/li\x3e\n\x3cli\x3e第三到七节分别详细描述了「配置」、「打包」、「代码签名」、「构建安装包」、「发行安装包」这几个环节要做哪些事，有什么讲究\x3c\/li\x3e\n\x3cli\x3e第八节是简述一些可进一步研究或优化的点\x3c\/li\x3e\n\x3cli\x3e附：这样设计的 gulpfile 文件结构\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e下面一一展开进行阐述，再次强调，文中很多依赖的技术或包，你都可以尝试替换成自己相中的，不必在意是选「翠花」还是「桂花」，多处处就知道了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e一、目录结构\x3c\/h2\x3e\n\x3cp\x3e以下目录结构供参考，没有很详细地展开，因为每个应用可能不同，最想表达的是这是一个「\x3cstrong\x3e双 package.json 结构\x3c\/strong\x3e」，你可以看到根目录下有一个\x3ccode\x3epackage.json\x3c\/code\x3e，\x3ccode\x3eapp\x3c\/code\x3e目录下还有一个\x3ccode\x3epackage.json\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/       \/\/ 项目根目录\n├── app\/                \/\/ 应用源码目录，打包就针对app目录进行打包\n│   ├── assets\/                     \/\/ 应用需要的图片、icon等资源\n│   ├── config\/                     \/\/ 配置文件存放\n│   ├── consts\/                     \/\/ 应用运行需要的常量，如ipcChanel\n│   ├── lib\/                        \/\/ 引入的库文件，如jquery\n│   ├── plugins\/                    \/\/ 应用运行需要的插件，如flash\n│   ├── utils\/                      \/\/ 常用的工具方法\n│   ├── view\/                       \/\/ 视图，html、css和js\n│   ├── app_config.js               \/\/ 整个app的配置，引入config文件夹下文件\n│   ├── main.js                     \/\/ 应用入口\n│   ├── package.json                \/\/ 内部的package，定义应用的版本、运行依赖等\n│   └── yarn.lock                   \n├── build_resource\/     \/\/ 构建需要的一些工具、资源或者脚本的目录\n├── config\/             \/\/ 环境配置文件目录，会选择一个写入到app\/config\n├── deploy\/             \/\/ 部署脚本，用户部署文件到cdn或上传文件到OSS\n├── reserve\/            \/\/ 保留目录，存放一些文件用于写入到app内\n├── dist\/               \/\/ 打包和构建的目标目录\n├── release\/            \/\/ 发行的目标目录\n├── .gitignore\n├── gulpfile.js         \/\/ gulp配置\n├── package.json        \/\/ 外部package.json，用于定义开发依赖和脚本\n└── yarn.lock\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\/       \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 项目根目录\x3c\/span\x3e\n├── app\/                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 应用源码目录，打包就针对app目录进行打包\x3c\/span\x3e\n│   ├── assets\/                     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 应用需要的图片、icon等资源\x3c\/span\x3e\n│   ├── config\/                     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 配置文件存放\x3c\/span\x3e\n│   ├── consts\/                     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 应用运行需要的常量，如ipcChanel\x3c\/span\x3e\n│   ├── lib\/                        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 引入的库文件，如jquery\x3c\/span\x3e\n│   ├── plugins\/                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 应用运行需要的插件，如flash\x3c\/span\x3e\n│   ├── utils\/                      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 常用的工具方法\x3c\/span\x3e\n│   ├── view\/                       \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 视图，html、css和js\x3c\/span\x3e\n│   ├── app_config.js               \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 整个app的配置，引入config文件夹下文件\x3c\/span\x3e\n│   ├── main.js                     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 应用入口\x3c\/span\x3e\n│   ├── package.json                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 内部的package，定义应用的版本、运行依赖等\x3c\/span\x3e\n│   └── yarn.lock                   \n├── build_resource\/     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 构建需要的一些工具、资源或者脚本的目录\x3c\/span\x3e\n├── config\/             \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 环境配置文件目录，会选择一个写入到app\/config\x3c\/span\x3e\n├── deploy\/             \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 部署脚本，用户部署文件到cdn或上传文件到OSS\x3c\/span\x3e\n├── reserve\/            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保留目录，存放一些文件用于写入到app内\x3c\/span\x3e\n├── dist\/               \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 打包和构建的目标目录\x3c\/span\x3e\n├── release\/            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发行的目标目录\x3c\/span\x3e\n├── .gitignore\n├── gulpfile.js         \x3cspan class=\x22hljs-comment\x22\x3e\/\/ gulp配置\x3c\/span\x3e\n├── package.json        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 外部package.json，用于定义开发依赖和脚本\x3c\/span\x3e\n└── yarn.lock\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这是因为，我们的应用在运行时需要一些第三方依赖，这些依赖我们需要打包到应用内，也就是说\x3ccode\x3e\/app\/node_modules\x3c\/code\x3e目录内的内容是要被打包到应用内的，用户使用的时候才不会缺失「运行时依赖」，而如果我们只有一个\x3ccode\x3epackage.json\x3c\/code\x3e，那么所有的依赖都被下载和安装到同一个\x3ccode\x3enode_modules\x3c\/code\x3e文件夹下，我们没法把我们需要打包进去的依赖树提取出来。所以这样双 \x3ccode\x3epackage.json\x3c\/code\x3e的结构最清晰明了和简单易用，\x3ccode\x3edependencies\x3c\/code\x3e和\x3ccode\x3edevDependencies\x3c\/code\x3e有了明确划分。\x3c\/p\x3e\n\x3cp\x3e再大致解释下其他目录的作用：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3eapp\x3c\/code\x3e目录：是我们应用的源码目录，我们所说的打包针对的就是这个目录，其他目录和文件不会被打包进去，而\x3ccode\x3eapp\x3c\/code\x3e目录内的子目录和文件就见仁见智了，在不同的复杂度下有不同的设置，这里还有一些东西是需要从外面复制进来的，因为不同的平台下你可能需要打包进去的东西是不同的。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3econfig\x3c\/code\x3e：配置文件目录，可能因为你想打包的应用所处的阶段（开发、内测、众测、正式发行）和平台（Windows、Mac），那么可能需要不同的配置，比如一些资源的名称和路径等，这里你可以把不同情况下都一样的配置写到一个配置文件，而根据情况不一样的配置文件是从外部脚本写进来的，这就是为什么你会在\x3ccode\x3eapp\x3c\/code\x3e目录外面看到一个config文件夹的原因\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eplugins\x3c\/code\x3e：是插件文件夹，你可能需要给自己的应用加一些插件，比如 flash，而一个 flash 插件有 40M 左右，Win（32bit）、Win（64bit） 和 Mac 需要的 flash 插件文件都是不一样的，所以如果全部打包进你的应用，再用「if - else」去选显然是不科学的，Mac 下的应用肯定是用不到 Win 版本的插件的，所以这里的文件也是从外面脚本写进来的\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eview\x3c\/code\x3e：是视图文件夹，也可以说是渲染进程对应的代码文件夹\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ebuild_resource\x3c\/code\x3e：构建资源或工具文件夹，这个文件夹下放打包到发行这一流程中需要用到的资源和工具，比如程序主图标、构建安装包的配置脚本（win）、代码签名工具等\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3edeploy\x3c\/code\x3e：存放部署脚本的文件夹，这里的脚本负责把你的应用安装包上传到云存储（OSS），我们会在 gulp 中的发行环节引入这里写的脚本进行自动上传安装包\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3edist\x3c\/code\x3e和\x3ccode\x3erelease\x3c\/code\x3e：前者是打包和构建安装包这两步的 output 目录，后者是最终我们会上传到云端的安装包目录，构建和发行环节的差别我们后面会讲到\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e二、把整个流程拆分成段\x3c\/h2\x3e\n\x3cp\x3e这个部分没法正向推导，我是从一个乱七八糟的 windows 开发流程开始的，然后修改成一个合适的 windows 开发流程，再因为要兼容 Mac 的开发，再改成现在这样的流程设计的，所以我没法从一开始就说因为什么所以要考虑什么，然后慢慢构建出一个合适的工作流，这是上帝视角，这个偏实践经验的过程一定是实践越多，感受越多的。\x3c\/p\x3e\n\x3cp\x3e所以我会先说我的做法，再说这么做的好处，所用的工具是 gulp（如果不熟悉，可以去 gulp 官网看一下，很容易上手），利用 gulp 的 task 串起整条流程，\x3cstrong\x3e我把工程中的一个阶段称为一个环节，是为了和应用本身的阶段（开发、内测、众测或正式发行）做一个区分，不然都不知道说的阶段是指啥\x3c\/strong\x3e：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011908328?w=1456\x26amp;h=1419\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011908328?w=1456\x26amp;h=1419\x22 alt=\x22流程概览\x22 title=\x22流程概览\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3e配置环节\x3c\/strong\x3e：设定需要打包构建针对的系统、位数（Mac 版不考虑 32 bit）和这个版本所处的阶段（开发、内存、众测或正式发行）这些变量，然后把相关配置写入配置文件模板，再导入 app 文件夹内相应位置，把其他相应的文件也写入 app 文件夹内相应位置，如此 app 文件夹就 \x3cstrong\x3eReady\x3c\/strong\x3e 了。\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e打包环节\x3c\/strong\x3e：根据不同的平台打出不同的可执行程序，这一步输出的是可运行的程序\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e代码签名环节\x3c\/strong\x3e：客户端特殊的一步，你的应用需要被系统所信任，那就需要代码签名，获取对应平台下的代码签名 CA 然后进行应用签名，这样你的应用才能被系统信任\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e构建安装包环节\x3c\/strong\x3e：根据不同的系统利用不同的技术和依赖构建安装包，Windows 下的 \x3ccode\x3e.exe\x3c\/code\x3e 和 Mac下的 \x3ccode\x3e.dmg\x3c\/code\x3e，并且对这两个安装包也需要代码签名，这一步后你的应用可以被分发安装啦\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e发行环节\x3c\/strong\x3e：对构建的安装包进行最后一步修饰，比如修改合适的文件名，然后上传到云存储服务器，获取到可下载的链接，如此，你的应用已经可以经获取到的 url 访问进行下载安装了\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e以上每一步，Mac 版和 Windows 版的开发都需要经历，只是所用的方法不同，这样做的好处，一是统一了 Mac 和 Win 下开发工作流的生命周期，二是简单和直观，每一环节目的是什么，输出是什么很明确。\x3c\/p\x3e\n\x3cp\x3e如此，我在\x3ccode\x3epackage.json\x3c\/code\x3e中的\x3ccode\x3escript\x3c\/code\x3e就可以这么写：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22... ...\n\x26quot;start\x26quot;: \x26quot;cross-env NODE_ENV=dev gulp dev\x26quot;,\n\x26quot;packDev\x26quot;: \x26quot;cross-env NODE_ENV=dev gulp pack\x26quot;,\n\x26quot;buildDev\x26quot;: \x26quot;cross-env NODE_ENV=dev gulp build\x26quot;,\n\x26quot;releaseDev\x26quot;: \x26quot;cross-env NODE_ENV=dev gulp release\x26quot;,\n... ...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e... ...\n\x3cspan class=\x22hljs-string\x22\x3e\x22start\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=dev gulp dev\x22\x3c\/span\x3e,\n\x3cspan class=\x22hljs-string\x22\x3e\x22packDev\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=dev gulp pack\x22\x3c\/span\x3e,\n\x3cspan class=\x22hljs-string\x22\x3e\x22buildDev\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=dev gulp build\x22\x3c\/span\x3e,\n\x3cspan class=\x22hljs-string\x22\x3e\x22releaseDev\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=dev gulp release\x22\x3c\/span\x3e,\n... ...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当然这里的\x3ccode\x3eNODE_ENV\x3c\/code\x3e你也可以写成命令行参数（我只是习惯了用这个），利用这个参数去指定需要针对的应用阶段，像以上这样就配好了「dev」阶段的相关脚本，可以用\x3ccode\x3enpm run packDev -- --platform=\x22xxxx\x22 --arch=\x22xxxx\x22 --sign\x3c\/code\x3e这样形式的命令行去执行不同的 gulp 任务，后面的参数，是需要我们在 gulpfile 文件中解析的，以上3个参数分别表示「系统平台」、「系统位数」、「是否需要代码签名」，我们可以在 gulpfile 文件中给这些参数合适的默认值，使操作更人性化。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e三、配置环节\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e目的\x3c\/strong\x3e：一是为之后的环节初始化工作流参数，二是准备好应用文件夹内容（即要打包的目标文件夹 —— app）\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e做的事\x3c\/strong\x3e：解析命令行参数，初始化工作参数，填充配置文件，把配置文件和相关依赖文件导入到\x3ccode\x3eapp\x3c\/code\x3e文件夹内合适的地方\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e1. 初始化工作参数\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e所用工具\x3c\/strong\x3e：yargs\x3c\/p\x3e\n\x3cp\x3eyargs 是一款优秀的命令行参数解析工具，我们要初始化的工作参数包括以下 3 个：「系统平台」、「系统位数」、「需不需要签名」，你也可以把应用的所处阶段（开发、内测、众测、正式）设计成参数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 以下 3 个变量在 gulpfile 内全局声明\n\n\/\/ 这里的 detectPlatform() 需要自己写，利用 node 的 os 模块去检测开发机环境从而给出\n\/\/ 为了理解上直观一些，把 32 位的 win 写成 win32，64 位的 win 写成 win64\n\/\/ node os.platform() 没有 win64 的返回的，只有在返回 win32 基础上，你再使用 os.arch() 去确定是否是win64\n\/\/ 可能的合法值：darwin、win64、win32\nplatform = yargs.argv.platform || detectPlatform() || \x27win32\x27;\n\n\/\/ 系统位数，如果是 Mac OS X，不考虑 32位\n\/\/ 可能的合法值：x64、ia32\narch = platform === \x27darwin\x27 ? \x27x64\x27 : (yargs.argv.arch || \x27ia32\x27);\n\n\/\/ 布尔值，指定是否需要代码签名\nneedSign = yargs.argv.sign || process.env.NODE_ENV === \x27prod\x27 || platform === \x27darwin\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 以下 3 个变量在 gulpfile 内全局声明\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里的 detectPlatform() 需要自己写，利用 node 的 os 模块去检测开发机环境从而给出\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 为了理解上直观一些，把 32 位的 win 写成 win32，64 位的 win 写成 win64\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ node os.platform() 没有 win64 的返回的，只有在返回 win32 基础上，你再使用 os.arch() 去确定是否是win64\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 可能的合法值：darwin、win64、win32\x3c\/span\x3e\nplatform = yargs.argv.platform || detectPlatform() || \x3cspan class=\x22hljs-string\x22\x3e\x27win32\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 系统位数，如果是 Mac OS X，不考虑 32位\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 可能的合法值：x64、ia32\x3c\/span\x3e\narch = platform === \x3cspan class=\x22hljs-string\x22\x3e\x27darwin\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x27x64\x27\x3c\/span\x3e : (yargs.argv.arch || \x3cspan class=\x22hljs-string\x22\x3e\x27ia32\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 布尔值，指定是否需要代码签名\x3c\/span\x3e\nneedSign = yargs.argv.sign || process.env.NODE_ENV === \x3cspan class=\x22hljs-string\x22\x3e\x27prod\x27\x3c\/span\x3e || platform === \x3cspan class=\x22hljs-string\x22\x3e\x27darwin\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e看到上面的参数初始化，可能会有疑问，既然已经在\x3ccode\x3eplatform\x3c\/code\x3e中区分了 win32（32bit） 和 win64（64bit），而且\x3ccode\x3edarwin\x3c\/code\x3e下不考虑 32bit（因为 OS X 10.6 之后就全是 64 位的），\x3ccode\x3earch\x3c\/code\x3e参数是否多余？这是可以认为是多余的，但是有的话更完整，而且如果你以后又想兼容 linux 了呢？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e2. 填充并导入配置文件\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e所用工具\x3c\/strong\x3e：gulp API、gulp-replace、gulp-rename\x3c\/p\x3e\n\x3cp\x3e首先我会在根目录下的 config 文件夹下放几个不同的配置文件模板，分别对应应用不同的阶段的配置（比如dev.js、alpha.js、beta.js、prod.js），然后利用\x3ccode\x3egulp-replace\x3c\/code\x3e去替换掉里面的一些占位字符串（也就是填充模板），最后利用\x3ccode\x3egulp-rename\x3c\/code\x3e重命名为比如\x3ccode\x3eenv.js\x3c\/code\x3e后，利用\x3ccode\x3egulp.dest\x3c\/code\x3e写入文件到 app\/config 目录下，于是配置文件 Ready。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e3. 二进制文件导入（以 flash 为例）\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e所用工具\x3c\/strong\x3e：gulp API、del\x3c\/p\x3e\n\x3cp\x3e以 flash 插件为例，首先你要找到需要的插件文件，electron 官网所说的打开\x3ccode\x3echrome:\/\/plugins\x3c\/code\x3e已经没法用了，从 chrome 的某个版本开始，\x3ccode\x3echrome:\/\/plugins\x3c\/code\x3e Is Not Available。\x3c\/p\x3e\n\x3cp\x3e所以用系统的搜索功能吧，记得先装下 chrome 浏览器，Mac 搜索「PepperFlashPlayer.plugin」，Windows 搜索「pepflashplayer」，Windows下如果搜到多个，记得选择和 chrome 目录有关的那个「.dll」文件，此外 win32bit 和 win64bit 所用的 flash 也是不同的，Mac 下的「PepperFlashPlayer.plugin」本质是一个文件夹，整个文件夹都需要。所有的3个插件放进根目录下 reserve 文件夹。\x3c\/p\x3e\n\x3cp\x3e接下来需要做的就是，根据不同的平台读不同的 flash 插件（ .dll 文件或 .plugin 文件夹）到 app\/plugin 文件夹下。\x3c\/p\x3e\n\x3cp\x3e这里有一个需要注意的是，每次你构建时，如果 app\/plugin 下的 flash 不是你要的，那么你需要先删除那个旧的，否则你的 app\/plugin 文件夹下会躺着一个你不会用的 flash 插件，但会被打包进去，你的文件大小突然多了 40M，我这里用的删除工具是 del。\x3c\/p\x3e\n\x3cp\x3e经过配置环节，\x3ccode\x3eapp\x3c\/code\x3e文件夹已经准备就绪，所以以开发模式（不需要打包）运行应用也就没啥大问题，可以另写一个「dev」的 gulp task，利用 node 的\x3ccode\x3echild_process\x3c\/code\x3e模块下的\x3ccode\x3eexec\x3c\/code\x3e调用下\x3ccode\x3eelectron app --debug\x3c\/code\x3e就可以运行应用了，没啥可以多说的，我们继续进入下一步 —— 打包。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e四、打包环节\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e目的\x3c\/strong\x3e：产出一个可执行程序，简单来说，就是能有一个应用，双击能运行起来\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e做的事\x3c\/strong\x3e：利用\x3ccode\x3eelectron-packager\x3c\/code\x3e打包，补充应用信息（only for win）\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e1. 利用\x3ccode\x3eelectron-packager\x3c\/code\x3e打包\x3c\/h3\x3e\n\x3cp\x3e利用\x3ccode\x3eelectron-packager\x3c\/code\x3e打包，只需要针对不同系统平台给出不同的配置，然后调用其 API 就可以了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ Mac\nconst options = {\n    dir: \x27.\/app\x27,\n    name: \x27应用名字\x27,\n    platform: \x27darwin\x27,\n    arch: arch, \/\/ 这就是工作参数 arch\n    overwrite: true,\n    appVersion: \x27Copyright(C) 2017 Qunhe\x27,\n    asar: {\n        unpackDir: \x27plugins\x27 \/\/ plugins 内的文件我们不希望打进 asar 格式包内\n    },\n    out: \x27.\/dist\x27,\n    icon: \x27.\/build_resource\/logo.icns\x27 \/\/ Mac 下 icon 格式是 .icns\n};\n\n\/\/ Win\nconst options = {\n    dir: \x27.\/app\x27,\n    platform: \x27win32\x27, \/\/ 不管是 32bit 还是 64bit 的 win，这里都是 win32\n    arch: arch, \/\/ 这里依靠 x64 或 ia32 去区分位数\n    overwrite: true,\n    asar: {\n        unpackDir: \x27plugins\x27\n    },\n    out: \x27.\/dist\x27,\n    icon: \x27.\/build_resource\/logo.ico\x27 \/\/ Win 下 icon 格式是 .ico\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Mac\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e options = {\n    \x3cspan class=\x22hljs-attr\x22\x3edir\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/app\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27应用名字\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eplatform\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27darwin\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3earch\x3c\/span\x3e: arch, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这就是工作参数 arch\x3c\/span\x3e\n    overwrite: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eappVersion\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Copyright(C) 2017 Qunhe\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3easar\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3eunpackDir\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27plugins\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ plugins 内的文件我们不希望打进 asar 格式包内\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3eout\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/dist\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eicon\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/build_resource\/logo.icns\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Mac 下 icon 格式是 .icns\x3c\/span\x3e\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Win\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e options = {\n    \x3cspan class=\x22hljs-attr\x22\x3edir\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/app\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eplatform\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27win32\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 不管是 32bit 还是 64bit 的 win，这里都是 win32\x3c\/span\x3e\n    arch: arch, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里依靠 x64 或 ia32 去区分位数\x3c\/span\x3e\n    overwrite: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3easar\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3eunpackDir\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27plugins\x27\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3eout\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/dist\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eicon\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/build_resource\/logo.ico\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Win 下 icon 格式是 .ico\x3c\/span\x3e\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eMac 下各处（Dock、任务栏、进程名等地）展示的应用名字只要指定了\x3ccode\x3ename\x3c\/code\x3e选项，就是处处一样的，所以你可以用 name 指定一个中午名字，而且 Mac 下默认编码都是 UTF-8，问题不大。\x3c\/p\x3e\n\x3cp\x3e而对于 Windows，首先其中文默认编码是 GBK 的，而所以如果指定中文名字可能会有奇怪的问题，所以 Windows 应用一般我不填\x3ccode\x3ename\x3c\/code\x3e项，这样它会去找你 app 目录下的 package.json 文件中的\x3ccode\x3eproductName\x3c\/code\x3e或\x3ccode\x3ename\x3c\/code\x3e字段值，这个字段一般设置是英文的，第二个不去设置中文的原因是，Windows 下应用的展示名字是 exe 主程序的\x3ccode\x3eFileDescription\x3c\/code\x3e配置项决定的，如果不去设置，那么可能你的应用用任务管理器打开，显示的进程是「Electron」，而不是你的应用名字。\x3c\/p\x3e\n\x3cp\x3e关于应用的实际名字和展示名字，Win 和 Mac 下都有自己的一套，这里不细展开。\x3cstrong\x3e而基于目前的实践，我给的建议是，Mac 下的开发，你可以直接指定\x3ccode\x3ename\x3c\/code\x3e为一个你要的中文应用名，而对于 Win，你最好像下面那样操作。\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e2. 补充应用信息（for win）\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e所用工具\x3c\/strong\x3e：rcedit\x3c\/p\x3e\n\x3cp\x3eCommand line tool to edit resources of exe file on Windows. 翻译过来就是一个用于编辑 exe 文件信息的windows 命令行工具，当然它已经有了 node 版本，叫 node-rcedit，也就是说你可以用 node 子进程的\x3ccode\x3eexec\x3c\/code\x3e去执行，也可以调用 node 版本的 API。\x3c\/p\x3e\n\x3cp\x3e可以这么用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22execSync(`\n.\\\\node_modules\\\\rcedit\\\\bin\\\\rcedit  \/\/ 调用rcedit\n.\/dist\/xxxxxx.exe  \/\/ 目标文件（刚打包出来的主程序）\n--set-version-string \x26quot;LegalCopyright\x26quot; \x26quot;Copyright(C) 2017 Health\x26quot; \/\/ 版权信息\n--set-version-string \x26quot;CompanyName\x26quot; \x26quot;仙风道骨养生俱乐部\x26quot;  \/\/ 公司名字\n--set-version-string \x26quot;ProductName\x26quot; \x26quot;养生\x26quot; \/\/ 产品名字\n--set-version-string \x26quot;FileDescription\x26quot; \x26quot;养生宝典\x26quot; \/\/ 这个很重要，因为这个就是你打开任务管理器看到的进程名字\n`);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eexecSync(\x3cspan class=\x22hljs-string\x22\x3e`\n.\\\\node_modules\\\\rcedit\\\\bin\\\\rcedit  \/\/ 调用rcedit\n.\/dist\/xxxxxx.exe  \/\/ 目标文件（刚打包出来的主程序）\n--set-version-string \x22LegalCopyright\x22 \x22Copyright(C) 2017 Health\x22 \/\/ 版权信息\n--set-version-string \x22CompanyName\x22 \x22仙风道骨养生俱乐部\x22  \/\/ 公司名字\n--set-version-string \x22ProductName\x22 \x22养生\x22 \/\/ 产品名字\n--set-version-string \x22FileDescription\x22 \x22养生宝典\x22 \/\/ 这个很重要，因为这个就是你打开任务管理器看到的进程名字\n`\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e大部分信息，你可以右键主程序(.exe)文件，「属性 —— 详细信息」中看到，这么做还有一个考虑是，这样你的应用看上去会更加规范。\x3c\/p\x3e\n\x3cp\x3e这里肯定有人说，为什么不用\x3ccode\x3eelectron-builder\x3c\/code\x3e，因为我首先接触到的是\x3ccode\x3eelectron-packager\x3c\/code\x3e，我觉得够用（因为我有一台 win 和一台 mac，跨平台打包，不存在的），第二，\x3ccode\x3eelectron-packager\x3c\/code\x3e完成打包的事就够了，后面构建安装包等过程可以让我们有更多的选择，符合本文的工作流设定，每个环节做每个环节该做的事就好，当然你也可以选择\x3ccode\x3eelectron-builder\x3c\/code\x3e，能达到目的就好。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e五、代码签名环节\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e目的\x3c\/strong\x3e：使应用被系统所认可，能正常安装\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e做的事\x3c\/strong\x3e：给应用进行代码签名\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e1. 为什么需要代码签名，没有会怎样\x3c\/h3\x3e\n\x3cp\x3e代码签名的目的就是为了安全，你的应用一旦经过了代码签名，如果发行过程中被篡改，你的用户会看到系统给出的警告提示，而对于发行方而言，代码签名后，应用才能被系统认可，很大概率不会被杀毒软件做掉，而且如果你要提交一些软件市场，一些软件市场要求应用需要有合法的代码签名。\x3c\/p\x3e\n\x3cp\x3e而如果作为铁头娃的你铁定不签名，这应用就不能跑了么？不是的，还是可以跑的，只不过对你的用户来说很不友好。\x3c\/p\x3e\n\x3ch4\x3e1.1 Windows 下有和没有代码签名的差别\x3c\/h4\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011908329\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011908329\x22 alt=\x22签名对比\x22 title=\x22签名对比\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eWindows 下代码签名的限制没有 Mac 那么严，你选择「是」都是可以安装使用的，但是从你产品的用户角度，有一个代码签名会更可靠，此外，这样的没有签名的安装包在一些软件市场可能都提交不上去。\x3c\/p\x3e\n\x3ch4\x3e1.2 Mac 下有和没有代码签名的差别\x3c\/h4\x3e\n\x3cp\x3eMac 下有和没有代码签名的差别就很大了，没有合法的代码签名，你的 .dmg 安装包根本没法打开。\x3c\/p\x3e\n\x3cp\x3e如果没有代码签名，Mac 下的 .dmg 安装包打开，首先会提示你「该应用来自身份不明的开发者，是否确认打开」，然后你点「确认」，再根据你的安全设定（系统偏好设置 —— 安全和隐私 —— 允许从以下位置的应用下的设置）去决定，而绝大部分的 Mac 用户都是勾选「App Store 和 被认证的开发者」，于是就算你点了「打开」，直接会告诉你「打不开XXX，因为它来自身份不明的开发者」，这个时候只能去改变「系统偏好设置 —— 安全和隐私 —— 允许从以下位置的应用下的设置」才能打开。\x3c\/p\x3e\n\x3cp\x3e典型的盗版软件安装方式啊，所以作为一款要发行的产品，我们一定是需要代码签名的。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e2. Windows 下的代码签名\x3c\/h3\x3e\n\x3cp\x3e总体建议：个人的小项目就不用 Windows 代码签名了，因为很贵，2K\x2b\/年，而且 Windows 下代码签名没有问题不是非常大（和 Mac 相比），公司的产品，那就必须要的。\x3c\/p\x3e\n\x3ch4\x3e2.1 购买微软代码签名证书\x3c\/h4\x3e\n\x3cp\x3e可以向权威的 CA 机构购买代码签名证书，这里就我了解的做一个建议：建议向赛门铁克购买签名普通软件（非驱动）的微软代码签名证书，大概几百刀一年。\x3c\/p\x3e\n\x3cp\x3e背景说明：目前我们用的是沃通的代码签名证书，赛门铁克的只是咨询过，没用过。\x3c\/p\x3e\n\x3cp\x3e就以上的建议做一个解释，为什么我这么建议：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e我们需要代码签名，进一步，需要把 Windows 代码签名这一环节也做到自动化流程中，这是我们的需求\x3c\/li\x3e\n\x3cli\x3e沃通的代码签名证书是封死在 U 盘里，所以可认为这是物理证书，更安全，但很不方便，不可能导出来进行签名的\x3c\/li\x3e\n\x3cli\x3e了解到的，赛门铁克颁发的如果是针对普通软件（非驱动的），那么是可以给颁发文件格式的真·电子证书的\x3c\/li\x3e\n\x3cli\x3e意味着沃通的证书我们要签名，需要依靠一个物理U盘\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e最坑爹的\x3c\/strong\x3e：沃通的代码签名时，要手输密码，如果一个 Windows 应用我们选择 SHA1 \x2b SHA256 的签名方式，那么应用和安装包，我们需要输4次密码，气到拉闸，他们官方说有自己的命令行，实际是命令行唤起他们的 GUI 图形界面来签名，还不是需要人工操作\x3c\/li\x3e\n\x3cli\x3e所以，显然这和我们的「自动化」目标相去甚远，我建议普通的应用，没有涉及到高度安全的，不要选择购买封死在 U 盘中的 Windows 代码签名证书。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e2.2 签名\x3c\/h4\x3e\n\x3cp\x3e当你购买了证书后，就可以利用\x3ccode\x3esigntool\x3c\/code\x3e 命令行进行签名了，命令怎么写，这些都在你购买证书的 CA 网站上找到或者 google 一下，这里要说的就两点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eWindows 代码签名我们目前选择 SHA1 签名后再追加 SHA2（SHA256） 签名，这样的组合方式，安全和兼容性最好\x3c\/li\x3e\n\x3cli\x3e代码签名可以在 gulpfile 文件中封装成一个方法（参数是需要签名的文件路径），因为我们会多次调用\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e2.3 查看签名信息\x3c\/h4\x3e\n\x3cp\x3e查看 Windows 代码签名信息很简单，右键你签名的文件，签名后的文件，属性打开会有一个「数字签名」的 tab，点击切换到「数字签名」可以看到代码签名信息。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e3. Mac 下的代码签名\x3c\/h3\x3e\n\x3cp\x3e总体建议：Mac 下应用要代码签名，因为很方便，也不是很贵，个人开发者 99 USD 一年，如果公司有 Apple Develop Team，你可以直接加入，关键是 Mac 下如果你不进行可供分发的代码签名，你的应用很难被他人安装啊。\x3c\/p\x3e\n\x3ch4\x3e3.1 利用 Xcode 申请证书，各个证书间差别\x3c\/h4\x3e\n\x3cp\x3e证书是可以在 Xcode 下申请的，Xcode —— Preference —— Account 下，选择一个Team（之前要先加入），如果是独立开发者，就选自己 Apple ID 的那个，点击「Manage Certificates」，弹出的弹窗中左下角点加号，可以选择需要的证书。\x3c\/p\x3e\n\x3cp\x3e我看到之后的第一反应是：尼玛，哪些是我要的啊。下面简单说明下（摘自\x3ca href=\x22https:\/\/sspai.com\/post\/40269\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMac App 发布的最后 1km\x3c\/a\x3e）：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3eDeveloper Certificate\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3eMac Development ：这个只用来开发，Debug，不是正式发布的版本\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3eProduction Certificate\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3eMac App Store\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eMac App Distribution ：这个用于 Xcode 自己把 .app 文件上传到 Mac App Store\x3c\/li\x3e\n\x3cli\x3eMac Installer Distribution ：这个没用过，但可以肯定的，也是上传 Mac App Store 用的\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3eDeveloper ID\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3eDeveloper ID Application\x3c\/strong\x3e：这个用于开发者使用开发者帐号签名，导出一个线下发布版本的 .app 文件，脱离了苹果的 Mac App Store。\x3c\/li\x3e\n\x3cli\x3eDeveloper ID Installer：用于开发者打包，同时加上开发者帐号签名，打包工具在下面介绍。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e我们主要需要的就是「Developer ID Application」这个类型的证书，「Mac Development」只是用于开发的，而前者可以供分发，也就是签名后，别人下载安装，就是来自「被认证的开发者」的应用啦。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e如果是在一个 Team 中，不是个人独立开发者\x3c\/strong\x3e，那么这个「Developer ID Application」证书的申请你是没有权限的，就算你们 Team 的 Agent 设置你为 admin（管理员），你还是没有权限的，因为一个「Developer ID Application」只有一个 Team 的 agent（owner） 才能申请，你需要做的是利用你 Mac 上的钥匙串工具（具体怎么做，google 下就可以了），生成「CertificateSigningRequest」（简称 CSR），然后发给你的 team agent，让他帮你生成证书，发回给你，你再安装到自己机子上，搞定。\x3c\/p\x3e\n\x3cp\x3e你可以在终端调用\x3ccode\x3esecurity find-identity -p codesigning -v\x3c\/code\x3e来看一下你可用的代码签名证书，其中那个\x3ccode\x3eDeveloper ID Application\x3c\/code\x3e开头的就是我们要的。\x3c\/p\x3e\n\x3ch4\x3e3.2 签名\x3c\/h4\x3e\n\x3cp\x3e\x3cstrong\x3e所用工具\x3c\/strong\x3e：electron-osx-sign\x3c\/p\x3e\n\x3cp\x3eMac 下的签名简直是红红火火开开心心嘿嘿哈哈啊，你可以从\x3ca href=\x22https:\/\/mintkit.net\/electron-userland\/electron-osx-sign\/guide\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eelectron-osx-sign 指导\x3c\/a\x3e这里获得完全的指导，你在这个页面右边可以根据你的项目进行填写，页面最后会根据你的配置，给你一段你都可以直接复制的签名代码，完美。\x3c\/p\x3e\n\x3cp\x3e而且签名还能集成到打包阶段，不过我建议还是拿出来好，比较清真。\x3c\/p\x3e\n\x3ch4\x3e3.3 查看签名信息\x3c\/h4\x3e\n\x3cp\x3eMac 下查看文件签名信息，你可以终端运行\x3ccode\x3ecodesign --display --verbose=4 \x22文件路径\x22\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e六、构建安装包环节\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e目的\x3c\/strong\x3e：使你的应用可以被安装（如果没有这一步，你能怎么办，压缩整个应用文件夹，然后分发这个压缩包，呃，你能接受也可以啊）\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e做的事\x3c\/strong\x3e：把经历了打包和签名环节后的应用程序文件夹（Mac 下的\x3ccode\x3e.app\x3c\/code\x3e其实也是文件夹）打成一个安装包文件\x3c\/p\x3e\n\x3cp\x3e为什么要构建安装包，这有很多的原因，可能你也会想到很多，其中值得强调的两点，一是构建安装包会直接便利于应用的自动更新，具体我们下一篇文章里再说，二是 Win 下安装包的体积相比原先的文件夹，体积明显小很多，在硬盘容积很大的时代，下载体积才是最影响用户体验的，而安装后的体积不是最需要考虑的体积。\x3c\/p\x3e\n\x3cp\x3e安装包这个事和代码签名类似，两个不同的系统（Win 和 Mac）实现完全不同，Windows 下我们习惯\x3ccode\x3e.exe\x3c\/code\x3e或\x3ccode\x3e.msi\x3c\/code\x3e这样的安装包格式，习惯点下一步到完成或一键安装，而 Mac 下除了 Store 下载安装的，我们习惯的\x3ccode\x3e.dmg\x3c\/code\x3e格式的，挂载后打开，将里面的应用拖入到\x3ccode\x3eApplication\x3c\/code\x3e文件夹就完成了安装。\x3c\/p\x3e\n\x3cp\x3e这里我们实现的就是经典的 Windows exe 安装和 Mac dmg 安装，相比较而言，Windows 下的繁琐得多得多。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e1. Windows 下利用 inno setup 进行安装包构建\x3c\/h3\x3e\n\x3ch4\x3e1.1 为什么用这个 inno setup\x3c\/h4\x3e\n\x3cp\x3e最终说服我使用 inno setup 来构建应用安装包的理由是，VS Code 也是这么做的。因为按照程序这个领域离一个小前端已经很遥远了，对于跨度大的未知东西，一般都会做充足的调研，最后发现 VS Code 也是这么做的，好，干！\x3c\/p\x3e\n\x3cp\x3e而使用了一段时间后，我可以说几点不后悔的理由（当然我没使用过其他的安装包构建工具，所以仅一些偏见）：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3einno setup 应该是 windows 下构建安装程序的老牌工具了，你可以去进他们的官网，一股「老牌可靠」的风格扑面而来，可靠\x3c\/li\x3e\n\x3cli\x3e它有 GUI 和 命令行工具，有 unicode 版本（意味着完全支持中文），gulp 有别人写好的现成的插件（对于中文应用需要修改）\x3c\/li\x3e\n\x3cli\x3e基本使用的话，学习成本不大，基本去找一些案例配置文件去学一下就可以了\x3c\/li\x3e\n\x3cli\x3e进阶使用，需要写 pascal 脚本，但是功能是真的强大\x3c\/li\x3e\n\x3cli\x3e还有一点我感受很好的是，这个工具的支持很好，stackoverflow 上有足够的问答资源，如果还是没有你满意的，官网有一个看上去很很很简陋的论坛，但是很有用啊，我问过 2 个问题，睡一觉起来都有回应了\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e1.2 怎么学习 inno setup\x3c\/h4\x3e\n\x3cp\x3e先可以自己去搜一下 inno setup，进入官网逛一逛，下载安装一下（记得安装 unicode 版本，即括号里有 u 的版本），浏览后有几个基本认知需要具备：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3einno setup 是\x3cstrong\x3e完全根据配置文件（.iss）来构建安装程序\x3c\/strong\x3e的，你用 GUI 其实也是去编写 .iss 文件，然后利用这个配置构建的\x3c\/li\x3e\n\x3cli\x3einno setup 可以用 pascal 脚本控制安装向导的行为，这是进阶的使用方式，足够你安装自己的设想优化安装程序了\x3c\/li\x3e\n\x3cli\x3einno setup 构建出来的安装包运行时可以添加参数，使安装有不同的表现，比如完全静默的后台安装（Amazing，这里的参数对于自动更新很有用）\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e有了上面的几点认知，可以给出「学习和使用 inno setup 路径」的建议：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e下载安装后，找几篇 inno setup GUI 使用教程，尝试构建一个安装包（要可以安装的）\x3c\/li\x3e\n\x3cli\x3e找一些 inno setup 配置文件的案例，对于 inno setup 配置方式有一个印象，分多个[section]，每个[section]有很多配置项，每个配置项可能有多个字段\x3c\/li\x3e\n\x3cli\x3e可以把 \x3ca href=\x22http:\/\/www.jrsoftware.org\/ishelp\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3einno setup 官方文档\x3c\/a\x3e 浏览一遍，跳过「pascal scripting」部分\x3c\/li\x3e\n\x3cli\x3e到这里，你应该能看得懂他人的 .iss 文件里除了 [code] 这个 section 外的配置了\x3c\/li\x3e\n\x3cli\x3e把安装向导的语言换成中文（先要导入中文语言包，再改配置，具体做法也有一些文章说到了，不多说，这一步对于你之后步骤也是有用的）\x3c\/li\x3e\n\x3cli\x3e可以尝试正式结合到你的 gulp 工作流了\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch4\x3e1.3 怎么结合到 gulp 工作流中\x3c\/h4\x3e\n\x3cp\x3e\x3cstrong\x3e所用工具\x3c\/strong\x3e：修改后的 gulp-inno\x3c\/p\x3e\n\x3cp\x3e如果按照之前的步骤花了个把小时大概学习了下 inno setup 的话，那么到这里你应该可以尝试把 inno setup 构建安装包做到你的 gulp 工作流中了，如果还不熟悉 inno setup 配置文件，没关系，你可以从仿照开始，不要怂，就是干，都到这一步了，谁怂谁尴尬。\x3c\/p\x3e\n\x3cp\x3e配置文件的详解不是这里的重点，所以不再展开，把 inno setup 整合进脚本中，因为它本身提供命令行工具，勤快和好学的你可以根据官方或其他渠道的指导自己封装一个 node 模块，而我就比较懒了，搜到一个已有的 gulp 插件 —— 「gulp-inno」，高兴地一匹。\x3c\/p\x3e\n\x3cp\x3e然而，事情总不会那么顺利，该吃的shi躲不掉，该经历的坑绕不过，这才叫「历shi」。我利用「gulp-inno」根据其指导怎么都不能正确编译，大概提示是有不合法的字符的意思。\x3c\/p\x3e\n\x3cp\x3e明白了，绝壁是「gulp-inno」里包的 inno setup 不是 unicode 版本，所以一旦有中文等字符，就出错了，我看到这个包里的 inno 文件夹完全就是和我的 inno setup 文件夹没差嘛，于是我把我本地安装的 inno setup 文件夹里内容复制替换到 gulp-inno 的 inno 的文件夹内，问题解决。\x3c\/p\x3e\n\x3cp\x3e因为我之前导入过中文语言包，所以我复制过去的时候，中文语言包也复制过去了，可以愉快地配置安装向导界面为中文了。\x3c\/p\x3e\n\x3cp\x3e一旦修改好「gulp-inno」包（替换成 unicode 版本 \x26amp; 加入简体中文语言包），就可以怎么操作：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ 1. 准备 iss 文件：填充你的 iss 配置文件模板，并输出到 dist 目录下\n\nconst appInfo = require(\x27.\/app\/package.json\x27); \/\/ 所有和应用相关的信息从 package.json 读取\nconst bom = require(\x27gulp-bom\x27); \/\/ 这是为了解析中文的\nconst outputName = \n`${appInfo.name}-${platform}-${appInfo.version}-${process.env.NODE_ENV}`;\nconst outputIssName = \n`${appInfo.name}-${platform}-${process.env.NODE_ENV}.iss`\n\ngulp\n    .src(`.\/build_resource\/installer_win_config_${platform}.iss`)\n    .pipe(bom())\n    .pipe(replace(\x27${version}\x27, appInfo.version))\n    .pipe(replace(\x27${appExe}\x27, `${appInfo.name}.exe`))\n    .pipe(replace(\x27${sourcePath}\x27, `${appInfo.name}-${platform}`))\n    .pipe(replace(\x27${outputName}\x27,outputName))\n    .pipe(rename(outputIssName))\n    .pipe(gulp.dest(\x27.\/dist\x27))\n    .on(\x27end\x27, () =\x3e {\n        \/\/ .iss file is ready\n    })\n\n\/\/ 2. 交给 inno setup\n\nconst inno = require(\x27my-gulp-inno\x27); \/\/ 修改后的 gulp-inno\n\ngulp\n    .src(`.\/dist\/${outputIssName}`)\n    .pipe(inno())\n    .on(\x27end\x27, () =\x3e {\n        \/\/ you have an installer now\n    });\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1. 准备 iss 文件：填充你的 iss 配置文件模板，并输出到 dist 目录下\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e appInfo = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/app\/package.json\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所有和应用相关的信息从 package.json 读取\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e bom = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27gulp-bom\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这是为了解析中文的\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e outputName = \n\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${appInfo.name}\x3c\/span\x3e-\x3cspan class=\x22hljs-subst\x22\x3e${platform}\x3c\/span\x3e-\x3cspan class=\x22hljs-subst\x22\x3e${appInfo.version}\x3c\/span\x3e-\x3cspan class=\x22hljs-subst\x22\x3e${process.env.NODE_ENV}\x3c\/span\x3e`\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e outputIssName = \n\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${appInfo.name}\x3c\/span\x3e-\x3cspan class=\x22hljs-subst\x22\x3e${platform}\x3c\/span\x3e-\x3cspan class=\x22hljs-subst\x22\x3e${process.env.NODE_ENV}\x3c\/span\x3e.iss`\x3c\/span\x3e\n\ngulp\n    .src(\x3cspan class=\x22hljs-string\x22\x3e`.\/build_resource\/installer_win_config_\x3cspan class=\x22hljs-subst\x22\x3e${platform}\x3c\/span\x3e.iss`\x3c\/span\x3e)\n    .pipe(bom())\n    .pipe(replace(\x3cspan class=\x22hljs-string\x22\x3e\x27${version}\x27\x3c\/span\x3e, appInfo.version))\n    .pipe(replace(\x3cspan class=\x22hljs-string\x22\x3e\x27${appExe}\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${appInfo.name}\x3c\/span\x3e.exe`\x3c\/span\x3e))\n    .pipe(replace(\x3cspan class=\x22hljs-string\x22\x3e\x27${sourcePath}\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${appInfo.name}\x3c\/span\x3e-\x3cspan class=\x22hljs-subst\x22\x3e${platform}\x3c\/span\x3e`\x3c\/span\x3e))\n    .pipe(replace(\x3cspan class=\x22hljs-string\x22\x3e\x27${outputName}\x27\x3c\/span\x3e,outputName))\n    .pipe(rename(outputIssName))\n    .pipe(gulp.dest(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/dist\x27\x3c\/span\x3e))\n    .on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e, () =\x26gt; {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ .iss file is ready\x3c\/span\x3e\n    })\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 2. 交给 inno setup\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e inno = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27my-gulp-inno\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 修改后的 gulp-inno\x3c\/span\x3e\n\ngulp\n    .src(\x3cspan class=\x22hljs-string\x22\x3e`.\/dist\/\x3cspan class=\x22hljs-subst\x22\x3e${outputIssName}\x3c\/span\x3e`\x3c\/span\x3e)\n    .pipe(inno())\n    .on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e, () =\x26gt; {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ you have an installer now\x3c\/span\x3e\n    });\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e1.4 未来可以做什么\x3c\/h4\x3e\n\x3cp\x3e当时还有一个看中 inno setup 的理由是，它可以让我们定制我们的安装向导步骤和外观，也就是说你可以让你的应用也像其他一些优秀的产品一样，在安装的时候可以定制酷炫的外观，可以优化安装流程，支持一键安装，inno setup 还是可以玩出一些花样的，enjoy。\x3c\/p\x3e\n\x3ch4\x3e1.5 对安装包也进行代码签名\x3c\/h4\x3e\n\x3cp\x3e同样的，安装包也需要代码签名，利用之前封装的签名方法进行签名就行了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e2. Mac 下的构建 dmg 安装包\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e所用工具\x3c\/strong\x3e：appdmg\x3c\/p\x3e\n\x3cp\x3e相比于 windows 的安装包构建，Mac 下的构建安装包又是美滋滋啊，你看我下面小标题都没有就知道了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 因为 appdmg 在 windows 下不能下载安装的，所以放在外部 package.json 的 optionalDependencies 下\n\/\/ 在 gulp 脚本中需要做 try...catch 处理，否则当你回到 windows 下使用这份 gulp 时会出报错\nlet appdmg;\ntry {\n    appdmg = require(\x27appdmg\x27);\n} catch (err) {\n    appdmg = null;\n}\n\nconst dmg = appdmg({\n    \/\/ 打出的目标 dmg\n    target: `dist\/balabala.dmg`,\n    \/\/ 基准目录，以下的资源都基于这个目录\n    basepath: __dirname,\n    \/\/ 具体的选项\n    specification: {\n        \/\/ dmg 打开后的窗口名字\n        \/\/ 注意不要给中文，给中文会导致下面的 background 无效，不明白, github 上也有人提了这个 issue\n        title: `myapp`,\n        \/\/ dmg 挂载后的图标，出现在桌面上\n        icon: \x26quot;xxx.icns\x26quot;,\n        \/\/ 背景图，如果同时存在 bg.png 和 bg@2x.png，appdmg 会根据用户屏幕自己找合适的图\n        background: \x26quot;bg.png\x26quot;,\n        \/\/ 里面所有icon的尺寸\n        \x27icon-size\x27: 96,\n        \/\/ 窗口设置\n        window: {\n            size: {\n                width: 550,\n                height: 320\n            }\n        },\n        \/\/ 里面的内容，x 是指这个 icon 中心距离窗口最左边的距离，y 是指这个 icon 中心距离窗口顶部的距离\n        \/\/ 这里可以指定一个name项，不要给中文，会导致图标异常\n        contents: [\n            { \x26quot;x\x26quot;: 400, \x26quot;y\x26quot;: 128, \x26quot;type\x26quot;: \x26quot;link\x26quot;, \x26quot;path\x26quot;: \x26quot;\/Applications\x26quot; },\n            { \x26quot;x\x26quot;: 150, \x26quot;y\x26quot;: 128, \x26quot;type\x26quot;: \x26quot;file\x26quot;, \x26quot;path\x26quot;: \x26quot;你的应用.app\x26quot; }\n        ],\n        \/\/ 对 dmg 进行代码签名\n        \x27code-sign\x27: {\n            \x27signing-identity\x27: \x27你的代码签名证书\x27\n        }\n    }\n});\ndmg.on(\x27finish\x27, function () {\n    \/\/ you have a dmg now\n});\ndmg.on(\x27error\x27, function (err) {\n    \/\/ error\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 因为 appdmg 在 windows 下不能下载安装的，所以放在外部 package.json 的 optionalDependencies 下\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在 gulp 脚本中需要做 try...catch 处理，否则当你回到 windows 下使用这份 gulp 时会出报错\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e appdmg;\n\x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n    appdmg = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27appdmg\x27\x3c\/span\x3e);\n} \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n    appdmg = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dmg = appdmg({\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 打出的目标 dmg\x3c\/span\x3e\n    target: \x3cspan class=\x22hljs-string\x22\x3e`dist\/balabala.dmg`\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 基准目录，以下的资源都基于这个目录\x3c\/span\x3e\n    basepath: __dirname,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 具体的选项\x3c\/span\x3e\n    specification: {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ dmg 打开后的窗口名字\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注意不要给中文，给中文会导致下面的 background 无效，不明白, github 上也有人提了这个 issue\x3c\/span\x3e\n        title: \x3cspan class=\x22hljs-string\x22\x3e`myapp`\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ dmg 挂载后的图标，出现在桌面上\x3c\/span\x3e\n        icon: \x3cspan class=\x22hljs-string\x22\x3e\x22xxx.icns\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 背景图，如果同时存在 bg.png 和 bg@2x.png，appdmg 会根据用户屏幕自己找合适的图\x3c\/span\x3e\n        background: \x3cspan class=\x22hljs-string\x22\x3e\x22bg.png\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 里面所有icon的尺寸\x3c\/span\x3e\n        \x3cspan class=\x22hljs-string\x22\x3e\x27icon-size\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e96\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 窗口设置\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3esize\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e550\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e320\x3c\/span\x3e\n            }\n        },\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 里面的内容，x 是指这个 icon 中心距离窗口最左边的距离，y 是指这个 icon 中心距离窗口顶部的距离\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里可以指定一个name项，不要给中文，会导致图标异常\x3c\/span\x3e\n        contents: [\n            { \x3cspan class=\x22hljs-string\x22\x3e\x22x\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22y\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e128\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22type\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22link\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22path\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\/Applications\x22\x3c\/span\x3e },\n            { \x3cspan class=\x22hljs-string\x22\x3e\x22x\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e150\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22y\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e128\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22type\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22file\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22path\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22你的应用.app\x22\x3c\/span\x3e }\n        ],\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对 dmg 进行代码签名\x3c\/span\x3e\n        \x3cspan class=\x22hljs-string\x22\x3e\x27code-sign\x27\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-string\x22\x3e\x27signing-identity\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27你的代码签名证书\x27\x3c\/span\x3e\n        }\n    }\n});\ndmg.on(\x3cspan class=\x22hljs-string\x22\x3e\x27finish\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ you have a dmg now\x3c\/span\x3e\n});\ndmg.on(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ error\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其余的配置和所以配置影响的内容可以参加 \x3ca href=\x22https:\/\/github.com\/LinusU\/node-appdmg\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eappdmg githug 主页\x3c\/a\x3e，然后就是自己试试看了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader16\x22\x3e七、发行环节\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e目的\x3c\/strong\x3e：使应用可以被下载（上一步只是能被安装，但并不能被下载）\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e做的事\x3c\/strong\x3e：重命名应用安装包供发行，上传应用安装包到云存储服务器供下载\x3c\/p\x3e\n\x3cp\x3e这一步根据每个人使用的云存储方式不同而需要利用卖方提供的 API 编写合适的脚本去上传你的安装包，因此具体的脚本不做展开，只是有几点最佳实践可以参考：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e上传前，把你的安装包文件重命名成符合一定规范的，可能是「应用名-版本-阶段-系统-尾数」，可能是「应用名-版本-系统-构建号」，可能是...这个就自己定，但一定要有一个合适的命名，这样一看到名字就知道这个是啥，不会弄错\x3c\/li\x3e\n\x3cli\x3e你的 OSS 服务器上要针对应用安装包的不同阶段建立不同的文件夹，一方面可以方面管理，另一方面也便于做权限管理\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e当你上传了你的安装包后，也就意味着这个安装包有了一个下载链接，你可以分发这个链接供用户下载啦，至此终于走完了「代码」到可下载「安装包」的过程，鼓掌。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader17\x22\x3e八、路漫漫\x3c\/h2\x3e\n\x3cp\x3e这一路走来看上去已经很有成就感，但实际上还有许多事可以做得更好，不过工程化的东西，逻辑清晰、流程自动化、能满足需求就可以了，而搭好工程，我们需要开始专注于 Electron 应用的功能开发了，才刚刚要迈上红地毯，路还有很长，下期见。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader18\x22\x3e附：gulp 文件和脚本看上去会是怎样的\x3c\/h2\x3e\n\x3cp\x3e对之前的工作流做一个小结（如果遇到有一些旧文件覆盖不了，可以自己加一个清理环节或方法，去清理旧文件）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/* gulpfile.js START *\/\n\/\/ 此处省略一堆需要引入的依赖\n\n\/\/ 工作参数\nlet platform = \x27win32\x27;\nlet arch = \x27ia32\x27;\nlet needSign = false;\n\n\/\/ 配置环节\ngulp.task(\x27env\x27, (cb) =\x3e {\n    \/\/ ...\n});\n\n\/\/ 开发调试\ngulp.task(\x27dev\x27, [\x27env\x27], (cb) =\x3e {\n    exec(\x27electron app --debug\x27, (err) =\x3e {\n        if (err) return cb(err);\n        cb();\n    });\n});\n\n\/\/ 打包环节\ngulp.task(\x27pack\x27,[\x27env\x27], (cb) =\x3e {\n    if (platform === \x27darwin\x27) {\n        \/\/ ...\n    } else {\n        \/\/ ...\n    }\n});\n\n\/\/ 签名环节\ngulp.task(\x27sign-pack\x27, [\x27pack\x27], (cb) =\x3e {\n    if (needSign) {\n        if (platform === \x27win32\x27 || platform === \x27win64\x27) {\n            \/\/ ...\n        } else if (platform === \x27darwin\x27) {\n            \/\/ ...\n        }\n    } else {\n        cb();\n    }\n});\n\n\/\/ 构建环节\ngulp.task(\x27build\x27, [\x27sign-pack\x27], (cb) =\x3e {\n    if (platform === \x27darwin\x27) {\n        \/\/ ...\n    } else {\n        \/\/ ...\n    }\n});\n\n\/\/ 发行环节\ngulp.task(\x27release\x27, [\x27build\x27], (cb) =\x3e {\n    \/\/ ...\n});\n\nconst codeSignForWin = (filePath) =\x3e {...};\n\nconst codeSignForMac = (filePath) =\x3e {...};\n\nconst detectPlatform = () =\x3e {...};\n\/* gulpfile.js END *\/\n\n\n\/\/ package.json 中配脚本\n \x26quot;scripts\x26quot;: {\n    \x26quot;yarnall\x26quot;: \x26quot;yarn \x26amp;\x26amp; (cd app \x26amp;\x26amp; yarn)\x26quot;,\n    \x26quot;start\x26quot;: \x26quot;cross-env NODE_ENV=dev gulp dev\x26quot;,\n    \x26quot;packDev\x26quot;: \x26quot;cross-env NODE_ENV=dev gulp pack\x26quot;,\n    \x26quot;packAlpha\x26quot;: \x26quot;cross-env NODE_ENV=alpha gulp pack\x26quot;,\n    \x26quot;packProd\x26quot;: \x26quot;cross-env NODE_ENV=prod gulp pack\x26quot;,\n    \x26quot;buildDev\x26quot;: \x26quot;cross-env NODE_ENV=dev gulp build\x26quot;,\n    \x26quot;buildAlpha\x26quot;: \x26quot;cross-env NODE_ENV=alpha gulp build\x26quot;,\n    \x26quot;buildProd\x26quot;: \x26quot;cross-env NODE_ENV=prod gulp build\x26quot;,\n    \x26quot;releaseDev\x26quot;: \x26quot;cross-env NODE_ENV=dev gulp release\x26quot;,\n    \x26quot;releaseAlpha\x26quot;: \x26quot;cross-env NODE_ENV=alpha gulp release\x26quot;,\n    \x26quot;releaseProd\x26quot;: \x26quot;cross-env NODE_ENV=prod gulp release\x26quot;\n  }\n\/\/ 可选命令行参数：\n\/\/      sign: 是否签名\n\/\/      platform: 系统平台\n\/\/      arch: 系统位数\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/* gulpfile.js START *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 此处省略一堆需要引入的依赖\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 工作参数\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e platform = \x3cspan class=\x22hljs-string\x22\x3e\x27win32\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e arch = \x3cspan class=\x22hljs-string\x22\x3e\x27ia32\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e needSign = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 配置环节\x3c\/span\x3e\ngulp.task(\x3cspan class=\x22hljs-string\x22\x3e\x27env\x27\x3c\/span\x3e, (cb) =\x26gt; {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 开发调试\x3c\/span\x3e\ngulp.task(\x3cspan class=\x22hljs-string\x22\x3e\x27dev\x27\x3c\/span\x3e, [\x3cspan class=\x22hljs-string\x22\x3e\x27env\x27\x3c\/span\x3e], (cb) =\x26gt; {\n    exec(\x3cspan class=\x22hljs-string\x22\x3e\x27electron app --debug\x27\x3c\/span\x3e, (err) =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cb(err);\n        cb();\n    });\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 打包环节\x3c\/span\x3e\ngulp.task(\x3cspan class=\x22hljs-string\x22\x3e\x27pack\x27\x3c\/span\x3e,[\x3cspan class=\x22hljs-string\x22\x3e\x27env\x27\x3c\/span\x3e], (cb) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (platform === \x3cspan class=\x22hljs-string\x22\x3e\x27darwin\x27\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 签名环节\x3c\/span\x3e\ngulp.task(\x3cspan class=\x22hljs-string\x22\x3e\x27sign-pack\x27\x3c\/span\x3e, [\x3cspan class=\x22hljs-string\x22\x3e\x27pack\x27\x3c\/span\x3e], (cb) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (needSign) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (platform === \x3cspan class=\x22hljs-string\x22\x3e\x27win32\x27\x3c\/span\x3e || platform === \x3cspan class=\x22hljs-string\x22\x3e\x27win64\x27\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (platform === \x3cspan class=\x22hljs-string\x22\x3e\x27darwin\x27\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n        }\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        cb();\n    }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 构建环节\x3c\/span\x3e\ngulp.task(\x3cspan class=\x22hljs-string\x22\x3e\x27build\x27\x3c\/span\x3e, [\x3cspan class=\x22hljs-string\x22\x3e\x27sign-pack\x27\x3c\/span\x3e], (cb) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (platform === \x3cspan class=\x22hljs-string\x22\x3e\x27darwin\x27\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n    }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发行环节\x3c\/span\x3e\ngulp.task(\x3cspan class=\x22hljs-string\x22\x3e\x27release\x27\x3c\/span\x3e, [\x3cspan class=\x22hljs-string\x22\x3e\x27build\x27\x3c\/span\x3e], (cb) =\x26gt; {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n});\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e codeSignForWin = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3efilePath\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {...};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e codeSignForMac = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3efilePath\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {...};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e detectPlatform = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {...};\n\x3cspan class=\x22hljs-comment\x22\x3e\/* gulpfile.js END *\/\x3c\/span\x3e\n\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ package.json 中配脚本\x3c\/span\x3e\n \x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22yarnall\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22yarn \x26amp;\x26amp; (cd app \x26amp;\x26amp; yarn)\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22start\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=dev gulp dev\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22packDev\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=dev gulp pack\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22packAlpha\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=alpha gulp pack\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22packProd\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=prod gulp pack\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22buildDev\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=dev gulp build\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22buildAlpha\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=alpha gulp build\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22buildProd\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=prod gulp build\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22releaseDev\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=dev gulp release\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22releaseAlpha\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=alpha gulp release\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22releaseProd\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=prod gulp release\x22\x3c\/span\x3e\n  }\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 可选命令行参数：\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/      sign: 是否签名\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/      platform: 系统平台\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/      arch: 系统位数\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>用 Electron 打造 Win/Mac 应用，从「代码」到可下载的「安装包」，可能比你想得麻烦一点</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011908324">https://segmentfault.com/a/1190000011908324</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/gy01jgdooc5/" target="_blank">https://alili.tech/archive/gy01jgdooc5/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>