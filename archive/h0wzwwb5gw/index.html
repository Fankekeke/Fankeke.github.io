<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="人人都能懂的Vue源码系列—06—mergeOptions-下"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>人人都能懂的Vue源码系列—06—mergeOptions-下 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/h0wzwwb5gw/",
				"appid": "1613049289050283", 
				"title": "人人都能懂的Vue源码系列—06—mergeOptions-下 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-02T02:30:15"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/yyo5n0l0hk/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/m2901nt2uq/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fh0wzwwb5gw%2f&text=%e4%ba%ba%e4%ba%ba%e9%83%bd%e8%83%bd%e6%87%82%e7%9a%84Vue%e6%ba%90%e7%a0%81%e7%b3%bb%e5%88%97%e2%80%9406%e2%80%94mergeOptions-%e4%b8%8b"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fh0wzwwb5gw%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fh0wzwwb5gw%2f&text=%e4%ba%ba%e4%ba%ba%e9%83%bd%e8%83%bd%e6%87%82%e7%9a%84Vue%e6%ba%90%e7%a0%81%e7%b3%bb%e5%88%97%e2%80%9406%e2%80%94mergeOptions-%e4%b8%8b"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fh0wzwwb5gw%2f&title=%e4%ba%ba%e4%ba%ba%e9%83%bd%e8%83%bd%e6%87%82%e7%9a%84Vue%e6%ba%90%e7%a0%81%e7%b3%bb%e5%88%97%e2%80%9406%e2%80%94mergeOptions-%e4%b8%8b"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fh0wzwwb5gw%2f&is_video=false&description=%e4%ba%ba%e4%ba%ba%e9%83%bd%e8%83%bd%e6%87%82%e7%9a%84Vue%e6%ba%90%e7%a0%81%e7%b3%bb%e5%88%97%e2%80%9406%e2%80%94mergeOptions-%e4%b8%8b"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%ba%ba%e4%ba%ba%e9%83%bd%e8%83%bd%e6%87%82%e7%9a%84Vue%e6%ba%90%e7%a0%81%e7%b3%bb%e5%88%97%e2%80%9406%e2%80%94mergeOptions-%e4%b8%8b&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fh0wzwwb5gw%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fh0wzwwb5gw%2f&title=%e4%ba%ba%e4%ba%ba%e9%83%bd%e8%83%bd%e6%87%82%e7%9a%84Vue%e6%ba%90%e7%a0%81%e7%b3%bb%e5%88%97%e2%80%9406%e2%80%94mergeOptions-%e4%b8%8b"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fh0wzwwb5gw%2f&title=%e4%ba%ba%e4%ba%ba%e9%83%bd%e8%83%bd%e6%87%82%e7%9a%84Vue%e6%ba%90%e7%a0%81%e7%b3%bb%e5%88%97%e2%80%9406%e2%80%94mergeOptions-%e4%b8%8b"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fh0wzwwb5gw%2f&title=%e4%ba%ba%e4%ba%ba%e9%83%bd%e8%83%bd%e6%87%82%e7%9a%84Vue%e6%ba%90%e7%a0%81%e7%b3%bb%e5%88%97%e2%80%9406%e2%80%94mergeOptions-%e4%b8%8b"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fh0wzwwb5gw%2f&title=%e4%ba%ba%e4%ba%ba%e9%83%bd%e8%83%bd%e6%87%82%e7%9a%84Vue%e6%ba%90%e7%a0%81%e7%b3%bb%e5%88%97%e2%80%9406%e2%80%94mergeOptions-%e4%b8%8b"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">人人都能懂的Vue源码系列—06—mergeOptions-下</h1><div class="meta"><div class="postdate"><time datetime="2018-12-02" itemprop="datePublished">2018-12-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e上篇文章，我们讲到了mergeOptions的部分实现，今天接着前面的部分讲解，来看代码，如果大家觉得看讲解枯燥可以直接翻到本文的最后看mergeOptions的整个流程图。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  const extendsFrom = child.extends\n  if (extendsFrom) {\n    parent = mergeOptions(parent, extendsFrom, vm)\n  }\n  if (child.mixins) {\n    for (let i = 0, l = child.mixins.length; i \x3c l; i\x2b\x2b) {\n      parent = mergeOptions(parent, child.mixins[i], vm)\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e extendsFrom = child.extends\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (extendsFrom) {\n    parent = mergeOptions(parent, extendsFrom, vm)\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (child.mixins) {\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, l = child.mixins.length; i \x26lt; l; i\x2b\x2b) {\n      parent = mergeOptions(parent, child.mixins[i], vm)\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码的处理的逻辑是，当传入的options里有mixin或者extends属性时，再次调用mergeOptions方法合并mixins和extends里的内容到实例的构造函数options上（即parent options）比如下面这种情况\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 const childComponent = Vue.component(\x27child\x27, {\n      ...\n      mixins: [myMixin],\n      extends: myComponent\n      ...\n })\n const myMixin = {\n      created: function () {\n        this.hello()\n      },\n      methods: {\n        hello: function () {\n          console.log(\x27hello from mixin\x27)\n      }\n    }\n  }\n const myComponent = {\n      mounted: function () {\n        this.goodbye()\n      },\n      methods: {\n        goodbye: function () {\n          console.log(\x27goodbye from mixin\x27)\n        }\n     }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e childComponent = Vue.component(\x3cspan class=\x22hljs-string\x22\x3e\x27child\x27\x3c\/span\x3e, {\n      ...\n      mixins: [myMixin],\n      \x3cspan class=\x22hljs-attr\x22\x3eextends\x3c\/span\x3e: myComponent\n      ...\n })\n \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e myMixin = {\n      \x3cspan class=\x22hljs-attr\x22\x3ecreated\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hello()\n      },\n      \x3cspan class=\x22hljs-attr\x22\x3emethods\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3ehello\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27hello from mixin\x27\x3c\/span\x3e)\n      }\n    }\n  }\n \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e myComponent = {\n      \x3cspan class=\x22hljs-attr\x22\x3emounted\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.goodbye()\n      },\n      \x3cspan class=\x22hljs-attr\x22\x3emethods\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3egoodbye\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27goodbye from mixin\x27\x3c\/span\x3e)\n        }\n     }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e就会把传入的mounted, created钩子处理函数，还有methods方法提出来去和parent options做合并处理。\x3cbr\x3e弄明白了这点我们继续回到mergeOptions的代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const options = {}\nlet key\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e options = {}\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e变量options存储合并之后的options，变量key存储parent options和child options上的key值。\x3cbr\x3e接下来的部分算是mergeOptions方法的核心处理部分了，像炒菜一样，前面的代码相当于把所有的菜都配好了。接下来的部分就是教你怎么去炒菜了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  for (key in parent) {\n    mergeField(key)\n  }\n  for (key in child) {\n    if (!hasOwn(parent, key)) {\n      mergeField(key)\n    }\n  }\n  function mergeField (key) {\n    const strat = strats[key] || defaultStrat\n    options[key] = strat(parent[key], child[key], vm, key)\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (key \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e parent) {\n    mergeField(key)\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (key \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e child) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!hasOwn(parent, key)) {\n      mergeField(key)\n    }\n  }\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emergeField\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ekey\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e strat = strats[key] || defaultStrat\n    options[key] = strat(parent[key], child[key], vm, key)\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e前两段for循环代码大同小异，都是遍历options上的key值，然后调用mergeField方法来处理options。mergeField方法中出现了一个变量strats和defaultStrat。这两个变量存储的就是我们的合并策略，也就是炒菜的菜谱，我们先来看看defaultStrat\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const defaultStrat = function (parentVal: any, childVal: any): any {\n  return childVal === undefined\n    ? parentVal\n    : childVal\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e defaultStrat = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eparentVal: any, childVal: any\x3c\/span\x3e): \x3cspan class=\x22hljs-title\x22\x3eany\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e childVal === \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n    ? parentVal\n    : childVal\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3edefaultStrat的逻辑是，如果child上该属性值存在时，就取child上的该属性值，如果不存在，则取parent上的该属性值。现在我们知道默认的合并策略是什么了，接下来看其他的合并策略。我们来看看strats里都有哪些属性？\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9VHi?w=898\x26amp;h=670\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9VHi?w=898\x26amp;h=670\x22 alt=\x22strats合并策略\x22 title=\x22strats合并策略\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e上图就是strats中所有的策略了。粗略看起来里面的内容非常的多，如果细细分析会发现，其实总结起来无非就是几种合并策略。下面分别为大家介绍\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e钩子函数的策略\x3c\/h2\x3e\n\x3cp\x3e所有关于钩子函数的策略，其实都是调用mergeHook方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function mergeHook (\n  parentVal: ?Array\x3cFunction\x3e,\n  childVal: ?Function | ?Array\x3cFunction\x3e\n): ?Array\x3cFunction\x3e {\n  return childVal\n    ? parentVal\n      ? parentVal.concat(childVal)\n      : Array.isArray(childVal)\n        ? childVal\n        : [childVal]\n    : parentVal\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emergeHook\x3c\/span\x3e (\n  parentVal: ?Array\x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eFunction\x3c\/span\x3e\x26gt;,\n  childVal: ?\x3cspan class=\x22hljs-keyword\x22\x3eFunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e|\x3c\/span\x3e ?Array\x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eFunction\x3c\/span\x3e\x26gt;\n): ?Array\x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eFunction\x3c\/span\x3e\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3echildVal\x3c\/span\x3e\n    ? parentVal\n      ? parentVal.concat(childVal)\n      : \x3cspan class=\x22hljs-type\x22\x3eArray.isArray\x3c\/span\x3e(childVal)\n        ? childVal\n        : [\x3cspan class=\x22hljs-type\x22\x3echildVal\x3c\/span\x3e]\n    : \x3cspan class=\x22hljs-type\x22\x3eparentVal\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3emergeHook采用了一个非常骚的嵌套三元表达式来控制最后的返回值。下面我们来解析这段三元表达式\x3cbr\x3e(1) child options上不存在该属性，parent options上存在,则返回parent上的属性。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9V15?w=810\x26amp;h=337\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9V15?w=810\x26amp;h=337\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e（2）child和parent都存在该属性，则返回concat之后的属性\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9V5s?w=769\x26amp;h=340\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9V5s?w=769\x26amp;h=340\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e（3）child上存在该属性，parent不存在，且child上的该属性是Array，则直接返回child上的该属性\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9V81?w=797\x26amp;h=384\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9V81?w=797\x26amp;h=384\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e(4) child上存在该属性，parent不存在，且child上的该属性不是Array，则把该属性先转换成Array,再返回。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9V8L?w=760\x26amp;h=365\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9V8L?w=760\x26amp;h=365\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e上面就是钩子函数合并策略，结合图片看应该会比较清晰。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eprops\/methods\/inject\/computed的策略\x3c\/h2\x3e\n\x3cp\x3e介绍完了钩子函数的合并策略，我们接下来看props,methods,inject,computed等属性的合并策略。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22strats.props =\nstrats.methods =\nstrats.inject =\nstrats.computed = function (\n  parentVal: ?Object,\n  childVal: ?Object,\n  vm?: Component,\n  key: string\n): ?Object {\n  if (childVal \x26amp;\x26amp; process.env.NODE_ENV !== \x27production\x27) {\n    assertObjectType(key, childVal, vm)\n  }\n  if (!parentVal) return childVal\n  const ret = Object.create(null)\n  extend(ret, parentVal)\n  if (childVal) extend(ret, childVal)\n  return ret\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3estrats.props =\nstrats.methods =\nstrats.inject =\nstrats.computed = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\n  parentVal: ?Object,\n  childVal: ?Object,\n  vm?: Component,\n  key: string\n\x3c\/span\x3e): ?\x3cspan class=\x22hljs-title\x22\x3eObject\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (childVal \x26amp;\x26amp; process.env.NODE_ENV !== \x3cspan class=\x22hljs-string\x22\x3e\x27production\x27\x3c\/span\x3e) {\n    assertObjectType(key, childVal, vm)\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!parentVal) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e childVal\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ret = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.create(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e)\n  extend(ret, parentVal)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (childVal) extend(ret, childVal)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e ret\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个合并方法逻辑很简单，如果child options上这些属性存在，则先判断它们是不是对象。\x3cbr\x3e（1）如果parent options上没有该属性，则直接返回child options上的该属性\x3cbr\x3e（2）如果parent options和child options都有，则合并parent options和child options并生成一个新的对象。(如果parent和child上有同名属性，合并后的以child options上的为准)\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3ecomponents\/directives\/filters的合并策略\x3c\/h2\x3e\n\x3cp\x3ecomponents\/directives\/filters这几个属性的处理逻辑如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function mergeAssets (\n  parentVal: ?Object,\n  childVal: ?Object,\n  vm?: Component,\n  key: string\n): Object {\n  const res = Object.create(parentVal || null)\n  if (childVal) {\n    process.env.NODE_ENV !== \x27production\x27 \x26amp;\x26amp; assertObjectType(key, childVal, vm)\n    return extend(res, childVal)\n  } else {\n    return res\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emergeAssets\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\n  parentVal: ?Object,\n  childVal: ?Object,\n  vm?: Component,\n  key: string\n\x3c\/span\x3e): \x3cspan class=\x22hljs-title\x22\x3eObject\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e res = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.create(parentVal || \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (childVal) {\n    process.env.NODE_ENV !== \x3cspan class=\x22hljs-string\x22\x3e\x27production\x27\x3c\/span\x3e \x26amp;\x26amp; assertObjectType(key, childVal, vm)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e extend(res, childVal)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里的处理逻辑和上一种情况的类似，这里不做过多讲解。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3edata和provide的策略\x3c\/h2\x3e\n\x3cp\x3edata和provide的策略相对来说复杂一些，我们先来看代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export function mergeDataOrFn (\n  parentVal: any,\n  childVal: any,\n  vm?: Component\n): ?Function {\n  if (!vm) {\n    \/\/ in a Vue.extend merge, both should be functions\n    if (!childVal) {\n      return parentVal\n    }\n    if (!parentVal) {\n      return childVal\n    }\n    \/\/ when parentVal \x26amp; childVal are both present,\n    \/\/ we need to return a function that returns the\n    \/\/ merged result of both functions... no need to\n    \/\/ check if parentVal is a function here because\n    \/\/ it has to be a function to pass previous merges.\n    return function mergedDataFn () {\n      return mergeData(\n        typeof childVal === \x27function\x27 ? childVal.call(this, this) : childVal,\n        typeof parentVal === \x27function\x27 ? parentVal.call(this, this) : parentVal\n      )\n    }\n  } else {\n    return function mergedInstanceDataFn () {\n      \/\/ instance merge\n      const instanceData = typeof childVal === \x27function\x27\n        ? childVal.call(vm, vm)\n        : childVal\n      const defaultData = typeof parentVal === \x27function\x27\n        ? parentVal.call(vm, vm)\n        : parentVal\n      if (instanceData) {\n        return mergeData(instanceData, defaultData)\n      } else {\n        return defaultData\n      }\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emergeDataOrFn\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\n  parentVal: any,\n  childVal: any,\n  vm?: Component\n\x3c\/span\x3e): ?\x3cspan class=\x22hljs-title\x22\x3eFunction\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!vm) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ in a Vue.extend merge, both should be functions\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!childVal) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e parentVal\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!parentVal) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e childVal\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ when parentVal \x26amp; childVal are both present,\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ we need to return a function that returns the\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ merged result of both functions... no need to\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ check if parentVal is a function here because\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ it has to be a function to pass previous merges.\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emergedDataFn\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e mergeData(\n        \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e childVal === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e ? childVal.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e) : childVal,\n        \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e parentVal === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e ? parentVal.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e) : parentVal\n      )\n    }\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emergedInstanceDataFn\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ instance merge\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e instanceData = \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e childVal === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e\n        ? childVal.call(vm, vm)\n        : childVal\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e defaultData = \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e parentVal === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e\n        ? parentVal.call(vm, vm)\n        : parentVal\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (instanceData) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e mergeData(instanceData, defaultData)\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e defaultData\n      }\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个合并策略可以分成两种情况来考虑。\x3cbr\x3e第一种情况，当前调用mergeOptions操作的是vm实例（调用new新建vue实例触发mergeOptions方法）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22   return function mergedInstanceDataFn () {\n      \/\/ instance merge\n      const instanceData = typeof childVal === \x27function\x27\n        ? childVal.call(vm, vm)\n        : childVal\n      const defaultData = typeof parentVal === \x27function\x27\n        ? parentVal.call(vm, vm)\n        : parentVal\n      if (instanceData) {\n        return mergeData(instanceData, defaultData)\n      } else {\n        return defaultData\n      }\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e   \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emergedInstanceDataFn\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ instance merge\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e instanceData = \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e childVal === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e\n        ? childVal.call(vm, vm)\n        : childVal\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e defaultData = \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e parentVal === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e\n        ? parentVal.call(vm, vm)\n        : parentVal\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (instanceData) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e mergeData(instanceData, defaultData)\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e defaultData\n      }\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果新建实例时传入的options上有data属性，则调用mergeData方法合并实例上的data属性和其构造函数options上的data属性（如果有的话）\x3cbr\x3e第二种情况，当前调用mergeOptions操作的不是vm实例（即通过Vue.extend\/Vue.component调用了mergeOptions方法）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 if (!vm) {\n    \/\/ in a Vue.extend merge, both should be functions\n    if (!childVal) {\n      return parentVal\n    }\n    if (!parentVal) {\n      return childVal\n    }\n    \/\/ when parentVal \x26amp; childVal are both present,\n    \/\/ we need to return a function that returns the\n    \/\/ merged result of both functions... no need to\n    \/\/ check if parentVal is a function here because\n    \/\/ it has to be a function to pass previous merges.\n    return function mergedDataFn () {\n      return mergeData(\n        typeof childVal === \x27function\x27 ? childVal.call(this, this) : childVal,\n        typeof parentVal === \x27function\x27 ? parentVal.call(this, this) : parentVal\n      )\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!vm) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ in a Vue.extend merge, both should be functions\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!childVal) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e parentVal\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!parentVal) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e childVal\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ when parentVal \x26amp; childVal are both present,\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ we need to return a function that returns the\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ merged result of both functions... no need to\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ check if parentVal is a function here because\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ it has to be a function to pass previous merges.\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emergedDataFn\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e mergeData(\n        \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e childVal === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e ? childVal.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e) : childVal,\n        \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e parentVal === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e ? parentVal.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e) : parentVal\n      )\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这种情况下，其处理逻辑也是类似的。如果当前实例options或者构造函数options上有一个没有data属性，则返回另一个的data属性，如果两者都有，则同样调用mergeData方法处理合并。\x3cbr\x3e既然这两种情况都调用了mergeData方法，那我们就继续来看看mergeData的源码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function mergeData (to: Object, from: ?Object): Object {\n  if (!from) return to\n  let key, toVal, fromVal\n  const keys = Object.keys(from)\n  for (let i = 0; i \x3c keys.length; i\x2b\x2b) {\n    key = keys[i]\n    toVal = to[key]\n    fromVal = from[key]\n    if (!hasOwn(to, key)) {\n      set(to, key, fromVal)\n    } else if (isPlainObject(toVal) \x26amp;\x26amp; isPlainObject(fromVal)) {\n      mergeData(toVal, fromVal)\n    }\n  }\n  return to\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emergeData\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eto: Object, from: ?Object\x3c\/span\x3e): \x3cspan class=\x22hljs-title\x22\x3eObject\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e to\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key, toVal, fromVal\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e keys = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(\x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; keys.length; i\x2b\x2b) {\n    key = keys[i]\n    toVal = to[key]\n    fromVal = \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e[key]\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!hasOwn(to, key)) {\n      set(to, key, fromVal)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isPlainObject(toVal) \x26amp;\x26amp; isPlainObject(fromVal)) {\n      mergeData(toVal, fromVal)\n    }\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e to\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3emergeData的逻辑是，如果from对象中有to对象里没有的属性，则调用set方法，（这里的set就是Vue.$set，先可以简单理解为对象设置属性。之后会细讲）如果from和to中有相同的key值，且key对应的value是对象，则会递归调用mergeData方法，否则以to的值为准，最后返回to对象。这里我们就讲完了data的合并策略。\x3cbr\x3e返回mergeOptions代码里，在经过这几种合并策略合并options后，最终返回options\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22return options\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e options\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e讲到这里,整个mergeOptions的流程也讲完了。这个方法牵扯到的内容比较多，流程也比较复杂。为了大家更好的理解和记忆。我画了一张图来表达整个mergeOptions的过程。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV90eb?w=1200\x26amp;h=1100\x22 src=\x22https:\/\/static.alili.tech\/img\/bV90eb?w=1200\x26amp;h=1100\x22 alt=\x22mergeoptions的流程图\x22 title=\x22mergeoptions的流程图\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e如果大家觉得我的文章写的还行，请为我点赞，你们的认可是我最大的动力。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>人人都能懂的Vue源码系列—06—mergeOptions-下</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014738314">https://segmentfault.com/a/1190000014738314</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/h0wzwwb5gw/" target="_blank">https://alili.tech/archive/h0wzwwb5gw/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>