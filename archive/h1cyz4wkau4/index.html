<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="react技术栈实践(从前到后撸一个电影搜集应用)"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>react技术栈实践(从前到后撸一个电影搜集应用) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/h1cyz4wkau4/",
				"appid": "1613049289050283", 
				"title": "react技术栈实践(从前到后撸一个电影搜集应用) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-21T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/8h7bwl2rbpa/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/tf2xdywy7ia/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fh1cyz4wkau4%2f&text=react%e6%8a%80%e6%9c%af%e6%a0%88%e5%ae%9e%e8%b7%b5%28%e4%bb%8e%e5%89%8d%e5%88%b0%e5%90%8e%e6%92%b8%e4%b8%80%e4%b8%aa%e7%94%b5%e5%bd%b1%e6%90%9c%e9%9b%86%e5%ba%94%e7%94%a8%29"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fh1cyz4wkau4%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fh1cyz4wkau4%2f&text=react%e6%8a%80%e6%9c%af%e6%a0%88%e5%ae%9e%e8%b7%b5%28%e4%bb%8e%e5%89%8d%e5%88%b0%e5%90%8e%e6%92%b8%e4%b8%80%e4%b8%aa%e7%94%b5%e5%bd%b1%e6%90%9c%e9%9b%86%e5%ba%94%e7%94%a8%29"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fh1cyz4wkau4%2f&title=react%e6%8a%80%e6%9c%af%e6%a0%88%e5%ae%9e%e8%b7%b5%28%e4%bb%8e%e5%89%8d%e5%88%b0%e5%90%8e%e6%92%b8%e4%b8%80%e4%b8%aa%e7%94%b5%e5%bd%b1%e6%90%9c%e9%9b%86%e5%ba%94%e7%94%a8%29"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fh1cyz4wkau4%2f&is_video=false&description=react%e6%8a%80%e6%9c%af%e6%a0%88%e5%ae%9e%e8%b7%b5%28%e4%bb%8e%e5%89%8d%e5%88%b0%e5%90%8e%e6%92%b8%e4%b8%80%e4%b8%aa%e7%94%b5%e5%bd%b1%e6%90%9c%e9%9b%86%e5%ba%94%e7%94%a8%29"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=react%e6%8a%80%e6%9c%af%e6%a0%88%e5%ae%9e%e8%b7%b5%28%e4%bb%8e%e5%89%8d%e5%88%b0%e5%90%8e%e6%92%b8%e4%b8%80%e4%b8%aa%e7%94%b5%e5%bd%b1%e6%90%9c%e9%9b%86%e5%ba%94%e7%94%a8%29&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fh1cyz4wkau4%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fh1cyz4wkau4%2f&title=react%e6%8a%80%e6%9c%af%e6%a0%88%e5%ae%9e%e8%b7%b5%28%e4%bb%8e%e5%89%8d%e5%88%b0%e5%90%8e%e6%92%b8%e4%b8%80%e4%b8%aa%e7%94%b5%e5%bd%b1%e6%90%9c%e9%9b%86%e5%ba%94%e7%94%a8%29"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fh1cyz4wkau4%2f&title=react%e6%8a%80%e6%9c%af%e6%a0%88%e5%ae%9e%e8%b7%b5%28%e4%bb%8e%e5%89%8d%e5%88%b0%e5%90%8e%e6%92%b8%e4%b8%80%e4%b8%aa%e7%94%b5%e5%bd%b1%e6%90%9c%e9%9b%86%e5%ba%94%e7%94%a8%29"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fh1cyz4wkau4%2f&title=react%e6%8a%80%e6%9c%af%e6%a0%88%e5%ae%9e%e8%b7%b5%28%e4%bb%8e%e5%89%8d%e5%88%b0%e5%90%8e%e6%92%b8%e4%b8%80%e4%b8%aa%e7%94%b5%e5%bd%b1%e6%90%9c%e9%9b%86%e5%ba%94%e7%94%a8%29"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fh1cyz4wkau4%2f&title=react%e6%8a%80%e6%9c%af%e6%a0%88%e5%ae%9e%e8%b7%b5%28%e4%bb%8e%e5%89%8d%e5%88%b0%e5%90%8e%e6%92%b8%e4%b8%80%e4%b8%aa%e7%94%b5%e5%bd%b1%e6%90%9c%e9%9b%86%e5%ba%94%e7%94%a8%29"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">react技术栈实践(从前到后撸一个电影搜集应用)</h1><div class="meta"><div class="postdate"><time datetime="2018-12-21" itemprop="datePublished">2018-12-21</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e之前做了个好电影搜集的小应用，前端采用react，后端采用express\x2bmongodb，最近又将组件间的状态管理改成了redux，并加入了redux-saga来管理异步操作,记录一些总结\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e\n\x3ca href=\x22http:\/\/xiyuyizhi.xyz:8080\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e在线地址\x3c\/a\x3e 手机模式\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/xiyuyizhi\/movies\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e源码\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e主要功能\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e爬取豆瓣电影信息并录入MongoDB\x3c\/li\x3e\n\x3cli\x3e电影列表展示，分类、搜索\x3c\/li\x3e\n\x3cli\x3e电影详情展示及附件管理\x3c\/li\x3e\n\x3cli\x3e注册、登录\x3c\/li\x3e\n\x3cli\x3e权限控制，普通用户可以录入、收藏,administrator录入、修改、删除\x3c\/li\x3e\n\x3cli\x3e用户中心，我的收藏列表\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/github.com\/xiyuyizhi\/movies\/raw\/redux-redux-saga\/view.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/github.com\/xiyuyizhi\/movies\/raw\/redux-redux-saga\/view.png\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e一些总结\x3c\/h1\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e前端\x3c\/h2\x3e\n\x3cp\x3e前端使用了react,redux加redux-saga,对redux简单总结一下，同时记录一个前后接口调用有依赖关系的问题\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader4\x22\x3eredux\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e一句话总结redux，我觉的就是将组件之间的纵向的props传递和父子组件间的state爱恨纠缠给打平了，将一种纵向关系转变成\x3ccode\x3e多个组件和一个独立出来的状态对象直接交互\x3c\/code\x3e，这样之后，代码结构确实看上去更加清晰了。\x3c\/p\x3e\n\x3cp\x3eredux的核心概念，action,reducer,和store\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eaction就是说明我要操作一个状态了，怎么操作是reducer的事，而所有状态存储在store中，store发出动作并交由指定的reducer来处理\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3eredux强制规范了我们对状态的操作，只能在action和reducer这些东西中,这样，原本错综复杂的业务逻辑处理就换了个地，限制在了action和reducer中，组件看上去就很干净了。其实，该复杂的东西在哪放都复杂，只不过现在更清晰一点\x3c\/p\x3e\n\x3cp\x3e使用redux不好的地方就是太繁琐了，定义各种action,connect各种组件。。。。。现在又出来一个Mobx,不明觉厉，反正大家都说好~\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader5\x22\x3eredux-saga\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3eredux-saga用来处理异步调用啥的，借助于generator,让异步代码看起来更简洁，常用的有\x3ccode\x3etake,takeLatest,takeEvery,put,call,fork,select\x3c\/code\x3e，使用过程中遇到一个接口调用有前后依赖关系的问题,比较有意思\x3c\/p\x3e\n\x3cp\x3e描述一下:\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e有一个接口\x3cem\x3e\/api\/user\/checkLogin\x3c\/em\x3e,用来判断是否登录，在最外层的\x26lt;App\x26gt;\x26lt;\/App\x26gt;组件的componentDidMount中触发action来发起这个请求，并且接口返回状态是登录的话，还要发一个获取用户信息的\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* checkLogin() {\n    const res = yield Util.fetch(\x27\/api\/user\/checkLogin\x27)\n    yield put(recieveCheckLogin(!res.code))\n    if (!res.code) {\n        \/\/已登录\n        yield put(fetchUinfo())\n    }\n}\nexport function* watchCheckLogin() {\n    yield takeLatest(CHECK_LOAGIN, checkLogin)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3echeckLogin\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e res = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e Util.fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27\/api\/user\/checkLogin\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put(recieveCheckLogin(!res.code))\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!res.code) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/已登录\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put(fetchUinfo())\n    }\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchCheckLogin\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e takeLatest(CHECK_LOAGIN, checkLogin)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\x3cli\x3e然后我有一个电影详情页组件，在这个组件的\x3cem\x3ecomponentDidMount\x3c\/em\x3e中会发起\x3cem\x3e\x3ccode\x3e\/api\/movies\/${id}\x3c\/code\x3e\x3c\/em\x3e接口获取电影信息，如果用户是登录状态的话，还会发起一个获取电影附件信息的接口\x3cem\x3e\x3ccode\x3e\/api\/movies\/${id}\/attach\x3c\/code\x3e\x3c\/em\x3e，\x3cstrong\x3e整个步骤写在一个generator中\x3c\/strong\x3e\n\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* getItemMovie(id) {\n    return yield Util.fetch(`\/api\/movies\/${id}`)\n}\n\nfunction* getMovieAttach(id) {\n    return yield Util.fetch(`\/api\/movies\/${id}\/attach`)\n}\n\nfunction* getMovieInfo(action) {\n    const { movieId } = action\n    let { login } = yield select(state =\x3e state.loginStatus)\n    const res = yield call(getItemMovie, movieId)\n    yield put(recieveItemMovieInfo(res.data[0]))\n    if (res.data[0].attachId \x26amp;\x26amp; login) {\n        const attach = yield call(getMovieAttach, movieId)\n        yield put(recieveMovieAttach(attach.data[0]))\n    }\n}\n\nexport function* watchLoadItemMovie() {\n    yield takeLatest(LOAD_ITEM_MOVIE, getMovieInfo)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egetItemMovie\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e Util.fetch(\x3cspan class=\x22hljs-string\x22\x3e`\/api\/movies\/\x3cspan class=\x22hljs-subst\x22\x3e${id}\x3c\/span\x3e`\x3c\/span\x3e)\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egetMovieAttach\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e Util.fetch(\x3cspan class=\x22hljs-string\x22\x3e`\/api\/movies\/\x3cspan class=\x22hljs-subst\x22\x3e${id}\x3c\/span\x3e\/attach`\x3c\/span\x3e)\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egetMovieInfo\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { movieId } = action\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e { login } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e select(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estate\x3c\/span\x3e =\x26gt;\x3c\/span\x3e state.loginStatus)\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e res = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(getItemMovie, movieId)\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put(recieveItemMovieInfo(res.data[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]))\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (res.data[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].attachId \x26amp;\x26amp; login) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e attach = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(getMovieAttach, movieId)\n        \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put(recieveMovieAttach(attach.data[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]))\n    }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchLoadItemMovie\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e takeLatest(LOAD_ITEM_MOVIE, getMovieInfo)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\n\x3cli\x3e用户登录了，进到详情，流程正常，但如果在详情页刷新了页面，获取附件的接口没触发，原因是此时checkLogin接口还没返回结果，\x3ccode\x3estate.loginStatus\x3c\/code\x3e状态还是false，上面就没走到if中\x3c\/li\x3e\n\x3cli\x3e一开始想着怎么控制一些generator中yield的先后顺序来解决(如果用户没有登录的话,再发一个CHECK_LOAGIN,结果返回了流程再继续)，但存在CHECK_LOAGIN调用两次，如果登录了，还会再多一次获取用户信息的接口调用的情况，肯定不行\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* getMovieInfo(action) {\n    const { movieId } = action\n    let { login } = yield select(state =\x3e state.loginStatus)\n    const res = yield call(getItemMovie, movieId)\n    yield put(recieveItemMovieInfo(res.data[0]))\n    \/\/ if (!login) {\n    \/\/     \/\/刷新页面的时候，如果此时checklogin接口还没返回数据或还没发出，应触发一个checklogin\n    \/\/     \/\/checklogin返回后才能得到login状态\n    \/\/     yield put({\n    \/\/         type: CHECK_LOAGIN\n    \/\/     })\n    \/\/     const ret = yield take(RECIEVE_CHECK_LOAGIN)\n    \/\/     login = ret.loginStatus\n    \/\/ }\n    if (res.data[0].attachId \x26amp;\x26amp; login) {\n        const attach = yield call(getMovieAttach, movieId)\n        yield put(recieveMovieAttach(attach.data[0]))\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egetMovieInfo\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { movieId } = action\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e { login } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e select(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estate\x3c\/span\x3e =\x26gt;\x3c\/span\x3e state.loginStatus)\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e res = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(getItemMovie, movieId)\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put(recieveItemMovieInfo(res.data[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]))\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ if (!login) {\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     \/\/刷新页面的时候，如果此时checklogin接口还没返回数据或还没发出，应触发一个checklogin\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     \/\/checklogin返回后才能得到login状态\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     yield put({\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/         type: CHECK_LOAGIN\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     })\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     const ret = yield take(RECIEVE_CHECK_LOAGIN)\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     login = ret.loginStatus\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ }\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (res.data[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].attachId \x26amp;\x26amp; login) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e attach = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(getMovieAttach, movieId)\n        \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put(recieveMovieAttach(attach.data[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]))\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\x3cli\x3e最终的办法,分解generator的职责，componentWillUpdate中合适的触发获取附件的动作\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/将获取附件的动作从 getMovieInfo这个generator中分离出来\nfunction* getMovieInfo(action) {\n    const { movieId } = action\n    const res = yield call(getItemMovie, movieId)\n    yield put(recieveItemMovieInfo(res.data[0]))\n}\nfunction* watchLoadItemMovie() {\n    yield takeLatest(LOAD_ITEM_MOVIE, getMovieInfo)\n}\nfunction* watchLoadAttach() {\n    while (true) {\n        const { movieId } = yield take(LOAD_MOVIE_ATTACH)\n        const { attachId } = yield select(state =\x3e state.detail.movieInfo)\n        const attach = yield call(getMovieAttach, movieId)\n        yield put(recieveMovieAttach(attach.data[0]))\n    }\n}\n\n\/\/组件中\ncomponentWillUpdate(nextProps) {\n        if (nextProps.loginStatus \x26amp;\x26amp; (nextProps.movieInfo!==this.props.movieInfo)) {\n            \/\/是登录状态，并且movieInfo已经返回时\n            const { id } = this.props.match.params\n            this.props.loadMovieAttach(id)\n        }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/将获取附件的动作从 getMovieInfo这个generator中分离出来\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egetMovieInfo\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { movieId } = action\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e res = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(getItemMovie, movieId)\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put(recieveItemMovieInfo(res.data[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]))\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchLoadItemMovie\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e takeLatest(LOAD_ITEM_MOVIE, getMovieInfo)\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchLoadAttach\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { movieId } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(LOAD_MOVIE_ATTACH)\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { attachId } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e select(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estate\x3c\/span\x3e =\x26gt;\x3c\/span\x3e state.detail.movieInfo)\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e attach = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(getMovieAttach, movieId)\n        \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put(recieveMovieAttach(attach.data[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]))\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/组件中\x3c\/span\x3e\ncomponentWillUpdate(nextProps) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (nextProps.loginStatus \x26amp;\x26amp; (nextProps.movieInfo!==\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.movieInfo)) {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/是登录状态，并且movieInfo已经返回时\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { id } = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.match.params\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.loadMovieAttach(id)\n        }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\x3cli\x3e总结，合理使用组件的钩子函数，generator中不要处理太多操作，增加灵活性\x3c\/li\x3e\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e后端\x3c\/h2\x3e\n\x3cp\x3e后端采用express和mongodb，也用到了redis,主要技术点有\x3ccode\x3e使用pm2来管理node应用及部署代码\x3c\/code\x3e，\x3ca href=\x22https:\/\/github.com\/xiyuyizhi\/movies\/blob\/master\/dayByday\/day3.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emongodb中开启身份认证\x3c\/a\x3e，使用token\x2bredis来做身份认证、在node中写了写单元测试，还是值得记录一下的\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader7\x22\x3e使用 jwt \x2b redis 来做基于token的用户身份认证\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e基于token的认证流程\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e客户端发起登录请求\x3c\/li\x3e\n\x3cli\x3e服务端验证用户名密码\x3c\/li\x3e\n\x3cli\x3e验证成功服务端生成一个token，响应给客户端\x3c\/li\x3e\n\x3cli\x3e客户端之后的每次请求header中都带上这个token\x3c\/li\x3e\n\x3cli\x3e服务端对需要认证的接口要验证token，验证成功接收请求\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e这里采用\x3ca href=\x22https:\/\/github.com\/auth0\/node-jsonwebtoken\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ejsonwebtoken\x3c\/a\x3e来生成token，\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22jwt.sign(payload, secretOrPrivateKey, [options, callback])\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3ejwt\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.sign\x3c\/span\x3e(\x3cspan class=\x22hljs-selector-tag\x22\x3epayload\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-tag\x22\x3esecretOrPrivateKey\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-attr\x22\x3e[options, callback]\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用\x3ca href=\x22https:\/\/github.com\/auth0\/express-jwt\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eexpress-jwt\x3c\/a\x3e验证token（验证成功会把token信息放在request.user中）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22express_jwt({\n        secret: SECRET,\n        getToken: (req)=\x3e {\n        if (req.headers.authorization \x26amp;\x26amp; req.headers.authorization.split(\x27 \x27)[0] === \x27Bearer\x27) {\n            return req.headers.authorization.split(\x27 \x27)[1];\n        } else if (req.query \x26amp;\x26amp; req.query.token) {\n            return req.query.token;\n        }\n        return null;\n    }\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode\x3eexpress_jwt({\n        secret: SECRET,\n        \x3cspan class=\x22hljs-keyword\x22\x3egetToken\x3c\/span\x3e: (req)=\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (req.headers.authorization \x26amp;\x26amp; req.headers.authorization.\x3cspan class=\x22hljs-keyword\x22\x3esplit\x3c\/span\x3e(\x27 \x27)[0] === \x27Bearer\x27) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e req.headers.authorization.\x3cspan class=\x22hljs-keyword\x22\x3esplit\x3c\/span\x3e(\x27 \x27)[1];\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (req.\x3cspan class=\x22hljs-keyword\x22\x3equery\x3c\/span\x3e \x26amp;\x26amp; req.\x3cspan class=\x22hljs-keyword\x22\x3equery\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3etoken\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e req.\x3cspan class=\x22hljs-keyword\x22\x3equery\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3etoken\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e null;\n    }\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为什么使用redis\x3c\/p\x3e\n\x3cp\x3e**采用jsonwebtoken生成token时可以指定token的有效期，并且jsonwebtoken的verify方法也提供了选项来更新token的有效期，\x3cbr\x3e但这里使用了express_jwt中间件，而express_jwt不提供方法来刷新token**\x3c\/p\x3e\n\x3cp\x3e思路：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e客户端请求登录成功，生成token\x3c\/li\x3e\n\x3cli\x3e将此token保存在redis中，设置redis的有效期（例如1h）\x3c\/li\x3e\n\x3cli\x3e新的请求过来，先express_jwt验证token，验证成功， 再验证token是否在redis中存在，存在说明有效\x3c\/li\x3e\n\x3cli\x3e有效期内客户端新的请求过来，提取token,更新此token在redis中的有效期\x3c\/li\x3e\n\x3cli\x3e客户端退出登录请求，删除redis中此token\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/xiyuyizhi\/movies\/blob\/redux-redux-saga\/be\/config\/token.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e具体代码\x3c\/a\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3ch3 id=\x22articleHeader8\x22\x3e使用 mocha \x2b supertest \x2b should 来写单元测试\x3c\/h3\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e测试覆盖了所有接口，在开发中，因为没什么进度要求就慢慢写了，写完一个接口就去写一个测试，测试写也还算详细，等测试通过了再前端调接口，整个过程还是挺有意思的\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3emocha 是一个node单元测试框架，类似于前端的jasmine,语法也相近\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3esupertest 用来测试node接口的库\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3eshould nodejs断言库，可读性很高\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e测试的一个例子，篇幅太长，就不\x3ca href=\x22https:\/\/github.com\/xiyuyizhi\/movies\/blob\/redux-redux-saga\/dayByday\/day5.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e放在这\x3c\/a\x3e了\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e最后\x3c\/h2\x3e\n\x3cp\x3e喜欢可以\x3ca href=\x22https:\/\/github.com\/xiyuyizhi\/movies\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e关注\x3c\/a\x3e下，万一有福利呢。。。。。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>react技术栈实践(从前到后撸一个电影搜集应用)</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012468935">https://segmentfault.com/a/1190000012468935</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/h1cyz4wkau4/" target="_blank">https://alili.tech/archive/h1cyz4wkau4/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>