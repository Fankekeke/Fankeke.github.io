<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="【React进阶系列】从零开始手把手教你实现一个Virtual DOM（二）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>【React进阶系列】从零开始手把手教你实现一个Virtual DOM（二） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/hltrmqu7pwe/",
				"appid": "1613049289050283", 
				"title": "【React进阶系列】从零开始手把手教你实现一个Virtual DOM（二） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-03T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/5jmpht9tq7m/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/ku7sbdz3un7/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fhltrmqu7pwe%2f&text=%e3%80%90React%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%97%e3%80%91%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%89%8b%e6%8a%8a%e6%89%8b%e6%95%99%e4%bd%a0%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aaVirtual%20DOM%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fhltrmqu7pwe%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fhltrmqu7pwe%2f&text=%e3%80%90React%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%97%e3%80%91%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%89%8b%e6%8a%8a%e6%89%8b%e6%95%99%e4%bd%a0%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aaVirtual%20DOM%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fhltrmqu7pwe%2f&title=%e3%80%90React%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%97%e3%80%91%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%89%8b%e6%8a%8a%e6%89%8b%e6%95%99%e4%bd%a0%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aaVirtual%20DOM%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fhltrmqu7pwe%2f&is_video=false&description=%e3%80%90React%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%97%e3%80%91%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%89%8b%e6%8a%8a%e6%89%8b%e6%95%99%e4%bd%a0%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aaVirtual%20DOM%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e3%80%90React%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%97%e3%80%91%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%89%8b%e6%8a%8a%e6%89%8b%e6%95%99%e4%bd%a0%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aaVirtual%20DOM%ef%bc%88%e4%ba%8c%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fhltrmqu7pwe%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fhltrmqu7pwe%2f&title=%e3%80%90React%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%97%e3%80%91%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%89%8b%e6%8a%8a%e6%89%8b%e6%95%99%e4%bd%a0%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aaVirtual%20DOM%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhltrmqu7pwe%2f&title=%e3%80%90React%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%97%e3%80%91%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%89%8b%e6%8a%8a%e6%89%8b%e6%95%99%e4%bd%a0%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aaVirtual%20DOM%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhltrmqu7pwe%2f&title=%e3%80%90React%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%97%e3%80%91%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%89%8b%e6%8a%8a%e6%89%8b%e6%95%99%e4%bd%a0%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aaVirtual%20DOM%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhltrmqu7pwe%2f&title=%e3%80%90React%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%97%e3%80%91%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%89%8b%e6%8a%8a%e6%89%8b%e6%95%99%e4%bd%a0%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aaVirtual%20DOM%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">【React进阶系列】从零开始手把手教你实现一个Virtual DOM（二）</h1><div class="meta"><div class="postdate"><time datetime="2018-12-03" itemprop="datePublished">2018-12-03</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2\x3e上集回顾\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000014572815\x22\x3e从零开始手把手教你实现一个Virtual DOM（一）\x3c\/a\x3e\x3cbr\x3e上一集我们介绍了什么是VDOM，为什么要用VDOM，以及我们要怎样来实现一个VDOM。我们再来看一下这张蓝图，今天我们要实现的是这张图的左半部分。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9o7Q?w=314\x26amp;h=517\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9o7Q?w=314\x26amp;h=517\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2\x3epackage.json\x3c\/h2\x3e\n\x3cpre\x3e\x3ccode\x3e{\n  \x22name\x22: \x22vdom\x22,\n  \x22version\x22: \x221.0.0\x22,\n  \x22description\x22: \x22\x22,\n  \x22scripts\x22: {\n    \x22compile\x22: \x22babel index.js --out-file compiled.js\x22\n  },\n  \x22author\x22: \x22\x22,\n  \x22license\x22: \x22\x22,\n  \x22devDependencies\x22: {\n    \x22babel-cli\x22: \x22^6.23.0\x22,\n    \x22babel-plugin-transform-react-jsx\x22: \x22^6.23.0\x22\n  }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里主要主要两点：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3ccode\x3edevDependencies\x3c\/code\x3e中依赖babel-cli和babel-plugin-transform-react-jsx这两个库，前者提供Babel的命令行功能，后者主要帮我们把jsx转化成js。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3escripts\x3c\/code\x3e中我们指定了一条命令：\x3ccode\x3ecomplile\x3c\/code\x3e，每次当我们在当前目录下的命令行中敲\x3ccode\x3enpm run compile\x3c\/code\x3e时，babal就会将我们的\x3ccode\x3eindex.js\x3c\/code\x3e转化后新建一个\x3ccode\x3ecompile.js\x3c\/code\x3e文件。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e完成后，在命令行中输入\x3ccode\x3enpm install\x3c\/code\x3e安装下依赖。\x3c\/p\x3e\n\x3ch2\x3e.babelrc\x3c\/h2\x3e\n\x3cpre\x3e\x3ccode\x3e{\n  \x22plugins\x22: [\n    [\x22transform-react-jsx\x22, {\n      \x22pragma\x22: \x22h\x22  \/\/ default pragma is React.createElement\n    }]\n  ]\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在babel的配置文件中，我们指定\x3ccode\x3etransform-react-jsx\x3c\/code\x3e这个插件将转化后的函数名设置为\x3ccode\x3eh\x3c\/code\x3e。默认的函数名是\x3ccode\x3eReact.createElement\x3c\/code\x3e，我们不依赖react，所以显然换个自己的名字更合适。这里不清楚\x3ccode\x3eh\x3c\/code\x3e是干什么的不要紧，等会看到代码你就知道了。\x3c\/p\x3e\n\x3ch2\x3eindex.html\x3c\/h2\x3e\n\x3cpre\x3e\x3ccode\x3e\x26lt;!DOCTYPE html\x26gt;\n\x26lt;html\x26gt;\n  \x26lt;head\x26gt;\n    \x26lt;meta charset=\x22utf-8\x22\x26gt;\n    \x26lt;title\x26gt;VDOM\x26lt;\/title\x26gt;\n    \x26lt;style\x26gt;\n        body { margin: 0; font-size: 24; font-family: sans-serif }\n        .list { text-decoration: none }\n        .list .main { color: red }\n    \x26lt;\/style\x26gt;\n  \x26lt;\/head\x26gt;\n  \x26lt;body\x26gt;\n    \x26lt;script src=\x22compiled.js\x22\x26gt;\x26lt;\/script\x26gt;\n    \x26lt;div id=\x22app\x22\x26gt;\x26lt;\/div\x26gt;\n    \n    \x26lt;script\x26gt;\n      var app = document.getElementById(\x27app\x27)\n      render(app)\n    \x26lt;\/script\x26gt;\n  \x26lt;\/body\x26gt;\n\x26lt;\/html\x26gt;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个HTML还是很直观的，类似React，我们有一个根节点id是app。然后我们render函数最终生成的DOM会插入到app这个根节点里。注意我们引用的compile.js文件是babel根据等会要写的index.js文件自动生成的。\x3c\/p\x3e\n\x3ch2\x3eindex.js\x3c\/h2\x3e\n\x3cp\x3e首先，我们用JSX来编写“模板”：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode\x3efunction view() {\n  return \x26lt;ul id=\x22filmList\x22 className=\x22list\x22\x26gt;\n    \x26lt;li className=\x22main\x22\x26gt;Detective Chinatown Vol 2\x26lt;\/li\x26gt;\n    \x26lt;li\x26gt;Ferdinand\x26lt;\/li\x26gt;\n    \x26lt;li\x26gt;Paddington 2\x26lt;\/li\x26gt;\n  \x26lt;\/ul\x26gt;\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来，我们要将JSX编译成js, 也就是hyperscript。我们先用Babel编译一下，看这段JSX转成js会是什么样子，打开命令行，输入\x3ccode\x3enpm run compile\x3c\/code\x3e,得到的compile.js：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode\x3efunction view() {\n  return h(\n    \x22ul\x22,\n    { id: \x22filmList\x22, className: \x22list\x22 },\n    h(\n      \x22li\x22,\n      { className: \x22main\x22 },\n      \x22Detective Chinatown Vol 2\x22\n    ),\n    h(\n      \x22li\x22,\n      null,\n      \x22Ferdinand\x22\n    ),\n    h(\n      \x22li\x22,\n      null,\n      \x22Paddington 2\x22\n    )\n  );\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以看出\x3ccode\x3eh\x3c\/code\x3e函数接收的参数，第一个参数是node的类型，比如\x3ccode\x3eul\x3c\/code\x3e,\x3ccode\x3eli\x3c\/code\x3e，第二个参数是node的属性，之后的参数是node的children，假如child又是一个node的话，就会继续调用\x3ccode\x3eh\x3c\/code\x3e函数。\x3c\/p\x3e\n\x3cp\x3e清楚了Babel会将我们的JSX编译成什么样子后，接下来我们就可以继续在index.js中来写\x3ccode\x3eh\x3c\/code\x3e函数了。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode\x3efunction flatten(arr) {\n  return [].concat(...arr)\n}\n\nfunction h(type, props, ...children) {\n  return {\n    type,\n    props: props || {},\n    children: flatten(children)\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们的\x3ccode\x3eh\x3c\/code\x3e函数主要的工作就是返回我们真正需要的hyperscript对象，只有三个参数，第一个参数是节点类型，第二个参数是属性对象，第三个是子节点的数组。\x3c\/p\x3e\n\x3cp\x3e这里主要用了ES6的rest, spread参数，不清楚代码中两个\x3ccode\x3e...\x3c\/code\x3e分别是什么意思的可以先去看我的介绍ES6文章\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000004365693#articleHeader5\x22\x3e30分钟掌握ES6\/ES2015核心内容（上）\x3c\/a\x3e。简单来说，rest就是上面的\x3ccode\x3e...children\x3c\/code\x3e，它将函数多余的参数放到一个数组里，所以children此时变成了一个数组。而spread则是rest的逆运算，也就是上面的\x3ccode\x3e...arr\x3c\/code\x3e，它将一个数组转为用逗号分隔的参数序列。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eflatten(children)\x3c\/code\x3e这个操作是因为children这个数组里的元素有可能也是个数组，那样就成了一个二维数组，所以我们需要将数组拍平成一维数组。\x3ccode\x3e[].concat(...arr)\x3c\/code\x3e是ES6写法，传统的写法是\x3ccode\x3e[].concat.apply([], arr)\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e我们现在可以先来看一下\x3ccode\x3eh\x3c\/code\x3e函数最终返回的对象长什么样子。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode\x3efunction render() {\n  console.log(view())\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们在render函数中打印出执行完view()的结果，再npm run compile后，用浏览器打开我们的index.html，看控制台输出的结果。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9qXc?w=443\x26amp;h=236\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9qXc?w=443\x26amp;h=236\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以，很完美！这个对象就是我们的VDOM了！\x3c\/p\x3e\n\x3cp\x3e下面我们就可以根据VDOM, 来渲染真实DOM了。先改写render函数:\x3c\/p\x3e\n\x3cpre\x3e\x3ccode\x3efunction render(el) {\n  el.appendChild(createElement(view(0)))\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ecreateElement函数生成DOM，然后再插入到我们在index.html中写的根节点app。注意render函数式在index.html中被调用的。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode\x3efunction createElement(node) {\n  if (typeof(node) === \x27string\x27) {\n    return document.createTextNode(node)\n  }\n\n  let { type, props, children } = node\n  const el = document.createElement(type)\n  setProps(el, props)\n  children.map(createElement)\n    .forEach(el.appendChild.bind(el))\n\n  return el\n}\n\nfunction setProp(target, name, value) {\n  if (name === \x27className\x27) {\n    return target.setAttribute(\x27class\x27, value)\n  }\n\n  target.setAttribute(name, value)\n}\n\nfunction setProps(target, props) {\n  Object.keys(props).forEach(key =\x26gt; {\n    setProp(target, key, props[key])\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们来仔细看下createElement函数。假如说node，即VDOM的类型是文本，我们直接返回一个创建好的文本节点。否则的话，我们取出node中类型，属性和子节点, 先根据类型创建相应的目标节点，然后再调用\x3ccode\x3esetProps\x3c\/code\x3e函数依次设置好目标节点的属性，最后遍历子节点，递归调用createElement方法，将返回的子节点插入到刚刚创建的目标节点里。最后返回这个目标节点。\x3c\/p\x3e\n\x3cp\x3e还需要注意的一点是，jsx中class的写成了className，所以我需要特殊处理一下。\x3c\/p\x3e\n\x3cp\x3e大功告成，complie后浏览器打开index.html看看结果吧。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV9r6m?w=690\x26amp;h=141\x22 src=\x22https:\/\/static.alili.tech\/img\/bV9r6m?w=690\x26amp;h=141\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e今天我们成功的完成了蓝图的左半部分，将JSX转化成hyperscript，再转化成VDOM，最后根据VDOM生成DOM，渲染到页面。明天，我们迎接挑战，开始处理数据变动引起的重新渲染，我们要如何DIFF新旧VDOM，生成补丁，修改DOM。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>【React进阶系列】从零开始手把手教你实现一个Virtual DOM（二）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014603332">https://segmentfault.com/a/1190000014603332</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/hltrmqu7pwe/" target="_blank">https://alili.tech/archive/hltrmqu7pwe/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>