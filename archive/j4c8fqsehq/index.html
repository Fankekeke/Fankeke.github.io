<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="使用box-shadow进行画图(性能优化终结者)"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>使用box-shadow进行画图(性能优化终结者) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/j4c8fqsehq/",
				"appid": "1613049289050283", 
				"title": "使用box-shadow进行画图(性能优化终结者) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-11-29T09:34:56"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/rj3re7rifn/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/kaj0x58ml8/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fj4c8fqsehq%2f&text=%e4%bd%bf%e7%94%a8box-shadow%e8%bf%9b%e8%a1%8c%e7%94%bb%e5%9b%be%28%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e7%bb%88%e7%bb%93%e8%80%85%29"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fj4c8fqsehq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fj4c8fqsehq%2f&text=%e4%bd%bf%e7%94%a8box-shadow%e8%bf%9b%e8%a1%8c%e7%94%bb%e5%9b%be%28%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e7%bb%88%e7%bb%93%e8%80%85%29"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fj4c8fqsehq%2f&title=%e4%bd%bf%e7%94%a8box-shadow%e8%bf%9b%e8%a1%8c%e7%94%bb%e5%9b%be%28%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e7%bb%88%e7%bb%93%e8%80%85%29"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fj4c8fqsehq%2f&is_video=false&description=%e4%bd%bf%e7%94%a8box-shadow%e8%bf%9b%e8%a1%8c%e7%94%bb%e5%9b%be%28%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e7%bb%88%e7%bb%93%e8%80%85%29"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bd%bf%e7%94%a8box-shadow%e8%bf%9b%e8%a1%8c%e7%94%bb%e5%9b%be%28%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e7%bb%88%e7%bb%93%e8%80%85%29&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fj4c8fqsehq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fj4c8fqsehq%2f&title=%e4%bd%bf%e7%94%a8box-shadow%e8%bf%9b%e8%a1%8c%e7%94%bb%e5%9b%be%28%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e7%bb%88%e7%bb%93%e8%80%85%29"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fj4c8fqsehq%2f&title=%e4%bd%bf%e7%94%a8box-shadow%e8%bf%9b%e8%a1%8c%e7%94%bb%e5%9b%be%28%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e7%bb%88%e7%bb%93%e8%80%85%29"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fj4c8fqsehq%2f&title=%e4%bd%bf%e7%94%a8box-shadow%e8%bf%9b%e8%a1%8c%e7%94%bb%e5%9b%be%28%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e7%bb%88%e7%bb%93%e8%80%85%29"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fj4c8fqsehq%2f&title=%e4%bd%bf%e7%94%a8box-shadow%e8%bf%9b%e8%a1%8c%e7%94%bb%e5%9b%be%28%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96%e7%bb%88%e7%bb%93%e8%80%85%29"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">使用box-shadow进行画图(性能优化终结者)</h1><div class="meta"><div class="postdate"><time datetime="2018-11-29" itemprop="datePublished">2018-11-29</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e最近突然想做一些好玩的东西，找来找去，想到了之前曾经在网上看到过有人用\x3ccode\x3ebox-shadow\x3c\/code\x3e画了一副蒙娜丽莎出来  \x3cbr\x3e感觉这个挺有意思，正好趁着周末，自己也搞一波\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e在线地址：\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/blog.jiasm.org\/box-shadow-image-generator\/index-first\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e优化前的版本\x3c\/a\x3e  \x3cbr\x3e\x3ca href=\x22https:\/\/blog.jiasm.org\/box-shadow-image-generator\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e优化后的版本\x3c\/a\x3e  \x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/Jiasm\/box-shadow-image-generator\/blob\/master\/index.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e源码仓库地址\x3c\/a\x3e  \x3c\/p\x3e\n\x3cp\x3e\x3cem\x3e不建议上传大图片。。喜欢听电脑引擎声的除外\x3c\/em\x3e\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e首先，并不打算单纯的实现某一张图片（这样太没意思了），而是通过上传图片，来动态生成\x3ccode\x3ebox-shadow\x3c\/code\x3e的数据。  \x3cbr\x3e所以，你需要了解这些东西：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3ccode\x3ebox-shadow\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3ecanvas\x3c\/code\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3ebox-shadow\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3ebox-shadow\x3c\/code\x3e可以让我们针对任意一个\x3ccode\x3ehtml\x3c\/code\x3e标签生成阴影，我们可以控制阴影的偏移量、模糊半径、实际半径、颜色等一系列属性。  \x3cbr\x3e语法如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22selector {\n  \/* offset-x | offset-y | color *\/\n  box-shadow: 60px -16px teal;\n\n  \/* offset-x | offset-y | blur-radius | color *\/\n  box-shadow: 10px 5px 5px black;\n\n  \/* offset-x | offset-y | blur-radius | spread-radius | color *\/\n  box-shadow: 2px 2px 2px 1px rgba(0, 0, 0, 0.2);\n\n  \/* inset | offset-x | offset-y | color *\/\n  box-shadow: inset 5em 1em gold;\n\n  \/* Any number of shadows, separated by commas *\/\n  box-shadow: 3px 3px red, -1em 0 0.4em olive;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22css hljs\x22\x3e\x3ccode class=\x22css\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3eselector\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/* offset-x | offset-y | color *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attribute\x22\x3ebox-shadow\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e60px\x3c\/span\x3e -\x3cspan class=\x22hljs-number\x22\x3e16px\x3c\/span\x3e teal;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/* offset-x | offset-y | blur-radius | color *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attribute\x22\x3ebox-shadow\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5px\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5px\x3c\/span\x3e black;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/* offset-x | offset-y | blur-radius | spread-radius | color *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attribute\x22\x3ebox-shadow\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2px\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2px\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2px\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1px\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ergba\x3c\/span\x3e(0, 0, 0, 0.2);\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/* inset | offset-x | offset-y | color *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attribute\x22\x3ebox-shadow\x3c\/span\x3e: inset \x3cspan class=\x22hljs-number\x22\x3e5em\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1em\x3c\/span\x3e gold;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/* Any number of shadows, separated by commas *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-attribute\x22\x3ebox-shadow\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e3px\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3px\x3c\/span\x3e red, -\x3cspan class=\x22hljs-number\x22\x3e1em\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0.4em\x3c\/span\x3e olive;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里是MDN的\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/CSS\/box-shadow\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebox-shadow\x3c\/a\x3e描述，里边有一些示例。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3ecanvas\x3c\/h3\x3e\n\x3cp\x3e是的，我们还需要\x3ccode\x3ecanvas\x3c\/code\x3e，因为我们需要将图片资源转存到\x3ccode\x3ecanvas\x3c\/code\x3e中，再生成我们实际需要的数据格式。\x3cbr\x3e在这里并不会拿\x3ccode\x3ecanvas\x3c\/code\x3e去做渲染之类的，单纯的是要利用\x3ccode\x3ecanvas\x3c\/code\x3e的某些API。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e首版规划\x3c\/h2\x3e\n\x3cp\x3e刚开始的规划大致是这样的：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e我们上传一张图片\x3c\/li\x3e\n\x3cli\x3e创建一个\x3ccode\x3eImage\x3c\/code\x3e对象接收上传的图片资源\x3c\/li\x3e\n\x3cli\x3e将\x3ccode\x3eImage\x3c\/code\x3e对象放入\x3ccode\x3ecanvas\x3c\/code\x3e中\x3c\/li\x3e\n\x3cli\x3e通过\x3ccode\x3ecanvas\x3c\/code\x3e生成图片文件对应的\x3ccode\x3ergba\x3c\/code\x3e数据\x3c\/li\x3e\n\x3cli\x3e处理\x3ccode\x3ergba\x3c\/code\x3e数据转换为\x3ccode\x3ebox-shadow\x3c\/code\x3e属性\x3c\/li\x3e\n\x3cli\x3edone\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e如何接收图片文件数据\x3c\/h3\x3e\n\x3cp\x3e我们在监听\x3ccode\x3einput[type=\x22file\x22]\x3c\/code\x3e的\x3ccode\x3echange\x3c\/code\x3e事件时，可以在\x3ccode\x3etarget\x3c\/code\x3e里边拿到一个\x3ccode\x3efiles\x3c\/code\x3e的对象。  \x3cbr\x3e该对象为本次上传传入的文件列表集合，一般来说我们取第一个元素就是了。  \x3cbr\x3e我们拿到了一个\x3ccode\x3eFile\x3c\/code\x3e类型的对象，接下来就是用\x3ccode\x3eImage\x3c\/code\x3e来接收这个\x3ccode\x3eFile\x3c\/code\x3e对象了。  \x3c\/p\x3e\n\x3cp\x3e这里会用到一个浏览器提供的全局对象\x3ccode\x3eURL\x3c\/code\x3e，\x3ccode\x3eURL\x3c\/code\x3e提供了一个\x3ccode\x3ecreateObjectURL\x3c\/code\x3e的方法。  \x3cbr\x3e方法接收一个\x3ccode\x3eBlob\x3c\/code\x3e类型的参数，而\x3ccode\x3eFile\x3c\/code\x3e则是继承自\x3ccode\x3eBlog\x3c\/code\x3e，所以我们直接传入就可以了。\x3cbr\x3e然后再使用一个\x3ccode\x3eImage\x3c\/code\x3e对象进行接收就可以了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$input.addEventListener(\x27change\x27, ({target: {files: [file]\x22}}\x22) =\x3e {\n  let $img = new Image()\n\n  $img.addEventListener(\x27load\x27, _ =\x3e {\n    console.log(\x27we got this image\x27)\n  })\n\n  $img.src = URL.createObjectURL(file)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$input.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27change\x27\x3c\/span\x3e, ({\x3cspan class=\x22hljs-attr\x22\x3etarget\x3c\/span\x3e: {\x3cspan class=\x22hljs-attr\x22\x3efiles\x3c\/span\x3e: [file]\x22}}\x22) =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e $img = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Image()\n\n  $img.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e, _ =\x26gt; {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27we got this image\x27\x3c\/span\x3e)\n  })\n\n  $img.src = URL.createObjectURL(file)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3eMDN关于\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/URL\/createObjectURL\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eURL.createObjectURL\x3c\/a\x3e的介绍\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e通过canvas获取我们想要的数据\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3ecanvas\x3c\/code\x3e可以直接渲染图片到画布中，可以是一个\x3ccode\x3eImage\x3c\/code\x3e对象、\x3ccode\x3eHTMLImageElement\x3c\/code\x3e及更多媒体相关的标签对象。  \x3cbr\x3e所以我们上边会把数据暂存到一个\x3ccode\x3eImage\x3c\/code\x3e对象中去。  \x3cbr\x3e我们在调用\x3ccode\x3edrawImage\x3c\/code\x3e时需要传入\x3ccode\x3ex\x3c\/code\x3e、\x3ccode\x3ey\x3c\/code\x3e、\x3ccode\x3ewidth\x3c\/code\x3e、\x3ccode\x3eheight\x3c\/code\x3e四个参数，前两个必然是0了，关于后边两个属性，正好当我们的\x3ccode\x3eImage\x3c\/code\x3e对象加载完成后，直接读取它的\x3ccode\x3ewidth\x3c\/code\x3e和\x3ccode\x3eheight\x3c\/code\x3e就是真实的数据：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let context = $canvas.getContext(\x272d\x27)\n$img.addEventListener(\x27load\x27, _ =\x3e {\n  context.drawImage($img, 0, 0, $img.width, $img.height)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e context = $canvas.getContext(\x3cspan class=\x22hljs-string\x22\x3e\x272d\x27\x3c\/span\x3e)\n$img.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e, _ =\x26gt; {\n  context.drawImage($img, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, $img.width, $img.height)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当我们把图片渲染至\x3ccode\x3ecanvas\x3c\/code\x3e后，我们可以调用另一个API获取\x3ccode\x3ergba\x3c\/code\x3e相关的数据。\x3c\/p\x3e\n\x3ch4\x3egetImageData\x3c\/h4\x3e\n\x3cp\x3e我们调用\x3ccode\x3egetImageData\x3c\/code\x3e会返回如下几个参数：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3edata\x3c\/li\x3e\n\x3cli\x3ewidth\x3c\/li\x3e\n\x3cli\x3eheight\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3ccode\x3edata\x3c\/code\x3e为一个数组，每相邻的四个元素为一个像素点的\x3ccode\x3ergba\x3c\/code\x3e描述。\x3cbr\x3e一个类似这样结构的数组：\x3ccode\x3e[r, g, b, a, r, g, b, a]\x3c\/code\x3e。\x3c\/p\x3e\n\x3cblockquote\x3eMDN关于\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/CanvasRenderingContext2D\/drawImage\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3econtext.drawImage\x3c\/a\x3e的介绍  \x3cbr\x3eMDN关于\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/CanvasRenderingContext2D\/getImageData\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3econtext.getImageData\x3c\/a\x3e的介绍\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e处理rgba数据并转换为box-shadow\x3c\/h3\x3e\n\x3cp\x3e在上边我们拿到了一个一维数组，接下来就是将它处理为更合理的结构。\x3cbr\x3e\x3cstrong\x3eP.S. 一维数组是从左到右从上到下排列的，而不是从上到下从左到右\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e我们可以发现，\x3ccode\x3ewidth\x3c\/code\x3e与\x3ccode\x3eheight\x3c\/code\x3e相乘正好是\x3ccode\x3edata\x3c\/code\x3e数组的\x3ccode\x3elength\x3c\/code\x3e。  \x3cbr\x3e而数组的顺序则是先按照\x3ccode\x3ex\x3c\/code\x3e轴进行增加的，所以我们这样处理得到的数据：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function getRGBA (pixels) {\n  let results = []\n  let {width, height, data} = pixels\n  for (let i = 0; i \x3c data.length \/ 4; i\x2b\x2b) {\n    results.push({\n      x: i % width | 0,\n      y: i \/ width | 0,\n      r: data[i * 4],\n      g: data[i * 4 \x2b 1],\n      b: data[i * 4 \x2b 2],\n      a: data[i * 4 \x2b 3]\n    })\n  }\n\n  return results\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetRGBA\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3epixels\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e results = []\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {width, height, data} = pixels\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; data.length \/ \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e; i\x2b\x2b) {\n    results.push({\n      \x3cspan class=\x22hljs-attr\x22\x3ex\x3c\/span\x3e: i % width | \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3ey\x3c\/span\x3e: i \/ width | \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3er\x3c\/span\x3e: data[i * \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e],\n      \x3cspan class=\x22hljs-attr\x22\x3eg\x3c\/span\x3e: data[i * \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\n      \x3cspan class=\x22hljs-attr\x22\x3eb\x3c\/span\x3e: data[i * \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e],\n      \x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: data[i * \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e]\n    })\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e results\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们将\x3ccode\x3elength\x3c\/code\x3e除以\x3ccode\x3e4\x3c\/code\x3e作为循环的最大长度，然后在生成每个像素点的描述时  \x3cbr\x3e通过当前下标对图片宽度取余得到当前像素点在图片中的\x3ccode\x3ex\x3c\/code\x3e轴下标  \x3cbr\x3e通过当前下标对图片宽度取商得到当前像素点在图片中的\x3ccode\x3ey\x3c\/code\x3e轴下标  \x3cbr\x3e同时塞入\x3ccode\x3ergba\x3c\/code\x3e四个值，这样我们就会拿到一个类似这样结构的数据：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[{\n  x: 0,\n  y: 0,\n  r: 255,\n  g: 255,\n  b: 255,\n  a: 255\n}]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e[{\n  \x3cspan class=\x22hljs-attr\x22\x3ex\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ey\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3er\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e255\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eg\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e255\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eb\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e255\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e255\x3c\/span\x3e\n}]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e将数据生成为box-shadow格式的数据\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3ebox-shadow\x3c\/code\x3e是支持多组属性的，两组属性之间使用\x3ccode\x3e,\x3c\/code\x3e进行分割。  \x3cbr\x3e所以，我们拿到上边的数据以后，直接遍历拼接字符串就可以生成我们想要的结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let boxShadow = results.map(item =\x3e\n  `${item.x}px ${item.y}px rgba(${item.r}, ${item.g}, ${item.b}, ${item.a})`\n).join(\x27,\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e boxShadow = results.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${item.x}\x3c\/span\x3epx \x3cspan class=\x22hljs-subst\x22\x3e${item.y}\x3c\/span\x3epx rgba(\x3cspan class=\x22hljs-subst\x22\x3e${item.r}\x3c\/span\x3e, \x3cspan class=\x22hljs-subst\x22\x3e${item.g}\x3c\/span\x3e, \x3cspan class=\x22hljs-subst\x22\x3e${item.b}\x3c\/span\x3e, \x3cspan class=\x22hljs-subst\x22\x3e${item.a}\x3c\/span\x3e)`\x3c\/span\x3e\n).join(\x3cspan class=\x22hljs-string\x22\x3e\x27,\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e效果图：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVbaRCh?w=2558\x26amp;h=1228\x22 src=\x22https:\/\/static.alili.tech\/img\/bVbaRCh?w=2558\x26amp;h=1228\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e虽说这样就做出来了，但是对浏览器来说太不友好了。因为是每一个像素点对应的一个\x3ccode\x3ebox-shadow\x3c\/code\x3e属性。  \x3cbr\x3e好奇的童鞋可以选择F12检查元素查看该\x3ccode\x3ediv\x3c\/code\x3e。\x3cem\x3e(反正苹果本是扛不住)\x3c\/em\x3e\x3cbr\x3e所以为了我们能够正常使用F12，我们下一步的操作就是合并相邻同色值的\x3ccode\x3ebox-shadow\x3c\/code\x3e，减少\x3ccode\x3ebox-shadow\x3c\/code\x3e属性值的数量。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e合并相邻的单元格\x3c\/h2\x3e\n\x3cp\x3e虽说图片可能是由各种颜色不规则的组合而成，但毕竟还是会有很多是重复颜色的。  \x3cbr\x3e所以我们要计算出某一种颜色可合并的最大面积。  \x3cbr\x3e针对某一种颜色，用表格表示可能是这样的：  \x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVbaRCl?w=1314\x26amp;h=880\x22 src=\x22https:\/\/static.alili.tech\/img\/bVbaRCl?w=1314\x26amp;h=880\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e就像在图中所示，我们最理想的合并方式应该是这样的 \x3cem\x3e（radius的取值意味着我们只能设置一个正方形）\x3c\/em\x3e：  \x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVbaRCm?w=1316\x26amp;h=890\x22 src=\x22https:\/\/static.alili.tech\/img\/bVbaRCm?w=1316\x26amp;h=890\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e于是。。如果计算出来这一块面积就成为了一个问题-.-  \x3c\/p\x3e\n\x3cp\x3e目前的思路是，将数组转换为二维数组，而不是单纯的在对象中用\x3ccode\x3ex\x3c\/code\x3e、\x3ccode\x3ey\x3c\/code\x3e标识。  \x3cbr\x3e所以，我们对处理数组的函数进行如下修改：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function getRGBA (pixels) {\n  let results = []\n  let {width, height, data} = pixels\n  for (let i = 0; i \x3c data.length \/ 4; i\x2b\x2b) {\n    let x = i % width | 0\n    let y = i \/ width | 0\n    let row = results[y] = results[y] || []\n    row[x] = {\n      rgba: `${data.slice(i * 4, i * 4 \x2b 4)}` \/\/ 为了方便后续的对比相同颜色，直接返回一个字符串\n    }\n  }\n\n  return results\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetRGBA\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3epixels\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e results = []\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {width, height, data} = pixels\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; data.length \/ \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e x = i % width | \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e y = i \/ width | \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e row = results[y] = results[y] || []\n    row[x] = {\n      \x3cspan class=\x22hljs-attr\x22\x3ergba\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${data.slice(i * \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e, i * \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e)}\x3c\/span\x3e`\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 为了方便后续的对比相同颜色，直接返回一个字符串\x3c\/span\x3e\n    }\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e results\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这时我们就能得到一个按照\x3ccode\x3ex\x3c\/code\x3e、\x3ccode\x3ey\x3c\/code\x3e排列的二维数组，下一步的操作就是以任意点为原点，进行匹配周围的\x3ccode\x3ecell\x3c\/code\x3e。\x3cbr\x3e参考上边的表格示例，我们会拿到一个类似这样的数据 \x3cem\x3e（仅作示例）\x3c\/em\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n  [1, 1, 1, 1, 1, 1],\n  [1, 1, 1, 1],\n  [1, 1, 1],\n  [1, 1, 1, 1, 1],\n  [1, 1, 1, 1],\n  [1, 1],\n  [1, 1, 1, 1, 1, 1],\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e[\n  [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\n  [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\n  [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\n  [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\n  [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\n  [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\n  [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e获取可合并的最大半径\x3c\/h3\x3e\n\x3cp\x3e目前采用的是递归的方式，从\x3ccode\x3e0,0\x3c\/code\x3e原点处开始搜索，获取当前原点的色值，然后与周围进行比较，获取一个最大半径的正方形：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 根据给定范围获取匹配当前节点的正方形\n * @param  {Array}  matrix            二维矩阵数组\n * @param  {Object} tag               当前要匹配的节点\n * @param  {Number} [startRowIndex=0] 开始的行下标，默认为1\n * @param  {Number} [startColIndex=0] 开始的列下标，默认为1\n * @return {Number}                   返回一个最小范围\n *\/\nfunction range (matrix, tag, startRowIndex = 0, startColIndex = 0) {\n  let results = []\n  rows:\n  for (let rowIndex = startRowIndex; rowIndex \x3c matrix.length; rowIndex\x2b\x2b) {\n    let row = matrix[rowIndex]\n    for (let colIndex = startColIndex; colIndex \x3c row.length; colIndex\x2b\x2b) {\n      let item = row[colIndex]\n\n      if (item.rgba !== tag.rgba) {\n        if (colIndex === startColIndex) {\n          break rows\n          \/\/ 这个表示在某一行的第一列就匹配失败了，没有必要再进行后续的匹配，直接`break`到最外层\n        } else {\n          results.push(colIndex - startColIndex)\n          break\n          \/\/ 将当前下标放入集合，终止当前循环\n        }\n      } else if (colIndex === row.length - 1) {\n        results.push(colIndex - startColIndex)\n        \/\/ 这里表示一整行都可以与当前元素匹配\n      }\n    }\n  }\n\n  \/\/ 对所有的x、y轴的值进行比较获取最小的值\n  let count = Math.min.apply(Math, [results.length].concat(results))\n\n  return count\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 根据给定范围获取匹配当前节点的正方形\n * @param  {Array}  matrix            二维矩阵数组\n * @param  {Object} tag               当前要匹配的节点\n * @param  {Number} [startRowIndex=0] 开始的行下标，默认为1\n * @param  {Number} [startColIndex=0] 开始的列下标，默认为1\n * @return {Number}                   返回一个最小范围\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erange\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ematrix, tag, startRowIndex = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, startColIndex = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e results = []\n  rows:\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e rowIndex = startRowIndex; rowIndex \x26lt; matrix.length; rowIndex\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e row = matrix[rowIndex]\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e colIndex = startColIndex; colIndex \x26lt; row.length; colIndex\x2b\x2b) {\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e item = row[colIndex]\n\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (item.rgba !== tag.rgba) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (colIndex === startColIndex) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e rows\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这个表示在某一行的第一列就匹配失败了，没有必要再进行后续的匹配，直接`break`到最外层\x3c\/span\x3e\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          results.push(colIndex - startColIndex)\n          \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将当前下标放入集合，终止当前循环\x3c\/span\x3e\n        }\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (colIndex === row.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n        results.push(colIndex - startColIndex)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里表示一整行都可以与当前元素匹配\x3c\/span\x3e\n      }\n    }\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对所有的x、y轴的值进行比较获取最小的值\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e count = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.min.apply(\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e, [results.length].concat(results))\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e count\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e函数会从起点开始按顺序遍历所有的元素，在遇到不匹配的节点后，就会\x3ccode\x3ebreak\x3c\/code\x3e进入下次循环，并将当前的下标存入数组中。  \x3cbr\x3e在遍历完成后，我们将数组所有的\x3ccode\x3eitem\x3c\/code\x3e以及数组的长度（可以认为是\x3ccode\x3ey\x3c\/code\x3e轴的值）一同放入\x3ccode\x3eMath.min\x3c\/code\x3e获取一个最小的值。  \x3cbr\x3e这个最小的值就是我们以当前节点为原点时可以生成的最大范围的正方形了。  \x3cbr\x3e\x3cem\x3eP.S. 这个计算方式并不是很好，还不够灵活\x3c\/em\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e递归计算剩余面积\x3c\/h3\x3e\n\x3cp\x3e因为上边也只是合并了一个正方形，还会剩下很多面积没有被查看。  \x3cbr\x3e所以我们用递归的方式来计算剩余面积，在第一次匹配结束后，是大概这个样子的：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVbaRCn?w=340\x26amp;h=341\x22 src=\x22https:\/\/static.alili.tech\/img\/bVbaRCn?w=340\x26amp;h=341\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e所以我们在递归处拆分出了两块会有重复数据的面积：  \x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVbaRCo?w=340\x26amp;h=338\x22 src=\x22https:\/\/static.alili.tech\/img\/bVbaRCo?w=340\x26amp;h=338\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVbaRCp?w=340\x26amp;h=341\x22 src=\x22https:\/\/static.alili.tech\/img\/bVbaRCp?w=340\x26amp;h=341\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e以及之后的递归也是参照这个样子来的，这样能保证所有的节点都会被照顾到，不会漏掉。\x3cem\x3e(如果有更好的方式，求回复)。\x3c\/em\x3e  \x3c\/p\x3e\n\x3cp\x3e这样配合着前边拿到的半径数据，很轻松的就可以组装出合并后的集合，下一步就是将其渲染到\x3ccode\x3eDOM\x3c\/code\x3e中了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e渲染到box-shadow中\x3c\/h3\x3e\n\x3cp\x3e现在我们已经拿到了想要的数据，关于生成\x3ccode\x3ebox-shadow\x3c\/code\x3e属性处我们也要进行一些修改，之前因为是一个像素对应一个属性值，但是现在做了一些合并，所以，生成属性值的操作大概是这个样子的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$output.style.boxShadow = results.map(item =\x3e\n  `${item.x}px ${item.y}px 0px ${item.radius}px rgba(${item.target.rgba})`\n).join(\x27,\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e$output.style.boxShadow = results.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${item.x}\x3c\/span\x3epx \x3cspan class=\x22hljs-subst\x22\x3e${item.y}\x3c\/span\x3epx 0px \x3cspan class=\x22hljs-subst\x22\x3e${item.radius}\x3c\/span\x3epx rgba(\x3cspan class=\x22hljs-subst\x22\x3e${item.target.rgba}\x3c\/span\x3e)`\x3c\/span\x3e\n).join(\x3cspan class=\x22hljs-string\x22\x3e\x27,\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3eP.S. \x3ccode\x3ex\x3c\/code\x3e和\x3ccode\x3ey\x3c\/code\x3e的值必须要加上半径的值，否则会出现错位，因为\x3ccode\x3ebox-shadow\x3c\/code\x3e是从中心开始渲染的，而不是左上角\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e完成后的效果对比\x3c\/h3\x3e\n\x3cp\x3e原图\x26amp;两种实现方式的效果对比：  \x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVbaRCI?w=600\x26amp;h=557\x22 src=\x22https:\/\/static.alili.tech\/img\/bVbaRCI?w=600\x26amp;h=557\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们拿合并前后生成的\x3ccode\x3eCSS\x3c\/code\x3e存为了文件，并查看了文件大小，效果在一些背景不是太复杂的图片上还是很明显的，减少了\x3ccode\x3e2\/3\x3c\/code\x3e左右的体积。  \x3cbr\x3e\x3cem\x3e如果将rgba替换为hex，还会再小一些\x3c\/em\x3e\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVbaRCJ?w=476\x26amp;h=88\x22 src=\x22https:\/\/static.alili.tech\/img\/bVbaRCJ?w=476\x26amp;h=88\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e现在再进行检查元素不会崩溃了，但是依然会卡:)\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e参考资料\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/CSS\/box-shadow\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebox-shadow\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/CanvasRenderingContext2D\/drawImage\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edrawImage\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/CanvasRenderingContext2D\/getImageData\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egetImageData\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/URL\/createObjectURL\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecreateObjectURL\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>使用box-shadow进行画图(性能优化终结者)</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014943400">https://segmentfault.com/a/1190000014943400</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/j4c8fqsehq/" target="_blank">https://alili.tech/archive/j4c8fqsehq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>