<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="html2image原理简述"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>html2image原理简述 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/jmk982sw8qe/",
				"appid": "1613049289050283", 
				"title": "html2image原理简述 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-11T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/s2dcabyd1yq/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/818k6s5tmpd/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fjmk982sw8qe%2f&text=html2image%e5%8e%9f%e7%90%86%e7%ae%80%e8%bf%b0"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fjmk982sw8qe%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fjmk982sw8qe%2f&text=html2image%e5%8e%9f%e7%90%86%e7%ae%80%e8%bf%b0"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fjmk982sw8qe%2f&title=html2image%e5%8e%9f%e7%90%86%e7%ae%80%e8%bf%b0"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fjmk982sw8qe%2f&is_video=false&description=html2image%e5%8e%9f%e7%90%86%e7%ae%80%e8%bf%b0"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=html2image%e5%8e%9f%e7%90%86%e7%ae%80%e8%bf%b0&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fjmk982sw8qe%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fjmk982sw8qe%2f&title=html2image%e5%8e%9f%e7%90%86%e7%ae%80%e8%bf%b0"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjmk982sw8qe%2f&title=html2image%e5%8e%9f%e7%90%86%e7%ae%80%e8%bf%b0"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjmk982sw8qe%2f&title=html2image%e5%8e%9f%e7%90%86%e7%ae%80%e8%bf%b0"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjmk982sw8qe%2f&title=html2image%e5%8e%9f%e7%90%86%e7%ae%80%e8%bf%b0"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">html2image原理简述</h1><div class="meta"><div class="postdate"><time datetime="2018-12-11" itemprop="datePublished">2018-12-11</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013540928?w=1794\x26amp;h=648\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013540928?w=1794\x26amp;h=648\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e看到 \x3ca href=\x22https:\/\/github.com\/tj\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTJ 大神\x3c\/a\x3e star了\x3ca href=\x22https:\/\/github.com\/tsayen\/dom-to-image\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edom-to-image\x3c\/a\x3e，也一直很好奇\x3ccode\x3ehtml\x3c\/code\x3e怎么转 \x3ccode\x3eimage\x3c\/code\x3e \x3c\/p\x3e\n\x3cp\x3e那么就翻下源码，看下是如何实现的，其实一共就不到800行代码，还蛮容易读懂的\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e工作原理\x3c\/h2\x3e\n\x3cp\x3e使用\x3ccode\x3esvg\x3c\/code\x3e的一个特性，允许在\x3ccode\x3e\x26lt;foreignobject\x26gt;\x3c\/code\x3e标签中包含任意的\x3ccode\x3ehtml\x3c\/code\x3e内容。（主要是 \x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/XMLSerializer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eXMLSerializer | MDN\x3c\/a\x3e这个\x3ccode\x3eapi\x3c\/code\x3e将\x3ccode\x3edom\x3c\/code\x3e转为\x3ccode\x3esvg\x3c\/code\x3e）\x3cbr\x3e所以，为了渲染那个\x3ccode\x3edom\x3c\/code\x3e节点，你需要采取以下步骤：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e递归 \x3ccode\x3eclone\x3c\/code\x3e 原始的 \x3ccode\x3edom\x3c\/code\x3e 节点\x3c\/li\x3e\n\x3cli\x3e获取 节点以及子节点 上的 \x3ccode\x3ecomputed style\x3c\/code\x3e，并将这些样式添加进新建的style标签中（不要忘记了clone 伪元素的样式）\x3c\/li\x3e\n\x3cli\x3e嵌入网页字体\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cul\x3e\n\x3cli\x3e找到所有的\x3ccode\x3e@font-face\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e解析URL资源，并下载对应的资源\x3c\/li\x3e\n\x3cli\x3ebase64编码和内联资源 作为 \x3ccode\x3edata:\x3c\/code\x3e URLS引用\x3c\/li\x3e\n\x3cli\x3e把上面处理完的\x3ccode\x3ecss rules\x3c\/code\x3e全部都放进\x3ccode\x3e\x26lt;style\x26gt;\x3c\/code\x3e中，并把标签加入到clone的节点中去\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3col\x3e\x3cli\x3e内嵌图片\x3c\/li\x3e\x3c\/ol\x3e\n\x3cul\x3e\n\x3cli\x3e内联图片src 的url 进 \x3ccode\x3e\x26lt;img\x26gt;元素\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e背景图片 使用 background css 属性，类似fonts的使用方式\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3col\x3e\n\x3cli\x3e序列化 clone 的 dom 节点 为 \x3ccode\x3esvg\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e将xml包装到\x3ccode\x3e\x26lt;foreignobject\x26gt;\x3c\/code\x3e标签中，放入\x3ccode\x3esvg\x3c\/code\x3e中，然后将其作为\x3ccode\x3edata: url\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e将png内容或原始数据作为\x3ccode\x3euint8array\x3c\/code\x3e获取，使用svg作为源创建一个\x3ccode\x3eimg\x3c\/code\x3e标签，并将其渲染到新创建的\x3ccode\x3ecanvas\x3c\/code\x3e上，然后把\x3ccode\x3ecanvas\x3c\/code\x3e转为\x3ccode\x3ebase64\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e完成\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3chr\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e核心API\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import domtoimage from \x27dom-to-image\x27\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e domtoimage \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27dom-to-image\x27\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3edomtoimage\x3c\/strong\x3e 有如下一些方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    * toSvg (`dom` 转 `svg`)\n    * toPng (`dom` 转 `png`)\n    * toJpeg (`dom` 转 `jpg`)\n    * toBlob (`dom` 转 `blob`)\n    * toPixelData (`dom` 转 像素数据)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs autohotkey\x22\x3e\x3ccode\x3e    * toSvg (`dom` 转 `svg`)\n    * toPng (`dom` 转 `png`)\n    * toJpeg (`dom` 转 `jpg`)\n    * toBlob (`dom` 转 `blob`)\n    * toPixelData (`dom` 转 像素数据)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e见名知意，名字取得非常好\x3c\/p\x3e\n\x3cp\x3e下面我挑一个\x3ccode\x3etoPng\x3c\/code\x3e来简单解析一下原理，其他的原理也都是类似的\x3c\/p\x3e\n\x3chr\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e分析 toPng 原理\x3c\/h2\x3e\n\x3cblockquote\x3e尽量挑最核心的讲，希望不会显得很繁琐，了解核心思想就好\x3c\/blockquote\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013540929?w=915\x26amp;h=404\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013540929?w=915\x26amp;h=404\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e下面介绍几个核心函数：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3etoPng （包装了draw函数，没啥意义）\x3c\/li\x3e\n\x3cli\x3eDraw （dom =\x26gt; canvas）\x3c\/li\x3e\n\x3cli\x3etoSvg  （dom =\x26gt; svg）\x3c\/li\x3e\n\x3cli\x3ecloneNode （clone dom树和css样式）\x3c\/li\x3e\n\x3cli\x3emakeSvgDataUri （dom =\x26gt; svg =\x26gt; data:uri）\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e调用顺序为\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22toPng 调用 Draw\nDraw 调用 toSvg\ntoSvg 调用 cloneNode\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eto\x3c\/span\x3ePng 调用 Draw\nDraw 调用 \x3cspan class=\x22hljs-keyword\x22\x3eto\x3c\/span\x3eSvg\n\x3cspan class=\x22hljs-keyword\x22\x3eto\x3c\/span\x3eSvg 调用 cloneNode\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3etoPng方法：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 里面其实就是调用了 draw 方法，promise返回的是一个canvas对象\nfunction toPng(node, options) {\n    return draw(node, options || {})\n        .then(function (canvas) {\n            return canvas.toDataURL();\n        });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 里面其实就是调用了 draw 方法，promise返回的是一个canvas对象\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etoPng\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enode, options\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e draw(node, options || {})\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ecanvas\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e canvas.toDataURL();\n        });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3eDraw方法\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function draw(domNode, options) {\n    \/\/ 将 dom 节点转为 svg（data: url形式的svg）\n    return toSvg(domNode, options)    \n        \/\/ util.makeImage 将 canvas 转为 new Image(uri)\n        .then(util.makeImage)\n        .then(util.delay(100))\n        .then(function (image) {\n            var canvas = newCanvas(domNode);\n            canvas.getContext(\x272d\x27).drawImage(image, 0, 0);\n            return canvas;\n        });\n\n    \/\/ 创建一个空的 canvas 节点\n    function newCanvas(domNode) {\n        var canvas = document.createElement(\x27canvas\x27);\n        canvas.width = options.width || util.width(domNode);\n        canvas.height = options.height || util.height(domNode);\n          ......\n        return canvas;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edraw\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edomNode, options\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将 dom 节点转为 svg（data: url形式的svg）\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e toSvg(domNode, options)    \n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ util.makeImage 将 canvas 转为 new Image(uri)\x3c\/span\x3e\n        .then(util.makeImage)\n        .then(util.delay(\x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e))\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eimage\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e canvas = newCanvas(domNode);\n            canvas.getContext(\x3cspan class=\x22hljs-string\x22\x3e\x272d\x27\x3c\/span\x3e).drawImage(image, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e canvas;\n        });\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建一个空的 canvas 节点\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enewCanvas\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edomNode\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e canvas = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27canvas\x27\x3c\/span\x3e);\n        canvas.width = options.width || util.width(domNode);\n        canvas.height = options.height || util.height(domNode);\n          ......\n        return canvas;\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3etoSvg方法\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  function toSvg (node, options) {\n    options = options || {}\n    \/\/ 设置一些默认值，如果option是空的话\n    copyOptions(options)\n\n    return (\n      Promise.resolve(node)\n        .then(function (node) {\n          \/\/ clone dom 树\n          return cloneNode(node, options.filter, true)\n        })\n        \/\/ 把字体相关的csstext 全部都新建一个 stylesheet 添加进去\n        .then(embedFonts)\n        \/\/ clone 处理图片啊，background url(\x27\x27)里面的资源，顺便加载好\n        .then(inlineImages)\n        \/\/ 把option 里面的一些 style 放进stylesheet里面\n        .then(applyOptions)\n        .then(function (clone) {\n          \/\/ node 节点序列化成 svg\n          return makeSvgDataUri(\n            clone,\n            \/\/ util.width 就是 getComputedStyle 获取节点的宽\n            options.width || util.width(node),\n            options.height || util.height(node)\n          )\n        })\n    )\n      \/\/ 设置一些默认值\n    function applyOptions (clone) {\n        ......\n      return clone\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etoSvg\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, options\x3c\/span\x3e) \x3c\/span\x3e{\n    options = options || {}\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置一些默认值，如果option是空的话\x3c\/span\x3e\n    copyOptions(options)\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(node)\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ clone dom 树\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cloneNode(node, options.filter, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\n        })\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 把字体相关的csstext 全部都新建一个 stylesheet 添加进去\x3c\/span\x3e\n        .then(embedFonts)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ clone 处理图片啊，background url(\x27\x27)里面的资源，顺便加载好\x3c\/span\x3e\n        .then(inlineImages)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 把option 里面的一些 style 放进stylesheet里面\x3c\/span\x3e\n        .then(applyOptions)\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eclone\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ node 节点序列化成 svg\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e makeSvgDataUri(\n            clone,\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ util.width 就是 getComputedStyle 获取节点的宽\x3c\/span\x3e\n            options.width || util.width(node),\n            options.height || util.height(node)\n          )\n        })\n    )\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置一些默认值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eapplyOptions\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eclone\x3c\/span\x3e) \x3c\/span\x3e{\n        ......\n      return clone\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ecloneNode 方法\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  function cloneNode (node, filter, root) {\n    if (!root \x26amp;\x26amp; filter \x26amp;\x26amp; !filter(node)) return Promise.resolve()\n\n    return (\n      Promise.resolve(node)\n        .then(makeNodeCopy)\n        .then(function (clone) {\n          return cloneChildren(node, clone, filter)\n        })\n        .then(function (clone) {\n          return processClone(node, clone)\n        })\n    )\n    \/\/ makeNodeCopy\n    \/\/ 如果不是canvas 节点的话，就clone\n    \/\/ 是的话，就返回 canvas转image的 img 对象\n    function makeNodeCopy (node) {\n      if (node instanceof HTMLCanvasElement) { return util.makeImage(node.toDataURL()) }\n      return node.cloneNode(false)\n    }\n    \/\/ clone 子节点 （如果存在的话）\n    function cloneChildren (original, clone, filter) {\n      var children = original.childNodes\n      if (children.length === 0) return Promise.resolve(clone)\n\n      return cloneChildrenInOrder(clone, util.asArray(children), filter).then(\n        function () {\n          return clone\n        }\n      )\n      \/\/ 递归 clone 节点\n      function cloneChildrenInOrder (parent, children, filter) {\n        var done = Promise.resolve()\n        children.forEach(function (child) {\n          done = done\n            .then(function () {\n              return cloneNode(child, filter)\n            })\n            .then(function (childClone) {\n              if (childClone) parent.appendChild(childClone)\n            })\n        })\n        return done\n      }\n    }\n    \n    \/\/ 处理添加dom的css，处理svg\n    function processClone (original, clone) {\n      if (!(clone instanceof Element)) return clone\n\n      return Promise.resolve()\n        \/\/ 读取节点的getComputedStyle，添加进css中\n        .then(cloneStyle)\n        \/\/ 获取伪类的css，添加进css\n        .then(clonePseudoElements)\n        \/\/ 读取 input textarea 的value\n        .then(copyUserInput)\n        \/\/ 设置svg 的 xmlns\n        \/\/ 命名空间声明由xmlns属性提供。此属性表示\x3csvg\x3e标记及其子标记属于名称空间为“http:\/\/www.w3.org\/2000\/svg”的XML方言\n        .then(fixSvg)\n        .then(function () {\n          return clone\n        })\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecloneNode\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, filter, root\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!root \x26amp;\x26amp; filter \x26amp;\x26amp; !filter(node)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve()\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(node)\n        .then(makeNodeCopy)\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eclone\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cloneChildren(node, clone, filter)\n        })\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eclone\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e processClone(node, clone)\n        })\n    )\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ makeNodeCopy\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果不是canvas 节点的话，就clone\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 是的话，就返回 canvas转image的 img 对象\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emakeNodeCopy\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (node \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e HTMLCanvasElement) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e util.makeImage(node.toDataURL()) }\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e node.cloneNode(\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ clone 子节点 （如果存在的话）\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecloneChildren\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eoriginal, clone, filter\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e children = original.childNodes\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (children.length === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(clone)\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cloneChildrenInOrder(clone, util.asArray(children), filter).then(\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e clone\n        }\n      )\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 递归 clone 节点\x3c\/span\x3e\n      \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecloneChildrenInOrder\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eparent, children, filter\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e done = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve()\n        children.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3echild\x3c\/span\x3e) \x3c\/span\x3e{\n          done = done\n            .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n              \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cloneNode(child, filter)\n            })\n            .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3echildClone\x3c\/span\x3e) \x3c\/span\x3e{\n              \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (childClone) parent.appendChild(childClone)\n            })\n        })\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e done\n      }\n    }\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理添加dom的css，处理svg\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eprocessClone\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eoriginal, clone\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(clone \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e Element)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e clone\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve()\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 读取节点的getComputedStyle，添加进css中\x3c\/span\x3e\n        .then(cloneStyle)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取伪类的css，添加进css\x3c\/span\x3e\n        .then(clonePseudoElements)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 读取 input textarea 的value\x3c\/span\x3e\n        .then(copyUserInput)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置svg 的 xmlns\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 命名空间声明由xmlns属性提供。此属性表示\x26lt;svg\x26gt;标记及其子标记属于名称空间为“http:\/\/www.w3.org\/2000\/svg”的XML方言\x3c\/span\x3e\n        .then(fixSvg)\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e clone\n        })\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e下面是这篇的重点 把 \x3ccode\x3ehtml\x3c\/code\x3e 节点序列化成 \x3ccode\x3esvg\x3c\/code\x3e\n\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \/\/ node 节点序列化成 svg\n  function makeSvgDataUri (node, width, height) {\n    return Promise.resolve(node)\n      .then(function (node) {\n        node.setAttribute(\x27xmlns\x27, \x27http:\/\/www.w3.org\/1999\/xhtml\x27)\n\n        \/\/ XMLSerializer 对象使你能够把一个 XML 文档或 Node 对象转化或“序列化”为未解析的 XML 标记的一个字符串。\n        \/\/ 要使用一个 XMLSerializer，使用不带参数的构造函数实例化它，然后调用其 serializeToString() 方法：\n        return new XMLSerializer().serializeToString(node)\n      })\n      \/\/ escapeXhtml代码是string.replace(\/#\/g, \x27%23\x27).replace(\/\\n\/g, \x27%0A\x27)\n      .then(util.escapeXhtml)\n      .then(function (xhtml) {\n        return (\n          \x27\x3cforeignObject x=\x26quot;0\x26quot; y=\x26quot;0\x26quot; width=\x26quot;100%\x26quot; height=\x26quot;100%\x26quot;\x3e\x27 \x2b\n          xhtml \x2b\n          \x27\x3c\/foreignObject\x3e\x27\n        )\n      })\n      \/\/ 变成svg\n      .then(function (foreignObject) {\n        return (\n          \x27\x3csvg xmlns=\x26quot;http:\/\/www.w3.org\/2000\/svg\x26quot; width=\x26quot;\x27 \x2b\n          width \x2b\n          \x27\x26quot; height=\x26quot;\x27 \x2b\n          height \x2b\n          \x27\x26quot;\x3e\x27 \x2b\n          foreignObject \x2b\n          \x27\x3c\/svg\x3e\x27\n        )\n      })\n      \/\/ 变成 data: url\n      .then(function (svg) {\n        return \x27data:image\/svg\x2bxml;charset=utf-8,\x27 \x2b svg\n      })\n  }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ node 节点序列化成 svg\x3c\/span\x3e\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emakeSvgDataUri\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, width, height\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(node)\n      .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode\x3c\/span\x3e) \x3c\/span\x3e{\n        node.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x27xmlns\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/www.w3.org\/1999\/xhtml\x27\x3c\/span\x3e)\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ XMLSerializer 对象使你能够把一个 XML 文档或 Node 对象转化或“序列化”为未解析的 XML 标记的一个字符串。\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 要使用一个 XMLSerializer，使用不带参数的构造函数实例化它，然后调用其 serializeToString() 方法：\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e XMLSerializer().serializeToString(node)\n      })\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ escapeXhtml代码是string.replace(\/#\/g, \x27%23\x27).replace(\/\\n\/g, \x27%0A\x27)\x3c\/span\x3e\n      .then(util.escapeXhtml)\n      .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3exhtml\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n          \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;foreignObject x=\x220\x22 y=\x220\x22 width=\x22100%\x22 height=\x22100%\x22\x26gt;\x27\x3c\/span\x3e \x2b\n          xhtml \x2b\n          \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;\/foreignObject\x26gt;\x27\x3c\/span\x3e\n        )\n      })\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 变成svg\x3c\/span\x3e\n      .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eforeignObject\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n          \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;svg xmlns=\x22http:\/\/www.w3.org\/2000\/svg\x22 width=\x22\x27\x3c\/span\x3e \x2b\n          width \x2b\n          \x3cspan class=\x22hljs-string\x22\x3e\x27\x22 height=\x22\x27\x3c\/span\x3e \x2b\n          height \x2b\n          \x3cspan class=\x22hljs-string\x22\x3e\x27\x22\x26gt;\x27\x3c\/span\x3e \x2b\n          foreignObject \x2b\n          \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;\/svg\x26gt;\x27\x3c\/span\x3e\n        )\n      })\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 变成 data: url\x3c\/span\x3e\n      .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3esvg\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27data:image\/svg\x2bxml;charset=utf-8,\x27\x3c\/span\x3e \x2b svg\n      })\n  }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e参考链接\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/CSSStyleDeclaration\/setProperty\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCSSStyleDeclaration.setProperty() - Web API 接口 | MDN\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/tsayen\/dom-to-image\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edom-to-image\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/www.w3school.com.cn\/xmldom\/dom_xmlserializer.asp\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eXML DOM - XMLSerializer 对象\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>html2image原理简述</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013540925">https://segmentfault.com/a/1190000013540925</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/jmk982sw8qe/" target="_blank">https://alili.tech/archive/jmk982sw8qe/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>