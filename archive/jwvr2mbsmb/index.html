<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="vue.js 移动端音乐app（一） 基础组件 scroll"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>vue.js 移动端音乐app（一） 基础组件 scroll | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/jwvr2mbsmb/",
				"appid": "1613049289050283", 
				"title": "vue.js 移动端音乐app（一） 基础组件 scroll | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-25T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ps718ztwf3d/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/ws9tivyi31j/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fjwvr2mbsmb%2f&text=vue.js%20%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%9f%b3%e4%b9%90app%ef%bc%88%e4%b8%80%ef%bc%89%20%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%20scroll"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fjwvr2mbsmb%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fjwvr2mbsmb%2f&text=vue.js%20%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%9f%b3%e4%b9%90app%ef%bc%88%e4%b8%80%ef%bc%89%20%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%20scroll"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fjwvr2mbsmb%2f&title=vue.js%20%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%9f%b3%e4%b9%90app%ef%bc%88%e4%b8%80%ef%bc%89%20%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%20scroll"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fjwvr2mbsmb%2f&is_video=false&description=vue.js%20%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%9f%b3%e4%b9%90app%ef%bc%88%e4%b8%80%ef%bc%89%20%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%20scroll"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=vue.js%20%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%9f%b3%e4%b9%90app%ef%bc%88%e4%b8%80%ef%bc%89%20%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%20scroll&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fjwvr2mbsmb%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fjwvr2mbsmb%2f&title=vue.js%20%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%9f%b3%e4%b9%90app%ef%bc%88%e4%b8%80%ef%bc%89%20%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%20scroll"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjwvr2mbsmb%2f&title=vue.js%20%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%9f%b3%e4%b9%90app%ef%bc%88%e4%b8%80%ef%bc%89%20%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%20scroll"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjwvr2mbsmb%2f&title=vue.js%20%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%9f%b3%e4%b9%90app%ef%bc%88%e4%b8%80%ef%bc%89%20%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%20scroll"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjwvr2mbsmb%2f&title=vue.js%20%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%9f%b3%e4%b9%90app%ef%bc%88%e4%b8%80%ef%bc%89%20%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%20scroll"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">vue.js 移动端音乐app（一） 基础组件 scroll</h1><div class="meta"><div class="postdate"><time datetime="2018-12-25" itemprop="datePublished">2018-12-25</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e一、 基础实现\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e（1）功能\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22对 better-scroll 插件的基本封装，实现移动端的滚动\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs armasm\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e对 \x3cspan class=\x22hljs-keyword\x22\x3ebetter-scroll \x3c\/span\x3e插件的基本封装，实现移动端的滚动\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e（2）实现\x3c\/h3\x3e\n\x3ch4\x3e引入\x3c\/h4\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3ebetter-scroll\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3ch4\x3eprops\x3c\/h4\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3eprobeType: better-scroll 配置项之一\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22（1）取值：\n1 滚动的时候会派发 scroll 事件，会截流。\n2 滚动的时候实时派发 scroll 事件，不会截流。\n3 除了实时派发 scroll 事件，在 swipe 的情况下仍然能实时派发 scroll 事件。\n（2）默认值：1 \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e（\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e）取值：\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e 滚动的时候会派发 scroll 事件，会截流。\n\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e 滚动的时候实时派发 scroll 事件，不会截流。\n\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e 除了实时派发 scroll 事件，在 swipe 的情况下仍然能实时派发 scroll 事件。\n（\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e）默认值：\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eclick: 点击事件是否生效\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3erefreshDelay: refresh事件的延迟时间\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3elistenScroll: 是否监听滚动事件，如果监听滚动事件，则父组件应当给自定义事件‘onscroll’绑定监听函数\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3edata: 用于控制 scroll 刷新重新计算高度的数据\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e用于外部调用的方法\x3c\/h4\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eenable()\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3edisable()\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3erefresh()\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3escrollTo(x, y, time, [easing])\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22easing取值只能为 swipe\/swipeBounce\/bounce\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs awk\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3eeasing取值只能为 swipe\x3cspan class=\x22hljs-regexp\x22\x3e\/swipeBounce\/\x3c\/span\x3ebounce\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3escrollToElement(el, time, [offsetX], [offsetY], [easing])\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22offsetX，offsetY为number或true,true表示滚动到目标元素中心位置，数值则为设置滚动到目标元素的偏移量\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs applescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3eoffsetX，offsetY为\x3cspan class=\x22hljs-built_in\x22\x3enumber\x3c\/span\x3e或\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e表示滚动到目标元素中心位置，数值则为设置滚动到目标元素的偏移量\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e思想步骤\x3c\/h4\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e在 mounted 钩子中，在 $nextTick() 的回调中初始化 scroll 实例。\x3cbr\x3e因为 scroll 实例初始化的时候必须保证其挂载对象（wrapper）的 DOM 已经渲染完成，由于 wrapper 中的数据可能异步获取的，因此必须放在 $nextTick() 中，获取更新数据后的 DOM，进行高度计算\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ewatch父组件传入的数据 data\x3cbr\x3eDOM 上的数据发生了变化，要获取更新后的 DOM ，在操作函数中同样要在$nextTick（）的回调中进行 scroll 的刷新，refresh 重新计算高度。此处 setTimeout() 与 $nextTick() 作用相同。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch4\x3e代码\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ctemplate\x3e\n  \x3cdiv ref=\x26quot;wrapper\x26quot; @touchstart=\x26quot;onTouchstart\x26quot;\x3e\n    \x3cslot\x3e\n    \x3c\/slot\x3e\n  \x3c\/div\x3e\n\x3c\/template\x3e\n\n\x3cstyle scoped lang=\x26quot;stylus\x26quot; rel=\x26quot;stylesheet\/stylus\x26quot;\x3e\n\n\x3c\/style\x3e\n\n\x3cscript type=\x26quot;text\/ecmascript-6\x26quot;\x3e\n  import BetterScroll from \x27better-scroll\x27\n  export default {\n    name: \x27scroll\x27,\n    props: {\n      probeType: {\n        type: Number,\n        default: 1\n      },\n      click: {\n        type: Boolean,\n        default: true\n      },\n      data: {\n        type: Array,\n        default: null\n      },\n      refreshDelay: {\n        type: Number,\n        default: 20\n      },\n      listenScroll: {\n        type: Boolean,\n        default: false\n      },\n      listenScrollStart: {\n        type: Boolean,\n        default: false\n      },\n      listenScrollEnd: {\n        type: Boolean,\n        default: false\n      },\n      listenTouchStart: {\n        type: Boolean,\n        default: false\n      },\n      scrollX: {\n        type: Boolean,\n        default: true\n      },\n      scrollY: {\n        type: Boolean,\n        default: true\n      }\n    },\n    mounted () {\n      this.$nextTick(() =\x3e {\n        this._initScroll()\n      })\n    },\n    methods: {\n      _initScroll () {\n        if (!this.$refs.wrapper) {\n          return\n        }\n        this.scroll = new BetterScroll(this.$refs.wrapper, {\n          probeType: this.probeType,\n          click: this.click,\n          scrollX: this.scrollX,\n          scrollY: this.scrollY\n        })\n        if (this.listenScroll) {\n          let me = this\n          this.scroll.on(\x27scroll\x27, (pos) =\x3e {\n            me.$emit(\x27onscroll\x27, pos)\n          })\n        }\n        if (this.listenScrollEnd) {\n          let me = this\n          this.scroll.on(\x27scrollEnd\x27, (pos) =\x3e {\n            me.$emit(\x27onscrollEnd\x27, pos)\n          })\n        }\n        if (this.listenScrollStart) {\n          let me = this\n          this.scroll.on(\x27scrollStart\x27, (pos) =\x3e {\n            me.$emit(\x27onscrollStart\x27, pos)\n          })\n        }\n      },\n      \/\/ 存在自动滚动时（如歌词的自动播放）\n      \/\/ 需要监听根据对 touch 事件的监听判断 scroll 过程是自动播放触发的还是用户 touch 触发的\n      onTouchstart (e) {\n        if (!this.listenTouchStart) {\n          return\n        }\n        this.$emit(\x27ontouchStart\x27, e)\n      },\n      disable () {\n        this.scroll \x26amp;\x26amp; this.scroll.disable()\n      },\n      enable () {\n        this.scroll \x26amp;\x26amp; this.scroll.enable()\n      },\n      refresh () {\n        this.scroll \x26amp;\x26amp; this.scroll.refresh()\n      },\n      scrollTo () {\n        this.scroll \x26amp;\x26amp; this.scroll.scrollTo.apply(this.scroll, arguments)\n      },\n      scrollToElement () {\n        this.scroll \x26amp;\x26amp; this.scroll.scrollToElement.apply(this.scroll, arguments)\n      }\n    },\n    watch: {\n      data: {\n        handler (newValue, oldValue) {\n          setTimeout(() =\x3e {\n            this.refresh()\n          }, this.refreshDelay)\n        },\n        deep: true\n      }\n    }\n\n  }\n\x3c\/script\x3e\n\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e\x26lt;template\x26gt;\n  \x26lt;div ref=\x3cspan class=\x22hljs-string\x22\x3e\x22wrapper\x22\x3c\/span\x3e \x3cspan class=\x22hljs-meta\x22\x3e@touchstart\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onTouchstart\x22\x3c\/span\x3e\x26gt;\n    \x26lt;slot\x26gt;\n    \x26lt;\/slot\x26gt;\n  \x26lt;\/div\x26gt;\n\x26lt;\/template\x26gt;\n\n\x26lt;style scoped lang=\x3cspan class=\x22hljs-string\x22\x3e\x22stylus\x22\x3c\/span\x3e rel=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\/stylus\x22\x3c\/span\x3e\x26gt;\n\n\x26lt;\/style\x26gt;\n\n\x26lt;script type=\x3cspan class=\x22hljs-string\x22\x3e\x22text\/ecmascript-6\x22\x3c\/span\x3e\x26gt;\n  \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e BetterScroll from \x3cspan class=\x22hljs-string\x22\x3e\x27better-scroll\x27\x3c\/span\x3e\n  export \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n    name: \x3cspan class=\x22hljs-string\x22\x3e\x27scroll\x27\x3c\/span\x3e,\n    props: {\n      probeType: {\n        type: Number,\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n      },\n      click: {\n        type: \x3cspan class=\x22hljs-built_in\x22\x3eBoolean\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n      },\n      \x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e: {\n        type: Array,\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n      },\n      refreshDelay: {\n        type: Number,\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e\n      },\n      listenScroll: {\n        type: \x3cspan class=\x22hljs-built_in\x22\x3eBoolean\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n      },\n      listenScrollStart: {\n        type: \x3cspan class=\x22hljs-built_in\x22\x3eBoolean\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n      },\n      listenScrollEnd: {\n        type: \x3cspan class=\x22hljs-built_in\x22\x3eBoolean\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n      },\n      listenTouchStart: {\n        type: \x3cspan class=\x22hljs-built_in\x22\x3eBoolean\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n      },\n      scrollX: {\n        type: \x3cspan class=\x22hljs-built_in\x22\x3eBoolean\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n      },\n      scrollY: {\n        type: \x3cspan class=\x22hljs-built_in\x22\x3eBoolean\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n      }\n    },\n    mounted () {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$nextTick(() =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._initScroll()\n      })\n    },\n    methods: {\n      _initScroll () {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.wrapper) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll = new BetterScroll(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$refs.wrapper, {\n          probeType: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.probeType,\n          click: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.click,\n          scrollX: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scrollX,\n          scrollY: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scrollY\n        })\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listenScroll) {\n          let me = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.on(\x3cspan class=\x22hljs-string\x22\x3e\x27scroll\x27\x3c\/span\x3e, (pos) =\x26gt; {\n            me.$emit(\x3cspan class=\x22hljs-string\x22\x3e\x27onscroll\x27\x3c\/span\x3e, pos)\n          })\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listenScrollEnd) {\n          let me = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.on(\x3cspan class=\x22hljs-string\x22\x3e\x27scrollEnd\x27\x3c\/span\x3e, (pos) =\x26gt; {\n            me.$emit(\x3cspan class=\x22hljs-string\x22\x3e\x27onscrollEnd\x27\x3c\/span\x3e, pos)\n          })\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listenScrollStart) {\n          let me = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.on(\x3cspan class=\x22hljs-string\x22\x3e\x27scrollStart\x27\x3c\/span\x3e, (pos) =\x26gt; {\n            me.$emit(\x3cspan class=\x22hljs-string\x22\x3e\x27onscrollStart\x27\x3c\/span\x3e, pos)\n          })\n        }\n      },\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 存在自动滚动时（如歌词的自动播放）\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 需要监听根据对 touch 事件的监听判断 scroll 过程是自动播放触发的还是用户 touch 触发的\x3c\/span\x3e\n      onTouchstart (e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listenTouchStart) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$emit(\x3cspan class=\x22hljs-string\x22\x3e\x27ontouchStart\x27\x3c\/span\x3e, e)\n      },\n      disable () {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.disable()\n      },\n      enable () {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.enable()\n      },\n      refresh () {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.refresh()\n      },\n      scrollTo () {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.scrollTo.apply(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll, arguments)\n      },\n      scrollToElement () {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll.scrollToElement.apply(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scroll, arguments)\n      }\n    },\n    watch: {\n      \x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e: {\n        handler (newValue, oldValue) {\n          setTimeout(() =\x26gt; {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.refresh()\n          }, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.refreshDelay)\n        },\n        deep: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n      }\n    }\n\n  }\n\x26lt;\/script\x26gt;\n\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e二、问题归总\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e（1）与父组件交互问题\x3c\/h3\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e父组件中 scroll 下内容必须被包裹，不可出现如下结构。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 \x3cscroll\x3e\n    \x3cdiv\x3e\n      ...\n    \x3c\/div\x3e\n    \x3cdiv\x3e\n      ...\n    \x3c\/div\x3e\n\x3c\/scroll\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escroll\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      ...\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      ...\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escroll\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e父组件对 srcoll 组件方法的调用、dom 的操作\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscroll ref=\x26quot;scrollName\x26quot;\x3e ... \x3c\/scroll\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escroll\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22scrollName\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e ... \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escroll\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22调用 scroll 中的方法：this.$refs.scrollName.methodName()\n操作 dom（如改写style）: this.$refs.scrollName.$el.style \n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e调用 scroll 中的方法：this.\x3cspan class=\x22hljs-variable\x22\x3e$refs\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.scrollName\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.methodName\x3c\/span\x3e()\n操作 dom（如改写style）: this.\x3cspan class=\x22hljs-variable\x22\x3e$refs\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.scrollName\x3c\/span\x3e.\x3cspan class=\x22hljs-variable\x22\x3e$el\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.style\x3c\/span\x3e \n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e父组件引用 scroll 组件时 v-if 与 v-show 对其的影响\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22比如在 player.vue 组件中有如下结构。子组件 scroll 处在含有 v-show 属性来\n控制显示的元素中。\n\n1.v-if 与 v-show 的区别：v-if 会适当销毁和重建组件，且只有条件为真时才会进\n行渲染。v-show 则在整个父组件创建时就渲染，只是根据条件改写元素的 css 属性\n display 的值来控制显示与否。\n \n2.当 scroll 在 v-show 控制的元素中时，必须额外在显示条件为 true 时手动调用\n scroll.refresh() 刷新 scroll 重新计算其高度。\n \n3.当 scroll 在 v-if 控制的元素中时，则无须手动刷新，因为 scroll 组件会被重\n新创建，scroll 内部的 mounted 钩子的初始化及其对 data 的 watch 操作会自动\n准确更新高度，实现滚动。\n\n4.在 player.vue 中，由于全屏播放器和迷你播放器会被频繁切换，而初始化代价也\n并不是很大，所以使用 v-show 控制显示，另外 watch player.isFullpage 的值来\n手动刷新 scroll 即可。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gauss\x22\x3e\x3ccode\x3e比如在 player.vue 组件中有如下结构。子组件 \x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 处在含有 v-\x3cspan class=\x22hljs-keyword\x22\x3eshow\x3c\/span\x3e 属性来\n控制显示的元素中。\n\n\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3ev-\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e 与 v-\x3cspan class=\x22hljs-keyword\x22\x3eshow\x3c\/span\x3e 的区别：v-\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e 会适当销毁和重建组件，且只有条件为真时才会进\n行渲染。v-\x3cspan class=\x22hljs-keyword\x22\x3eshow\x3c\/span\x3e 则在整个父组件创建时就渲染，只是根据条件改写元素的 css 属性\n display 的值来控制显示与否。\n \n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e当 \x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 在 v-\x3cspan class=\x22hljs-keyword\x22\x3eshow\x3c\/span\x3e 控制的元素中时，必须额外在显示条件为 true 时手动调用\n \x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e.refresh() 刷新 \x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 重新计算其高度。\n \n\x3cspan class=\x22hljs-number\x22\x3e3.\x3c\/span\x3e当 \x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 在 v-\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e 控制的元素中时，则无须手动刷新，因为 \x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 组件会被重\n新创建，\x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 内部的 mounted 钩子的初始化及其对 data 的 watch 操作会自动\n准确更新高度，实现滚动。\n\n\x3cspan class=\x22hljs-number\x22\x3e4.\x3c\/span\x3e在 player.vue 中，由于全屏播放器和迷你播放器会被频繁切换，而初始化代价也\n并不是很大，所以使用 v-\x3cspan class=\x22hljs-keyword\x22\x3eshow\x3c\/span\x3e 控制显示，另外 watch player.isFullpage 的值来\n手动刷新 \x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 即可。\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 全屏显示的播放器\n \x3cdiv class=\x26quot;normal-player\x26quot; v-show=\x26quot;player.isFullpage\x26quot;\x3e\n    ...\n    \/\/ 歌词部分，可滚动\n    \/\/ lyricData是在组件mounted时后台获取的\n    \x3cscroll :data=\x26quot;lyricData\x26quot;\x3e\n        ...\n    \x3c\/scroll\x3e\n \x3c\/div\x3e\n\/\/ 迷你显示的播放器\n \x3cdiv class=\x26quot;mini-player\x26quot; v-show=\x26quot;!player.isFullpage\x26quot;\x3e\n    ...\n \x3c\/div\x3e\n\n\/\/ js 部分 watch 代码\n watch: {\n      \x27player.isFullpage\x27: function (newFlag) {\n        if (newFlag) {\n          this.$nextTick(() =\x3e {\n            this.$refs.lyricScroll.refresh()\n          })\n        },\n       ...\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 全屏显示的播放器\x3c\/span\x3e\n \x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e class=\x3cspan class=\x22hljs-string\x22\x3e\x22normal-player\x22\x3c\/span\x3e v-show=\x3cspan class=\x22hljs-string\x22\x3e\x22player.isFullpage\x22\x3c\/span\x3e\x26gt;\n    ...\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 歌词部分，可滚动\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ lyricData是在组件mounted时后台获取的\x3c\/span\x3e\n    \x26lt;scroll :data=\x3cspan class=\x22hljs-string\x22\x3e\x22lyricData\x22\x3c\/span\x3e\x26gt;\n        ...\n    \x26lt;\/scroll\x26gt;\n \x26lt;\/div\x26gt;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 迷你显示的播放器\x3c\/span\x3e\n \x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3ediv\x3c\/span\x3e class=\x3cspan class=\x22hljs-string\x22\x3e\x22mini-player\x22\x3c\/span\x3e v-show=\x3cspan class=\x22hljs-string\x22\x3e\x22!player.isFullpage\x22\x3c\/span\x3e\x26gt;\n    ...\n \x26lt;\/div\x26gt;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ js 部分 watch 代码\x3c\/span\x3e\n watch: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x27player.isFullpage\x27\x3c\/span\x3e: function (newFlag) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (newFlag) {\n          this.\x3cspan class=\x22hljs-variable\x22\x3e$nextTick\x3c\/span\x3e(() =\x26gt; {\n            this.\x3cspan class=\x22hljs-variable\x22\x3e$refs\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.lyricScroll\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.refresh\x3c\/span\x3e()\n          })\n        },\n       ...\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e-父组件与 scroll 组件之间 touch 系列事件同时触发的问题\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22如在 player.vue 中，音乐播放器 CD 页面和歌词页是左右滑动切换显示的，封装成\n了 fade-slider 组件来控制页面切换，在 fade-slider 中监听 touch 系列事件来\n控制左右滑动，而scroll 组件在歌词页面中使用，监听 onscroll 事件控制歌词滑动\n上下切换，scroll 与 fade-slier 是父子关系，因此直接绑定事件时，冒泡过程中\n二者的 touch 系列事件会同时被触发。为了实现需求，即页面左右滑动时 scroll 禁\n止滚动，scroll 上下滚动时 fade-slider 也不要左右切换，必须做相应的处理。如\n下代码：\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gauss\x22\x3e\x3ccode\x3e如在 player.vue 中，音乐播放器 CD 页面和歌词页是左右滑动切换显示的，封装成\n了 fade-slider 组件来控制页面切换，在 fade-slider 中监听 touch 系列事件来\n控制左右滑动，而\x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 组件在歌词页面中使用，监听 onscroll 事件控制歌词滑动\n上下切换，\x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 与 fade-slier 是父子关系，因此直接绑定事件时，冒泡过程中\n二者的 touch 系列事件会同时被触发。为了实现需求，即页面左右滑动时 \x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 禁\n止滚动，\x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 上下滚动时 fade-slider 也不要左右切换，必须做相应的处理。如\n下代码：\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ player.vue 组件片段\n  \x3cfade-slider\x3e\n    \x3cdiv class=\x26quot;slider-item\x26quot;\x3e\n     ...\n    \x3c\/div\x3e\n    \x3cdiv class=\x26quot;slider-item\x26quot;\x3e\n       ...\n       \/\/ 监听 scroll 的滚动事件，此处主要是上下滚动\n        \x3cscroll @onscroll=\x26quot;onLyricScroll\x26quot;\x3e\n          ...\n        \x3c\/scroll\x3e\n    \x3c\/div\x3e\n  \x3c\/fade-slider\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\/\/ player.vue 组件片段\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3efade-slider\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22slider-item\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n     ...\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22slider-item\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n       ...\n       \/\/ 监听 scroll 的滚动事件，此处主要是上下滚动\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escroll\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3eonscroll\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onLyricScroll\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          ...\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escroll\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3efade-slider\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ fade-slider 组件的 template 部分\n\x3ctemplate\x3e\n  \x3cdiv class=\x26quot;slider\x26quot; ref=\x26quot;slider\x26quot;\x3e\n    \x3cdiv @touchstart.capture=\x26quot;onTouchStart\x26quot;\n         @touchmove.capture=\x26quot;onTouchMove\x26quot;\n         @touchend=\x26quot;onTouchEnd\x26quot;\x3e\n      \x3cslot\x3e\n      \x3c\/slot\x3e\n    \x3c\/div\x3e\n     ...\n  \x3c\/div\x3e\n\x3c\/template\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\/\/ fade-slider 组件的 template 部分\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22slider\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22slider\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e @\x3cspan class=\x22hljs-attr\x22\x3etouchstart.capture\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onTouchStart\x22\x3c\/span\x3e\n         @\x3cspan class=\x22hljs-attr\x22\x3etouchmove.capture\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onTouchMove\x22\x3c\/span\x3e\n         @\x3cspan class=\x22hljs-attr\x22\x3etouchend\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22onTouchEnd\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eslot\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eslot\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n     ...\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221.要在歌词页面上下滑动歌词时，即在 scroll 上下滚动时，使歌词页面\n（fade-slider组件的中一个页面）不要左右滑动，很简单，在 fade-slider 的\n touch 系列事件中对 touch 的位置和方向进行判断即可。\n\n2.反过来，要在 fade-slider 控制歌词页面左右滑动时，使歌词页面中的 scroll \n不要上下滑动，因为它是封装出来的 onscroll 事件，不能直接对 touch 的位置和方\n向进行判断，而另外去监听它的 touch 系列事件虽然也可以处理问题，但显然不合\n适，不仅逻辑重复，而且组件与 DOM 的耦合性也过高，不合适。\n\n3.因而，当前问题就是要在父组件的 touch 过程中，满足一定条件时去阻止子组件\n的 scroll 事件的触发，显然在冒泡过程中难以做到，因此解决方案：\n\n（1）fade-slider组件（父组件）中捕获绑定 touch 系列事件：如 @touchstart.capture=\x26quot;onTouchStart\x26quot;\n（2）在 touch 系列事件处理过程中，控制当确定是左右滑动行为时，阻止 touch 系\n列事件的传播：e.stopPropagation()，这样，scroll 中的滚动就不会被触发。\n\n4.因此，总的逻辑就是：\n\n（1）touch 系列事件第一时间由父组件捕获，进行 touch 行为的判断\n（2）如果是左右滑动，则切换页面，同时阻止 touch 事件的进一步传递\n（3）如果是上下滑动，则不做处理，使子组件的 touch 系列事件（scroll的内部）被触发，进行处理。\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e要在歌词页面上下滑动歌词时，即在 scroll 上下滚动时，使歌词页面\n（fade-slider组件的中一个页面）不要左右滑动，很简单，在 fade-slider 的\n \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 系列事件中对 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 的位置和方向进行判断即可。\n\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e反过来，要在 fade-slider 控制歌词页面左右滑动时，使歌词页面中的 scroll \n不要上下滑动，因为它是封装出来的 onscroll 事件，不能直接对 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 的位置和方\n向进行判断，而另外去监听它的 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 系列事件虽然也可以处理问题，但显然不合\n适，不仅逻辑重复，而且组件与 DOM 的耦合性也过高，不合适。\n\n\x3cspan class=\x22hljs-number\x22\x3e3.\x3c\/span\x3e因而，当前问题就是要在父组件的 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 过程中，满足一定条件时去阻止子组件\n的 scroll 事件的触发，显然在冒泡过程中难以做到，因此解决方案：\n\n（\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e）fade-slider组件（父组件）中捕获绑定 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 系列事件：如 @touchstart.capture=\x3cspan class=\x22hljs-string\x22\x3e\x22onTouchStart\x22\x3c\/span\x3e\n（\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e）在 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 系列事件处理过程中，控制当确定是左右滑动行为时，阻止 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 系\n列事件的传播：e.stopPropagation()，这样，scroll 中的滚动就不会被触发。\n\n\x3cspan class=\x22hljs-number\x22\x3e4.\x3c\/span\x3e因此，总的逻辑就是：\n\n（\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e）\x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 系列事件第一时间由父组件捕获，进行 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 行为的判断\n（\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e）如果是左右滑动，则切换页面，同时阻止 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 事件的进一步传递\n（\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e）如果是上下滑动，则不做处理，使子组件的 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 系列事件（scroll的内部）被触发，进行处理。\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e（2）自动滚动过程中 touch 相关问题\x3c\/h3\x3e\n\x3ch4\x3e需求分析\x3c\/h4\x3e\n\x3cp\x3e如下图：在歌词页面中，歌词即使用 scroll 组件，在音乐播放过程中，歌词会自动播放，即根据当前音乐所对应的歌词，来 scrollToElement ,而在此过程中，仍然接受 touch 行为，当由 touch 引起滚动时，暂停歌词的自动播放，并显示歌词控制条，同时根据滚动的距离高亮对应的歌词。歌词控制条分两部分：左侧显示当前滚动到的歌词对应的音乐的时间，右侧显示播放按钮，点击则直接播放此刻的音乐，歌词也随之重新定位\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e图1：自动播放滚动时歌词控制条不显示，且高亮的歌词是当前音乐的进度对应的歌词\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e图2：touch 引起滚动时，歌词暂停播放（音乐播放状依旧不变），歌词控制条显示，当前高亮歌词由当前滚动到的位置决定\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012055507?w=412\x26amp;h=731\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012055507?w=412\x26amp;h=731\x22 alt=\x22vue-music\x22 title=\x22vue-music\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012055508?w=413\x26amp;h=735\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012055508?w=413\x26amp;h=735\x22 alt=\x22vue-music\x22 title=\x22vue-music\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3e问题分析\x3c\/h4\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e首先在滚动过程中高亮的歌词以及歌词控制条上显示的对应的时间，显然是要通过 onscroll 判断，所以问题就在于如何在滚动过程中合理有效的区分是自动播放的滚动还是 touch 引起的滚动。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e在确认是 touch 行为引起 scroll 滚动的前提下，大致要有三个阶段，做不同的事情\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22（1）scrollStart阶段：显示歌词控制条，停止歌词的自动滚动\n（2）onScroll阶段：不断根据当前滚动的偏移量更新高亮的歌词，以及对应的时间\n（3）scrollEnd阶段：滚动结束后，设置一定时间（如 1s）后，隐藏歌词控制条，恢复之前的播放状态\n（4）在以上阶段的任何时刻，一旦歌词控制条上的播放按钮被点击，都立即隐藏歌词控制条，并更新播放状态\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e（\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e）scrollStart阶段：显示歌词控制条，停止歌词的自动滚动\n（\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e）onScroll阶段：不断根据当前滚动的偏移量更新高亮的歌词，以及对应的时间\n（\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e）scrollEnd阶段：滚动结束后，设置一定时间（如 \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3es）后，隐藏歌词控制条，恢复之前的播放状态\n（\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e）在以上阶段的任何时刻，一旦歌词控制条上的播放按钮被点击，都立即隐藏歌词控制条，并更新播放状态\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e总的来说，核心内容涉及到 touchStart、scrollStart、onScroll、scrollEnd四个事件，重点是这些事件的触发顺序，以及滚动惯性的问题\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch4\x3e问题解决\x3c\/h4\x3e\n\x3cp\x3e\x3cstrong\x3e（一） 初步实现\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22（1）scroll 组件中已经绑定了并注册了 ontouchStart,onscrollStart,onscroll,onscrollEnd事件（代码见第一章），\n在父组件中直接传入相应值并监听事件即可\n（2）设置 touch标志，用来区分是否是自动滚动。在 touchStart 中\n置其为 true，在 scrollEnd 置其为 false。之所以用 scrollEnd 作为结束时机而\n不用 touchEnd 也是由于滚动惯性\n（3）因此，自动滚动和 touch 滚动的处理流程分别如下图：   \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e（\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e）scroll 组件中已经绑定了并注册了 ontouchStart,onscrollStart,onscroll,onscrollEnd事件（代码见第一章），\n在父组件中直接传入相应值并监听事件即可\n（\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e）设置 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e标志，用来区分是否是自动滚动。在 touchStart 中\n置其为 true，在 scrollEnd 置其为 false。之所以用 scrollEnd 作为结束时机而\n不用 touchEnd 也是由于滚动惯性\n（\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e）因此，自动滚动和 \x3cspan class=\x22hljs-section\x22\x3etouch\x3c\/span\x3e 滚动的处理流程分别如下图：   \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012055509?w=2900\x26amp;h=2742\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012055509?w=2900\x26amp;h=2742\x22 alt=\x22vue-music\x22 title=\x22vue-music\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e（二） 惯性过程中 touch 引起的 bug 修复\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    初步实现中的流程基本已经可以实现需求，touch 的标志已经可以控制区分自动\n滚动和touch 滚动，但是会发现如果在 scroll 的惯性滚动中，再次 touch 屏幕，\n则惯性滚动会停止，但 scroll 系列事件会不再起作用，高亮的歌词与此时 touch 的\n位置也不对应，即在其系列事件中 touch 的标志被置为 false 了，而这显然不是我\n们想要的。\n    touch 的标志之所以被置为了 false，是由 scrollEnd 的触发导致的。在惯性\n滚动过程中，touch 屏幕则会阻止惯性滚动，这是很明显的现象，据此想一想，肯定是 \ntouch 导致了 scrollEnd 的提前触发。即如下图：\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs irpf90\x22\x3e\x3ccode\x3e    初步实现中的流程基本已经可以实现需求，\x3cspan class=\x22hljs-keyword\x22\x3etouch\x3c\/span\x3e 的标志已经可以控制区分自动\n滚动和\x3cspan class=\x22hljs-keyword\x22\x3etouch\x3c\/span\x3e 滚动，但是会发现如果在 scroll 的惯性滚动中，再次 \x3cspan class=\x22hljs-keyword\x22\x3etouch\x3c\/span\x3e 屏幕，\n则惯性滚动会停止，但 scroll 系列事件会不再起作用，高亮的歌词与此时 \x3cspan class=\x22hljs-keyword\x22\x3etouch\x3c\/span\x3e 的\n位置也不对应，即在其系列事件中 \x3cspan class=\x22hljs-keyword\x22\x3etouch\x3c\/span\x3e 的标志被置为 false 了，而这显然不是我\n们想要的。\n    \x3cspan class=\x22hljs-keyword\x22\x3etouch\x3c\/span\x3e 的标志之所以被置为了 false，是由 scrollEnd 的触发导致的。在惯性\n滚动过程中，\x3cspan class=\x22hljs-keyword\x22\x3etouch\x3c\/span\x3e 屏幕则会阻止惯性滚动，这是很明显的现象，据此想一想，肯定是 \n\x3cspan class=\x22hljs-keyword\x22\x3etouch\x3c\/span\x3e 导致了 scrollEnd 的提前触发。即如下图：\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012055510?w=4046\x26amp;h=2580\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012055510?w=4046\x26amp;h=2580\x22 alt=\x22vue-music\x22 title=\x22vue-music\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22因此，除了 touch 标志之外，还需一个 end 标志来确定 scroll 系列流程是否被 touch 行为提前打断。\n1. 在 touchStart 中置 end 标志为 true\n2. 在 scrollStart 中置 end 标志为 false\n3. 在 scrollEnd 中置 end 标志为 true\n4. 在 scrollEnd 中增加判断，如果 end 标志为 true，则不置 touch 标志为 false\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sql\x22\x3e\x3ccode\x3e因此，除了 touch 标志之外，还需一个 \x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e 标志来确定 \x3cspan class=\x22hljs-keyword\x22\x3escroll\x3c\/span\x3e 系列流程是否被 touch 行为提前打断。\n\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e 在 touchStart 中置 \x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e 标志为 \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e 在 scrollStart 中置 \x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e 标志为 \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e3.\x3c\/span\x3e 在 scrollEnd 中置 \x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e 标志为 \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e4.\x3c\/span\x3e 在 scrollEnd 中增加判断，如果 \x3cspan class=\x22hljs-keyword\x22\x3eend\x3c\/span\x3e 标志为 \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e，则不置 touch 标志为 \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012055511\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012055511\x22 alt=\x22vue-music\x22 title=\x22vue-music\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e（三） touchStart、scrollStart、onscroll、scrollEnd 在 scroll 组件中注册的区别\x3c\/strong\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3escrollStart、onscroll、scrollEnd 均是 better-scroll 中注册的事件，使用时在 better-scroll 对象（new BetterScroll（））上 .on（事件名，处理函数） 监听即可\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3etouchStart 是原生事件，在 scroll 组件中绑定在最外层元素上\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e三、完整项目地址\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3eGithub: \x3ca href=\x22https:\/\/github.com\/aphasic\/music-player.git\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/aphasic\/mu...\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>vue.js 移动端音乐app（一） 基础组件 scroll</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012013686">https://segmentfault.com/a/1190000012013686</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/jwvr2mbsmb/" target="_blank">https://alili.tech/archive/jwvr2mbsmb/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>