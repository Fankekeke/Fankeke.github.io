<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="用imgproxy自动缩放图片"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>用imgproxy自动缩放图片 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/kmizakochtb/",
				"appid": "1613049289050283", 
				"title": "用imgproxy自动缩放图片 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-27T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/fwek3ik8slk/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/nuae8gc8ve/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fkmizakochtb%2f&text=%e7%94%a8imgproxy%e8%87%aa%e5%8a%a8%e7%bc%a9%e6%94%be%e5%9b%be%e7%89%87"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fkmizakochtb%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fkmizakochtb%2f&text=%e7%94%a8imgproxy%e8%87%aa%e5%8a%a8%e7%bc%a9%e6%94%be%e5%9b%be%e7%89%87"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fkmizakochtb%2f&title=%e7%94%a8imgproxy%e8%87%aa%e5%8a%a8%e7%bc%a9%e6%94%be%e5%9b%be%e7%89%87"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fkmizakochtb%2f&is_video=false&description=%e7%94%a8imgproxy%e8%87%aa%e5%8a%a8%e7%bc%a9%e6%94%be%e5%9b%be%e7%89%87"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%94%a8imgproxy%e8%87%aa%e5%8a%a8%e7%bc%a9%e6%94%be%e5%9b%be%e7%89%87&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fkmizakochtb%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fkmizakochtb%2f&title=%e7%94%a8imgproxy%e8%87%aa%e5%8a%a8%e7%bc%a9%e6%94%be%e5%9b%be%e7%89%87"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fkmizakochtb%2f&title=%e7%94%a8imgproxy%e8%87%aa%e5%8a%a8%e7%bc%a9%e6%94%be%e5%9b%be%e7%89%87"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fkmizakochtb%2f&title=%e7%94%a8imgproxy%e8%87%aa%e5%8a%a8%e7%bc%a9%e6%94%be%e5%9b%be%e7%89%87"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fkmizakochtb%2f&title=%e7%94%a8imgproxy%e8%87%aa%e5%8a%a8%e7%bc%a9%e6%94%be%e5%9b%be%e7%89%87"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">用imgproxy自动缩放图片</h1><div class="meta"><div class="postdate"><time datetime="2018-12-27" itemprop="datePublished">2018-12-27</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e无图，纯干货，信息量较大，慎入！\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e最近几天的成果，浓缩下来就是这么一行代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22document.getElementById(\x27img1\x27).src = \x27http:\/\/www.mysite.com\/imgproxy\x27 \x2b imgproxy(document.getElementById(\x26quot;img1\x26quot;).getAttribute(\x27data-src\x27), 135, 85);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27img1\x27\x3c\/span\x3e).src = \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/www.mysite.com\/imgproxy\x27\x3c\/span\x3e \x2b imgproxy(\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22img1\x22\x3c\/span\x3e).getAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x27data-src\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-number\x22\x3e135\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e85\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3e寻找合适的图床\x3c\/h1\x3e\n\x3cp\x3e最初的时候只是看\x3ca href=\x22https:\/\/www.fengerzh.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e我的个人博客\x3c\/a\x3e图片大小高低不一，比较难看，试图找一种方法能够统一各图片的高度。在网上搜索的结果是，发现了几个\x3ccode\x3eJykell\x3c\/code\x3e的插件，例如\x3ca href=\x22https:\/\/github.com\/robwierzbowski\/jekyll-picture-tag\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ejekyll-picture-tag\x3c\/a\x3e，通过这个过程学到了不少东西，比如img标签除了有srcset以外，还有一个额外的Picture标签等等。本来想用这个插件，但另外一个插件\x3ca href=\x22https:\/\/github.com\/nhoizey\/jekyll-cloudinary\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ejekyll-cloudinary\x3c\/a\x3e的作者说Picture标签并不好，应该直接使用\x3ca href=\x22https:\/\/cloudinary.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCloudinary\x3c\/a\x3e的服务。\x3c\/p\x3e\n\x3cp\x3e由此而想起在我\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000011661518\x22\x3e上一篇文章\x3c\/a\x3e中提到过的\x3ca href=\x22http:\/\/www.jianshu.com\/p\/05289a4bc8b2\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e一篇教程\x3c\/a\x3e中谈到过的用国内的\x3ca href=\x22https:\/\/www.qiniu.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e七牛云\x3c\/a\x3e做图床，于是开始尝试把我网站文章中用到的图片往七牛云搬家，图片搬家不是问题，但又想在博客网站上增加https服务，于是在问过我的朋友\x3ca href=\x22http:\/\/mazhuang.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e马壮\x3c\/a\x3e之后，在\x3ca href=\x22https:\/\/www.cloudflare.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCloudflare\x3c\/a\x3e上开通了https服务，但这又造成另外一个问题：七牛云上虽然放了我的图片，但是七牛云本身不支持https服务，于是又得想办法把图片搬到Cloudinary。\x3c\/p\x3e\n\x3cp\x3e至此我个人的博客算是可以告一段落。平心而论，\x3ccode\x3e七牛云\x3c\/code\x3e的预置功能还是很不错的，至少它对于\x3ccode\x3eURL\x3c\/code\x3e的处理方式比\x3ccode\x3eCloudinary\x3c\/code\x3e要简单，但唯一的遗憾是它不支持\x3ccode\x3ehttps\x3c\/code\x3e。而如果图片不支持\x3ccode\x3ehttps\x3c\/code\x3e而网站使用\x3ccode\x3ehttps\x3c\/code\x3e的话，\x3ccode\x3eChrome\x3c\/code\x3e会在\x3ccode\x3eConsole\x3c\/code\x3e里报警告错误，而我对网站的要求是：一个警告都不能有。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3eURL自动调整图片\x3c\/h1\x3e\n\x3cp\x3e在此过程中，我开始思考一个问题：既然\x3ccode\x3eCloudinary\x3c\/code\x3e和\x3ccode\x3e七牛云\x3c\/code\x3e都提供基于\x3ccode\x3eURL\x3c\/code\x3e地址的图片变换，那么它们是怎么做到的呢？根据我对\x3ccode\x3ePHP\x3c\/code\x3e的粗浅了解，最笨的方法可以直接以\x3ccode\x3ePHP\x3c\/code\x3e读文件的方式从硬盘先读取图片的源文件，然后经转换后再以流的方式输出给页面，但这样效率肯定极低。于是经过搜索后发现了很多人推荐的\x3ca href=\x22https:\/\/github.com\/jcupitt\/libvips\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3elibvips\x3c\/a\x3e库，再进一步搜索，在\x3ccode\x3eGithub\x3c\/code\x3e上发现了有很多颗星的\x3ca href=\x22https:\/\/github.com\/DarthSim\/imgproxy\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eimgproxy\x3c\/a\x3e这个库，似乎这就是我想要的东西。\x3c\/p\x3e\n\x3cp\x3e于是我开始尝试动手往公司的服务器上部署\x3ccode\x3eimgproxy\x3c\/code\x3e。但这时候遇到一个问题，在\x3ccode\x3eCentOS\x3c\/code\x3e上，\x3ccode\x3eimgproxy\x3c\/code\x3e并没有\x3ccode\x3eyum\x3c\/code\x3e安装包，还需要先手工安装\x3ccode\x3elibvips\x3c\/code\x3e，然后再编译，而最要命的是，公司的服务器在国内，无法通过\x3ccode\x3ewget\x3c\/code\x3e的方式直接安装国外的软件包，由此而我需要先把安装包下载到本地，然后再上传到公司的服务器上。这时候我又想取个巧，\x3ca href=\x22http:\/\/jk2k.com\/2016\/03\/iTerm2-enable-shell-integration-to-support-file-uploads-and-downloads\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e使用iterm内置的scp用鼠标拖拽的方式上传文件\x3c\/a\x3e。按照操作步骤的说明，安装好了之后却发现\x3ccode\x3eiterm\x3c\/code\x3e的\x3ccode\x3escp\x3c\/code\x3e按钮依然是灰色的，这时才发现是由于服务器上的\x3ccode\x3efish\x3c\/code\x3e版本过低，只有\x3ccode\x3e1.3\x3c\/code\x3e，而最新的已经是\x3ccode\x3e2.6\x3c\/code\x3e了。于是\x3ca href=\x22http:\/\/fishshell.com\/files\/2.1.0\/linux\/index.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e安装2.6的repo\x3c\/a\x3e，尝试更新\x3ccode\x3efish\x3c\/code\x3e，却总是报冲突。由此而想到将\x3ccode\x3efish 1.3\x3c\/code\x3e先卸载，就在这时灾难发生了。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e灾难\x3c\/h1\x3e\n\x3cp\x3e我直接执行了\x3ccode\x3eyum remove fish\x3c\/code\x3e，但是在做这一步之前，我没有将\x3ccode\x3eroot\x3c\/code\x3e用户的\x3ccode\x3eshell\x3c\/code\x3e切换回\x3ccode\x3ebash\x3c\/code\x3e，由此而导致了\x3ccode\x3eroot\x3c\/code\x3e用户找不到它的\x3ccode\x3eshell\x3c\/code\x3e，因为它还在试图寻找\x3ccode\x3efish\x3c\/code\x3e。这是一个致命的错误，我记得自己当时隐隐约约有预感，但还是没有特别在意，觉得也许\x3ccode\x3eLinux\x3c\/code\x3e系统会自动为\x3ccode\x3eroot\x3c\/code\x3e用户赋予一个缺省的\x3ccode\x3eshell\x3c\/code\x3e。结果我高估了\x3ccode\x3eLinux\x3c\/code\x3e系统的能力。\x3c\/p\x3e\n\x3cp\x3e退出登录之后，我发现\x3ccode\x3eroot\x3c\/code\x3e用户登录不上了！如果不仔细观察的话，你会感觉它的不能登录的症状和密码错误非常类似，但实际表现其实略有不同，在\x3ccode\x3eSSH\x3c\/code\x3e端是不大看得出来的。我的第一反应是，如果\x3ccode\x3eroot\x3c\/code\x3e用户无法通过\x3ccode\x3eSSH\x3c\/code\x3e登录了，那么应该通过\x3ccode\x3econsole\x3c\/code\x3e端登录。\x3c\/p\x3e\n\x3cp\x3e但当天下午，令人惊讶的是连\x3ccode\x3econsole\x3c\/code\x3e端也登不上了！这时候我意识到问题严重了。在网上搜索的结果是有人说\x3ca href=\x22https:\/\/www.linuxquestions.org\/questions\/linux-virtualization-and-cloud-90\/not-able-to-login-centos-6-5-because-of-login-in-loop-problem-4175520133\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e应该以runlevel 1的方式登录\x3c\/a\x3e，然后尝试修复\x3ccode\x3e\/etc\/shadow\x3c\/code\x3e。但我完全不了解对于一台云主机应该如何进入\x3ccode\x3erunlevel 1\x3c\/code\x3e。只好提工单给客服。而客服的技术水平大家应该是知道的，只是建议我重置密码之后再尝试一下。而重置密码必须要关机再重启，就这样来回折腾了很久也修不好。\x3c\/p\x3e\n\x3cp\x3e在经过了漫长的等待之后，终于惊动了一个技术人员。他指出如果我必须要进\x3ccode\x3erunlevel 1\x3c\/code\x3e的话，可以在系统开机的前3秒之间按下键盘的e键，然后就可以进入\x3ccode\x3erunlevel 1\x3c\/code\x3e了。\x3c\/p\x3e\n\x3cp\x3e但问题是这是一台云主机，如何能在开机前3秒按键呢？好在现在云主机的\x3ccode\x3econsole\x3c\/code\x3e功能非常发达，你可以开着\x3ccode\x3econsole\x3c\/code\x3e重启，这时候网络断掉，然后不停地刷新\x3ccode\x3econsole\x3c\/code\x3e，你会在电脑开机的一瞬间看到一个有字的黑画面，这时候迅速按下\x3ccode\x3ee\x3c\/code\x3e键也能进入系统。然后再次按下\x3ccode\x3ee\x3c\/code\x3e，把启动模式修改为\x3ccode\x3eLinux single\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e按照他的指导，我终于能够以\x3ccode\x3erunlevel 1\x3c\/code\x3e的方式进入了系统，首先尝试用\x3ccode\x3e\/etc\/passwd\x3c\/code\x3e重建\x3ccode\x3e\/etc\/shadow\x3c\/code\x3e，再次重启，无果，还是登录不进去。至此为止，所有关于密码的努力均告失败。我想，唯一的办法只能尝试看能不能切换\x3ccode\x3eroot\x3c\/code\x3e用户的\x3ccode\x3eshell\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22chsh -s \/bin\/bash\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs awk\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3echsh -s \x3cspan class=\x22hljs-regexp\x22\x3e\/bin\/\x3c\/span\x3ebash\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e把\x3ccode\x3eroot\x3c\/code\x3e用户的\x3ccode\x3eshell\x3c\/code\x3e切换成\x3ccode\x3ebash\x3c\/code\x3e之后，再次重启电脑，果然可以成功登录了！\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3e修复\x3c\/h1\x3e\n\x3cp\x3e接下来，我还是需要安装\x3ccode\x3efish\x3c\/code\x3e，但\x3ccode\x3eyum install fish\x3c\/code\x3e结果\x3ccode\x3efish\x3c\/code\x3e还是\x3ccode\x3e1.3\x3c\/code\x3e。我还要继续上次不成功的征程。再次把\x3ccode\x3efish\x3c\/code\x3e从\x3ccode\x3e1.3\x3c\/code\x3e换成\x3ccode\x3e2.6\x3c\/code\x3e。依然冲突。这次我学精了，我先把\x3ccode\x3eroot\x3c\/code\x3e的\x3ccode\x3eshell\x3c\/code\x3e脚本切换成\x3ccode\x3ebash\x3c\/code\x3e，然后\x3ccode\x3eyum remove fish\x3c\/code\x3e，再次安装，发现这个\x3ccode\x3efish 1.3\x3c\/code\x3e的来源是一个不知什么时候装上的名叫\x3ccode\x3edag\x3c\/code\x3e的\x3ccode\x3erepo\x3c\/code\x3e，于是尝试把这个\x3ccode\x3edag\x3c\/code\x3e的\x3ccode\x3erepo\x3c\/code\x3e禁止掉：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22yum-config-manager --disable dag\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lua\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3eyum-\x3cspan class=\x22hljs-built_in\x22\x3econfig\x3c\/span\x3e-manager \x3cspan class=\x22hljs-comment\x22\x3e--disable dag\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后再次安装，终于装上了\x3ccode\x3efish 2.6\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e至此，基本所有阻塞性因素都消除了，我开始将\x3ccode\x3elibvips\x3c\/code\x3e的代码拖拽进服务器，然后编译。但这时候问题又来了，\x3ccode\x3eimgproxy\x3c\/code\x3e必须运行在\x3ccode\x3edocker\x3c\/code\x3e里，而说明文档上只说需要自己\x3ccode\x3ebuild\x3c\/code\x3e一个\x3ccode\x3edocker\x3c\/code\x3e，但并没有指明以什么操作系统为基础去\x3ccode\x3ebuild\x3c\/code\x3e，好在官方提供了一个它们自己的\x3ccode\x3edocker\x3c\/code\x3e文件，可以直接运行\x3ccode\x3eimgproxy\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e啊！早知如此，我何必折腾这么一大圈？还差点毁掉了我的系统。不过好在学到了不少东西。好吧，于是我们开始直接安装使用\x3ccode\x3eimgproxy\x3c\/code\x3e官方提供的\x3ccode\x3edocker\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ docker pull darthsim\/imgproxy:latest\n$ docker run -e IMGPROXY_KEY=$YOUR_KEY -e IMGPROXY_SALT=$YOUR_SALT -p 8080:8080 -t darthsim\/imgproxy\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dockerfile\x22\x3e\x3ccode\x3e$ docker pull darthsim\/imgproxy:latest\n$ docker \x3cspan class=\x22hljs-keyword\x22\x3erun\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e \x3cspan class=\x22hljs-_\x22\x3e-e\x3c\/span\x3e IMGPROXY_KEY=\x3cspan class=\x22hljs-variable\x22\x3e$YOUR_KEY\x3c\/span\x3e \x3cspan class=\x22hljs-_\x22\x3e-e\x3c\/span\x3e IMGPROXY_SALT=\x3cspan class=\x22hljs-variable\x22\x3e$YOUR_SALT\x3c\/span\x3e -p 8080:8080 -t darthsim\/imgproxy\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但是这个\x3ccode\x3eimgproxy\x3c\/code\x3e的使用方式又是非常的不友好，它完全不像\x3ccode\x3e七牛云\x3c\/code\x3e或者\x3ccode\x3eCloudinary\x3c\/code\x3e那样直接在\x3ccode\x3eURL\x3c\/code\x3e地址上构建就行了，它需要自己根据自己的\x3ccode\x3ekey\x3c\/code\x3e和\x3ccode\x3esalt\x3c\/code\x3e产生签名，然后再用签名构建\x3ccode\x3eURL\x3c\/code\x3e，它给了\x3ca href=\x22https:\/\/github.com\/DarthSim\/imgproxy\/tree\/master\/examples\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e各种语言的例子\x3c\/a\x3e，唯独没有\x3ccode\x3ejava\x3c\/code\x3e的，最后我只好根据它自己的\x3ccode\x3ejavascript\x3c\/code\x3e语言的例子构建一个\x3ccode\x3ejs\x3c\/code\x3e代码，用于替换页面中的图片链接。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader4\x22\x3e编程\x3c\/h1\x3e\n\x3cp\x3e但问题又来了，它给定的这个包是一个\x3ccode\x3enode\x3c\/code\x3e的\x3ccode\x3ejs\x3c\/code\x3e脚本，里面有\x3ccode\x3erequire\x3c\/code\x3e语句，无法直接用于浏览器。这时候又得请出\x3ccode\x3ebrowerify\x3c\/code\x3e，用它来编译\x3ccode\x3enode\x3c\/code\x3e的脚本为可以供浏览器直接使用的脚本。好在过程并不复杂，编译之后得到的\x3ccode\x3ebundle.js\x3c\/code\x3e文件，我们直接在页面中引用就行了。于是就得到了本文开头的一行代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n\x3chead\x3e\n\x3c\/head\x3e\n\x3cbody\x3e\n  \x3cimg id=\x26quot;img1\x26quot; data-src=\x26quot;http:\/\/www.mysite.com\/img\/somepic.png\x26quot; src=\x26quot;\x26quot; \/\x3e\n  \x3cscript src=\x26quot;bundle.js\x26quot;\x3e\x3c\/script\x3e\n  \x3cscript\x3e\n    window.onload = function() {\n      document.getElementById(\x27img1\x27).src = \x27http:\/\/www.mysite.com\/imgproxy\x27 \x2b imgproxy(document.getElementById(\x26quot;img1\x26quot;).getAttribute(\x27data-src\x27), 135, 85);\n    }\n  \x3c\/script\x3e\n\x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22img1\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edata-src\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/www.mysite.com\/img\/somepic.png\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22bundle.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27img1\x27\x3c\/span\x3e).src = \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/www.mysite.com\/imgproxy\x27\x3c\/span\x3e \x2b imgproxy(\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22img1\x22\x3c\/span\x3e).getAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x27data-src\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-number\x22\x3e135\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e85\x3c\/span\x3e);\n    }\n  \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以及相关的js:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22window.imgproxy = function (url, width, height) {\n  const crypto = require(\x27crypto\x27)\n\n  const KEY = \x27somekey\x27\n  const SALT = \x27somesalt\x27\n\n  const urlSafeBase64 = (string) =\x3e {\n    return new Buffer(string).toString(\x27base64\x27).replace(\/=\/g, \x27\x27).replace(\/\\\x2b\/g, \x27-\x27).replace(\/\\\/\/g, \x27_\x27)\n  }\n\n  const hexDecode = (hex) =\x3e Buffer.from(hex, \x27hex\x27)\n\n  const sign = (salt, target, secret) =\x3e {\n    const hmac = crypto.createHmac(\x27sha256\x27, hexDecode(secret))\n    hmac.update(hexDecode(salt))\n    hmac.update(target)\n    return urlSafeBase64(hmac.digest())\n  }\n\n  const resizing_type = \x27fit\x27\n  const gravity = \x27no\x27\n  const enlarge = 0\n  const extension = \x27jpg\x27\n  const encoded_url = urlSafeBase64(url)\n  const path = `\/${resizing_type}\/${width}\/${height}\/${gravity}\/${enlarge}\/${encoded_url}.${extension}`\n\n  const signature = sign(SALT, path, KEY)\n  const result = `\/${signature}${path}`\n  return result;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.imgproxy = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eurl, width, height\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e crypto = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27crypto\x27\x3c\/span\x3e)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e KEY = \x3cspan class=\x22hljs-string\x22\x3e\x27somekey\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e SALT = \x3cspan class=\x22hljs-string\x22\x3e\x27somesalt\x27\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e urlSafeBase64 = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Buffer(\x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e).toString(\x3cspan class=\x22hljs-string\x22\x3e\x27base64\x27\x3c\/span\x3e).replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/=\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e).replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\\x2b\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27-\x27\x3c\/span\x3e).replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\\/\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27_\x27\x3c\/span\x3e)\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hexDecode = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ehex\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e Buffer.from(hex, \x3cspan class=\x22hljs-string\x22\x3e\x27hex\x27\x3c\/span\x3e)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e sign = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3esalt, target, secret\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hmac = crypto.createHmac(\x3cspan class=\x22hljs-string\x22\x3e\x27sha256\x27\x3c\/span\x3e, hexDecode(secret))\n    hmac.update(hexDecode(salt))\n    hmac.update(target)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e urlSafeBase64(hmac.digest())\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e resizing_type = \x3cspan class=\x22hljs-string\x22\x3e\x27fit\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e gravity = \x3cspan class=\x22hljs-string\x22\x3e\x27no\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e enlarge = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e extension = \x3cspan class=\x22hljs-string\x22\x3e\x27jpg\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e encoded_url = urlSafeBase64(url)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e path = \x3cspan class=\x22hljs-string\x22\x3e`\/\x3cspan class=\x22hljs-subst\x22\x3e${resizing_type}\x3c\/span\x3e\/\x3cspan class=\x22hljs-subst\x22\x3e${width}\x3c\/span\x3e\/\x3cspan class=\x22hljs-subst\x22\x3e${height}\x3c\/span\x3e\/\x3cspan class=\x22hljs-subst\x22\x3e${gravity}\x3c\/span\x3e\/\x3cspan class=\x22hljs-subst\x22\x3e${enlarge}\x3c\/span\x3e\/\x3cspan class=\x22hljs-subst\x22\x3e${encoded_url}\x3c\/span\x3e.\x3cspan class=\x22hljs-subst\x22\x3e${extension}\x3c\/span\x3e`\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e signature = sign(SALT, path, KEY)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = \x3cspan class=\x22hljs-string\x22\x3e`\/\x3cspan class=\x22hljs-subst\x22\x3e${signature}\x3c\/span\x3e\x3cspan class=\x22hljs-subst\x22\x3e${path}\x3c\/span\x3e`\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当然你需要\x3ccode\x3enpm install crypto\x3c\/code\x3e，然后编译：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22browserify main.js \x3e bundle.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3ebrowserify\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3emain\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e \x26gt; \x3cspan class=\x22hljs-selector-tag\x22\x3ebundle\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你可以把你自己得到的\x3ccode\x3eURL\x3c\/code\x3e去和\x3ca href=\x22https:\/\/progapandist.github.io\/imgproxy-form\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这个网站\x3c\/a\x3e生成的\x3ccode\x3eURL\x3c\/code\x3e做对比，如果完全一致，就说明你的代码配置正确，否则就还是有可能不成功。\x3c\/p\x3e\n\x3cp\x3e这就是这两天来的结果。我学到了不少东西，你学到了吗？\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>用imgproxy自动缩放图片</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011769042">https://segmentfault.com/a/1190000011769042</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/kmizakochtb/" target="_blank">https://alili.tech/archive/kmizakochtb/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>