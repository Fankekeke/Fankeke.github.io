<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="重构：从Promise到Async/Await"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>重构：从Promise到Async/Await | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/lmxxzbwy7hr/",
				"appid": "1613049289050283", 
				"title": "重构：从Promise到Async/Await | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-18T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/xoqcuhq4nfq/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/rbh8472za3f/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2flmxxzbwy7hr%2f&text=%e9%87%8d%e6%9e%84%ef%bc%9a%e4%bb%8ePromise%e5%88%b0Async%2fAwait"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2flmxxzbwy7hr%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2flmxxzbwy7hr%2f&text=%e9%87%8d%e6%9e%84%ef%bc%9a%e4%bb%8ePromise%e5%88%b0Async%2fAwait"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2flmxxzbwy7hr%2f&title=%e9%87%8d%e6%9e%84%ef%bc%9a%e4%bb%8ePromise%e5%88%b0Async%2fAwait"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2flmxxzbwy7hr%2f&is_video=false&description=%e9%87%8d%e6%9e%84%ef%bc%9a%e4%bb%8ePromise%e5%88%b0Async%2fAwait"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e9%87%8d%e6%9e%84%ef%bc%9a%e4%bb%8ePromise%e5%88%b0Async%2fAwait&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2flmxxzbwy7hr%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2flmxxzbwy7hr%2f&title=%e9%87%8d%e6%9e%84%ef%bc%9a%e4%bb%8ePromise%e5%88%b0Async%2fAwait"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2flmxxzbwy7hr%2f&title=%e9%87%8d%e6%9e%84%ef%bc%9a%e4%bb%8ePromise%e5%88%b0Async%2fAwait"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2flmxxzbwy7hr%2f&title=%e9%87%8d%e6%9e%84%ef%bc%9a%e4%bb%8ePromise%e5%88%b0Async%2fAwait"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2flmxxzbwy7hr%2f&title=%e9%87%8d%e6%9e%84%ef%bc%9a%e4%bb%8ePromise%e5%88%b0Async%2fAwait"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">重构：从Promise到Async/Await</h1><div class="meta"><div class="postdate"><time datetime="2018-12-18" itemprop="datePublished">2018-12-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cstrong\x3e摘要：\x3c\/strong\x3e 夸张点说，技术的发展与历史一样，顺之者昌，逆之者亡。JS开发者们，赶紧拥抱Async\/Await吧！\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\n\x3cstrong\x3eGitHub仓库:\x3c\/strong\x3e \x3ca href=\x22https:\/\/github.com\/Fundebug\/promise-asyncawait\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eFundebug\/promise-asyncawait\x3c\/a\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e早在半年多之前，我就在鼓吹\x3ca href=\x22https:\/\/blog.fundebug.com\/2017\/04\/04\/nodejs-async-await\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAsync\/Await替代Promise的6个理由\x3c\/a\x3e，似乎还招致了一些\x3ca href=\x22https:\/\/cnodejs.org\/topic\/58e4914e43ee7e7106c13541\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e批评\x3c\/a\x3e。然而，直到最近，我才真正开始进行代码重构，抛弃Promise，全面使用Async\/Await。因为，\x3ca href=\x22https:\/\/nodejs.org\/en\/blog\/release\/v8.9.0\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNode 8终于LTS了\x3c\/a\x3e！\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3eAsync\/Await真的比Promise好吗？\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e是的是的。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e这些天，我大概重构了1000行代码，最大的感觉是代码简洁了很多：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e真正地用同步的方式写异步代码\x3c\/li\x3e\n\x3cli\x3e不用写then及其回调函数，减少代码行数，也避免了代码嵌套\x3c\/li\x3e\n\x3cli\x3e所有异步调用可以写在同一个代码块中，无需定义多余的中间变量\x3c\/li\x3e\n\x3cli\x3easync函数会隐式地返回一个Promise，因此可以直接return变量，无需使用Promise.resolve进行转换\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e下面，我们可以通过一个非常简单的示例来体验一下Async\/Await的酸爽：\x3c\/p\x3e\n\x3ch4\x3e示例1\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const Promise = require(\x26quot;bluebird\x26quot;)\nvar readFile = Promise.promisify(require(\x26quot;fs\x26quot;).readFile)\n\n\/\/ 使用Promise\nfunction usePromise()\n{\n    let a\n    readFile(\x26quot;a.txt\x26quot;, \x26quot;utf8\x26quot;)\n        .then(tmp =\x3e\n        {\n            a = tmp\n            return readFile(\x26quot;b.txt\x26quot;, \x26quot;utf8\x26quot;)\n        })\n        .then(b =\x3e\n        {\n            let result = a \x2b b\n            console.log(result) \/\/ 输出\x26quot;Hello, Fundebug!\x26quot;\n        })\n\n}\n\n\/\/ 使用Async\/Await\nasync function useAsyncAwait()\n{\n    let a = await readFile(\x26quot;a.txt\x26quot;, \x26quot;utf8\x26quot;)\n    let b = await readFile(\x26quot;b.txt\x26quot;, \x26quot;utf8\x26quot;)\n    let result = a \x2b b\n    console.log(result) \/\/ 输出\x26quot;Hello, Fundebug!\x26quot;\n}\n\nusePromise()\nuseAsyncAwait()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22bluebird\x22\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e readFile = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.promisify(\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22fs\x22\x3c\/span\x3e).readFile)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用Promise\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eusePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\n\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e a\n    readFile(\x3cspan class=\x22hljs-string\x22\x3e\x22a.txt\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22utf8\x22\x3c\/span\x3e)\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3etmp\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n        {\n            a = tmp\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e readFile(\x3cspan class=\x22hljs-string\x22\x3e\x22b.txt\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22utf8\x22\x3c\/span\x3e)\n        })\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eb\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n        {\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e result = a \x2b b\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(result) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 输出\x22Hello, Fundebug!\x22\x3c\/span\x3e\n        })\n\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用Async\/Await\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3euseAsyncAwait\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\n\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e a = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e readFile(\x3cspan class=\x22hljs-string\x22\x3e\x22a.txt\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22utf8\x22\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e b = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e readFile(\x3cspan class=\x22hljs-string\x22\x3e\x22b.txt\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22utf8\x22\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e result = a \x2b b\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(result) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 输出\x22Hello, Fundebug!\x22\x3c\/span\x3e\n}\n\nusePromise()\nuseAsyncAwait()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由示例可知，使用Async\/Await极大地简化了代码，使得代码可读性提高了非常多。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3eAsync\/Await真的替代了Promise？\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e是的是的。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e对于\x3ca href=\x22https:\/\/blog.fundebug.com\/2017\/04\/04\/nodejs-async-await\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAsync\/Await替代Promise的6个理由\x3c\/a\x3e，批评者执着于Async\/Await是基于Promise实现的，因此\x3cstrong\x3e替代\x3c\/strong\x3e这个词不准确，这就有点尴尬了。\x3c\/p\x3e\n\x3cp\x3e一方面，这里替代的是\x3cstrong\x3e异步代码的编写方式\x3c\/strong\x3e，并非完全抛弃大家心爱的\x3cstrong\x3ePromise\x3c\/strong\x3e，地球人都知道Async\/Await是基于Promise的，不用太伤心；另一方面，\x3cstrong\x3ePromise\x3c\/strong\x3e是基于\x3cstrong\x3e回调函数\x3c\/strong\x3e实现的，那\x3cstrong\x3ePromise\x3c\/strong\x3e也没有替代\x3cstrong\x3e回调函数\x3c\/strong\x3e咯？\x3c\/p\x3e\n\x3cp\x3e重构代码之后，我仍然用到了Promise库\x3ca href=\x22http:\/\/bluebirdjs.com\/docs\/getting-started.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebluebird\x3c\/a\x3e。\x22Talk is cheap, Show me the code!\x22，大家不妨看看两个示例。\x3c\/p\x3e\n\x3ch4\x3e示例2：Promise.promisify\x3c\/h4\x3e\n\x3cp\x3e使用\x3ca href=\x22http:\/\/bluebirdjs.com\/docs\/api\/promise.promisify.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePromise.promisify\x3c\/a\x3e将不支持\x3cstrong\x3ePromise\x3c\/strong\x3e的方法Promise化，调用异步接口的时候有两种方式：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const Promise = require(\x26quot;bluebird\x26quot;)\nvar readFile = Promise.promisify(require(\x26quot;fs\x26quot;).readFile)\n\n\/\/ 使用Promise\nfunction usePromise()\n{\n    readFile(\x26quot;b.txt\x26quot;, \x26quot;utf8\x26quot;)\n        .then(b =\x3e\n        {\n            console.log(b)\n        })\n}\n\n\/\/ 使用Async\/Await\nasync function useAsyncAwait()\n{\n    var b = await readFile(\x26quot;b.txt\x26quot;, \x26quot;utf8\x26quot;)\n    console.log(b) \/\/ 输出\x26quot;Fundebug!\x26quot;\n}\n\nusePromise()\nuseAsyncAwait()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22bluebird\x22\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e readFile = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.promisify(\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22fs\x22\x3c\/span\x3e).readFile)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用Promise\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eusePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\n\x3c\/span\x3e{\n    readFile(\x3cspan class=\x22hljs-string\x22\x3e\x22b.txt\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22utf8\x22\x3c\/span\x3e)\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eb\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n        {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(b)\n        })\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用Async\/Await\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3euseAsyncAwait\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\n\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e b = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e readFile(\x3cspan class=\x22hljs-string\x22\x3e\x22b.txt\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22utf8\x22\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(b) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 输出\x22Fundebug!\x22\x3c\/span\x3e\n}\n\nusePromise()\nuseAsyncAwait()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cem\x3e\x3ca href=\x22https:\/\/fundebug.com\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eFundebug\x3c\/a\x3e是全栈JavaScript错误监控平台，支持各种前端和后端框架，可以帮助您第一时间发现BUG！\x3c\/em\x3e\x3c\/p\x3e\n\x3ch4\x3e示例3：Promise.map\x3c\/h4\x3e\n\x3cp\x3e使用\x3ca href=\x22http:\/\/bluebirdjs.com\/docs\/api\/promise.map.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePromise.map\x3c\/a\x3e读取多个文件的数据，调用异步接口的时候有两种方式：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const Promise = require(\x26quot;bluebird\x26quot;)\nvar readFile = Promise.promisify(require(\x26quot;fs\x26quot;).readFile)\nvar files = [\x26quot;a.txt\x26quot;, \x26quot;b.txt\x26quot;]\n\n\/\/ 使用Promise\nfunction usePromise()\n{\n    Promise.map(files, file =\x3e\n        {\n            return readFile(file, \x26quot;utf8\x26quot;)\n        })\n        .then(results =\x3e\n        {\n            console.log(results)\n        })\n}\n\n\/\/ 使用Async\/Await\nasync function useAsyncAwait()\n{\n    var results = await Promise.map(files, file =\x3e\n    {\n        return readFile(file, \x26quot;utf8\x26quot;)\n    })\n    console.log(results)\n}\n\nusePromise()\nuseAsyncAwait()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22bluebird\x22\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e readFile = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.promisify(\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22fs\x22\x3c\/span\x3e).readFile)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e files = [\x3cspan class=\x22hljs-string\x22\x3e\x22a.txt\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22b.txt\x22\x3c\/span\x3e]\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用Promise\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eusePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\n\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.map(files, file =\x26gt;\n        {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e readFile(file, \x3cspan class=\x22hljs-string\x22\x3e\x22utf8\x22\x3c\/span\x3e)\n        })\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresults\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n        {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(results)\n        })\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用Async\/Await\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3euseAsyncAwait\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\n\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e results = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.map(files, file =\x26gt;\n    {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e readFile(file, \x3cspan class=\x22hljs-string\x22\x3e\x22utf8\x22\x3c\/span\x3e)\n    })\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(results)\n}\n\nusePromise()\nuseAsyncAwait()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e没错，我的确使用了Promise库，readFile与Promise.map都是Promise函数。但是，在调用readFile与Promise.map函数时，使用Async\/Await与使用Promise是两种不同写法，它们是相互替代的关系。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3eAsync\/Await有什么问题吗？\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e有啊有啊。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e使用了\x3cstrong\x3eawait\x3c\/strong\x3e的函数定义时要加一个\x3cstrong\x3easync\x3c\/strong\x3e，调用异步函数的时候需要加一个\x3cstrong\x3eawait\x3c\/strong\x3e，这玩意写多了也觉着烦，有时候还容易忘掉。不写\x3cstrong\x3easync\x3c\/strong\x3e代码直接报错，不写\x3cstrong\x3eawait\x3c\/strong\x3e代码执行会出错。\x3c\/p\x3e\n\x3ch4\x3e示例4\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const Promise = require(\x26quot;bluebird\x26quot;)\nvar readFile = Promise.promisify(require(\x26quot;fs\x26quot;).readFile)\n\n\/\/ 没有Async\nfunction withoutAsync()\n{\n    let b = await readFile(\x26quot;b.txt\x26quot;, \x26quot;utf8\x26quot;) \/\/ 报错\x26quot;SyntaxError: Unexpected identifier\x26quot;\n    console.log(b) \n}\n\n\/\/ 没有await\nasync function withoutAwait()\n{\n    let b = readFile(\x26quot;b.txt\x26quot;, \x26quot;utf8\x26quot;)\n    console.log(b) \/\/ 打印\x26quot;Promise...\x26quot;\n}\n\nwithoutAsync()\nwithoutAwait()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22bluebird\x22\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e readFile = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.promisify(\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22fs\x22\x3c\/span\x3e).readFile)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 没有Async\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewithoutAsync\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\n\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e b = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e readFile(\x3cspan class=\x22hljs-string\x22\x3e\x22b.txt\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22utf8\x22\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 报错\x22SyntaxError: Unexpected identifier\x22\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(b) \n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 没有await\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewithoutAwait\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\n\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e b = readFile(\x3cspan class=\x22hljs-string\x22\x3e\x22b.txt\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22utf8\x22\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(b) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 打印\x22Promise...\x22\x3c\/span\x3e\n}\n\nwithoutAsync()\nwithoutAwait()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e既然Async\/Await写着有点添乱，可不可以不写呢？我想以后应该是可以的，只要能够自动识别异步代码就行了，这应该也是未来的发展方向。至于说如何实现，那我就不知道了哎。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e总结\x3c\/h3\x3e\n\x3cp\x3eJavaScript的异步编写方式，从回调函数到Promise再到Async\/Await，表面上只是写法的变化，本质上则是语言层的一次次抽象，让我们可以\x3cstrong\x3e用更简单的方式实现同样的功能\x3c\/strong\x3e，而程序员不需要去考虑代码是如何执行的。在我看来，这样的进步应该不会停止，有一天我们也许不用写Async\/Await了！\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e参考\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/blog.fundebug.com\/2017\/04\/04\/nodejs-async-await\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAsync\/Await替代Promise的6个理由\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/blog.fundebug.com\/2017\/10\/16\/async-await-simplify-javascript\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAsync\/Await是这样简化JavaScript代码的\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV00GN?w=270\x26amp;h=370\x22 src=\x22https:\/\/static.alili.tech\/img\/bV00GN?w=270\x26amp;h=370\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e版权声明:\x3cbr\x3e转载时请注明作者Fundebug以及本文地址：\x3cbr\x3e\x3ca href=\x22https:\/\/blog.fundebug.com\/2017\/12\/13\/reconstruct-from-promise-to-async-await\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/blog.fundebug.com\/2017\/12\/13\/reconstruct-from-promise-to-async-await\/\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>重构：从Promise到Async/Await</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012821826">https://segmentfault.com/a/1190000012821826</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/lmxxzbwy7hr/" target="_blank">https://alili.tech/archive/lmxxzbwy7hr/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>