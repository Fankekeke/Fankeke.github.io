<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React同构与极致的性能优化"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React同构与极致的性能优化 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/lwwv8qreoq/",
				"appid": "1613049289050283", 
				"title": "React同构与极致的性能优化 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-21T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/dss65kwp0c9/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/wwqjdfttw1/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2flwwv8qreoq%2f&text=React%e5%90%8c%e6%9e%84%e4%b8%8e%e6%9e%81%e8%87%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2flwwv8qreoq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2flwwv8qreoq%2f&text=React%e5%90%8c%e6%9e%84%e4%b8%8e%e6%9e%81%e8%87%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2flwwv8qreoq%2f&title=React%e5%90%8c%e6%9e%84%e4%b8%8e%e6%9e%81%e8%87%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2flwwv8qreoq%2f&is_video=false&description=React%e5%90%8c%e6%9e%84%e4%b8%8e%e6%9e%81%e8%87%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%e5%90%8c%e6%9e%84%e4%b8%8e%e6%9e%81%e8%87%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2flwwv8qreoq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2flwwv8qreoq%2f&title=React%e5%90%8c%e6%9e%84%e4%b8%8e%e6%9e%81%e8%87%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2flwwv8qreoq%2f&title=React%e5%90%8c%e6%9e%84%e4%b8%8e%e6%9e%81%e8%87%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2flwwv8qreoq%2f&title=React%e5%90%8c%e6%9e%84%e4%b8%8e%e6%9e%81%e8%87%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2flwwv8qreoq%2f&title=React%e5%90%8c%e6%9e%84%e4%b8%8e%e6%9e%81%e8%87%b4%e7%9a%84%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React同构与极致的性能优化</h1><div class="meta"><div class="postdate"><time datetime="2018-12-21" itemprop="datePublished">2018-12-21</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e本文发表于\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\/blob\/master\/packages\/beidou-docs\/articles\/high-performance-isomorphic-app.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e北斗同构github\x3c\/a\x3e, 转载请注明出处\x3c\/blockquote\x3e\n\x3cp\x3e注： 本文为\x3ca href=\x22http:\/\/d2forum.alibaba-inc.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e第12届D2前端技术论坛《打造高可靠与高性能的React同构解决方案》\x3c\/a\x3e分享内容，已经过数据脱敏处理。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cul\x3e\x3cli\x3e随着React的兴起, 结合Node直出的性能优势和React的组件化，React同构已然成为趋势之一。享受技术福利的同时，直面技术挑战，在复杂场景下，挑战10倍以上极致的性能优化。\x3c\/li\x3e\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e什么是同构？\x3c\/h2\x3e\n\x3cul\x3e\x3cli\x3e一套代码既可以在服务端运行又可以在客户端运行，这就是同构应用。简而言之, 就是服务端直出和客户端渲染的组合, 能够充分结合两者的优势，并有效避免两者的不足。\x3c\/li\x3e\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e为什么同构？\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e性能: 通过Node直出, 将传统的三次串行http请求简化成一次http请求，降低首屏渲染时间\x3c\/li\x3e\n\x3cli\x3eSEO: 服务端渲染对搜索引擎的爬取有着天然的优势，虽然阿里电商体系对SEO需求并不强，但随着国际化的推进, 越来越多的国际业务加入阿里大家庭，很多的业务依赖Google等搜索引擎的流量导入，比如Lazada.\x3c\/li\x3e\n\x3cli\x3e兼容性: 部分展示类页面能够有效规避客户端兼容性问题，比如白屏。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e性能数据\x3c\/h2\x3e\n\x3cp\x3e性能是一个综合性的问题, 不能简单地断言同构应用一定比非同构应用性能好，只能说合适的场景加上合理的运用，同构应用确实能带来一定的性能提升, 先来看一个线上的案例。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464038?w=700\x26amp;h=650\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464038?w=700\x26amp;h=650\x22 alt=\x22isomorphic\x22 title=\x22isomorphic\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e通常来说，网络状况越差，同构的优势越明显，下图是在不同网络状况下首屏渲染时间的一组对比\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464039?w=2468\x26amp;h=1190\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464039?w=2468\x26amp;h=1190\x22 alt=\x22isomorphic\x22 title=\x22isomorphic\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e线上案例\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e近两年，无论是业界还是阿里内部都涌现了大量同构实践, 业界比较有影响力的包括Facebook, Quora, Medium, Twitter, Airbnb, Walmart、手Q以及QQ兴趣部落等\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e阿里内部也有大量的应用，仅列举部分\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebeidou开发组\x3c\/a\x3e做过技术支持的项目\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e阿里云 - 大数据地产\x3c\/li\x3e\n\x3cli\x3e钉钉 - 企业主页\x3c\/li\x3e\n\x3cli\x3e钉钉 - 钉钉日志和审批模板市场\x3c\/li\x3e\n\x3cli\x3e菜鸟 - 物流大市场\x3c\/li\x3e\n\x3cli\x3e云零售 - 店掌柜\x3c\/li\x3e\n\x3cli\x3eLazada - PDP\x3c\/li\x3e\n\x3cli\x3e国际事业部 - AGLA\x3c\/li\x3e\n\x3cli\x3eAILab - 行业解决方案\x3c\/li\x3e\n\x3cli\x3eAILab - 智能硬件平台\x3c\/li\x3e\n\x3cli\x3eAILab - AliGenie开放平台\x3c\/li\x3e\n\x3cli\x3eAILab - AR官网\x3c\/li\x3e\n\x3cli\x3eICBU - ICBU店铺\x3c\/li\x3e\n\x3cli\x3e业务平台 - 门店评价\x3c\/li\x3e\n\x3cli\x3e国际UED - 数据运营\x3c\/li\x3e\n\x3cli\x3e国际UED - 知之\x3c\/li\x3e\n\x3cli\x3e国际UED - 探花\x3c\/li\x3e\n\x3cli\x3e国际UED - Nuke官网及过程管理\x3c\/li\x3e\n\x3cli\x3e国际UED - 会议记录，实时翻译\x3c\/li\x3e\n\x3cli\x3e国际UED - LBS数据地图\x3c\/li\x3e\n\x3cli\x3e国际UED - 数探\x3c\/li\x3e\n\x3cli\x3e国际UED - 微策\x3c\/li\x3e\n\x3cli\x3e国际UED - shuttle\x3c\/li\x3e\n\x3cli\x3e国际UED - fie portal\x3c\/li\x3e\n\x3cli\x3e...\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e业界生态\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ca href=\x22https:\/\/react-server.io\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-server\x3c\/a\x3e: React服务端渲染框架\x3c\/li\x3e\n\x3cli\x3e\n\x3ca href=\x22https:\/\/github.com\/zeit\/next.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enext.js\x3c\/a\x3e: 轻量级的同构框架\x3c\/li\x3e\n\x3cli\x3e\n\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebeidou\x3c\/a\x3e: 阿里自己的同构框架，基于eggjs, 定位是企业级同构框架\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e除了开源框架，底层方面React16重构了SSR, react-router提供了更加友好的SSR支持等等, 从某种程度上来说，同构也是一种趋势，至少是方向之一。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e思考 与 实现\x3c\/h2\x3e\n\x3cp\x3e同构的出发点不是 “为了做同构，所以做了”, 而是回归业务，去解决业务场景中SEO、首屏性能、用户体验 等问题，驱动我们去寻找可用的解决方案。在这样的场景下，除了同构本身，我们还需要考虑的是:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e高性能的 Node Server\x3c\/li\x3e\n\x3cli\x3e可靠的 同构渲染服务\x3c\/li\x3e\n\x3cli\x3e可控的 运维成本\x3c\/li\x3e\n\x3cli\x3e可复用的 解决方案\x3c\/li\x3e\n\x3cli\x3e...\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e简单归纳就是, 我们需要一个 企业级的同构渲染解决方案。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e我们是怎么做的？\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch4\x3e基于 eggjs 加入可拔插的同构能力\x3c\/h4\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\/tree\/master\/packages\/beidou-plugin-react\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebeidou-plugin-react\x3c\/a\x3e\x3cbr\x3e作为原有MVC架构中, view 层的替换, 使用 React 组件作为视图层模板, 可以直接渲染 React Component 并输出给客户端\x3c\/li\x3e\n\x3cli\x3e\n\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\/tree\/master\/packages\/beidou-plugin-webpack\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebeidou-plugin-webpack\x3c\/a\x3e\x3cbr\x3e集成 Webpack 到框架中, 在开发阶段, 提供代码的编译和打包服务\x3c\/li\x3e\n\x3cli\x3e\n\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\/tree\/master\/packages\/beidou-plugin-isomorphic\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebeidou-plugin-isomorphic\x3c\/a\x3e\x3cbr\x3e服务端的 React 运行时: babel-register\x3cbr\x3epolyfill 注入: 环境变量, BOM等\x3cbr\x3e非js文件解析: css, images, fonts...\x3c\/li\x3e\n\x3cli\x3e服务端支持css modules\x3c\/li\x3e\n\x3cli\x3e\n\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\/blob\/master\/packages\/beidou-docs\/basic\/router.md#auto-router\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e自动路由\x3c\/a\x3e: 纯静态页面无需编写任何服务端代码，像写纯前端页面一样简单\x3c\/li\x3e\n\x3cli\x3e...\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464040?w=620\x26amp;h=415\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464040?w=620\x26amp;h=415\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这里不再赘述具体如何实现，有兴趣的读者可以阅读我们的开源同构框架\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebeidou\x3c\/a\x3e -- \x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/alibaba\/beidou\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e热点问题\x3c\/h2\x3e\n\x3cp\x3e任何一种技术都有其适用场景和局限性, 同构也不例外，以下试举一二，以做抛砖引玉.\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e内存泄漏\x3c\/li\x3e\n\x3cli\x3e性能瓶颈\x3c\/li\x3e\n\x3cli\x3e...\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e内存泄漏不是同构应用所特有的，理论上所有服务端应用都可能内存泄漏，但同构应用是“高危群体”, 具体如何解决请参考本人的\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\/blob\/master\/packages\/beidou-docs\/articles\/node-memory-leak.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《Node应用内存泄漏分析方法论与实战》\x3c\/a\x3e, 接下来重点剖析下性能优化。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e极致的性能优化\x3c\/h2\x3e\n\x3cp\x3e前面也提到了，同构应用并不一定就比非同构应用性能好，影响性能的因素实在太多了，再来看一组数据\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464041?w=1732\x26amp;h=822\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464041?w=1732\x26amp;h=822\x22 alt=\x22react15 performance\x22 title=\x22react15 performance\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e上图是基于Node v8.9.1 和 React@15.5.4, 开4个进程采集到的数据, X轴是最终生成页面节点数量，Y轴红色的线表示RT(包括渲染时间和网络时间), 绿色的柱子表示QPS. 可以看出来:\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e随着页面节点的增多渲染时间可能变得很长，QPS下降非常迅速。在页面节点超过3000左右的时候，QPS接近个位数了，而且实际页面中可能包含较复杂的逻辑以及不友好的写法，情况可能会更糟。\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e顺带提一下, 笔者采样了\x3ca href=\x22https:\/\/www.taobao.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e淘宝首页\x3c\/a\x3e 和\x3ca href=\x22https:\/\/item.taobao.com\/item.htm?id=558951082993\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e淘宝某详情页\x3c\/a\x3e以及\x3ca href=\x22https:\/\/www.lazada.com.my\/vanier-classic-gentlemen-fashion-laser-series-wristwatch-all-black-59739287.html?spm=a2o4k.home.sku-feed-slider-with-banner_42126.4.rpGQzs\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eLazada某详情页\x3c\/a\x3e，页面节点数分别是2620、2467和3701. 大部分情况下，页面节点数低于1000， 比如\x3ca href=\x22https:\/\/56.cainiao.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e菜鸟物流市场\x3c\/a\x3e首页看起来内容不少，其实节点数是775.\x3c\/p\x3e\n\x3cp\x3e那针对3000节点以上的页面，我们该怎么做呢？笔者总结了以下策略并重点阐述其中一两点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e采用编译后的React版本: 根据Sasha Aickin的博客，React15在Node4、Node6、Node8下，采用编译后的版本性能相比未编译版本分别提升了2.36倍、3倍、3.85倍\x3c\/li\x3e\n\x3cli\x3e模块拆分: 模块拆分有利于并发渲染，目前ICBU店铺装修采用的就是这种方式\x3c\/li\x3e\n\x3cli\x3e模块级别缓存: 页面中某些模块其实是很适合缓存的，比如Lazada详情页中节点数虽然高达3701, 但其实页头部分就占比55.5%，页尾占比3.5%，而页头页尾是常年不变的.\x3c\/li\x3e\n\x3cli\x3e组件级缓存： 最小粒度的缓存单位了，性能提升依赖于缓存的范围和命中率，运用得当，可能带来非常大的性能提升。参考\x3ca href=\x22https:\/\/medium.com\/walmartlabs\/reactjs-ssr-profiling-and-caching-5d8e9e49240c\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewalmartlabs\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e采用hsf代替http对外提供服务: hsf的网络消耗远低于http, 在店铺同构实践中，改用hsf, java端调用Node端的耗时缩短了一半.\x3c\/li\x3e\n\x3cli\x3e部分模块客户端渲染(对SEO无用的部分): 直接降低SSR部分的复杂度\x3c\/li\x3e\n\x3cli\x3e智能降级: 当流量暴增，接近或超过阈值时，会直接导致服务的RT快速上升。可以实时监测CPU和内存的使用率，超过一定的比例自动降级为客户端渲染，降低服务端压力，CPU和内存恢复常态时，自动切回服务端渲染。\x3c\/li\x3e\n\x3cli\x3e采用Node8: 同样在店铺实践中，采用Node8相比Node6, 渲染时间从28ms降低到了18ms, 提升幅度为36%.\x3c\/li\x3e\n\x3cli\x3e采用最新版React16: \x3ca href=\x22https:\/\/reactjs.org\/blog\/2017\/09\/26\/react-v16.0.html#better-server-side-rendering\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3efacebook官方数据\x3c\/a\x3e, 在Node8下，React16相比编译后的react15仍有3.8倍提升，相比未编译的React15更是有数量级的提升。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e组件级缓存\x3c\/h4\x3e\n\x3cp\x3e如果说性能优化有\x22万能\x22的招式，那一定是缓存, 从Nigix缓存到模块级缓存到组件级缓存，其中最让人兴奋的就是组件级缓存，让我们一起来看看如何实现\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e拦截React的渲染逻辑，业界主要有三种实现方式\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eFork一份React, 暴力加入缓存逻辑, 代表库是\x3ca href=\x22https:\/\/github.com\/aickin\/react-dom-stream\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-dom-stream\x3c\/a\x3e, 虽然这个库的人气很高，但笔者还是反对这种实现方式的。\x3c\/li\x3e\n\x3cli\x3e通过require hook拦截instantiateReactComponent的载入并注入缓存逻辑，参考\x3ca href=\x22https:\/\/github.com\/walmartlabs\/react-ssr-optimization\/blob\/master\/lib\/index.js#L211-L220\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-ssr-optimization\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e扩展ReactCompositeComponent的mountComponent方法，参考\x3ca href=\x22https:\/\/github.com\/electrode-io\/electrode-react-ssr-caching\/blob\/master\/lib\/ssr-caching.js#L148-L161\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eelectrode-react-ssr-cachin\x3c\/a\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e注入缓存逻辑, 代码如下\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const ReactCompositeComponent = require(\x26quot;react\/lib\/ReactCompositeComponent\x26quot;);\n\nReactCompositeComponent.Mixin._mountComponent = ReactCompositeComponent.Mixin.mountComponent;\nReactCompositeComponent.Mixin.mountComponent = function(rootID, transaction, context) {\n  \n  const hashKey = generateHashKey(this._currentElement.props);\n  if (cacheStorage.hasEntry(hashKey)) {\n    \/\/ 命中缓存则直接返回缓存结果\n    return cacheStorage.getEntry(hashKey);\n  } else {\n    \/\/ 若未命中，则调用react的mountComponent渲染组件，并缓存结果\n    const html = this._mountComponent(rootID, transaction, context);\n    cacheStorage.addEntry(hashKey, html);\n    return html;\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ReactCompositeComponent = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22react\/lib\/ReactCompositeComponent\x22\x3c\/span\x3e);\n\nReactCompositeComponent.Mixin._mountComponent = ReactCompositeComponent.Mixin.mountComponent;\nReactCompositeComponent.Mixin.mountComponent = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erootID, transaction, context\x3c\/span\x3e) \x3c\/span\x3e{\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hashKey = generateHashKey(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._currentElement.props);\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (cacheStorage.hasEntry(hashKey)) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 命中缓存则直接返回缓存结果\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cacheStorage.getEntry(hashKey);\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 若未命中，则调用react的mountComponent渲染组件，并缓存结果\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e html = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._mountComponent(rootID, transaction, context);\n    cacheStorage.addEntry(hashKey, html);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e html;\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e设置最大缓存和缓存更新策略\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22lruCacheSettings: {\n      max: 500,  \/\/ The maximum size of the cache\n      maxAge: 1000 * 5 \/\/ The maximum age in milliseconds\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3elruCacheSettings: {\n      \x3cspan class=\x22hljs-attr\x22\x3emax\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e,  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ The maximum size of the cache\x3c\/span\x3e\n      maxAge: \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e * \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ The maximum age in milliseconds\x3c\/span\x3e\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上述缓存逻辑是基于属性的，能覆盖大部分的应用场景，但有一个要求，属性值必须可枚举且可选项很少. 请看下面的场景。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464042?w=1476\x26amp;h=1068\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464042?w=1476\x26amp;h=1068\x22 alt=\x22items\x22 title=\x22items\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e淘宝某页面上有大量的商品，而淘宝的商品又何止百万，就算某个被缓存，下次被命中的可能性依然微乎其微。那如何解决这个问题？聪明的读者可能已经看出来了，虽然每个商品最终渲染的结果千变万化，但结构始终是一致的，因此结构是可以缓存的。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464043?w=390\x26amp;h=666\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464043?w=390\x26amp;h=666\x22 alt=\x22template\x22 title=\x22template\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e要实现结构的缓存，需要在上述逻辑上额外新增三步。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e生成中间结构：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e以组件\x3ccode\x3e\x26lt;Price\x26gt;${price}\x26lt;\/Price\x26gt;\x3c\/code\x3e为例，将变量price以占位符\x3ccode\x3e${price}\x3c\/code\x3e代替\x3ccode\x3eset(price, \x22${price}\x22)\x3c\/code\x3e, 再调用react原生的mountComponent方法则可以生成中间结构\x3ccode\x3e\x26lt;div\x26gt;${price}\x26lt;\/div\x3c\/code\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e缓存中间结构\x3c\/li\x3e\n\x3cli\x3e生成最终组件\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e以上就是组件级缓存的实现方式, 特别要提醒的是缓存是把双刃剑，运用不当可能会引发内存泄漏以及数据的不一致。\x3c\/p\x3e\n\x3ch4\x3eReact16 SSR\x3c\/h4\x3e\n\x3cul\x3e\x3cli\x3eFB在9.26发布了React16正式版，之前万众期待的\x3ca href=\x22https:\/\/hackernoon.com\/whats-new-with-server-side-rendering-in-react-16-9b0d78585d67\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSSR性能提升\x3c\/a\x3e没有让大家失望, 引用React核心开发Sasha Aickin的对比图\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464044?w=1600\x26amp;h=987\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464044?w=1600\x26amp;h=987\x22 alt=\x22react16\x22 title=\x22react16\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e笔者拿之前的应用升级到React16, 对比下3909节点，RT从295ms降到了51ms, QPS从9提升到了44, 提升非常明显。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464045?w=1662\x26amp;h=812\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464045?w=1662\x26amp;h=812\x22 alt=\x22react16\x22 title=\x22react16\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e实战\x3c\/h2\x3e\n\x3cp\x3e接下来通过一个例子，展示如何一步步地提升性能。\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\/tree\/master\/examples\/performance\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e代码仓库\x3c\/a\x3e -- \x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/alibaba\/beidou\/\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e10倍以上性能提升\x3c\/h3\x3e\n\x3cul\x3e\x3cli\x3e首先构造一个非常复杂的页面, 页面节点数是3342, 对比之下，\x3ca href=\x22https:\/\/www.taobao.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e淘宝首页\x3c\/a\x3e首屏的页面节点数是831, 异步充分加载之后(懒加载完成),整个页面节点数为3049. 注： 淘宝页面为动态页面，每次采样可能会有差异。\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464046?w=2420\x26amp;h=1276\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464046?w=2420\x26amp;h=1276\x22 alt=\x22复杂页面\x22 title=\x22复杂页面\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464047?w=2532\x26amp;h=1110\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464047?w=2532\x26amp;h=1110\x22 alt=\x22淘宝首屏\x22 title=\x22淘宝首屏\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464048?w=2582\x26amp;h=1324\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464048?w=2582\x26amp;h=1324\x22 alt=\x22淘宝全屏\x22 title=\x22淘宝全屏\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e初始平均渲染时间为\x3ccode\x3e295.75ms\x3c\/code\x3e(Node6.92, React15.6.2), 注: 图中有\x3ccode\x3e296.50ms\x3c\/code\x3e,\x3ccode\x3e317.25ms\x3c\/code\x3e,\x3ccode\x3e297.25ms\x3c\/code\x3e,\x3ccode\x3e295.75ms\x3c\/code\x3e四个平均值，是因为开启了四个进程，采样最后一个，下同。\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464049?w=848\x26amp;h=612\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464049?w=848\x26amp;h=612\x22 alt=\x22初始渲染时间\x22 title=\x22初始渲染时间\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e启用\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\/blob\/master\/examples\/performance\/.babelrc#L3-L6\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebabel性能加速插件\x3c\/a\x3e, 平均渲染时间为\x3ccode\x3e219.00ms\x3c\/code\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464050?w=796\x26amp;h=618\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464050?w=796\x26amp;h=618\x22 alt=\x22babel性能加速插件\x22 title=\x22babel性能加速插件\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e采用Node8.9.1(或更新版本)平均渲染时间为\x3ccode\x3e207ms\x3c\/code\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464051?w=837\x26amp;h=614\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464051?w=837\x26amp;h=614\x22 alt=\x22Node8\x22 title=\x22Node8\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e采用\x3ccode\x3eproduction\x3c\/code\x3e模式平均渲染时间为\x3ccode\x3e81.75ms\x3c\/code\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464052?w=835\x26amp;h=614\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464052?w=835\x26amp;h=614\x22 alt=\x22production mode\x22 title=\x22production mode\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e部分内容客户端渲染，平均渲染时间为\x3ccode\x3e44.63ms\x3c\/code\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464053?w=837\x26amp;h=633\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464053?w=837\x26amp;h=633\x22 alt=\x22part csr\x22 title=\x22part csr\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e部分内容组件级别cache,平均渲染时间为\x3ccode\x3e22.65ms\x3c\/code\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464054?w=834\x26amp;h=635\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464054?w=834\x26amp;h=635\x22 alt=\x22part cache\x22 title=\x22part cache\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e采用React16(或更新版本)，平均渲染时间为\x3ccode\x3e5.17ms\x3c\/code\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464055?w=837\x26amp;h=631\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464055?w=837\x26amp;h=631\x22 alt=\x22react16\x22 title=\x22react16\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e结合React16和部分客户端渲染，平均渲染时间为\x3ccode\x3e2.68ms\x3c\/code\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012464056\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012464056\x22 alt=\x22react16\x2bcsr\x22 title=\x22react16\x2bcsr\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e至此，服务端渲染时间已经最初的\x3ccode\x3e295.75ms\x3c\/code\x3e降低到了\x3ccode\x3e2.68ms\x3c\/code\x3e，提升了超过100倍。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e更多性能策略\x3c\/h3\x3e\n\x3cp\x3e其实除了上述应用的策略，还有其它的策略，比如\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e采用\x3ccode\x3eAsync\x3c\/code\x3e, 有数据称性能提升30%, 笔者试了下，未见明显提升。应该是经过了babel的编译，最终没有发挥出\x3ccode\x3eAsync\x3c\/code\x3e的优势，这是因为\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebeidou框架\x3c\/a\x3e在服务端要支持\x3ccode\x3eimport\x3c\/code\x3e等ES6的写法以及支持React的\x3ccode\x3eJSX语法\x3c\/code\x3e。其实也非常简单，直接缩小\x3ccode\x3ebabel\x3c\/code\x3e的编译范围，在\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebeidou框架\x3c\/a\x3e中是可以自己定义的。\x3c\/li\x3e\n\x3cli\x3e降低React组件的嵌套层级。试验数据，同样的页面节点数，服务端渲染时间和组件的嵌套层级是线性正相关的。\x3c\/li\x3e\n\x3cli\x3e热点缓存\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e...\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e万变不离其宗\x3c\/h3\x3e\n\x3cp\x3e借用《功夫》中的一句经典台词\x3ccode\x3e天下武功，无坚不破，唯快不破\x3c\/code\x3e，同样的，\x3cbr\x3e随着时间的推移，上面这些策略策略迟早会\x3ccode\x3e被破\x3c\/code\x3e，比如react16 ssr重构之后，之前的组件级别缓存逻辑不再有效。\x3cbr\x3e另外，可能由于架构设计\/技术选型根本就使不上劲，比如react16是今年9月26才正式发版，很多第三方组件还没来得及升级，如果应用中有些组件强依赖于react15或者更早的版本，可能根本就没法利用react16的性能优势。\x3c\/p\x3e\n\x3cp\x3e那么有没有一种\x3ccode\x3e万能的办法\x3c\/code\x3e，能够做到\x3ccode\x3e唯快不破\x3c\/code\x3e呢？\x3c\/p\x3e\n\x3cp\x3e答案是： 有的。 只有掌握了方法论，才能在不断变化中，找到适合自己应用的性能优化策略。\x3c\/p\x3e\n\x3cp\x3e具体的方法论，请参考本人的另外一篇文章\x3ca href=\x22https:\/\/github.com\/alibaba\/beidou\/blob\/master\/packages\/beidou-docs\/articles\/node-performance-optimization.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《唯快不破，让nodejs再快一点》\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React同构与极致的性能优化</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012464033">https://segmentfault.com/a/1190000012464033</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/lwwv8qreoq/" target="_blank">https://alili.tech/archive/lwwv8qreoq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>