<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React-Router动态路由设计最佳实践"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React-Router动态路由设计最佳实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/mqaao4jxq69/",
				"appid": "1613049289050283", 
				"title": "React-Router动态路由设计最佳实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-27T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/103nrb2vbrvd/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/qtxm5lq7vek/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fmqaao4jxq69%2f&text=React-Router%e5%8a%a8%e6%80%81%e8%b7%af%e7%94%b1%e8%ae%be%e8%ae%a1%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fmqaao4jxq69%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fmqaao4jxq69%2f&text=React-Router%e5%8a%a8%e6%80%81%e8%b7%af%e7%94%b1%e8%ae%be%e8%ae%a1%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fmqaao4jxq69%2f&title=React-Router%e5%8a%a8%e6%80%81%e8%b7%af%e7%94%b1%e8%ae%be%e8%ae%a1%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fmqaao4jxq69%2f&is_video=false&description=React-Router%e5%8a%a8%e6%80%81%e8%b7%af%e7%94%b1%e8%ae%be%e8%ae%a1%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React-Router%e5%8a%a8%e6%80%81%e8%b7%af%e7%94%b1%e8%ae%be%e8%ae%a1%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fmqaao4jxq69%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fmqaao4jxq69%2f&title=React-Router%e5%8a%a8%e6%80%81%e8%b7%af%e7%94%b1%e8%ae%be%e8%ae%a1%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fmqaao4jxq69%2f&title=React-Router%e5%8a%a8%e6%80%81%e8%b7%af%e7%94%b1%e8%ae%be%e8%ae%a1%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fmqaao4jxq69%2f&title=React-Router%e5%8a%a8%e6%80%81%e8%b7%af%e7%94%b1%e8%ae%be%e8%ae%a1%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fmqaao4jxq69%2f&title=React-Router%e5%8a%a8%e6%80%81%e8%b7%af%e7%94%b1%e8%ae%be%e8%ae%a1%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React-Router动态路由设计最佳实践</h1><div class="meta"><div class="postdate"><time datetime="2018-12-27" itemprop="datePublished">2018-12-27</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e写在前面\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e随着单页应用（SPA）概念的日趋火热，React框架在设计和实践中同样也围绕着SPA的概念来打造自己的技术栈体系，其中路由模块便是非常重要的一个组成部分。它承载着应用功能分区，复杂模块组织，数据传递，应用状态维护等诸多功能，如何结合好React框架的技术栈特性来进行路由模块设计就显得尤为重要，本文则以探索React动态路由设计最佳实践作为切入点，分享下在实际项目开发中的心得与体会。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e为什么需要做动态路由\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e动态路由：对于大型应用来说，一个首当其冲的问题就是所需加载的 JavaScript 的大小。程序应当只加载当前渲染页所需的 JavaScript。有些开发者将这种方式称之为 \x22代码分拆(code-splitting)\x22 — 将所有的代码分拆成多个小包，在用户浏览过程中按需加载。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e1. 首屏加载效率\x3c\/h3\x3e\n\x3cp\x3e随着项目的业务需求持续添加，react中的代码复杂度将面临着持续上升的问题，同时由于react中的jsx和es6语法的文件在实际生产环境中，也会被babel-js重新编译成浏览器所支持的基于ES5的语法模块，各个模块打体积将会变得非常的臃肿不堪，直接影响到页面加载的等待时常。以下图为例，如果不做处理，我们的业务模块通常体积会达到兆级，这对首屏加载速率和用户体验的影响无疑是巨大的。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXwOt?w=1510\x26amp;h=676\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXwOt?w=1510\x26amp;h=676\x22 alt=\x22all_chunk\x22 title=\x22all_chunk\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e2. 降低模块间的功能影响\x3c\/h3\x3e\n\x3cp\x3ereact中的jsx无疑是一个很方便的设计，能让开发者像写html一样来书写虚拟dom，但是它同样也贯彻执行着\x22all in js\x22的理念，最终构建完成后所有的业务代码都将打包到1-2个bundle文件中，这就等于将所有的功能模块都集中到了一个物理文件中，如果遇到业务处理的复杂性，接口层变更，异常处理出错等诸多代码健壮性问题时，一个子模块出现了错误，就很有可能导致用户界面整体性出错从而无法使用的风险。此外，如果业务模块需要分功能上线的时候，降低彼此之间的影响也是必须要考虑的。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e3. 符合二八定律\x3c\/h3\x3e\n\x3cp\x3e通常在一个应用中，最重要和高频访的功能模块只占其中一小部分，约20%，其余80%尽管是多数，却是次要的。以后台系统为例，普通业务人员通常使用的高频模块只有3-5个，但是业务系统通常会有各式各样的权限设计，不同的权限映射着能访问的路由模块也不尽相同，虽然我们可以在用户的数据访问和路由地址上做拦截限制，但是同样也需要对其能访问的模块资源进行限制，才能做到真正的按需加载，随取随用。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e4. 工具体系支撑\x3c\/h3\x3e\n\x3cp\x3e无论是react-router还是对应搭配的构建工具webpack，其中都有针对动态路由部分的设计与优化，使用好了往往能起到事半功倍的效果。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXAnW?w=1728\x26amp;h=680\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXAnW?w=1728\x26amp;h=680\x22 alt=\x22chunk_split2\x22 title=\x22chunk_split2\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e简化版实现：bundle-loader\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/webpack.js.org\/loaders\/bundle-loader\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebundle-loader\x3c\/a\x3e是webpack官方出品与维护的一个loader，主要用来处理异步模块的加载，将简单的页面模块转成异步模块，非常方便。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e1. 改造前页面\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React from \x27react\x27\nimport {Route, Router} from \x27react-router-dom\x27\nimport createHistory from \x27history\/createHashHistory\x27\nimport \x27.\/app.less\x27\n\nimport ReactChildrenMap from \x27.\/containers\/Commons\/ReactChildrenMap\x27\nimport Home from \x27.\/containers\/Home\/Home\x27\nimport Search from \x27.\/containers\/Search\/Search\x27\nimport BookList from \x27.\/containers\/BookList\/BookList\x27\nimport BookDetail from \x27.\/containers\/BookDetail\/bookDetail.bundle.js\x27\n\nconst history = createHistory()\n\nexport default class App extends React.Component {\n  render() {\n    return (\n      \x3cRouter history={history}\x3e\n        \x3cRoute render={({location}) =\x3e {\n          return (\n            \x3cReactChildrenMap key={location.pathname}\x3e\n              \x3cRoute location={location} exact path=\x26quot;\/\x26quot; component={Home}\/\x3e\n              \x3cRoute location={location} path=\x26quot;\/search\x26quot; component={Search}\/\x3e\n              \x3cRoute location={location} path=\x26quot;\/detail\x26quot; component={BookDetail}\/\x3e\n              \x3cRoute location={location} path=\x26quot;\/bookList\/:bookId\x26quot; component={BookList}\/\x3e\n            \x3c\/ReactChildrenMap\x3e\n          )\n        \x22}}\x22\/\x3e\n      \x3c\/Router\x3e\n    );\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {Route, Router} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react-router-dom\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e createHistory \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27history\/createHashHistory\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/app.less\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e ReactChildrenMap \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/Commons\/ReactChildrenMap\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Home \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/Home\/Home\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Search \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/Search\/Search\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e BookList \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/BookList\/BookList\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e BookDetail \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/BookDetail\/bookDetail.bundle.js\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e history = createHistory()\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;Router history={history}\x26gt;\n        \x26lt;Route render={({location}) =\x26gt; {\n          return (\n            \x26lt;ReactChildrenMap key={location.pathname}\x26gt;\n              \x26lt;Route location={location} exact path=\x22\/\x22 component={Home}\/\x26gt;\n              \x26lt;Route location={location} path=\x22\/search\x22 component={Search}\/\x26gt;\n              \x26lt;Route location={location} path=\x22\/detail\x22 component={BookDetail}\/\x26gt;\n              \x26lt;Route location={location} path=\x22\/bookList\/:bookId\x22 component={BookList}\/\x26gt;\n            \x26lt;\/ReactChildrenMap\x26gt;\n          )\n        \x22}}\x22\/\x26gt;\n      \x26lt;\/Router\x26gt;\n    );\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e2. 在webpack.config.js中增加rules\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ npm install bundle-loader -D\n\/\/ 如果不想通过配置调用，也可以写成: import file from \x26quot;bundle-loader?lazy\x26amp;name=my-chunk!.\/file.js\x26quot;的内嵌写法\n\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: \/\\.bundle\\.js$\/, \/\/ 通过文件名后缀自动处理需要转成bundle的文件\n        include: \/src\/,\n        exclude: \/node_modules\/,\n        use: [{\n          loader: \x27bundle-loader\x27,\n          options: {\n            name: \x27app-[name]\x27,\n            lazy: true\n          }\n        }, {\n          loader: \x27babel-loader\x27,\n        }]\n      }\n    ]\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ npm install bundle-loader -D\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果不想通过配置调用，也可以写成: import file from \x22bundle-loader?lazy\x26amp;name=my-chunk!.\/file.js\x22的内嵌写法\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n  \x3cspan class=\x22hljs-attr\x22\x3emodule\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3erules\x3c\/span\x3e: [\n      {\n        \x3cspan class=\x22hljs-attr\x22\x3etest\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.bundle\\.js$\/\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过文件名后缀自动处理需要转成bundle的文件\x3c\/span\x3e\n        include: \x3cspan class=\x22hljs-regexp\x22\x3e\/src\/\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eexclude\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/node_modules\/\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3euse\x3c\/span\x3e: [{\n          \x3cspan class=\x22hljs-attr\x22\x3eloader\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27bundle-loader\x27\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3eoptions\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27app-[name]\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3elazy\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n          }\n        }, {\n          \x3cspan class=\x22hljs-attr\x22\x3eloader\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27babel-loader\x27\x3c\/span\x3e,\n        }]\n      }\n    ]\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e3. 在工程中使用带 xxx.bunlde.js结尾的类型文件时，就会被bundle-loader识别并做编译处理\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ bundle-loader处理前\nimport BookDetail from \x27.\/containers\/BookDetail\/bookDetail.bundle.js\x27\n\n\/\/ bundle-loader处理后\nmodule.exports = function(cb) {\n  \/\/ 自动会被bundle-loader处理成异步加载的写法\n  require.ensure([], function(require) {\n    cb(require(\x26quot;!!..\/..\/..\/node_modules\/babel-loader\/lib\/index.js!.\/bookDetail.bundle.js\x26quot;));\n  }, \x26quot;app-bookDetail.bundle\x26quot;);\n}\n\/\/ WEBPACK FOOTER \/\/\n\/\/ .\/containers\/BookDetail\/bookDetail.bundle.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ bundle-loader处理前\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e BookDetail \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/BookDetail\/bookDetail.bundle.js\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ bundle-loader处理后\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 自动会被bundle-loader处理成异步加载的写法\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e.ensure([], \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequire\x3c\/span\x3e) \x3c\/span\x3e{\n    cb(\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22!!..\/..\/..\/node_modules\/babel-loader\/lib\/index.js!.\/bookDetail.bundle.js\x22\x3c\/span\x3e));\n  }, \x3cspan class=\x22hljs-string\x22\x3e\x22app-bookDetail.bundle\x22\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ WEBPACK FOOTER \/\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/containers\/BookDetail\/bookDetail.bundle.js\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e4. 创建LazyBundle.js文件，这个文件会用来调用被bundle-loader处理后的组件\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ LazyBundle.js\nimport React, { Component } from \x27react\x27\n\nexport default class LazyBundle extends React.Component {\n\n  state = {\n    \/\/ short for \x26quot;module\x26quot; but that\x27s a keyword in js, so \x26quot;mod\x26quot;\n    mod: null\n  }\n\n  componentWillMount() {\n    this.load(this.props)\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.load !== this.props.load) {\n      this.load(nextProps)\n    }\n  }\n\n  load(props) {\n    this.setState({\n      mod: null\n    })\n    \n    props.load((mod) =\x3e {\n      this.setState({\n        \/\/ handle both es imports and cjs\n        mod: mod.default ? mod.default : mod\n      })\n    })\n  }\n\n  render() {\n    if (!this.state.mod) {\n      return false\n    }\n    return this.props.children(this.state.mod)\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ LazyBundle.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React, { Component } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eLazyBundle\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n\n  state = {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ short for \x22module\x22 but that\x27s a keyword in js, so \x22mod\x22\x3c\/span\x3e\n    mod: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n  }\n\n  componentWillMount() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.load(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props)\n  }\n\n  componentWillReceiveProps(nextProps) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (nextProps.load !== \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.load) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.load(nextProps)\n    }\n  }\n\n  load(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n      \x3cspan class=\x22hljs-attr\x22\x3emod\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    })\n    \n    props.load(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3emod\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ handle both es imports and cjs\x3c\/span\x3e\n        mod: mod.default ? mod.default : mod\n      })\n    })\n  }\n\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.mod) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.children(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.mod)\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e5. 对我们需要异步加载的组件函数进行二次封装\x3c\/h3\x3e\n\x3cblockquote\x3e\x3cp\x3e注：react-router3和4由于是不兼容升级，所以处理动态路由的方法也略有不同，在此列出了两种版本下的处理方式可供参考\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import LazyBundle from \x27.\/LazyBundle\x27\nimport BookDetail from \x27.\/containers\/BookDetail\/bookDetail.bundle.js\x27\n\n\/* use for react-router4\n * component={lazyLoadComponent(BookDetail)}\n *\/\nconst lazyLoadComponent = (comp) =\x3e (props) =\x3e (\n  \x3cLazyBundle load={comp}\x3e\n    {(Container) =\x3e \x3cContainer {...props}\/\x3e}\n  \x3c\/LazyBundle\x3e\n)\n\n\/* use for react-router3\n * getComponent={lazyLoadComponentOld(BookDetail)}\n *\/\nfunction lazyLoadComponentOld(comp) {\n  return (location, cb) =\x3e {\n    comp(module =\x3e cb(null, module.default));\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e LazyBundle \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/LazyBundle\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e BookDetail \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/BookDetail\/bookDetail.bundle.js\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* use for react-router4\n * component={lazyLoadComponent(BookDetail)}\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e lazyLoadComponent = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ecomp\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e (props) =\x26gt; (\n  \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eLazyBundle\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eload\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{comp}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    {(Container) =\x26gt; \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eContainer\x3c\/span\x3e {\x3cspan class=\x22hljs-attr\x22\x3e...props\x3c\/span\x3e}\/\x26gt;\x3c\/span\x3e}\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eLazyBundle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n)\n\n\/* use for react-router3\n * getComponent={lazyLoadComponentOld(BookDetail)}\n *\/\nfunction lazyLoadComponentOld(comp) {\n  return (location, cb) =\x26gt; {\n    comp(module =\x26gt; cb(null, module.default));\n  }\n}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e6. 改造后页面\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React from \x27react\x27\nimport {Route, Router} from \x27react-router-dom\x27\nimport createHistory from \x27history\/createHashHistory\x27\n\nconst history = createHistory()\n\nimport \x27.\/app.less\x27\n\nimport Home from \x27containers\/Home\/Home\x27\nimport ReactChildrenMap from \x27.\/containers\/Commons\/ReactChildrenMap\x27\nimport Search from \x27.\/containers\/Search\/Search\x27\nimport BookList from \x27.\/containers\/BookList\/BookList\x27\nimport LazyBundle from \x27.\/LazyBundle\x27\nimport BookDetail from \x27.\/containers\/BookDetail\/bookDetail.bundle.js\x27\n\n\/* use for react-router4\n * component={lazyLoadComponent(BookDetail)}\n *\/\nconst lazyLoadComponent = (comp) =\x3e (props) =\x3e (\n  \x3cLazyBundle load={comp}\x3e\n    {(Container) =\x3e \x3cContainer {...props}\/\x3e}\n  \x3c\/LazyBundle\x3e\n)\n\nexport default class App extends React.Component {\n  render() {\n    return (\n      \x3cRouter history={history}\x3e\n        \x3cRoute render={({location}) =\x3e {\n          return (\n            \x3cReactChildrenMap key={location.pathname}\x3e\n              \x3cRoute location={location} exact path=\x26quot;\/\x26quot; component={Home}\/\x3e\n              \x3cRoute location={location} path=\x26quot;\/search\x26quot; component={Search}\/\x3e\n              \x3cRoute location={location} path=\x26quot;\/detail\x26quot; component={lazyLoadComponent(BookDetail)} \/\x3e\n              \x3cRoute location={location} path=\x26quot;\/bookList\/:bookId\x26quot; component={BookList}\/\x3e\n            \x3c\/ReactChildrenMap\x3e\n          )\n        \x22}}\x22\/\x3e\n      \x3c\/Router\x3e\n    );\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {Route, Router} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react-router-dom\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e createHistory \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27history\/createHashHistory\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e history = createHistory()\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/app.less\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Home \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27containers\/Home\/Home\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e ReactChildrenMap \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/Commons\/ReactChildrenMap\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Search \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/Search\/Search\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e BookList \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/BookList\/BookList\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e LazyBundle \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/LazyBundle\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e BookDetail \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/containers\/BookDetail\/bookDetail.bundle.js\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* use for react-router4\n * component={lazyLoadComponent(BookDetail)}\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e lazyLoadComponent = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ecomp\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e (props) =\x26gt; (\n  \x26lt;LazyBundle load={comp}\x26gt;\n    {(Container) =\x26gt; \x26lt;Container {...props}\/\x26gt;}\n  \x26lt;\/LazyBundle\x26gt;\n)\n\nexport default class App extends React.Component {\n  render() {\n    return (\n      \x26lt;Router history={history}\x26gt;\n        \x26lt;Route render={({location}) =\x26gt; {\n          return (\n            \x26lt;ReactChildrenMap key={location.pathname}\x26gt;\n              \x26lt;Route location={location} exact path=\x22\/\x22 component={Home}\/\x26gt;\n              \x26lt;Route location={location} path=\x22\/search\x22 component={Search}\/\x26gt;\n              \x26lt;Route location={location} path=\x22\/detail\x22 component={lazyLoadComponent(BookDetail)} \/\x26gt;\n              \x26lt;Route location={location} path=\x22\/bookList\/:bookId\x22 component={BookList}\/\x26gt;\n            \x26lt;\/ReactChildrenMap\x26gt;\n          )\n        \x22}}\x22\/\x26gt;\n      \x26lt;\/Router\x26gt;\n    );\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e完成构建后我们就可以从浏览器中看到，我们定制后的模块已经被能被支持异步加载了\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXAn8?w=1782\x26amp;h=796\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXAn8?w=1782\x26amp;h=796\x22 alt=\x22bundle_chunk\x22 title=\x22bundle_chunk\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e同时在webpack构建中也能清晰地看到多了一个chunk：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXAog?w=1700\x26amp;h=498\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXAog?w=1700\x26amp;h=498\x22 alt=\x22bundle_name\x22 title=\x22bundle_name\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e高阶版实现：dynamic-imports\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/webpack.js.org\/guides\/code-splitting\/#dynamic-imports\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edynamic-imports\x3c\/a\x3e是webpack在升级到2版本以后，对js的模块处理进行了增强的，其中就有对require.ensure的改进，基于原生的Promise对象进行了重新实现，采用了import()作为资源加载方法，将其看做一个分割点并将其请求的module打包为一个独立的chunk。import()以模块名称作为参数并且返回一个Promise对象，具体介绍可以参考笔者之前写过的翻译文章\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000008181955#articleHeader25\x22\x3eWebpack2 升级指南和特性摘要\x3c\/a\x3e，具体使用比对如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ require.ensure\nmodule.exports = function (cb) {\n  require.ensure([], function(require) {\n    var app = require(\x27.\/file.js\x27);\n    cb(app);\n  }, \x26quot;custom-chunk-name\x26quot;);\n};\n\n\/\/ import()\nimport(\x26quot;.\/module\x26quot;).then(module =\x3e {\n    return module.default;\n}).catch(err =\x3e {\n    console.log(\x26quot;Chunk loading failed\x26quot;);\n});\n\/\/ This creates a separate chunk for each possible route\n​````\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ require.ensure\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e.ensure([], \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequire\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/file.js\x27\x3c\/span\x3e);\n    cb(app);\n  }, \x3cspan class=\x22hljs-string\x22\x3e\x22custom-chunk-name\x22\x3c\/span\x3e);\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ import()\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22.\/module\x22\x3c\/span\x3e).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emodule\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.default;\n}).catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Chunk loading failed\x22\x3c\/span\x3e);\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ This creates a separate chunk for each possible route\x3c\/span\x3e\n​\x3cspan class=\x22hljs-string\x22\x3e``\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e``\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e结合import的高级特性，我们就可以省去bundle-loader的处理方式，直接在原生模块上进行动态路由处理，具体设计实现如下：\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e1.封装一个高阶组件，用来实现将普通的组件转换成动态组件\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React from \x27react\x27\n\nconst AsyncComponent = loadComponent =\x3e (\n  class AsyncComponent extends React.Component {\n    state = {\n      Component: null,\n    }\n\n    componentWillMount() {\n      if (this.hasLoadedComponent()) {\n        return;\n      }\n\n      loadComponent()\n        .then(module =\x3e module.default)\n        .then((Component) =\x3e {\n          this.setState({Component});\n        })\n        .catch((err) =\x3e {\n          console.error(`Cannot load component in \x3cAsyncComponent \/\x3e`);\n          throw err;\n        });\n    }\n\n    hasLoadedComponent() {\n      return this.state.Component !== null;\n    }\n\n    render() {\n      const {Component} = this.state;\n      return (Component) ? \x3cComponent {...this.props} \/\x3e : null;\n    }\n  }\n);\n\nexport default AsyncComponent;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e AsyncComponent = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eloadComponent\x3c\/span\x3e =\x26gt;\x3c\/span\x3e (\n  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eAsyncComponent\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    state = {\n      \x3cspan class=\x22hljs-attr\x22\x3eComponent\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e,\n    }\n\n    componentWillMount() {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hasLoadedComponent()) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n      }\n\n      loadComponent()\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emodule\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.default)\n        .then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eComponent\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({Component});\n        })\n        .catch(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(\x3cspan class=\x22hljs-string\x22\x3e`Cannot load component in \x26lt;AsyncComponent \/\x26gt;`\x3c\/span\x3e);\n          \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e err;\n        });\n    }\n\n    hasLoadedComponent() {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.Component !== \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    }\n\n    render() {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {Component} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state;\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (Component) ? \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eComponent\x3c\/span\x3e {\x3cspan class=\x22hljs-attr\x22\x3e...this.props\x3c\/span\x3e} \/\x26gt;\x3c\/span\x3e : null;\n    }\n  }\n);\n\nexport default AsyncComponent;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e2.对我们需要用到的普通组件进行引入和包装处理\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 组件增强\nconst Search = AsyncComponent(() =\x3e import(\x26quot;.\/containers\/Search\/Search\x26quot;))\n\n\/\/ 路由调用\n\x3cRoute location={location} path=\x26quot;\/list\x26quot; component={BookList} \/\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 组件增强\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Search = AsyncComponent(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22.\/containers\/Search\/Search\x22\x3c\/span\x3e))\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 路由调用\x3c\/span\x3e\n\x26lt;Route location={location} path=\x3cspan class=\x22hljs-string\x22\x3e\x22\/list\x22\x3c\/span\x3e component={BookList} \/\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e利用weback3中的Magic Comments对生成的chunk指定chunkName\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const BookList = AsyncComponent(() =\x3e \n  import(\/* webpackChunkName: \x26quot;bookList\x26quot; *\/ \x26quot;.\/containers\/BookList\/BookList\x26quot;)\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e BookList = AsyncComponent(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \n  \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-comment\x22\x3e\/* webpackChunkName: \x22bookList\x22 *\/\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22.\/containers\/BookList\/BookList\x22\x3c\/span\x3e)\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e完成构建后我们就可以从浏览器中看到，我们定制后的模块也和之前一样，被能被支持异步加载了\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXAov?w=2100\x26amp;h=646\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXAov?w=2100\x26amp;h=646\x22 alt=\x22async_component\x22 title=\x22async_component\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e同时在webpack构建界面中的能看到多了一个chunk，并且chunkName就是我们自定义的名称，对于定位分析一些模块问题时会非常管用。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXAoK?w=1712\x26amp;h=644\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXAoK?w=1712\x26amp;h=644\x22 alt=\x22bundle_name_comment\x22 title=\x22bundle_name_comment\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e从中我们也不难发现，相对于bundle-loader，dynamic-imports \x2b AsyncComponent高阶组件的方式更为简单灵活，同时对于现有的代码改动也较小，故作为在实际开发中的首选方案使用，同时我们也推荐一个非常不错的webpack的chunk分析工具\x3ca href=\x22https:\/\/github.com\/webpack-contrib\/webpack-bundle-analyzer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack-bundle-analyzer\x3c\/a\x3e，方便查看每个异步路由中的构建的具体模块内容。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader16\x22\x3eOne more thing：路由模块的组织\x3c\/h2\x3e\n\x3cp\x3ereact-router功能强大，上手简单，作为官方唯一指定的路由框架已经成为了react应用开发中必备的部分，但是由于react天生组件化的原因，意味着react-router的配置文件中在实际使用中，会难免出现如下不佳场景：\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3e1、路由配置入口文件持续臃肿，文件越引越多\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXAo6?w=1442\x26amp;h=934\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXAo6?w=1442\x26amp;h=934\x22 alt=\x22components\x22 title=\x22components\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader18\x22\x3e2、路由配置会随着业务嵌套越来越深，团队协作开发时极易产生冲突\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXApa?w=1788\x26amp;h=1336\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXApa?w=1788\x26amp;h=1336\x22 alt=\x22route-config\x22 title=\x22route-config\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader19\x22\x3e3、非jsx写法，模块清晰简单，但是会导致路由模块和业务模块耦合，不利于集中管理，同时无法明确表达出母子路由的嵌套关系，参见\x3ca href=\x22https:\/\/github.com\/ReactTraining\/react-router\/blob\/v3.0.5\/examples\/huge-apps\/app.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehuge-apps\x3c\/a\x3e\n\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXApn?w=1072\x26amp;h=1146\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXApn?w=1072\x26amp;h=1146\x22 alt=\x22js-route\x22 title=\x22js-route\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e问题来了：如何既保证路由模块的清晰简单，又能集中管理维护，还能支持嵌套定义和动态加载？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader20\x22\x3e借鉴python flask中的\x3ca href=\x22http:\/\/flask.pocoo.org\/docs\/0.10\/blueprints\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eblueprint\x3c\/a\x3e设计思路，重新实现路由模块的划分\x3c\/h2\x3e\n\x3cp\x3e经过前面的分析，我们不难发现react-router的路由配置模块会随着业务的深入变得越来越臃肿，其根本原因在于我们将所有的资源和配置信息都写在了一个文件中，这和软件设计中提倡的清晰单一，低耦合高内聚等指导原则是背道而驰的，为此我们针对路由模块的划分这块进行了重构，改进方式如下：\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader21\x22\x3e1.拆分routes.js入口文件\x3c\/h3\x3e\n\x3cp\x3e将路由模块的整体由一个routes.js文件拆成若干个彼此间互相独立的子路由模块文件模块的拆分原则可以和业务功能划分一一对应，逐步减少主配置中的内容耦合。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22routes\n├── asyncComponent.js\n├── callManage.js\n├── index.js\n├── opportunity.js\n├── osManage.js\n├── salesKit.js\n├── salesManage.js\n├── system.js\n├── uploadOppor.js\n└── workBoard.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3eroutes\n├── asyncComponent.js\n├── callManage.js\n├── index.js\n├── opportunity.js\n├── osManage.js\n├── salesKit.js\n├── salesManage.js\n├── system.js\n├── uploadOppor.js\n└── workBoard.js\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader22\x22\x3e2.在模块的入口文件index.js中完成对各个子模块的引入，如下所示：\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React from \x27react\x27;\nimport { Route, IndexRedirect } from \x27react-router\x27;\nimport NotFound from \x27..\/components\/NotFound\x27;\nimport Layout from \x27..\/containers\/Main\x27;\nimport Opportunity from \x27.\/opportunity\x27;\nimport OsManage from \x27.\/osManage\x27;\nimport SalesKit from \x27.\/salesKit\x27;\nimport System from \x27.\/system\x27;\nimport CallManage from \x27.\/callManage\x27;\nimport SalesManage from \x27.\/salesManage\x27;\nimport WorkBoard from \x27.\/workBoard\x27;\nimport UploadOppor from \x27.\/uploadOppor\x27;\n\nconst routeList = [\n  Opportunity,\n  UploadOppor,\n  OsManage,\n  SalesKit,\n  System,\n  CallManage,\n  SalesManage,\n  WorkBoard\n];\n\nexport default (\n  \x3cRoute path=\x27\/\x27 component={Layout} \x3e\n    {routeList}\n    \x3cRoute path=\x27*\x27 component={NotFound} \/\x3e\n  \x3c\/Route\x3e\n);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { Route, IndexRedirect } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react-router\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e NotFound \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/components\/NotFound\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Layout \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/containers\/Main\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Opportunity \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/opportunity\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e OsManage \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/osManage\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e SalesKit \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/salesKit\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e System \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/system\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e CallManage \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/callManage\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e SalesManage \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/salesManage\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e WorkBoard \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/workBoard\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e UploadOppor \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/uploadOppor\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e routeList = [\n  Opportunity,\n  UploadOppor,\n  OsManage,\n  SalesKit,\n  System,\n  CallManage,\n  SalesManage,\n  WorkBoard\n];\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e (\n  \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{Layout}\x3c\/span\x3e \x26gt;\x3c\/span\x3e\n    {routeList}\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{NotFound}\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n);\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader23\x22\x3e3.在子路由模块中完成对应具体业务模块的加载，支持同时混合使用同步和异步组件的管理方式\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React from \x27react\x27;\nimport { Route } from \x27react-router\x27;\nimport UploadOpportunities from \x27..\/containers\/opportunity\/UploadOpportunities\x27\nimport UploadVisitOpportunity from \x27..\/containers\/UploadVisitOpportunity\x27\nimport asyncComponent from \x27.\/asyncComponent\x27\n\n\/\/ upload_frozen_phone\nconst UploadFrozenPhone = asyncComponent(\n  () =\x3e import(\/* webpackChunkName: \x26quot;upload_frozen_phone\x26quot; *\/\x27..\/components\/uploadFrozenPhone\/UploadFrozenPhone\x27)\n);\n\n\/\/ upload_phone_state\nconst UploadPhoneState = asyncComponent(\n  () =\x3e import(\/* webpackChunkName: \x26quot;upload_phone_state\x26quot; *\/\x27..\/components\/uploadPhoneState\/UploadPhoneState\x27)\n);\n\nexport default (\n  \x3cRoute key=\x27uploadOpportunities\x27\x3e\n    \x3cRoute path=\x27upload_opportunity\/:type\x27 component={UploadOpportunities} \/\x3e\n    \x3cRoute path=\x27upload_visit_opportunity\x27 component={UploadVisitOpportunity} \/\x3e\n    \x3cRoute path=\x27frozen_phone\x27 component={UploadFrozenPhone} \/\x3e\n    \x3cRoute path=\x27phone_state\x27 component={UploadPhoneState} \/\x3e\n  \x3c\/Route\x3e\n);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { Route } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react-router\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e UploadOpportunities \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/containers\/opportunity\/UploadOpportunities\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e UploadVisitOpportunity \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/containers\/UploadVisitOpportunity\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e asyncComponent \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/asyncComponent\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ upload_frozen_phone\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e UploadFrozenPhone = asyncComponent(\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-comment\x22\x3e\/* webpackChunkName: \x22upload_frozen_phone\x22 *\/\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x27..\/components\/uploadFrozenPhone\/UploadFrozenPhone\x27\x3c\/span\x3e)\n);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ upload_phone_state\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e UploadPhoneState = asyncComponent(\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e(\x3cspan class=\x22hljs-comment\x22\x3e\/* webpackChunkName: \x22upload_phone_state\x22 *\/\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x27..\/components\/uploadPhoneState\/UploadPhoneState\x27\x3c\/span\x3e)\n);\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e (\n  \x26lt;Route key=\x27uploadOpportunities\x27\x26gt;\n    \x26lt;Route path=\x27upload_opportunity\/:type\x27 component={UploadOpportunities} \/\x26gt;\n    \x26lt;Route path=\x27upload_visit_opportunity\x27 component={UploadVisitOpportunity} \/\x26gt;\n    \x26lt;Route path=\x27frozen_phone\x27 component={UploadFrozenPhone} \/\x26gt;\n    \x26lt;Route path=\x27phone_state\x27 component={UploadPhoneState} \/\x26gt;\n  \x26lt;\/Route\x26gt;\n);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader24\x22\x3e4. 优势小结：\x3c\/h3\x3e\n\x3cp\x3e这样重构的好处是即使未来随着业务的深入，对应的开发人员也只需要维护自身负责的子路由模块，再在根路由下进行注册即可使用，并且由于子路由模块都从物理文件上进行了隔离，也能最大程度地减少协作冲突，同时，因为维持了jsx的描述型结构，路由的嵌套关系和集中维护等优点依旧能沿用。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader25\x22\x3e总结\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e本文从react-router的动态路由实践着手，整合了webpack的bundle-loader，dynamic-imports和高阶组件等实践的明细介绍，附带介绍了改进路由模块的组织方式，以此作为react-router深入实践的经验总结，希望能对各位读者在实际项目开发中有所帮助。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader26\x22\x3e参考文献\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/webpack.js.org\/guides\/code-splitting\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebpack3官方文档\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/react-guide.github.io\/react-router-cn\/docs\/API.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact-Router官方文档\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/zhuanlan.zhihu.com\/p\/24595585\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e基于Webpack 2的React组件懒加载\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000009539836\x22\x3eReact-router 4 按需加载的实现方式及原理\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000006063554\x22 target=\x22_blank\x22\x3eReact Router最新指南与异步加载实践\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React-Router动态路由设计最佳实践</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011765141">https://segmentfault.com/a/1190000011765141</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/mqaao4jxq69/" target="_blank">https://alili.tech/archive/mqaao4jxq69/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>