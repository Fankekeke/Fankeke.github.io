<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Ios中微信页面返回上一页去除缓存几种常见思路"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Ios中微信页面返回上一页去除缓存几种常见思路 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/n6vhq3ra3wq/",
				"appid": "1613049289050283", 
				"title": "Ios中微信页面返回上一页去除缓存几种常见思路 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-02T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/zd605n2xl8r/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/tmu9lqa93n9/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fn6vhq3ra3wq%2f&text=Ios%e4%b8%ad%e5%be%ae%e4%bf%a1%e9%a1%b5%e9%9d%a2%e8%bf%94%e5%9b%9e%e4%b8%8a%e4%b8%80%e9%a1%b5%e5%8e%bb%e9%99%a4%e7%bc%93%e5%ad%98%e5%87%a0%e7%a7%8d%e5%b8%b8%e8%a7%81%e6%80%9d%e8%b7%af"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fn6vhq3ra3wq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fn6vhq3ra3wq%2f&text=Ios%e4%b8%ad%e5%be%ae%e4%bf%a1%e9%a1%b5%e9%9d%a2%e8%bf%94%e5%9b%9e%e4%b8%8a%e4%b8%80%e9%a1%b5%e5%8e%bb%e9%99%a4%e7%bc%93%e5%ad%98%e5%87%a0%e7%a7%8d%e5%b8%b8%e8%a7%81%e6%80%9d%e8%b7%af"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fn6vhq3ra3wq%2f&title=Ios%e4%b8%ad%e5%be%ae%e4%bf%a1%e9%a1%b5%e9%9d%a2%e8%bf%94%e5%9b%9e%e4%b8%8a%e4%b8%80%e9%a1%b5%e5%8e%bb%e9%99%a4%e7%bc%93%e5%ad%98%e5%87%a0%e7%a7%8d%e5%b8%b8%e8%a7%81%e6%80%9d%e8%b7%af"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fn6vhq3ra3wq%2f&is_video=false&description=Ios%e4%b8%ad%e5%be%ae%e4%bf%a1%e9%a1%b5%e9%9d%a2%e8%bf%94%e5%9b%9e%e4%b8%8a%e4%b8%80%e9%a1%b5%e5%8e%bb%e9%99%a4%e7%bc%93%e5%ad%98%e5%87%a0%e7%a7%8d%e5%b8%b8%e8%a7%81%e6%80%9d%e8%b7%af"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Ios%e4%b8%ad%e5%be%ae%e4%bf%a1%e9%a1%b5%e9%9d%a2%e8%bf%94%e5%9b%9e%e4%b8%8a%e4%b8%80%e9%a1%b5%e5%8e%bb%e9%99%a4%e7%bc%93%e5%ad%98%e5%87%a0%e7%a7%8d%e5%b8%b8%e8%a7%81%e6%80%9d%e8%b7%af&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fn6vhq3ra3wq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fn6vhq3ra3wq%2f&title=Ios%e4%b8%ad%e5%be%ae%e4%bf%a1%e9%a1%b5%e9%9d%a2%e8%bf%94%e5%9b%9e%e4%b8%8a%e4%b8%80%e9%a1%b5%e5%8e%bb%e9%99%a4%e7%bc%93%e5%ad%98%e5%87%a0%e7%a7%8d%e5%b8%b8%e8%a7%81%e6%80%9d%e8%b7%af"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fn6vhq3ra3wq%2f&title=Ios%e4%b8%ad%e5%be%ae%e4%bf%a1%e9%a1%b5%e9%9d%a2%e8%bf%94%e5%9b%9e%e4%b8%8a%e4%b8%80%e9%a1%b5%e5%8e%bb%e9%99%a4%e7%bc%93%e5%ad%98%e5%87%a0%e7%a7%8d%e5%b8%b8%e8%a7%81%e6%80%9d%e8%b7%af"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fn6vhq3ra3wq%2f&title=Ios%e4%b8%ad%e5%be%ae%e4%bf%a1%e9%a1%b5%e9%9d%a2%e8%bf%94%e5%9b%9e%e4%b8%8a%e4%b8%80%e9%a1%b5%e5%8e%bb%e9%99%a4%e7%bc%93%e5%ad%98%e5%87%a0%e7%a7%8d%e5%b8%b8%e8%a7%81%e6%80%9d%e8%b7%af"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fn6vhq3ra3wq%2f&title=Ios%e4%b8%ad%e5%be%ae%e4%bf%a1%e9%a1%b5%e9%9d%a2%e8%bf%94%e5%9b%9e%e4%b8%8a%e4%b8%80%e9%a1%b5%e5%8e%bb%e9%99%a4%e7%bc%93%e5%ad%98%e5%87%a0%e7%a7%8d%e5%b8%b8%e8%a7%81%e6%80%9d%e8%b7%af"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Ios中微信页面返回上一页去除缓存几种常见思路</h1><div class="meta"><div class="postdate"><time datetime="2019-01-02" itemprop="datePublished">2019-01-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch3 id=\x22articleHeader0\x22\x3e前言\x3c\/h3\x3e\n\x3cp\x3e这篇文章主要讲解决思路，不对各种概念进行过多讲解。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e问题描述\x3c\/h3\x3e\n\x3cp\x3e开发微信H5页面的时候，在Ios微信内置浏览器中点击返回按钮返回上一页时，上一页面不会被刷新。\x3cbr\x3e在浏览器缓存机制中，在返回上一页的操作中， html\/js\/css\/接口等动静态资源不会重新请求，但是js会重新加载。但在Ios微信页面中js也会保存上一页面最后执行的状态，不会重新执行js。\x3cbr\x3e使用这种模式缓存机制可以加快渲染速度，但是部分数据需要经常展示和编辑的情况下回导致不同步。比如“详情页”跳转到“编辑页”，在“编辑页”中修改数据后返回到详情页中，“详情页”数据展示并未进行同步修改。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e产生原因\x3c\/h3\x3e\n\x3cp\x3e这里提到一个概念，\x3cem\x3e浏览器前进\/后退缓存\x3c\/em\x3e，（Backward\/Forward Cache，BF Cache），当然也有人叫disk Cache。\x3cbr\x3eBF Cache 是一种浏览器优化，HTML标准并未指定其如何进行缓存，因此缓存行为是各浏览器实现不尽相同。\x3cbr\x3e由于不是Http缓存，所以通过头文件缓存设置no-cache是无效的。当然也不能以Http缓存机制来理解BF Cache。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e解决思路\x3c\/h3\x3e\n\x3cp\x3e从网上看了几种比较常见的解决思路，下面简单讲解。\x3c\/p\x3e\n\x3ch4\x3e设置浏览历史当前记录\x3c\/h4\x3e\n\x3cp\x3ehistory.replaceState方法的参数与pushState方法一模一样，区别是它修改浏览历史中当前纪录。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var href = location.href;\nvar time = new Date().getTime();\nhref \x2b= href.indexOf(\x27?\x27) \x3e -1 ? (\x27\x26amp;time=\x27\x2btime) : (\x27?time=\x27 \x2b time);\n\nhistory.replaceState({}, \x26quot;title\x26quot;, href);\n\/\/ 比如当前页面地址为http:\/\/www.a.com; 通过history.replaceState修改后当前地址会变为http:\/\/www.a.com?time=xxx\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs tcl\x22\x3e\x3ccode\x3evar href = location.href;\nvar \x3cspan class=\x22hljs-keyword\x22\x3etime\x3c\/span\x3e = new Date().getTime();\nhref \x2b= href.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27?\x27\x3c\/span\x3e) \x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e ? (\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;time=\x27\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-keyword\x22\x3etime\x3c\/span\x3e) : (\x3cspan class=\x22hljs-string\x22\x3e\x27?time=\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3etime\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3ehistory\x3c\/span\x3e.replaceState({}, \x3cspan class=\x22hljs-string\x22\x3e\x22title\x22\x3c\/span\x3e, href);\n\/\/ 比如当前页面地址为\x3cspan class=\x22hljs-keyword\x22\x3ehttp\x3c\/span\x3e:\/\/www.a.com; 通过\x3cspan class=\x22hljs-keyword\x22\x3ehistory\x3c\/span\x3e.replaceState修改后当前地址会变为\x3cspan class=\x22hljs-keyword\x22\x3ehttp\x3c\/span\x3e:\/\/www.a.com?\x3cspan class=\x22hljs-keyword\x22\x3etime\x3c\/span\x3e=xxx\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e网上这种解决思路比较多，实际情况中并不可行。\x3cbr\x3e原因：Ios微信中调整到下一页面后并未将上一页面修改的url保持在历史记录中，以代码为例，返回上一页并未返回到\x3cstrong\x3e \x3ca href=\x22http:\/\/www.a.com?time=xxx\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.a.com?time=xxx\x3c\/a\x3e \x3c\/strong\x3e， \x3cbr\x3e而是返回到\x3cstrong\x3e \x3ca href=\x22http:\/\/www.a.com\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.a.com\x3c\/a\x3e \x3c\/strong\x3e中。\x3c\/p\x3e\n\x3ch4\x3e通过时间差来判断是否需要重置\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var prev = parseInt(new Date().getTime() \/ 1000);\nvar now = prev;\n\nwindow.setInterval(function() {\n    now = parseInt(new Date().getTime() \/ 1000);\n    \n    \/\/ 当前步骤与上一步骤时间差超过1秒，表示页面已经跳转过\n    \/\/ 时间差需要与间隔时间相对应\n    if (now - prev \x3e 1) {\n        location.reload();\n    } else {\n        prev = now;\n    }\n\/\/ 间隔时间设置为1秒\n}, 1000);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e prev = \x3cspan class=\x22hljs-built_in\x22\x3eparseInt\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime() \/ \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e now = prev;\n\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.setInterval(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    now = \x3cspan class=\x22hljs-built_in\x22\x3eparseInt\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime() \/ \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当前步骤与上一步骤时间差超过1秒，表示页面已经跳转过\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 时间差需要与间隔时间相对应\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (now - prev \x26gt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n        location.reload();\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        prev = now;\n    }\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 间隔时间设置为1秒\x3c\/span\x3e\n}, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e原理：通过判断当前步骤与上一步骤的时间差来判断是否需要更新\x3cbr\x3e缺点：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22间隔轮询时间差长度设置为多久比较好，不好掌控；\n通过setInterval设置的间隔时间差并不是很精确；\n并且两个页面之间的反复切换速度非常迅速的情况下也许会出现监测不到的现象。\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs bash\x22\x3e\x3ccode\x3e间隔轮询时间差长度设置为多久比较好，不好掌控；\n通过\x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3eInterval设置的间隔时间差并不是很精确；\n并且两个页面之间的反复切换速度非常迅速的情况下也许会出现监测不到的现象。\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e通过localStorage控制是否需要刷新\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22localStorage.setItem(\x26quot;need-refresh\x26quot;, true);\n$(function () {\n    var needRefresh = localStorage.getItem(\x26quot;need-refresh\x26quot;);\n    if(needRefresh) {\n        localStorage.removeItem(\x26quot;need-refresh\x26quot;);\n        location.reload();\n    }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3elocalStorage.setItem(\x3cspan class=\x22hljs-string\x22\x3e\x22need-refresh\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n$(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e needRefresh = localStorage.getItem(\x3cspan class=\x22hljs-string\x22\x3e\x22need-refresh\x22\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(needRefresh) {\n        localStorage.removeItem(\x3cspan class=\x22hljs-string\x22\x3e\x22need-refresh\x22\x3c\/span\x3e);\n        location.reload();\n    }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e原理：通过获取浏览器保存的key来决定页面是否需要刷新\x3cbr\x3e缺点：当页面关闭再重新打开时，key（也就是代码中的need-refresh）key值为true，会导致页面加载两次，造成重复渲染\x3c\/p\x3e\n\x3ch4\x3e通过pageshow事件决定是否需要刷新页面\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22window.addEventListener(\x27pageshow\x27, function(e) {\n    \/\/ 通过persisted属性判断是否存在 BF Cache\n    if (e.persisted) {\n        location.reload();\n    }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27pageshow\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过persisted属性判断是否存在 BF Cache\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (e.persisted) {\n        location.reload();\n    }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e原理：pageShow事件在页面显示即会触发，无论页面是否来自BF Cache。通过检测persisted属性即可判断是否存在 BF Cache 行为。\x3cbr\x3e优点：大部分浏览器都支持pageShow方法与persisted属性，并且需要的代码量只需要短短4行即可。\x3cbr\x3e缺点：每种浏览器中BF Cache的机制是不同的，部分浏览器中的Bf Cache还是会重新执行js代码，会造成重复渲染效果。当然这篇文章中我们只考虑Ios中的微信页面， 所以是不存在问题。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e参考资料\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000004486640\x22\x3e关于浏览器缓存\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/harttle.com\/2017\/03\/12\/backward-forward-cache.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e浏览器前进\/后退缓存（BF Cache）\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/frontenddev.org\/link\/browser-page-to-enter-and-leave-the-event-pageshow-pagehide.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e浏览器页面进入、离开事件：pageshow\/pagehide\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Ios中微信页面返回上一页去除缓存几种常见思路</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010934250">https://segmentfault.com/a/1190000010934250</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/n6vhq3ra3wq/" target="_blank">https://alili.tech/archive/n6vhq3ra3wq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>