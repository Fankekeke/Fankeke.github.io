<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Vue双向绑定的实现原理系列（三）：监听器Observer和订阅者Watcher"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Vue双向绑定的实现原理系列（三）：监听器Observer和订阅者Watcher | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ncyzwkqsp8/",
				"appid": "1613049289050283", 
				"title": "Vue双向绑定的实现原理系列（三）：监听器Observer和订阅者Watcher | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-14T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ph2pik1ynrh/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/tumsml4fbgb/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fncyzwkqsp8%2f&text=Vue%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e7%b3%bb%e5%88%97%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e7%9b%91%e5%90%ac%e5%99%a8Observer%e5%92%8c%e8%ae%a2%e9%98%85%e8%80%85Watcher"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fncyzwkqsp8%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fncyzwkqsp8%2f&text=Vue%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e7%b3%bb%e5%88%97%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e7%9b%91%e5%90%ac%e5%99%a8Observer%e5%92%8c%e8%ae%a2%e9%98%85%e8%80%85Watcher"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fncyzwkqsp8%2f&title=Vue%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e7%b3%bb%e5%88%97%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e7%9b%91%e5%90%ac%e5%99%a8Observer%e5%92%8c%e8%ae%a2%e9%98%85%e8%80%85Watcher"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fncyzwkqsp8%2f&is_video=false&description=Vue%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e7%b3%bb%e5%88%97%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e7%9b%91%e5%90%ac%e5%99%a8Observer%e5%92%8c%e8%ae%a2%e9%98%85%e8%80%85Watcher"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Vue%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e7%b3%bb%e5%88%97%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e7%9b%91%e5%90%ac%e5%99%a8Observer%e5%92%8c%e8%ae%a2%e9%98%85%e8%80%85Watcher&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fncyzwkqsp8%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fncyzwkqsp8%2f&title=Vue%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e7%b3%bb%e5%88%97%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e7%9b%91%e5%90%ac%e5%99%a8Observer%e5%92%8c%e8%ae%a2%e9%98%85%e8%80%85Watcher"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fncyzwkqsp8%2f&title=Vue%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e7%b3%bb%e5%88%97%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e7%9b%91%e5%90%ac%e5%99%a8Observer%e5%92%8c%e8%ae%a2%e9%98%85%e8%80%85Watcher"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fncyzwkqsp8%2f&title=Vue%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e7%b3%bb%e5%88%97%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e7%9b%91%e5%90%ac%e5%99%a8Observer%e5%92%8c%e8%ae%a2%e9%98%85%e8%80%85Watcher"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fncyzwkqsp8%2f&title=Vue%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e7%b3%bb%e5%88%97%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e7%9b%91%e5%90%ac%e5%99%a8Observer%e5%92%8c%e8%ae%a2%e9%98%85%e8%80%85Watcher"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Vue双向绑定的实现原理系列（三）：监听器Observer和订阅者Watcher</h1><div class="meta"><div class="postdate"><time datetime="2018-12-14" itemprop="datePublished">2018-12-14</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e监听器Observer和订阅者Watcher\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e实现简单版Vue的过程，主要实现\x22{{\x22\x22}}\x22、v-model和事件指令的功能\x3c\/h3\x3e\n\x3ch4\x3e主要分为三个部分\x3c\/h4\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/fypShirley\/vue_Source_analysis\/tree\/master\/2_vue%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A\/first\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egithub源码\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 1.数据监听器Observer，能够对数据对象的所有属性进行监听;\n    实现数据的双向绑定，首先要对数据进行劫持监听，所以我们需要设置一个监听器Observer，用来监听所有属性\n \n 2.Watcher将数据监听器和指令解析器连接起来，数据的属性变动时，执行指令绑定的相应回调函数，\n    1.如果属性发上变化了，就需要告诉订阅者Watcher看是否需要更新。\n    \n 3.指令解析器Compile，\n    对每个节点元素进行扫描和解析，将相关指令对应初始化成一个订阅者Watcher\n\n 因为订阅者是有很多个，所以我们需要有一个消息订阅器Dep来专门收集这些订阅者，然后在监听器Observer和订阅者Watcher之间进行统一管理的。=\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e \x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e数据监听器Observer，能够对数据对象的所有属性进行监听;\n    实现数据的双向绑定，首先要对数据进行劫持监听，所以我们需要设置一个监听器Observer，用来监听所有属性\n \n \x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3eWatcher将数据监听器和指令解析器连接起来，数据的属性变动时，执行指令绑定的相应回调函数，\n    \x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e如果属性发上变化了，就需要告诉订阅者Watcher看是否需要更新。\n    \n \x3cspan class=\x22hljs-number\x22\x3e3.\x3c\/span\x3e指令解析器Compile，\n    对每个节点元素进行扫描和解析，将相关指令对应初始化成一个订阅者Watcher\n\n 因为订阅者是有很多个，所以我们需要有一个消息订阅器Dep来专门收集这些订阅者，然后在监听器Observer和订阅者Watcher之间进行统一管理的。=\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\n\x3cp\x3e监听器Observer\x3c\/p\x3e\n\x3cblockquote\x3eObserver是一个数据监听器，核心是前面一直谈论的Object.defineProperty(),\x3cbr\x3e对所有属性监听，利用递归来遍历所有的属性值，对其进行Object.defineProperty()操作：\x3c\/blockquote\x3e\n\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function definReactive(data,key,val){\n        observers(val);\/\/递归所有子属性\n    \n        Object.defineProperty(data,key,{\n            enumerable:true,\n            configurable:true,\n            get:function(){\n                console.log(\x27属性\x27\x2bkey\x2b\x27执行get\x27);\n                return val;\n            },\n            set:function(newVal){\n                val = newVal;\n                console.log(\x27属性：\x27\x2bkey\x2b\x27以及被监听，现在值为：\x27\x2bnewVal.toString());\n            }\n        })\n    }\n    \n    function observers(data){\n        if(!data || typeof data!=\x27object\x27){\n            return;\n        }\n        Object.keys(data).forEach(function(key){\n            definReactive(data,key,data[key]);\n        })\n    }\n    var library = {\n        book1:{name:\x27\x27},\n        book2:\x27\x27\n    }\n    observers(library);\n\n    library.book1.name = \x27vue书籍\x27;\n    library.book2 = \x27没有书\x27;\n    \/\/属性book1执行get\n    \/\/属性：name以及被监听，现在值为：vue书籍\n    \/\/属性：book2以及被监听，现在值为：没有书 \n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e definReactive(data,key,val){\n        observers(val);\/\/递归所有子属性\n    \n        Object.defineProperty(data,key,{\n            enumerable:\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n            configurable:\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n            get:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(){\n                console.log(\x3cspan class=\x22hljs-string\x22\x3e\x27属性\x27\x3c\/span\x3e\x2bkey\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27执行get\x27\x3c\/span\x3e);\n                \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e val;\n            },\n            \x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3e:\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(newVal){\n                val = newVal;\n                console.log(\x3cspan class=\x22hljs-string\x22\x3e\x27属性：\x27\x3c\/span\x3e\x2bkey\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27以及被监听，现在值为：\x27\x3c\/span\x3e\x2bnewVal.toString());\n            }\n        })\n    }\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e observers(data){\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!data || typeof data!=\x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e;\n        }\n        Object.keys(data).forEach(\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(key){\n            definReactive(data,key,data[key]);\n        })\n    }\n    var library = {\n        book1:{name:\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e},\n        book2:\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e\n    }\n    observers(library);\n\n    library.book1.name = \x3cspan class=\x22hljs-string\x22\x3e\x27vue书籍\x27\x3c\/span\x3e;\n    library.book2 = \x3cspan class=\x22hljs-string\x22\x3e\x27没有书\x27\x3c\/span\x3e;\n    \/\/属性book1执行get\n    \/\/属性：name以及被监听，现在值为：vue书籍\n    \/\/属性：book2以及被监听，现在值为：没有书 \n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来创建一个收集所有订阅者的订阅器Dep,阅器Dep主要负责收集订阅者，然后再属性变化的时候执行对应订阅者的更新函数,\x3cbr\x3e再改写一下订阅器Observer，创建一个observer.js：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function Observe(data){\n        this.data = data;\n        this.walk(data);\n    }\n    Observe.prototype = {\n        walk:function(data){\n            var self = this;\n            Object.keys(data).forEach(function(key) {\n                self.defineReactive(data, key, data[key]);\n            });\n        },\n        defineReactive:function(data,key,val){\n            observers(val);\/\/递归所有子属性\n            var dep = new Dep();\n\n            Object.defineProperty(data,key,{\n                enumerable:true,\n                configurable:true,\n                get:function(){\n                    if(是否需要添加订阅者){\n                        dep.addSub(Watcher);\/\/在这里添加一个订阅者\n                    }\n                    console.log(\x27属性\x27\x2bkey\x2b\x27执行get\x27);\n                    return val;\n                },\n                set:function(newVal){\n                    if(val === newVal){\n                        return;\n                    }\n                    val = newVal;\n                    dep.notify();\/\/如果数据变化，通知所有订阅者\n                    console.log(\x27属性：\x27\x2bkey\x2b\x27以及被监听，现在值为：\x27\x2bnewVal.toString());\n                }\n            })\n        }\n    }\n    function observers(data){\n        if(!data || typeof data!=\x27object\x27){\n            return;\n        }\n        return new Observe(data);\n    }\n       \n\n    \/**Dep:创建一个可以容纳订阅者的消息订阅器\n     * **\/\n\n    function Dep(){\n        this.subs = [];\n    }\n    Dep.prototype = {\n        addSub:function(sub){\/\/添加订阅者\n            this.subs.push(sub);\n        },\n        notify:function(){\/\/通知订阅者\n            this.subs.forEach(function(sub){\n                sub.update();\n            })\n        }\n    }\n    \n    可以看出，订阅器Dep,添加一个订阅者是在Object.defineProperty()的get里面,这是为了让Watcher初始化进行触发，\n    因此要判断是不是需要添加订阅者，后面解释。在set里面，如果数据变化，就会通知所有的订阅者，订阅者就会去执行对应的更新的函数\n    以上，一个完整的订阅器完成。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e Observe(data){\n        this.data = data;\n        this.walk(data);\n    }\n    Observe.prototype = {\n        walk:\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(data){\n            var self = this;\n            Object.keys(data).forEach(\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(key) {\n                self.defineReactive(data, key, data[key]);\n            });\n        },\n        defineReactive:\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(data,key,val){\n            observers(val);\/\/递归所有子属性\n            var dep = new Dep();\n\n            Object.defineProperty(data,key,{\n                enumerable:\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n                configurable:\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n                get:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(){\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(是否需要添加订阅者){\n                        dep.addSub(Watcher);\/\/在这里添加一个订阅者\n                    }\n                    console.log(\x3cspan class=\x22hljs-string\x22\x3e\x27属性\x27\x3c\/span\x3e\x2bkey\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27执行get\x27\x3c\/span\x3e);\n                    \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e val;\n                },\n                \x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3e:\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(newVal){\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(val === newVal){\n                        \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e;\n                    }\n                    val = newVal;\n                    dep.notify();\/\/如果数据变化，通知所有订阅者\n                    console.log(\x3cspan class=\x22hljs-string\x22\x3e\x27属性：\x27\x3c\/span\x3e\x2bkey\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27以及被监听，现在值为：\x27\x3c\/span\x3e\x2bnewVal.toString());\n                }\n            })\n        }\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e observers(data){\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!data || typeof data!=\x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e new Observe(data);\n    }\n       \n\n    \/**Dep:创建一个可以容纳订阅者的消息订阅器\n     * **\/\n\n    \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3eDep\x3c\/span\x3e\x3c\/span\x3e(){\n        this.subs = [];\n    }\n    Dep.prototype = {\n        addSub:\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(sub){\/\/添加订阅者\n            this.subs.push(sub);\n        },\n        notify:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(){\/\/通知订阅者\n            this.subs.forEach(\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(sub){\n                sub.update();\n            })\n        }\n    }\n    \n    可以看出，订阅器Dep,添加一个订阅者是在Object.defineProperty()的get里面,这是为了让Watcher初始化进行触发，\n    因此要判断是不是需要添加订阅者，后面解释。在\x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3e里面，如果数据变化，就会通知所有的订阅者，订阅者就会去执行对应的更新的函数\n    以上，一个完整的订阅器完成。\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\n\x3cp\x3e订阅者Watcher\x3c\/p\x3e\n\x3cblockquote\x3eWatcher在初始化的时候要将自己添加进订阅者Dep中，如何做到：\x3cp\x3e已经知道监听器Observer是在get函数执行了添加订阅者Wather的操作的，\x3c\/p\x3e\n\x3cp\x3e所以我们只要在订阅者Watcher初始化的时候触发对应的get函数，去执行添加订阅者操作即可，\x3c\/p\x3e\n\x3cp\x3e那要如何触发get的函数:\x3c\/p\x3e\n\x3cp\x3e只要获取对应的属性值就可以触发了，核心原因就是因为我们使用了Object.defineProperty()进行数据监听。\x3c\/p\x3e\n\x3cp\x3e注意：\x3c\/p\x3e\n\x3cp\x3e我们只要在订阅者Watcher初始化的时候才需要添加订阅者，所以需要做一个判断操作，\x3c\/p\x3e\n\x3cp\x3e因此可以在订阅器上做一下手脚：在Dep.target上缓存下订阅者，添加成功后再将其去掉就可以了。\x3c\/p\x3e\n\x3cp\x3e创建一个watcher.js\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function Watcher(vm,exp,cb){\n        this.cb = cb;\n        this.vm = vm;\n        this.exp = exp;\n        this.value = this.get();\/\/将自己添加到订阅器的操作\n    }\n    Watcher.prototype = {\n        update:function () {\n            this.run();\n        },\n        run:function () {\n            var value = this.vm.data[this.exp];\n            var oldVal = this.value;\n            if(value != oldVal){\n                this.value = value;\n                this.cb.call(this.vm,value,oldVal);\n            }\n        },\n        get:function () {\n            Dep.target = this;\/\/缓存自己\n            var value = this.vm.data[this.exp];\/\/强制执行监听器observer里的Object.defineProperty()里的get函数\n            Dep.target = null;\/\/释放自己\n            return value;\n        }\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e Watcher(vm,exp,cb){\n        this.cb = cb;\n        this.vm = vm;\n        this.exp = exp;\n        this.value = this.get();\/\/将自己添加到订阅器的操作\n    }\n    Watcher.prototype = {\n        update:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e () {\n            this.run();\n        },\n        run:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e () {\n            var value = this.vm.data[this.exp];\n            var oldVal = this.value;\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(value != oldVal){\n                this.value = value;\n                this.cb.call(this.vm,value,oldVal);\n            }\n        },\n        get:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e () {\n            Dep.target = this;\/\/缓存自己\n            var value = this.vm.data[this.exp];\/\/强制执行监听器observer里的Object.defineProperty()里的get函数\n            Dep.target = null;\/\/释放自己\n            \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e value;\n        }\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e再调整下observer.js的defineReactive函数里的get操作：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    defineReactive:function(data,key,val){\n        observers(val);\/\/递归所有子属性\n        var dep = new Dep();\n\n        Object.defineProperty(data,key,{\n            enumerable:true,\n            configurable:true,\n            get:function(){\n                if(Dep.target){\n                    dep.addSub(Dep.target);\/\/在这里添加一个订阅者\n                }\n                console.log(\x27属性\x27\x2bkey\x2b\x27执行get\x27);\n                return val;\n            },\n            set:function(newVal){\n                if(val === newVal){\n                    return;\n                }\n                val = newVal;\n                dep.notify();\/\/如果数据变化，通知所有订阅者\n                console.log(\x27属性：\x27\x2bkey\x2b\x27以及被监听，现在值为：\x27\x2bnewVal.toString());\n            }\n        })\n    }\n    \/\/Dep加个target属性\n    function Dep(){\n        this.subs = [];\n        this.target = null;\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e    defineReactive:\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(data,key,val){\n        observers(val);\/\/递归所有子属性\n        var dep = new Dep();\n\n        Object.defineProperty(data,key,{\n            enumerable:\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n            configurable:\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n            get:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(){\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(Dep.target){\n                    dep.addSub(Dep.target);\/\/在这里添加一个订阅者\n                }\n                console.log(\x3cspan class=\x22hljs-string\x22\x3e\x27属性\x27\x3c\/span\x3e\x2bkey\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27执行get\x27\x3c\/span\x3e);\n                \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e val;\n            },\n            \x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3e:\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(newVal){\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(val === newVal){\n                    \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e;\n                }\n                val = newVal;\n                dep.notify();\/\/如果数据变化，通知所有订阅者\n                console.log(\x3cspan class=\x22hljs-string\x22\x3e\x27属性：\x27\x3c\/span\x3e\x2bkey\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27以及被监听，现在值为：\x27\x3c\/span\x3e\x2bnewVal.toString());\n            }\n        })\n    }\n    \/\/Dep加个target属性\n    \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3eDep\x3c\/span\x3e\x3c\/span\x3e(){\n        this.subs = [];\n        this.target = null;\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e简单版的Watcher设计好了，\x3cbr\x3e只要将Observer和Watcher关联起来，就可以实现一个简单的双向绑定数据了。\x3cbr\x3e这里没有还没有设计解析器Compile，所以对于模板数据我们都进行写死处理：\x3cbr\x3e模板有个节点，id为name,双向数据绑定的变量name，这里大框号暂时没有用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cbody\x3e \n    \x3ch1 id=\x26quot;name\x26quot;\x3e\x22{{\x22name\x22}}\x22\x3c\/h1\x3e \n\x3c\/body\x3e\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e\x26lt;body\x26gt; \n    \x26lt;h1 id=\x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e\x26gt;\x22{{\x22name\x22}}\x22\x26lt;\/h1\x26gt; \n\x26lt;\/body\x26gt;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3eselVue.js 关联Observer和Watcher\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function SelfVue(data,el,exp){\n        this.data = data;\n        observers(data);\n        el.innerHTML = this.data[exp];\/\/初始化模板数据的值\n        \n        new Watcher(this,exp,function(value){\n            el.innerHTML = value;\n        });\n        return this;\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e SelfVue(data,el,exp){\n        this.data = data;\n        observers(data);\n        el.innerHTML = this.data[exp];\/\/初始化模板数据的值\n        \n        new Watcher(this,exp,\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(value){\n            el.innerHTML = value;\n        });\n        \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e this;\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e页面上实现双向数据绑定：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ch1 id=\x26quot;name\x26quot;\x3e\x22{{\x22name\x22}}\x22\x3c\/h1\x3e\n    \x3cscript src=\x26quot;js\/observer.js\x26quot;\x3e\x3c\/script\x3e\n    \x3cscript src=\x26quot;js\/watcher.js\x26quot;\x3e\x3c\/script\x3e\n    \x3cscript src=\x26quot;js\/selfVue.js\x26quot;\x3e\x3c\/script\x3e\n    \x3cscript\x3e\n        var ele = document.querySelector(\x27#name\x27);\n        var self_Vue = new SelfVue({\n            name:\x27第一次显示数据\x27\n        },ele,\x27name\x27);\n    \n        window.setTimeout(function(){\n            console.log(\x27值变了\x27);\n            self_Vue.data.name = \x27重新赋值了\x27;\n        },2000);\n    \x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e\x26lt;h1 id=\x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e\x26gt;\x22{{\x22name\x22}}\x22\x26lt;\/h1\x26gt;\n    \x26lt;script src=\x3cspan class=\x22hljs-string\x22\x3e\x22js\/observer.js\x22\x3c\/span\x3e\x26gt;\x26lt;\/script\x26gt;\n    \x26lt;script src=\x3cspan class=\x22hljs-string\x22\x3e\x22js\/watcher.js\x22\x3c\/span\x3e\x26gt;\x26lt;\/script\x26gt;\n    \x26lt;script src=\x3cspan class=\x22hljs-string\x22\x3e\x22js\/selfVue.js\x22\x3c\/span\x3e\x26gt;\x26lt;\/script\x26gt;\n    \x26lt;script\x26gt;\n        var ele = document.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27#name\x27\x3c\/span\x3e);\n        var self_Vue = new SelfVue({\n            name:\x3cspan class=\x22hljs-string\x22\x3e\x27第一次显示数据\x27\x3c\/span\x3e\n        },ele,\x3cspan class=\x22hljs-string\x22\x3e\x27name\x27\x3c\/span\x3e);\n    \n        window.setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(){\n            console.log(\x3cspan class=\x22hljs-string\x22\x3e\x27值变了\x27\x3c\/span\x3e);\n            self_Vue.data.name = \x3cspan class=\x22hljs-string\x22\x3e\x27重新赋值了\x27\x3c\/span\x3e;\n        },2000);\n    \x26lt;\/script\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e打开页面，可以看到页面刚开始显示了是“第一次显示数据”，过了2s后就变成“重新赋值了”了。到这里，完成了一部分\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22注意：赋值的时候是 self_Vue.data.name = \x27重新赋值了\x27，但是希望是 self_Vue.name = \x27重新赋值了\x27，\n需要在new SelVue的时候做个代理，让访问self_Vue的属性代理为访问self_Vue.data的属性，\n实现原理还是使用Object.defineProperty()对属性再包一层，\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e注意：赋值的时候是 self_Vue\x3cspan class=\x22hljs-selector-class\x22\x3e.data\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.name\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27重新赋值了\x27\x3c\/span\x3e，但是希望是 self_Vue\x3cspan class=\x22hljs-selector-class\x22\x3e.name\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27重新赋值了\x27\x3c\/span\x3e，\n需要在new SelVue的时候做个代理，让访问self_Vue的属性代理为访问self_Vue.data的属性，\n实现原理还是使用Object.defineProperty()对属性再包一层，\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e修改selVue.js：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function SelfVue(data,el,exp){\n        var self = this;\n        this.data = data;\n    \n        Object.keys(data).forEach(function (key) {\n            self.proxyKeys(key);\/\/绑定代理属性\n        });\n        \n        observers(data);\n        el.innerHTML = this.data[exp];\/\/初始化模板数据的值\n        new Watcher(this,exp,function(value){\n            el.innerHTML = value;\n        });\n        return this;\n    }\n    \n    SelfVue.prototype = {\n        proxyKeys:function(key){\n            var self = this;\n            Object.defineProperty(this,key,{\n                enumerable:false,\n                configurable:true,\n                get:function proxyGetter(){\n                    return self.data[key];\n                },\n                set:function proxySetter(newVal){\n                    self.data[key] = newVal;\n                }\n            })\n        }\n    }\n\n    \/\/这下我们就可以直接通过self_Vue.name = \x27重新赋值了\x27的形式来进行改变模板数据。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e SelfVue(data,el,exp){\n        var self = this;\n        this.data = data;\n    \n        Object.keys(data).forEach(\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (key) {\n            self.proxyKeys(key);\/\/绑定代理属性\n        });\n        \n        observers(data);\n        el.innerHTML = this.data[exp];\/\/初始化模板数据的值\n        new Watcher(this,exp,\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(value){\n            el.innerHTML = value;\n        });\n        \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e this;\n    }\n    \n    SelfVue.prototype = {\n        proxyKeys:\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(key){\n            var self = this;\n            Object.defineProperty(this,key,{\n                enumerable:\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n                configurable:\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n                get:\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3eproxyGetter\x3c\/span\x3e\x3c\/span\x3e(){\n                    \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e self.data[key];\n                },\n                \x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3e:\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e proxySetter(newVal){\n                    self.data[key] = newVal;\n                }\n            })\n        }\n    }\n\n    \/\/这下我们就可以直接通过self_Vue.name = \x3cspan class=\x22hljs-string\x22\x3e\x27重新赋值了\x27\x3c\/span\x3e的形式来进行改变模板数据。\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e至此监听器Observer和订阅者Watcher功能基本完成，后面再加上指令解析器compile的功能！\x3c\/p\x3e\n\x3ch4\x3e系列文章的目录:\x3c\/h4\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000013035407\x22\x3eVue双向绑定的实现原理系列（一）：Object.defineproperty\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000013051584\x22 target=\x22_blank\x22\x3eVue双向绑定的实现原理系列（二）：设计模式\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000013159255\x22\x3eVue双向绑定的实现原理系列（三）：监听器Observer和订阅者Watcher\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000013169852\x22 target=\x22_blank\x22\x3eVue双向绑定的实现原理系列（四）：补充指令解析器compile\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Vue双向绑定的实现原理系列（三）：监听器Observer和订阅者Watcher</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013159255">https://segmentfault.com/a/1190000013159255</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ncyzwkqsp8/" target="_blank">https://alili.tech/archive/ncyzwkqsp8/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>