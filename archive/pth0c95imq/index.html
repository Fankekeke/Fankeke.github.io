<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="实现一个简单的双向绑定"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>实现一个简单的双向绑定 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/pth0c95imq/",
				"appid": "1613049289050283", 
				"title": "实现一个简单的双向绑定 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-31T02:30:30"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/jw7c98iafc9/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/h033xi7ti34/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fpth0c95imq%2f&text=%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fpth0c95imq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fpth0c95imq%2f&text=%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fpth0c95imq%2f&title=%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fpth0c95imq%2f&is_video=false&description=%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fpth0c95imq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fpth0c95imq%2f&title=%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpth0c95imq%2f&title=%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpth0c95imq%2f&title=%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpth0c95imq%2f&title=%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">实现一个简单的双向绑定</h1><div class="meta"><div class="postdate"><time datetime="2018-12-31" itemprop="datePublished">2018-12-31</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e接触Vue有一段时间了，但是对于其双向绑定的实现一直是似懂非懂，今天看到一篇写的比较好的文章 \x3ca href=\x22https:\/\/ghoskno.github.io\/2017\/02\/21\/vue-bind\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e传送门1\x3c\/a\x3e 根据原作者的指导自己也去实现了一遍简单的 demo （本文的demo均基于Object.defineProperty 实现数据劫持，利用了对Vue.js实现双向绑定的思想）\x3c\/p\x3e\n\x3cp\x3e[注]本文所有图片均来自于：\x3ca href=\x22https:\/\/github.com\/DMQ\/mvvm#_2\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e传送门2\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3e前言\x3c\/h1\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e几种主流的双向绑定\x3c\/h2\x3e\n\x3cp\x3e1.发布-订阅模式\x3cbr\x3e2.脏值检测\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e通过对比数据是否有变更，来决定是否更新视图。最简单的可以通过定时轮询去检测数据的变动。当然Google不会这么low, Angular 只有在指定事件触发时进入脏值检测：\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cul\x3e\n\x3cli\x3eDOM事件，比如用户输入文本点击按钮等（ng-click）\x3c\/li\x3e\n\x3cli\x3eXHR响应事件\x3c\/li\x3e\n\x3cli\x3e浏览器 Location 变更\x3c\/li\x3e\n\x3cli\x3eTimer事件\x3c\/li\x3e\n\x3cli\x3e执行 $digidt() 或 $apply()\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e3.数据劫持\x3cbr\x3eVue.js 采用的是 \x3ccode\x3e数据劫持\x2b发布\/订阅模式\x3c\/code\x3e 的方式，通过 \x3ccode\x3eObject.defineProperty()\x3c\/code\x3e 来劫持各个属性的 setter\/getter， 在数据变动时发布消息给订阅者（Wacther）, 触发相应的监听回调。下图展示了Vue实现双向绑定的流程\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVBQYu?w=730\x26amp;h=390\x22 src=\x22https:\/\/static.alili.tech\/img\/bVBQYu?w=730\x26amp;h=390\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e实现一个简单的双向绑定\x3c\/h1\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE html\x3e\n\x3chtml lang=\x26quot;en\x26quot;\x3e\n    \x3chead\x3e\n        \x3ctitle\x3e双向绑定最最最初级demo\x3c\/title\x3e\n        \x3cmeta charset=\x26quot;UTF-8\x26quot;\x3e\n    \x3c\/head\x3e\n    \x3cbody\x3e\n        \x3cdiv id=\x26quot;app\x26quot;\x3e\n            \x3cinput type=\x26quot;text\x26quot; id=\x26quot;txt\x26quot;\x3e\n            \x3cp id=\x26quot;show-txt\x26quot;\x3e\x3c\/p\x3e\n        \x3c\/div\x3e\n    \x3c\/body\x3e\n    \x3cscript\x3e\n        var obj={}\n        Object.defineProperty(obj,\x27txt\x27,{\n            get:function(){\n                return obj\n            },\n            set:function(newValue){\n                document.getElementById(\x27txt\x27).value = newValue\n                document.getElementById(\x27show-txt\x27).innerHTML = newValue\n            }\n        })\n        document.addEventListener(\x27keyup\x27,function(e){\n            obj.txt = e.target.value\n        })\n    \x3c\/script\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elang\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22en\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e双向绑定最最最初级demo\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22UTF-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22app\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22txt\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22show-txt\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e obj={}\n        \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(obj,\x3cspan class=\x22hljs-string\x22\x3e\x27txt\x27\x3c\/span\x3e,{\n            \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e obj\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3eset\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enewValue\x3c\/span\x3e)\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27txt\x27\x3c\/span\x3e).value = newValue\n                \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27show-txt\x27\x3c\/span\x3e).innerHTML = newValue\n            }\n        })\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27keyup\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e)\x3c\/span\x3e{\n            obj.txt = e.target.value\n        })\n    \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3e进阶版demo\x3c\/h1\x3e\n\x3cp\x3eDOM操作是非常耗时和好性能，所以在优化过程中先从DOM操作入手。因为遍历解析过程中有多次DOM操作，为了提高性能和效率，需要一种方法来避免对DOM元素的直接封装操作。在Vue使用 \x3ccode\x3eDocumentFragment\x3c\/code\x3e 作为替代容器。\x3cbr\x3e\x3ccode\x3eDocumentFragment\x3c\/code\x3e 接口表示一个没有父级文件的最小文档对象。它被当做一个轻量版本的Document 使用。所以使用 DocumentFragment 代替DOM直接处理，可以提高性能和速度。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e封装DOM节点为 DocumentFragment\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/将传入 node 的子节点进行劫持，经过处理后重新挂载回目标节点\nfunction convertNode(node,vm){\n    var fragment = document.createDocumentFragment(),\n        child\n    while(child = node.firstChild){\n        \/\/将原生节点拷贝到 fragment，并删除之前的child节点\n        fragment.appendChild(child)\n    }\n    return fragment\n}\n\nvar dom = convertNode(document.getElementById(\x27app\x27))\ndocument.getElmentById(\x27app\x27).appendChild(dom)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/将传入 node 的子节点进行劫持，经过处理后重新挂载回目标节点\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3econvertNode\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enode,vm\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fragment = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createDocumentFragment(),\n        child\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(child = node.firstChild){\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/将原生节点拷贝到 fragment，并删除之前的child节点\x3c\/span\x3e\n        fragment.appendChild(child)\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fragment\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dom = convertNode(\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27app\x27\x3c\/span\x3e))\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElmentById(\x3cspan class=\x22hljs-string\x22\x3e\x27app\x27\x3c\/span\x3e).appendChild(dom)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e实现Complie解析模板指令\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVBQY3?w=625\x26amp;h=259\x22 src=\x22https:\/\/static.alili.tech\/img\/bVBQY3?w=625\x26amp;h=259\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eComplie 主要做的事情就是解析模板指令，将模板中的变量替换为数据。所以要遍历整个DOM树，进行扫描解析编译，调用对应的指令渲染函数进行渲染，并调用对应的指令更新函数进行绑定\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv id=\x26quot;app\x26quot;\x3e\n    \x3cinput type=\x26quot;text\x26quot; id=\x26quot;txt\x26quot; h-model=\x26quot;text\x26quot;\x3e\n    \x22{{\x22text\x22}}\x22\n\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs applescript\x22\x3e\x3ccode\x3e\x26lt;\x3cspan class=\x22hljs-keyword\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22app\x22\x3c\/span\x3e\x26gt;\n    \x26lt;input type=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22txt\x22\x3c\/span\x3e h-model=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e\x26gt;\n    \x22{{\x22\x3cspan class=\x22hljs-built_in\x22\x3etext\x3c\/span\x3e\x22}}\x22\n\x26lt;\/\x3cspan class=\x22hljs-keyword\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function convertNode(node,vm){\n    \/\/...\n    while(child = node.firstChild){\n        Compile(child,vm)\n        fragment.appendChild(child)\n    }\n    return fragment\n}\nfunction Compile(node,vm){\n    var reg = \/\\{\\{(.*)\\}\\}\/\n    if(node.nodeType===1){  \n        var attr = node.attributes  \/\/对所有属性进行解析\n        for(var i=0;i\x3cattr.length;i\x2b\x2b){\n            if(attr[i].nodeName==\x27h-model\x27){\n                \/\/将元素与数据绑定\n                var bindName = attr[i].nodeValue\n                \/\/为输入框添加事件监听触发\n                node.addEventListener(\x27input\x27,function(e){\n                    vm.data[bindName] = e.target.value\n                    node.value = vm.data[bindName]\n                })\n                node.removeAttribute(\x27h-model\x27);\n            }\n            if(node.nodeType===3){\n                if(reg.test(node.nodeValue)){\n                    var bindName = RegExp.$1.trim()\n                    console.log(RegExp.$1)\n                    node.nodeValue = vm.data[bindName]\n                }\n            }\n        }\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3econvertNode\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enode,vm\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(child = node.firstChild){\n        Compile(child,vm)\n        fragment.appendChild(child)\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fragment\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eCompile\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enode,vm\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e reg = \x3cspan class=\x22hljs-regexp\x22\x3e\/\\{\\{(.*)\\}\\}\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(node.nodeType===\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e){  \n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e attr = node.attributes  \x3cspan class=\x22hljs-comment\x22\x3e\/\/对所有属性进行解析\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i=\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;i\x26lt;attr.length;i\x2b\x2b){\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(attr[i].nodeName==\x3cspan class=\x22hljs-string\x22\x3e\x27h-model\x27\x3c\/span\x3e){\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/将元素与数据绑定\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e bindName = attr[i].nodeValue\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/为输入框添加事件监听触发\x3c\/span\x3e\n                node.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e)\x3c\/span\x3e{\n                    vm.data[bindName] = e.target.value\n                    node.value = vm.data[bindName]\n                })\n                node.removeAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x27h-model\x27\x3c\/span\x3e);\n            }\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(node.nodeType===\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e){\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(reg.test(node.nodeValue)){\n                    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e bindName = \x3cspan class=\x22hljs-built_in\x22\x3eRegExp\x3c\/span\x3e.$\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3etrim()\n                    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-built_in\x22\x3eRegExp\x3c\/span\x3e.$\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\n                    node.nodeValue = vm.data[bindName]\n                }\n            }\n        }\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3eViewModel 层向 View 层的数据绑定\x3c\/h2\x3e\n\x3cp\x3e接下来实现一个 \x3ccode\x3eXin\x3c\/code\x3e 构造器，通过 Compile 来解析模板指令，通过 Observer 监听属性数据的变化实现 \x3ccode\x3eModel\x3c\/code\x3e 层向 \x3ccode\x3eView\x3c\/code\x3e 层的数据绑定\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function Xin(options){\n    this.data = options.data\n    Observer(this.data,this)\n    var id = options.el\n    var dom = convertNode(document.getElementById(id),this)\n    document.getElementById(id).appendChild(dom)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eXin\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.data = options.data\n    Observer(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.data,\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e id = options.el\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dom = convertNode(\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(id),\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(id).appendChild(dom)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e新建一个 vm 实例来测试一下 \x3ccode\x3eModel --\x26gt; View\x3c\/code\x3e 的绑定情况\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var vm = new Xin({\n    el:\x27app\x27,\n    data:{\n        text:\x27Hello MVVM\x27\n    }\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e vm = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Xin({\n    \x3cspan class=\x22hljs-attr\x22\x3eel\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27app\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e:{\n        \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27Hello MVVM\x27\x3c\/span\x3e\n    }\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader7\x22\x3eView 层向 viewModel 层的数据绑定\x3c\/h1\x3e\n\x3cp\x3e实际上，在 Observer 中我们已经通过 \x3ccode\x3e数据劫持\x3c\/code\x3e 实现了监听每个数据的变化，在控制台打印 \x3ccode\x3econsole.log(val)\x3c\/code\x3e 就可以实时看到数据的变化。所以接下来实现的关键就是怎么用监听到的数据去更新视图。 \x3cbr\x3e在这里，我们去实现一个 \x3ccode\x3eWacther\x3c\/code\x3e 可以将它理解为观察者 ，他的作用是能够接收从 Observer 发过来的属性变动通知， 然后根据属性的变动更新视图 \x3ccode\x3eupdate\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e在监听过程中，为所有的 data 属性生成一个主题对象 Dep，Dep中包含需要维护的观察者列表。每当主题对象状态发生变化时，其相关依赖都会得到通知，并且被自动更新（数据变动会触发notify，再调用订阅者的update() 方法）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function Dep(){\n    this.subs=[]    \/\/订阅者队列\n}\nDep.prototype={\n    addSub:function(sub){\n        this.subs.push(sub)\n    },\n    notify:function(){\n        this.subs.forEach(function(sub){\n            sub.update()\n        })\n    }\n}\n\nfuncion Watcher(vm,node,bindName){\n    \/\/将全局Dep.target设置为当前页面元素node\n    Dep.target = this\n    \/\/完成watcher的初始化\n    this.name = bindName\n    this.node = node\n    this.vm = vm\n\n    this.update()    \/\/初次绑定时进行更新\n    Dep.target = null    \/\/保证Dep.target唯一\n}\n\nWatcher.prototype = {\n    get:function(){\n        this.value = this.vm.data[this.name]\n    },\n    update:function(){\n        this.get()\n        this.node.nodeValue = this.value\n    }\n}\n\nfunction Observer(obj,vm){\n    \/\/...\n    Object.defineProperty(obj,prop,{\n        get:function(){...},\n        set:function(newVal){\n            if(val == newVal) return\n            val = newVal\n            \/\/data属性被修改，由dep触发view层更新\n            dep.notify()\n        }\n    })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eDep\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs=[]    \x3cspan class=\x22hljs-comment\x22\x3e\/\/订阅者队列\x3c\/span\x3e\n}\nDep.prototype={\n    \x3cspan class=\x22hljs-attr\x22\x3eaddSub\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esub\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs.push(sub)\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3enotify\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esub\x3c\/span\x3e)\x3c\/span\x3e{\n            sub.update()\n        })\n    }\n}\n\nfuncion Watcher(vm,node,bindName){\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/将全局Dep.target设置为当前页面元素node\x3c\/span\x3e\n    Dep.target = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/完成watcher的初始化\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name = bindName\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.node = node\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.vm = vm\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.update()    \x3cspan class=\x22hljs-comment\x22\x3e\/\/初次绑定时进行更新\x3c\/span\x3e\n    Dep.target = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/保证Dep.target唯一\x3c\/span\x3e\n}\n\nWatcher.prototype = {\n    \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.vm.data[\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name]\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3eupdate\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.get()\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.node.nodeValue = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value\n    }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eObserver\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj,vm\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(obj,prop,{\n        \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{...},\n        \x3cspan class=\x22hljs-attr\x22\x3eset\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enewVal\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(val == newVal) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n            val = newVal\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/data属性被修改，由dep触发view层更新\x3c\/span\x3e\n            dep.notify()\n        }\n    })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e考虑这样一个问题，什么时候会有双向绑定？ \x3ccode\x3eviewModel --\x26gt; view\x3c\/code\x3e 可能会发生在所有类型的DOM节点上，而 \x3ccode\x3eview --\x26gt; viewModel\x3c\/code\x3e 只能发生在 input, select, textarea 等交互控件上。所以将文本节点包装成 \x3ccode\x3eWatcher\x3c\/code\x3e , 添加相关元素的观察者列表中，Watcher 负责更新页面元素\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function Compile(node,vm){\n    \/\/...\n    if(node.nodeType ===3){    \/\/文本节点类型\n        if(reg.test(node.nodeValue)){\n            var bindName = RegExp.$1.trim()\n            new Watcher = (vm,node,bindName)    \/\/为该页面元素node生产watcher\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eCompile\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enode,vm\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(node.nodeType ===\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e){    \x3cspan class=\x22hljs-comment\x22\x3e\/\/文本节点类型\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(reg.test(node.nodeValue)){\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e bindName = \x3cspan class=\x22hljs-built_in\x22\x3eRegExp\x3c\/span\x3e.$\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3etrim()\n            \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Watcher = (vm,node,bindName)    \x3cspan class=\x22hljs-comment\x22\x3e\/\/为该页面元素node生产watcher\x3c\/span\x3e\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader8\x22\x3e更新\x3c\/h1\x3e\n\x3cp\x3e本文中实现模板渲染的方法借鉴了 \x3ccode\x3eVue 1.x\x3c\/code\x3e 中实现模板渲染的方法。\x3cbr\x3e\x3ccode\x3eVue 2.x\x3c\/code\x3e 模板渲染 方法借鉴React 中的 \x3cstrong\x3eVirtualDOM\x3c\/strong\x3e，基于 VirtualDOM。 Vue 2.x 还支持服务端渲染SSR\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader9\x22\x3e资料参考\x3c\/h1\x3e\n\x3cp\x3e1.\x3ca href=\x22https:\/\/github.com\/DMQ\/mvvm#_2\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/DMQ\/mvvm#_2\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>实现一个简单的双向绑定</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011225943">https://segmentfault.com/a/1190000011225943</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/pth0c95imq/" target="_blank">https://alili.tech/archive/pth0c95imq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>