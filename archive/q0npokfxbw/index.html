<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="js控制文件拖拽，获取拖拽内容。"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>js控制文件拖拽，获取拖拽内容。 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/q0npokfxbw/",
				"appid": "1613049289050283", 
				"title": "js控制文件拖拽，获取拖拽内容。 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-13T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/9bd0m4mlh69/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/40i69nnd3ar/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fq0npokfxbw%2f&text=js%e6%8e%a7%e5%88%b6%e6%96%87%e4%bb%b6%e6%8b%96%e6%8b%bd%ef%bc%8c%e8%8e%b7%e5%8f%96%e6%8b%96%e6%8b%bd%e5%86%85%e5%ae%b9%e3%80%82"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fq0npokfxbw%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fq0npokfxbw%2f&text=js%e6%8e%a7%e5%88%b6%e6%96%87%e4%bb%b6%e6%8b%96%e6%8b%bd%ef%bc%8c%e8%8e%b7%e5%8f%96%e6%8b%96%e6%8b%bd%e5%86%85%e5%ae%b9%e3%80%82"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fq0npokfxbw%2f&title=js%e6%8e%a7%e5%88%b6%e6%96%87%e4%bb%b6%e6%8b%96%e6%8b%bd%ef%bc%8c%e8%8e%b7%e5%8f%96%e6%8b%96%e6%8b%bd%e5%86%85%e5%ae%b9%e3%80%82"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fq0npokfxbw%2f&is_video=false&description=js%e6%8e%a7%e5%88%b6%e6%96%87%e4%bb%b6%e6%8b%96%e6%8b%bd%ef%bc%8c%e8%8e%b7%e5%8f%96%e6%8b%96%e6%8b%bd%e5%86%85%e5%ae%b9%e3%80%82"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=js%e6%8e%a7%e5%88%b6%e6%96%87%e4%bb%b6%e6%8b%96%e6%8b%bd%ef%bc%8c%e8%8e%b7%e5%8f%96%e6%8b%96%e6%8b%bd%e5%86%85%e5%ae%b9%e3%80%82&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fq0npokfxbw%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fq0npokfxbw%2f&title=js%e6%8e%a7%e5%88%b6%e6%96%87%e4%bb%b6%e6%8b%96%e6%8b%bd%ef%bc%8c%e8%8e%b7%e5%8f%96%e6%8b%96%e6%8b%bd%e5%86%85%e5%ae%b9%e3%80%82"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fq0npokfxbw%2f&title=js%e6%8e%a7%e5%88%b6%e6%96%87%e4%bb%b6%e6%8b%96%e6%8b%bd%ef%bc%8c%e8%8e%b7%e5%8f%96%e6%8b%96%e6%8b%bd%e5%86%85%e5%ae%b9%e3%80%82"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fq0npokfxbw%2f&title=js%e6%8e%a7%e5%88%b6%e6%96%87%e4%bb%b6%e6%8b%96%e6%8b%bd%ef%bc%8c%e8%8e%b7%e5%8f%96%e6%8b%96%e6%8b%bd%e5%86%85%e5%ae%b9%e3%80%82"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fq0npokfxbw%2f&title=js%e6%8e%a7%e5%88%b6%e6%96%87%e4%bb%b6%e6%8b%96%e6%8b%bd%ef%bc%8c%e8%8e%b7%e5%8f%96%e6%8b%96%e6%8b%bd%e5%86%85%e5%ae%b9%e3%80%82"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">js控制文件拖拽，获取拖拽内容。</h1><div class="meta"><div class="postdate"><time datetime="2018-12-13" itemprop="datePublished">2018-12-13</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e在用户拖拽文件到浏览器的某个元素上时，js可以监听到与拖拽相关的事件，并对拖拽结果进行处理，本文讨论下和拖拽文件相关的一些问题，不过没有处理太多关于兼容性的问题。\x3c\/blockquote\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3e拖拽事件\x3c\/h1\x3e\n\x3cp\x3e\x3ccode\x3ejs\x3c\/code\x3e能够监听到拖拽的事件有\x3ccode\x3edrag\x3c\/code\x3e、\x3ccode\x3edragend\x3c\/code\x3e、\x3ccode\x3edragenter\x3c\/code\x3e、\x3ccode\x3edragexit(没有浏览器实现)\x3c\/code\x3e、\x3ccode\x3edragleave\x3c\/code\x3e、\x3ccode\x3edragover\x3c\/code\x3e、\x3ccode\x3edragstart\x3c\/code\x3e、\x3ccode\x3edrop\x3c\/code\x3e，详细的内容可以看\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/Events\/drag\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMDN\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e其中，与拖拽文件相关的事件有\x3ccode\x3edragenter(文件拖拽进)\x3c\/code\x3e、\x3ccode\x3edragover(文件拖拽在悬浮)\x3c\/code\x3e、\x3ccode\x3edragleave(文件拖拽离开)\x3c\/code\x3e、\x3ccode\x3edrop(文件拖拽放下)\x3c\/code\x3e。\x3cbr\x3e拖拽事件可以绑定到指定的DOM元素上，可以绑定到整个页面中。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var dropEle = document.querySelector(\x27#dropZone\x27);\ndropEle.addEventListener(\x27drop\x27, function (e) {\n    \/\/ \n}, false);\n\ndocument.addEventListener(\x27drop\x27, function (e) {\n    \/\/ \n}, false);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dropEle = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27#dropZone\x27\x3c\/span\x3e);\ndropEle.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27drop\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x3c\/span\x3e\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27drop\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x3c\/span\x3e\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e阻止默认行为\x3c\/h1\x3e\n\x3cp\x3e一般来说，我们只需要把处理拖拽文件的业务逻辑写到\x3ccode\x3edrop\x3c\/code\x3e事件中就可以了，为什么还要绑定\x3ccode\x3edragenter\x3c\/code\x3e、\x3ccode\x3edragover\x3c\/code\x3e、\x3ccode\x3edragleave\x3c\/code\x3e这三个事件呢？\x3c\/p\x3e\n\x3cp\x3e因为当你拖拽一个文件到没有对拖拽事件进行处理的浏览器中的时候，浏览器会打开这个文件，比如拖拽一张图片浏览器会打开这个图片，在没有PDF阅读器的时候也可以拖拽一个PDF到浏览器中，浏览器就会打开这个PDF文件。\x3c\/p\x3e\n\x3cp\x3e如果浏览器打开了拖拽的文件，页面就跳走了，我们希望得到拖拽的文件，而不是让页面跳走。上面说到浏览器会打开拖拽的文件是浏览器的默认行为，我们需要阻止这个默认行为，就需要再上述的事件中进行阻止。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22dropZone.addEventListener(\x26quot;dragenter\x26quot;, function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n}, false);\n\ndropZone.addEventListener(\x26quot;dragover\x26quot;, function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n}, false);\n\ndropZone.addEventListener(\x26quot;dragleave\x26quot;, function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n}, false);\n\ndropZone.addEventListener(\x26quot;drop\x26quot;, function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    \/\/ 处理拖拽文件的逻辑\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22dragenter\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault();\n    e.stopPropagation();\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\ndropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22dragover\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault();\n    e.stopPropagation();\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\ndropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22dragleave\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault();\n    e.stopPropagation();\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\ndropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22drop\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault();\n    e.stopPropagation();\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理拖拽文件的逻辑\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e实际上\x3ccode\x3edragenter\x3c\/code\x3e不阻止默认行为也不会触发浏览器打开文件，为了防止某些浏览器可能有的兼容性问题，把拖拽周期中的所有的事件都阻止默认行为并且阻止了事件冒泡。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e获得拖拽的文件\x3c\/h1\x3e\n\x3cp\x3e我们会在\x3ccode\x3edrop\x3c\/code\x3e这个事件的回调中的事件对象能够得到文件对象。\x3c\/p\x3e\n\x3cp\x3e在事件对象中，一个\x3ccode\x3ee.dataTransfer\x3c\/code\x3e这样的属性，它是一个\x3ccode\x3eDataTransfer\x3c\/code\x3e类型的数据，有如下的属性\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth align=\x22left\x22\x3e属性\x3c\/th\x3e\n\x3cth align=\x22left\x22\x3e类型\x3c\/th\x3e\n\x3cth align=\x22left\x22\x3e说明\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3edropEffect\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3eString\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e用来hack某些兼容性问题\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eeffectAllowed\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3eString\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e暂时不用\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3efiles\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3eFileList\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e拖拽的文件列表\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eitems\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3eDataTransferItemList\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e拖拽的数据(有可能是字符串)\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3etypes\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3eArray\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e拖拽的数据类型 该属性在Safari下比较混乱\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e在\x3ccode\x3eChrome\x3c\/code\x3e中我们用\x3ccode\x3eitems\x3c\/code\x3e对象获得文件，其他浏览器用\x3ccode\x3efiles\x3c\/code\x3e获得文件，主要是为了处理拖拽文件夹的问题，最好不允许用户拖拽文件夹，因为文件夹内可能还有文件夹，递归上传文件会很久，如果不递归查找，只上传目录第一层级的文件，用户可能以为上传功能了，但是没有上传子目录文件，所以还是禁止上传文件夹比较好，后面我会说要怎么处理。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3eChrome获取文件\x3c\/h1\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22dropZone.addEventListener(\x26quot;drop\x26quot;, function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    var df = e.dataTransfer;\n    var dropFiles = []; \/\/ 存放拖拽的文件对象\n    \n    if(df.items !== undefined) {\n        \/\/ Chrome有items属性，对Chrome的单独处理\n        for(var i = 0; i \x3c df.items.length; i\x2b\x2b) {\n            var item = df.items[i];\n            \/\/ 用webkitGetAsEntry禁止上传目录\n            if(item.kind === \x26quot;file\x26quot; \x26amp;\x26amp; item.webkitGetAsEntry().isFile) {\n                var file = item.getAsFile();\n                dropFiles.push(file);\n            }\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22drop\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault();\n    e.stopPropagation();\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e df = e.dataTransfer;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dropFiles = []; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 存放拖拽的文件对象\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(df.items !== \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Chrome有items属性，对Chrome的单独处理\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; df.items.length; i\x2b\x2b) {\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e item = df.items[i];\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用webkitGetAsEntry禁止上传目录\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(item.kind === \x3cspan class=\x22hljs-string\x22\x3e\x22file\x22\x3c\/span\x3e \x26amp;\x26amp; item.webkitGetAsEntry().isFile) {\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e file = item.getAsFile();\n                dropFiles.push(file);\n            }\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader4\x22\x3e其他浏览器获取文件\x3c\/h1\x3e\n\x3cp\x3e这里只测试了Safari，其他浏览器并没有测试，不过看完本文一定也有思路处理其他浏览器的兼容情况。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22dropZone.addEventListener(\x26quot;drop\x26quot;, function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    var df = e.dataTransfer;\n    var dropFiles = []; \/\/ 存放拖拽的文件对象\n    \n    if(df.items !== undefined) {\n        \/\/ Chrome拖拽文件逻辑\n    } else {\n        for(var i = 0; i \x3c df.files.length; i\x2b\x2b) {\n            dropFiles.push(df.files[i]);\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22drop\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault();\n    e.stopPropagation();\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e df = e.dataTransfer;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dropFiles = []; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 存放拖拽的文件对象\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(df.items !== \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Chrome拖拽文件逻辑\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; df.files.length; i\x2b\x2b) {\n            dropFiles.push(df.files[i]);\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由于\x3ccode\x3eSafari\x3c\/code\x3e没有\x3ccode\x3eitem\x3c\/code\x3e，自然也没有\x3ccode\x3ewebkitGetAsEntry\x3c\/code\x3e，所以在Safari无法确定拖拽的是否是文件还是文件夹。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e非Chrome内核浏览器判断目录的方法\x3c\/h2\x3e\n\x3cp\x3e浏览器获取到的每个file对象有四个属性：\x3ccode\x3elastModified\x3c\/code\x3e、\x3ccode\x3ename\x3c\/code\x3e、\x3ccode\x3esize\x3c\/code\x3e、\x3ccode\x3etype\x3c\/code\x3e，其中\x3ccode\x3etype\x3c\/code\x3e是文件的\x3ccode\x3eMIME Type\x3c\/code\x3e，文件夹的\x3ccode\x3etype\x3c\/code\x3e是空的，但是有些文件没有\x3ccode\x3eMIME Type\x3c\/code\x3e，如果按照\x3ccode\x3etype\x3c\/code\x3e是否为空判断是不是拖拽的文件夹的话，会误伤一部分文件，所以这个方法行。\x3c\/p\x3e\n\x3cp\x3e那么还有什么方法可以判断呢，思路大概是这样子的，用户拖拽的文件和文件夹应该是不一样的东西，用\x3ccode\x3eFile API\x3c\/code\x3e操作的时候应该会有区别，比如进行某些操作的时候，文件就能够正常操作，但是文件夹就会报错，通过错误的捕获就能够判断是文件还是文件夹了，好我们根据这个思路来写一下。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22dropZone.addEventListener(\x26quot;drop\x26quot;, function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    var df = e.dataTransfer;\n    var dropFiles = [];\n    \n    if(df.items !== undefined){\n        \/\/ Chrome拖拽文件逻辑\n    } else {\n        for(var i = 0; i \x3c df.files.length; i\x2b\x2b){\n            var dropFile = df.files[i];\n            if ( dropFile.type ) {\n                \/\/ 如果type不是空串，一定是文件\n                dropFiles.push(dropFile);\n            } else {\n                try {\n                    var fileReader = new FileReader();\n                    fileReader.readAsDataURL(dropFile.slice(0, 3));\n\n                    fileReader.addEventListener(\x27load\x27, function (e) {\n                        console.log(e, \x27load\x27);\n                        dropFiles.push(dropFile);\n                    }, false);\n\n                    fileReader.addEventListener(\x27error\x27, function (e) {\n                        console.log(e, \x27error，不可以上传文件夹\x27);\n                    }, false);\n\n                } catch (e) {\n                    console.log(e, \x27catch error，不可以上传文件夹\x27);\n                }\n            }\n        }\n    }\n}, false);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3edropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22drop\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault();\n    e.stopPropagation();\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e df = e.dataTransfer;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dropFiles = [];\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(df.items !== \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Chrome拖拽文件逻辑\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; df.files.length; i\x2b\x2b){\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dropFile = df.files[i];\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( dropFile.type ) {\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果type不是空串，一定是文件\x3c\/span\x3e\n                dropFiles.push(dropFile);\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fileReader = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FileReader();\n                    fileReader.readAsDataURL(dropFile.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e));\n\n                    fileReader.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n                        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e, \x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e);\n                        dropFiles.push(dropFile);\n                    }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\n                    fileReader.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n                        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e, \x3cspan class=\x22hljs-string\x22\x3e\x27error，不可以上传文件夹\x27\x3c\/span\x3e);\n                    }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\n                } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n                    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e, \x3cspan class=\x22hljs-string\x22\x3e\x27catch error，不可以上传文件夹\x27\x3c\/span\x3e);\n                }\n            }\n        }\n    }\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面代码创建了一个\x3ccode\x3eFileReader\x3c\/code\x3e实例，通过这个实例对文件进行读取，我测试读取一个1G多的文件要3S多，时间有点长，就用\x3ccode\x3eslice\x3c\/code\x3e截取了前3个字符，为什么是前3个不是前2个或者前4个呢，因为代码是我写的，我开心这么写呗~\x3c\/p\x3e\n\x3cp\x3e如果\x3ccode\x3eload\x3c\/code\x3e事件触发了，就说明拖拽过来的东西是文件，如果\x3ccode\x3eerror\x3c\/code\x3e事件触发了，就说明是文件夹，为了防止其他可能的潜在错误，用\x3ccode\x3etry\x3c\/code\x3e包起来这段代码。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader6\x22\x3e三方应用的一点点小hack\x3c\/h1\x3e\n\x3cp\x3e经过测试发现通过\x3ccode\x3eMac\x3c\/code\x3e的\x3ccode\x3eFinder\x3c\/code\x3e拖拽文件没有问题，但是有时候文件并不一定在\x3ccode\x3eFinder\x3c\/code\x3e中，也可能在某些应用中，有一个应用叫做\x3ccode\x3e圈点\x3c\/code\x3e，这个应用的用户反馈文件拖拽失效，去看了其他开源文件上传的源码，发现了这样一行代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22dropZone.addEventListener(\x26quot;dragover\x26quot;, function (e) {\n    e.dataTransfer.dropEffect = \x27copy\x27; \/\/ 兼容某些三方应用，如圈点\n    e.preventDefault();\n    e.stopPropagation();\n}, false);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22dragover\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.dataTransfer.dropEffect = \x3cspan class=\x22hljs-string\x22\x3e\x27copy\x27\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 兼容某些三方应用，如圈点\x3c\/span\x3e\n    e.preventDefault();\n    e.stopPropagation();\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e需要把\x3ccode\x3edropEffect\x3c\/code\x3e置为\x3ccode\x3ecopy\x3c\/code\x3e，上网搜了下这个问题，源码文档中也没有说为什么要加这个，有兴趣的同学可以找一下为什么。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader7\x22\x3e可以拿来就用的代码\x3c\/h1\x3e\n\x3cp\x3e由于用了\x3ccode\x3eFileReader\x3c\/code\x3e去读取文件，这是一个异步IO操作，为了记录当前处理了多少个文件，以及什么时候触发拖拽结束的回调，写了一个\x3ccode\x3echeckDropFinish\x3c\/code\x3e的方法一直去比较处理的文件数量和文件总数，确定所有文件处理完了后就去调用完成的回调。\x3c\/p\x3e\n\x3cp\x3e另外，我在最后调试异步处理的时候，用的断点调试，发现断点调试在\x3ccode\x3eSafari\x3c\/code\x3e中会导致异步回调不触发，需要自己调试定制功能的同学注意下。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 获得拖拽文件的回调函数\nfunction getDropFileCallBack (dropFiles) {\n    console.log(dropFiles, dropFiles.length);\n}\n\nvar dropZone = document.querySelector(\x26quot;#dropZone\x26quot;);\ndropZone.addEventListener(\x26quot;dragenter\x26quot;, function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n}, false);\n\ndropZone.addEventListener(\x26quot;dragover\x26quot;, function (e) {\n    e.dataTransfer.dropEffect = \x27copy\x27; \/\/ 兼容某些三方应用，如圈点\n    e.preventDefault();\n    e.stopPropagation();\n}, false);\n\ndropZone.addEventListener(\x26quot;dragleave\x26quot;, function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n}, false);\n\ndropZone.addEventListener(\x26quot;drop\x26quot;, function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    var df = e.dataTransfer;\n    var dropFiles = []; \/\/ 拖拽的文件，会放到这里\n    var dealFileCnt = 0; \/\/ 读取文件是个异步的过程，需要记录处理了多少个文件了\n    var allFileLen = df.files.length; \/\/ 所有的文件的数量，给非Chrome浏览器使用的变量\n\n    \/\/ 检测是否已经把所有的文件都遍历过了\n    function checkDropFinish () {\n        if ( dealFileCnt === allFileLen-1 ) {\n            getDropFileCallBack(dropFiles);\n        }\n        dealFileCnt\x2b\x2b;\n    }\n\n    if(df.items !== undefined){\n        \/\/ Chrome拖拽文件逻辑\n        for(var i = 0; i \x3c df.items.length; i\x2b\x2b) {\n            var item = df.items[i];\n            if(item.kind === \x26quot;file\x26quot; \x26amp;\x26amp; item.webkitGetAsEntry().isFile) {\n                var file = item.getAsFile();\n                dropFiles.push(file);\n                console.log(file);\n            }\n        }\n    } else {\n        \/\/ 非Chrome拖拽文件逻辑\n        for(var i = 0; i \x3c allFileLen; i\x2b\x2b) {\n            var dropFile = df.files[i];\n            if ( dropFile.type ) {\n                dropFiles.push(dropFile);\n                checkDropFinish();\n            } else {\n                try {\n                    var fileReader = new FileReader();\n                    fileReader.readAsDataURL(dropFile.slice(0, 3));\n\n                    fileReader.addEventListener(\x27load\x27, function (e) {\n                        console.log(e, \x27load\x27);\n                        dropFiles.push(dropFile);\n                        checkDropFinish();\n                    }, false);\n\n                    fileReader.addEventListener(\x27error\x27, function (e) {\n                        console.log(e, \x27error，不可以上传文件夹\x27);\n                        checkDropFinish();\n                    }, false);\n\n                } catch (e) {\n                    console.log(e, \x27catch error，不可以上传文件夹\x27);\n                    checkDropFinish();\n                }\n            }\n        }\n    }\n}, false);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获得拖拽文件的回调函数\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetDropFileCallBack\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edropFiles\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(dropFiles, dropFiles.length);\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dropZone = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x22#dropZone\x22\x3c\/span\x3e);\ndropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22dragenter\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault();\n    e.stopPropagation();\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\ndropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22dragover\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.dataTransfer.dropEffect = \x3cspan class=\x22hljs-string\x22\x3e\x27copy\x27\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 兼容某些三方应用，如圈点\x3c\/span\x3e\n    e.preventDefault();\n    e.stopPropagation();\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\ndropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22dragleave\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault();\n    e.stopPropagation();\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\ndropZone.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22drop\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    e.preventDefault();\n    e.stopPropagation();\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e df = e.dataTransfer;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dropFiles = []; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 拖拽的文件，会放到这里\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dealFileCnt = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 读取文件是个异步的过程，需要记录处理了多少个文件了\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e allFileLen = df.files.length; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所有的文件的数量，给非Chrome浏览器使用的变量\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 检测是否已经把所有的文件都遍历过了\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3echeckDropFinish\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( dealFileCnt === allFileLen\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e ) {\n            getDropFileCallBack(dropFiles);\n        }\n        dealFileCnt\x2b\x2b;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(df.items !== \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Chrome拖拽文件逻辑\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; df.items.length; i\x2b\x2b) {\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e item = df.items[i];\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(item.kind === \x3cspan class=\x22hljs-string\x22\x3e\x22file\x22\x3c\/span\x3e \x26amp;\x26amp; item.webkitGetAsEntry().isFile) {\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e file = item.getAsFile();\n                dropFiles.push(file);\n                \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(file);\n            }\n        }\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 非Chrome拖拽文件逻辑\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; allFileLen; i\x2b\x2b) {\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dropFile = df.files[i];\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( dropFile.type ) {\n                dropFiles.push(dropFile);\n                checkDropFinish();\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fileReader = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FileReader();\n                    fileReader.readAsDataURL(dropFile.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e));\n\n                    fileReader.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n                        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e, \x3cspan class=\x22hljs-string\x22\x3e\x27load\x27\x3c\/span\x3e);\n                        dropFiles.push(dropFile);\n                        checkDropFinish();\n                    }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\n                    fileReader.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n                        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e, \x3cspan class=\x22hljs-string\x22\x3e\x27error，不可以上传文件夹\x27\x3c\/span\x3e);\n                        checkDropFinish();\n                    }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\n                } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n                    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e, \x3cspan class=\x22hljs-string\x22\x3e\x27catch error，不可以上传文件夹\x27\x3c\/span\x3e);\n                    checkDropFinish();\n                }\n            }\n        }\n    }\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>js控制文件拖拽，获取拖拽内容。</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013298317">https://segmentfault.com/a/1190000013298317</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/q0npokfxbw/" target="_blank">https://alili.tech/archive/q0npokfxbw/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>