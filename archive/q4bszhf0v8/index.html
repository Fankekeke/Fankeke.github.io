<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="2018 年了，你还是只会 npm install 吗"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>2018 年了，你还是只会 npm install 吗 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/q4bszhf0v8/",
				"appid": "1613049289050283", 
				"title": "2018 年了，你还是只会 npm install 吗 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-09T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/0zbtjgsda62/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/adglkdb5oi4/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fq4bszhf0v8%2f&text=2018%20%e5%b9%b4%e4%ba%86%ef%bc%8c%e4%bd%a0%e8%bf%98%e6%98%af%e5%8f%aa%e4%bc%9a%20npm%20install%20%e5%90%97"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fq4bszhf0v8%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fq4bszhf0v8%2f&text=2018%20%e5%b9%b4%e4%ba%86%ef%bc%8c%e4%bd%a0%e8%bf%98%e6%98%af%e5%8f%aa%e4%bc%9a%20npm%20install%20%e5%90%97"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fq4bszhf0v8%2f&title=2018%20%e5%b9%b4%e4%ba%86%ef%bc%8c%e4%bd%a0%e8%bf%98%e6%98%af%e5%8f%aa%e4%bc%9a%20npm%20install%20%e5%90%97"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fq4bszhf0v8%2f&is_video=false&description=2018%20%e5%b9%b4%e4%ba%86%ef%bc%8c%e4%bd%a0%e8%bf%98%e6%98%af%e5%8f%aa%e4%bc%9a%20npm%20install%20%e5%90%97"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=2018%20%e5%b9%b4%e4%ba%86%ef%bc%8c%e4%bd%a0%e8%bf%98%e6%98%af%e5%8f%aa%e4%bc%9a%20npm%20install%20%e5%90%97&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fq4bszhf0v8%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fq4bszhf0v8%2f&title=2018%20%e5%b9%b4%e4%ba%86%ef%bc%8c%e4%bd%a0%e8%bf%98%e6%98%af%e5%8f%aa%e4%bc%9a%20npm%20install%20%e5%90%97"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fq4bszhf0v8%2f&title=2018%20%e5%b9%b4%e4%ba%86%ef%bc%8c%e4%bd%a0%e8%bf%98%e6%98%af%e5%8f%aa%e4%bc%9a%20npm%20install%20%e5%90%97"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fq4bszhf0v8%2f&title=2018%20%e5%b9%b4%e4%ba%86%ef%bc%8c%e4%bd%a0%e8%bf%98%e6%98%af%e5%8f%aa%e4%bc%9a%20npm%20install%20%e5%90%97"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fq4bszhf0v8%2f&title=2018%20%e5%b9%b4%e4%ba%86%ef%bc%8c%e4%bd%a0%e8%bf%98%e6%98%af%e5%8f%aa%e4%bc%9a%20npm%20install%20%e5%90%97"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">2018 年了，你还是只会 npm install 吗</h1><div class="meta"><div class="postdate"><time datetime="2018-12-09" itemprop="datePublished">2018-12-09</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3enodejs 社区乃至 Web 前端工程化领域发展到今天，作为 node 自带的包管理工具的 npm 已经成为每个前端开发者必备的工具。但是现实状况是，我们很多人对这个nodejs基础设施的使用和了解还停留在: 会用 \x3ccode\x3enpm install\x3c\/code\x3e 这里（一言不合就删除整个 node_modules 目录然后重新 install 这种事你没做过吗？）\x3c\/p\x3e\n\x3cp\x3e当然 npm 能成为现在世界上最大规模的\x3cstrong\x3e包管理系统\x3c\/strong\x3e，很大程度上确实归功于它足够\x3cstrong\x3e用户友好\x3c\/strong\x3e，你看即使我只会执行 install 也不必太担心出什么大岔子. 但是 npm 的功能远不止于 install 一下那么简单，这篇文章帮你扒一扒那些你可能不知道的 npm 原理、特性、技巧，以及（我认为的）最佳实践。\x3c\/p\x3e\n\x3cp\x3e\x3cdel\x3e你懒得读的 npm 文档，我帮你翻译然后试验整理过来了 ???\x3c\/del\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e1. npm init\x3c\/h2\x3e\n\x3cp\x3e我们都知道 package.json 文件是用来定义一个 package 的描述文件, 也知道\x3ccode\x3enpm init\x3c\/code\x3e 命令用来初始化一个简单的 package.json 文件，执行该命令后终端会依次询问 name, version, description 等字段。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e1.1 npm init 执行默认行为\x3c\/h3\x3e\n\x3cp\x3e\x3cbr\x3e而如果想要偷懒步免去一直按 enter，在命令后追加 --yes 参数即可，其作用与一路下一步相同。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3enpm init --yes\x3c\/code\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e1.2 自定义 npm init 行为\x3c\/h3\x3e\n\x3cp\x3enpm init 命令的原理并不复杂，调用脚本，输出一个初始化的 package.json 文件就是了。所以相应地，定制 npm init 命令的实现方式也很简单，在 Home 目录创建一个 \x3ccode\x3e.npm-init.js\x3c\/code\x3e 即可，该文件的 module.exports 即为 package.json 配置内容，需要获取用户输入时候，使用 \x3ccode\x3eprompt()\x3c\/code\x3e 方法即可。\x3c\/p\x3e\n\x3cp\x3e例如编写这样的 ~\/.npm-init.js\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const desc = prompt(\x27description?\x27, \x27A new package...\x27)\nconst bar = prompt(\x27bar?\x27, \x27\x27)\nconst count = prompt(\x27count?\x27, \x2742\x27)\n\nmodule.exports = {\n  key: \x27value\x27,\n  foo: {\n    bar: bar,\n    count: count\n  },\n  name: prompt(\x27name?\x27, process.cwd().split(\x27\/\x27).pop()),\n  version: prompt(\x27version?\x27, \x270.1.0\x27),\n  description: desc,\n  main: \x27index.js\x27,\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e desc = prompt(\x3cspan class=\x22hljs-string\x22\x3e\x27description?\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27A new package...\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e bar = prompt(\x3cspan class=\x22hljs-string\x22\x3e\x27bar?\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e count = prompt(\x3cspan class=\x22hljs-string\x22\x3e\x27count?\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x2742\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n  \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27value\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3efoo\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3ebar\x3c\/span\x3e: bar,\n    \x3cspan class=\x22hljs-attr\x22\x3ecount\x3c\/span\x3e: count\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: prompt(\x3cspan class=\x22hljs-string\x22\x3e\x27name?\x27\x3c\/span\x3e, process.cwd().split(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e).pop()),\n  \x3cspan class=\x22hljs-attr\x22\x3eversion\x3c\/span\x3e: prompt(\x3cspan class=\x22hljs-string\x22\x3e\x27version?\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x270.1.0\x27\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-attr\x22\x3edescription\x3c\/span\x3e: desc,\n  \x3cspan class=\x22hljs-attr\x22\x3emain\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27index.js\x27\x3c\/span\x3e,\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e此时在 ~\/hello 目录下执行 \x3ccode\x3enpm init\x3c\/code\x3e 将会得到这样的 package.json:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;key\x26quot;: \x26quot;value\x26quot;,\n  \x26quot;foo\x26quot;: {\n    \x26quot;bar\x26quot;: \x26quot;\x26quot;,\n    \x26quot;count\x26quot;: \x26quot;42\x26quot;\n  },\n  \x26quot;name\x26quot;: \x26quot;hello\x26quot;,\n  \x26quot;version\x26quot;: \x26quot;0.1.0\x26quot;,\n  \x26quot;description\x26quot;: \x26quot;A new package...\x26quot;,\n  \x26quot;main\x26quot;: \x26quot;index.js\x26quot;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22key\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22value\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22foo\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22bar\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22count\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x2242\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22hello\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.1.0\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22description\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22A new package...\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22main\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22index.js\x22\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e除了生成 package.json, 因为 .npm-init.js 是一个常规的模块，意味着我们可以执行随便什么 node 脚本可以执行的任务。例如通过 fs 创建 README, .eslintrc 等项目必需文件，实现项目脚手架的作用。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e2. 依赖包安装\x3c\/h2\x3e\n\x3cp\x3e依赖管理是 npm 的核心功能，原理就是执行 \x3ccode\x3enpm install\x3c\/code\x3e 从 package.json 中的 dependencies, devDependencies 将依赖包安装到当前目录的 .\/node_modules 文件夹中。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e2.1 package定义\x3c\/h3\x3e\n\x3cp\x3e我们都知道要手动安装一个包时，执行 \x3ccode\x3enpm install \x26lt;package\x26gt;\x3c\/code\x3e 命令即可。这里的第三个参数 package 通常就是我们所要安装的包名，默认配置下 npm 会从默认的源 (Registry) 中查找该包名对应的包地址，并下载安装。但在 npm 的世界里，除了简单的指定包名, package 还可以是一个指向有效包名的 http url\/git url\/文件夹路径。\x3c\/p\x3e\n\x3cp\x3e阅读 \x3ca href=\x22https:\/\/docs.npmjs.com\/getting-started\/packages#what-is-a-package-\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enpm的文档\x3c\/a\x3e， 我们会发现package 准确的定义，只要符合以下 a) 到 g) 其中之一条件，就是一个 package:\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e#\x3c\/th\x3e\n\x3cth\x3e说明\x3c\/th\x3e\n\x3cth\x3e例子\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3ea)\x3c\/td\x3e\n\x3ctd\x3e一个包含了程序和描述该程序的 package.json 文件 的 \x3cstrong\x3e文件夹\x3c\/strong\x3e\n\x3c\/td\x3e\n\x3ctd\x3e.\/local-module\/\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eb)\x3c\/td\x3e\n\x3ctd\x3e一个包含了 (a) 的 \x3cstrong\x3egzip 压缩文件\x3c\/strong\x3e\n\x3c\/td\x3e\n\x3ctd\x3e.\/module.tar.gz\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ec)\x3c\/td\x3e\n\x3ctd\x3e一个可以下载得到 (b) 资源的 \x3cstrong\x3eurl\x3c\/strong\x3e (通常是 http(s) url)\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/registry.npmjs.org\/webpack\/-\/webpack-4.1.0.tgz\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/registry.npmjs.org\/we...\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ed)\x3c\/td\x3e\n\x3ctd\x3e一个格式为 \x3ccode\x3e\x26lt;name\x26gt;@\x26lt;version\x26gt;\x3c\/code\x3e 的字符串，可指向 npm 源(通常是官方源 npmjs.org)上已发布的可访问 url，且该 url 满足条件 (c)\x3c\/td\x3e\n\x3ctd\x3ewebpack@4.1.0\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ee)\x3c\/td\x3e\n\x3ctd\x3e一个格式为 \x3ccode\x3e\x26lt;name\x26gt;@\x26lt;tag\x26gt;\x3c\/code\x3e 的字符串，在 npm 源上该\x3ccode\x3e\x26lt;tag\x26gt;\x3c\/code\x3e指向某 \x3ccode\x3e\x26lt;version\x26gt;\x3c\/code\x3e 得到 \x3ccode\x3e\x26lt;name\x26gt;@\x26lt;version\x26gt;\x3c\/code\x3e，后者满足条件 (d)\x3c\/td\x3e\n\x3ctd\x3ewebpack@latest\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ef)\x3c\/td\x3e\n\x3ctd\x3e一个格式为 \x3ccode\x3e\x26lt;name\x26gt;\x3c\/code\x3e 的字符串，默认添加 \x3ccode\x3elatest\x3c\/code\x3e 标签所得到的 \x3ccode\x3e\x26lt;name\x26gt;@latest\x3c\/code\x3e 满足条件 (e)\x3c\/td\x3e\n\x3ctd\x3ewebpack\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eg)\x3c\/td\x3e\n\x3ctd\x3e一个 \x3cstrong\x3egit url\x3c\/strong\x3e, 该 url 所指向的代码库满足条件 (a)\x3c\/td\x3e\n\x3ctd\x3egit@github.com:webpack\/webpack.git\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e2.2 安装本地包\/远程git仓库包\x3c\/h3\x3e\n\x3cp\x3e上面表格的定义意味着，我们在共享依赖包时，并不是非要将包发表到 npm 源上才可以提供给使用者来安装。这对于私有的不方便 publish 到远程源（即使是私有源），或者需要对某官方源进行改造，但依然需要把包共享出去的场景来说非常实用。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e场景1: 本地模块引用\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3enodejs 应用开发中不可避免有模块间调用，例如在实践中经常会把需要被频繁引用的配置模块放到应用根目录；于是在创建了很多层级的目录、文件后，很可能会遇到这样的代码:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const config = require(\x27..\/..\/..\/..\/config.js\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/..\/..\/..\/config.js\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e除了看上去很丑以外，这样的路径引用也不利于代码的重构。并且身为程序员的自我修养告诉我们，这样重复的代码多了也就意味着是时候把这个模块分离出来供应用内其他模块共享了。例如这个例子里的 config.js 非常适合封装为 package 放到 node_modules 目录下，共享给同应用内其他模块。\x3c\/p\x3e\n\x3cp\x3e无需手动拷贝文件或者创建软链接到 node_modules 目录，npm 有更优雅的解决方案。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e方案：\x3c\/strong\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3cp\x3e创建 config 包:   \x3cbr\x3e新增 config 文件夹; 重命名 config.js 为 config\/index.js 文件; 创建 package.json 定义 config 包\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;name\x26quot;: \x26quot;config\x26quot;,\n    \x26quot;main\x26quot;: \x26quot;index.js\x26quot;,\n    \x26quot;version\x26quot;: \x26quot;0.1.0\x26quot;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22config\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22main\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22index.js\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.1.0\x22\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e在应用层 package.json 文件中新增依赖项，然后执行 \x3ccode\x3enpm install\x3c\/code\x3e; 或直接执行第 3 步\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;dependencies\x26quot;: {\n        \x26quot;config\x26quot;: \x26quot;file:.\/config\x26quot;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22dependencies\x22\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22config\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22file:.\/config\x22\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e（等价于第 2 步）直接在应用目录执行 \x3ccode\x3enpm install file:.\/config\x3c\/code\x3e\x3cp\x3e此时，查看 \x3ccode\x3enode_modules\x3c\/code\x3e 目录我们会发现多出来一个名为 \x3ccode\x3econfig\x3c\/code\x3e，指向上层 \x3ccode\x3econfig\/\x3c\/code\x3e 文件夹的软链接。这是因为 npm 识别 \x3ccode\x3efile:\x3c\/code\x3e 协议的url，得知这个包需要直接从文件系统中获取，会自动创建软链接到 node_modules 中，完成“安装”过程。\x3c\/p\x3e\n\x3cp\x3e相比手动软链，我们既不需要关心 windows 和 linux 命令差异，又可以显式地将依赖信息固化到 dependencies 字段中，开发团队其他成员可以执行 \x3ccode\x3enpm install\x3c\/code\x3e 后直接使用。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3cstrong\x3e场景2: 私有 git 共享 package\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e有些时候，我们一个团队内会有一些代码\/公用库需要在团队内\x3cstrong\x3e不同项目间\x3c\/strong\x3e共享，但可能由于包含了敏感内容，或者代码太烂拿不出手等原因，不方便发布到源。\x3c\/p\x3e\n\x3cp\x3e这种情况下，我们可以简单地将被依赖的包托管在私有的 git 仓库中，然后将该  git url 保存到 dependencies 中. npm 会直接调用系统的 git 命令从 git 仓库拉取包的内容到 node_modules 中。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/docs.npmjs.com\/files\/package.json#git-urls-as-dependencies\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enpm 支持的 git url 格式\x3c\/a\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cprotocol\x3e:\/\/[\x3cuser\x3e[:\x3cpassword\x3e]@]\x3chostname\x3e[:\x3cport\x3e][:][\/]\x3cpath\x3e[#\x3ccommit-ish\x3e | #semver:\x3csemver\x3e]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs markdown\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eprotocol\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e:\/\/[\x3cspan class=\x22hljs-string\x22\x3e\x26lt;user\x26gt;[:\x26lt;password\x26gt;\x3c\/span\x3e]@]\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehostname\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e[\x3cspan class=\x22hljs-string\x22\x3e:\x26lt;port\x26gt;\x3c\/span\x3e][\x3cspan class=\x22hljs-symbol\x22\x3e:\x3c\/span\x3e][\x3cspan class=\x22hljs-string\x22\x3e\/\x3c\/span\x3e]\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3epath\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e[#\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ecommit-ish\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e | #semver:\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3esemver\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3egit 路径后可以使用 # 指定特定的 git branch\/commit\/tag, 也可以 #semver: 指定特定的 semver range.\x3c\/p\x3e\n\x3cp\x3e例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22git\x2bssh:\/\/git@github.com:npm\/npm.git#v1.0.27\ngit\x2bssh:\/\/git@github.com:npm\/npm#semver:^5.0\ngit\x2bhttps:\/\/isaacs@github.com\/npm\/npm.git\ngit:\/\/github.com\/npm\/npm.git#v1.0.27\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3egit\x2bssh:\x3cspan class=\x22hljs-regexp\x22\x3e\/\/gi\x3c\/span\x3et@github.com:\x3cspan class=\x22hljs-built_in\x22\x3enpm\x3c\/span\x3e\/\x3cspan class=\x22hljs-built_in\x22\x3enpm\x3c\/span\x3e.git\x3cspan class=\x22hljs-comment\x22\x3e#v1.0.27\x3c\/span\x3e\ngit\x2bssh:\x3cspan class=\x22hljs-regexp\x22\x3e\/\/gi\x3c\/span\x3et@github.com:\x3cspan class=\x22hljs-built_in\x22\x3enpm\x3c\/span\x3e\/\x3cspan class=\x22hljs-built_in\x22\x3enpm\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e#semver:^5.0\x3c\/span\x3e\ngit\x2bhttps:\x3cspan class=\x22hljs-regexp\x22\x3e\/\/i\x3c\/span\x3esaacs@github.com\/\x3cspan class=\x22hljs-built_in\x22\x3enpm\x3c\/span\x3e\/\x3cspan class=\x22hljs-built_in\x22\x3enpm\x3c\/span\x3e.git\ngit:\x3cspan class=\x22hljs-regexp\x22\x3e\/\/gi\x3c\/span\x3ethub.com\/\x3cspan class=\x22hljs-built_in\x22\x3enpm\x3c\/span\x3e\/\x3cspan class=\x22hljs-built_in\x22\x3enpm\x3c\/span\x3e.git\x3cspan class=\x22hljs-comment\x22\x3e#v1.0.27\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e场景3: 开源 package 问题修复\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e使用某个 npm 包时发现它有某个严重bug，但也许最初作者已不再维护代码了，也许我们工作紧急，没有足够的时间提 issue 给作者再慢慢等作者发布新的修复版本到 npm 源。\x3c\/p\x3e\n\x3cp\x3e此时我们可以手动进入 node_modules 目录下修改相应的包内容，也许修改了一行代码就修复了问题。但是这种做法非常不明智！\x3c\/p\x3e\n\x3cp\x3e首先 node_modules 本身不应该放进版本控制系统，对 node_modules  文件夹中内容的修改不会被记录进 git 提交记录；其次，就算我们非要反模式，把 node_modules 放进版本控制中，你的修改内容也很容易在下次 team 中某位成员执行 \x3ccode\x3enpm install\x3c\/code\x3e 或 \x3ccode\x3enpm update\x3c\/code\x3e 时被覆盖，而这样的一次提交很可能包含了几十几百个包的更新，你自己所做的修改很容易就被淹没在庞大的 diff 文件列表中了。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e方案\x3c\/strong\x3e:\x3c\/p\x3e\n\x3cp\x3e最好的办法应当是 fork 原作者的 git 库，在自己所属的 repo 下修复问题后，将 dependencies 中相应的依赖项更改为自己修复后版本的 git url 即可解决问题。（Fork 代码库后，也便于向原作者提交 PR 修复问题。上游代码库修复问题后，再次更新我们的依赖配置也不迟。）\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e3. npm install 如何工作 —— node_modules 目录结构\x3c\/h2\x3e\n\x3cp\x3enpm install 执行完毕后，我们可以在 node_modules 中看到所有依赖的包。虽然使用者无需关注这个目录里的文件夹结构细节，只管在业务代码中引用依赖包即可，但了解 node_modules 的内容可以帮我们更好理解 npm 如何工作，了解从 npm 2 到 npm 5 有哪些变化和改进。\x3c\/p\x3e\n\x3cp\x3e为简单起见，我们假设应用目录为 app, 用两个流行的包 \x3ccode\x3ewebpack\x3c\/code\x3e, \x3ccode\x3enconf\x3c\/code\x3e 作为依赖包做示例说明。并且为了正常安装，使用了“上古” npm 2 时期的版本 \x3ccode\x3ewebpack@1.15.0\x3c\/code\x3e, \x3ccode\x3enconf@0.8.5\x3c\/code\x3e.\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e3.1 npm 2\x3c\/h3\x3e\n\x3cp\x3enpm 2 在安装依赖包时，采用简单的递归安装方法。执行 \x3ccode\x3enpm install\x3c\/code\x3e 后，npm 2 依次递归安装 \x3ccode\x3ewebpack\x3c\/code\x3e 和 \x3ccode\x3enconf\x3c\/code\x3e 两个包到 node_modules 中。执行完毕后，我们会看到 .\/node_modules 这层目录只含有这两个子目录。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node_modules\/\n├── nconf\/\n└── webpack\/\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs\x22\x3e\x3ccode\x3enode_modules\/\n├── nconf\/\n└── webpack\/\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e进入更深一层 nconf 或 webpack 目录，将看到这两个包各自的 node_modules 中，已经由 npm 递归地安装好自身的依赖包。包括 \x3ccode\x3e.\/node_modules\/webpack\/node_modules\/webpack-core\x3c\/code\x3e , \x3ccode\x3e.\/node_modules\/conf\/node_modules\/async\x3c\/code\x3e 等等。而每一个包都有自己的依赖包，每个包自己的依赖都安装在了自己的 node_modules 中。依赖关系层层递进，构成了一整个依赖树，这个依赖树与文件系统中的文件结构树刚好层层对应。\x3c\/p\x3e\n\x3cp\x3e最方便的查看依赖树的方式是直接在 app 目录下执行 \x3ccode\x3enpm ls\x3c\/code\x3e 命令。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22app@0.1.0\n├─┬ nconf@0.8.5\n│ ├── async@1.5.2\n│ ├── ini@1.3.5\n│ ├── secure-keys@1.0.0\n│ └── yargs@3.32.0\n└─┬ webpack@1.15.0\n  ├── acorn@3.3.0\n  ├── async@1.5.2\n  ├── clone@1.0.3\n  ├── ...\n  ├── optimist@0.6.1\n  ├── supports-color@3.2.3\n  ├── tapable@0.1.10\n  ├── uglify-js@2.7.5\n  ├── watchpack@0.2.9\n  └─┬ webpack-core@0.6.9\n    ├── source-list-map@0.1.8\n    └── source-map@0.4.4\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3eapp@\x3cspan class=\x22hljs-number\x22\x3e0.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.0\x3c\/span\x3e\n├─┬ nconf@\x3cspan class=\x22hljs-number\x22\x3e0.8\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.5\x3c\/span\x3e\n│ ├── async@\x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.2\x3c\/span\x3e\n│ ├── ini@\x3cspan class=\x22hljs-number\x22\x3e1.3\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.5\x3c\/span\x3e\n│ ├── secure-keys@\x3cspan class=\x22hljs-number\x22\x3e1.0\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.0\x3c\/span\x3e\n│ └── yargs@\x3cspan class=\x22hljs-number\x22\x3e3.32\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.0\x3c\/span\x3e\n└─┬ webpack@\x3cspan class=\x22hljs-number\x22\x3e1.15\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.0\x3c\/span\x3e\n  ├── acorn@\x3cspan class=\x22hljs-number\x22\x3e3.3\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.0\x3c\/span\x3e\n  ├── async@\x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.2\x3c\/span\x3e\n  ├── clone@\x3cspan class=\x22hljs-number\x22\x3e1.0\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.3\x3c\/span\x3e\n  ├── ...\n  ├── optimist@\x3cspan class=\x22hljs-number\x22\x3e0.6\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.1\x3c\/span\x3e\n  ├── supports-color@\x3cspan class=\x22hljs-number\x22\x3e3.2\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.3\x3c\/span\x3e\n  ├── tapable@\x3cspan class=\x22hljs-number\x22\x3e0.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.10\x3c\/span\x3e\n  ├── uglify-js@\x3cspan class=\x22hljs-number\x22\x3e2.7\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.5\x3c\/span\x3e\n  ├── watchpack@\x3cspan class=\x22hljs-number\x22\x3e0.2\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.9\x3c\/span\x3e\n  └─┬ webpack-core@\x3cspan class=\x22hljs-number\x22\x3e0.6\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.9\x3c\/span\x3e\n    ├── source-\x3cspan class=\x22hljs-type\x22\x3elist\x3c\/span\x3e-map@\x3cspan class=\x22hljs-number\x22\x3e0.1\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.8\x3c\/span\x3e\n    └── source-map@\x3cspan class=\x22hljs-number\x22\x3e0.4\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.4\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样的目录结构优点在于层级结构明显，便于进行傻瓜式的管理:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e例如新装一个依赖包，可以立即在第一层 node_modules 中看到子目录\x3c\/li\x3e\n\x3cli\x3e在已知所需包名和版本号时，甚至可以从别的文件夹手动拷贝需要的包到 node_modules 文件夹中，再手动修改 package.json 中的依赖配置\x3c\/li\x3e\n\x3cli\x3e要删除这个包，也可以简单地手动删除这个包的子目录，并删除 package.json 文件中相应的一行即可\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e实际上，很多人在 npm 2 时代也的确都这么实践过，的确也都可以安装和删除成功，并不会导致什么差错。\x3c\/p\x3e\n\x3cp\x3e但这样的文件结构也有很明显的问题：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e对复杂的工程, node_modules 内目录结构可能会太深，导致深层的文件路径过长而触发 windows 文件系统中，文件路径不能超过 260 个字符长的错误\x3c\/li\x3e\n\x3cli\x3e部分被多个包所依赖的包，很可能在应用 node_modules 目录中的很多地方被重复安装。随着工程规模越来越大，依赖树越来越复杂，这样的包情况会越来越多，造成大量的冗余。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e——在我们的示例中就有这个问题，\x3ccode\x3ewebpack\x3c\/code\x3e 和 \x3ccode\x3enconf\x3c\/code\x3e 都依赖 \x3ccode\x3easync\x3c\/code\x3e 这个包，所以在文件系统中，webpack 和 nconf 的 node_modules 子目录中都安装了相同的 async 包，并且是相同的版本。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x2b-------------------------------------------\x2b\n|                   app\/                    |\n\x2b----------\x2b------------------------\x2b-------\x2b\n           |                        |\n           |                        |\n\x2b----------v------\x2b       \x2b---------v-------\x2b\n|                 |       |                 |\n|  webpack@1.15.0 |       |  nconf@0.8.5    |\n|                 |       |                 |\n\x2b--------\x2b--------\x2b       \x2b--------\x2b--------\x2b\n         |                         |\n   \x2b-----v-----\x2b             \x2b-----v-----\x2b\n   |async@1.5.2|             |async@1.5.2|\n   \x2b-----------\x2b             \x2b-----------\x2b\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gherkin\x22\x3e\x3ccode\x3e\x2b-------------------------------------------\x2b\n|\x3cspan class=\x22hljs-string\x22\x3e                   app\/                    \x3c\/span\x3e|\n\x2b----------\x2b------------------------\x2b-------\x2b\n           |\x3cspan class=\x22hljs-string\x22\x3e                        \x3c\/span\x3e|\n           |\x3cspan class=\x22hljs-string\x22\x3e                        \x3c\/span\x3e|\n\x2b----------v------\x2b       \x2b---------v-------\x2b\n|\x3cspan class=\x22hljs-string\x22\x3e                 \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e       \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e                 \x3c\/span\x3e|\n|\x3cspan class=\x22hljs-string\x22\x3e  webpack@1.15.0 \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e       \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e  nconf@0.8.5    \x3c\/span\x3e|\n|\x3cspan class=\x22hljs-string\x22\x3e                 \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e       \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e                 \x3c\/span\x3e|\n\x2b--------\x2b--------\x2b       \x2b--------\x2b--------\x2b\n         |\x3cspan class=\x22hljs-string\x22\x3e                         \x3c\/span\x3e|\n   \x2b-----v-----\x2b             \x2b-----v-----\x2b\n   |\x3cspan class=\x22hljs-string\x22\x3easync@1.5.2\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e             \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3easync@1.5.2\x3c\/span\x3e|\n   \x2b-----------\x2b             \x2b-----------\x2b\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e3.2 npm 3 - 扁平结构\x3c\/h3\x3e\n\x3cp\x3e主要为了解决以上问题，npm 3 的 node_modules 目录改成了更加扁平状的层级结构。文件系统中 \x3ccode\x3ewebpack\x3c\/code\x3e, \x3ccode\x3enconf\x3c\/code\x3e, \x3ccode\x3easync\x3c\/code\x3e 的层级关系变成了平级关系，处于同一级目录中。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22         \x2b-------------------------------------------\x2b\n         |                   app\/                    |\n         \x2b-\x2b---------------------------------------\x2b-\x2b\n           |                                       |\n           |                                       |\n\x2b----------v------\x2b    \x2b-------------\x2b   \x2b---------v-------\x2b\n|                 |    |             |   |                 |\n|  webpack@1.15.0 |    | async@1.5.2 |   |  nconf@0.8.5    |\n|                 |    |             |   |                 |\n\x2b-----------------\x2b    \x2b-------------\x2b   \x2b-----------------\x2b\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gherkin\x22\x3e\x3ccode\x3e         \x2b-------------------------------------------\x2b\n         |\x3cspan class=\x22hljs-string\x22\x3e                   app\/                    \x3c\/span\x3e|\n         \x2b-\x2b---------------------------------------\x2b-\x2b\n           |\x3cspan class=\x22hljs-string\x22\x3e                                       \x3c\/span\x3e|\n           |\x3cspan class=\x22hljs-string\x22\x3e                                       \x3c\/span\x3e|\n\x2b----------v------\x2b    \x2b-------------\x2b   \x2b---------v-------\x2b\n|\x3cspan class=\x22hljs-string\x22\x3e                 \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e    \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e             \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e   \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e                 \x3c\/span\x3e|\n|\x3cspan class=\x22hljs-string\x22\x3e  webpack@1.15.0 \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e    \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e async@1.5.2 \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e   \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e  nconf@0.8.5    \x3c\/span\x3e|\n|\x3cspan class=\x22hljs-string\x22\x3e                 \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e    \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e             \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e   \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e                 \x3c\/span\x3e|\n\x2b-----------------\x2b    \x2b-------------\x2b   \x2b-----------------\x2b\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e虽然这样一来 webpack\/node_modules 和 nconf\/node_modules 中都不再有 async 文件夹，但得益于 node 的模块加载机制，他们都可以在上一级 node_modules 目录中找到 async 库。所以 webpack 和 nconf 的库代码中 \x3ccode\x3erequire(\x27async\x27)\x3c\/code\x3e 语句的执行都不会有任何问题。\x3c\/p\x3e\n\x3cp\x3e这只是最简单的例子，实际的工程项目中，依赖树不可避免地会有很多层级，很多依赖包，其中会有很多同名但版本不同的包存在于不同的依赖层级，对这些复杂的情况, npm 3 都会在安装时遍历整个依赖树，计算出最合理的文件夹安装方式，使得所有被重复依赖的包都可以去重安装。\x3c\/p\x3e\n\x3cp\x3enpm 文档提供了更直观的例子解释这种情况：\x3c\/p\x3e\n\x3cblockquote\x3e假如 \x3ccode\x3epackage{dep}\x3c\/code\x3e 写法代表包和包的依赖，那么  \x3ccode\x3eA{B,C}\x3c\/code\x3e, \x3ccode\x3eB{C}\x3c\/code\x3e, \x3ccode\x3eC{D}\x3c\/code\x3e 的依赖结构在安装之后的 node_modules 是这样的结构：\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22A\n\x2b-- B\n\x2b-- C\n\x2b-- D\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3eA\n\x2b\x3cspan class=\x22hljs-comment\x22\x3e-- B\x3c\/span\x3e\n\x2b\x3cspan class=\x22hljs-comment\x22\x3e-- C\x3c\/span\x3e\n\x2b\x3cspan class=\x22hljs-comment\x22\x3e-- D\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里之所以 D 也安装到了与 B C 同一级目录，是因为 npm 会默认会在无冲突的前提下，尽可能将包安装到较高的层级。\x3c\/p\x3e\n\x3cblockquote\x3e如果是 \x3ccode\x3eA{B,C}\x3c\/code\x3e, \x3ccode\x3eB{C,D@1}\x3c\/code\x3e, \x3ccode\x3eC{D@2}\x3c\/code\x3e 的依赖关系，得到的安装后结构是：\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22A\n\x2b-- B\n\x2b-- C\n   `-- D@2\n\x2b-- D@1\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3eA\n\x2b\x3cspan class=\x22hljs-comment\x22\x3e-- B\x3c\/span\x3e\n\x2b\x3cspan class=\x22hljs-comment\x22\x3e-- C\x3c\/span\x3e\n   `\x3cspan class=\x22hljs-comment\x22\x3e-- D@2\x3c\/span\x3e\n\x2b\x3cspan class=\x22hljs-comment\x22\x3e-- D@1\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里是因为，对于 npm 来说同名但不同版本的包是两个独立的包，而同层不能有两个同名子目录，所以其中的 D@2 放到了 C 的子目录而另一个 D@1 被放到了再上一层目录。\x3c\/p\x3e\n\x3cp\x3e很明显在 npm 3 之后 npm 的依赖树结构不再与文件夹层级一一对应了。想要查看 app 的直接依赖项，要通过 \x3ccode\x3enpm ls\x3c\/code\x3e 命令指定 \x3ccode\x3e--depth\x3c\/code\x3e 参数来查看：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm ls --depth 1\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpm ls \x3cspan class=\x22hljs-comment\x22\x3e--depth 1\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3ePS: 与本地依赖包不同，如果我们通过 \x3ccode\x3enpm install --global\x3c\/code\x3e 全局安装包到全局目录时，得到的目录依然是“传统的”目录结构。而如果使用 npm 3 想要得到“传统”形式的本地 node_modules 目录，使用 \x3ccode\x3enpm install --global-style\x3c\/code\x3e 命令即可。\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e3.3 npm 5 - package-lock 文件\x3c\/h3\x3e\n\x3cp\x3enpm 5 发布于 2017 年也是目前最新的 npm 版本，这一版本依然沿用 npm 3 之后扁平化的依赖包安装方式，此外最大的变化是增加了 \x3ccode\x3epackage-lock.json\x3c\/code\x3e 文件。\x3c\/p\x3e\n\x3cp\x3epackage-lock.json 的作用是\x3cstrong\x3e锁定\x3c\/strong\x3e依赖安装结构，如果查看这个 json 的结构，会发现与 node_modules 目录的文件层级结构是一一对应的。\x3c\/p\x3e\n\x3cp\x3e以依赖关系为: \x3ccode\x3eapp{webpack}\x3c\/code\x3e 的 \x27app\x27 项目为例, 其 package-lock 文件包含了这样的片段。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;name\x26quot;:  \x26quot;app\x26quot;,\n    \x26quot;version\x26quot;:  \x26quot;0.1.0\x26quot;,\n    \x26quot;lockfileVersion\x26quot;:  1,\n    \x26quot;requires\x26quot;:  true,\n    \x26quot;dependencies\x26quot;: {\n        \/\/ ... 其他依赖包\n        \x26quot;webpack\x26quot;: {\n            \x26quot;version\x26quot;: \x26quot;1.8.11\x26quot;,\n            \x26quot;resolved\x26quot;: \x26quot;https:\/\/registry.npmjs.org\/webpack\/-\/webpack-1.8.11.tgz\x26quot;,\n            \x26quot;integrity\x26quot;: \x26quot;sha1-Yu0hnstBy\/qcKuanu6laSYtgkcI=\x26quot;,\n            \x26quot;requires\x26quot;: {\n                \x26quot;async\x26quot;: \x26quot;0.9.2\x26quot;,\n                \x26quot;clone\x26quot;: \x26quot;0.1.19\x26quot;,\n                \x26quot;enhanced-resolve\x26quot;: \x26quot;0.8.6\x26quot;,\n                \x26quot;esprima\x26quot;: \x26quot;1.2.5\x26quot;,\n                \x26quot;interpret\x26quot;: \x26quot;0.5.2\x26quot;,\n                \x26quot;memory-fs\x26quot;: \x26quot;0.2.0\x26quot;,\n                \x26quot;mkdirp\x26quot;: \x26quot;0.5.1\x26quot;,\n                \x26quot;node-libs-browser\x26quot;: \x26quot;0.4.3\x26quot;,\n                \x26quot;optimist\x26quot;: \x26quot;0.6.1\x26quot;,\n                \x26quot;supports-color\x26quot;: \x26quot;1.3.1\x26quot;,\n                \x26quot;tapable\x26quot;: \x26quot;0.1.10\x26quot;,\n                \x26quot;uglify-js\x26quot;: \x26quot;2.4.24\x26quot;,\n                \x26quot;watchpack\x26quot;: \x26quot;0.2.9\x26quot;,\n                \x26quot;webpack-core\x26quot;: \x26quot;0.6.9\x26quot;\n            }\n        },\n        \x26quot;webpack-core\x26quot;: {\n            \x26quot;version\x26quot;: \x26quot;0.6.9\x26quot;,\n            \x26quot;resolved\x26quot;: \x26quot;https:\/\/registry.npmjs.org\/webpack-core\/-\/webpack-core-0.6.9.tgz\x26quot;,\n            \x26quot;integrity\x26quot;: \x26quot;sha1-\/FcViMhVjad76e\x2b23r3Fo7FyvcI=\x26quot;,\n            \x26quot;requires\x26quot;: {\n                \x26quot;source-list-map\x26quot;: \x26quot;0.1.8\x26quot;,\n                \x26quot;source-map\x26quot;: \x26quot;0.4.4\x26quot;\n            },\n            \x26quot;dependencies\x26quot;: {\n                \x26quot;source-map\x26quot;: {\n                    \x26quot;version\x26quot;: \x26quot;0.4.4\x26quot;,\n                    \x26quot;resolved\x26quot;: \x26quot;https:\/\/registry.npmjs.org\/source-map\/-\/source-map-0.4.4.tgz\x26quot;,\n                    \x26quot;integrity\x26quot;: \x26quot;sha1-66T12pwNyZneaAMti092FzZSA2s=\x26quot;,\n                    \x26quot;requires\x26quot;: {\n                        \x26quot;amdefine\x26quot;: \x26quot;1.0.1\x26quot;\n                    }\n                }\n            }\n        },\n        \/\/... 其他依赖包\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e:  \x3cspan class=\x22hljs-string\x22\x3e\x22app\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e:  \x3cspan class=\x22hljs-string\x22\x3e\x220.1.0\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22lockfileVersion\x22\x3c\/span\x3e:  \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22requires\x22\x3c\/span\x3e:  \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22dependencies\x22\x3c\/span\x3e: {\n        \/\/ ... 其他依赖包\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22webpack\x22\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x221.8.11\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22resolved\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/registry.npmjs.org\/webpack\/-\/webpack-1.8.11.tgz\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22integrity\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22sha1-Yu0hnstBy\/qcKuanu6laSYtgkcI=\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22requires\x22\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22async\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.9.2\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22clone\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.1.19\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22enhanced-resolve\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.8.6\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22esprima\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x221.2.5\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22interpret\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.5.2\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22memory-fs\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.2.0\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22mkdirp\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.5.1\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22node-libs-browser\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.4.3\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22optimist\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.6.1\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22supports-color\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x221.3.1\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22tapable\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.1.10\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22uglify-js\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222.4.24\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22watchpack\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.2.9\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22webpack-core\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.6.9\x22\x3c\/span\x3e\n            }\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22webpack-core\x22\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.6.9\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22resolved\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/registry.npmjs.org\/webpack-core\/-\/webpack-core-0.6.9.tgz\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22integrity\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22sha1-\/FcViMhVjad76e\x2b23r3Fo7FyvcI=\x22\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22requires\x22\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22source-list-map\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.1.8\x22\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22source-map\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.4.4\x22\x3c\/span\x3e\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3e\x22dependencies\x22\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3e\x22source-map\x22\x3c\/span\x3e: {\n                    \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.4.4\x22\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-attr\x22\x3e\x22resolved\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/registry.npmjs.org\/source-map\/-\/source-map-0.4.4.tgz\x22\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-attr\x22\x3e\x22integrity\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22sha1-66T12pwNyZneaAMti092FzZSA2s=\x22\x3c\/span\x3e,\n                    \x3cspan class=\x22hljs-attr\x22\x3e\x22requires\x22\x3c\/span\x3e: {\n                        \x3cspan class=\x22hljs-attr\x22\x3e\x22amdefine\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x221.0.1\x22\x3c\/span\x3e\n                    }\n                }\n            }\n        },\n        \/\/... 其他依赖包\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e看懂 package-lock 文件并不难，其结构是同样类型的几个字段嵌套起来的，主要是 \x3ccode\x3eversion\x3c\/code\x3e, \x3ccode\x3eresolved\x3c\/code\x3e, \x3ccode\x3eintegrity\x3c\/code\x3e, \x3ccode\x3erequires\x3c\/code\x3e, \x3ccode\x3edependencies\x3c\/code\x3e 这几个字段而已。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3eversion\x3c\/code\x3e, \x3ccode\x3eresolved\x3c\/code\x3e, \x3ccode\x3eintegrity\x3c\/code\x3e 用来记录包的准确版本号、内容hash、安装源的，决定了要安装的包的准确“身份”信息\x3c\/li\x3e\n\x3cli\x3e假设盖住其他字段，只关注文件中的 \x3ccode\x3edependencies: {}\x3c\/code\x3e 我们会发现，整个文件的 JSON 配置里的 dependencies 层次结构与文件系统中 node_modules 的文件夹层次结构是完全对照的\x3c\/li\x3e\n\x3cli\x3e只关注 \x3ccode\x3erequires: {}\x3c\/code\x3e 字段又会发现，除最外层的 \x3ccode\x3erequires\x3c\/code\x3e 属性为 true 以外, 其他层的 requires 属性都对应着这个包的 package.json 里记录的自己的依赖项\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e因为这个文件记录了 node_modules 里所有包的结构、层级和版本号甚至安装源，它也就事实上提供了 “保存” node_modules 状态的能力。只要有这样一个 lock 文件，不管在那一台机器上执行 npm install 都会得到完全相同的 node_modules 结果。\x3c\/p\x3e\n\x3cp\x3e这就是 package-lock 文件致力于优化的场景：在从前仅仅用 package.json 记录依赖，由于 semver range 的机制；一个月前由 A 生成的 package.json 文件，B 在一个月后根据它执行 npm install 所得到的 node_modules 结果很可能许多包都存在不同的差异，虽然 semver 机制的限制使得同一份 package.json 不会得到大版本不同的依赖包，但同一份代码在不同环境安装出不同的依赖包，依然是可能导致意外的潜在因素。\x3c\/p\x3e\n\x3cp\x3e相同作用的文件在 npm 5 之前就有，称为 npm shrinkwrap 文件，二者作用完全相同，不同的是后者需要手动生成，而 npm 5 默认会在执行 npm install 后就生成 package-lock 文件，并且建议你提交到 git\/svn 代码库中。\x3c\/p\x3e\n\x3cp\x3epackage-lock.json 文件在最初 npm 5.0 默认引入时也引起了相当大的\x3ca href=\x22https:\/\/github.com\/npm\/npm\/issues\/16866\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e争议\x3c\/a\x3e。在 npm 5.0 中，如果已有 package-lock 文件存在，若手动在 package.json 文件新增一条依赖，再执行 npm install, 新增的依赖并不会被安装到 node_modules 中, package-lock.json 也不会做相应的更新。这样的表现与使用者的自然期望表现不符。在 npm 5.1 的首个 \x3ca href=\x22https:\/\/github.com\/npm\/npm\/issues\/16866\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRelease\x3c\/a\x3e 版本中这个问题得以修复。这个事情告诉我们，要升级，不要使用 5.0。\x3c\/p\x3e\n\x3cp\x3e——但依然有反对的声音认为 package-lock 太复杂，对此 npm 也提供了禁用配置：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm config set package-lock false\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sql\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpm config \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3epackage\x3c\/span\x3e-\x3cspan class=\x22hljs-keyword\x22\x3elock\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e4. 依赖包版本管理\x3c\/h2\x3e\n\x3cp\x3e依赖包安装完并不意味着就万事大吉了，版本的维护和更新也很重要。这一章介绍依赖包升级管理相关知识，太长不看版本请直接跳到 \x3ca href=\x22#4.3\x22\x3e4.3 最佳实践\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e4.1 semver\x3c\/h3\x3e\n\x3cp\x3enpm 依赖管理的一个重要特性是采用了\x3ca href=\x22https:\/\/semver.org\/lang\/zh-CN\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e语义化版本 (semver)\x3c\/a\x3e 规范，作为依赖\x3cstrong\x3e版本\x3c\/strong\x3e管理方案。\x3c\/p\x3e\n\x3cp\x3esemver 约定一个包的版本号必须包含3个数字，格式必须为 \x3ccode\x3eMAJOR.MINOR.PATCH\x3c\/code\x3e, 意为 \x3ccode\x3e主版本号.小版本号.修订版本号\x3c\/code\x3e.\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eMAJOR 对应大的版本号迭代，做了不兼容旧版的修改时要更新 MAJOR 版本号\x3c\/li\x3e\n\x3cli\x3eMINOR 对应小版本迭代，发生兼容旧版API的修改或功能更新时，更新MINOR版本号\x3c\/li\x3e\n\x3cli\x3ePATCH 对应修订版本号，一般针对修复 BUG 的版本号\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e对于包作者（发布者），npm 要求在 publish 之前，必须更新版本号。npm 提供了 \x3ccode\x3enpm version\x3c\/code\x3e 工具，执行 \x3ccode\x3enpm version major|minor|patch\x3c\/code\x3e 可以简单地将版本号中相应的数字加1.\x3c\/p\x3e\n\x3cblockquote\x3e如果包是一个 git 仓库，\x3ccode\x3enpm version\x3c\/code\x3e 还会自动创建一条注释为更新后版本号的 git commit 和名为该版本号的 tag\x3c\/blockquote\x3e\n\x3cp\x3e对于包的引用者来说，我们需要在 dependencies 中使用 semver 约定的 semver range 指定所需依赖包的版本号或版本范围。npm 提供了网站 \x3ca href=\x22https:\/\/semver.npmjs.com\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/semver.npmjs.com\x3c\/a\x3e 可方便地计算所输入的表达式的匹配范围。常用的规则示例如下表：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3erange\x3c\/th\x3e\n\x3cth\x3e含义\x3c\/th\x3e\n\x3cth\x3e例\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3e^2.2.1\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e指定的 MAJOR 版本号下, 所有更新的版本\x3c\/td\x3e\n\x3ctd\x3e匹配 \x3ccode\x3e2.2.3\x3c\/code\x3e, \x3ccode\x3e2.3.0\x3c\/code\x3e; 不匹配 \x3ccode\x3e1.0.3\x3c\/code\x3e, \x3ccode\x3e3.0.1\x3c\/code\x3e\n\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3e~2.2.1\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e指定 MAJOR.MINOR 版本号下，所有更新的版本\x3c\/td\x3e\n\x3ctd\x3e匹配 \x3ccode\x3e2.2.3\x3c\/code\x3e, \x3ccode\x3e2.2.9\x3c\/code\x3e ; 不匹配 \x3ccode\x3e2.3.0\x3c\/code\x3e, \x3ccode\x3e2.4.5\x3c\/code\x3e\n\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3e\x26gt;=2.1\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e版本号大于或等于 \x3ccode\x3e2.1.0\x3c\/code\x3e\n\x3c\/td\x3e\n\x3ctd\x3e匹配 \x3ccode\x3e2.1.2\x3c\/code\x3e, \x3ccode\x3e3.1\x3c\/code\x3e\n\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3e\x26lt;=2.2\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e版本号小于或等于 \x3ccode\x3e2.2\x3c\/code\x3e\n\x3c\/td\x3e\n\x3ctd\x3e匹配 \x3ccode\x3e1.0.0\x3c\/code\x3e, \x3ccode\x3e2.2.1\x3c\/code\x3e, \x3ccode\x3e2.2.11\x3c\/code\x3e\n\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3e1.0.0 - 2.0.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e版本号从 1.0.0 (含) 到 2.0.0 (含)\x3c\/td\x3e\n\x3ctd\x3e匹配 \x3ccode\x3e1.0.0\x3c\/code\x3e, \x3ccode\x3e1.3.4\x3c\/code\x3e, \x3ccode\x3e2.0.0\x3c\/code\x3e\n\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e任意两条规则，通过 \x3ccode\x3e||\x3c\/code\x3e 连接起来，则表示两条规则的并集:\x3c\/p\x3e\n\x3cp\x3e如 \x3ccode\x3e^2 \x26gt;=2.3.1 || ^3 \x26gt;3.2\x3c\/code\x3e 可以匹配:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22* `2.3.1`, `2,8.1`, `3.3.1`\n* 但不匹配 `1.0.0`, `2.2.0`, `3.1.0`, `4.0.0`\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs autohotkey\x22\x3e\x3ccode\x3e* `2.\x3cspan class=\x22hljs-number\x22\x3e3.1\x3c\/span\x3e`, `2,\x3cspan class=\x22hljs-number\x22\x3e8.1\x3c\/span\x3e`, `3.\x3cspan class=\x22hljs-number\x22\x3e3.1\x3c\/span\x3e`\n* 但不匹配 `1.\x3cspan class=\x22hljs-number\x22\x3e0.0\x3c\/span\x3e`, `2.\x3cspan class=\x22hljs-number\x22\x3e2.0\x3c\/span\x3e`, `3.\x3cspan class=\x22hljs-number\x22\x3e1.0\x3c\/span\x3e`, `4.\x3cspan class=\x22hljs-number\x22\x3e0.0\x3c\/span\x3e`\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ePS: 除了这几种，还有如下更直观的表示版本号范围的写法:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3e*\x3c\/code\x3e 或 \x3ccode\x3ex\x3c\/code\x3e 匹配所有主版本\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3e1\x3c\/code\x3e 或 \x3ccode\x3e1.x\x3c\/code\x3e 匹配 主版本号为 1 的所有版本\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3e1.2\x3c\/code\x3e 或 \x3ccode\x3e1.2.x\x3c\/code\x3e 匹配 版本号为 1.2 开头的所有版本\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3ePPS: 在常规仅包含数字的版本号之外，semver 还允许在 \x3ccode\x3eMAJOR.MINOR.PATCH\x3c\/code\x3e 后追加 \x3ccode\x3e-\x3c\/code\x3e 后跟点号分隔的标签，作为预发布版本标签 - \x3ca href=\x22https:\/\/github.com\/npm\/node-semver#prerelease-tags\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePrerelese Tags\x3c\/a\x3e，通常被视为不稳定、不建议生产使用的版本。例如：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ccode\x3e1.0.0-alpha\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3e1.0.0-beta.1\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3e1.0.0-rc.3\x3c\/code\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e上表中我们最常见的是 \x3ccode\x3e^1.8.11\x3c\/code\x3e 这种格式的 range, 因为我们在使用 \x3ccode\x3enpm install \x26lt;package name\x26gt;\x3c\/code\x3e 安装包时，npm 默认安装当前最新版本，例如 \x3ccode\x3e1.8.11\x3c\/code\x3e, 然后在所安装的版本号前加\x3ccode\x3e^\x3c\/code\x3e号, 将 \x3ccode\x3e^1.8.11\x3c\/code\x3e 写入 package.json 依赖配置，意味着可以匹配 1.8.11 以上，2.0.0 以下的所有版本。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e4.2 依赖版本升级\x3c\/h3\x3e\n\x3cp\x3e问题来了，在安装完一个依赖包之后有新版本发布了，如何使用 npm 进行版本升级呢？——答案是简单的 \x3ccode\x3enpm install\x3c\/code\x3e 或 \x3ccode\x3enpm update\x3c\/code\x3e，但在不同的 npm 版本，不同的 package.json, package-lock.json 文件，安装\/升级的表现也不同。\x3c\/p\x3e\n\x3cp\x3e我们不妨还以 webpack 举例，做如下的\x3cstrong\x3e前提假设\x3c\/strong\x3e:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e我们的工程项目 \x3ccode\x3eapp\x3c\/code\x3e 依赖 webpack\x3c\/li\x3e\n\x3cli\x3e项目最初初始化时，安装了当时最新的包 webpack@1.8.0，并且 package.json 中的依赖配置为: \x3ccode\x3e\x22webpack\x22: \x22^1.8.0\x22\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e当前（2018年3月） webpack 最新版本为 \x3ccode\x3e4.2.0\x3c\/code\x3e, webpack 1.x 最新子版本为 \x3ccode\x3e1.15.0\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e如果我们使用的是 npm 3, 并且项目不含 package-lock.json, 那么根据 node_modules 是否为空，执行 install\/update 的结果如下 (\x3cstrong\x3enode 6.13.1, npm 3.10.10\x3c\/strong\x3e 环境下试验):\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e#\x3c\/th\x3e\n\x3cth\x3epackage.json (BEFORE)\x3c\/th\x3e\n\x3cth\x3enode_modules (BEFORE)\x3c\/th\x3e\n\x3cth\x3ecommand (npm 3)\x3c\/th\x3e\n\x3cth\x3epackage.json (AFTER)\x3c\/th\x3e\n\x3cth\x3enode_modules (AFTER)\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3ea)\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3ewebpack: ^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3ewebpack@1.8.0\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3einstall\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3ewebpack: ^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3ewebpack@1.8.0\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eb)\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3ewebpack: ^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e空\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3einstall\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3ewebpack: ^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3ewebpack@1.15.0\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ec)\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3ewebpack: ^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3ewebpack@1.8.0\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3eupdate\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3ewebpack: ^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3ewebpack@1.15.0\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ed)\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3ewebpack: ^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e空\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3eupdate\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3ewebpack: ^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3ewebpack@1.15.0\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e根据这个表我们可以对 npm 3 得出以下结论：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e如果本地 node_modules 已安装，再次执行 install 不会更新包版本, 执行 update 才会更新; 而如果本地 node_modules 为空时，执行 install\/update 都会直接安装更新包;\x3c\/li\x3e\n\x3cli\x3enpm update 总是会把包更新到符合 package.json 中指定的 semver 的\x3cstrong\x3e最新\x3c\/strong\x3e版本号——本例中符合 \x3ccode\x3e^1.8.0\x3c\/code\x3e 的最新版本为 \x3ccode\x3e1.15.0\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e一旦给定 package.json, 无论后面执行 npm install 还是 update, package.json 中的 webpack 版本一直顽固地保持 一开始的 \x3ccode\x3e^1.8.0\x3c\/code\x3e 岿然不动\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e这里不合理的地方在于，如果最开始团队中第一个人安装了 \x3ccode\x3ewebpack@1.8.0\x3c\/code\x3e, 而新加入项目的成员, checkout 工程代码后执行 \x3ccode\x3enpm install\x3c\/code\x3e 会安装得到不太一样的 \x3ccode\x3e1.15.0\x3c\/code\x3e 版本。虽然 semver 约定了小版本号应当保持向下兼容（相同大版本号下的小版本号）兼容，但万一有不熟悉不遵循此约定的包发布者，发布了不兼容的包，此时就可能出现因依赖环境不同导致的 bug。\x3c\/p\x3e\n\x3cp\x3e下面由 npm 5 带着 package-lock.json 闪亮登场，执行 install\/update 的效果是这样的 (\x3cstrong\x3enode 9.8.0, npm 5.7.1\x3c\/strong\x3e 环境下试验):\x3c\/p\x3e\n\x3cblockquote\x3e下表为表述简单，省略了包名 webpack, install 简写 i, update 简写为 up\x3c\/blockquote\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e#\x3c\/th\x3e\n\x3cth\x3epackage.json (BEFORE)\x3c\/th\x3e\n\x3cth\x3enode_modules (BEFORE)\x3c\/th\x3e\n\x3cth\x3epackage-lock (BEFORE)\x3c\/th\x3e\n\x3cth\x3ecommand\x3c\/th\x3e\n\x3cth\x3epackage.json (AFTER)\x3c\/th\x3e\n\x3cth\x3enode_modules (AFTER)\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3ea)\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3e^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e@1.8.0\x3c\/td\x3e\n\x3ctd\x3e@1.8.0\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3ei\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3e^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e@1.8.0\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eb)\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3e^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e空\x3c\/td\x3e\n\x3ctd\x3e@1.8.0\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3ei\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3e^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e@1.8.0\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ec)\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3e^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e@1.8.0\x3c\/td\x3e\n\x3ctd\x3e@1.8.0\x3c\/td\x3e\n\x3ctd\x3e\x3cstrong\x3e\x3ccode\x3eup\x3c\/code\x3e\x3c\/strong\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cstrong\x3e\x3ccode\x3e^1.15.0\x3c\/code\x3e\x3c\/strong\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cstrong\x3e@1.15.0\x3c\/strong\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ed)\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3e^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e空\x3c\/td\x3e\n\x3ctd\x3e@1.8.0\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3eup\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3e^1.8.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e@1.15.0\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ee)\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3e^1.15.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e@1.8.0 (旧)\x3c\/td\x3e\n\x3ctd\x3e@1.15.0\x3c\/td\x3e\n\x3ctd\x3e\x3cstrong\x3e\x3ccode\x3ei\x3c\/code\x3e\x3c\/strong\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cstrong\x3e\x3ccode\x3e^1.15.0\x3c\/code\x3e\x3c\/strong\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cstrong\x3e@1.15.0\x3c\/strong\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ef)\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3e^1.15.0\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e@1.8.0 (旧)\x3c\/td\x3e\n\x3ctd\x3e@1.15.0\x3c\/td\x3e\n\x3ctd\x3e\x3cstrong\x3e\x3ccode\x3eup\x3c\/code\x3e\x3c\/strong\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cstrong\x3e\x3ccode\x3e^1.15.0\x3c\/code\x3e\x3c\/strong\x3e\x3c\/td\x3e\n\x3ctd\x3e\x3cstrong\x3e@1.15.0\x3c\/strong\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e与 npm 3 相比，在安装和更新依赖版本上主要的区别为：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e无论何时执行 install, npm 都会优先按照 package-lock 中指定的版本来安装 webpack; 避免了 npm 3 表中情形 b) 的状况;\x3c\/li\x3e\n\x3cli\x3e无论何时完成安装\/更新, package-lock 文件总会跟着 node_modules 更新 —— (因此可以视 package-lock 文件为 node_modules 的 JSON 表述)\x3c\/li\x3e\n\x3cli\x3e已安装 node_modules 后若执行 npm update，package.json 中的版本号也会随之更改为 \x3ccode\x3e^1.15.0\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e由此可见 npm 5.1 使得 package.json 和 package-lock.json 中所保存的版本号更加统一，解决了 npm 之前的各种问题。只要遵循好的实践习惯，团队成员可以很方便地维护一套应用代码和 node_modules 依赖都一致的环境。\x3c\/p\x3e\n\x3cp\x3e皆大欢喜。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e4.3 最佳实践\x3c\/h3\x3e\n\x3cp\x3e总结起来，在 2018 年 (node 9.8.0, npm 5.7.1) 时代，我认为的依赖版本管理应当是:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e使用 npm: \x3ccode\x3e\x26gt;=5.1\x3c\/code\x3e 版本, 保持 \x3ccode\x3epackage-lock.json\x3c\/code\x3e 文件默认开启配置\x3c\/li\x3e\n\x3cli\x3e初始化：第一作者初始化项目时使用 \x3ccode\x3enpm install \x26lt;package\x26gt;\x3c\/code\x3e 安装依赖包, 默认保存 \x3ccode\x3e^X.Y.Z\x3c\/code\x3e 依赖 range 到 package.json中; 提交 \x3ccode\x3epackage.json\x3c\/code\x3e, \x3ccode\x3epackage-lock.json\x3c\/code\x3e, \x3cstrong\x3e不要提交\x3c\/strong\x3e \x3ccode\x3enode_modules\x3c\/code\x3e 目录\x3c\/li\x3e\n\x3cli\x3e初始化：项目成员\x3cstrong\x3e首次\x3c\/strong\x3e checkout\/clone 项目代码后，执行\x3cstrong\x3e一次\x3c\/strong\x3e \x3ccode\x3enpm install\x3c\/code\x3e 安装依赖包\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e不要\x3c\/strong\x3e手动修改 package-lock.json\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e升级依赖包:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e升级小版本: 本地执行 \x3ccode\x3enpm update\x3c\/code\x3e 升级到新的小版本\x3c\/li\x3e\n\x3cli\x3e升级大版本: 本地执行 \x3ccode\x3enpm install \x26lt;package-name\x26gt;@\x26lt;version\x26gt;\x3c\/code\x3e 升级到新的大版本\x3c\/li\x3e\n\x3cli\x3e也可手动修改 package.json 中版本号为要\x3cstrong\x3e升级\x3c\/strong\x3e的版本(大于现有版本号)并指定所需的 semver, 然后执行 \x3ccode\x3enpm install\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e本地验证升级后新版本无问题后，\x3cstrong\x3e提交\x3c\/strong\x3e新的 \x3ccode\x3epackage.json\x3c\/code\x3e, \x3ccode\x3epackage-lock.json\x3c\/code\x3e 文件\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e降级依赖包:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3e正确\x3c\/strong\x3e: \x3ccode\x3enpm install \x26lt;package-name\x26gt;@\x26lt;old-version\x26gt;\x3c\/code\x3e 验证无问题后，\x3cstrong\x3e提交\x3c\/strong\x3e package.json 和 package-lock.json 文件\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e错误\x3c\/strong\x3e: 手动修改 \x3ccode\x3epackage.json\x3c\/code\x3e 中的版本号为更低版本的 semver, 这样修改并不会生效，因为再次执行 \x3ccode\x3enpm install\x3c\/code\x3e 依然会安装 \x3ccode\x3epackage-lock.json\x3c\/code\x3e 中的锁定版本\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e删除依赖包:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3ePlan A: \x3ccode\x3enpm uninstall \x26lt;package\x26gt;\x3c\/code\x3e 并提交 \x3ccode\x3epackage.json\x3c\/code\x3e 和 \x3ccode\x3epackage-lock.json\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3ePlan B: 把要卸载的包从 package.json 中 dependencies 字段删除, 然后执行 \x3ccode\x3enpm install\x3c\/code\x3e 并提交 \x3ccode\x3epackage.json\x3c\/code\x3e 和 \x3ccode\x3epackage-lock.json\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e任何时候有人提交了 package.json, package-lock.json 更新后，团队其他成员应在 svn update\/git pull 拉取更新后执行 \x3ccode\x3enpm install\x3c\/code\x3e 脚本安装更新后的依赖包\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cdel\x3e恭喜你终于可以跟 \x3cstrong\x3e\x3ccode\x3erm -rf node_modules\x3c\/code\x3e \x26amp;\x26amp; \x3ccode\x3enpm install\x3c\/code\x3e\x3c\/strong\x3e 这波操作说拜拜了（其实并不会）\x3c\/del\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader14\x22\x3e5. npm scripts\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e5.1 基本使用\x3c\/h3\x3e\n\x3cp\x3enpm scripts 是 npm 另一个很重要的特性。通过在 package.json 中 scripts 字段定义一个脚本，例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;scripts\x26quot;: {\n        \x26quot;echo\x26quot;: \x26quot;echo HELLO WORLD\x26quot;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22echo\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22echo HELLO WORLD\x22\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们就可以通过 \x3ccode\x3enpm run echo\x3c\/code\x3e 命令来执行这段脚本，像在 shell 中执行该命令 \x3ccode\x3eecho HELLO WORLD\x3c\/code\x3e 一样，看到终端输出 \x3ccode\x3eHELLO WORLD\x3c\/code\x3e.\x3c\/p\x3e\n\x3cp\x3e—— npm scripts 的基本使用就是这么简单，它提供了一个简单的接口用来调用工程相关的脚本。关于更详细的相关信息，可以参考阮一峰老师的文章 \x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2016\/10\/npm_scripts.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enpm script 使用指南 (2016年10月)\x3c\/a\x3e.\x3c\/p\x3e\n\x3cp\x3e简要总结阮老师文章内容：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3ccode\x3enpm run\x3c\/code\x3e 命令执行时，会把 \x3ccode\x3e.\/node_modules\/.bin\/\x3c\/code\x3e 目录添加到执行环境的 \x3ccode\x3ePATH\x3c\/code\x3e 变量中，因此如果某个\x3cstrong\x3e命令行包\x3c\/strong\x3e未全局安装，而只安装在了当前项目的 node_modules 中，通过 \x3ccode\x3enpm run\x3c\/code\x3e 一样可以调用该命令。\x3c\/li\x3e\n\x3cli\x3e执行 npm 脚本时要传入参数，需要在命令后加 \x3ccode\x3e--\x3c\/code\x3e 标明, 如 \x3ccode\x3enpm run test -- --grep=\x22pattern\x22\x3c\/code\x3e 可以将 \x3ccode\x3e--grep=\x22pattern\x22\x3c\/code\x3e 参数传给 \x3ccode\x3etest\x3c\/code\x3e 命令\x3c\/li\x3e\n\x3cli\x3enpm 提供了 pre 和 post 两种钩子机制，可以定义某个脚本前后的执行脚本\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e运行时变量：在 \x3ccode\x3enpm run\x3c\/code\x3e 的脚本执行环境内，可以通过环境变量的方式获取许多运行时相关信息，以下都可以通过 \x3ccode\x3eprocess.env\x3c\/code\x3e 对象访问获得：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3enpm_lifecycle_event\x3c\/code\x3e - 正在运行的脚本名称\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3enpm_package_\x26lt;key\x26gt;\x3c\/code\x3e - 获取当前包 package.json 中某个字段的配置值：如 \x3ccode\x3enpm_package_name\x3c\/code\x3e 获取包名\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3enpm_package_\x26lt;key\x26gt;_\x26lt;sub-key\x26gt;\x3c\/code\x3e - package.json 中嵌套字段属性：如 \x3ccode\x3enpm_pacakge_dependencies_webpack\x3c\/code\x3e 可以获取到 package.json 中的 \x3ccode\x3edependencies.webpack\x3c\/code\x3e 字段的值，即 webpack 的版本号\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3e5.2 node_modules\/.bin 目录\x3c\/h3\x3e\n\x3cp\x3e上面所说的 \x3ccode\x3enode_modules\/.bin\x3c\/code\x3e 目录，保存了依赖目录中所安装的可供调用的命令行包。\x3c\/p\x3e\n\x3cp\x3e何谓命令行包？例如 \x3ccode\x3ewebpack\x3c\/code\x3e 就属于一个命令行包。如果我们在安装 webpack 时添加 \x3ccode\x3e--global\x3c\/code\x3e 参数，就可以在终端直接输入 \x3ccode\x3ewebpack\x3c\/code\x3e 进行调用。但如果不加 \x3ccode\x3e--global\x3c\/code\x3e 参数，我们会在 \x3ccode\x3enode_modules\/.bin\x3c\/code\x3e 目录里看到名为 webpack 的文件，如果在终端直接输入 \x3ccode\x3e.\/node_modules\/.bin\/webpack\x3c\/code\x3e 命令，一样可以执行。\x3c\/p\x3e\n\x3cp\x3e这是因为 \x3ccode\x3ewebpack\x3c\/code\x3e 在 \x3ccode\x3epackage.json\x3c\/code\x3e 文件中定义了 \x3ccode\x3ebin\x3c\/code\x3e 字段为:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;bin\x26quot;: {\n        \x26quot;webpack\x26quot;: \x26quot;.\/bin\/webpack.js\x26quot;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs json\x22\x3e\x3ccode\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22bin\x22\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22webpack\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22.\/bin\/webpack.js\x22\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ebin 字段的配置格式为: \x3ccode\x3e\x26lt;command\x26gt;: \x26lt;file\x26gt;\x3c\/code\x3e, 即 \x3ccode\x3e命令名: 可执行文件\x3c\/code\x3e. npm 执行 install 时，会分析每个依赖包的 package.json 中的 \x3ccode\x3ebin\x3c\/code\x3e 字段，并将其包含的条目安装到 \x3ccode\x3e.\/node_modules\/.bin\x3c\/code\x3e 目录中，文件名为 \x3ccode\x3e\x26lt;command\x26gt;\x3c\/code\x3e。而如果是全局模式安装，则会在 npm 全局安装路径的 bin 目录下创建指向 \x3ccode\x3e\x26lt;file\x26gt;\x3c\/code\x3e 名为 \x3ccode\x3e\x26lt;command\x26gt;\x3c\/code\x3e 的软链。因此，\x3ccode\x3e.\/node_modules\/.bin\/webpack\x3c\/code\x3e 文件在通过命令行调用时，实际上就是在执行 \x3ccode\x3enode .\/node_modules\/.bin\/webpack.js\x3c\/code\x3e 命令。\x3c\/p\x3e\n\x3cp\x3e正如上一节所说，\x3ccode\x3enpm run\x3c\/code\x3e 命令在执行时会把 \x3ccode\x3e.\/node_modules\/.bin\x3c\/code\x3e 加入到 \x3ccode\x3ePATH\x3c\/code\x3e 中，使我们可直接调用所有提供了命令行调用接口的依赖包。所以这里就引出了一个最佳实践：\x3c\/p\x3e\n\x3cblockquote\x3e将项目依赖的命令行工具安装到项目依赖文件夹中，然后通过 npm scripts 调用；而非全局安装\x3c\/blockquote\x3e\n\x3cp\x3e举例而言 \x3ccode\x3ewebpack\x3c\/code\x3e 作为前端工程标配的构建工具，虽然我们都习惯了全局安装并直接使用命令行调用，但不同的项目依赖的 webpack 版本可能不同，相应的 \x3ccode\x3ewebpack.config.js\x3c\/code\x3e 配置文件也可能只兼容了特定版本的 webpack. 如果我们仅全局安装了最新的 webpack 4.x 并使用 webpack 命令调用，在一个依赖 webpack 3.x 的工程中就会无法成功执行构建。\x3c\/p\x3e\n\x3cp\x3e但如果这类工具总是本地安装，我们要调用一个命令，要手动添加 \x3ccode\x3e.\/node_modules\/.bin\x3c\/code\x3e 这个长长的前缀，未免也太麻烦了，我们 nodejs 开发者都很懒的。于是 npm 从5.2 开始自带了一个新的工具 \x3ccode\x3enpx\x3c\/code\x3e.\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3e5.3 npx\x3c\/h3\x3e\n\x3cp\x3enpx 的使用很简单，就是执行 \x3ccode\x3enpx \x26lt;command\x26gt;\x3c\/code\x3e 即可，这里的 \x3ccode\x3e\x26lt;command\x26gt;\x3c\/code\x3e 默认就是 \x3ccode\x3e.\/node_modules\x3c\/code\x3e 目录中安装的可执行脚本名。例如上面本地安装好的 webpack 包，我们可以直接使用 \x3ccode\x3enpx webpack\x3c\/code\x3e 执行即可。\x3c\/p\x3e\n\x3cp\x3e除了这种最简单的场景, npm cli 团队开发者 Kat Marchán 还在这篇文章中介绍了其他几种 npx 的神奇用法:  \x3ca href=\x22https:\/\/bit.ly\/2uzuIHv\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eIntroducing npx: an npm package runner\x3c\/a\x3e, 国内有位开发者 robin.law 将原文翻译为中文 \x3ca href=\x22https:\/\/robin-front.github.io\/2017\/07\/14\/introducing-npx-an-npm-package-runner\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enpx是什么，为什么需要npx?\x3c\/a\x3e.\x3c\/p\x3e\n\x3cp\x3e有兴趣的可以戳链接了解，懒得点链接的，看总结：\x3c\/p\x3e\n\x3ch4\x3e场景a) 一键执行远程 npm 源的二进制包\x3c\/h4\x3e\n\x3cp\x3e除了在 package 中执行 .\/node_modules\/.bin 中已安装的命令, 还可以直接指定未安装的二进制包名执行。例如我们在一个没有 package.json 也没有 node_modules 的目录下，执行:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npx cowsay hello\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3enpx cowsay hello\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3enpx 将会从 npm 源下载 \x3ccode\x3ecowsay\x3c\/code\x3e 这个包（但并不安装）并执行：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 _______ \n\x3c hello \x3e\n ------- \n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\\/\\\n                ||----w |\n                ||     ||\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs tex\x22\x3e\x3ccode\x3e _______ \n\x26lt; hello \x26gt;\n ------- \n        \x3cspan class=\x22hljs-tag\x22\x3e\\\x3cspan class=\x22hljs-name\x22\x3e \x3c\/span\x3e\x3c\/span\x3e  ^__^\n         \x3cspan class=\x22hljs-tag\x22\x3e\\\x3cspan class=\x22hljs-name\x22\x3e \x3c\/span\x3e\x3c\/span\x3e (oo)\x3cspan class=\x22hljs-tag\x22\x3e\\\x3cspan class=\x22hljs-name\x22\x3e_\x3c\/span\x3e\x3c\/span\x3e______\n            (__)\x3cspan class=\x22hljs-tag\x22\x3e\\\x3cspan class=\x22hljs-name\x22\x3e \x3c\/span\x3e\x3c\/span\x3e      )\x3cspan class=\x22hljs-tag\x22\x3e\\\x3cspan class=\x22hljs-name\x22\x3e\/\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\\\x3cspan class=\x22hljs-name\x22\x3e\n\x3c\/span\x3e\x3c\/span\x3e                ||----w |\n                ||     ||\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种用途非常适合 1. 在本地简单测试或调试 npm 源上这些二进制包的功能；2. 调用 create-react-app 或 yeoman 这类往往每个项目只需要使用一次的脚手架工具\x3c\/p\x3e\n\x3cp\x3ePS: 此处有彩蛋，执行这条命令试试:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npx workin-hard\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3enpx workin-hard\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e场景b) 一键执行 GitHub Gist\x3c\/h4\x3e\n\x3cp\x3e还记得前面提到的 \x3ca href=\x22#2.1\x22\x3e2.1 package定义\x3c\/a\x3e 么，\x3ccode\x3enpm install \x26lt;package\x26gt;\x3c\/code\x3e 可以是包含了有效 package.json 的 git url.\x3c\/p\x3e\n\x3cp\x3e刚好 GitHub Gist 也是 git 仓库 的一种，集合 npx 就可以方便地将简单的脚本共享给其他人，拥有该链接的人无需将脚本安装到本地工作目录即可执行。将 package.json 和 需执行的二进制脚本上传至 gist, 在运行 \x3ccode\x3enpx \x26lt;gist url\x26gt;\x3c\/code\x3e 就可以方便地执行该 gist 定义的命令。\x3c\/p\x3e\n\x3cp\x3e原文作者 Kat Marchán 提供了\x3ca href=\x22https:\/\/gist.github.com\/zkat\/4bc19503fe9e9309e2bfaa2c58074d32\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这个\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22zkat\/4bc19503fe9e9309e2bfaa2c58074d32\x22 data-typeid=\x221\x22\x3e点击预览\x3c\/button\x3e示例 gist, 执行：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npx https:\/\/gist.github.com\/zkat\/4bc19503fe9e9309e2bfaa2c58074d32\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs awk\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpx https:\x3cspan class=\x22hljs-regexp\x22\x3e\/\/gi\x3c\/span\x3est.github.com\x3cspan class=\x22hljs-regexp\x22\x3e\/zkat\/\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3ebc19503fe9e9309e2bfaa2c58074d32\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可得到一个来自 GitHubGist 的 hello world 问候。\x3c\/p\x3e\n\x3ch4\x3e场景c) 使用不同版本 node 执行命令\x3c\/h4\x3e\n\x3cp\x3e将 npx 与 Aria Stewart 创建的 \x3ccode\x3enode\x3c\/code\x3e 包 (\x3ca href=\x22https:\/\/www.npmjs.com\/package\/node)\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/www.npmjs.com\/package...\x3c\/a\x3e 结合，可以实现在一行命令中使用指定版本的 node 执行命令。\x3c\/p\x3e\n\x3cp\x3e例如先后执行：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npx node@4 -e \x26quot;console.log(process.version)\x26quot;\nnpx node@6 -e \x26quot;console.log(process.version)\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3enpx \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e@4\x3c\/span\x3e -e \x3cspan class=\x22hljs-string\x22\x3e\x22console.log(process.version)\x22\x3c\/span\x3e\nnpx \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e@6\x3c\/span\x3e -e \x3cspan class=\x22hljs-string\x22\x3e\x22console.log(process.version)\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e将分别输出 \x3ccode\x3ev4.8.7\x3c\/code\x3e 和 \x3ccode\x3ev6.13.0\x3c\/code\x3e.\x3c\/p\x3e\n\x3cp\x3e往常这种工作是由 \x3ccode\x3envm\x3c\/code\x3e 这类 node 版本管理工具来做的，但 \x3ccode\x3enpx node@4\x3c\/code\x3e 这种方式免去 nvm 手动切换配置的步骤，更加简洁简单。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader18\x22\x3e6. npm 配置\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader19\x22\x3e6.1 npm config\x3c\/h3\x3e\n\x3cp\x3enpm cli 提供了 \x3ccode\x3enpm config\x3c\/code\x3e 命令进行 npm 相关配置，通过 \x3ccode\x3enpm config ls -l\x3c\/code\x3e 可查看 npm 的所有配置，包括默认配置。npm 文档页为每个配置项提供了详细的说明 \x3ca href=\x22https:\/\/docs.npmjs.com\/misc\/config\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/docs.npmjs.com\/misc\/c...\x3c\/a\x3e .\x3c\/p\x3e\n\x3cp\x3e修改配置的命令为 \x3ccode\x3enpm config set \x26lt;key\x26gt; \x26lt;value\x26gt;\x3c\/code\x3e, 我们使用相关的常见重要配置:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3eproxy\x3c\/code\x3e, \x3ccode\x3ehttps-proxy\x3c\/code\x3e: 指定 npm 使用的代理\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eregistry\x3c\/code\x3e 指定 npm 下载安装包时的源，默认为 \x3ccode\x3ehttps:\/\/registry.npmjs.org\/\x3c\/code\x3e 可以指定为私有 Registry 源\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3epackage-lock\x3c\/code\x3e 指定是否默认生成 package-lock 文件，建议保持默认 true\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3esave\x3c\/code\x3e true\/false 指定是否在 npm install 后保存包为 dependencies, npm 5 起默认为 true\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e删除指定的配置项命令为 \x3ccode\x3enpm config delete \x26lt;key\x26gt;\x3c\/code\x3e.\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader20\x22\x3e6.2 npmrc 文件\x3c\/h3\x3e\n\x3cp\x3e除了使用 CLI 的 \x3ccode\x3enpm config\x3c\/code\x3e 命令显示更改 npm 配置，还可以通过 npmrc 文件直接修改配置。\x3c\/p\x3e\n\x3cp\x3e这样的 npmrc 文件优先级由高到低包括：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e工程内配置文件: \x3ccode\x3e\/path\/to\/my\/project\/.npmrc\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e用户级配置文件: \x3ccode\x3e~\/.npmrc\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e全局配置文件: \x3ccode\x3e$PREFIX\/etc\/npmrc\x3c\/code\x3e (即\x3ccode\x3enpm config get globalconfig\x3c\/code\x3e 输出的路径)\x3c\/li\x3e\n\x3cli\x3enpm内置配置文件: \x3ccode\x3e\/path\/to\/npm\/npmrc\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e通过这个机制，我们可以方便地在工程跟目录创建一个 \x3ccode\x3e.npmrc\x3c\/code\x3e 文件来共享需要在团队间共享的 npm 运行相关配置。比如如果我们在公司内网环境下需通过代理才可访问 registry.npmjs.org 源，或需访问内网的 registry, 就可以在工作项目下新增 .npmrc 文件并提交代码库。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22proxy = http:\/\/proxy.example.com\/\nhttps-proxy = http:\/\/proxy.example.com\/\nregistry = http:\/\/registry.example.com\/\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3eproxy = \x3cspan class=\x22hljs-string\x22\x3ehttp:\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/proxy.example.com\/\x3c\/span\x3e\nhttps-proxy = \x3cspan class=\x22hljs-string\x22\x3ehttp:\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/proxy.example.com\/\x3c\/span\x3e\nregistry = \x3cspan class=\x22hljs-string\x22\x3ehttp:\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/registry.example.com\/\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e因为项目级 .npmrc 文件的作用域只在本项目下，所以在非本目录下，这些配置并不生效。对于使用笔记本工作的开发者，可以很好地隔离公司的工作项目、在家学习研究项目两种不同的环境。\x3c\/p\x3e\n\x3cp\x3e将这个功能与 \x3ccode\x3e~\/.npm-init.js\x3c\/code\x3e 配置相结合，可以将特定配置的 .npmrc 跟 .gitignore, README 之类文件一起做到 npm init 脚手架中，进一步减少手动配置。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader21\x22\x3e6.3 node 版本约束\x3c\/h3\x3e\n\x3cp\x3e虽然一个项目的团队都共享了相同的代码，但每个人的开发机器可能安装了不同的 node 版本，此外服务器端的也可能与本地开发机不一致。\x3c\/p\x3e\n\x3cp\x3e这又是一个可能带来不一致性的因素 —— 但也不是很难解决，声明式约束\x2b脚本限制即可。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e声明\x3c\/strong\x3e：通过 \x3ccode\x3epackage.json\x3c\/code\x3e 的 \x3ccode\x3eengines\x3c\/code\x3e 属性声明应用运行所需的版本运行时要求。例如我们的项目中使用了 \x3ccode\x3easync\x3c\/code\x3e, \x3ccode\x3eawait\x3c\/code\x3e 特性，\x3ca href=\x22https:\/\/node.green\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e查阅兼容性表格\x3c\/a\x3e得知最低支持版本为 7.6.0，因此指定 engines 配置为:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;engines\x26quot;: { \x26quot;node\x26quot;: \x26quot;\x3e=7.6.0\x26quot;}\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22engines\x22\x3c\/span\x3e: { \x3cspan class=\x22hljs-attr\x22\x3e\x22node\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\x26gt;=7.6.0\x22\x3c\/span\x3e}\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e强约束\x3c\/strong\x3e(可选)：在 npm 中以上字段内容仅作为建议字段使用，若要在私有项目中添加强约束，需要自己写脚本钩子，读取并解析 engines 字段的 semver range 并与运行时环境做对比校验并适当提醒。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader22\x22\x3e7. 小结 npm 最佳实践\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e使用 npm-init 初始化新项目\x3c\/li\x3e\n\x3cli\x3e统一项目配置: 需团队共享的 npm config 配置项，固化到 .npmrc 文件中\x3c\/li\x3e\n\x3cli\x3e统一运行环境，统一 package.json，统一 package-lock 文件\x3c\/li\x3e\n\x3cli\x3e合理使用多样化的源安装依赖包: \x3ccode\x3enpm install \x26lt;git url\x26gt;|\x26lt;local file\x26gt;\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e使用 npm: \x26gt;=5.2 版本\x3c\/li\x3e\n\x3cli\x3e使用 npm scripts 与 npx (npm: \x26gt;=5.2) 脚本管理应用相关脚本\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader23\x22\x3e8. 更多资料\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e参考\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3enpm team 成员 Ashley Williams 在 2016 年 Node.js Live 上的 talk: \x3cem\x3eYou Don\x27t Know npm\x3c\/em\x3e, 当时还没有 npm 5\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eYouTube 视频链接: \x3ca href=\x22https:\/\/www.youtube.com\/watch?v=hopWbVKmiVQ\x26amp;t=537s\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNode.js Live (Paris) - Ashley Williams, You Don\x27t Know npm\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e演讲用的 slides: \x3ca href=\x22http:\/\/ashleygwilliams.github.io\/you-dont-know-npm\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ethe ag_deck\x3c\/a\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e这篇 2015 年的文章介绍了如何使用把本地模块打包到 node_modules 依赖中: \x3ca href=\x22https:\/\/bit.ly\/2DLnaCd\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eBuild modular application with npm local modules\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e一篇很好的介绍 package-lock.json 的文章: \x3ca href=\x22https:\/\/bit.ly\/2Fiok9Z\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eEverything you wanted to know about package-lock.json\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e阮一峰 \x3ca href=\x22http:\/\/ruanyifeng.com\/blog\/2016\/10\/npm_scripts.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enpm scripts 使用指南\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3eKat Marchán 介绍npx:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e原文 \x3ca href=\x22http:\/\/t.cn\/RKIYHBA\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eIntroducing npx: an npm package runner\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e中文 \x3ca href=\x22https:\/\/robin-front.github.io\/2017\/07\/14\/introducing-npx-an-npm-package-runner\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enpx是什么，为什么需要npx?\x3c\/a\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e文档\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3enpm 官方文档, 无中文翻译\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/docs.npmjs.com\/files\/package.json\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epackage.json 文件\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/docs.npmjs.com\/misc\/config\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enpm config 配置\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/semver.npmjs.com\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enpm semver 计算器\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/docs.npmjs.com\/cli\/install\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enode_modules 目录扁平化\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3eyarn 中文文档，虽然是 npm 竞争者但兼容 package.json 和 node_modules 目录，因此这两部分一样可参考：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/yarnpkg.com\/zh-Hans\/docs\/package-json\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epackage.json - 中文\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/yarnpkg.com\/zh-Hans\/docs\/dependencies\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e依赖与版本 - 中文\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e延伸阅读\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3esam boyer 《所以你想开发一个包管理系统》，从无关特定语言的角度，介绍一个包管理系统的方面: \x3ca href=\x22https:\/\/bit.ly\/2G36U1e\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSo you want to write a package manager\x3c\/a\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>2018 年了，你还是只会 npm install 吗</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013962514">https://segmentfault.com/a/1190000013962514</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/q4bszhf0v8/" target="_blank">https://alili.tech/archive/q4bszhf0v8/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>