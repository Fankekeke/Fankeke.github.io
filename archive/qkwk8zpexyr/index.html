<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="原生JS写一个功能强大的编辑器"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>原生JS写一个功能强大的编辑器 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/qkwk8zpexyr/",
				"appid": "1613049289050283", 
				"title": "原生JS写一个功能强大的编辑器 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-28T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/t3ynmntvxmh/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/01pro19uo0mo/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fqkwk8zpexyr%2f&text=%e5%8e%9f%e7%94%9fJS%e5%86%99%e4%b8%80%e4%b8%aa%e5%8a%9f%e8%83%bd%e5%bc%ba%e5%a4%a7%e7%9a%84%e7%bc%96%e8%be%91%e5%99%a8"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fqkwk8zpexyr%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fqkwk8zpexyr%2f&text=%e5%8e%9f%e7%94%9fJS%e5%86%99%e4%b8%80%e4%b8%aa%e5%8a%9f%e8%83%bd%e5%bc%ba%e5%a4%a7%e7%9a%84%e7%bc%96%e8%be%91%e5%99%a8"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fqkwk8zpexyr%2f&title=%e5%8e%9f%e7%94%9fJS%e5%86%99%e4%b8%80%e4%b8%aa%e5%8a%9f%e8%83%bd%e5%bc%ba%e5%a4%a7%e7%9a%84%e7%bc%96%e8%be%91%e5%99%a8"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fqkwk8zpexyr%2f&is_video=false&description=%e5%8e%9f%e7%94%9fJS%e5%86%99%e4%b8%80%e4%b8%aa%e5%8a%9f%e8%83%bd%e5%bc%ba%e5%a4%a7%e7%9a%84%e7%bc%96%e8%be%91%e5%99%a8"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%8e%9f%e7%94%9fJS%e5%86%99%e4%b8%80%e4%b8%aa%e5%8a%9f%e8%83%bd%e5%bc%ba%e5%a4%a7%e7%9a%84%e7%bc%96%e8%be%91%e5%99%a8&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fqkwk8zpexyr%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fqkwk8zpexyr%2f&title=%e5%8e%9f%e7%94%9fJS%e5%86%99%e4%b8%80%e4%b8%aa%e5%8a%9f%e8%83%bd%e5%bc%ba%e5%a4%a7%e7%9a%84%e7%bc%96%e8%be%91%e5%99%a8"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fqkwk8zpexyr%2f&title=%e5%8e%9f%e7%94%9fJS%e5%86%99%e4%b8%80%e4%b8%aa%e5%8a%9f%e8%83%bd%e5%bc%ba%e5%a4%a7%e7%9a%84%e7%bc%96%e8%be%91%e5%99%a8"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fqkwk8zpexyr%2f&title=%e5%8e%9f%e7%94%9fJS%e5%86%99%e4%b8%80%e4%b8%aa%e5%8a%9f%e8%83%bd%e5%bc%ba%e5%a4%a7%e7%9a%84%e7%bc%96%e8%be%91%e5%99%a8"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fqkwk8zpexyr%2f&title=%e5%8e%9f%e7%94%9fJS%e5%86%99%e4%b8%80%e4%b8%aa%e5%8a%9f%e8%83%bd%e5%bc%ba%e5%a4%a7%e7%9a%84%e7%bc%96%e8%be%91%e5%99%a8"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">原生JS写一个功能强大的编辑器</h1><div class="meta"><div class="postdate"><time datetime="2018-12-28" itemprop="datePublished">2018-12-28</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e因为一个同学，要做一个能加入图片的留言板功能，类型与QQ空间留言板和百度贴吧发帖的那种形式，同时在网上找了找发生网上对这方面的交流很少，所以发表这篇文章抛砖引玉，希望能帮助广大的学习者，也同时希望大佬能对此文章及本人写的代码，不吝赐教。\x3cbr\x3e主要采用了原生JS与调用Selection API结合html的contentible功能实现功能。\x3c\/p\x3e\n\x3cp\x3e1.先来看看效果\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVWYIo?w=837\x26amp;h=499\x22 src=\x22https:\/\/static.alili.tech\/img\/bVWYIo?w=837\x26amp;h=499\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e2.主要功能\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221.在当前光标位置添加指定图片，并=点击以后修改图片大小\n2.修改选中文字的大小，字体颜色及添加斜体、粗体、下划线\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3e在当前光标位置添加指定图片，并=点击以后修改图片大小\n\x3cspan class=\x22hljs-number\x22\x3e2.\x3c\/span\x3e修改选中文字的大小，字体颜色及添加斜体、粗体、下划线\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e3.代码及一些难点部分\x3cbr\x3e首先看一个很很很关键和重要的函数\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function getSelectionRange() { \n    var select;\n    \/\/兼容处理\n    if (window.getSelection) { \n        select = window.getSelection();\n           range = select.getRangeAt(0);\/\/获取selection对象,并获取range对象\n    } else if (document.selection) { \n        \/\/IE浏览器\n        range = document.selection.createRange();\/\/IE可以直接获取\n    };\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetSelectionRange\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e select;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/兼容处理\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.getSelection) { \n        select = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.getSelection();\n           range = select.getRangeAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/获取selection对象,并获取range对象\x3c\/span\x3e\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.selection) { \n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/IE浏览器\x3c\/span\x3e\n        range = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.selection.createRange();\x3cspan class=\x22hljs-comment\x22\x3e\/\/IE可以直接获取\x3c\/span\x3e\n    };\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个函数是调用seleciton API并用range保存当前光标位置，方便后面插入图片和给代码修改文字样式\x3c\/p\x3e\n\x3cp\x3e其次另外一个也很关键的函数是\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/插入节点\nfunction insert(newNode){\n    var fragNode = document.createDocumentFragment().appendChild(newNode);\/\/创建文档碎片并放入新节点\n    range.deleteContents();\/\/删除Rnge中的内容\n    range.insertNode(fragNode);\/\/再插入新碎片\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/插入节点\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einsert\x3c\/span\x3e\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eNode\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fragNode = document.createDocumentFragment().appendChild(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eNode\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/创建文档碎片并放入新节点\x3c\/span\x3e\n    range.deleteContents();\x3cspan class=\x22hljs-comment\x22\x3e\/\/删除Rnge中的内容\x3c\/span\x3e\n    range.insertNode(fragNode);\x3cspan class=\x22hljs-comment\x22\x3e\/\/再插入新碎片\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个函数接收一个新的也就是要插入节点的形参，然后删除当前位置的内容（如果选中的是文字这把当前这选中的文字删除掉）最后把新创建的节点插入到光标的位置。\x3c\/p\x3e\n\x3cp\x3e我们在来看看另外一个难点部分，就是获取选中的文字，，这里我采用的是鼠标的监听事件，mousedown-\x26gt;mousemove-\x26gt;mouseup，分别的监听，来判断是否鼠标发生移动，及得到鼠标选中的文本\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/获取选中的字符\nedit.addEventListener(\x26quot;click\x26quot;,function(){\n    getSelectionRange();\/\/获取Range\n});\nedit.addEventListener(\x26quot;mousedown\x26quot;,function(){\n    edit.addEventListener(\x26quot;mousemove\x26quot;,listenMove);\n});\nfunction listenMove(){\n    moved=true;\n};\nedit.addEventListener(\x26quot;mouseup\x26quot;,function(){\n    if(!moved){\n        return;\n    }\n    \/\/当有选中内容才进行操作\n    edit.removeEventListener(\x26quot;mousemove\x26quot;,listenMove);\n    getSelectionRange();\n    selectTxt= range.toString();\/\/将选择的内容从对象中提取出来,直接转字符串就行了。\n    moved = false;\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/获取选中的字符\x3c\/span\x3e\nedit.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22click\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e{\n    getSelectionRange();\x3cspan class=\x22hljs-comment\x22\x3e\/\/获取Range\x3c\/span\x3e\n});\nedit.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22mousedown\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e{\n    edit.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22mousemove\x22\x3c\/span\x3e,listenMove);\n});\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3elistenMove\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e{\n    moved=\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n};\nedit.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22mouseup\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!moved){\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/当有选中内容才进行操作\x3c\/span\x3e\n    edit.removeEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22mousemove\x22\x3c\/span\x3e,listenMove);\n    getSelectionRange();\n    selectTxt= range.toString();\x3cspan class=\x22hljs-comment\x22\x3e\/\/将选择的内容从对象中提取出来,直接转字符串就行了。\x3c\/span\x3e\n    moved = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e先在mousedown函数里面获取一次range,然后在mouseup的函数里面再次获取range得到选中的文字用selectTxt保存，这里在我看来只要是理清楚思路这里很好理解。\x3cbr\x3e到了这里我们就已经把几个比较困难的问题解决了，剩下的插入文字和图片及改变图片的大小，都是很简单的基本操作。\x3cbr\x3e我以插入图片为例，大家可以拿到代码以后自己理一理插入文字的思路：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/插入图片\nvar imgSrc=\x27\x27;\naInsertBtn[0].onclick=function(){\n    var txt=document.getElementById(\x27txtImg\x27);\n    \/\/如果同时存在本地上传图片和网络图片的地址，只插入网络图片\n    console.log(txt.value)\n    if(txt.value){\n        imgSrc=txt.value;\n        txt.value=\x26quot; \x26quot;;\n    }\n    addImg(imgSrc);\n    insertImg.style.display=\x26quot;none\x26quot;;\n}\nfunction fileChange(){\n    var val=this.value.toLowerCase().split(\x27.\x27);\n    if(val){\n        if(val[1]==\x27gif\x27||val[1]==\x27png\x27||val[1]==\x27jpg\x27||val[1]==\x27jpeg\x27){\n            var reader = new FileReader();\n                reader.onload = function (e) {\n                imgSrc = e.target.result;                \n            }\n            reader.readAsDataURL(this.files[0]);\n        }else{\n            alert(\x26quot;目前支持gif,png,jpg,jpeg格式的图片!\x26quot;)\n        }\n    }\n}\nfunction addImg(src){\n    var newImg=new Image();\n    newImg.className=\x26quot;insertNewImg\x26quot;;\n    newImg.src=src;\n    insert(newImg);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/插入图片\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e imgSrc=\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\naInsertBtn[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].onclick=\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(){\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e txt=document.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27txtImg\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果同时存在本地上传图片和网络图片的地址，只插入网络图片\x3c\/span\x3e\n    console.log(txt.value)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(txt.value){\n        imgSrc=txt.value;\n        txt.value=\x3cspan class=\x22hljs-string\x22\x3e\x22 \x22\x3c\/span\x3e;\n    }\n    addImg(imgSrc);\n    insertImg.style.display=\x3cspan class=\x22hljs-string\x22\x3e\x22none\x22\x3c\/span\x3e;\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efileChange\x3c\/span\x3e\x3c\/span\x3e(){\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e val=\x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.value.toLowerCase().split(\x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(val){\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(val[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]==\x3cspan class=\x22hljs-string\x22\x3e\x27gif\x27\x3c\/span\x3e||val[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]==\x3cspan class=\x22hljs-string\x22\x3e\x27png\x27\x3c\/span\x3e||val[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]==\x3cspan class=\x22hljs-string\x22\x3e\x27jpg\x27\x3c\/span\x3e||val[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]==\x3cspan class=\x22hljs-string\x22\x3e\x27jpeg\x27\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e reader = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eFileReader\x3c\/span\x3e();\n                reader.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3c\/span\x3e(e) {\n                imgSrc = e.target.result;                \n            }\n            reader.readAsDataURL(\x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]);\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            alert(\x3cspan class=\x22hljs-string\x22\x3e\x22目前支持gif,png,jpg,jpeg格式的图片!\x22\x3c\/span\x3e)\n        }\n    }\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eaddImg\x3c\/span\x3e\x3c\/span\x3e(src){\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e=\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eImage\x3c\/span\x3e();\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e.className=\x3cspan class=\x22hljs-string\x22\x3e\x22insertNewImg\x22\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e.src=src;\n    insert(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eImg\x3c\/span\x3e);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里需特别的说明一下，如果是插入的是本地图片，由于浏览器为了安全限制file.value并不是图片的真实地址，换句话说img.src=file.value是得不到图片的，所以这里我们需要借用FileReader对象来得到真实的图片地址，当然这里网络的图片地址肯定是可以直接用的，然后将的到的src地址传入addImg函数生成img节点以后插入当前光标指向的文本位置。\x3cbr\x3e所以添加文本样式也是一样的方法，无非就是在创建完文本节点以后给他添加style样式。\x3c\/p\x3e\n\x3cp\x3e所以根据这种方法，读者可以根据自己的需求添加更多的功能，比如：在编辑框里面插入一个可以点击的a标签或者添加一个代码块.....\x3c\/p\x3e\n\x3cp\x3e希望能读到此文章的读者，能在下方一起交流，更希望大佬提出错误，谢谢！！！\x3cbr\x3eGitHub地址：\x3ca href=\x22https:\/\/github.com\/LiChangyi\/edit\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3c\/a\x3e\x3ca href=\x22https:\/\/github.com\/LiChangyi\/edit\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/LiChangyi\/...\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>原生JS写一个功能强大的编辑器</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011634322">https://segmentfault.com/a/1190000011634322</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/qkwk8zpexyr/" target="_blank">https://alili.tech/archive/qkwk8zpexyr/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>