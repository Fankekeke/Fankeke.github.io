<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JS 异步(callback→Promise→async/await)"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JS 异步(callback→Promise→async/await) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/rbri4ga20wd/",
				"appid": "1613049289050283", 
				"title": "JS 异步(callback→Promise→async/await) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-14T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/mlw8afd1ep/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/bsp5yay2rb4/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2frbri4ga20wd%2f&text=JS%20%e5%bc%82%e6%ad%a5%28callback%e2%86%92Promise%e2%86%92async%2fawait%29"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2frbri4ga20wd%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2frbri4ga20wd%2f&text=JS%20%e5%bc%82%e6%ad%a5%28callback%e2%86%92Promise%e2%86%92async%2fawait%29"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2frbri4ga20wd%2f&title=JS%20%e5%bc%82%e6%ad%a5%28callback%e2%86%92Promise%e2%86%92async%2fawait%29"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2frbri4ga20wd%2f&is_video=false&description=JS%20%e5%bc%82%e6%ad%a5%28callback%e2%86%92Promise%e2%86%92async%2fawait%29"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JS%20%e5%bc%82%e6%ad%a5%28callback%e2%86%92Promise%e2%86%92async%2fawait%29&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2frbri4ga20wd%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2frbri4ga20wd%2f&title=JS%20%e5%bc%82%e6%ad%a5%28callback%e2%86%92Promise%e2%86%92async%2fawait%29"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frbri4ga20wd%2f&title=JS%20%e5%bc%82%e6%ad%a5%28callback%e2%86%92Promise%e2%86%92async%2fawait%29"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frbri4ga20wd%2f&title=JS%20%e5%bc%82%e6%ad%a5%28callback%e2%86%92Promise%e2%86%92async%2fawait%29"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frbri4ga20wd%2f&title=JS%20%e5%bc%82%e6%ad%a5%28callback%e2%86%92Promise%e2%86%92async%2fawait%29"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JS 异步(callback→Promise→async/await)</h1><div class="meta"><div class="postdate"><time datetime="2018-12-14" itemprop="datePublished">2018-12-14</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3eJS异步编程\x3c\/h2\x3e\n\x3cp\x3eJS三座大山：原型原型链、作用域闭包、同步异步。\x3cbr\x3e之前有写过自己对闭包的理解，今天来总结一下JS中的异步。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e思考（案例来自stackoverflow）：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function foo(){\n    var result;\n    $ajax({\n        url:\x27...\x27,\n        success:function(response){\n            result=response;\n            \/\/return response;\/\/tried this one as well\n        }\n    });\n    return result;\n}\nvar result=foo();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efoo\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result;\n    $ajax({\n        url:\x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e,\n        success:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(response)\x3c\/span\x3e\x3c\/span\x3e{\n            result=response;\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/return response;\/\/tried this one as well\x3c\/span\x3e\n        }\n    });\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result;\n}\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result=foo();\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e初学异步的时候，这里是很容易错的地方，你想要获取从服务器端返回的数据，结果却一直undefined。\x3cbr\x3e\x3cstrong\x3e分析：\x3c\/strong\x3e\x3cbr\x3eJavaScript是单线程语言，但是js中有很多任务耗时比较长，比如ajax请求，如果都按照顺序进行，往往会出现浏览器无响应的情况，所以就需要异步的形式。JS中所有的任务可以分为两种：同步任务和异步任务。\x3c\/p\x3e\n\x3cp\x3e同步任务：在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务；\x3c\/p\x3e\n\x3cp\x3e异步任务：不进入主线程，而进入任务队列中的任务，只有任务队列通知主线程，某个异步任务可以执行了，这个任务才会进入主线程执行。\x3c\/p\x3e\n\x3cp\x3e事件循环（Event Loop）：只有执行栈中的所有同步任务都执行完毕，系统才会读取任务队列，看看里面的异步任务哪些可以执行，然后那些对应的异步任务，结束等待状态，进入执行栈，开始执行。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3e异步的解决方案：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e下面我们尝试将上面代码改正一下，几种方法如下：\x3cbr\x3e\x3cstrong\x3e1.callback\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function foo(callback){\/\/定义函数的时候将另一个函数（回调函数）作为参数传入定义的函数中。\n    $ajax({\n        \/\/...\n        success:callback\/\/异步操作执行完毕后，再执行该回调函数，确保回调在异步操作之后执行。\n    });\n}\nfunction myCallback(result){\n    \/\/...\n}\nfoo(myCallback);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efoo\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(callback)\x3c\/span\x3e\x3c\/span\x3e{\x3cspan class=\x22hljs-comment\x22\x3e\/\/定义函数的时候将另一个函数（回调函数）作为参数传入定义的函数中。\x3c\/span\x3e\n    $ajax({\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n        success:callback\x3cspan class=\x22hljs-comment\x22\x3e\/\/异步操作执行完毕后，再执行该回调函数，确保回调在异步操作之后执行。\x3c\/span\x3e\n    });\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emyCallback\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(result)\x3c\/span\x3e\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n}\nfoo(myCallback);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e回调函数本身是我们约定俗成的一种叫法，我们定义它，但是并不会自己去执行它，它最终被其他人执行了。\x3c\/p\x3e\n\x3cp\x3e优点：比较容易理解；\x3cbr\x3e缺点：1.高耦合，维护困难，回调地狱;2.每个任务只能指定一个回调函数;3.如果几个异步操作之间并没有顺序之分，同样也要等待上一个操作执行结束再进行下一个操作。下图回调地狱（图片来自于新浪微博(@ruanyf)）：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3hhv?w=480\x26amp;h=386\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3hhv?w=480\x26amp;h=386\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e2.Promise\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function ajax(url){\n    return new Promise(function(resolve,reject){\n        var xhr=new XMLHttpRequest();\n        xhr.onload=function(){\n            resolve(this.responseText);\n        };\n        xhr.onerror=reject;\n        xhr.open(\x27GET\x27,url);\n        xhr.send();\n    });\n}\najax(\x27\/echo\/json\x27)\n    .then(function(result){...})\n    .then(function(){...})\n    .catch(function(){...});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode\x3efunction ajax(url){\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e new \x3cspan class=\x22hljs-type\x22\x3ePromise\x3c\/span\x3e(function(resolve,reject){\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e xhr=new \x3cspan class=\x22hljs-type\x22\x3eXMLHttpRequest\x3c\/span\x3e();\n        xhr.onload=function(){\n            resolve(this.responseText);\n        };\n        xhr.onerror=reject;\n        xhr.open(\x27\x3cspan class=\x22hljs-type\x22\x3eGET\x3c\/span\x3e\x27,url);\n        xhr.send();\n    });\n}\najax(\x27\/echo\/json\x27)\n    .then(function(\x3cspan class=\x22hljs-literal\x22\x3eresult\x3c\/span\x3e)\x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e)\n    .then(function()\x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e)\n    .catch(function()\x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eES6给我们提供了一个原生的构造函数Promise，Promise代表了一个异步操作，可以将异步对象和回调函数脱离开来，通过.then方法在这个异步操作上绑定回调函数，Promise可以让我们通过链式调用的方法去解决回调嵌套的问题，而且由于promise.all这样的方法存在，可以让同时执行多个操作变得简单。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3epromise对象存在三种状态：\x3c\/strong\x3e\x3cbr\x3e1)Fulfilled:成功状态\x3cbr\x3e2)Rejected：失败状态\x3cbr\x3e3)Pending：既不是成功也不是失败状态，可以理解为进行中状态\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3epromise对象的两个重要方法：resolve\/reject\x3c\/strong\x3e\x3cbr\x3e1）resolve方法可以使Promise对象的状态改变为成功，同时传递一个参数用于后续成功后的操作。\x3cbr\x3e2）reject方法可以将Promise对象的状态改变为失败，同时将错误信息传递到后续错误处理的操作。\x3c\/p\x3e\n\x3cp\x3e.then可以使用链式调用，原因在于：每一次执行该方法时总会返回一个Promise对象。\x3cbr\x3e另外，在then的函数当中的返回值，可以作为后续操作的参数（例如：.then(return a).then(console.log(a\x2bb))）\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3hSC?w=480\x26amp;h=386\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3hSC?w=480\x26amp;h=386\x22 alt=\x22537f5932gy1fewdufq1twj20dc0aqglz.jpg\x22 title=\x22537f5932gy1fewdufq1twj20dc0aqglz.jpg\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e那么问题来了，如果上面代码异步操作抛出错误，会怎么样？会调用catch方法指定的回调函数，处理这个错误，而且then方法指定的回调函数，如果运行中抛出错误，也会被catch捕获。Promise对象的错误具有“冒泡”性质，会一直向后传递，直到被捕获为止，也就是说，错误总是会被下一个catch语句捕获。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e理解Promise用法的关键点：\x3c\/strong\x3e\x3cbr\x3e1.then方法是Promise实例的方法，即Promise.prototype上的，它的作用是为Promise实例添加状态改变时的回调函数，这个方法的第一个参数是resolved状态的回调函数，第二个参数（可选）是rejected状态的回调函数。\x3cbr\x3e2.链式中的第二个then开始，它们的resolve中的参数，是前一个then中resolve的return语句的返回值。\x3cbr\x3e3.关于执行顺序：Promise在实例化的时候就会执行，也就是如果Promise的实例化语句中函数console.log输出语句，它会比then中的先执行。Promise.all中传入的Promise对象的数组（假设为p1、p2），即使p2的运行速度比p1快，Promise.all方法仍然会按照数组中的顺序将结果返回。\x3cbr\x3e理解了上面这些方便写原生的Promise，利用观察者模式。后面补充。\x3c\/p\x3e\n\x3cp\x3ePromise的缺点：\x3cbr\x3e1.当处于未完成状态时，无法确定目前处于哪一阶段。\x3cbr\x3e2.如果不设置回调函数，Promise内部的错误不会反映到外部。\x3cbr\x3e3.无法取消Promise，一旦新建它就会立即执行，无法中途取消。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e3.async\/await:\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e很多人说async\/await是异步编程的终极解决方案、\x3cbr\x3eJavaScript 的 async\/await 实现，离不开 Promise。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var superagent=require(\x27superagent\x27)\nfunction delay(){\n    return new Promise(function(resolve,reject){\n        setTimeout({\n            resolve(42);\n        },3000);\n    })\n}\nasync function getAllBooks(){\n    var bookIDs=await superagent.get(\x27\/user\/books\x27);\n    await delay(1000);\n    return await superagent.get(\x27\/books\/ids=\x27JSON.stringify(bookIDs))；\n}\ngetAllBooks()\n    .then(function(){});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e superagent=\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27superagent\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edelay\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve,reject\x3c\/span\x3e)\x3c\/span\x3e{\n        setTimeout({\n            resolve(\x3cspan class=\x22hljs-number\x22\x3e42\x3c\/span\x3e);\n        },\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e);\n    })\n}\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetAllBooks\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e bookIDs=\x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e superagent.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/user\/books\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e delay(\x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e superagent.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/books\/ids=\x27\x3c\/span\x3e\x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(bookIDs))；\n}\ngetAllBooks()\n    .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的 delay() 没有申明为 async。实际上，delay() 本身就是返回的 Promise 对象，加不加 async 结果都一样。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e只要在函数名之前加上async关键字，就表明这个函数内部有异步操作。这个异步操作返回一个Promise对象，前面用await关键字注明。函数执行的时候，一旦遇到await，就会先执行await后面的表达式中的内容（异步），不再执行函数体后面的语句。等到异步操作执行完毕后，再自动返回到函数体内，继续执行函数体后面的语句。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3ikh?w=480\x26amp;h=386\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3ikh?w=480\x26amp;h=386\x22 alt=\x22537f5932gy1fewduf8jlhj20dc0aq74s.jpg\x22 title=\x22537f5932gy1fewduf8jlhj20dc0aq74s.jpg\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e下面这段来自：\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000011813934\x22\x3ehttps:\/\/segmentfault.com\/a\/11...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3easync：定义异步函数\x3c\/strong\x3e\x3cbr\x3e1）自动把函数转换为Promise\x3cbr\x3e2）当调用异步函数时，函数返回值会被resolve处理\x3cbr\x3e3）异步函数内部可以使用await\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eawait:暂停异步函数的执行\x3c\/strong\x3e\x3cbr\x3e1）当使用在Promise前面时，await等待Promise完成，并返回Promise的结果\x3cbr\x3e2）await只能和Promise一起使用，不能和callback一起使用\x3cbr\x3e3）await只能用在async函数中\x3c\/p\x3e\n\x3cp\x3easync\/await并不会取代promise，因为async\/await底层依然使用promise。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22async function getABC(){\n    let A = await getValueA(); \/\/ getValueA 花费 2 秒\n    let B = await getValueB(); \/\/ getValueA 花费 4 秒\n    let C = await getValueC(); \/\/ getValueA 花费 3 秒\n    return A*B*C\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetABC\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e A = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getValueA(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ getValueA 花费 2 秒\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e B = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getValueB(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ getValueA 花费 4 秒\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e C = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getValueC(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ getValueA 花费 3 秒\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e A*B*C\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e每次遇到\x26nbsp;await\x26nbsp;关键字时，Promise 都会停下在，一直到运行结束，所以总共花费是 2\x2b4\x2b3 = 9 秒。await\x26nbsp;把异步变成了同步。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22async function getABC() {\n    \/\/ Promise.all() 允许同时执行所有的异步函数\n    let results = await Promise.all([ getValueA, getValueB, getValueC ]); \n    return results.reduce((total,value) =\x3e total * value);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetABC\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Promise.all() 允许同时执行所有的异步函数\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e results = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all([ getValueA, getValueB, getValueC ]); \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e results.reduce(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3etotal,value\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e total * value);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e函数总耗时为 4 秒（getValueB\x26nbsp;的耗时）。\x3c\/p\x3e\n\x3cp\x3eAsync 的价值在于用写同步的方式写异步，1避免了阻塞，2必免写回调\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3easync\/await详细了解，推荐：\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000007535316\x22 target=\x22_blank\x22\x3ehttps:\/\/segmentfault.com\/a\/11...\x3c\/a\x3e\x3c\/strong\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JS 异步(callback→Promise→async/await)</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013141641">https://segmentfault.com/a/1190000013141641</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/rbri4ga20wd/" target="_blank">https://alili.tech/archive/rbri4ga20wd/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>