<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React 开发实战（一）- Repeat 组件"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React 开发实战（一）- Repeat 组件 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/rfb0m52hhq/",
				"appid": "1613049289050283", 
				"title": "React 开发实战（一）- Repeat 组件 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-30T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/yufx9gcau8/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/qgepungcgb9/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2frfb0m52hhq%2f&text=React%20%e5%bc%80%e5%8f%91%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%80%ef%bc%89-%20Repeat%20%e7%bb%84%e4%bb%b6"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2frfb0m52hhq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2frfb0m52hhq%2f&text=React%20%e5%bc%80%e5%8f%91%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%80%ef%bc%89-%20Repeat%20%e7%bb%84%e4%bb%b6"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2frfb0m52hhq%2f&title=React%20%e5%bc%80%e5%8f%91%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%80%ef%bc%89-%20Repeat%20%e7%bb%84%e4%bb%b6"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2frfb0m52hhq%2f&is_video=false&description=React%20%e5%bc%80%e5%8f%91%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%80%ef%bc%89-%20Repeat%20%e7%bb%84%e4%bb%b6"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%20%e5%bc%80%e5%8f%91%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%80%ef%bc%89-%20Repeat%20%e7%bb%84%e4%bb%b6&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2frfb0m52hhq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2frfb0m52hhq%2f&title=React%20%e5%bc%80%e5%8f%91%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%80%ef%bc%89-%20Repeat%20%e7%bb%84%e4%bb%b6"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frfb0m52hhq%2f&title=React%20%e5%bc%80%e5%8f%91%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%80%ef%bc%89-%20Repeat%20%e7%bb%84%e4%bb%b6"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frfb0m52hhq%2f&title=React%20%e5%bc%80%e5%8f%91%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%80%ef%bc%89-%20Repeat%20%e7%bb%84%e4%bb%b6"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frfb0m52hhq%2f&title=React%20%e5%bc%80%e5%8f%91%e5%ae%9e%e6%88%98%ef%bc%88%e4%b8%80%ef%bc%89-%20Repeat%20%e7%bb%84%e4%bb%b6"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React 开发实战（一）- Repeat 组件</h1><div class="meta"><div class="postdate"><time datetime="2018-12-30" itemprop="datePublished">2018-12-30</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e最近在写一个面向 React 初学者的系列教程\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000011336838\x22\x3e玩转 React\x3c\/a\x3e，内容对有 React 开发经验的同学来说可能太过于基础和啰嗦，不太感兴趣。所以我打算同时开始另外一个系列文章《React 开发实战》。该系列主要面向有 React 开发经验的同学，更侧重 React 实战，每一篇文章会跟大家一起开发一个 React 组件或者一个简单有趣的 React 应用，这些组件或者应用往往满足如下特点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e在我的实际项目中用到过的。\x3c\/li\x3e\n\x3cli\x3e在常见的开源组件库中没有的。\x3c\/li\x3e\n\x3cli\x3e有点小众，但是在特定的业务场景下能很大地提高项目的开发效率。\x3c\/li\x3e\n\x3cli\x3e可能还比较有趣。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e如果这些组件能直接应用到大家的实际开发中去，那再好不过了；如果不能，能给大家一点启发，我觉得这件事情也是很有价值的。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e另外，每一篇文章后面都会附有本篇文章的完整示例和代码。\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e问题描述\x3c\/h2\x3e\n\x3cp\x3e大家应该都见过这种应用场景，页面上的某一部分，需要能够让用户添加任意多项。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e可能是表单中的一个字段，如下所示。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVV3WK?w=299\x26amp;h=185\x22 src=\x22https:\/\/static.alili.tech\/img\/bVV3WK?w=299\x26amp;h=185\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e也可能是表单的一部分，如下所示，用户可以在一个表单内增加多个用户信息，然后将用户信息批量进行保存。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVV3WR?w=290\x26amp;h=279\x22 src=\x22https:\/\/static.alili.tech\/img\/bVV3WR?w=290\x26amp;h=279\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e还有更变态的，如下所示，一个表单内用户信息部分可以添加多份，每一个用户信息中地址也可以添加多份。（Oh, My God. PM，你杀了我吧。）\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVV3WY?w=290\x26amp;h=422\x22 src=\x22https:\/\/static.alili.tech\/img\/bVV3WY?w=290\x26amp;h=422\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e还好，React 应付这种需求，还是小菜一碟。但是在一个 web 应用中有这么多的相似场景的话，如果我们挨个实现一遍，那真是太枯燥了，与搬砖无异。遇到这种情况，就需要我们把相同的功能抽象出来，做成组件，这将极大地提升你的开发效率。\x3c\/p\x3e\n\x3cp\x3e基于这个场景，我们今天就开发一个能让其 children 重复任意多份的组件，我们就称之为 Repeat 吧。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e你期望 Repeat 组件该怎么用\x3c\/h2\x3e\n\x3cp\x3e在开发一个组件的时候，不要着急写代码，先想想你要把这个组件做成什么样子，例如这个 Repeat 组件，我希望有如下特性：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eRepeat 组件提供默认的，添加、移除按钮。\x3c\/li\x3e\n\x3cli\x3e点击添加，将 React 的 children 复制一份，点击移除将某一项移除。\x3c\/li\x3e\n\x3cli\x3e当只有一项时不能移除。\x3c\/li\x3e\n\x3cli\x3eRepeat 支持 onChange 回调函数，当 Repeat 内的表单输入发生变化时可以即时通知其父组件。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e然后在代码中我期望可以这样来用 Repeat 这个组件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class App extends React.Component {\n    handleChange(items) {\n        console.info(items);\n    }\n    render() {\n        \x3cRepeat onChange={items =\x3e this.handleChange(items)}\x3e\n            \x3cinput  type=\x26quot;text\x26quot; \/\x3e\n        \x3c\/Repeat\x3e\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    handleChange(items) {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.info(items);\n    }\n    render() {\n        \x26lt;Repeat onChange={items =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleChange(items)}\x26gt;\n            \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e  \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eRepeat\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eOK，就是这么简单，这样 Input 组件就可以重复加添多份了。基于这个构想，我们来实现 Repeat 这个组件。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e开始实现 Repeat 组件\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class Repeat extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            items: [\x27\x27],\n        };\n    }\n    handleChange(e, index) {\n        const items = [...this.state.items];\n        items[index] = e.target.value;\n        this.setState({ items });\n        this.props.onChange(items);\n    }\n    handleAddItem(e, index) {\n        e.preventDefault();\n        const items = [...this.state.items];\n        items.splice(index, 0, \x27\x27);\n        this.setState({ items });\n    }\n    handleRemoveItem(e, index) {\n        e.preventDefault();\n        if (this.state.items.length === 1) return;\n        const items = [...this.state.items];\n        items.splice(index, 1);\n        this.setState({ items });\n    }\n    render() {\n        const children = React.Children.only(this.props.children);\n        const elementItems = this.state.items.map((item, index) =\x3e (\n            \x3cdiv key={index}\x3e\n                {\n                    React.cloneElement(children, {\n                        onChange: e =\x3e this.handleChange(e, index),\n                        value: item,\n                    })\n                }\n                \x3cdiv\x3e\n                    \x3ca href=\x26quot;#\x26quot; onClick={e =\x3e this.handleAddItem(e, index)}\x3e添加\x3c\/a\x3e\n                    \x3ca href=\x26quot;#\x26quot; onClick={e =\x3e this.handleRemoveItem(e, index)}\x3e移除\x3c\/a\x3e\n                \x3c\/div\x3e\n            \x3c\/div\x3e\n        ));\n        return \x3cdiv\x3e{elementItems}\x3c\/div\x3e;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eRepeat\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(props) {\n        \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = {\n            \x3cspan class=\x22hljs-attr\x22\x3eitems\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e],\n        };\n    }\n    handleChange(e, index) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e items = [...this.state.items];\n        items[index] = e.target.value;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ items });\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.onChange(items);\n    }\n    handleAddItem(e, index) {\n        e.preventDefault();\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e items = [...this.state.items];\n        items.splice(index, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ items });\n    }\n    handleRemoveItem(e, index) {\n        e.preventDefault();\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.items.length === \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e items = [...this.state.items];\n        items.splice(index, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ items });\n    }\n    render() {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e children = React.Children.only(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.children);\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e elementItems = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.items.map(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem, index\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e (\n            \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{index}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n                {\n                    React.cloneElement(children, {\n                        onChange: e =\x26gt; this.handleChange(e, index),\n                        value: item,\n                    })\n                }\n                \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22#\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{e\x3c\/span\x3e =\x26gt;\x3c\/span\x3e this.handleAddItem(e, index)}\x26gt;添加\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22#\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{e\x3c\/span\x3e =\x26gt;\x3c\/span\x3e this.handleRemoveItem(e, index)}\x26gt;移除\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n                \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n        ));\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e{elementItems}\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e;\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e代码很简单，简单解释一下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e组件的 \x3ccode\x3estate\x3c\/code\x3e 中持有 \x3ccode\x3eitems\x3c\/code\x3e 字段来保存每一个项的数据。\x3c\/li\x3e\n\x3cli\x3erender 时先获取到唯一的 \x3ccode\x3echildren\x3c\/code\x3e，然后 map 组件 \x3ccode\x3estate\x3c\/code\x3e 中的 \x3ccode\x3eitems\x3c\/code\x3e，将每一项映射为 \x3ccode\x3echildren\x3c\/code\x3e 的一个副本。并为这个副本传入两个属性，\x3ccode\x3eonChange\x3c\/code\x3e 接收每一项的数据变化，\x3ccode\x3evalue\x3c\/code\x3e 传递每一项当前应展示的值。\x3c\/li\x3e\n\x3cli\x3e另外 \x3ccode\x3eRepeat\x3c\/code\x3e 为每一项准备了一个“添加”按钮和一个“移除”按钮，用来在当前项位置新增一项或者移除当前项。原理就是将 \x3ccode\x3ethis.state.items\x3c\/code\x3e 中对应下标处的数组元素删掉就好了。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e到此，\x3ccode\x3eRepeat\x3c\/code\x3e 是不是大致有模有样了呢。需要提醒大家的是，\x3ccode\x3eReact.cloneElement\x3c\/code\x3e 和 \x3ccode\x3eReact.Children.xxx\x3c\/code\x3e 这些 api 通常只会在这种公共组件中使用，在大部分场景，尽量少用。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e跟 children 有个约定\x3c\/h2\x3e\n\x3cp\x3e有些同学可能已经发现了，上面例子中， \x3ccode\x3eRepeat\x3c\/code\x3e 的 \x3ccode\x3echildren\x3c\/code\x3e 是个 \x3ccode\x3einput\x3c\/code\x3e，那如果是一个其他的组件不就完蛋了嘛。\x3c\/p\x3e\n\x3cp\x3e这是第一个问题，为了解决这个问题呢，Repeat 需要对它的 \x3ccode\x3echildren\x3c\/code\x3e 提两个条件：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3cp\x3e属性上必须要接收一个 \x3ccode\x3eonChange\x3c\/code\x3e 回调函数，函数接收一个对象参数，参数结构如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    target: {\n        value: \x27xxxx\x27\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3etarget\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27xxxx\x27\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3evalue\x3c\/code\x3e 的值为当前项产出的数据，可能是个对象也可能是字符串或者数值。没错，我就是为了兼容 input event 的数据结构。你当然可以用任何你喜欢的且方便处理的数据结构。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3echildren\x3c\/code\x3e 组件需要接收一个 value 属性，以展示其拥有的值。也就是说 \x3ccode\x3echildren\x3c\/code\x3e 组件应当是一个受控的（controlled）组件。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e这就是一个协议，你希望某个组件内通过 \x3ccode\x3eRepeat\x3c\/code\x3e 组件方便地添加多份并能获取到一组数据，那就必须要遵守这个协议。有同学可能会说为什么不搞的智能一点呢？嗯，这里我想分享一点个人经验：有些时候，尤其是在业务开发过程中，把公共部分抽取出来复用即可，点到为止，没有必要搞得那么“强大”，剩下的事情让一个很容易遵守的协议来完成，其实效率会更高，更容易让人理解。\x3c\/p\x3e\n\x3cp\x3e其实在计算机的世界中处处充满了协议，例如你想让 HTTP Server 返回正确的响应，你必须要遵循 http 协议来和它通信；你生产的显卡能买的出去，必须要遵守相应的协议，要能插到别人家生产的主板上。\x3c\/p\x3e\n\x3cp\x3e扯远了！收！\x3c\/p\x3e\n\x3cp\x3e对，有了上面这个约定以后，\x3ccode\x3eRepeat\x3c\/code\x3e 一行代码未加，是不是感觉功能完善了许多？嗯，就是这个目的。现在我们来实现一下文章开始时候说的第二个场景。\x3c\/p\x3e\n\x3cp\x3e聪明的你一定已经知道该怎么做了，没错，只要我们实现一个 \x3ccode\x3eUserForm\x3c\/code\x3e 组件，并让他满足上面的约定即可。请看代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class UserForm extends React.Component {\n    handleFieldChange(e) {\n        const { name, value } = e.target;\n        const formData = {\n            ...this.props.value, \n            [name]: value,\n        }\n        this.props.onChange({\n            target: {\n                value: formData,\n            }\n        });\n    }\n    render() {\n        const formData = this.props.value || {};\n        return (\n            \x3cdiv\x3e\n                \x3cdiv\x3e\n                    \x3clabel for=\x26quot;\x26quot;\x3e姓名\x3c\/label\x3e\n                    \x3cinput\n                        type=\x26quot;text\x26quot;\n                        name=\x26quot;name\x26quot;\n                        value={formData.name}\n                        onChange={e =\x3e this.handleFieldChange(e)}\n                    \/\x3e\n                \x3c\/div\x3e\n                \x3cdiv\x3e\n                    \x3clabel for=\x26quot;\x26quot;\x3e地址\x3c\/label\x3e\n                    \x3cinput\n                        type=\x26quot;text\x26quot;\n                        name=\x26quot;addr\x26quot;\n                        value={formData.addr}\n                        onChange={e =\x3e this.handleFieldChange(e)}\n                    \/\x3e\n                \x3c\/div\x3e\n            \x3c\/div\x3e\n        )\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eUserForm\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    handleFieldChange(e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { name, value } = e.target;\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e formData = {\n            ...this.props.value, \n            [name]: value,\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.onChange({\n            \x3cspan class=\x22hljs-attr\x22\x3etarget\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e: formData,\n            }\n        });\n    }\n    render() {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e formData = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.value || {};\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n            \x26lt;div\x26gt;\n                \x26lt;div\x26gt;\n                    \x26lt;label for=\x22\x22\x26gt;姓名\x26lt;\/label\x26gt;\n                    \x26lt;input\n                        type=\x22text\x22\n                        name=\x22name\x22\n                        value={formData.name}\n                        onChange={e =\x26gt; this.handleFieldChange(e)}\n                    \/\x26gt;\n                \x26lt;\/div\x26gt;\n                \x26lt;div\x26gt;\n                    \x26lt;label for=\x22\x22\x26gt;地址\x26lt;\/label\x26gt;\n                    \x26lt;input\n                        type=\x22text\x22\n                        name=\x22addr\x22\n                        value={formData.addr}\n                        onChange={e =\x26gt; this.handleFieldChange(e)}\n                    \/\x26gt;\n                \x26lt;\/div\x26gt;\n            \x26lt;\/div\x26gt;\n        )\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了让代码更简洁，我把 \x3ccode\x3eUserForm\x3c\/code\x3e 这个组件实现为了一个支持受控的组件，但是在目前的业务场景下已经足够了，在实际情况下，你可以按需调整。\x3c\/p\x3e\n\x3cp\x3e通过这个例子，还希望大家能体会到组件拆分的一个好处。就是，\x3ccode\x3eUserForm\x3c\/code\x3e 和 \x3ccode\x3eRepeat\x3c\/code\x3e 拆分成两个组件以后，\x3ccode\x3eUserForm\x3c\/code\x3e 的复用性会更强。可以想象一下，当用户被批量添加以后，是不是有可能在编辑单个用户的时候，可以继续使用这个组件。\x3c\/p\x3e\n\x3cp\x3e好啦，关于第三个场景我想就没有必要再实现一遍了，Repeat 嵌套多少层其实都是可以的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e更进一步\x3c\/h2\x3e\n\x3cp\x3e实际上在实际应用中，Repeat 这个组件还需要做进一步完善，其中一个就是样式，还有可能在不同的场景下，虽然交互都是这样，但样式会有所差异。另外默认是“添加”、“移除”两个文字按钮，说不定实际业务场景中是两个 \x2b,- 的图标按钮；还有可能“添加”、“移除”的位置为有所变化。\x3c\/p\x3e\n\x3cp\x3e这些问题怎么处理呢？下面给大家描述下思路，具体代码就不写了，如果有什么疑问可以给我留言。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e关于样式，你可以给 \x3ccode\x3eRepeat\x3c\/code\x3e 添加 \x3ccode\x3eitemClassName\x3c\/code\x3e 和 \x3ccode\x3ebuttonsClassName\x3c\/code\x3e 两个属性分别为每一项和按钮区域的 css class。这样你就可以在不同的场景下指定不同的样式了。\x3c\/li\x3e\n\x3cli\x3e关于如何将文字按钮改为图标按钮，你可以给 \x3ccode\x3eRepeat\x3c\/code\x3e 添加 \x3ccode\x3erenderButtons\x3c\/code\x3e 这样一个函数属性，如果未指定则用默认的方式渲染按钮，如果有则勇气返回值渲染属性。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e最后\x3c\/h2\x3e\n\x3cp\x3e这是本篇文章的代码：\x3ca href=\x22https:\/\/codepen.io\/Sarike\/pen\/gGRamP\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/codepen.io\/Sarike\/pen...\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22Sarike\/pen\/gGRamP\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3c\/p\x3e\n\x3cp\x3e好啦，文章就到这吧，如果有什么疑问可以给我留言。谢谢大家，祝大家国庆、中秋节快乐。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React 开发实战（一）- Repeat 组件</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011415955">https://segmentfault.com/a/1190000011415955</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/rfb0m52hhq/" target="_blank">https://alili.tech/archive/rfb0m52hhq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>