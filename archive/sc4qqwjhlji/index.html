<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="express 中间件机制及实现原理"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>express 中间件机制及实现原理 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/sc4qqwjhlji/",
				"appid": "1613049289050283", 
				"title": "express 中间件机制及实现原理 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-02T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/s94wuu48mk/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/u2ol9eld6u/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fsc4qqwjhlji%2f&text=express%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%9c%ba%e5%88%b6%e5%8f%8a%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fsc4qqwjhlji%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fsc4qqwjhlji%2f&text=express%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%9c%ba%e5%88%b6%e5%8f%8a%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fsc4qqwjhlji%2f&title=express%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%9c%ba%e5%88%b6%e5%8f%8a%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fsc4qqwjhlji%2f&is_video=false&description=express%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%9c%ba%e5%88%b6%e5%8f%8a%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=express%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%9c%ba%e5%88%b6%e5%8f%8a%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fsc4qqwjhlji%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fsc4qqwjhlji%2f&title=express%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%9c%ba%e5%88%b6%e5%8f%8a%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsc4qqwjhlji%2f&title=express%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%9c%ba%e5%88%b6%e5%8f%8a%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsc4qqwjhlji%2f&title=express%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%9c%ba%e5%88%b6%e5%8f%8a%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsc4qqwjhlji%2f&title=express%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%9c%ba%e5%88%b6%e5%8f%8a%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">express 中间件机制及实现原理</h1><div class="meta"><div class="postdate"><time datetime="2019-01-02" itemprop="datePublished">2019-01-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e简介\x3c\/h2\x3e\n\x3cp\x3e中间件机制可以让我们在一个给定的流程中添加一个处理步骤，从而对这个流程的输入或者输出产生影响，或者产生一些中作用、状态，或者拦截这个流程。中间件机制和\x3ccode\x3etomcat\x3c\/code\x3e的过滤器类似，这两者都属于责任链模式的具体实现。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eexpress 中间件使用案例\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let express = require(\x27express\x27)\nlet app = express()\n\/\/解析request 的body\napp.use(bodyParser.json())\n\/\/解析 cookie\napp.use(cookieParser())\n\/\/拦截\napp.get(\x27\/hello\x27, function (req, res) {\n  res.send(\x27Hello World!\x27);\n});\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs zephir\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e express = \x3cspan class=\x22hljs-keyword\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e app = express()\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/解析request 的body\x3c\/span\x3e\napp.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(bodyParser.json())\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/解析 cookie\x3c\/span\x3e\napp.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(cookieParser())\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/拦截\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/hello\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(req, res)\x3c\/span\x3e \x3c\/span\x3e{\n  res.send(\x3cspan class=\x22hljs-string\x22\x3e\x27Hello World!\x27\x3c\/span\x3e);\n});\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e模拟中间件机制并且模拟实现解析\x3ccode\x3erequest\x3c\/code\x3e的中间件\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e首先模拟一个\x3ccode\x3erequest\x3c\/code\x3e\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22request = { \/\/模拟的request\n    requestLine: \x27POST \/iven_ HTTP\/1.1\x27,\n    headers: \x27Host:www.baidu.com\\r\\nCookie:BAIDUID=E063E9B2690116090FE24E01ACDDF4AD:FG=1;BD_HOME=0\x27,\n    requestBody: \x27key1=value1\x26amp;key2=value2\x26amp;key3=value3\x27,\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3erequest = { \x3cspan class=\x22hljs-comment\x22\x3e\/\/模拟的request\x3c\/span\x3e\n    requestLine: \x3cspan class=\x22hljs-string\x22\x3e\x27POST \/iven_ HTTP\/1.1\x27\x3c\/span\x3e,\n    headers: \x3cspan class=\x22hljs-string\x22\x3e\x27Host:www.baidu.com\\r\\nCookie:BAIDUID=E063E9B2690116090FE24E01ACDDF4AD:FG=1;BD_HOME=0\x27\x3c\/span\x3e,\n    requestBody: \x3cspan class=\x22hljs-string\x22\x3e\x27key1=value1\x26amp;key2=value2\x26amp;key3=value3\x27\x3c\/span\x3e,\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e一个\x3ccode\x3ehttp\x3c\/code\x3e请求分为请求行、请求头、和请求体，这三者之间通过\x3ccode\x3e\\r\\n\\r\\n\x3c\/code\x3e即一个空行来分割，这里假设已经将这三者分开，\x3ccode\x3erequestLine\x3c\/code\x3e（请求行）中有方法类型，请求\x3ccode\x3eurl\x3c\/code\x3e，\x3ccode\x3ehttp\x3c\/code\x3e版本号，这三者通过空格来区分，\x3ccode\x3eheaders\x3c\/code\x3e（请求头）中的各部分通过\x3ccode\x3e\\r\\n\x3c\/code\x3e来分割，\x3ccode\x3erequestBody\x3c\/code\x3e（请求体）中通过 \x3ccode\x3e\x26amp;\x3c\/code\x3e 来区分参数\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e模拟中间件机制\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e约定 中间件一定是一个函数并且接受 request, response, next三个参数\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function App() {\n    if (!(this instanceof App))\n        return new App();\n    this.init();\n}\nApp.prototype = {\n    constructor: App,\n    init: function() {\n        this.request = { \/\/模拟的request\n            requestLine: \x27POST \/iven_ HTTP\/1.1\x27,\n            headers: \x27Host:www.baidu.com\\r\\nCookie:BAIDUID=E063E9B2690116090FE24E01ACDDF4AD:FG=1;BD_HOME=0\x27,\n            requestBody: \x27key1=value1\x26amp;key2=value2\x26amp;key3=value3\x27,\n        };\n        this.response = {}; \/\/模拟的response\n        this.chain = []; \/\/存放中间件的一个数组\n        this.index = 0; \/\/当前执行的中间件在chain中的位置\n    },\n    use: function(handle) { \/\/这里默认 handle 是函数，并且这里不做判断\n        this.chain.push(handle);\n    },\n    next: function() { \/\/当调用next时执行index所指向的中间件\n        if (this.index \x3e= this.chain.length)\n            return;\n        let middleware = this.chain[this.index];\n        this.index\x2b\x2b;\n        middleware(this.request, this.response, this.next.bind(this));\n    },\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3efunction App() {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e instanceof App))\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e new App();\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.init();\n}\nApp.prototype = {\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e: App,\n    init: function() {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.request = { \x3cspan class=\x22hljs-comment\x22\x3e\/\/模拟的request\x3c\/span\x3e\n            requestLine: \x3cspan class=\x22hljs-string\x22\x3e\x27POST \/iven_ HTTP\/1.1\x27\x3c\/span\x3e,\n            headers: \x3cspan class=\x22hljs-string\x22\x3e\x27Host:www.baidu.com\\r\\nCookie:BAIDUID=E063E9B2690116090FE24E01ACDDF4AD:FG=1;BD_HOME=0\x27\x3c\/span\x3e,\n            requestBody: \x3cspan class=\x22hljs-string\x22\x3e\x27key1=value1\x26amp;key2=value2\x26amp;key3=value3\x27\x3c\/span\x3e,\n        };\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.response = {}; \x3cspan class=\x22hljs-comment\x22\x3e\/\/模拟的response\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chain = []; \x3cspan class=\x22hljs-comment\x22\x3e\/\/存放中间件的一个数组\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.index = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/当前执行的中间件在chain中的位置\x3c\/span\x3e\n    },\n    use: function(handle) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/这里默认 handle 是函数，并且这里不做判断\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chain.push(handle);\n    },\n    next: function() { \x3cspan class=\x22hljs-comment\x22\x3e\/\/当调用next时执行index所指向的中间件\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.index \x26gt;= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chain.length)\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        let middleware = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chain[\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.index];\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.index\x2b\x2b;\n        middleware(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.request, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.response, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.next.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e));\n    },\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e对 request 处理的中间件\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 function lineParser(req, res, next) {\n        let items = req.requestLine.split(\x27 \x27);\n        req.methond = items[0];\n        req.url = items[1];\n        req.version = items[2];\n        next(); \/\/执行下一个中间件\n    }\n\nfunction headersParser(req, res, next) {\n    let items = req.headers.split(\x27\\r\\n\x27);\n    let header = {}\n    for(let i in items) {\n        let item = items[i].split(\x27:\x27);\n        let key = item[0];\n        let value = item[1];\n        header[key] = value;\n    }\n    req.header = header;\n    next(); \/\/执行下一个中间件\n}\n\nfunction bodyParser(req, res, next) {\n    let bodyStr = req.requestBody;\n    let body = {};\n    let items = bodyStr.split(\x27\x26amp;\x27);\n    for(let i in items) {\n        let item = items[i].split(\x27=\x27);\n        let key = item[0];\n        let value = item[1];\n        body[key] = value;\n    }\n    req.body = body;\n    next(); \/\/执行下一个中间件\n}\n\nfunction middleware3(req, res, next) {\n    console.log(\x27url: \x27\x2breq.url);\n    console.log(\x27methond: \x27\x2breq.methond);\n    console.log(\x27version: \x27\x2breq.version);\n    console.log(req.body);\n    console.log(req.header);\n    next(); \/\/执行下一个中间件\n}\n\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3elineParser\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e items = req.requestLine.split(\x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e);\n        req.methond = items[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n        req.url = items[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n        req.version = items[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e];\n        next(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行下一个中间件\x3c\/span\x3e\n    }\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eheadersParser\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e items = req.headers.split(\x3cspan class=\x22hljs-string\x22\x3e\x27\\r\\n\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e header = {}\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e items) {\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e item = items[i].split(\x3cspan class=\x22hljs-string\x22\x3e\x27:\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key = item[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value = item[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n        header[key] = value;\n    }\n    req.header = header;\n    next(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行下一个中间件\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ebodyParser\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e bodyStr = req.requestBody;\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e body = {};\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e items = bodyStr.split(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e items) {\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e item = items[i].split(\x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key = item[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value = item[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n        body[key] = value;\n    }\n    req.body = body;\n    next(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行下一个中间件\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emiddleware3\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27url: \x27\x3c\/span\x3e\x2breq.url);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27methond: \x27\x3c\/span\x3e\x2breq.methond);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27version: \x27\x3c\/span\x3e\x2breq.version);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(req.body);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(req.header);\n    next(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行下一个中间件\x3c\/span\x3e\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e测试代码\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let app = App();\napp.use(lineParser);\napp.use(headersParser);\napp.use(bodyParser);\napp.use(middleware3);\napp.next();\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode\x3elet \x3cspan class=\x22hljs-keyword\x22\x3eapp\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eApp\x3c\/span\x3e();\n\x3cspan class=\x22hljs-keyword\x22\x3eapp\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(lineParser);\n\x3cspan class=\x22hljs-keyword\x22\x3eapp\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(headersParser);\n\x3cspan class=\x22hljs-keyword\x22\x3eapp\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(bodyParser);\n\x3cspan class=\x22hljs-keyword\x22\x3eapp\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(middleware3);\n\x3cspan class=\x22hljs-keyword\x22\x3eapp\x3c\/span\x3e.next();\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e整体代码\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function App() {\n    if (!(this instanceof App))\n        return new App();\n    this.init();\n}\nApp.prototype = {\n    constructor: App,\n    init: function() {\n        this.request = { \/\/模拟的request\n            requestLine: \x27POST \/iven_ HTTP\/1.1\x27,\n            headers: \x27Host:www.baidu.com\\r\\nCookie:BAIDUID=E063E9B2690116090FE24E01ACDDF4AD:FG=1;BD_HOME=0\x27,\n            requestBody: \x27key1=value1\x26amp;key2=value2\x26amp;key3=value3\x27,\n        };\n        this.response = {}; \/\/模拟的response\n        this.chain = []; \/\/存放中间件的一个数组\n        this.index = 0; \/\/当前执行的中间件在chain中的位置\n    },\n    use: function(handle) { \/\/这里默认 handle 是函数，并且这里不做判断\n        this.chain.push(handle);\n    },\n    next: function() { \/\/当调用next时执行index所指向的中间件\n        if (this.index \x3e= this.chain.length)\n            return;\n        let middleware = this.chain[this.index];\n        this.index\x2b\x2b;\n        middleware(this.request, this.response, this.next.bind(this));\n    },\n}\nfunction lineParser(req, res, next) {\n        let items = req.requestLine.split(\x27 \x27);\n        req.methond = items[0];\n        req.url = items[1];\n        req.version = items[2];\n        next(); \/\/执行下一个中间件\n    }\n\nfunction headersParser(req, res, next) {\n    let items = req.headers.split(\x27\\r\\n\x27);\n    let header = {}\n    for(let i in items) {\n        let item = items[i].split(\x27:\x27);\n        let key = item[0];\n        let value = item[1];\n        header[key] = value;\n    }\n    req.header = header;\n    next(); \/\/执行下一个中间件\n}\n\nfunction bodyParser(req, res, next) {\n    let bodyStr = req.requestBody;\n    let body = {};\n    let items = bodyStr.split(\x27\x26amp;\x27);\n    for(let i in items) {\n        let item = items[i].split(\x27=\x27);\n        let key = item[0];\n        let value = item[1];\n        body[key] = value;\n    }\n    req.body = body;\n    next(); \/\/执行下一个中间件\n}\n\nfunction middleware3(req, res, next) {\n    console.log(\x27url: \x27\x2breq.url);\n    console.log(\x27methond: \x27\x2breq.methond);\n    console.log(\x27version: \x27\x2breq.version);\n    console.log(req.body);\n    console.log(req.header);\n    next(); \/\/执行下一个中间件\n}\nlet app = App();\napp.use(lineParser);\napp.use(headersParser);\napp.use(bodyParser);\napp.use(middleware3);\napp.next();\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e App))\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e App();\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.init();\n}\nApp.prototype = {\n    \x3cspan class=\x22hljs-attr\x22\x3econstructor\x3c\/span\x3e: App,\n    \x3cspan class=\x22hljs-attr\x22\x3einit\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.request = { \x3cspan class=\x22hljs-comment\x22\x3e\/\/模拟的request\x3c\/span\x3e\n            requestLine: \x3cspan class=\x22hljs-string\x22\x3e\x27POST \/iven_ HTTP\/1.1\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Host:www.baidu.com\\r\\nCookie:BAIDUID=E063E9B2690116090FE24E01ACDDF4AD:FG=1;BD_HOME=0\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3erequestBody\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27key1=value1\x26amp;key2=value2\x26amp;key3=value3\x27\x3c\/span\x3e,\n        };\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.response = {}; \x3cspan class=\x22hljs-comment\x22\x3e\/\/模拟的response\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chain = []; \x3cspan class=\x22hljs-comment\x22\x3e\/\/存放中间件的一个数组\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.index = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/当前执行的中间件在chain中的位置\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3euse\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ehandle\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/这里默认 handle 是函数，并且这里不做判断\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chain.push(handle);\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3enext\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/当调用next时执行index所指向的中间件\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.index \x26gt;= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chain.length)\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e middleware = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.chain[\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.index];\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.index\x2b\x2b;\n        middleware(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.request, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.response, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.next.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e));\n    },\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3elineParser\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e items = req.requestLine.split(\x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e);\n        req.methond = items[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n        req.url = items[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n        req.version = items[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e];\n        next(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行下一个中间件\x3c\/span\x3e\n    }\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eheadersParser\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e items = req.headers.split(\x3cspan class=\x22hljs-string\x22\x3e\x27\\r\\n\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e header = {}\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e items) {\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e item = items[i].split(\x3cspan class=\x22hljs-string\x22\x3e\x27:\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key = item[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value = item[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n        header[key] = value;\n    }\n    req.header = header;\n    next(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行下一个中间件\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ebodyParser\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e bodyStr = req.requestBody;\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e body = {};\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e items = bodyStr.split(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e items) {\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e item = items[i].split(\x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key = item[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value = item[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n        body[key] = value;\n    }\n    req.body = body;\n    next(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行下一个中间件\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emiddleware3\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27url: \x27\x3c\/span\x3e\x2breq.url);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27methond: \x27\x3c\/span\x3e\x2breq.methond);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27version: \x27\x3c\/span\x3e\x2breq.version);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(req.body);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(req.header);\n    next(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行下一个中间件\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e app = App();\napp.use(lineParser);\napp.use(headersParser);\napp.use(bodyParser);\napp.use(middleware3);\napp.next();\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e运行结果\x3c\/h2\x3e\n\x3cp\x3e将以上整体代码运行后将打印以下信息\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22url: \/iven_\nmethond: POST\nversion: HTTP\/1.1\n{key1: \x26quot;value1\x26quot;, key2: \x26quot;value2\x26quot;, key3: \x26quot;value3\x26quot;}\n{Host: \x26quot;www.baidu.com\x26quot;, Cookie: \x26quot;BAIDUID=E063E9B2690116090FE24E01ACDDF4AD\x26quot;}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-string\x22\x3eurl:\x3c\/span\x3e \/iven_\n\x3cspan class=\x22hljs-string\x22\x3emethond:\x3c\/span\x3e POST\n\x3cspan class=\x22hljs-string\x22\x3eversion:\x3c\/span\x3e HTTP\/\x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e\n{\x3cspan class=\x22hljs-string\x22\x3ekey1:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22value1\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ekey2:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22value2\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ekey3:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22value3\x22\x3c\/span\x3e}\n{\x3cspan class=\x22hljs-string\x22\x3eHost:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22www.baidu.com\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eCookie:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22BAIDUID=E063E9B2690116090FE24E01ACDDF4AD\x22\x3c\/span\x3e}\x3c\/code\x3e\x3c\/pre\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>express 中间件机制及实现原理</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010877994">https://segmentfault.com/a/1190000010877994</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/sc4qqwjhlji/" target="_blank">https://alili.tech/archive/sc4qqwjhlji/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>