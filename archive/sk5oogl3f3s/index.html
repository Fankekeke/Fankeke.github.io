<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="腾讯IVWEB前端工程化工具feflow思考与实践"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>腾讯IVWEB前端工程化工具feflow思考与实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/sk5oogl3f3s/",
				"appid": "1613049289050283", 
				"title": "腾讯IVWEB前端工程化工具feflow思考与实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-13T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/2sj0ic1iisb/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/0iof83b7r1bf/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fsk5oogl3f3s%2f&text=%e8%85%be%e8%ae%afIVWEB%e5%89%8d%e7%ab%af%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%b7%a5%e5%85%b7feflow%e6%80%9d%e8%80%83%e4%b8%8e%e5%ae%9e%e8%b7%b5"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fsk5oogl3f3s%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fsk5oogl3f3s%2f&text=%e8%85%be%e8%ae%afIVWEB%e5%89%8d%e7%ab%af%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%b7%a5%e5%85%b7feflow%e6%80%9d%e8%80%83%e4%b8%8e%e5%ae%9e%e8%b7%b5"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fsk5oogl3f3s%2f&title=%e8%85%be%e8%ae%afIVWEB%e5%89%8d%e7%ab%af%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%b7%a5%e5%85%b7feflow%e6%80%9d%e8%80%83%e4%b8%8e%e5%ae%9e%e8%b7%b5"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fsk5oogl3f3s%2f&is_video=false&description=%e8%85%be%e8%ae%afIVWEB%e5%89%8d%e7%ab%af%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%b7%a5%e5%85%b7feflow%e6%80%9d%e8%80%83%e4%b8%8e%e5%ae%9e%e8%b7%b5"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e8%85%be%e8%ae%afIVWEB%e5%89%8d%e7%ab%af%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%b7%a5%e5%85%b7feflow%e6%80%9d%e8%80%83%e4%b8%8e%e5%ae%9e%e8%b7%b5&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fsk5oogl3f3s%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fsk5oogl3f3s%2f&title=%e8%85%be%e8%ae%afIVWEB%e5%89%8d%e7%ab%af%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%b7%a5%e5%85%b7feflow%e6%80%9d%e8%80%83%e4%b8%8e%e5%ae%9e%e8%b7%b5"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsk5oogl3f3s%2f&title=%e8%85%be%e8%ae%afIVWEB%e5%89%8d%e7%ab%af%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%b7%a5%e5%85%b7feflow%e6%80%9d%e8%80%83%e4%b8%8e%e5%ae%9e%e8%b7%b5"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsk5oogl3f3s%2f&title=%e8%85%be%e8%ae%afIVWEB%e5%89%8d%e7%ab%af%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%b7%a5%e5%85%b7feflow%e6%80%9d%e8%80%83%e4%b8%8e%e5%ae%9e%e8%b7%b5"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsk5oogl3f3s%2f&title=%e8%85%be%e8%ae%afIVWEB%e5%89%8d%e7%ab%af%e5%b7%a5%e7%a8%8b%e5%8c%96%e5%b7%a5%e5%85%b7feflow%e6%80%9d%e8%80%83%e4%b8%8e%e5%ae%9e%e8%b7%b5"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">腾讯IVWEB前端工程化工具feflow思考与实践</h1><div class="meta"><div class="postdate"><time datetime="2018-12-13" itemprop="datePublished">2018-12-13</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013362603?w=1200\x26amp;h=400\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013362603?w=1200\x26amp;h=400\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e本篇文章主要介绍\x3ca href=\x22https:\/\/ivweb.io\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e腾讯IVWEB团队\x3c\/a\x3e从0到1在工程化的思考和实践。\x3ca href=\x22https:\/\/github.com\/feflow\/feflow\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3efeflow\x3c\/a\x3e的全称是Front-end flow（前端工作流），致力于提升研发效率和规范的工程化解决方案。愿景是通过feflow，可以使项目创建、开发、构建、规范检查到最终项目上线的整个过程更加自动化和标准化。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e要解决的问题\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e项目的目录结构按约定生成\x3c\/li\x3e\n\x3cli\x3e团队有一套开发规范进行约束\x3c\/li\x3e\n\x3cli\x3e支持多种类型的构建，包括Fis构建和webpack构建\x3c\/li\x3e\n\x3cli\x3e团队内部的代码贡献统计、离线包内置App等\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e为了解决上述问题，我们于17年2月底开始投入工程化feflow工具的开发和相关规范的制定，目前已经研发出了 feflow 的 \x3ca href=\x22https:\/\/github.com\/feflow\/feflow\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCLI\x3c\/a\x3e 版本，后续会推出 GUI 版本。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e架构设计\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013362604?w=1544\x26amp;h=809\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013362604?w=1544\x26amp;h=809\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e为了让 feflow 的具有高可扩展性，我们设计了4层结构，分别是：插件生态、内核层、参数解析器和控制台。除了贯穿整个开发工作流的基础命令选择通过内部插件内置在CLI 的Core里面，其它非必要命令统一通过插件机制进行扩展。\x3c\/p\x3e\n\x3cp\x3e另一方面，为了使得 feflow 能够适用多种类型的项目。我们开发了多种类型的业务脚手架，如：活动模板、App H5模板、RN模板和业务组件模板。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e执行过程\x3c\/h3\x3e\n\x3cp\x3e当用户在控制台里面输入某个命令。首先会通过CLI 的参数解析器，将这个命令解析成一个object对象，然后传递给CLI 的内核。所有的命令都是通过内核上下文提供的 register 函数 进行注册的，一方面内核自身会读取内置插件 注册的基础命令，另一方面，内核会读取本地已经安装的外部插件注册的命令。如果找到用户输入的命令则开始执行命令对应的回调函数。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e基础命令设计\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# 初始化项目\n$ feflow init\n\n# 本地开发\n$ feflow dev\n\n# 代码质量检查\n$ feflow lint\n\n# 打包构建\n$ feflow build\n\n# 代码发布\n$ feflow publish\n\n# 安装插件、脚手架等\n$ feflow install package\n\n# 配置本地客户端，如: npm 的源和 proxy\n$ feflow config \x3ckey\x3e \x3cvalue\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs elixir\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e# 初始化项目\x3c\/span\x3e\n\x3cspan class=\x22hljs-variable\x22\x3e$ \x3c\/span\x3efeflow init\n\n\x3cspan class=\x22hljs-comment\x22\x3e# 本地开发\x3c\/span\x3e\n\x3cspan class=\x22hljs-variable\x22\x3e$ \x3c\/span\x3efeflow dev\n\n\x3cspan class=\x22hljs-comment\x22\x3e# 代码质量检查\x3c\/span\x3e\n\x3cspan class=\x22hljs-variable\x22\x3e$ \x3c\/span\x3efeflow lint\n\n\x3cspan class=\x22hljs-comment\x22\x3e# 打包构建\x3c\/span\x3e\n\x3cspan class=\x22hljs-variable\x22\x3e$ \x3c\/span\x3efeflow build\n\n\x3cspan class=\x22hljs-comment\x22\x3e# 代码发布\x3c\/span\x3e\n\x3cspan class=\x22hljs-variable\x22\x3e$ \x3c\/span\x3efeflow publish\n\n\x3cspan class=\x22hljs-comment\x22\x3e# 安装插件、脚手架等\x3c\/span\x3e\n\x3cspan class=\x22hljs-variable\x22\x3e$ \x3c\/span\x3efeflow install package\n\n\x3cspan class=\x22hljs-comment\x22\x3e# 配置本地客户端，如: npm 的源和 proxy\x3c\/span\x3e\n\x3cspan class=\x22hljs-variable\x22\x3e$ \x3c\/span\x3efeflow config \x26lt;key\x26gt; \x26lt;value\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e前面提到，CLI 的命令包含两部分，分别是内置在内核里的基础命令和外部插件提供的命令。那么外部插件要如何设计呢？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e插件机制设计\x3c\/h3\x3e\n\x3ch4\x3e插件实现原理\x3c\/h4\x3e\n\x3cp\x3e这里有一个非常巧妙的设计，通过使用node提供的module和vm模块，可以通注入feflow全局变量来访问到cli的实例。从而能够访问cli上的各种属性，比如config, log和一些helper等。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 loadPlugin(path, callback) {\n    const self = this;\n\n    return fs.readFile(path).then((script) =\x3e {\n\n      const module = new Module(path);\n      module.filename = path;\n      module.paths = Module._nodeModulePaths(path);\n\n      function require(path) {\n          return module.require(path);\n      }\n\n      require.resolve = function(request) {\n          return Module._resolveFilename(request, module);\n      };\n\n      require.main = process.mainModule;\n      require.extensions = Module._extensions;\n      require.cache = Module._cache;\n\n      \/\/ Inject feflow variable\n      script = \x27(function(exports, require, module, __filename, __dirname, feflow){\x27 \x2b\n          script \x2b \x27});\x27;\n\n      const fn = vm.runInThisContext(script, path);\n\n      return fn(module.exports, require, module, path, pathFn.dirname(path), self);\n      }).asCallback(callback);\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e loadPlugin(path, callback) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fs.readFile(path).then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3escript\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Module(path);\n      \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.filename = path;\n      \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.paths = Module._nodeModulePaths(path);\n\n      \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epath\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.require(path);\n      }\n\n      \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e.resolve = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3erequest\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Module._resolveFilename(request, \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e);\n      };\n\n      \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e.main = process.mainModule;\n      \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e.extensions = Module._extensions;\n      \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e.cache = Module._cache;\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Inject feflow variable\x3c\/span\x3e\n      script = \x3cspan class=\x22hljs-string\x22\x3e\x27(function(exports, require, module, __filename, __dirname, feflow){\x27\x3c\/span\x3e \x2b\n          script \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27});\x27\x3c\/span\x3e;\n\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fn = vm.runInThisContext(script, path);\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fn(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports, \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e, path, pathFn.dirname(path), self);\n      }).asCallback(callback);\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e命令注册：\x3c\/h4\x3e\n\x3cp\x3e命令需要以feflow.cmd.register进行注册，比如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22feflow.cmd.register(\x27deps\x27, \x27Config ivweb dependencies\x27, function(args) {\n    console.log(args);\n    \/\/ Plugin logic here.\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3efeflow.cmd.register(\x3cspan class=\x22hljs-string\x22\x3e\x27deps\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27Config ivweb dependencies\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eargs\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(args);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Plugin logic here.\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e说明：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eregister有3个参数，第一个是子命令名称，第二个是命令描述说明信息，第三个是对应的子命令执行逻辑函数。\x3c\/li\x3e\n\x3cli\x3efeflow会将命令行参数args解析成Object对象，传递给插件处理函数\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e配置\x3c\/h4\x3e\n\x3cp\x3e可以通过feflow.version获取当前feflow的版本，feflow.baseDir 获取feflow跟目录（在用户目录下的.feflow），通过feflow.pluginDir 获取插件目录\x3c\/p\x3e\n\x3ch4\x3e日志\x3c\/h4\x3e\n\x3cp\x3e通过feflow.log来进行相关命令行日志输出\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const log = feflow.log;\nlog.info() \x26nbsp;  \/\/ 提示日志，控制台中显示绿色\nlog.debug() \x26nbsp; \/\/ 调试日志,  命令行增加--debug可以开启，控制台中显示灰色\nlog.warn() \x26nbsp;  \/\/ 警告日志，控制台中显示黄色背景\nlog.error() \x26nbsp; \/\/ 错误日志，控制台中显示红色\nlog.fatal() \x26nbsp; \/\/ 致命错误日志，，控制台中显示红色\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gauss\x22\x3e\x3ccode\x3econst \x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e = feflow.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e;\n\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e.info() \x26nbsp;  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 提示日志，控制台中显示绿色\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3edebug\x3c\/span\x3e() \x26nbsp; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调试日志,  命令行增加--debug可以开启，控制台中显示灰色\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e.warn() \x26nbsp;  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 警告日志，控制台中显示黄色背景\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3eerror\x3c\/span\x3e() \x26nbsp; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 错误日志，控制台中显示红色\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e.fatal() \x26nbsp; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 致命错误日志，，控制台中显示红色\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e安装\x3c\/h4\x3e\n\x3cp\x3e插件开发完成后，可以通过 feflow 提供的 install 命令安装插件。安装的插件会放置在本地客户端 ~\/.feflow\/node_modules 文件夹下，并且写入到 ~\/.feflow\/package.json 中\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ feflow install feflow-plugin-xxx   \/\/ 安装某个插件\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sql\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e$ feflow \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e feflow-\x3cspan class=\x22hljs-keyword\x22\x3eplugin\x3c\/span\x3e-xxx   \/\/ 安装某个插件\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e之后每次运行命令时，便会从本地加载插件所注册的命令\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e全量更新和增量更新\x3c\/h3\x3e\n\x3cp\x3e当CLI发布了一个新的版本，可能我们会废弃掉某些功能或者提供了新功能。这个时候如果用户依然使用的是旧版本，由于某些服务已经废弃掉了则会报错。在这种新旧版本不兼容的情况下，如何强制用户进行CLI的升级呢？需要在运行命令之前检查本地的CLI是否和远程提供的新版本是否兼容。在新旧版本不兼容时，会强制全量更新。如何判断当前用户安装的本地版本和远程最新版本是否兼容呢？\x3c\/p\x3e\n\x3cp\x3e这里非常巧妙的运用了一下 npm 的 registry机制，每次发布新版本，我们会在 package.json 里面新增一个自定义字段 compatibleVersion，它的值是一个 semver 的版本号。本地检查时，会读取本地已经安装的版本和远程最新的版本进行比较，看看是否满足 compatibleVersion 的要求。如果不满足，则会自动运行 \x3ccode\x3enpm install feflow-cli\x3c\/code\x3e 到最新的版本。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 \x26quot;configs\x26quot;: {\n    \x26quot;compatibleVersion\x26quot;: \x26quot;\x3e=0.13.0\x26quot;\n },\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xquery\x22\x3e\x3ccode\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22configs\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22compatibleVersion\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\x26gt;=0.13.0\x22\x3c\/span\x3e\n },\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于插件，采取的是增量更新机制。每个发布到 npm 上的插件的package.json 中同样会有上面的这个字段，对于本地安装的不兼容的插件列表，会采取增量更新。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e多类型脚手架的架构设计\x3c\/h3\x3e\n\x3cp\x3e项目拷贝存在的问题显而易见，大致有以下三个方面：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e容易出错；一旦某个关键文件拷贝丢失或者错误，很可能需要耗费半天到一天的时间排查环境问题。\x3c\/li\x3e\n\x3cli\x3e不同场景下对目录结构要求不同；平时开发过程中，工程通常会分为运营活动、Hybrid业务、入口级别的项目（对性能和体验有极致和苛刻的要求）。需要基于RN或者Node.js的首屏直出，还有常用的业务组件等的开发。\x3c\/li\x3e\n\x3cli\x3e新的Feature和BugFix难以同步；某个同学开发过程中增加的新方法或者解决的bug很难传递给其它同学并且沉淀成经验积累下来。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e社区里面提供了完美的Yeoman解决方案，它是为了自动化项目的创建而生。Yeoman创建项目包括以下几个阶段：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3einitializing:  初始化一些状态之类的，通常是和用户输入的 options 或者 arguments 打交道\x3c\/li\x3e\n\x3cli\x3eprompting: 和用户交互的时候（命令行问答之类的）调用\x3c\/li\x3e\n\x3cli\x3econfiguring: 保存配置文件（如 .babelrc 等）\x3c\/li\x3e\n\x3cli\x3ewriting: 生成模板文件\x3c\/li\x3e\n\x3cli\x3einstall: 安装依赖\x3c\/li\x3e\n\x3cli\x3eend:  结束部分，初始代码自动提交\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e我们只需要继承Yeoman的Generator类做模板定制化，基于Yeoman的脚手架设计思路应该如下图所示：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000013362605\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000013362605\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e当开发者输入 feflow init 命令时，开发者会告诉CLI需要创建哪一种类型的项目，CLI收到命令后。从本地已经安装的Yeoman脚手架里面选择某种类型的模板。然后，CLI会调用Gitlab API在远程创建仓库并且授予开发者master权限。接下来，会根据实际业务场景需要，自动化申请一些打点信息，常见的如离线包id，监控告警id等等。之后，在本地目录生成代码并且安装项目依赖的npm包，最后将本次初始化生成的所有代码自动提交到远程Git仓库。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e多类型主流构建支持\x3c\/h3\x3e\n\x3cp\x3e为了让feflow 支持多种类型的构建环境，比如 Fis3 和 webpack，或者前不久刚推出的号称零配置成本的 Parcel 构建。在每个项目的跟目录会放置一份配置文件，名称为 feflow.json。它的配置可能是这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;builderType\x26quot;: \x26quot;builder-webpack3\x26quot;,\n    \x26quot;builderOptions\x26quot;: {\n        \x26quot;moduleName\x26quot;: \x26quot;mobile\x26quot;,\n        \x26quot;bizName\x26quot;: \x26quot;category\x26quot;,\n        \x26quot;minifyHTML\x26quot;: true,\n        \x26quot;minifyCSS\x26quot;: true,\n        \x26quot;minifyJS\x26quot;: true,\n        \x26quot;usePx2rem\x26quot;: true,\n        \x26quot;remUnit\x26quot;: 100,\n        \x26quot;remPrecision\x26quot;: 8,\n        \x26quot;inject\x26quot;: true,\n        \x26quot;port\x26quot;: 8001\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs json\x22\x3e\x3ccode\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22builderType\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22builder-webpack3\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22builderOptions\x22\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22moduleName\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22mobile\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22bizName\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22category\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22minifyHTML\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22minifyCSS\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22minifyJS\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22usePx2rem\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22remUnit\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22remPrecision\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22inject\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22port\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e8001\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ebuilderType为构建的npm包，builderOptions为构建的参数配置。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e最后\x3c\/h3\x3e\n\x3cp\x3e腾讯IVWEB团队的工程化解决方案feflow已经开源：Github主页：\x3ca href=\x22https:\/\/github.com\/feflow\/feflow\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/feflow\/feflow\x3c\/a\x3e \x3c\/p\x3e\n\x3cp\x3e如果对您的团队或者项目有帮助，请给个Star支持一下哈～\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>腾讯IVWEB前端工程化工具feflow思考与实践</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013362598">https://segmentfault.com/a/1190000013362598</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/sk5oogl3f3s/" target="_blank">https://alili.tech/archive/sk5oogl3f3s/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>