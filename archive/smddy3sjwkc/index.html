<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="浅谈js设计模式"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>浅谈js设计模式 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/smddy3sjwkc/",
				"appid": "1613049289050283", 
				"title": "浅谈js设计模式 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-01T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/hf1u69knvnj/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/rxjzpxn0deg/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fsmddy3sjwkc%2f&text=%e6%b5%85%e8%b0%88js%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fsmddy3sjwkc%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fsmddy3sjwkc%2f&text=%e6%b5%85%e8%b0%88js%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fsmddy3sjwkc%2f&title=%e6%b5%85%e8%b0%88js%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fsmddy3sjwkc%2f&is_video=false&description=%e6%b5%85%e8%b0%88js%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%b5%85%e8%b0%88js%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fsmddy3sjwkc%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fsmddy3sjwkc%2f&title=%e6%b5%85%e8%b0%88js%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsmddy3sjwkc%2f&title=%e6%b5%85%e8%b0%88js%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsmddy3sjwkc%2f&title=%e6%b5%85%e8%b0%88js%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsmddy3sjwkc%2f&title=%e6%b5%85%e8%b0%88js%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">浅谈js设计模式</h1><div class="meta"><div class="postdate"><time datetime="2018-12-01" itemprop="datePublished">2018-12-01</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e策略模式\x3c\/h2\x3e\n\x3cblockquote\x3e定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换。目的是将算法的使用与算法的实现分离开来。\x3c\/blockquote\x3e\n\x3cp\x3e一个基于策略模式的程序至少由两部分组成：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e一组策略类，策略类封装了具体的算法，并且负责具体的计算过程。\x3c\/li\x3e\n\x3cli\x3e环境类Context, Context接受客户的请求，随后把请求委托给某一个策略类。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22        validator = {\n            validate: function (value, type) {\n                switch (type) {\n                    case \x27isNonEmpty \x27:\n                        {\n                            return true; \/\/ NonEmpty 验证结果\n                        }\n                    case \x27isNumber \x27:\n                        {\n                            return true; \/\/ Number 验证结果\n                            break;\n                        }\n                    case \x27isAlphaNum \x27:\n                        {\n                            return true; \/\/ AlphaNum 验证结果\n                        }\n                    default:\n                        {\n                            return true;\n                        }\n                }\n            }\n        };\n        \/\/  测试\n        alert(validator.validate(\x26quot;123\x26quot;, \x26quot;isNonEmpty\x26quot;));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e        validator = {\n            \x3cspan class=\x22hljs-attr\x22\x3evalidate\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue, type\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (type) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27isNonEmpty \x27\x3c\/span\x3e:\n                        {\n                            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ NonEmpty 验证结果\x3c\/span\x3e\n                        }\n                    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27isNumber \x27\x3c\/span\x3e:\n                        {\n                            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Number 验证结果\x3c\/span\x3e\n                            \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                        }\n                    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27isAlphaNum \x27\x3c\/span\x3e:\n                        {\n                            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ AlphaNum 验证结果\x3c\/span\x3e\n                        }\n                    \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n                        {\n                            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n                        }\n                }\n            }\n        };\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/  测试\x3c\/span\x3e\n        alert(validator.validate(\x3cspan class=\x22hljs-string\x22\x3e\x22123\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22isNonEmpty\x22\x3c\/span\x3e));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var validator = {\n\n    \/\/ 所有可以的验证规则处理类存放的地方，后面会单独定义\n    types: {},\n\n    \/\/ 验证类型所对应的错误消息\n    messages: [],\n\n    \/\/ 当然需要使用的验证类型\n    config: {},\n\n    \/\/ 暴露的公开验证方法\n    \/\/ 传入的参数是 key =\x3e value对\n    validate: function (data) {\n\n        var i, msg, type, checker, result_ok;\n\n        \/\/ 清空所有的错误信息\n        this.messages = [];\n\n        for (i in data) {\n            if (data.hasOwnProperty(i)) {\n\n                type = this.config[i];  \/\/ 根据key查询是否有存在的验证规则\n                checker = this.types[type]; \/\/ 获取验证规则的验证类\n\n                if (!type) {\n                    continue; \/\/ 如果验证规则不存在，则不处理\n                }\n                if (!checker) { \/\/ 如果验证规则类不存在，抛出异常\n                    throw {\n                        name: \x26quot;ValidationError\x26quot;,\n                        message: \x26quot;No handler to validate type \x26quot; \x2b type\n                    };\n                }\n\n                result_ok = checker.validate(data[i]); \/\/ 使用查到到的单个验证类进行验证\n                if (!result_ok) {\n                    msg = \x26quot;Invalid value for *\x26quot; \x2b i \x2b \x26quot;*, \x26quot; \x2b checker.instructions;\n                    this.messages.push(msg);\n                }\n            }\n        }\n        return this.hasErrors();\n    },\n\n    \/\/ helper\n    hasErrors: function () {\n        return this.messages.length !== 0;\n    }\n};\n\n\n\n\n\n\/\/ 验证给定的值是否不为空\nvalidator.types.isNonEmpty = {\n    validate: function (value) {\n        return value !== \x26quot;\x26quot;;\n    },\n    instructions: \x26quot;传入的值不能为空\x26quot;\n};\n\n\/\/ 验证给定的值是否是数字\nvalidator.types.isNumber = {\n    validate: function (value) {\n        return !isNaN(value);\n    },\n    instructions: \x26quot;传入的值只能是合法的数字，例如：1, 3.14 or 2010\x26quot;\n};\n\n\/\/ 验证给定的值是否只是字母或数字\nvalidator.types.isAlphaNum = {\n    validate: function (value) {\n        return !\/[^a-z0-9]\/i.test(value);\n    },\n    instructions: \x26quot;传入的值只能保护字母和数字，不能包含特殊字符\x26quot;\n};\n\n\n\nvar data = {\n    first_name: \x26quot;Tom\x26quot;,\n    last_name: \x26quot;Xu\x26quot;,\n    age: \x26quot;unknown\x26quot;,\n    username: \x26quot;TomXu\x26quot;\n};\n\/\/该对象的作用是检查验证类型是否存在\nvalidator.config = {\n    first_name: \x27isNonEmpty\x27,\n    age: \x27isNumber\x27,\n    username: \x27isAlphaNum\x27\n};\n\n\nvalidator.validate(data);\n\nif (validator.hasErrors()) {\n    console.log(validator.messages.join(\x26quot;\\n\x26quot;));\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e validator = {\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所有可以的验证规则处理类存放的地方，后面会单独定义\x3c\/span\x3e\n    types: {},\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 验证类型所对应的错误消息\x3c\/span\x3e\n    messages: [],\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当然需要使用的验证类型\x3c\/span\x3e\n    config: {},\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 暴露的公开验证方法\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 传入的参数是 key =\x26gt; value对\x3c\/span\x3e\n    validate: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i, msg, type, checker, result_ok;\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 清空所有的错误信息\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.messages = [];\n\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (i \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e data) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (data.hasOwnProperty(i)) {\n\n                type = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.config[i];  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 根据key查询是否有存在的验证规则\x3c\/span\x3e\n                checker = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.types[type]; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取验证规则的验证类\x3c\/span\x3e\n\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!type) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3econtinue\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果验证规则不存在，则不处理\x3c\/span\x3e\n                }\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!checker) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果验证规则类不存在，抛出异常\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e {\n                        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22ValidationError\x22\x3c\/span\x3e,\n                        \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22No handler to validate type \x22\x3c\/span\x3e \x2b type\n                    };\n                }\n\n                result_ok = checker.validate(data[i]); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用查到到的单个验证类进行验证\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!result_ok) {\n                    msg = \x3cspan class=\x22hljs-string\x22\x3e\x22Invalid value for *\x22\x3c\/span\x3e \x2b i \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22*, \x22\x3c\/span\x3e \x2b checker.instructions;\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.messages.push(msg);\n                }\n            }\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hasErrors();\n    },\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ helper\x3c\/span\x3e\n    hasErrors: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.messages.length !== \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    }\n};\n\n\n\n\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 验证给定的值是否不为空\x3c\/span\x3e\nvalidator.types.isNonEmpty = {\n    \x3cspan class=\x22hljs-attr\x22\x3evalidate\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value !== \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e;\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3einstructions\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22传入的值不能为空\x22\x3c\/span\x3e\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 验证给定的值是否是数字\x3c\/span\x3e\nvalidator.types.isNumber = {\n    \x3cspan class=\x22hljs-attr\x22\x3evalidate\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e !\x3cspan class=\x22hljs-built_in\x22\x3eisNaN\x3c\/span\x3e(value);\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3einstructions\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22传入的值只能是合法的数字，例如：1, 3.14 or 2010\x22\x3c\/span\x3e\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 验证给定的值是否只是字母或数字\x3c\/span\x3e\nvalidator.types.isAlphaNum = {\n    \x3cspan class=\x22hljs-attr\x22\x3evalidate\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e !\x3cspan class=\x22hljs-regexp\x22\x3e\/[^a-z0-9]\/i\x3c\/span\x3e.test(value);\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3einstructions\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22传入的值只能保护字母和数字，不能包含特殊字符\x22\x3c\/span\x3e\n};\n\n\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = {\n    \x3cspan class=\x22hljs-attr\x22\x3efirst_name\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Tom\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3elast_name\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Xu\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22unknown\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eusername\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22TomXu\x22\x3c\/span\x3e\n};\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/该对象的作用是检查验证类型是否存在\x3c\/span\x3e\nvalidator.config = {\n    \x3cspan class=\x22hljs-attr\x22\x3efirst_name\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27isNonEmpty\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27isNumber\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eusername\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27isAlphaNum\x27\x3c\/span\x3e\n};\n\n\nvalidator.validate(data);\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (validator.hasErrors()) {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(validator.messages.join(\x3cspan class=\x22hljs-string\x22\x3e\x22\\n\x22\x3c\/span\x3e));\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过策略模式，消除了大片的条件分支语句。将算法封装在独立的strategy中，使得它们易于切换，易于理解，易于扩展。同时，算法还可以复用在其他地方，从而避免许多重复的复制粘贴工作。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e代理模式\x3c\/h2\x3e\n\x3cblockquote\x3e代理模式为一个对象提供一种代理以控制对这个对象的访问。\x3c\/blockquote\x3e\n\x3cp\x3e虚拟代理是我们最常用的代理模式,它把一些开销很大的对象，延迟到真正需要用到这个对象的时候才去创建\x3c\/p\x3e\n\x3cp\x3e虚拟代理实现图片预加载\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var addImg = (function(){\n    var img = document.createElement(\x27img\x27);\n    document.body.appendChild(img);\n    return { \n        setSrc: function(src){\n            img.src = src;\n        }\n    }\n})();\nvar proxyAddImg = (function(){\n    var img = new Image();\n    img.onload = function(){\n        addImg.setSrc(this.src);\n    }\n    return { \n        setSrc: function(src){\n            addImg.setSrc(\x27loading.gif\x27); \n            img.src = src;\n        }\n    }\n})();\nproxyAddImg.setSrc(\x27demo.png\x27); \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e addImg = (\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e img = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27img\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.appendChild(img);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \n        \x3cspan class=\x22hljs-attr\x22\x3esetSrc\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esrc\x3c\/span\x3e)\x3c\/span\x3e{\n            img.src = src;\n        }\n    }\n})();\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e proxyAddImg = (\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e img = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Image();\n    img.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        addImg.setSrc(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.src);\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \n        \x3cspan class=\x22hljs-attr\x22\x3esetSrc\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esrc\x3c\/span\x3e)\x3c\/span\x3e{\n            addImg.setSrc(\x3cspan class=\x22hljs-string\x22\x3e\x27loading.gif\x27\x3c\/span\x3e); \n            img.src = src;\n        }\n    }\n})();\nproxyAddImg.setSrc(\x3cspan class=\x22hljs-string\x22\x3e\x27demo.png\x27\x3c\/span\x3e); \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e虚拟代理合并Http请求\x3cbr\x3e我们可以通过一个代理函数来收集一段时间之内的请求，最后把请求合并到一起发送给服务器\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var proxySynData = (function(){\n    var cache = [], \/\/缓存我们需要同步的内容\n        timer; \/\/定时器\n    return function(ID){\n        if(!timer){ \/\/定时器不存在就创建\n            timer = setTimeout(function(){\n                synData(cache.join()); \/\/同步合并后的数据\n                cache.length = 0; \/\/清空缓存\n                clearTimeout(timer); \/\/清除定时器\n                timer = null; \/\/方便垃圾回收\n            }, 2000);\n        }\n        cache.push(ID); \/\/存入缓存\n    }\n})();\nvar list = document.getElementsByTagName(\x27input\x27);\nfor(var i = 0, item; item = list[i]; i\x2b\x2b){\n    item.onclick = function(){\n        if(this.checked){\n            proxySynData(this.id);\n        }\n    };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e proxySynData = (\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cache = [], \x3cspan class=\x22hljs-comment\x22\x3e\/\/缓存我们需要同步的内容\x3c\/span\x3e\n        timer; \x3cspan class=\x22hljs-comment\x22\x3e\/\/定时器\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eID\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!timer){ \x3cspan class=\x22hljs-comment\x22\x3e\/\/定时器不存在就创建\x3c\/span\x3e\n            timer = setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n                synData(cache.join()); \x3cspan class=\x22hljs-comment\x22\x3e\/\/同步合并后的数据\x3c\/span\x3e\n                cache.length = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/清空缓存\x3c\/span\x3e\n                clearTimeout(timer); \x3cspan class=\x22hljs-comment\x22\x3e\/\/清除定时器\x3c\/span\x3e\n                timer = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/方便垃圾回收\x3c\/span\x3e\n            }, \x3cspan class=\x22hljs-number\x22\x3e2000\x3c\/span\x3e);\n        }\n        cache.push(ID); \x3cspan class=\x22hljs-comment\x22\x3e\/\/存入缓存\x3c\/span\x3e\n    }\n})();\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e list = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementsByTagName(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, item; item = list[i]; i\x2b\x2b){\n    item.onclick = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.checked){\n            proxySynData(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.id);\n        }\n    };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e缓存代理\x3cbr\x3e缓存代理就很好理解了，可以缓存一些开销很大的运算结果;如果你第二次执行函数的时候，传递了同样的参数，那么就直接使用缓存的结果,如果运算量很大，这可是不小的优化\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var add = function(){\n    var sum = 0;\n    for(var i = 0, l = arguments.length; i \x3c l; i\x2b\x2b){\n        sum \x2b= arguments[i];\n    }\n    return sum;\n};\nvar proxyAdd = (function(){\n    var cache = {}; \/\/缓存运算结果的缓存对象\n    return function(){\n        var args = Array.prototype.join.call(arguments);\/\/把参数用逗号组成一个字符串作为“键”\n        if(cache.hasOwnProperty(args)){\/\/等价 args in cache\n            console.log(\x27使用缓存结果\x27);\n            return cache[args];\/\/直接使用缓存对象的“值”\n        }\n        console.log(\x27计算结果\x27);\n        return cache[args] = add.apply(this,arguments);\/\/使用本体函数计算结果并加入缓存\n    }\n})();\nconsole.log(proxyAdd(1,2,3,4,5)); \/\/15\nconsole.log(proxyAdd(1,2,3,4,5)); \/\/15\nconsole.log(proxyAdd(1,2,3,4,5)); \/\/15\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e add = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sum = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, l = \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e.length; i \x26lt; l; i\x2b\x2b){\n        sum \x2b= \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e[i];\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e sum;\n};\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e proxyAdd = (\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cache = {}; \x3cspan class=\x22hljs-comment\x22\x3e\/\/缓存运算结果的缓存对象\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e args = \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.prototype.join.call(\x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/把参数用逗号组成一个字符串作为“键”\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(cache.hasOwnProperty(args)){\x3cspan class=\x22hljs-comment\x22\x3e\/\/等价 args in cache\x3c\/span\x3e\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27使用缓存结果\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cache[args];\x3cspan class=\x22hljs-comment\x22\x3e\/\/直接使用缓存对象的“值”\x3c\/span\x3e\n        }\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27计算结果\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cache[args] = add.apply(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e);\x3cspan class=\x22hljs-comment\x22\x3e\/\/使用本体函数计算结果并加入缓存\x3c\/span\x3e\n    }\n})();\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(proxyAdd(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e)); \x3cspan class=\x22hljs-comment\x22\x3e\/\/15\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(proxyAdd(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e)); \x3cspan class=\x22hljs-comment\x22\x3e\/\/15\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(proxyAdd(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e)); \x3cspan class=\x22hljs-comment\x22\x3e\/\/15\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e观察者模式\x3c\/h2\x3e\n\x3cblockquote\x3e观察者模式又叫发布-订阅模式，它定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖它的对象都将得到通知。\x3c\/blockquote\x3e\n\x3cp\x3e定义一个事件对象，它有以下功能\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e监听事件（订阅公众号）\x3c\/li\x3e\n\x3cli\x3e触发事件（公众号发布）\x3c\/li\x3e\n\x3cli\x3e移除事件（取订公众号）\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ subscription.js\nvar CLEARED = null;\nvar nullListeners = {\n  notify: function notify() {}\n};\n\nfunction createListenerCollection() {\n  \/\/ the current\/next pattern is copied from redux\x27s createStore code.\n  \/\/ TODO: refactor\x2bexpose that code to be reusable here?\n  var current = [];\n  var next = [];\n\n  return {\n    clear: function clear() {\n      next = CLEARED;\n      current = CLEARED;\n    },\n    notify: function notify() {\n      var listeners = current = next;\n      for (var i = 0; i \x3c listeners.length; i\x2b\x2b) {\n        listeners[i]();\n      }\n    },\n    get: function get() {\n      return next;\n    },\n    subscribe: function subscribe(listener) {\n      var isSubscribed = true;\n      if (next === current) next = current.slice();\n      next.push(listener);\n\n      return function unsubscribe() {\n        if (!isSubscribed || current === CLEARED) return;\n        isSubscribed = false;\n\n        if (next === current) next = current.slice();\n        next.splice(next.indexOf(listener), 1);\n      };\n    }\n  };\n}\n\nvar Subscription = function () {\n  function Subscription(store, parentSub, onStateChange) {\n    _classCallCheck(this, Subscription);\n\n    this.store = store;\n    this.parentSub = parentSub;\n    this.onStateChange = onStateChange;\n    this.unsubscribe = null;\n    this.listeners = nullListeners;\n  }\n\n  Subscription.prototype.addNestedSub = function addNestedSub(listener) {\n    this.trySubscribe();\n    return this.listeners.subscribe(listener);\n  };\n\n  Subscription.prototype.notifyNestedSubs = function notifyNestedSubs() {\n    this.listeners.notify();\n  };\n\n  Subscription.prototype.isSubscribed = function isSubscribed() {\n    return Boolean(this.unsubscribe);\n  };\n\n  Subscription.prototype.trySubscribe = function trySubscribe() {\n    if (!this.unsubscribe) {\n      this.unsubscribe = this.parentSub ? this.parentSub.addNestedSub(this.onStateChange) : this.store.subscribe(this.onStateChange);\n\n      this.listeners = createListenerCollection();\n    }\n  };\n\n  Subscription.prototype.tryUnsubscribe = function tryUnsubscribe() {\n    if (this.unsubscribe) {\n      this.unsubscribe();\n      this.unsubscribe = null;\n      this.listeners.clear();\n      this.listeners = nullListeners;\n    }\n  };\n\n  return Subscription;\n}();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ subscription.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e CLEARED = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e nullListeners = {\n  \x3cspan class=\x22hljs-attr\x22\x3enotify\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enotify\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{}\n};\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateListenerCollection\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ the current\/next pattern is copied from redux\x27s createStore code.\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x3cspan class=\x22hljs-doctag\x22\x3eTODO:\x3c\/span\x3e refactor\x2bexpose that code to be reusable here?\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e current = [];\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e next = [];\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attr\x22\x3eclear\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eclear\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      next = CLEARED;\n      current = CLEARED;\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3enotify\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enotify\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e listeners = current = next;\n      \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; listeners.length; i\x2b\x2b) {\n        listeners[i]();\n      }\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next;\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3esubscribe\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esubscribe\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3elistener\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isSubscribed = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (next === current) next = current.slice();\n      next.push(listener);\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eunsubscribe\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!isSubscribed || current === CLEARED) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        isSubscribed = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (next === current) next = current.slice();\n        next.splice(next.indexOf(listener), \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n      };\n    }\n  };\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Subscription = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSubscription\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estore, parentSub, onStateChange\x3c\/span\x3e) \x3c\/span\x3e{\n    _classCallCheck(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, Subscription);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.store = store;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.parentSub = parentSub;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onStateChange = onStateChange;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unsubscribe = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listeners = nullListeners;\n  }\n\n  Subscription.prototype.addNestedSub = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eaddNestedSub\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3elistener\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.trySubscribe();\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listeners.subscribe(listener);\n  };\n\n  Subscription.prototype.notifyNestedSubs = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enotifyNestedSubs\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listeners.notify();\n  };\n\n  Subscription.prototype.isSubscribed = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eisSubscribed\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eBoolean\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unsubscribe);\n  };\n\n  Subscription.prototype.trySubscribe = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etrySubscribe\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unsubscribe) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unsubscribe = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.parentSub ? \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.parentSub.addNestedSub(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onStateChange) : \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.store.subscribe(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onStateChange);\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listeners = createListenerCollection();\n    }\n  };\n\n  Subscription.prototype.tryUnsubscribe = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etryUnsubscribe\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unsubscribe) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unsubscribe();\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.unsubscribe = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listeners.clear();\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.listeners = nullListeners;\n    }\n  };\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Subscription;\n}();\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eRedux采用了观察者模式\x3c\/p\x3e\n\x3ch4\x3ecreateStore(rootReducer,initialState,applyMiddleware(thunkMiddleware))\x3c\/h4\x3e\n\x3cp\x3e返回值：\x3cbr\x3e(1) dispatch(action): 用于action的分发，改变store里面的state\x3cbr\x3e(2) subscribe(listener): 注册listener，store里面state发生改变后，执行该listener。返回unsubscrib()方法，用于注销当前listener。\x3cbr\x3e(3) getState(): 读取store里面的state\x3cbr\x3e(4) replaceReducer(): 替换reducer，改变state修改的逻辑\x3c\/p\x3e\n\x3cp\x3e所以store内部维护listener数组，用于存储所有通过store.subscribe注册的listener；当store tree更新后，依次执行数组中的listener\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  function subscribe(listener) {\n    if (typeof listener !== \x27function\x27) {\n      throw new Error(\x27Expected listener to be a function.\x27);\n    }\n\n    var isSubscribed = true;\n\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n    了\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return;\n      }\n\n      isSubscribed = false;\n\n      ensureCanMutateNextListeners();\n      var index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, 1);\n    };\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esubscribe\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3elistener\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e listener !== \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Expected listener to be a function.\x27\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isSubscribed = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n    了\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eunsubscribe\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!isSubscribed) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n      }\n\n      isSubscribed = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n\n      ensureCanMutateNextListeners();\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n    };\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3edispatch方法主要完成两件事：\x3cbr\x3e1、根据action查询reducer中变更state的方法，更新store tree\x3cbr\x3e2、变更store tree后，依次执行listener中所有响应函数\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  function dispatch(action) {\n    if (!(0, _isPlainObject2[\x27default\x27])(action)) {\n      throw new Error(\x27Actions must be plain objects. \x27 \x2b \x27Use custom middleware for async actions.\x27);\n    }\n\n    if (typeof action.type === \x27undefined\x27) {\n      throw new Error(\x27Actions may not have an undefined \x26quot;type\x26quot; property. \x27 \x2b \x27Have you misspelled a constant?\x27);\n    }\n\n    if (isDispatching) {\n      throw new Error(\x27Reducers may not dispatch actions.\x27);\n    }\n\n    try {\n      isDispatching = true;\n      currentState = currentReducer(currentState, action);\n    } finally {\n      isDispatching = false;\n    }\n    \/\/循环遍历，执行listener，通知数据改变\n    var listeners = currentListeners = nextListeners;\n    for (var i = 0; i \x3c listeners.length; i\x2b\x2b) {\n      var listener = listeners[i];\n      listener();\n    }\n\n    return action;\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edispatch\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, _isPlainObject2[\x3cspan class=\x22hljs-string\x22\x3e\x27default\x27\x3c\/span\x3e])(action)) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Actions must be plain objects. \x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27Use custom middleware for async actions.\x27\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e action.type === \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Actions may not have an undefined \x22type\x22 property. \x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27Have you misspelled a constant?\x27\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isDispatching) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Reducers may not dispatch actions.\x27\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n      isDispatching = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      currentState = currentReducer(currentState, action);\n    } \x3cspan class=\x22hljs-keyword\x22\x3efinally\x3c\/span\x3e {\n      isDispatching = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/循环遍历，执行listener，通知数据改变\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e listeners = currentListeners = nextListeners;\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; listeners.length; i\x2b\x2b) {\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e listener = listeners[i];\n      listener();\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e action;\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e在redux中，我们用connect()方法将react中的UI组件与redux的状态、事件关联起来。\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    var Connect = function (_Component) {\n      _inherits(Connect, _Component);\n      \/*\n      * 构造函数中，构造一个订阅对象，属性有this.store,方法this.onStateChange.bind(this)\n      *\/\n      function Connect(props, context) {\n        _classCallCheck(this, Connect);\n\n        var _this = _possibleConstructorReturn(this, _Component.call(this, props, context));\n\n        _this.version = version;\n        _this.state = {};\n        _this.renderCount = 0;\n        _this.store = props[storeKey] || context[storeKey];\n        _this.propsMode = Boolean(props[storeKey]);\n        _this.setWrappedInstance = _this.setWrappedInstance.bind(_this);\n\n        (0, _invariant2.default)(_this.store, \x27Could not find \x26quot;\x27 \x2b storeKey \x2b \x27\x26quot; in either the context or props of \x27 \x2b (\x27\x26quot;\x27 \x2b displayName \x2b \x27\x26quot;. Either wrap the root component in a \x3cProvider\x3e, \x27) \x2b (\x27or explicitly pass \x26quot;\x27 \x2b storeKey \x2b \x27\x26quot; as a prop to \x26quot;\x27 \x2b displayName \x2b \x27\x26quot;.\x27));\n\n        _this.initSelector();\n        _this.initSubscription();\n        return _this;\n      }\n\n      ···\n      \/\/ 调用store.subscribe(listener)注册监听方法，对store的变化进行订阅，当store变化的时候，更新渲染view\n      Connect.prototype.componentDidMount = function componentDidMount() {\n        if (!shouldHandleStateChanges) return;\n        this.subscription.trySubscribe(); \/\/ \/\/实际调用this.store.subscribe(this.onStateChange);\n        this.selector.run(this.props);\n        if (this.selector.shouldComponentUpdate) this.forceUpdate();\n      };\n       ···\n\n      Connect.prototype.componentWillUnmount = function componentWillUnmount() {\n        if (this.subscription) this.subscription.tryUnsubscribe(); \/\/ 取消订阅\n        this.subscription = null;\n        this.notifyNestedSubs = noop;\n        this.store = null;\n        this.selector.run = noop;\n        this.selector.shouldComponentUpdate = false;\n      };\n        ···\n      \/\/初始化订阅逻辑\n      Connect.prototype.initSubscription = function initSubscription() {\n        if (!shouldHandleStateChanges) return;\n\n        var parentSub = (this.propsMode ? this.props : this.context)[subscriptionKey];\n        this.subscription = new _Subscription2.default(this.store, parentSub, this.onStateChange.bind(this));  \/\/调用的是Subscription.js中方法,向store内部注册一个listener---this.onStateChange.bind(this)\n\n        this.notifyNestedSubs = this.subscription.notifyNestedSubs.bind(this.subscription);\n      };\n\n      Connect.prototype.onStateChange = function onStateChange() {\n        this.selector.run(this.props);\n\n        if (!this.selector.shouldComponentUpdate) {\n          this.notifyNestedSubs();\n        } else {\n          this.componentDidUpdate = this.notifyNestedSubsOnComponentDidUpdate;\n          this.setState(dummyState);\n        }\n      };\n\n    ···\n\n      return Connect;\n    }(_react.Component);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Connect = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e_Component\x3c\/span\x3e) \x3c\/span\x3e{\n      _inherits(Connect, _Component);\n      \x3cspan class=\x22hljs-comment\x22\x3e\/*\n      * 构造函数中，构造一个订阅对象，属性有this.store,方法this.onStateChange.bind(this)\n      *\/\x3c\/span\x3e\n      \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eConnect\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eprops, context\x3c\/span\x3e) \x3c\/span\x3e{\n        _classCallCheck(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, Connect);\n\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _this = _possibleConstructorReturn(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, _Component.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, props, context));\n\n        _this.version = version;\n        _this.state = {};\n        _this.renderCount = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        _this.store = props[storeKey] || context[storeKey];\n        _this.propsMode = \x3cspan class=\x22hljs-built_in\x22\x3eBoolean\x3c\/span\x3e(props[storeKey]);\n        _this.setWrappedInstance = _this.setWrappedInstance.bind(_this);\n\n        (\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, _invariant2.default)(_this.store, \x3cspan class=\x22hljs-string\x22\x3e\x27Could not find \x22\x27\x3c\/span\x3e \x2b storeKey \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22 in either the context or props of \x27\x3c\/span\x3e \x2b (\x3cspan class=\x22hljs-string\x22\x3e\x27\x22\x27\x3c\/span\x3e \x2b displayName \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22. Either wrap the root component in a \x26lt;Provider\x26gt;, \x27\x3c\/span\x3e) \x2b (\x3cspan class=\x22hljs-string\x22\x3e\x27or explicitly pass \x22\x27\x3c\/span\x3e \x2b storeKey \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22 as a prop to \x22\x27\x3c\/span\x3e \x2b displayName \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22.\x27\x3c\/span\x3e));\n\n        _this.initSelector();\n        _this.initSubscription();\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e _this;\n      }\n\n      ···\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用store.subscribe(listener)注册监听方法，对store的变化进行订阅，当store变化的时候，更新渲染view\x3c\/span\x3e\n      Connect.prototype.componentDidMount = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecomponentDidMount\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!shouldHandleStateChanges) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subscription.trySubscribe(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \/\/实际调用this.store.subscribe(this.onStateChange);\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.selector.run(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.selector.shouldComponentUpdate) \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.forceUpdate();\n      };\n       ···\n\n      Connect.prototype.componentWillUnmount = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecomponentWillUnmount\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subscription) \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subscription.tryUnsubscribe(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 取消订阅\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subscription = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.notifyNestedSubs = noop;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.store = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.selector.run = noop;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.selector.shouldComponentUpdate = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n      };\n        ···\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/初始化订阅逻辑\x3c\/span\x3e\n      Connect.prototype.initSubscription = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einitSubscription\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!shouldHandleStateChanges) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e parentSub = (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.propsMode ? \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props : \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context)[subscriptionKey];\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subscription = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e _Subscription2.default(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.store, parentSub, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onStateChange.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e));  \x3cspan class=\x22hljs-comment\x22\x3e\/\/调用的是Subscription.js中方法,向store内部注册一个listener---this.onStateChange.bind(this)\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.notifyNestedSubs = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subscription.notifyNestedSubs.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subscription);\n      };\n\n      Connect.prototype.onStateChange = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonStateChange\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.selector.run(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props);\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.selector.shouldComponentUpdate) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.notifyNestedSubs();\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.componentDidUpdate = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.notifyNestedSubsOnComponentDidUpdate;\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState(dummyState);\n        }\n      };\n\n    ···\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Connect;\n    }(_react.Component);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e装饰者模式\x3c\/h2\x3e\n\x3cblockquote\x3e在不改变对象自身的基础上，在程序运行期间给对象动态地添加一些额外职责\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 给window绑定onload事件\nwindow.onload = function() {\n    alert(1)\n}\n\nvar _onload = window.onload || function(){}  \/\/维护中间变量，但是如果装饰链太长，或需要的装饰函数太多，这些中间变量的数量就会越来越多\n\nwindow.onload = function() {\n    _onload()\n    alert(2)\n}\n\n\/\/可能会存在this被劫持问题\nvar getId = document.getElementById; \/\/全局函数，this指向window\ndocument.getElementById = function(ID){\n    console.log(1);\n    return getId(ID);\n}\ndocument.getElementById(\x27demo\x27); \/\/this预期指向document\n\n\/\/需要手动把document当做上下文this传入getId\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 给window绑定onload事件\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    alert(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _onload = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.onload || \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{}  \x3cspan class=\x22hljs-comment\x22\x3e\/\/维护中间变量，但是如果装饰链太长，或需要的装饰函数太多，这些中间变量的数量就会越来越多\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    _onload()\n    alert(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/可能会存在this被劫持问题\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e getId = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById; \x3cspan class=\x22hljs-comment\x22\x3e\/\/全局函数，this指向window\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eID\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e getId(ID);\n}\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27demo\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/this预期指向document\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/需要手动把document当做上下文this传入getId\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3eAOP装饰函数\x3c\/h3\x3e\n\x3cblockquote\x3eAOP（Aspect Oriented Programming）面向切面编程 \x3cbr\x3e把一些与核心业务逻辑无关的功能抽离出来 \x3cbr\x3e再通过“动态织入”方式掺入业务逻辑模块\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 前置装饰\nFunction.prototype.before = function(beforeFunc){\n    var that = this; \/\/保存原函数的引用\n    return function(){ \/\/返回了了包含原函数和新函数的代理函数\n        beforeFunc.apply(this, arguments); \/\/ 执行新函数\n        return that.apply(this, arguments); \/\/执行原函数并返回原函数的执行结果\n    }\n}\n\ndocument.getElementById = document.getElementById.before(function() {\n    alet(1)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 前置装饰\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e.prototype.before = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ebeforeFunc\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e that = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/保存原函数的引用\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/返回了了包含原函数和新函数的代理函数\x3c\/span\x3e\n        beforeFunc.apply(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 执行新函数\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e that.apply(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行原函数并返回原函数的执行结果\x3c\/span\x3e\n    }\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById.before(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    alet(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/定义一个组件\nclass Home extends Component {\n    \/\/....\n}\n\n\/\/以往从状态树取出对应的数据，通过props传给组件使用通过react-redux自带的connect()方法\nexport default connect(state =\x3e ({todos: state.todos}))(Home);\n\n\/\/使用装饰器的话就变成这样，好像没那么复杂\n@connect(state =\x3e ({ todos: state.todos }))\nclass Home extends React.Component {\n    \/\/....\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/定义一个组件\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHome\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/....\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/以往从状态树取出对应的数据，通过props传给组件使用通过react-redux自带的connect()方法\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e connect(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estate\x3c\/span\x3e =\x26gt;\x3c\/span\x3e ({\x3cspan class=\x22hljs-attr\x22\x3etodos\x3c\/span\x3e: state.todos}))(Home);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/使用装饰器的话就变成这样，好像没那么复杂\x3c\/span\x3e\n@connect(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estate\x3c\/span\x3e =\x26gt;\x3c\/span\x3e ({ \x3cspan class=\x22hljs-attr\x22\x3etodos\x3c\/span\x3e: state.todos }))\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHome\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/....\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e适配器模式\x3c\/h2\x3e\n\x3cp\x3e适配器模式是作为两个不兼容的接口之间的桥梁，它结合了两个独立接口的功能。\x3c\/p\x3e\n\x3cp\x3e假设我们正在编写一个渲染广东省地图的页面，目前从第三方资源里获得了广东省的所有城市以及它们所对应的ID,并且成功地渲染到页面中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var getGuangdongCity = function () {\n    var GuangdongCity = [\n       {\n          name:\x27shenzhen\x27,\n          id  : \x2711\x27\n       },\n       {\n         name:\x27guangzhou\x27,\n         id:12\n       }\n  ];\n  return GuangdongCity;\n};\n\nvar render  = function (fn) {\n    console.log(\x27starting render Guangdong map\x27);\n    document.write(JSON.stringify(fn()));\n};\n\/* var GuangdongCity = {\n\/\/                      shenzhen:11,\n\/\/                      guangzhou:12,\n\/\/                      zhuhai:13\n\/\/                     };\n*\/\nvar addressAdapter = function (oldAddressfn) {\nvar address = {},\n    oldAddress = oldAddressfn();\n    for(var i = 0 , c; c = oldAddress[i\x2b\x2b];){\n        address[c.name] = c.id;  \/\/此处我们遍历老数据把它们添加到空对象中然后返回这个对象\n    }\n    return function () {\n        return address;\n    }\n};\nrender(addressAdapter(getGuangdongCity));\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e getGuangdongCity = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e GuangdongCity = [\n       {\n          \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27shenzhen\x27\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e  : \x3cspan class=\x22hljs-string\x22\x3e\x2711\x27\x3c\/span\x3e\n       },\n       {\n         \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27guangzhou\x27\x3c\/span\x3e,\n         \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e\n       }\n  ];\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e GuangdongCity;\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e render  = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27starting render Guangdong map\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.write(\x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(fn()));\n};\n\x3cspan class=\x22hljs-comment\x22\x3e\/* var GuangdongCity = {\n\/\/                      shenzhen:11,\n\/\/                      guangzhou:12,\n\/\/                      zhuhai:13\n\/\/                     };\n*\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e addressAdapter = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eoldAddressfn\x3c\/span\x3e) \x3c\/span\x3e{\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e address = {},\n    oldAddress = oldAddressfn();\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e , c; c = oldAddress[i\x2b\x2b];){\n        address[c.name] = c.id;  \x3cspan class=\x22hljs-comment\x22\x3e\/\/此处我们遍历老数据把它们添加到空对象中然后返回这个对象\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e address;\n    }\n};\nrender(addressAdapter(getGuangdongCity));\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用适配器模式可以解决参数类型有些许不一致造成的问题。\x3c\/p\x3e\n\x3cp\x3eredux为了和react适配，所有有 mapStateToProps()这个函数来把state转为Props外部状态，这样就可以从外部又回到组件内了\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>浅谈js设计模式</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014801625">https://segmentfault.com/a/1190000014801625</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/smddy3sjwkc/" target="_blank">https://alili.tech/archive/smddy3sjwkc/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>