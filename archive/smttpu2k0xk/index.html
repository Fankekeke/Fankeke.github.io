<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="微信小游戏初体验"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>微信小游戏初体验 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/smttpu2k0xk/",
				"appid": "1613049289050283", 
				"title": "微信小游戏初体验 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-19T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/hlwufyrxol/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/cvmc7p8vihq/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fsmttpu2k0xk%2f&text=%e5%be%ae%e4%bf%a1%e5%b0%8f%e6%b8%b8%e6%88%8f%e5%88%9d%e4%bd%93%e9%aa%8c"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fsmttpu2k0xk%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fsmttpu2k0xk%2f&text=%e5%be%ae%e4%bf%a1%e5%b0%8f%e6%b8%b8%e6%88%8f%e5%88%9d%e4%bd%93%e9%aa%8c"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fsmttpu2k0xk%2f&title=%e5%be%ae%e4%bf%a1%e5%b0%8f%e6%b8%b8%e6%88%8f%e5%88%9d%e4%bd%93%e9%aa%8c"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fsmttpu2k0xk%2f&is_video=false&description=%e5%be%ae%e4%bf%a1%e5%b0%8f%e6%b8%b8%e6%88%8f%e5%88%9d%e4%bd%93%e9%aa%8c"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%be%ae%e4%bf%a1%e5%b0%8f%e6%b8%b8%e6%88%8f%e5%88%9d%e4%bd%93%e9%aa%8c&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fsmttpu2k0xk%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fsmttpu2k0xk%2f&title=%e5%be%ae%e4%bf%a1%e5%b0%8f%e6%b8%b8%e6%88%8f%e5%88%9d%e4%bd%93%e9%aa%8c"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsmttpu2k0xk%2f&title=%e5%be%ae%e4%bf%a1%e5%b0%8f%e6%b8%b8%e6%88%8f%e5%88%9d%e4%bd%93%e9%aa%8c"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsmttpu2k0xk%2f&title=%e5%be%ae%e4%bf%a1%e5%b0%8f%e6%b8%b8%e6%88%8f%e5%88%9d%e4%bd%93%e9%aa%8c"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsmttpu2k0xk%2f&title=%e5%be%ae%e4%bf%a1%e5%b0%8f%e6%b8%b8%e6%88%8f%e5%88%9d%e4%bd%93%e9%aa%8c"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">微信小游戏初体验</h1><div class="meta"><div class="postdate"><time datetime="2018-12-19" itemprop="datePublished">2018-12-19</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e本文旨在通过分析官方给出的一个飞机大战小游戏的源代码来说明如何进行小游戏的开发。\x3c\/blockquote\x3e\n\x3ch4\x3e1.前言\x3c\/h4\x3e\n\x3cp\x3e前天一个\x3ccode\x3e跳一跳\x3c\/code\x3e小游戏刷遍了朋友圈，也代表了微信小程序拥有了搭载游戏的功能（早该往这方面发展了，这才是应该有的形态嘛）。作为一个前端er，我的大刀早已经饥渴难耐了，赶紧去下一波最新的微信官方开发工具，体验一波小游戏要如何开发。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012646893\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012646893\x22 alt=\x22微信开发者工具最新版\x22 title=\x22微信开发者工具最新版\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们欣喜地看到可以直接点击小游戏体验一下，而且官方也有一个示例源代码，是一个简易版的飞机大战的源码，直接点开模拟器就可以看效果。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012646894\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012646894\x22 alt=\x22官方源码飞机大战游戏\x22 title=\x22官方源码飞机大战游戏\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3e2.源码分析\x3c\/h4\x3e\n\x3cp\x3e（还是原汁原味的打飞机游戏呀！）通过阅读这个源代码我们便可以知道如何进行小游戏的开发了。废话少说直接进入主题，先来分析一波源码的整体结构。\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth align=\x22left\x22\x3e路径\x3c\/th\x3e\n\x3cth align=\x22left\x22\x3e内容\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eaudio\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e音频文件目录\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eimages\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e图片文件目录\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3ejs\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e主要源代码目录\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3egame.js\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e游戏主入口\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3egame.json\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e游戏的配置文件\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e下面是官方示例中的js文件具体的作用\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\/js\n├── base                                   \/\/ 定义游戏开发基础类\n│   ├── animatoin.js                       \/\/ 帧动画的简易实现\n│   ├── pool.js                            \/\/ 对象池的简易实现\n│   └── sprite.js                          \/\/ 游戏基本元素精灵类\n├── libs\n│   ├── symbol.js                          \/\/ ES6 Symbol简易兼容\n│   └── weapp-adapter.js                   \/\/ 小游戏适配器\n├── npc\n│   └── enemy.js                           \/\/ 敌机类\n├── player\n│   ├── bullet.js                          \/\/ 子弹类\n│   └── index.js                           \/\/ 玩家类\n├── runtime\n│   ├── background.js                      \/\/ 背景类\n│   ├── gameinfo.js                        \/\/ 用于展示分数和结算界面\n│   └── music.js                           \/\/ 全局音效管理器\n├── databus.js                             \/\/ 管控游戏状态\n└── main.js                                \/\/ 游戏入口主函数\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xl\x22\x3e\x3ccode\x3e.\/js\n├── base                                   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 定义游戏开发基础类\x3c\/span\x3e\n│   ├── animatoin.js                       \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 帧动画的简易实现\x3c\/span\x3e\n│   ├── pool.js                            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对象池的简易实现\x3c\/span\x3e\n│   └── sprite.js                          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 游戏基本元素精灵类\x3c\/span\x3e\n├── libs\n│   ├── \x3cspan class=\x22hljs-keyword\x22\x3esymbol\x3c\/span\x3e.js                          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ES6 Symbol简易兼容\x3c\/span\x3e\n│   └── weapp-adapter.js                   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 小游戏适配器\x3c\/span\x3e\n├── npc\n│   └── enemy.js                           \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 敌机类\x3c\/span\x3e\n├── player\n│   ├── bullet.js                          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 子弹类\x3c\/span\x3e\n│   └── index.js                           \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 玩家类\x3c\/span\x3e\n├── runtime\n│   ├── \x3cspan class=\x22hljs-built_in\x22\x3ebackground\x3c\/span\x3e.js                      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 背景类\x3c\/span\x3e\n│   ├── gameinfo.js                        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用于展示分数和结算界面\x3c\/span\x3e\n│   └── music.js                           \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 全局音效管理器\x3c\/span\x3e\n├── databus.js                             \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 管控游戏状态\x3c\/span\x3e\n└── main.js                                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 游戏入口主函数\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e官方文档中提到，\x3ccode\x3egame.js\x3c\/code\x3e和\x3ccode\x3egame.json\x3c\/code\x3e是小游戏必须要有的两个文件\x3c\/blockquote\x3e\n\x3cp\x3e下面我会分析我认为主要的文件与结构，不会对每一行代码进行解析，大家有兴趣可以自行阅读官方的源码。每个文件后会跟随我认为重要的几个小点。\x3c\/p\x3e\n\x3ch5\x3egame.js\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import \x27.\/js\/libs\/weapp-adapter\x27\nimport \x27.\/js\/libs\/symbol\x27\n\nimport Main from \x27.\/js\/main\x27\n\nnew Main()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/js\/libs\/weapp-adapter\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/js\/libs\/symbol\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Main \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/js\/main\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Main()\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\n\x3cli\x3e小程序启动会调用\x3ccode\x3egame.js\x3c\/code\x3e，在其中导入了小游戏官方提供的适配器，用于注入canvas以及模拟DOM以及BOM（后续会具体说明这个文件），可以在\x3ca href=\x22https:\/\/mp.weixin.qq.com\/debug\/wxagame\/dev\/tutorial\/adapter.html?t=20171229\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/mp.weixin.qq.com\/debu...\x3c\/a\x3e 下载源代码，修改适合自己的版本并通过webpack打包自用。当然目前已经足够我们使用。\x3c\/li\x3e\n\x3cli\x3e导入symbol的polyfill，主要用于模拟ES6类的私有变量。\x3c\/li\x3e\n\x3cli\x3e导入Main类并实例化Main，于是顺藤摸瓜我们将目光移至Main.js\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch5\x3eMain.js\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import Player     from \x27.\/player\/index\x27\nimport Enemy      from \x27.\/npc\/enemy\x27\nimport BackGround from \x27.\/runtime\/background\x27\nimport GameInfo   from \x27.\/runtime\/gameinfo\x27\nimport Music      from \x27.\/runtime\/music\x27\nimport DataBus    from \x27.\/databus\x27\n\nlet ctx   = canvas.getContext(\x272d\x27)\nlet databus = new DataBus()\n\n\/**\n * 游戏主函数\n *\/\nexport default class Main {\n  constructor() {\n    this.restart()\n  }\n\n  restart() {\n    databus.reset()\n\n    canvas.removeEventListener(\n      \x27touchstart\x27,\n      this.touchHandler\n    )\n\n    this.bg       = new BackGround(ctx)\n    this.player   = new Player(ctx)\n    this.gameinfo = new GameInfo()\n    this.music    = new Music()\n\n    window.requestAnimationFrame(\n      this.loop.bind(this),\n      canvas\n    )\n  }\n\n  \/**\n   * 随着帧数变化的敌机生成逻辑\n   * 帧数取模定义成生成的频率\n   *\/\n  enemyGenerate() {\n    if ( databus.frame % 30 === 0 ) {\n      let enemy = databus.pool.getItemByClass(\x27enemy\x27, Enemy)\n      enemy.init(6)\n      databus.enemys.push(enemy)\n    }\n  }\n\n  \/\/ 全局碰撞检测\n  collisionDetection() {\n    let that = this\n\n    databus.bullets.forEach((bullet) =\x3e {\n      for ( let i = 0, il = databus.enemys.length; i \x3c il;i\x2b\x2b ) {\n        let enemy = databus.enemys[i]\n\n        if ( !enemy.isPlaying \x26amp;\x26amp; enemy.isCollideWith(bullet) ) {\n          enemy.playAnimation()\n          that.music.playExplosion()\n\n          bullet.visible = false\n          databus.score  \x2b= 1\n\n          break\n        }\n      }\n    })\n\n    for ( let i = 0, il = databus.enemys.length; i \x3c il;i\x2b\x2b ) {\n      let enemy = databus.enemys[i]\n\n      if ( this.player.isCollideWith(enemy) ) {\n        databus.gameOver = true\n\n        break\n      }\n    }\n  }\n\n  \/\/游戏结束后的触摸事件处理逻辑\n  touchEventHandler(e) {\n    e.preventDefault()\n\n    let x = e.touches[0].clientX\n    let y = e.touches[0].clientY\n\n    let area = this.gameinfo.btnArea\n\n    if (   x \x3e= area.startX\n        \x26amp;\x26amp; x \x3c= area.endX\n        \x26amp;\x26amp; y \x3e= area.startY\n        \x26amp;\x26amp; y \x3c= area.endY  )\n      this.restart()\n    }\n\n    \/**\n     * canvas重绘函数\n     * 每一帧重新绘制所有的需要展示的元素\n     *\/\n    render() {\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n\n    this.bg.render(ctx)\n\n    databus.bullets\n           .concat(databus.enemys)\n           .forEach((item) =\x3e {\n              item.drawToCanvas(ctx)\n            })\n\n    this.player.drawToCanvas(ctx)\n\n    databus.animations.forEach((ani) =\x3e {\n      if ( ani.isPlaying ) {\n        ani.aniRender(ctx)\n      }\n    })\n\n    this.gameinfo.renderGameScore(ctx, databus.score)\n  }\n\n  \/\/ 游戏逻辑更新主函数\n  update() {\n    this.bg.update()\n\n    databus.bullets\n           .concat(databus.enemys)\n           .forEach((item) =\x3e {\n              item.update()\n            })\n\n    this.enemyGenerate()\n\n    this.collisionDetection()\n  }\n\n  \/\/ 实现游戏帧循环\n  loop() {\n    databus.frame\x2b\x2b\n\n    this.update()\n    this.render()\n\n    if ( databus.frame % 20 === 0 ) {\n      this.player.shoot()\n      this.music.playShoot()\n    }\n\n    \/\/ 游戏结束停止帧循环\n    if ( databus.gameOver ) {\n      this.gameinfo.renderGameOver(ctx, databus.score)\n\n      this.touchHandler = this.touchEventHandler.bind(this)\n      canvas.addEventListener(\x27touchstart\x27, this.touchHandler)\n\n      return\n    }\n\n    window.requestAnimationFrame(\n      this.loop.bind(this),\n      canvas\n    )\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Player     \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/player\/index\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Enemy      \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/npc\/enemy\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e BackGround \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/runtime\/background\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e GameInfo   \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/runtime\/gameinfo\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Music      \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/runtime\/music\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e DataBus    \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/databus\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ctx   = canvas.getContext(\x3cspan class=\x22hljs-string\x22\x3e\x272d\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e databus = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e DataBus()\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 游戏主函数\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMain\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.restart()\n  }\n\n  restart() {\n    databus.reset()\n\n    canvas.removeEventListener(\n      \x3cspan class=\x22hljs-string\x22\x3e\x27touchstart\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchHandler\n    )\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bg       = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e BackGround(ctx)\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.player   = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Player(ctx)\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.gameinfo = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e GameInfo()\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.music    = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Music()\n\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.requestAnimationFrame(\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.loop.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e),\n      canvas\n    )\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 随着帧数变化的敌机生成逻辑\n   * 帧数取模定义成生成的频率\n   *\/\x3c\/span\x3e\n  enemyGenerate() {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( databus.frame % \x3cspan class=\x22hljs-number\x22\x3e30\x3c\/span\x3e === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ) {\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e enemy = databus.pool.getItemByClass(\x3cspan class=\x22hljs-string\x22\x3e\x27enemy\x27\x3c\/span\x3e, Enemy)\n      enemy.init(\x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e)\n      databus.enemys.push(enemy)\n    }\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 全局碰撞检测\x3c\/span\x3e\n  collisionDetection() {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e that = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n\n    databus.bullets.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ebullet\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e ( \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, il = databus.enemys.length; i \x26lt; il;i\x2b\x2b ) {\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e enemy = databus.enemys[i]\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( !enemy.isPlaying \x26amp;\x26amp; enemy.isCollideWith(bullet) ) {\n          enemy.playAnimation()\n          that.music.playExplosion()\n\n          bullet.visible = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n          databus.score  \x2b= \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\n          \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e\n        }\n      }\n    })\n\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e ( \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, il = databus.enemys.length; i \x26lt; il;i\x2b\x2b ) {\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e enemy = databus.enemys[i]\n\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.player.isCollideWith(enemy) ) {\n        databus.gameOver = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e\n      }\n    }\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/游戏结束后的触摸事件处理逻辑\x3c\/span\x3e\n  touchEventHandler(e) {\n    e.preventDefault()\n\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e x = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientX\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e y = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientY\n\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e area = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.gameinfo.btnArea\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (   x \x26gt;= area.startX\n        \x26amp;\x26amp; x \x26lt;= area.endX\n        \x26amp;\x26amp; y \x26gt;= area.startY\n        \x26amp;\x26amp; y \x26lt;= area.endY  )\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.restart()\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/**\n     * canvas重绘函数\n     * 每一帧重新绘制所有的需要展示的元素\n     *\/\x3c\/span\x3e\n    render() {\n    ctx.clearRect(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, canvas.width, canvas.height)\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bg.render(ctx)\n\n    databus.bullets\n           .concat(databus.enemys)\n           .forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n              item.drawToCanvas(ctx)\n            })\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.player.drawToCanvas(ctx)\n\n    databus.animations.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eani\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( ani.isPlaying ) {\n        ani.aniRender(ctx)\n      }\n    })\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.gameinfo.renderGameScore(ctx, databus.score)\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 游戏逻辑更新主函数\x3c\/span\x3e\n  update() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bg.update()\n\n    databus.bullets\n           .concat(databus.enemys)\n           .forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n              item.update()\n            })\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.enemyGenerate()\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.collisionDetection()\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实现游戏帧循环\x3c\/span\x3e\n  loop() {\n    databus.frame\x2b\x2b\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.update()\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.render()\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( databus.frame % \x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.player.shoot()\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.music.playShoot()\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 游戏结束停止帧循环\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( databus.gameOver ) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.gameinfo.renderGameOver(ctx, databus.score)\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchHandler = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchEventHandler.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n      canvas.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27touchstart\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touchHandler)\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n    }\n\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.requestAnimationFrame(\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.loop.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e),\n      canvas\n    )\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\n\x3cli\x3e导入了创建游戏需要的我放飞机，敌方飞机，背景，游戏信息，音乐，游戏全局数据类，并获取了canvas的上下文（看到这是不是有一个疑惑，canvas到底是从哪里定义？先带着这个问题最后再说），创建了一个全局数据实例（后面会提到）。\x3c\/li\x3e\n\x3cli\x3e创建Main的实例自然会调用构造方法，在构造方法中调用restart函数，进行了游戏的初始化并进行循环刷帧（\x3ccode\x3erequestAnimationFrame\x3c\/code\x3e看起来是不是很亲切）。\x3c\/li\x3e\n\x3cli\x3eloop函数中我们可以看到主要调用了update, render方法，并设置了player发射子弹的时间，对游戏是否结束进行判断，最后接着刷帧。\x3c\/li\x3e\n\x3cli\x3eupdate方法会调用各个场景内对象的update方法来更新他们的位置以及其他信息。\x3c\/li\x3e\n\x3cli\x3erender方法会调用各个场景内对象的render方法来将他们绘制到canvas中。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3eMain内结构清晰，主要理解整个流程就是调用\x3ccode\x3erequestAnimationFrame\x3c\/code\x3e来不停地刷帧更新位置信息推动所有对象运动，每个对象在每一帧都有新的位置，连起来就是动画了。分清位置的更新与对象的绘制是关键。\x3c\/blockquote\x3e\n\x3ch5\x3edatabus.js\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import Pool from \x27.\/base\/pool\x27\n\nlet instance\n\n\/**\n * 全局状态管理器\n *\/\nexport default class DataBus {\n  constructor() {\n    if ( instance )\n      return instance\n\n    instance = this\n\n    this.pool = new Pool()\n\n    this.reset()\n  }\n\n  reset() {\n    this.frame      = 0\n    this.score      = 0\n    this.bullets    = []\n    this.enemys     = []\n    this.animations = []\n    this.gameOver   = false\n  }\n\n  \/**\n   * 回收敌人，进入对象池\n   * 此后不进入帧循环\n   *\/\n  removeEnemey(enemy) {\n    let temp = this.enemys.shift()\n\n    temp.visible = false\n\n    this.pool.recover(\x27enemy\x27, enemy)\n  }\n\n  \/**\n   * 回收子弹，进入对象池\n   * 此后不进入帧循环\n   *\/\n  removeBullets(bullet) {\n    let temp = this.bullets.shift()\n\n    temp.visible = false\n\n    this.pool.recover(\x27bullet\x27, bullet)\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Pool \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/base\/pool\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e instance\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 全局状态管理器\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eDataBus\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e() {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( instance )\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e instance\n\n    instance = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.pool = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Pool()\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.reset()\n  }\n\n  reset() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.frame      = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.score      = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bullets    = []\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.enemys     = []\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.animations = []\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.gameOver   = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 回收敌人，进入对象池\n   * 此后不进入帧循环\n   *\/\x3c\/span\x3e\n  removeEnemey(enemy) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e temp = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.enemys.shift()\n\n    temp.visible = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.pool.recover(\x3cspan class=\x22hljs-string\x22\x3e\x27enemy\x27\x3c\/span\x3e, enemy)\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 回收子弹，进入对象池\n   * 此后不进入帧循环\n   *\/\x3c\/span\x3e\n  removeBullets(bullet) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e temp = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bullets.shift()\n\n    temp.visible = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.pool.recover(\x3cspan class=\x22hljs-string\x22\x3e\x27bullet\x27\x3c\/span\x3e, bullet)\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\n\x3cli\x3e我们可以看出，databus是一个单例对象，不论在其他代码中new多少次，都是返回的同一个实例，符合我们的期望。\x3c\/li\x3e\n\x3cli\x3ereset定义了所需要的数据源并初始化\x3c\/li\x3e\n\x3cli\x3e通过一个对象池的概念，控制当前页面对象的数量，避免使用js原有的垃圾处理机制，而是通过对象池来复用已经创建的对象，算是一个性能优化。\x3c\/li\x3e\n\x3cli\x3eframe属性主要是用来刷帧的时候用来控制子弹的发射与敌机的出现时间。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch5\x3esprite.js\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 游戏基础的精灵类\n *\/\nexport default class Sprite {\n  constructor(imgSrc = \x27\x27, width=  0, height = 0, x = 0, y = 0) {\n    this.img     = new Image()\n    this.img.src = imgSrc\n\n    this.width  = width\n    this.height = height\n\n    this.x = x\n    this.y = y\n\n    this.visible = true\n  }\n\n  \/**\n   * 将精灵图绘制在canvas上\n   *\/\n  drawToCanvas(ctx) {\n    if ( !this.visible )\n      return\n\n    ctx.drawImage(\n      this.img,\n      this.x,\n      this.y,\n      this.width,\n      this.height\n    )\n  }\n\n  \/**\n   * 简单的碰撞检测定义：\n   * 另一个精灵的中心点处于本精灵所在的矩形内即可\n   * @param{Sprite} sp: Sptite的实例\n   *\/\n  isCollideWith(sp) {\n    let spX = sp.x \x2b sp.width \/ 2\n    let spY = sp.y \x2b sp.height \/ 2\n\n    if ( !this.visible || !sp.visible )\n      return false\n\n    return !!(   spX \x3e= this.x\n              \x26amp;\x26amp; spX \x3c= this.x \x2b this.width\n              \x26amp;\x26amp; spY \x3e= this.y\n              \x26amp;\x26amp; spY \x3c= this.y \x2b this.height  )\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 游戏基础的精灵类\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSprite\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(imgSrc = \x27\x27, width=  0, height = 0, x = 0, y = 0) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.img     = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Image()\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.img.src = imgSrc\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.width  = width\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.height = height\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.x = x\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.y = y\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.visible = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 将精灵图绘制在canvas上\n   *\/\x3c\/span\x3e\n  drawToCanvas(ctx) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( !\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.visible )\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n\n    ctx.drawImage(\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.img,\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.x,\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.y,\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.width,\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.height\n    )\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 简单的碰撞检测定义：\n   * 另一个精灵的中心点处于本精灵所在的矩形内即可\n   * @param{Sprite} sp: Sptite的实例\n   *\/\x3c\/span\x3e\n  isCollideWith(sp) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e spX = sp.x \x2b sp.width \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e spY = sp.y \x2b sp.height \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( !\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.visible || !sp.visible )\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e !!(   spX \x26gt;= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.x\n              \x26amp;\x26amp; spX \x26lt;= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.x \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.width\n              \x26amp;\x26amp; spY \x26gt;= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.y\n              \x26amp;\x26amp; spY \x26lt;= \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.y \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.height  )\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\n\x3cli\x3e作为所有场景对象的基类，定义了所有精灵对象基本有的信息（位置，图片，是否可见）\x3c\/li\x3e\n\x3cli\x3e定义了两种能力，检测碰撞与将自己绘制在canvas上\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3e可以看出画图主要是用的canvas里的drawImage方法，也是我们自行开发小游戏以后会用到的方法。包括background,player等类都会继承自精灵类，并且会添加自己的update方法来暴露更新自己位置信息的接口。enermy还会包装一层爆炸动画的封装，思路大同小异，就不在多赘述了。\x3c\/blockquote\x3e\n\x3ch4\x3e3.结论\x3c\/h4\x3e\n\x3col\x3e\n\x3cli\x3e我们发现小游戏的开发与我们使用canvas进行h5小游戏的开发并没有什么太大的区别，无论从绘图的api还是事件的api都十分相似，还可以用window对象，这主要归功于官方提供的\x3ccode\x3ewebapp-adapter.js\x3c\/code\x3e，该js会注入window对象并提供相应的canvas全局变量，也是文章中提到为什么在main.js里找不到canvas变量在哪里定义的原因了。所以我们可以开开心心地使用canvas来开发小游戏了！！！\x3c\/li\x3e\n\x3cli\x3e官方还说了一句，可以不引入\x3ccode\x3ewebapp-adapter.js\x3c\/code\x3e来开发小游戏，（\x3ca href=\x22https:\/\/mp.weixin.qq.com\/debug\/wxagame\/dev\/document\/render\/canvas\/wx.createCanvas.html?t=20171229\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/mp.weixin.qq.com\/debu...\x3c\/a\x3e）这是小游戏的api文档（当时找了很久）适配器的源码写得也很清晰，可以一读来了解一些，其中也有很多官方写的TODO的事情，还并不十分完善，如果想要快速移植已有的h5游戏代码使用适配器是很有效的。如果想直接开发小游戏根据api文档直接来开发也是很有效的方法，毕竟引入一层适配器还是会有一定的开销。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3etips: 读一读适配器源码也有利于了解如何开发小程序(例如事件绑定之类的操作)\x3c\/p\x3e\n\x3ch4\x3e4.结语\x3c\/h4\x3e\n\x3cp\x3e小程序终于可以来做小游戏了，感觉还是休闲类的游戏会占主导地位，前端大大可以迎接新的战场啦哈哈哈~~~（接下来会去掉适配器用原生api改写官方demo）\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e12.30更新\x3c\/p\x3e\n\x3ch4\x3e5.无适配器版的官方demo\x3c\/h4\x3e\n\x3cp\x3e通过之前的源码分析，我们只能找到使用适配器版本的官方Demo，而找不到一个无适配器版本的官方Demo，于是自己动手丰衣足食，将官方Demo的适配器移除，下面介绍需要进行哪些改动。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3cp\x3e首先对适配器的源码简单阅读后可以发现，适配器做的事情就是模拟了window对象，然后将window对象按devtool和小程序运行的实际环境暴露给全局对象，供我们来使用（devtool里就是window，实际环境中则是GameGlobal）。那么相应我们就该把所有引用到window的地方都进行修改，因为实际运行环境中并没有这个全局对象。下面我主要说明在源代码中使用到window的地方。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e我移除了\x3ccode\x3elibs\/symbol.js\x3c\/code\x3e，改为直接使用原生支持的symbol来模拟私有变量，其他文件只需删除对该文件的引入即可。\x3c\/li\x3e\n\x3cli\x3e查找各文件使用的\x3ccode\x3ewindow.innerHeight\x3c\/code\x3e与\x3ccode\x3ewindow.innerWidth\x3c\/code\x3e 改为使用 \x3ccode\x3econst { screenWidth, screenHeight, devicePixelRatio } = wx.getSystemInfoSync()\x3c\/code\x3e来获取屏幕宽高与dpr，并在相应地方进行替换。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e音频文件处理\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\n\x3cp\x3e主要是\x3ccode\x3eruntime\/music.js\x3c\/code\x3e里与小游戏api的转化，主要是将 \x3ccode\x3enew Audio()\x3c\/code\x3e转化为\x3ccode\x3ewx.createInnerAudioContext()\x3c\/code\x3e方法获取实例和\x3ccode\x3ecurrentTime\x3c\/code\x3e在原生是一个只读属性，要改为\x3ccode\x3eseek\x3c\/code\x3e方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let instance\n\nexport default class Music {\n  constructor() {\n    if ( instance )\n      return instance\n\n    instance = this\n\n    \/\/ this.bgmAudio = new Audio()\n    this.bgmAudio      = wx.createInnerAudioContext()\n    this.bgmAudio.loop = true\n    this.bgmAudio.src  = \x27audio\/bgm.mp3\x27\n\n    \/\/ this.shootAudio     = new Audio()\n    this.bgmAudio      = wx.createInnerAudioContext()\n    this.shootAudio.src = \x27audio\/bullet.mp3\x27\n\n    \/\/ this.boomAudio     = new Audio()\n    this.bgmAudio      = wx.createInnerAudioContext()\n    this.boomAudio.src = \x27audio\/boom.mp3\x27\n\n    this.playBgm()\n  }\n\n  playBgm() {\n    this.bgmAudio.play()\n  }\n\n  playShoot() {\n    \/\/ this.shootAudio.currentTime = 0\n    this.boomAudio.seek(0)\n    this.shootAudio.play()\n  }\n\n  playExplosion() {\n    \/\/ this.boomAudio.currentTime = 0\n    this.boomAudio.seek(0)\n    this.boomAudio.play()\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e instance\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMusic\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e() {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( instance )\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e instance\n\n    instance = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ this.bgmAudio = new Audio()\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bgmAudio      = wx.createInnerAudioContext()\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bgmAudio.loop = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bgmAudio.src  = \x3cspan class=\x22hljs-string\x22\x3e\x27audio\/bgm.mp3\x27\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ this.shootAudio     = new Audio()\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bgmAudio      = wx.createInnerAudioContext()\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.shootAudio.src = \x3cspan class=\x22hljs-string\x22\x3e\x27audio\/bullet.mp3\x27\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ this.boomAudio     = new Audio()\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bgmAudio      = wx.createInnerAudioContext()\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.boomAudio.src = \x3cspan class=\x22hljs-string\x22\x3e\x27audio\/boom.mp3\x27\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.playBgm()\n  }\n\n  playBgm() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bgmAudio.play()\n  }\n\n  playShoot() {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ this.shootAudio.currentTime = 0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.boomAudio.seek(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.shootAudio.play()\n  }\n\n  playExplosion() {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ this.boomAudio.currentTime = 0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.boomAudio.seek(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.boomAudio.play()\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e图片文件的处理\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e与音频文件类似，将\x3ccode\x3enew Image()\x3c\/code\x3e替换为\x3ccode\x3ewx.createImage()\x3c\/code\x3e获取实例即可\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3ecanvas对象处理\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\n\x3cp\x3e因为需要全局暴露，所以我们把canvas归于到Databus全局管理中去，使用\x3ccode\x3ewx.createCanvas()\x3c\/code\x3e获取全局canvas对象\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  export default class DataBus {\n    constructor() {\n    if ( instance )\n      return instance\n\n    instance = this\n\n    this.pool = new Pool()\n    this.canvas = wx.createCanvas()\n    this.reset()\n  }\n }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  \x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eDataBus\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e() {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( instance )\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e instance\n\n    instance = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.pool = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Pool()\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.canvas = wx.createCanvas()\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.reset()\n  }\n }\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e事件机制\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\n\x3cp\x3e\x3ccode\x3ecanvas\x3c\/code\x3e对象没有\x3ccode\x3eaddEventListener\x3c\/code\x3e之类的方法，同理BOM和DOM对象都没有，所以需要用微信的api来处理事件，demo里则是换为\x3ccode\x3ewx.onTouchStart()\x3c\/code\x3e \x3ccode\x3ewx.onTouchMove()\x3c\/code\x3e \x3ccode\x3ewx.onTouchEnd()\x3c\/code\x3e替换先有的方法。（注意main.js里也有需要替换的，原理一样，不赘述了）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ player\/index.js\ninitEvent() {\nwx.onTouchStart(((e) =\x3e {\n  let x = e.touches[0].clientX\n  let y = e.touches[0].clientY\n\n  \/\/\n  if (this.checkIsFingerOnAir(x, y)) {\n    this.touched = true\n\n    this.setAirPosAcrossFingerPosZ(x, y)\n  }\n\n}).bind(this))\nwx.onTouchMove(((e) =\x3e {\n\n  let x = e.touches[0].clientX\n  let y = e.touches[0].clientY\n\n  if (this.touched)\n    this.setAirPosAcrossFingerPosZ(x, y)\n\n}).bind(this))\n\nwx.onTouchEnd(((e) =\x3e {\n  this.touched = false\n}).bind(this))\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ player\/index.js\x3c\/span\x3e\ninitEvent() {\nwx.onTouchStart(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e(e\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e x = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientX\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e y = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientY\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.checkIsFingerOnAir(x, y)) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touched = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setAirPosAcrossFingerPosZ(x, y)\n  }\n\n}).bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e))\nwx.onTouchMove(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e(e\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e x = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientX\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e y = e.touches[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].clientY\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touched)\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setAirPosAcrossFingerPosZ(x, y)\n\n}).bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e))\n\nwx.onTouchEnd(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e(e\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.touched = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n}).bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e))\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3erequestAnimationFrame\x3c\/code\x3e方法\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e去掉前面的\x3ccode\x3ewindow\x3c\/code\x3e就可以了，全局对象里已经支持，\x3ccode\x3esetInterval\x3c\/code\x3e一样\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e至此我们已经完成了移除适配器，可以在一个极简的条件下开发我们的小游戏了！！\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>微信小游戏初体验</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012646888">https://segmentfault.com/a/1190000012646888</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/smttpu2k0xk/" target="_blank">https://alili.tech/archive/smttpu2k0xk/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>