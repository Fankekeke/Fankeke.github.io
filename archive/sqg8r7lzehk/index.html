<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="基于html2canvas实现网页保存为图片及图片清晰度优化"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>基于html2canvas实现网页保存为图片及图片清晰度优化 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/sqg8r7lzehk/",
				"appid": "1613049289050283", 
				"title": "基于html2canvas实现网页保存为图片及图片清晰度优化 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-29T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/cyf40cywhd/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/z1s3jxecrpf/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fsqg8r7lzehk%2f&text=%e5%9f%ba%e4%ba%8ehtml2canvas%e5%ae%9e%e7%8e%b0%e7%bd%91%e9%a1%b5%e4%bf%9d%e5%ad%98%e4%b8%ba%e5%9b%be%e7%89%87%e5%8f%8a%e5%9b%be%e7%89%87%e6%b8%85%e6%99%b0%e5%ba%a6%e4%bc%98%e5%8c%96"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fsqg8r7lzehk%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fsqg8r7lzehk%2f&text=%e5%9f%ba%e4%ba%8ehtml2canvas%e5%ae%9e%e7%8e%b0%e7%bd%91%e9%a1%b5%e4%bf%9d%e5%ad%98%e4%b8%ba%e5%9b%be%e7%89%87%e5%8f%8a%e5%9b%be%e7%89%87%e6%b8%85%e6%99%b0%e5%ba%a6%e4%bc%98%e5%8c%96"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fsqg8r7lzehk%2f&title=%e5%9f%ba%e4%ba%8ehtml2canvas%e5%ae%9e%e7%8e%b0%e7%bd%91%e9%a1%b5%e4%bf%9d%e5%ad%98%e4%b8%ba%e5%9b%be%e7%89%87%e5%8f%8a%e5%9b%be%e7%89%87%e6%b8%85%e6%99%b0%e5%ba%a6%e4%bc%98%e5%8c%96"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fsqg8r7lzehk%2f&is_video=false&description=%e5%9f%ba%e4%ba%8ehtml2canvas%e5%ae%9e%e7%8e%b0%e7%bd%91%e9%a1%b5%e4%bf%9d%e5%ad%98%e4%b8%ba%e5%9b%be%e7%89%87%e5%8f%8a%e5%9b%be%e7%89%87%e6%b8%85%e6%99%b0%e5%ba%a6%e4%bc%98%e5%8c%96"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%9f%ba%e4%ba%8ehtml2canvas%e5%ae%9e%e7%8e%b0%e7%bd%91%e9%a1%b5%e4%bf%9d%e5%ad%98%e4%b8%ba%e5%9b%be%e7%89%87%e5%8f%8a%e5%9b%be%e7%89%87%e6%b8%85%e6%99%b0%e5%ba%a6%e4%bc%98%e5%8c%96&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fsqg8r7lzehk%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fsqg8r7lzehk%2f&title=%e5%9f%ba%e4%ba%8ehtml2canvas%e5%ae%9e%e7%8e%b0%e7%bd%91%e9%a1%b5%e4%bf%9d%e5%ad%98%e4%b8%ba%e5%9b%be%e7%89%87%e5%8f%8a%e5%9b%be%e7%89%87%e6%b8%85%e6%99%b0%e5%ba%a6%e4%bc%98%e5%8c%96"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsqg8r7lzehk%2f&title=%e5%9f%ba%e4%ba%8ehtml2canvas%e5%ae%9e%e7%8e%b0%e7%bd%91%e9%a1%b5%e4%bf%9d%e5%ad%98%e4%b8%ba%e5%9b%be%e7%89%87%e5%8f%8a%e5%9b%be%e7%89%87%e6%b8%85%e6%99%b0%e5%ba%a6%e4%bc%98%e5%8c%96"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsqg8r7lzehk%2f&title=%e5%9f%ba%e4%ba%8ehtml2canvas%e5%ae%9e%e7%8e%b0%e7%bd%91%e9%a1%b5%e4%bf%9d%e5%ad%98%e4%b8%ba%e5%9b%be%e7%89%87%e5%8f%8a%e5%9b%be%e7%89%87%e6%b8%85%e6%99%b0%e5%ba%a6%e4%bc%98%e5%8c%96"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsqg8r7lzehk%2f&title=%e5%9f%ba%e4%ba%8ehtml2canvas%e5%ae%9e%e7%8e%b0%e7%bd%91%e9%a1%b5%e4%bf%9d%e5%ad%98%e4%b8%ba%e5%9b%be%e7%89%87%e5%8f%8a%e5%9b%be%e7%89%87%e6%b8%85%e6%99%b0%e5%ba%a6%e4%bc%98%e5%8c%96"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">基于html2canvas实现网页保存为图片及图片清晰度优化</h1><div class="meta"><div class="postdate"><time datetime="2018-12-29" itemprop="datePublished">2018-12-29</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e本次技术调研来源于H5项目中的一个重要功能需求：实现\x3ccode\x3e微信长按网页保存为截图\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e这里有个栗子（请用微信打开，长按图片即可保存）：\x3ca href=\x22https:\/\/zt.igetget.com\/h5\/answer\/get\/?alias=ppg9Qow01khZlmJ2kl7L\x22 rel=\x22nofollow noreferrer\x22\x3e3分钟探索你的知识边界\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e将整个网页保存为图片是一个十分有趣的功能，常见于H5活动页的结尾页分享。以下则是项目中调研和踩坑的一些小结和汇总。\x3c\/p\x3e\n\x3chr\x3e\n\x3ch1\x3e一、实现HTML页面保存为图片\x3c\/h1\x3e\n\x3ch2\x3e1.1 已知可行方案\x3c\/h2\x3e\n\x3cp\x3e现有已知能够实现网页保存为图片的方案包括：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3e方案1\x3c\/strong\x3e：将DOM改写为canvas，然后利用canvas的toDataURL方法实现将DOM输出为包含图片展示的\x3ccode\x3edata URI\x3c\/code\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e方案2\x3c\/strong\x3e：使用\x3ccode\x3ehtml2canvas.js\x3c\/code\x3e实现（可选搭配\x3ccode\x3eCanvas2Image.js\x3c\/code\x3e实现网页保存为图片）\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e方案3\x3c\/strong\x3e：使用\x3ccode\x3erasterizeHTML.js\x3c\/code\x3e实现\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2\x3e1.2 解决方案的选择\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e\x3cstrong\x3e方案1\x3c\/strong\x3e：需要手动计算每个DOM元素的\x3ccode\x3eComputed Style\x3c\/code\x3e，然后需要计算好元素在canvas的大小位置等属性。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3e方案1难点\x3c\/code\x3e：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e相当于完全重写了整个页面的布局样式，增加了工作量。\x3c\/li\x3e\n\x3cli\x3e由于canvas中没有的对象概念，对于元素丰富、布局复杂的页面，不易重构。\x3c\/li\x3e\n\x3cli\x3e所有DOM元素改写进canvas会带来一些困难，例如：难以支持响应式，图片元素清晰度不佳和文字点击区域识别问题等。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e方案2\x3c\/strong\x3e：该类功能中Github上stars最多(至今仍在维护)，Stack Overflow亦有丰富的讨论。只需简单调用html2canvas方法并设定配置项即可。\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e方案3\x3c\/strong\x3e：该方案的限制较多，目前仅支持3类可转为canvas的目标格式: 页面url，html字符串和document对象。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3e小结\x3c\/code\x3e: \x3cstrong\x3ehtml2canvas\x3c\/strong\x3e是目前实现网页保存为图片功能的综合最佳选择。\x3c\/p\x3e\n\x3ch2\x3e1.3 html2canvas的使用方法\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e官方GitHub：\x3ca href=\x22https:\/\/github.com\/niklasvh\/html2canvas\x22 rel=\x22nofollow noreferrer\x22\x3ehttps:\/\/github.com\/niklasvh\/h...\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e以下描述针对html2canvas版本是\x3ccode\x3e0.5.0-beta4\x3c\/code\x3e\x3c\/p\x3e\n\x3ch3\x3e1.3.1 实现保存为图片的第一步：html转为canvas\x3c\/h3\x3e\n\x3cp\x3e基于\x3ccode\x3ehtml2canvas.js\x3c\/code\x3e可将一个元素渲染为canvas，只需要简单的调用\x3ccode\x3ehtml2canvas(element[, options]);\x3c\/code\x3e即可。下列\x3ccode\x3ehtml2canvas\x3c\/code\x3e方法会返回一个包含有\x3ccode\x3e\x26lt;canvas\x26gt;\x3c\/code\x3e元素的\x3ccode\x3epromise\x3c\/code\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22JavaScript\x22\x3ehtml2canvas(document.body).then(function(canvas) {\n    document.body.appendChild(canvas);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3\x3e1.3.2 实现保存为图片的第二步：canvas转image\x3c\/h3\x3e\n\x3cp\x3e上一步生成的canvas即为包含目标元素的\x3ccode\x3e\x26lt;canvas\x26gt;\x3c\/code\x3e元素对象。实现保存图片的目标只需要将canvas转image即可。\x3c\/p\x3e\n\x3cp\x3e这里的转换方案有\x3ccode\x3e2种\x3c\/code\x3e：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3e方案1\x3c\/strong\x3e：基于原生canvas的\x3ccode\x3etoDataURL\x3c\/code\x3e方法将canvas输出为\x3ccode\x3edata: URI\x3c\/code\x3e类型的图片地址，再将该图片地址赋值给\x3ccode\x3e\x26lt;image\x26gt;\x3c\/code\x3e元素的src属性即可\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e方案2\x3c\/strong\x3e：使用第三方库\x3ccode\x3eCanvas2Image.js\x3c\/code\x3e，调用其\x3ccode\x3econvertToImage\x3c\/code\x3e方法即可（\x3ca href=\x22https:\/\/github.com\/hongru\/canvas2image\x22 rel=\x22nofollow noreferrer\x22\x3eGitHub\x3c\/a\x3e）\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e实际上，\x3ccode\x3eCanvas2Image.js\x3c\/code\x3e也是基于\x3ccode\x3ecanvas.toDataURL\x3c\/code\x3e的封装，相比原生的canvas API对于转为图片的功能上考虑更为具体(未压缩的包大小为7.4KB)，适合项目使用。\x3c\/p\x3e\n\x3ch1\x3e二、生成图片的清晰度优化方案\x3c\/h1\x3e\n\x3ch2\x3e2.1 基础的清晰度优化方案\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e最终图片的清晰度\x3ccode\x3e取决于\x3c\/code\x3e第一步中html转换成的canvas的清晰度。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e现有解决方案\x3c\/strong\x3e参考；\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/yq.aliyun.com\/ziliao\/4416\x22 rel=\x22nofollow noreferrer\x22\x3ehtml5 canvas在高倍屏下变模糊的处理办法\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/segmentfault.com\/q\/1010000002391424\/a-1020000002391631\x22\x3ehtml5 canvas绘制图片模糊的问题\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e其\x3cstrong\x3e基本原理\x3c\/strong\x3e为：\x3cbr\x3e将\x3ccode\x3ecanvas\x3c\/code\x3e的属性\x3ccode\x3ewidth\x3c\/code\x3e和\x3ccode\x3eheight\x3c\/code\x3e属性放大为2倍（或者设置为\x3ccode\x3edevicePixelRatio\x3c\/code\x3e倍），最后将canvas的CSS样式width和height设置为原先1倍的大小。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e例如\x3c\/strong\x3e：希望在html中实际显示的\x3ccode\x3e\x26lt;canvas\x26gt;\x3c\/code\x3e宽高分别为\x3ccode\x3e160px\x3c\/code\x3e,\x3ccode\x3e90px\x3c\/code\x3e则可作如下设置\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22html\x22\x3e\x26lt;canvas width=\x22320\x22 height=\x22180\x22 style=\x22width:160px;height:90px;\x22\x26gt;\x26lt;\/canvas\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e参考上述文档具体的使用案例如下；\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22JavaScript\x22\x3econvert2canvas() {\n\n    var shareContent = YourTargetElem; \n    var width = shareContent.offsetWidth; \n    var height = shareContent.offsetHeight; \n    var canvas = document.createElement(\x22canvas\x22); \n    var scale = 2; \n\n    canvas.width = width * scale; \n    canvas.height = height * scale; \n    canvas.getContext(\x222d\x22).scale(scale, scale); \n\n    var opts = {\n        scale: scale, \n        canvas: canvas, \n        logging: true, \n        width: width, \n        height: height \n    };\n    html2canvas(shareContent, opts).then(function (canvas) {\n        var context = canvas.getContext(\x272d\x27);\n\n        var img = Canvas2Image.convertToImage(canvas, canvas.width, canvas.height);\n\n        document.body.appendChild(img);\n        $(img).css({\n            \x22width\x22: canvas.width \/ 2 \x2b \x22px\x22,\n            \x22height\x22: canvas.height \/ 2 \x2b \x22px\x22,\n        })\n    });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2\x3e2.2 进阶的清晰度优化方案\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e上述设置可以解决通常情况下图片不清晰的问题，不过探索并没有结束。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e实际在\x3ca\x3e我们的项目\x3c\/a\x3e中，即使作出\x3ccode\x3e2.1节\x3c\/code\x3e的设置后，大果粒一般的渲染结果依然尴尬。\x3c\/p\x3e\n\x3cp\x3e下面直接给出3条进一步的优化策略：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e更改\x3ccode\x3e百分比布局\x3c\/code\x3e为\x3ccode\x3epx布局\x3c\/code\x3e（如果原先是百分比布局的话）\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3e关闭\x3c\/code\x3ecanvas默认的\x3ccode\x3e抗锯齿设\x3c\/code\x3e置\x3c\/li\x3e\n\x3cli\x3e设置模糊元素的\x3ccode\x3ewidth\x3c\/code\x3e和\x3ccode\x3eheight\x3c\/code\x3e为素材原有宽高，然后通过\x3ccode\x3etransform: scale\x3c\/code\x3e进行缩放。这里\x3ccode\x3escale\x3c\/code\x3e的数值由具体需求决定。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3e\x3cp\x3e基本原理\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3col\x3e\n\x3cli\x3e如果原来使用百分比设置元素宽高，请更改为\x3ccode\x3epx为单位\x3c\/code\x3e的宽高，避免样式二次计算导致的模糊\x3c\/li\x3e\n\x3cli\x3e默认情况下，canvas的抗锯齿是开启的，需要\x3ccode\x3e关闭抗锯齿\x3c\/code\x3e来实现图像的锐化(\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/CanvasRenderingContext2D\/imageSmoothingEnabled\x22 rel=\x22nofollow noreferrer\x22\x3eMDN: imageSmoothingEnabled\x3c\/a\x3e )\x3c\/li\x3e\n\x3cli\x3e除了canvas可以通过扩大2倍宽高然后缩放至原有宽高来提高清晰度，对于DOM中其他的元素也可以使用\x3ccode\x3ecss样式\x3c\/code\x3e的\x3ccode\x3escale\x3c\/code\x3e来实现同样的缩放\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3e\x3cp\x3e例: html2canvas配置\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cpre\x3e\x3ccode class=\x22JavaScript\x22\x3econvert2canvas() {\n\n    var cntElem = $(\x27#j-sec-end\x27)[0];\n\n    var shareContent = cntElem;\/\/需要截图的包裹的（原生的）DOM 对象\n    var width = shareContent.offsetWidth; \/\/获取dom 宽度\n    var height = shareContent.offsetHeight; \/\/获取dom 高度\n    var canvas = document.createElement(\x22canvas\x22); \/\/创建一个canvas节点\n    var scale = 2; \/\/定义任意放大倍数 支持小数\n    canvas.width = width * scale; \/\/定义canvas 宽度 * 缩放\n    canvas.height = height * scale; \/\/定义canvas高度 *缩放\n    canvas.getContext(\x222d\x22).scale(scale, scale); \/\/获取context,设置scale \n    var opts = {\n        scale: scale, \/\/ 添加的scale 参数\n        canvas: canvas, \/\/自定义 canvas\n        \/\/ logging: true, \/\/日志开关，便于查看html2canvas的内部执行流程\n        width: width, \/\/dom 原始宽度\n        height: height,\n        useCORS: true \/\/ 【重要】开启跨域配置\n    };\n\n    html2canvas(shareContent, opts).then(function (canvas) {\n\n        var context = canvas.getContext(\x272d\x27);\n        \/\/ 【重要】关闭抗锯齿\n        context.mozImageSmoothingEnabled = false;\n        context.webkitImageSmoothingEnabled = false;\n        context.msImageSmoothingEnabled = false;\n        context.imageSmoothingEnabled = false;\n        \n        \/\/ 【重要】默认转化的格式为png,也可设置为其他格式\n        var img = Canvas2Image.convertToJPEG(canvas, canvas.width, canvas.height);\n\n        document.body.appendChild(img);\n\n        $(img).css({\n            \x22width\x22: canvas.width \/ 2 \x2b \x22px\x22,\n            \x22height\x22: canvas.height \/ 2 \x2b \x22px\x22,\n        }).addClass(\x27f-full\x27);\n\n    });\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e例: DOM元素样式：\u2028\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cpre\x3e\x3ccode class=\x22css\x22\x3e.targetElem {width: 54px;height: 142px;margin-top:2px;margin-left:17px;transform: scale(0.5)}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1\x3e三、含有跨域图片的配置\x3c\/h1\x3e\n\x3cp\x3e由于canvas对于图片资源的\x3ccode\x3e同源限制\x3c\/code\x3e，如果画布中包含跨域的图片资源则会污染画布，造成生成图片样式混乱或者html2canvas方法不执行等问题。\x3c\/p\x3e\n\x3cp\x3e以下主要解决\x3cstrong\x3e两类跨域的图片资源\x3c\/strong\x3e：包括已配置过CORS的\x3ccode\x3eCDN\x3c\/code\x3e中的图片资源和\x3ccode\x3e微信用户头像\x3c\/code\x3e图片资源。\x3c\/p\x3e\n\x3ch2\x3e3.1 针对CDN中的图片的配置\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e要求CDN的图片配置好\x3ccode\x3eCORS\x3c\/code\x3e。\x3ccode\x3eCDN\x3c\/code\x3e配置好后，通过chrome开发者工具可以看到响应头中应含有\x3ccode\x3eAccess-Control-Allow-Origin\x3c\/code\x3e的字段。\x3c\/li\x3e\n\x3cli\x3e开启\x3ccode\x3ehtml2canvas\x3c\/code\x3e的\x3ccode\x3euseCORS\x3c\/code\x3e\x3ca href=\x22http:\/\/html2canvas.hertzen.com\/documentation.html\x22 rel=\x22nofollow noreferrer\x22\x3e配置项\x3c\/a\x3e。即作如下设置：\u2028\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cpre\x3e\x3ccode class=\x22JavaScript\x22\x3evar opts = {useCORS: true};\n\nhtml2canvas(element, opts);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3e注意\x3c\/code\x3e：\x3cbr\x3e如果没有开启\x3ccode\x3ehtml2canvas\x3c\/code\x3e的\x3ccode\x3euseCORS\x3c\/code\x3e配置项，\x3ccode\x3ehtml2canvas\x3c\/code\x3e会正常执行且不会报错，但是不会输出对应的CDN图片\x3cbr\x3e（已测试同时包含\x3ccode\x3eCDN的图片\x3c\/code\x3e和\x3ccode\x3e本地图片\x3c\/code\x3e的资源的页面，但是只有\x3ccode\x3e本地图片\x3c\/code\x3e能够被正常渲染出来）\x3c\/p\x3e\n\x3ch2\x3e3.2 针对微信用户头像的配置\x3c\/h2\x3e\n\x3cp\x3e如果需要将\x3ccode\x3e微信\x3c\/code\x3e平台中的用户头像一并保存为图片，\x3ccode\x3e3.1\x3c\/code\x3e的方案无能为力。可通过配置服务端\x3ccode\x3e代理转发\x3c\/code\x3e(forward)实现，此处不赘述。\x3c\/p\x3e\n\x3ch2\x3e其他注意事项\x3c\/h2\x3e\n\x3ch4\x3e1. margin的遮挡问题\x3c\/h4\x3e\n\x3cp\x3e微信中，唤出\x3ccode\x3e长按保存图片\x3c\/code\x3e的菜单要求长按的对象直接是\x3ccode\x3e\x26lt;image\x26gt;\x3c\/code\x3e元素，如果\x3ccode\x3e\x26lt;image\x26gt;\x3c\/code\x3e元素上方存在遮挡，则不会唤出菜单。\x3cbr\x3e而事实上，引发遮挡的并不只是非\x3ccode\x3e\x26lt;image\x26gt;\x3c\/code\x3e元素，还可能是\x3ccode\x3emargin\x3c\/code\x3e属性。例如：若在页面底部，对一个绝对定位的元素设置了数值很大的\x3ccode\x3emargin-top\x3c\/code\x3e，则\x3ccode\x3emargin-top\x3c\/code\x3e所涉及的区域，均无法长按唤出菜单。解决方案：将\x3ccode\x3emargin-top\x3c\/code\x3e改用为\x3ccode\x3etop\x3c\/code\x3e即可。\x3c\/p\x3e\n\x3ch4\x3e2. 安卓版微信保存图片失败的问题\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3ecanvas2img\x3c\/code\x3e默认保存图片的格式为\x3ccode\x3epng\x3c\/code\x3e，而在安卓版微信中所生成的图片尽管能长按唤出保存图片的菜单，但是\x3cstrong\x3e无法正确保存到本地相册\x3c\/strong\x3e。 \x3ccode\x3e解决方案\x3c\/code\x3e：设置\x3ccode\x3ecanvas2img\x3c\/code\x3e的生成图片格式配置项为\x3ccode\x3ejpeg\x3c\/code\x3e即可。\x3c\/p\x3e\n\x3ch4\x3e3. JPEG的黑屏问题\x3c\/h4\x3e\n\x3cp\x3e设置\x3ccode\x3ecanvas2img\x3c\/code\x3e输出格式为\x3ccode\x3ejpeg\x3c\/code\x3e，会有一定几率导致生成的图片包含大量的黑色块。\x3ccode\x3e可能的解决方案\x3c\/code\x3e：缩减部分图片元素的体积和尺寸大小。\x3c\/p\x3e\n\x3ch4\x3e4. 不能保留动效\x3c\/h4\x3e\n\x3cp\x3e在图片的\x3ccode\x3e转化前\x3c\/code\x3e，必须\x3ccode\x3e停止\x3c\/code\x3e或者删除动效后才能正确渲染出图片，否则生成的图片是破裂的。\x3c\/p\x3e\n\x3ch2\x3e参考文献\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/CanvasRenderingContext2D\/drawImage\x22 rel=\x22nofollow noreferrer\x22\x3eCanvasRenderingContext2D.drawImage()\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/niklasvh\/html2canvas\/pull\/1087\x22 rel=\x22nofollow noreferrer\x22\x3eAdd dpi\/scale options for custom resolution\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/HTMLCanvasElement\/toDataURL\x22 rel=\x22nofollow noreferrer\x22\x3eHTMLCanvasElement.toDataURL()\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/yq.aliyun.com\/ziliao\/4416\x22 rel=\x22nofollow noreferrer\x22\x3ehtml5 canvas在高倍屏下变模糊的处理办法\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/blog.csdn.net\/sophia1010\/article\/details\/52945542\x22 rel=\x22nofollow noreferrer\x22\x3eCanvas实现保存图片到本地\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/yq.aliyun.com\/wenzhang\/show_27647\x22 rel=\x22nofollow noreferrer\x22\x3ehtml2canvas截图如何解决跨域的问题\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>基于html2canvas实现网页保存为图片及图片清晰度优化</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011478657">https://segmentfault.com/a/1190000011478657</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/sqg8r7lzehk/" target="_blank">https://alili.tech/archive/sqg8r7lzehk/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>