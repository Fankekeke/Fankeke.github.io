<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Redux进阶系列2: 如何合理地设计Redux的State"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Redux进阶系列2: 如何合理地设计Redux的State | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/sui3wxfr0z/",
				"appid": "1613049289050283", 
				"title": "Redux进阶系列2: 如何合理地设计Redux的State | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-03T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ukdcbcsjhmh/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/4ndfffsgc6j/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fsui3wxfr0z%2f&text=Redux%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%972%3a%20%e5%a6%82%e4%bd%95%e5%90%88%e7%90%86%e5%9c%b0%e8%ae%be%e8%ae%a1Redux%e7%9a%84State"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fsui3wxfr0z%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fsui3wxfr0z%2f&text=Redux%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%972%3a%20%e5%a6%82%e4%bd%95%e5%90%88%e7%90%86%e5%9c%b0%e8%ae%be%e8%ae%a1Redux%e7%9a%84State"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fsui3wxfr0z%2f&title=Redux%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%972%3a%20%e5%a6%82%e4%bd%95%e5%90%88%e7%90%86%e5%9c%b0%e8%ae%be%e8%ae%a1Redux%e7%9a%84State"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fsui3wxfr0z%2f&is_video=false&description=Redux%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%972%3a%20%e5%a6%82%e4%bd%95%e5%90%88%e7%90%86%e5%9c%b0%e8%ae%be%e8%ae%a1Redux%e7%9a%84State"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Redux%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%972%3a%20%e5%a6%82%e4%bd%95%e5%90%88%e7%90%86%e5%9c%b0%e8%ae%be%e8%ae%a1Redux%e7%9a%84State&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fsui3wxfr0z%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fsui3wxfr0z%2f&title=Redux%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%972%3a%20%e5%a6%82%e4%bd%95%e5%90%88%e7%90%86%e5%9c%b0%e8%ae%be%e8%ae%a1Redux%e7%9a%84State"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsui3wxfr0z%2f&title=Redux%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%972%3a%20%e5%a6%82%e4%bd%95%e5%90%88%e7%90%86%e5%9c%b0%e8%ae%be%e8%ae%a1Redux%e7%9a%84State"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsui3wxfr0z%2f&title=Redux%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%972%3a%20%e5%a6%82%e4%bd%95%e5%90%88%e7%90%86%e5%9c%b0%e8%ae%be%e8%ae%a1Redux%e7%9a%84State"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fsui3wxfr0z%2f&title=Redux%e8%bf%9b%e9%98%b6%e7%b3%bb%e5%88%972%3a%20%e5%a6%82%e4%bd%95%e5%90%88%e7%90%86%e5%9c%b0%e8%ae%be%e8%ae%a1Redux%e7%9a%84State"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Redux进阶系列2: 如何合理地设计Redux的State</h1><div class="meta"><div class="postdate"><time datetime="2019-01-03" itemprop="datePublished">2019-01-03</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3eRedux是一个非常流行的状态管理解决方案，Redux应用执行过程中的任何一个时刻，都是一个状态的反映。可以说，State 驱动了Redux逻辑的运转。设计一个好的State并非易事，本文先从设计State时最容易犯的两个错误开始介绍，然后引出如何合理地设计State。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e错误1：以API为设计State的依据\x3c\/h3\x3e\n\x3cp\x3e以API为设计State的依据，往往是一个API对应一个子State，State的结构同API返回的数据结构保持一致（或接近一致）。例如，一个博客应用，\x3ccode\x3e\/posts\x3c\/code\x3e接口返回博客列表，返回的数据结构如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n  {\n    \x26quot;id\x26quot;: 1,\n    \x26quot;title\x26quot;: \x26quot;Blog Title\x26quot;,\n    \x26quot;create_time\x26quot;: \x26quot;2017-01-10T23:07:43.248Z\x26quot;,\n    \x26quot;author\x26quot;: {\n      \x26quot;id\x26quot;: 81,\n      \x26quot;name\x26quot;: \x26quot;Mr Shelby\x26quot;\n    }\n  }\n  ...\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs json\x22\x3e\x3ccode\x3e[\n  {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22title\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Blog Title\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22create_time\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222017-01-10T23:07:43.248Z\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e81\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Mr Shelby\x22\x3c\/span\x3e\n    }\n  }\n  ...\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们还需要查看一篇博客的详情，假设通过接口\x3ccode\x3e\/posts\/{id}\x3c\/code\x3e获取博客详情，通过接口\x3ccode\x3e\/posts\/{id}\/comments\x3c\/code\x3e获取博客的评论，返回的数据结构如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    \x26quot;id\x26quot;: 1,\n    \x26quot;title\x26quot;: \x26quot;Blog Title\x26quot;,\n    \x26quot;create_time\x26quot;: \x26quot;2017-01-10T23:07:43.248Z\x26quot;,\n    \x26quot;author\x26quot;: {\n      \x26quot;id\x26quot;: 81,\n      \x26quot;name\x26quot;: \x26quot;Mr Shelby\x26quot;\n    },\n    \x26quot;content\x26quot;: \x26quot;Some really short blog content. \x26quot;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs json\x22\x3e\x3ccode\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22title\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Blog Title\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22create_time\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222017-01-10T23:07:43.248Z\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e81\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Mr Shelby\x22\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22content\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Some really short blog content. \x22\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n  {\n    \x26quot;id\x26quot;: 41,\n    \x26quot;author\x26quot;: \x26quot;Jack\x26quot;,\n    \x26quot;create_time\x26quot;: \x26quot;2017-01-11T23:07:43.248Z\x26quot;,\n    \x26quot;content\x26quot;: \x26quot;Good article!\x26quot;\n  }\n  ...\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs json\x22\x3e\x3ccode\x3e[\n  {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e41\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Jack\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22create_time\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222017-01-11T23:07:43.248Z\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22content\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Good article!\x22\x3c\/span\x3e\n  }\n  ...\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面三个接口的数据分别作为3个子State，构成应用全局的State:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;posts\x26quot;: [\n    {\n      \x26quot;id\x26quot;: 1,\n      \x26quot;title\x26quot;: \x26quot;Blog Title\x26quot;,\n      \x26quot;create_time\x26quot;: \x26quot;2017-01-10T23:07:43.248Z\x26quot;,\n      \x26quot;author\x26quot;: {\n        \x26quot;id\x26quot;: 81,\n        \x26quot;name\x26quot;: \x26quot;Mr Shelby\x26quot;\n      }\n    },\n    ...\n  ],\n  \x26quot;currentPost\x26quot;: {\n    \x26quot;id\x26quot;: 1,\n    \x26quot;title\x26quot;: \x26quot;Blog Title\x26quot;,\n    \x26quot;create_time\x26quot;: \x26quot;2017-01-10T23:07:43.248Z\x26quot;,\n    \x26quot;author\x26quot;: {\n      \x26quot;id\x26quot;: 81,\n      \x26quot;name\x26quot;: \x26quot;Mr Shelby\x26quot;\n    },\n    \x26quot;content\x26quot;: \x26quot;Some really short blog content. \x26quot;\n  },\n  \x26quot;currentComments\x26quot;: [\n    {\n      \x26quot;id\x26quot;: 1,\n      \x26quot;author\x26quot;: \x26quot;Jack\x26quot;,\n      \x26quot;create_time\x26quot;: \x26quot;2017-01-11T23:07:43.248Z\x26quot;,\n      \x26quot;content\x26quot;: \x26quot;Good article!\x26quot;\n    },\n    ...\n  ]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs json\x22\x3e\x3ccode\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22posts\x22\x3c\/span\x3e: [\n    {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22title\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Blog Title\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22create_time\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222017-01-10T23:07:43.248Z\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e81\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Mr Shelby\x22\x3c\/span\x3e\n      }\n    },\n    ...\n  ],\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22currentPost\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22title\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Blog Title\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22create_time\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222017-01-10T23:07:43.248Z\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e81\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Mr Shelby\x22\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22content\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Some really short blog content. \x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22currentComments\x22\x3c\/span\x3e: [\n    {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Jack\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22create_time\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222017-01-11T23:07:43.248Z\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22content\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Good article!\x22\x3c\/span\x3e\n    },\n    ...\n  ]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个State中，posts和currentPost存在很多重复的信息，而且posts、currentComments是数组类型的结构，不便于查找，每次查找某条记录时，都需要遍历整个数组。这些问题本质上是因为API是基于服务端逻辑设计的，而不是基于应用的状态设计的。比如，虽然获取博客列表时，已经获取了每篇博客的标题、作者等基本信息，但对于获取博客详情的API来说，根据API的设计原则，这个API依然应该包含博客的这些基本信息，而不能只是返回博客的内容。再比如，posts、currentComments之所以返回数组结构，是考虑到数据的顺序、分页等因素。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e错误2：以页面UI为设计State的依据\x3c\/h3\x3e\n\x3cp\x3e既然不能依据API设计State，很多人又会走到另外一个反面，基于页面UI设计State。页面UI需要什么样的数据和数据格式，State就设计成什么样。我们以todo应用为例，页面会有三种状态：显示所有的事项，显然所有的已办事项和显示所有的待办事项。以页面UI为设计State的依据，那么State将是这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;all\x26quot;: [\n    {\n      \x26quot;id\x26quot;: 1,\n      \x26quot;text\x26quot;: \x26quot;todo 1\x26quot;,\n      \x26quot;completed\x26quot;: false\n    },\n    {\n      \x26quot;id\x26quot;: 2,\n      \x26quot;text\x26quot;: \x26quot;todo 2\x26quot;,\n      \x26quot;completed\x26quot;: true\n    }\n  ],\n  \x26quot;uncompleted\x26quot;: [\n    {\n      \x26quot;id\x26quot;: 1,\n      \x26quot;text\x26quot;: \x26quot;todo 1\x26quot;,\n      \x26quot;completed\x26quot;: false\n    }\n  ],\n  \x26quot;completed\x26quot;: [\n    {\n      \x26quot;id\x26quot;: 2,\n      \x26quot;text\x26quot;: \x26quot;todo 2\x26quot;,\n      \x26quot;completed\x26quot;: false\n    }\n  ]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs json\x22\x3e\x3ccode\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22all\x22\x3c\/span\x3e: [\n    {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22text\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22todo 1\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22completed\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n    },\n    {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22text\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22todo 2\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22completed\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    }\n  ],\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22uncompleted\x22\x3c\/span\x3e: [\n    {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22text\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22todo 1\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22completed\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n    }\n  ],\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22completed\x22\x3c\/span\x3e: [\n    {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22text\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22todo 2\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22completed\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n    }\n  ]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个State对于展示UI的组件来说，使用起来非常方便，当前应用处于哪种状态，就用对应状态的数组类型的数据渲染UI，不用做任何的中间数据转换。但这种State存在的问题也很容易被发现，一是这种State依然存在数据重复的问题；二是当新增或修改一条记录时，需要修改不止一个地方。例如，当新增一条记录时，all和uncompleted这两个数组都要添加这条新增记录。这种类型的State，既会造成存储的浪费，又会存在数据不一致的风险。\x3c\/p\x3e\n\x3cp\x3e这两种设计State的方式实际上是两种极端的设计方式，实际项目中，完全按照这两种方式设计State的开发者并不多，但绝大部分人都会受到这两种设计方式的影响。请回忆一下，你是否有过把某个API返回的数据原封不动的作为State的一部分？又是否有过，为了组件渲染方便，专门为某个组件的UI定义一个State？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e合理设计State\x3c\/h3\x3e\n\x3cp\x3e下面我们来看一下应该如何合理地设计State。最重要最核心的原则是像设计数据库一样设计State。把State看做一个数据库，State中的每一部分状态看做数据库中的一张表，状态中的每一个字段对应表的一个字段。设计一个数据库，应该遵循以下三个原则：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e数据按照领域（Domain）分类，存储在不同的表中，不同的表中存储的列数据不能重复。\x3c\/li\x3e\n\x3cli\x3e表中每一列的数据都依赖于这张表的主键。\x3c\/li\x3e\n\x3cli\x3e表中除了主键以外的其他列，互相之间不能有直接依赖关系。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e这三个原则，可以翻译出设计State时的原则：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e把整个应用的状态按照领域（Domain）分成若干子State，子State之间不能保存重复的数据。\x3c\/li\x3e\n\x3cli\x3eState以键值对的结构存储数据，以记录的key\/ID作为记录的索引，记录中的其他字段都依赖于索引。\x3c\/li\x3e\n\x3cli\x3eState中不能保存可以通过已有数据计算而来的数据，即State中的字段不互相依赖。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e按照这三个原则，我们重新设计博客应用的State。按领域划分，State可以拆分为三个子State: posts、comments、authors，posts中的记录以博客的id为key值，包含title、create_time、author、comments，同样的方式可以设计出comments、authors的结构，最终State的结构如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;posts\x26quot;: {\n    \x26quot;1\x26quot;: {\n      \x26quot;id\x26quot;: 1,\n      \x26quot;title\x26quot;: \x26quot;Blog Title\x26quot;,\n      \x26quot;content\x26quot;: \x26quot;Some really short blog content.\x26quot;,\n      \x26quot;created_at\x26quot;: \x26quot;2016-01-11T23:07:43.248Z\x26quot;,\n      \x26quot;author\x26quot;: 81,\n      \x26quot;comments\x26quot;: [\n        352\n      ]\n    },\n    ...\n  },\n  \x26quot;comments\x26quot;: {\n    \x26quot;352\x26quot;: {\n      \x26quot;id\x26quot;: 352,\n      \x26quot;content\x26quot;: \x26quot;Good article!\x26quot;,\n      \x26quot;author\x26quot;: 41\n    },\n    ...\n  },\n  \x26quot;authors\x26quot;: {\n    \x26quot;41\x26quot;: {\n      \x26quot;id\x26quot;: 41,\n      \x26quot;name\x26quot;: \x26quot;Jack\x26quot;\n    },\n    \x26quot;81\x26quot;: {\n      \x26quot;id\x26quot;: 81,\n      \x26quot;name\x26quot;: \x26quot;Mr Shelby\x26quot;\n    },\n    ...\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clojure\x22\x3e\x3ccode\x3e{\n  \x3cspan class=\x22hljs-string\x22\x3e\x22posts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x221\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22title\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Blog Title\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22content\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Some really short blog content.\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22created_at\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222016-01-11T23:07:43.248Z\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e81\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22comments\x22\x3c\/span\x3e: [\n        \x3cspan class=\x22hljs-number\x22\x3e352\x3c\/span\x3e\n      ]\n    },\n    ...\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22comments\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22352\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e352\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22content\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Good article!\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e41\x3c\/span\x3e\n    },\n    ...\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22authors\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x2241\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e41\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Jack\x22\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x2281\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e81\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Mr Shelby\x22\x3c\/span\x3e\n    },\n    ...\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在这个State看起来是不是很像有三张表的数据库呢？但这个State还有不满足应用需求的地方：键值对的存储方式无法保证博客列表数据的顺序，但对于博客列表，有序性显然是需要的。解决这个问题，我们可以通过定义另外一个状态postIds，以数组格式存储博客的id：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;posts\x26quot;: {\n    \x26quot;1\x26quot;: {\n      \x26quot;id\x26quot;: 1,\n      \x26quot;title\x26quot;: \x26quot;Blog Title\x26quot;,\n      \x26quot;content\x26quot;: \x26quot;Some really short blog content.\x26quot;,\n      \x26quot;created_at\x26quot;: \x26quot;2016-01-11T23:07:43.248Z\x26quot;,\n      \x26quot;author\x26quot;: 81,\n      \x26quot;comments\x26quot;: [\n        352\n      ]\n    },\n    ...\n  },\n  \x26quot;postIds\x26quot;: [1, ...],\n  \x26quot;comments\x26quot;: {\n    \x26quot;352\x26quot;: {\n      \x26quot;id\x26quot;: 352,\n      \x26quot;content\x26quot;: \x26quot;Good article!\x26quot;,\n      \x26quot;author\x26quot;: 41\n    },\n    ...\n  },\n  \x26quot;authors\x26quot;: {\n    \x26quot;41\x26quot;: {\n      \x26quot;id\x26quot;: 41,\n      \x26quot;name\x26quot;: \x26quot;Jack\x26quot;\n    },\n    \x26quot;81\x26quot;: {\n      \x26quot;id\x26quot;: 81,\n      \x26quot;name\x26quot;: \x26quot;Mr Shelby\x26quot;\n    },\n    ...\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clojure\x22\x3e\x3ccode\x3e{\n  \x3cspan class=\x22hljs-string\x22\x3e\x22posts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x221\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22title\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Blog Title\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22content\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Some really short blog content.\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22created_at\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222016-01-11T23:07:43.248Z\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e81\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22comments\x22\x3c\/span\x3e: [\n        \x3cspan class=\x22hljs-number\x22\x3e352\x3c\/span\x3e\n      ]\n    },\n    ...\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22postIds\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, ...],\n  \x3cspan class=\x22hljs-string\x22\x3e\x22comments\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22352\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e352\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22content\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Good article!\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e41\x3c\/span\x3e\n    },\n    ...\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22authors\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x2241\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e41\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Jack\x22\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x2281\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e81\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Mr Shelby\x22\x3c\/span\x3e\n    },\n    ...\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样，当显示博客列表时，根据postIds获取列表顺序，然后根据博客id从posts中获取博客的信息。这个地方有些同学可能有疑惑，认为posts和postIds都保存了id数据，违反了不同State间不能有重复数据的原则。但其实这并不是重复数据，postIds保存的数据是博客列表的顺序，只不过“顺序”这个数据是通过博客id来体现的。这和一张表的主键同时可以用作另外一张表的外键，是同样的道理。同样需要注意的是，当新增加一条博客时，posts和postId这两个状态都要进行修改。这看似变得麻烦，不如直接使用一个数组类型的状态操作简单，但是当需要修改某一篇博客的数据时，这种结构就有了明显的优势，而且直接使用数组保存状态，会存在对象嵌套层级过深的问题，想象下访问评论的内容，需要通过类似\x3ccode\x3eposts[0].comments[0].content\x3c\/code\x3e三层结构才能获取到，当业务越复杂，这个问题越突出。扁平化的State，才具有更好的灵活性和扩展性。\x3c\/p\x3e\n\x3cp\x3e截至目前为止，我们的State都是根据后台API返回的领域数据进行设计的，但实际上，应用的State，不仅包含领域数据，还需要包含应用的UI逻辑数据，例如根据当前是否正在与服务器通信，处理页面的加载效果；当应用运行出错时，需要显示错误信息等。这时，State的结构如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;isFetching\x26quot;: false,\n  \x26quot;error\x26quot;: \x26quot;\x26quot;,\n  \x26quot;posts\x26quot;: {\n    ...\n  },\n  \x26quot;postIds\x26quot;: [1, ...],\n  \x26quot;comments\x26quot;: {\n    ...\n  },\n  \x26quot;authors\x26quot;: {\n    ...\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clojure\x22\x3e\x3ccode\x3e{\n  \x3cspan class=\x22hljs-string\x22\x3e\x22isFetching\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22error\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22posts\x22\x3c\/span\x3e: {\n    ...\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22postIds\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, ...],\n  \x3cspan class=\x22hljs-string\x22\x3e\x22comments\x22\x3c\/span\x3e: {\n    ...\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22authors\x22\x3c\/span\x3e: {\n    ...\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e随着应用业务逻辑的增加，State的第一层级的节点也会变得越来越多。这时候我们往往会考虑合并关联性较强的节点数据，然后通过拆分reducer的方式，让每一个子reducer处理一个节点的状态逻辑。这个例子中，我们可以把posts、postIds进行合并，同时状态名做了调整，把isFetching、error作为全局的UI逻辑状态合并：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;app\x26quot;:{\n    \x26quot;isFetching\x26quot;: false,\n      \x26quot;error\x26quot;: \x26quot;\x26quot;,\n  },\n  \x26quot;posts\x26quot;:{\n    \x26quot;byId\x26quot;: {\n      \x26quot;1\x26quot;: {\n        ...\n      },\n      ...\n    },\n    \x26quot;allIds\x26quot;: [1, ...],\n  } \n  \x26quot;comments\x26quot;: {\n    ...\n  },\n  \x26quot;authors\x26quot;: {\n    ...\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clojure\x22\x3e\x3ccode\x3e{\n  \x3cspan class=\x22hljs-string\x22\x3e\x22app\x22\x3c\/span\x3e:{\n    \x3cspan class=\x22hljs-string\x22\x3e\x22isFetching\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22error\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e,\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22posts\x22\x3c\/span\x3e:{\n    \x3cspan class=\x22hljs-string\x22\x3e\x22byId\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x221\x22\x3c\/span\x3e: {\n        ...\n      },\n      ...\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x22allIds\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, ...],\n  } \n  \x3cspan class=\x22hljs-string\x22\x3e\x22comments\x22\x3c\/span\x3e: {\n    ...\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22authors\x22\x3c\/span\x3e: {\n    ...\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样，我们就可以定义appReducer、postsReducer、commentsReducer、authorsReducer四个reducer分别处理4个子状态。至此，State的结构设计完成。\x3c\/p\x3e\n\x3cp\x3e总结一下，设计Redux State的关键在于，像设计数据库一样设计State。把State看作应用在内存中的一个数据库，action、reducer等看作操作这个数据库的SQL语句。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3e欢迎关注我的公众号：老干部的大前端，领取21本大前端精选书籍!\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV4lGT?w=540\x26amp;h=193\x22 src=\x22https:\/\/static.alili.tech\/img\/bV4lGT?w=540\x26amp;h=193\x22 alt=\x223808299627-5a93ba468b59a\x22 title=\x223808299627-5a93ba468b59a\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Redux进阶系列2: 如何合理地设计Redux的State</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010867852">https://segmentfault.com/a/1190000010867852</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/sui3wxfr0z/" target="_blank">https://alili.tech/archive/sui3wxfr0z/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>