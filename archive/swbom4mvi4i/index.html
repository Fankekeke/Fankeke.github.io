<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React 服务端渲染框架 Next.js 基于 Gank api 实战"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React 服务端渲染框架 Next.js 基于 Gank api 实战 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/swbom4mvi4i/",
				"appid": "1613049289050283", 
				"title": "React 服务端渲染框架 Next.js 基于 Gank api 实战 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-28T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/luh2tivo4i/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/73thoz8am18/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fswbom4mvi4i%2f&text=React%20%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%b8%b2%e6%9f%93%e6%a1%86%e6%9e%b6%20Next.js%20%e5%9f%ba%e4%ba%8e%20Gank%20api%20%e5%ae%9e%e6%88%98"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fswbom4mvi4i%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fswbom4mvi4i%2f&text=React%20%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%b8%b2%e6%9f%93%e6%a1%86%e6%9e%b6%20Next.js%20%e5%9f%ba%e4%ba%8e%20Gank%20api%20%e5%ae%9e%e6%88%98"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fswbom4mvi4i%2f&title=React%20%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%b8%b2%e6%9f%93%e6%a1%86%e6%9e%b6%20Next.js%20%e5%9f%ba%e4%ba%8e%20Gank%20api%20%e5%ae%9e%e6%88%98"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fswbom4mvi4i%2f&is_video=false&description=React%20%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%b8%b2%e6%9f%93%e6%a1%86%e6%9e%b6%20Next.js%20%e5%9f%ba%e4%ba%8e%20Gank%20api%20%e5%ae%9e%e6%88%98"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%20%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%b8%b2%e6%9f%93%e6%a1%86%e6%9e%b6%20Next.js%20%e5%9f%ba%e4%ba%8e%20Gank%20api%20%e5%ae%9e%e6%88%98&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fswbom4mvi4i%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fswbom4mvi4i%2f&title=React%20%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%b8%b2%e6%9f%93%e6%a1%86%e6%9e%b6%20Next.js%20%e5%9f%ba%e4%ba%8e%20Gank%20api%20%e5%ae%9e%e6%88%98"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fswbom4mvi4i%2f&title=React%20%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%b8%b2%e6%9f%93%e6%a1%86%e6%9e%b6%20Next.js%20%e5%9f%ba%e4%ba%8e%20Gank%20api%20%e5%ae%9e%e6%88%98"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fswbom4mvi4i%2f&title=React%20%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%b8%b2%e6%9f%93%e6%a1%86%e6%9e%b6%20Next.js%20%e5%9f%ba%e4%ba%8e%20Gank%20api%20%e5%ae%9e%e6%88%98"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fswbom4mvi4i%2f&title=React%20%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%b8%b2%e6%9f%93%e6%a1%86%e6%9e%b6%20Next.js%20%e5%9f%ba%e4%ba%8e%20Gank%20api%20%e5%ae%9e%e6%88%98"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React 服务端渲染框架 Next.js 基于 Gank api 实战</h1><div class="meta"><div class="postdate"><time datetime="2018-12-28" itemprop="datePublished">2018-12-28</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000011647879?w=743\x26amp;h=399\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000011647879?w=743\x26amp;h=399\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e最开始先摆出地址，有在线 demo：\x3ca href=\x22https:\/\/github.com\/OrangeXC\/gank\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/OrangeXC\/gank\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e鉴于最近 vue 相关的文章写的比较多，抽出时间写点 react 的项目，当时用 react 还是 v15 现在都 v16 了，感慨跟不上所有框架的节奏（玩笑话），框架的本质都是大同小异的，每次高 star 框架更新看一下 change 是个好习惯。\x3c\/p\x3e\n\x3cp\x3e之前用 Nuxt 写了个简单的 v2ex，今天的主角依然是 SSR 服务端渲染\x3c\/p\x3e\n\x3cp\x3eNuxt 文档里有写到灵感源于 Next.js，那么就是说 Next.js 算是 SSR 框架中的元老级别的了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e为什么选择 SSR 框架\x3c\/h2\x3e\n\x3cp\x3e前面的文章总是在官方文档上小费功夫说明下，这里对于不熟悉 Next.js 的读者建议直接转到 Github，别犹豫，当然熟悉 Nuxt 也可以无障碍阅读本文\x3c\/p\x3e\n\x3cp\x3e不论是 Next.js 或 Nuxt，服务端渲染框架主要两个重要功能\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e首屏 node.js 服务端渲染\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e生成纯静态的 web 站\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e至于它们是基于哪个前端库封装的，还要看库本身是否支持 SSR，然后就是对外提供 render 函数。\x3c\/p\x3e\n\x3cp\x3e用此类库的原因也不必多说，节省开发成本，不再纠结于环境搭建以及渲染细节。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e直接开工\x3c\/h2\x3e\n\x3cp\x3e本次要实现的是基于 \x3ca href=\x22http:\/\/gank.io\/api\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egank api\x3c\/a\x3e 的项目，还是看人家支持什么 api，点前面链接查看详细 api\x3c\/p\x3e\n\x3cp\x3e大体总结为 =\x26gt; 列表，搜索，提叫到审核\x3c\/p\x3e\n\x3cp\x3e列表分为了许多类型，主要的 menu 也是针对不同类型的列表展开\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e路由\x3c\/h2\x3e\n\x3cp\x3e通过已知的 api 可以轻松的定义路由\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\/ （主页，最近的全部类型干货列表）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/fe （前端干货列表）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/android (安卓干货列表)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/ios (iOS干货列表)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/app (App干货列表)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/expand (拓展资源干货列表)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/videos (休息视频干货列表)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/welfare (福利列表，前方高能，全是干货。。。)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/timelien (时间轴，记录历史所有更新过干货的日期)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/day (某天详情，分为以上几种类型的 tab 列表)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/uplaod (发送干货到审核)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\/search (搜索页)\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e同 Nuxt 路由配置文件不需要手动创建，\/pages 下默认会渲染为页面，文件名自然就是路由名\x3c\/p\x3e\n\x3cp\x3e路由文件都创建完了，下一步思考如抽离出公共模板 Layout 代码，Next.js 提供了 \x3ca href=\x22https:\/\/github.com\/zeit\/next.js\/tree\/master\/examples\/layout-component\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3elayout-component example\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e我们可以在里面定义 Head,Header,Footer，当然要留出一个内容区域的插槽 \x3ccode\x3e{ children }\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e引用于 example 的 layout.js 代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import Link from \x27next\/link\x27\nimport Head from \x27next\/head\x27\n\nexport default ({ children, title = \x27This is the default title\x27 }) =\x3e (\n  \x3cdiv\x3e\n    \x3cHead\x3e\n      \x3ctitle\x3e{ title }\x3c\/title\x3e\n      \x3cmeta charSet=\x27utf-8\x27 \/\x3e\n      \x3cmeta name=\x27viewport\x27 content=\x27initial-scale=1.0, width=device-width\x27 \/\x3e\n    \x3c\/Head\x3e\n    \x3cheader\x3e\n      \x3cnav\x3e\n        \x3cLink href=\x27\/\x27\x3e\x3ca\x3eHome\x3c\/a\x3e\x3c\/Link\x3e |\n        \x3cLink href=\x27\/about\x27\x3e\x3ca\x3eAbout\x3c\/a\x3e\x3c\/Link\x3e |\n        \x3cLink href=\x27\/contact\x27\x3e\x3ca\x3eContact\x3c\/a\x3e\x3c\/Link\x3e\n      \x3c\/nav\x3e\n    \x3c\/header\x3e\n\n    { children }\n\n    \x3cfooter\x3e\n      {\x27I`m here to stay\x27}\n    \x3c\/footer\x3e\n  \x3c\/div\x3e\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Link \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27next\/link\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Head \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27next\/head\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e ({ children, title = \x3cspan class=\x22hljs-string\x22\x3e\x27This is the default title\x27\x3c\/span\x3e }) =\x26gt; (\n  \x26lt;div\x26gt;\n    \x26lt;Head\x26gt;\n      \x26lt;title\x26gt;{ title }\x26lt;\/title\x26gt;\n      \x26lt;meta charSet=\x27utf-8\x27 \/\x26gt;\n      \x26lt;meta name=\x27viewport\x27 content=\x27initial-scale=1.0, width=device-width\x27 \/\x26gt;\n    \x26lt;\/Head\x26gt;\n    \x26lt;header\x26gt;\n      \x26lt;nav\x26gt;\n        \x26lt;Link href=\x27\/\x27\x26gt;\x26lt;a\x26gt;Home\x26lt;\/a\x26gt;\x26lt;\/Link\x26gt; |\n        \x26lt;Link href=\x27\/about\x27\x26gt;\x26lt;a\x26gt;About\x26lt;\/a\x26gt;\x26lt;\/Link\x26gt; |\n        \x26lt;Link href=\x27\/contact\x27\x26gt;\x26lt;a\x26gt;Contact\x26lt;\/a\x26gt;\x26lt;\/Link\x26gt;\n      \x26lt;\/nav\x26gt;\n    \x26lt;\/header\x26gt;\n\n    { children }\n\n    \x26lt;footer\x26gt;\n      {\x27I`m here to stay\x27}\n    \x26lt;\/footer\x26gt;\n  \x26lt;\/div\x26gt;\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e因为本次使用的是 antd 做 ui，固实现动态的导航展示上要注意些小问题，我们需要根据 path 动态的给 menu 激活状态。\x3c\/p\x3e\n\x3cp\x3e两个解决方案：\x3c\/p\x3e\n\x3cp\x3e1.在 pages 里面的每一个路由页面里获取 pathname，初始化方法 \x3ccode\x3egetInitialProps\x3c\/code\x3e 里可以拿到 pathname，全部列表如下\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3epathname - path section of URL\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3equery - query string section of URL parsed as an object\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3easPath - String of the actual path (including the query) shows in the browser\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ereq - HTTP request object (server only)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eres - HTTP response object (server only)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ejsonPageRes - Fetch Response object (client only)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eerr - Error object if any error is encountered during the rendering\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e调用方法也简单\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22static async getInitialProps({ pathname }) {\n  return { pathname }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e getInitialProps({ pathname }) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { pathname }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样一来可以通过传参到 layout 组件的方式 \x3ccode\x3e\x26lt;Layout pathname={this.props.pathname}\x26gt;\x26lt;\/Layout\x26gt;\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e在 Layout 里面改变 Meun 的 active\x3c\/p\x3e\n\x3cp\x3e2.写一个 ActiveLink 组件，再封装一层原有的 Menu\x3c\/p\x3e\n\x3cp\x3e在选择方案前还是要看官方有没有 example，于是找到了 \x3ca href=\x22https:\/\/github.com\/zeit\/next.js\/tree\/master\/examples\/using-with-router\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eusing-with-router\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e引用于 example 的 ActiveLink.js 代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { withRouter } from \x27next\/router\x27\n\n\/\/ typically you want to use `next\/link` for this usecase\n\/\/ but this example shows how you can also access the router\n\/\/ using the withRouter utility.\n\nconst ActiveLink = ({ children, router, href }) =\x3e {\n  const style = {\n    marginRight: 10,\n    color: router.pathname === href ? \x27red\x27 : \x27black\x27\n  }\n\n  const handleClick = (e) =\x3e {\n    e.preventDefault()\n    router.push(href)\n  }\n\n  return (\n    \x3ca href={href} onClick={handleClick} style={style}\x3e\n      {children}\n    \x3c\/a\x3e\n  )\n}\n\nexport default withRouter(ActiveLink)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { withRouter } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27next\/router\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ typically you want to use `next\/link` for this usecase\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ but this example shows how you can also access the router\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ using the withRouter utility.\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ActiveLink = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ children, router, href }\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e style = {\n    \x3cspan class=\x22hljs-attr\x22\x3emarginRight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecolor\x3c\/span\x3e: router.pathname === href ? \x3cspan class=\x22hljs-string\x22\x3e\x27red\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27black\x27\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e handleClick = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    e.preventDefault()\n    router.push(href)\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n    \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{href}\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{handleClick}\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{style}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      {children}\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n  )\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e withRouter(ActiveLink)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e简单易懂，在 withRouter 方法里可以取到 router 实例，这样可以取到 pathname，query 等等。\x3c\/p\x3e\n\x3cp\x3e这里只需要稍稍修改下 style，变成 antd 的 className，如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const ActiveLink = ({ children, router, href }) =\x3e {\n  const active = router.pathname === href\n  const className = active ? \x27ant-menu-item-selected ant-menu-item\x27 : \x27ant-menu-item\x27\n  return (\n    \x3cli href=\x27#\x27 onClick={onClickHandler(href)} className={className} role=\x26quot;menuitem\x26quot; aria-selected=\x26quot;false\x26quot;\x3e\n      {children}\n    \x3c\/li\x3e\n  )\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ActiveLink = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ children, router, href }\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e active = router.pathname === href\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e className = active ? \x3cspan class=\x22hljs-string\x22\x3e\x27ant-menu-item-selected ant-menu-item\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27ant-menu-item\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n    \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27#\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{onClickHandler(href)}\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{className}\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erole\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22menuitem\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3earia-selected\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22false\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      {children}\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n  )\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在 Layout 组件的 Menu 里直接使用 ActiveLink 组件即可，到这为止解决了全部路由相关问题和 Layout 组件问题\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e数据流\x3c\/h2\x3e\n\x3cp\x3e解决了路由问题下一步就是每个页面的 content 的数据填充\x3c\/p\x3e\n\x3cp\x3e我们依旧是在 \x3ccode\x3egetInitialProps\x3c\/code\x3e 里面获取数据，相当于 prefatch 方法，服务端渲染会提前执行这个方法获取数据渲染到模板\x3c\/p\x3e\n\x3cp\x3e这里涉及到一个 node 和 Browserify 同构的 fetch 库 \x3ca href=\x22https:\/\/github.com\/matthew-andrews\/isomorphic-fetch\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eisomorphic-fetch\x3c\/a\x3e，cli 工具应该会自带这个库，没有的话提前安装下。\x3c\/p\x3e\n\x3cp\x3e到这里就不用担心 fetch api 在服务端的问题了，这里获取的列表数据走的接口基本一致 \x3ccode\x3ehttps:\/\/gank.io\/api\/data\/{type}\/{perPage}\/{page}\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e三个变量 type-类型、perPage-每页数量、page-页数\x3c\/p\x3e\n\x3cp\x3e接下来可以把 List 和 ListItem 抽象出来，成为共用的组件，每个页面都可以调用，这里不详细展开说明，简单的使用 antd 的 Card 组件，没有特殊功能。\x3c\/p\x3e\n\x3cp\x3e每个页面的请求数据部分也基本一致，将数据存到 props 里，传入 List 组件中去\x3c\/p\x3e\n\x3cp\x3e形成了简单的单向数据流动\x3c\/p\x3e\n\x3cp\x3e列表页面\x3c\/p\x3e\n\x3cp\x3epage组件(fetch data) -\x26gt; List组件(继承自 Layout) -\x26gt; ListItem组件\x3c\/p\x3e\n\x3cp\x3e时间轴页面\x3c\/p\x3e\n\x3cp\x3epage组件(fetch data) -\x26gt; Timeline组件(继承自 Layout)\x3c\/p\x3e\n\x3cp\x3e提交干货页面\x3c\/p\x3e\n\x3cp\x3epage组件 -\x26gt; Form组件(继承自 Layout) -\x26gt; post请求(发送formData)\x3c\/p\x3e\n\x3cp\x3e搜索页面\x3c\/p\x3e\n\x3cp\x3epage组件 -\x26gt; Input组件\x2b空ListItem组件(继承自 Layout) -\x26gt; get请求(获取关键词对应query的列表数据) -\x26gt; ListItem组件\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3eMobx\x3c\/h2\x3e\n\x3cp\x3e既然前面说清楚了数据流都十分简单，那么为什么要引入全局状态管理徒增烦恼呢？\x3c\/p\x3e\n\x3cp\x3e有一点无奈的地方是 \x3ccode\x3egetInitialProps\x3c\/code\x3e 本身 return 的就是 props，在 react 里面 props 是单向的，只能向下传递，且不能修改\x3c\/p\x3e\n\x3cp\x3e这里我们要分页功能，但是首屏数据是 props 的，我们换页之后没办法更新 props 的值，也就是没办法再次执行 \x3ccode\x3egetInitialProps\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e最简单粗暴的方式就是放弃 spa 的动态切换数据，我们每次 \x3ccode\x3eRouter.push({some page}\/{per page}\/{current page})\x3c\/code\x3e，一朝回到解放前的 MVC 版路由切换。\x3c\/p\x3e\n\x3cp\x3e能不能解决问题，答案是能解决问题，那么既然是分页组件，人家 antd 也提供了 Pagination 组件，问题一个接着一个，人家返回的列表并没有告诉你 totalCount，没有 totalCount 就没办法知道有多少页。。。\x3c\/p\x3e\n\x3cp\x3e好尴尬的问题，这个分页没法做，怒脸~~~\x3c\/p\x3e\n\x3cp\x3e也不是没办法做，这个问题变向思考下可以做 loadMore，没错加载更多，当加载到最后一页（即的列表长度小于 perPage）或是此页恰巧等于 perPage 但下一页为空数组时，我们给一个提示，没有更多内容了。\x3c\/p\x3e\n\x3cp\x3e涉及到向 props 的 list 里 \x3ccode\x3econcat\x3c\/code\x3e 数组，我们不得不引入全局状态来解决这个问题，不论是 redux 还是 mobx 都可以解决问题，需要注意的是，next.js 中的用法和普通 spa 的 react 应用有所差别。\x3c\/p\x3e\n\x3cp\x3e还是去找 example，\x3ca href=\x22https:\/\/github.com\/zeit\/next.js\/tree\/master\/examples\/with-mobx\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewith mobx\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e引用于 example 的 store.js 代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export function initStore (isServer, lastUpdate = Date.now()) {\n  if (isServer) {\n    return new Store(isServer, lastUpdate)\n  } else {\n    if (store === null) {\n      store = new Store(isServer, lastUpdate)\n    }\n    return store\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einitStore\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eisServer, lastUpdate = Date.now(\x3c\/span\x3e)) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isServer) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Store(isServer, lastUpdate)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (store === \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e) {\n      store = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Store(isServer, lastUpdate)\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e store\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码太简单，没必要解释了，总之我们在初始化页面时调用 initStore 就好了，isServer 通过 \x3ccode\x3egetInitialProps\x3c\/code\x3e 的 req 参数 \x3ccode\x3e!!req\x3c\/code\x3e 判断\x3c\/p\x3e\n\x3cp\x3e然后在 loadMore 时出发一个 action\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@action loadMoreList = (more) =\x3e {\n  this.list = this.list.concat(more)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e@action loadMoreList = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3emore\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.list = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.list.concat(more)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e到这加载更多的功能也就实现了，不足的一点是 List 组件里的 \x3ccode\x3ehandleScroll\x3c\/code\x3e 方法写的有点简陋，虽说能用，但存在问题，如多次触发、未写兼容代码（后续会改进），放出代码供大家一笑\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22handleScroll () {\n  if (document.documentElement.offsetHeight \x2b document.documentElement.scrollTop \x3e document.documentElement.scrollHeight - 50) {\n    this.handleLoadMore()\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3ehandleScroll () {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.documentElement.offsetHeight \x2b \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.documentElement.scrollTop \x26gt; \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.documentElement.scrollHeight - \x3cspan class=\x22hljs-number\x22\x3e50\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleLoadMore()\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其它代码感兴趣可以直接取仓库看，没有阅读难度。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e表单提交\x3c\/h2\x3e\n\x3cp\x3e说到其它页的 fetch list 没什么可将全都是 get 请求，fetch 发一个 get 请求十分简单，不用声明请求类型。\x3c\/p\x3e\n\x3cp\x3efetch 操作 post 也仅仅在于设置 method 为 POST\x3c\/p\x3e\n\x3cp\x3e之所以单独一章说表单提交，因为在提交表单时遇到了一些问题，由于要 fetch 模拟 form 的 post 请求\x3c\/p\x3e\n\x3cp\x3e看了这个 issue：\x3ca href=\x22https:\/\/github.com\/matthew-andrews\/isomorphic-fetch\/issues\/30\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/matthew-an...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e开始怀疑人生，试了所有方法 POST，也走的通，但是接口返回的 msg 就是没接收到参数。\x3c\/p\x3e\n\x3cp\x3e想了想还是回归到笨方法一个一个将参数拼接进去，没想到较优雅的方式，给出代码，同时欢迎讨论\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22handleSubmit = (e) =\x3e {\n  e.preventDefault()\n\n  this.props.form.validateFieldsAndScroll(async (err, values) =\x3e {\n    if (!err) {\n      this.setState({ submitLoading: true })\n\n      let strList = []\n\n      Object.keys(values).forEach(item =\x3e {\n        strList.push(`${item}=${values[item]}`)\n      })\n\n      const res = await fetch(\x26quot;https:\/\/gank.io\/api\/add2gank\x26quot;, {\n        method: \x26quot;POST\x26quot;,\n        headers: {\n          \x27Content-Type\x27: \x27application\/x-www-form-urlencoded\x27\n        },\n        body: strList.join(\x27\x26amp;\x27)\n      })\n\n      const json = await res.json()\n\n      if (json.error) {\n        message.error(json.msg)\n      } else {\n        message.success(json.msg)\n      }\n\n      this.setState({ submitLoading: false })\n    }\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3ehandleSubmit = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  e.preventDefault()\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.form.validateFieldsAndScroll(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (err, values) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!err) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ \x3cspan class=\x22hljs-attr\x22\x3esubmitLoading\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e })\n\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e strList = []\n\n      \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(values).forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        strList.push(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${item}\x3c\/span\x3e=\x3cspan class=\x22hljs-subst\x22\x3e${values[item]}\x3c\/span\x3e`\x3c\/span\x3e)\n      })\n\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e res = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/gank.io\/api\/add2gank\x22\x3c\/span\x3e, {\n        \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22POST\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: {\n          \x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27application\/x-www-form-urlencoded\x27\x3c\/span\x3e\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3ebody\x3c\/span\x3e: strList.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;\x27\x3c\/span\x3e)\n      })\n\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e json = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e res.json()\n\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (json.error) {\n        message.error(json.msg)\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        message.success(json.msg)\n      }\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ \x3cspan class=\x22hljs-attr\x22\x3esubmitLoading\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e })\n    }\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e看过网站的读者也发现提交表单页面上方有提示语，让大家文明使用三方 api 提供者 gank 的发表干货接口，把真正的好内容提交上去，想测试接口的请走默认的 debug 模式，这里再次强调下，感谢配合\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e微交互\x3c\/h2\x3e\n\x3cp\x3e既然功能差不多了，再微交互上再加把劲，用过 NUXT 的知道 NUXT 内置了 Loading bar，切换路由时在页面顶端会有 loading 条，体验较好。\x3c\/p\x3e\n\x3cp\x3enext.js 并没有内置这个功能，页面看起来会显得十分怪异，点击切换路由没有反应，顿一下再跳转，顿的时候在获取初始化数据。\x3c\/p\x3e\n\x3cp\x3e官方推荐使用 nprogress\x3c\/p\x3e\n\x3cp\x3e关键代码如下，写在了 Layout.js 组件里\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Router.onRouteChangeStart = (url) =\x3e {\n  console.log(`Loading: ${url}`)\n  NProgress.start()\n}\nRouter.onRouteChangeComplete = () =\x3e NProgress.done()\nRouter.onRouteChangeError = () =\x3e NProgress.done()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eRouter.onRouteChangeStart = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`Loading: \x3cspan class=\x22hljs-subst\x22\x3e${url}\x3c\/span\x3e`\x3c\/span\x3e)\n  NProgress.start()\n}\nRouter.onRouteChangeComplete = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e NProgress.done()\nRouter.onRouteChangeError = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e NProgress.done()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样整个网站看起来洋气多了，切换 router 页面顶端有 loading bar，右上角还有 loading icon\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e上线\x3c\/h2\x3e\n\x3cp\x3e开发 next.js 的组织叫 zeit，在官网他们的得意作品是 \x3ca href=\x22https:\/\/zeit.co\/now\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enow\x3c\/a\x3e，一个快速部署的工具，同时为免费用户提供三个免费的服务，支持 docker，node 等\x3c\/p\x3e\n\x3cp\x3e看 5 分钟文档就能上手部署 node 项目，比 Heroku 简单的多\x3c\/p\x3e\n\x3cp\x3e这里使用的就是 \x3ca href=\x22https:\/\/zeit.co\/now\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enow\x3c\/a\x3e，首先安装 \x3ca href=\x22https:\/\/github.com\/zeit\/now-cli\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enow-cli\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e在项目根路径下一句命令部署\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22now\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enow\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e线上的路径就不贴出来了，时刻关注 Github 上方的 website 地址，因为每次部署不绑定域名的情况下是 \x3ccode\x3e项目名\x2b随机哈希\x3c\/code\x3e 的域名，绑定域名需要 money。\x3c\/p\x3e\n\x3cp\x3e至于上线就讲这么多，有疑问欢迎交流。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e未来\x3c\/h2\x3e\n\x3cp\x3e下一步要解决几个问题\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e加载更多时的 bug\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e支持移动端\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e福利页面直接展示图片（点击可以全屏大轮播）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e美化时间轴样式\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e说到福利页面本想着不加来着，因为个别写 demo 的人专门把福利列表拎出来做成妹子 App，既然是干货集中营，就应该多些技术元素，福利都是次要的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e到这为止一个 next.js 版本的 gank（干货集中营）完成了，感慨现在开发工具越来越好用，还是之前的想法把好用的工具分享给大家，给一个完整的例子供学习者参考，不再每次都看各个版本的 Hacker News，而是给国内的学习者一个中文版的例子，同时文中也会将实现的时候遇到的问题。\x3c\/p\x3e\n\x3cp\x3e本人 orange 也是再不断的学习当中，本文也是第一次接触学习 next.js 写的项目，文章或项目有不足之处欢迎指正，感谢阅读！\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e文章出自 orange 的 个人博客 \x3ca href=\x22http:\/\/orangexc.xyz\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/orangexc.xyz\/\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React 服务端渲染框架 Next.js 基于 Gank api 实战</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011647874">https://segmentfault.com/a/1190000011647874</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/swbom4mvi4i/" target="_blank">https://alili.tech/archive/swbom4mvi4i/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>