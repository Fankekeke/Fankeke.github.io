<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JavaScript系列——探索history源码之hashHistory的实现"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JavaScript系列——探索history源码之hashHistory的实现 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/t5m0cjfkans/",
				"appid": "1613049289050283", 
				"title": "JavaScript系列——探索history源码之hashHistory的实现 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-19T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/0ngxpz26m9i/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/21ocy6hlglm/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ft5m0cjfkans%2f&text=JavaScript%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94%e6%8e%a2%e7%b4%a2history%e6%ba%90%e7%a0%81%e4%b9%8bhashHistory%e7%9a%84%e5%ae%9e%e7%8e%b0"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ft5m0cjfkans%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ft5m0cjfkans%2f&text=JavaScript%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94%e6%8e%a2%e7%b4%a2history%e6%ba%90%e7%a0%81%e4%b9%8bhashHistory%e7%9a%84%e5%ae%9e%e7%8e%b0"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ft5m0cjfkans%2f&title=JavaScript%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94%e6%8e%a2%e7%b4%a2history%e6%ba%90%e7%a0%81%e4%b9%8bhashHistory%e7%9a%84%e5%ae%9e%e7%8e%b0"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ft5m0cjfkans%2f&is_video=false&description=JavaScript%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94%e6%8e%a2%e7%b4%a2history%e6%ba%90%e7%a0%81%e4%b9%8bhashHistory%e7%9a%84%e5%ae%9e%e7%8e%b0"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JavaScript%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94%e6%8e%a2%e7%b4%a2history%e6%ba%90%e7%a0%81%e4%b9%8bhashHistory%e7%9a%84%e5%ae%9e%e7%8e%b0&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ft5m0cjfkans%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ft5m0cjfkans%2f&title=JavaScript%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94%e6%8e%a2%e7%b4%a2history%e6%ba%90%e7%a0%81%e4%b9%8bhashHistory%e7%9a%84%e5%ae%9e%e7%8e%b0"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ft5m0cjfkans%2f&title=JavaScript%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94%e6%8e%a2%e7%b4%a2history%e6%ba%90%e7%a0%81%e4%b9%8bhashHistory%e7%9a%84%e5%ae%9e%e7%8e%b0"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ft5m0cjfkans%2f&title=JavaScript%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94%e6%8e%a2%e7%b4%a2history%e6%ba%90%e7%a0%81%e4%b9%8bhashHistory%e7%9a%84%e5%ae%9e%e7%8e%b0"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ft5m0cjfkans%2f&title=JavaScript%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94%e6%8e%a2%e7%b4%a2history%e6%ba%90%e7%a0%81%e4%b9%8bhashHistory%e7%9a%84%e5%ae%9e%e7%8e%b0"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JavaScript系列——探索history源码之hashHistory的实现</h1><div class="meta"><div class="postdate"><time datetime="2018-12-19" itemprop="datePublished">2018-12-19</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch3 id=\x22articleHeader0\x22\x3ehistory简介\x3c\/h3\x3e\n\x3cp\x3e我们不探寻它的历史，只关注技术，通常有2种history，分别是hashHistory和browserHistory，本文带领大家从零开始实现一个hashHistory。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22hashHistory：\x27#\/home\x27\nbrowserHistory: \x27\/home\x27\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ehashHistory：\x3cspan class=\x22hljs-string\x22\x3e\x27#\/home\x27\x3c\/span\x3e\nbrowserHistory: \x3cspan class=\x22hljs-string\x22\x3e\x27\/home\x27\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e下面的实现方案是根据官方history源码来分析的，你可以下载\x3ca href=\x22https:\/\/github.com\/ReactTraining\/history\/blob\/master\/modules\/createHashHistory.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehashHistory源码\x3c\/a\x3e结合本文学习。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e实现方案\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e1、创建createHashHistory函数\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const createHashHistory = () =\x3e { \n    const history = {}\n    return history\n}\nexport default createHashHistory\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e createHashHistory = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e { \n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e history = {}\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e history\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e createHashHistory\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e2、先要了解history对象长什么样，接着，我们一个个去实现它\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22history = {\n    length: 1, \/\/Number\n    action: \x26quot;POP\x26quot;, \/\/String\n    location: {}, \/\/Object\n    createHref, \/\/函数\n    push, \/\/函数\n    replace, \/\/函数\n    go, \/\/函数\n    goBack, \/\/函数\n    goForward, \/\/函数\n    listen \/\/函数\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ehistory = {\n    \x3cspan class=\x22hljs-attr\x22\x3elength\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/Number\x3c\/span\x3e\n    action: \x3cspan class=\x22hljs-string\x22\x3e\x22POP\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/String\x3c\/span\x3e\n    location: {}, \x3cspan class=\x22hljs-comment\x22\x3e\/\/Object\x3c\/span\x3e\n    createHref, \x3cspan class=\x22hljs-comment\x22\x3e\/\/函数\x3c\/span\x3e\n    push, \x3cspan class=\x22hljs-comment\x22\x3e\/\/函数\x3c\/span\x3e\n    replace, \x3cspan class=\x22hljs-comment\x22\x3e\/\/函数\x3c\/span\x3e\n    go, \x3cspan class=\x22hljs-comment\x22\x3e\/\/函数\x3c\/span\x3e\n    goBack, \x3cspan class=\x22hljs-comment\x22\x3e\/\/函数\x3c\/span\x3e\n    goForward, \x3cspan class=\x22hljs-comment\x22\x3e\/\/函数\x3c\/span\x3e\n    listen \x3cspan class=\x22hljs-comment\x22\x3e\/\/函数\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e3、实现length\x3c\/strong\x3e\x3cbr\x3e在window下面有一个history对象，可以用来获取length。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const globalHistory = window.history\nhistory = {\n    length: globalHistory.length\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e globalHistory = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.history\nhistory = {\n    \x3cspan class=\x22hljs-attr\x22\x3elength\x3c\/span\x3e: globalHistory.length\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e4、action默认为POP，它还可能是PUSH或者REPLACE。我们不在这一步实现它，等下面实现push和replace的时候再来实现。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e5、实现location\x3c\/strong\x3e\x3cbr\x3elocation对象包含下面几个key，这里能用到的是pathname。history.location和window.location是不一样的，history.location是window.location的精简版。你可以在浏览器控制台打印window.location看一下完整的location对象。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22location = {\n    hash:\x26quot;\x26quot;,\n    pathname:\x26quot;\/\x26quot;,\n    search:\x26quot;\x26quot;,\n    state:undefined\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3elocation = {\n    \x3cspan class=\x22hljs-attr\x22\x3ehash\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epathname\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22\/\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3esearch\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3estate\x3c\/span\x3e:\x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e定义一个getDOMLocation函数，用来获取封装后的location。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const decodePath = path =\x3e\n  path.charAt(0) === \x26quot;\/\x26quot; ? path : \x26quot;\/\x26quot; \x2b path\n\nconst getHashPath = () =\x3e {\n    \/\/如果url存在#，则去掉#，返回路径\n    \/\/比如：\x26quot;http:\/\/localhost:8080\/#\/\x26quot;，返回\x27\/\x27\n    const href = window.location.href\n    const hashIndex = href.indexOf(\x26quot;#\x26quot;)\n    return hashIndex === -1 ? \x26quot;\x26quot; : href.substring(hashIndex \x2b 1)\n}\n\nconst getDOMLocation = () =\x3e {\n    \/\/getHashPath截取url的路由，如果存在#，则去掉#\n    let path = decodePath(getHashPath())     \n    \/\/创建location\n    return createLocation(path)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e decodePath = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3epath\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n  path.charAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) === \x3cspan class=\x22hljs-string\x22\x3e\x22\/\x22\x3c\/span\x3e ? path : \x3cspan class=\x22hljs-string\x22\x3e\x22\/\x22\x3c\/span\x3e \x2b path\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e getHashPath = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果url存在#，则去掉#，返回路径\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/比如：\x22http:\/\/localhost:8080\/#\/\x22，返回\x27\/\x27\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e href = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hashIndex = href.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x22#\x22\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e hashIndex === \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e : href.substring(hashIndex \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e getDOMLocation = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/getHashPath截取url的路由，如果存在#，则去掉#\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e path = decodePath(getHashPath())     \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/创建location\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e createLocation(path)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这一步的核心就是createLocation()的实现。但是，它不复杂，只是代码有点长，如果要了解，请看源码 \x3ca href=\x22https:\/\/github.com\/ReactTraining\/history\/blob\/master\/modules\/LocationUtils.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecreateLocation\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e6、实现createHref\x3c\/strong\x3e\x3cbr\x3e你可能没有用过history.createHref()，它用来创建一个hash路由，也就是\x27#\/\x27或者\x27#\/home\x27这类的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const createPath = location =\x3e {\n  const { pathname, search, hash } = location\n  let path = pathname || \x26quot;\/\x26quot;\n  if (search \x26amp;\x26amp; search !== \x26quot;?\x26quot;)\n    path \x2b= search.charAt(0) === \x26quot;?\x26quot; ? search : `?${search}`\n  if (hash \x26amp;\x26amp; hash !== \x26quot;#\x26quot;) path \x2b= hash.charAt(0) === \x26quot;#\x26quot; ? hash : `#${hash}`\n  return path\n}\n\nconst createHref = location =\x3e\n    \x26quot;#\x26quot; \x2b encodePath(createPath(location))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e createPath = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3elocation\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { pathname, search, hash } = location\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e path = pathname || \x3cspan class=\x22hljs-string\x22\x3e\x22\/\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (search \x26amp;\x26amp; search !== \x3cspan class=\x22hljs-string\x22\x3e\x22?\x22\x3c\/span\x3e)\n    path \x2b= search.charAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) === \x3cspan class=\x22hljs-string\x22\x3e\x22?\x22\x3c\/span\x3e ? search : \x3cspan class=\x22hljs-string\x22\x3e`?\x3cspan class=\x22hljs-subst\x22\x3e${search}\x3c\/span\x3e`\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hash \x26amp;\x26amp; hash !== \x3cspan class=\x22hljs-string\x22\x3e\x22#\x22\x3c\/span\x3e) path \x2b= hash.charAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) === \x3cspan class=\x22hljs-string\x22\x3e\x22#\x22\x3c\/span\x3e ? hash : \x3cspan class=\x22hljs-string\x22\x3e`#\x3cspan class=\x22hljs-subst\x22\x3e${hash}\x3c\/span\x3e`\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e path\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e createHref = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3elocation\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x22#\x22\x3c\/span\x3e \x2b encodePath(createPath(location))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e7、实现push方法\x3c\/strong\x3e\x3cbr\x3e我们在使用push的时候，通常是history.push(\x27\/home\x27)这种形式，不需要自己加#。\x3cbr\x3epush实现的原理：判断push传入的路由和当前url的路由是否一样，如果一样，则不更新路由，否则就更新路由。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/更新history对象的值，length、location和action\nconst setState = nextState =\x3e {\n    Object.assign(history, nextState)    \n    history.length = globalHistory.length        \n    transitionManager.notifyListeners(history.location, history.action)\n}\n\/\/notifyListeners函数用来通知history的更新\n const notifyListeners = (...args) =\x3e {\n    listeners.forEach(listener =\x3e listener(...args))\n  }\n\/\/更新路由\nconst pushHashPath = path =\x3e (window.location.hash = path)\n\n\/\/push核心代码\nconst push = (path, state) =\x3e {\n    \/\/更新action为\x27PUSH\x27\n    const action = \x26quot;PUSH\x26quot;\n    \/\/更新location对象\n    const location = createLocation(\n       path,\n       undefined,\n       undefined,\n       history.location\n    )   \n    \/\/更新路由前的确认操作，confirmTransitionTo函数内部会处理好路由切换的状态判断，如果ok，则执行最后一个参数，它是回调函数。\n    transitionManager.confirmTransitionTo(\n       location,\n       action,\n       getUserConfirmation,\n       ok =\x3e {\n           \/\/如果不符合路由切换的条件，就不更新路由\n           if (!ok) return               \n           \/\/获取location中的路径pathname，比如\x27\/home\x27\n           const path = createPath(location)\n           const encodedPath = encodePath(path)\n           \/\/比较当前的url中的路由和push函数传入的路由是否相同，不相同则hashChanged为true。\n           const hashChanged = getHashPath() !== encodedPath          \n           if (hashChanged) {\n               \/\/路由允许更新\n               ignorePath = path\n               \/\/更新路由\n               pushHashPath(encodedPath)              \n               const prevIndex = allPaths.lastIndexOf(createPath(history.location))\n               const nextPaths = allPaths.slice(0, prevIndex === -1 ? 0 : prevIndex \x2b 1)                    \n               nextPaths.push(path)\n               allPaths = nextPaths     \n               \/\/setState更新history对象。               \n               setState({ action, location })\n          } else {\n              \/\/push的路由和当前路由一样，会发出一个警告“Hash history cannot PUSH the same path; a new entry will not be added to the history stack”\n              setState()\n          }\n       }\n    )\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/更新history对象的值，length、location和action\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e setState = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3enextState\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign(history, nextState)    \n    history.length = globalHistory.length        \n    transitionManager.notifyListeners(history.location, history.action)\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/notifyListeners函数用来通知history的更新\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e notifyListeners = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e...args\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    listeners.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3elistener\x3c\/span\x3e =\x26gt;\x3c\/span\x3e listener(...args))\n  }\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/更新路由\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e pushHashPath = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3epath\x3c\/span\x3e =\x26gt;\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.hash = path)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/push核心代码\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e push = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3epath, state\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/更新action为\x27PUSH\x27\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e action = \x3cspan class=\x22hljs-string\x22\x3e\x22PUSH\x22\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/更新location对象\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e location = createLocation(\n       path,\n       \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e,\n       \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e,\n       history.location\n    )   \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/更新路由前的确认操作，confirmTransitionTo函数内部会处理好路由切换的状态判断，如果ok，则执行最后一个参数，它是回调函数。\x3c\/span\x3e\n    transitionManager.confirmTransitionTo(\n       location,\n       action,\n       getUserConfirmation,\n       ok =\x26gt; {\n           \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果不符合路由切换的条件，就不更新路由\x3c\/span\x3e\n           \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!ok) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e               \n           \x3cspan class=\x22hljs-comment\x22\x3e\/\/获取location中的路径pathname，比如\x27\/home\x27\x3c\/span\x3e\n           \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e path = createPath(location)\n           \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e encodedPath = encodePath(path)\n           \x3cspan class=\x22hljs-comment\x22\x3e\/\/比较当前的url中的路由和push函数传入的路由是否相同，不相同则hashChanged为true。\x3c\/span\x3e\n           \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hashChanged = getHashPath() !== encodedPath          \n           \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hashChanged) {\n               \x3cspan class=\x22hljs-comment\x22\x3e\/\/路由允许更新\x3c\/span\x3e\n               ignorePath = path\n               \x3cspan class=\x22hljs-comment\x22\x3e\/\/更新路由\x3c\/span\x3e\n               pushHashPath(encodedPath)              \n               \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e prevIndex = allPaths.lastIndexOf(createPath(history.location))\n               \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e nextPaths = allPaths.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, prevIndex === \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e ? \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e : prevIndex \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)                    \n               nextPaths.push(path)\n               allPaths = nextPaths     \n               \x3cspan class=\x22hljs-comment\x22\x3e\/\/setState更新history对象。               \x3c\/span\x3e\n               setState({ action, location })\n          } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n              \x3cspan class=\x22hljs-comment\x22\x3e\/\/push的路由和当前路由一样，会发出一个警告“Hash history cannot PUSH the same path; a new entry will not be added to the history stack”\x3c\/span\x3e\n              setState()\n          }\n       }\n    )\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e8、实现replace\x3c\/strong\x3e\x3cbr\x3ereplace和push都能更新路由，但是replace是更新当前路由，而push是增加一个历史记录。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/更新路由\nconst replaceHashPath = path =\x3e {\n    const hashIndex = window.location.href.indexOf(\x26quot;#\x26quot;)   \n    window.location.replace(\n        window.location.href.slice(0, hashIndex \x3e= 0 ? hashIndex : 0) \x2b \x26quot;#\x26quot; \x2b path\n    )\n}\n    \/\/replace核心代码\n    const replace = (path, state) =\x3e {\n        const action = \x26quot;REPLACE\x26quot;\n        const location = createLocation(\n            path,\n            undefined,\n            undefined,\n            history.location\n        )      \n        transitionManager.confirmTransitionTo(\n            location,\n            action,\n            getUserConfirmation,\n            ok =\x3e {\n                if (!ok) return              \n                const path = createPath(location)\n                const encodedPath = encodePath(path)\n                const hashChanged = getHashPath() !== encodedPath  \n                \/\/到这里为止，前面的代码和push函数的实现都是一样的\n                             \n                if (hashChanged) {\n                    ignorePath = path\n                    \/\/更新路由\n                    replaceHashPath(encodedPath)\n                }                \n                const prevIndex = allPaths.indexOf(createPath(history.location))                \n                if (prevIndex !== -1) allPaths[prevIndex] = path               \n                setState({ action, location })\n            }\n        )\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/更新路由\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e replaceHashPath = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3epath\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hashIndex = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x22#\x22\x3c\/span\x3e)   \n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.replace(\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, hashIndex \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ? hashIndex : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22#\x22\x3c\/span\x3e \x2b path\n    )\n}\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/replace核心代码\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e replace = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3epath, state\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e action = \x3cspan class=\x22hljs-string\x22\x3e\x22REPLACE\x22\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e location = createLocation(\n            path,\n            \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e,\n            history.location\n        )      \n        transitionManager.confirmTransitionTo(\n            location,\n            action,\n            getUserConfirmation,\n            ok =\x26gt; {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!ok) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e              \n                \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e path = createPath(location)\n                \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e encodedPath = encodePath(path)\n                \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hashChanged = getHashPath() !== encodedPath  \n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/到这里为止，前面的代码和push函数的实现都是一样的\x3c\/span\x3e\n                             \n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (hashChanged) {\n                    ignorePath = path\n                    \x3cspan class=\x22hljs-comment\x22\x3e\/\/更新路由\x3c\/span\x3e\n                    replaceHashPath(encodedPath)\n                }                \n                \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e prevIndex = allPaths.indexOf(createPath(history.location))                \n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (prevIndex !== \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) allPaths[prevIndex] = path               \n                setState({ action, location })\n            }\n        )\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e9、实现go\x3c\/strong\x3e\x3cbr\x3ego方法的使用是history.go(-1)这种形式\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/globalHistory是window.history\nconst go = n =\x3e globalHistory.go(n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/globalHistory是window.history\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e go = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3en\x3c\/span\x3e =\x26gt;\x3c\/span\x3e globalHistory.go(n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e10、实现goBack\x3c\/strong\x3e\x3cbr\x3e这个应该能一眼看懂了\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const goBack = () =\x3e go(-1)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e goBack = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e go(\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e11、实现goForward\x3c\/strong\x3e\x3cbr\x3e这个应该也能一眼看懂了\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const goForward = () =\x3e go(1)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e goForward = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e go(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e12、实现listen\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const listen = listener =\x3e {\n    const unlisten = transitionManager.appendListener(listener)\n    checkDOMListeners(1)    \n    return () =\x3e {\n        checkDOMListeners(-1)\n        unlisten()\n    }\n}\n\n\/\/监听hashchange的改变，handleHashChange函数用来判断是哪种类型的路由更新，replace、push等各种hash改变都实现了一个函数，具体看源码。\nconst checkDOMListeners = delta =\x3e {\n    listenerCount \x2b= delta    \n    if (listenerCount === 1) {\n        \/\/注册监听函数\n        window.addEventListener(\x27hashchange\x27, handleHashChange)\n    } else if (listenerCount === 0) {\n        \/\/移除监听函数\n        window.removeEventListener(\x27hashchange\x27, handleHashChange)\n    }\n}\n\n  \/\/appendListener函数实现\n  let listeners = []\n  const appendListener = fn =\x3e {\n    let isActive = true\n    const listener = (...args) =\x3e {\n      if (isActive) fn(...args)\n    }\n    listeners.push(listener)\n    return () =\x3e {\n      isActive = false\n      listeners = listeners.filter(item =\x3e item !== listener)\n    }\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e listen = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3elistener\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e unlisten = transitionManager.appendListener(listener)\n    checkDOMListeners(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)    \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        checkDOMListeners(\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e)\n        unlisten()\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/监听hashchange的改变，handleHashChange函数用来判断是哪种类型的路由更新，replace、push等各种hash改变都实现了一个函数，具体看源码。\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e checkDOMListeners = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edelta\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    listenerCount \x2b= delta    \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (listenerCount === \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/注册监听函数\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27hashchange\x27\x3c\/span\x3e, handleHashChange)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (listenerCount === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/移除监听函数\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.removeEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27hashchange\x27\x3c\/span\x3e, handleHashChange)\n    }\n}\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/appendListener函数实现\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e listeners = []\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e appendListener = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e isActive = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e listener = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e...args\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isActive) fn(...args)\n    }\n    listeners.push(listener)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      isActive = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n      listeners = listeners.filter(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e =\x26gt;\x3c\/span\x3e item !== listener)\n    }\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e总结\x3c\/h3\x3e\n\x3cp\x3ehistory对象的所有属性和方法都实现了一遍，在react-router中，将history对象封装进了Router、Route等组件中，使得你可以在react组件中通过this.props.history读取。\x3c\/p\x3e\n\x3cp\x3e看完源码，你会发现history的实现真的不复杂，找准思路，一个个函数去实现，再考虑兼容性，就非常完美了，以后你在其他博客上看到有人宣传自己搞了个自己的路由插件，不要觉得很牛逼，重构history换个新姿势就是一个插件了。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JavaScript系列——探索history源码之hashHistory的实现</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012656017">https://segmentfault.com/a/1190000012656017</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/t5m0cjfkans/" target="_blank">https://alili.tech/archive/t5m0cjfkans/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>