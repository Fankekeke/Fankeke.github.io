<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="玩转 React（七）- 组件之间的数据共享"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>玩转 React（七）- 组件之间的数据共享 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/tdv8pbpgur/",
				"appid": "1613049289050283", 
				"title": "玩转 React（七）- 组件之间的数据共享 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-22T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/bkgnt44mx2/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/t699itgihu/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ftdv8pbpgur%2f&text=%e7%8e%a9%e8%bd%ac%20React%ef%bc%88%e4%b8%83%ef%bc%89-%20%e7%bb%84%e4%bb%b6%e4%b9%8b%e9%97%b4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ftdv8pbpgur%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ftdv8pbpgur%2f&text=%e7%8e%a9%e8%bd%ac%20React%ef%bc%88%e4%b8%83%ef%bc%89-%20%e7%bb%84%e4%bb%b6%e4%b9%8b%e9%97%b4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ftdv8pbpgur%2f&title=%e7%8e%a9%e8%bd%ac%20React%ef%bc%88%e4%b8%83%ef%bc%89-%20%e7%bb%84%e4%bb%b6%e4%b9%8b%e9%97%b4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ftdv8pbpgur%2f&is_video=false&description=%e7%8e%a9%e8%bd%ac%20React%ef%bc%88%e4%b8%83%ef%bc%89-%20%e7%bb%84%e4%bb%b6%e4%b9%8b%e9%97%b4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%8e%a9%e8%bd%ac%20React%ef%bc%88%e4%b8%83%ef%bc%89-%20%e7%bb%84%e4%bb%b6%e4%b9%8b%e9%97%b4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ftdv8pbpgur%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ftdv8pbpgur%2f&title=%e7%8e%a9%e8%bd%ac%20React%ef%bc%88%e4%b8%83%ef%bc%89-%20%e7%bb%84%e4%bb%b6%e4%b9%8b%e9%97%b4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftdv8pbpgur%2f&title=%e7%8e%a9%e8%bd%ac%20React%ef%bc%88%e4%b8%83%ef%bc%89-%20%e7%bb%84%e4%bb%b6%e4%b9%8b%e9%97%b4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftdv8pbpgur%2f&title=%e7%8e%a9%e8%bd%ac%20React%ef%bc%88%e4%b8%83%ef%bc%89-%20%e7%bb%84%e4%bb%b6%e4%b9%8b%e9%97%b4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftdv8pbpgur%2f&title=%e7%8e%a9%e8%bd%ac%20React%ef%bc%88%e4%b8%83%ef%bc%89-%20%e7%bb%84%e4%bb%b6%e4%b9%8b%e9%97%b4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">玩转 React（七）- 组件之间的数据共享</h1><div class="meta"><div class="postdate"><time datetime="2018-12-22" itemprop="datePublished">2018-12-22</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e上一篇文章 \x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000011877137\x22\x3e玩转 React（六）- 处理事件\x3c\/a\x3e 介绍了在 React 中如何处理用户事件，以及 React 事件机制与原生 DOM 事件的差异和注意的问题，同时也介绍了事件处理函数中 this 的指向问题以及处理的几种方式及其优缺点。\x3c\/p\x3e\n\x3cp\x3e大家在阅读的过程中有任何为题可以给我留言，同时欢迎大家加入玩转 React 微信群，我的微信号是 \x3cstrong\x3e\x3ccode\x3eleobaba88\x3c\/code\x3e\x3c\/strong\x3e，先加我好友，验证信息：\x3cstrong\x3e玩转 React\x3c\/strong\x3e，然后我会拉你进群。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e今天这篇文章要讲的内容是关于多个组件之间如何共享数据，或者说是如何通信的。只有掌握了正确的组件之间通信的方式，才能在开发交互复杂的前端应用时做到游刃有余，所谓正确的方式也就是符合 React 设计理念的方式。使用一个框架时，一定要遵从框架的最佳实践，人家框架是这样设计的，你偏要那样来用，用得不爽还要喷其不好用，那就不应该了。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3e内容摘要\x3c\/h1\x3e\n\x3cul\x3e\n\x3cli\x3eReact 中的数据是单向自顶向下传递的。\x3c\/li\x3e\n\x3cli\x3e单向数据流与双向绑定的差异。\x3c\/li\x3e\n\x3cli\x3e最符合 React 理念的组件之间共享数据的方式。\x3c\/li\x3e\n\x3cli\x3e数据唯一来源原则。\x3c\/li\x3e\n\x3cli\x3e一些不好的方式。\x3c\/li\x3e\n\x3cli\x3e先跟 Redux 打个招呼。\x3c\/li\x3e\n\x3cli\x3e其他一些关于组件间通信的内容（context、ref）。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e组件之间通信的最佳方式\x3c\/h1\x3e\n\x3cp\x3e现在我们就来探讨下，什么样的方式才是 React 中组件之间通信的正确方式。\x3c\/p\x3e\n\x3cp\x3e在前面的文章中，我们有说过，React 之所以能胜任大型复杂前端项目的开发，是因为其 \x3cstrong\x3e单向数据流\x3c\/strong\x3e 这一重要特性，单向数据流能让视图更新逻辑变得简单，从原始的对 DOM 操作变为对数据操作，简单了就容易维护。\x3c\/p\x3e\n\x3cp\x3eReact 组件中数据的流动方向是\x3cstrong\x3e自顶向下\x3c\/strong\x3e的，也就是说在组件树中，数据只能从父组件以属性的方式传递到子组件，父组件的数据可能是其接收到的属性，也可能是自身的内部状态。\x3c\/p\x3e\n\x3cp\x3e有些同学这里可能会比较困惑，说子组件明明可以通过一个函数属性将数据传递给父组件呀。好多同学甚至因此搞不明白单向数据流和双向绑定的差异。其实换个角度考虑一下就清楚很多了，既然“数据传递”这个词区分度不够大，那就换个区分度比较大的说法。我们可以这样理解，函数属性是子组件用来通知父组件发生了什么，它更像是子组件触发的一个事件，父组件可以依据业务逻辑来选择如何处理这个事件，它可以更新数据后重新传递给子组件，也可以置之不理。\x3c\/p\x3e\n\x3cp\x3e函数属性（或者说事件）在组件之间通信过程中是必不可少的，但是切莫让它影响了大家对单向数据流这一概念的理解。\x3c\/p\x3e\n\x3cp\x3e数据双向绑定不一样，在双向绑定中父组件将数据传递给子组件，子组件修改数据后会将数据回传同步给父组件，父组件是无条件接受的。这里就不过多去说哪个好哪个差了，有兴趣的同学可以自己去体会，懒一点的就坚持学习 React 吧。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e状态提升（Lifting State Up）\x3c\/h2\x3e\n\x3cp\x3e既然 React 中的数据是单向自顶向下传递的，那么符合 React 这一特性的组件通信方式就显而易见了。\x3c\/p\x3e\n\x3cp\x3e状态提升的意思是，当组件 A 需要依赖另外一个组件 B 的内部状态，而他们又不是父子关系时，需要将组件 B 的内部状态提升到他们公共的祖先组件中管理。这样他们就都可以通过属性接收到这份数据了。\x3c\/p\x3e\n\x3cp\x3e当组件 B 需要对数据进行变更时，可以通过函数属性来通知祖先组件对数据更新，然后重新传递给子组件。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e唯一数据来源（Single source of truth）\x3c\/h2\x3e\n\x3cp\x3e有些同学可能又会迷惑，为什么多个组件之间必须要共用同一份数据，我可不可以引入一个事件库，一个组件分发事件，另一个组件注册相应的事件来接受数据自己维护。\x3c\/p\x3e\n\x3cp\x3e类似的方案五花八门，会有很多，我认为这样做当然是不好的，会有如下问题：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e破坏了组件的封装性，易于复用的组件都是相对独立的，它只需要定义自己需要的数据和行为（函数属性）即可，我不需要谁帮我分发事件。\x3c\/li\x3e\n\x3cli\x3e数据传递是不连续的，这样做会增加项目的复杂性，当项目到一定阶段后，对这份数据的依赖就变得千丝万缕、难以维护了。\x3c\/li\x3e\n\x3cli\x3e相同的数据会有多个副本，需要保证数据同步，在增加项目复杂性的同时也提高了出现BUG的几率。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e这是我个人的看法，我也确实有遇到过这种用法，有不同意见大家可以进群交流。\x3c\/p\x3e\n\x3cp\x3e数据唯一来源是官方推荐的数据共享的原则，也是最符合 React 设计理念，与单向数据流特性相辅相成的，希望大家务必遵守。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3eRedux\x3c\/h2\x3e\n\x3cp\x3eRedux 是一个状态管理库，它不是专属于 React 技术栈的，但是跟 React 配合起来相当不错。\x3c\/p\x3e\n\x3cp\x3e当我们的前端应用规模较小的时候，我们可以不引入任何的状态管理工具，只需要依据上面说的状态提升的方式来管理应用状态即可。为了让应用的状态更直观，你可以将跟组件作为状态总线，来管理整个应用所有的状态。而且对于小规模的项目是推荐这样来做的，没有必要高射炮打蚊子，过渡设计。\x3c\/p\x3e\n\x3cp\x3e但是当前端应用规模变得比较复杂时，我们就需要有类似 Redux 这样一个来专门进行状态管理的东西了。它的职责如下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e维护一个数据仓库（store）管理整个应用的状态（state），确保数据的唯一来源。\x3c\/li\x3e\n\x3cli\x3e可以通过 dispatch 方法分发一个 action，来通知 Redux 需要对数据进行变更。\x3c\/li\x3e\n\x3cli\x3eRedux 接收到 action 后可以依据 action 的类型对 state 进行相应的修改。\x3c\/li\x3e\n\x3cli\x3e数据跟新后 Redux 会触发注册的监听器（如：更新组件属性），完成视图更新。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3eRedux 跟 React 一起来用，更详细的介绍可以参考：\x3ca href=\x22https:\/\/redux.js.org\/docs\/basics\/UsageWithReact.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e官方文档\x3c\/a\x3e，这里大家可以先简单了解下，在后面关于 React 实战的文章中也会详细介绍 Redux 的使用。\x3c\/p\x3e\n\x3cp\x3e类似的状态管理工具还有：\x3ca href=\x22https:\/\/mobx.js.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMobxJS\x3c\/a\x3e，感兴趣的同学也可以了解下。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader5\x22\x3e关于组件通信的其他内容\x3c\/h1\x3e\n\x3cp\x3e在 React 中还有一些其他的与组件间通信相关的知识，这里也顺便跟大家介绍下。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3econtext\x3c\/h2\x3e\n\x3cp\x3e首先说一下，这是一个不推荐使用的特性，React 官方有明确说明，这是一个实验性的API，可能会在后面的版本中去掉这个东西。所以我是从来不用的，呵呵！\x3c\/p\x3e\n\x3cp\x3econtext 的作用是啥呢，当大家有过 React 实战经验时，很容易遇到这种场景，如果组件的层级组织得不合适，可能会嵌套的非常深，当底层的一个组件需要使用顶层一个组件的数据时，需要通过属性一层层传递下去，非常繁琐。\x3c\/p\x3e\n\x3cp\x3econtext 就是解决这个问题的，只需要在顶层组件中声明 context，那它的所有子组件可以通过 this.context 直接获取得到。如下实例所示：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React from \x27react\x27;\nimport PropTypes from \x27prop-types\x27;\n\nclass Button extends React.Component {\n  render() {\n    return (\n      \x3cbutton style=\x22{{\x22background: this.context.color\x22}}\x22\x3e\n        {this.props.children}\n      \x3c\/button\x3e\n    );\n  }\n}\n\nButton.contextTypes = {\n  color: PropTypes.string\n};\n\nclass Message extends React.Component {\n  render() {\n    return (\n      \x3cdiv\x3e\n        {this.props.text} \x3cButton\x3eDelete\x3c\/Button\x3e\n      \x3c\/div\x3e\n    );\n  }\n}\n\nclass MessageList extends React.Component {\n  getChildContext() {\n    return {color: \x26quot;purple\x26quot;};\n  }\n\n  render() {\n    const children = this.props.messages.map((message) =\x3e\n      \x3cMessage text={message.text} \/\x3e\n    );\n    return \x3cdiv\x3e{children}\x3c\/div\x3e;\n  }\n}\n\nMessageList.childContextTypes = {\n  color: PropTypes.string\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e from \x3cspan class=\x22hljs-symbol\x22\x3e\x27reac\x3c\/span\x3et\x27;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e from \x3cspan class=\x22hljs-symbol\x22\x3e\x27prop\x3c\/span\x3e-types\x27;\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eButton\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;button style=\x22{{\x22background: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context.color\x22}}\x22\x26gt;\n        {\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.children}\n      \x26lt;\/button\x26gt;\n    );\n  }\n}\n\n\x3cspan class=\x22hljs-type\x22\x3eButton\x3c\/span\x3e.contextTypes = {\n  color: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.string\n};\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMessage\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;div\x26gt;\n        {\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.text} \x26lt;\x3cspan class=\x22hljs-type\x22\x3eButton\x3c\/span\x3e\x26gt;\x3cspan class=\x22hljs-type\x22\x3eDelete\x3c\/span\x3e\x26lt;\/\x3cspan class=\x22hljs-type\x22\x3eButton\x3c\/span\x3e\x26gt;\n      \x26lt;\/div\x26gt;\n    );\n  }\n}\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMessageList\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  getChildContext() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {color: \x3cspan class=\x22hljs-string\x22\x3e\x22purple\x22\x3c\/span\x3e};\n  }\n\n  render() {\n    const children = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.messages.map((message) =\x26gt;\n      \x26lt;\x3cspan class=\x22hljs-type\x22\x3eMessage\x3c\/span\x3e text={message.text} \/\x26gt;\n    );\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;div\x26gt;{children}\x26lt;\/div\x26gt;;\n  }\n}\n\n\x3cspan class=\x22hljs-type\x22\x3eMessageList\x3c\/span\x3e.childContextTypes = {\n  color: \x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.string\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e实例中，组件层级关系是：MessageList -\x26gt; Message -\x26gt; Button。\x3c\/p\x3e\n\x3cp\x3eMessageList 组件中维护一个 \x3ccode\x3ecolor\x3c\/code\x3e 值用于 Button 组件的背景色，一般情况下我们需要将 color 以属性的方式传给 Message 组件，再通过属性传给 Button 组件。然后在实例中，通过 React 的 context 功能，MessageList 可以将 color 的值越过 Message 直接传给 Button。\x3c\/p\x3e\n\x3cp\x3e是不是很方便？确实很方便，但是这会导致数据传递不连续，过度使用会使得项目逻辑变得不直观，增加项目维护的复杂性。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3eref\x3c\/h2\x3e\n\x3cp\x3e每一个 React 组件有一个特殊的属性 \x3ccode\x3eref\x3c\/code\x3e，该属性的值可以是一个字符串，也可以是一个函数。由于字符串形式的 ref 在内部实现和实际使用中存在诸多问题，官方不推荐使用，而且可能在未来的版本中会移除，所以我们也没必要聊它了，只要大家在看到字符串形式的 ref 属性时知道也有这种用法就可以了。\x3c\/p\x3e\n\x3cp\x3e当 \x3ccode\x3eref\x3c\/code\x3e 属性值是一个函数时，如果组件是一个 HTML 元素兼容的 React 内部组件时（如：div、img 等），函数接收其对应的原生 DOM 节点作为参数。\x3cstrong\x3e如果组件是一个我们以类的方式定义的组件时，函数接收该组件类的实例作为参数。\x3c\/strong\x3e需要注意的是，如果组件是一个以函数的方式定义的组件，那么设置为 \x3ccode\x3eref\x3c\/code\x3e 值得函数永远都会接收到一个 \x3ccode\x3enull\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e那么 \x3ccode\x3eref\x3c\/code\x3e 与组件之间的通信有什么关系呢？请看上段文字加粗内容和下面这个实例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class UserForm extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      name: null,\n      age: null\n    }\n  }\n  formData() {\n    return this.state\n  }\n  handleFieldChange(e) {\n    const { name, value } = e.target\n    this.setState({\n      [name]: value\n    })\n  }\n  render() {\n    return (\n      \x3cdiv\x3e\n        \x3cinput\n          type=\x26quot;text\x26quot;\n          name=\x26quot;name\x26quot;\n          placeholder=\x26quot;Name\x26quot;\n          onChange={e =\x3e this.handleFieldChange(e)}\n        \/\x3e\n        \x3cinput\n          type=\x26quot;text\x26quot;\n          name=\x26quot;age\x26quot;\n          placeholder=\x26quot;Age\x26quot;\n          onChange={e =\x3e this.handleFieldChange(e)}\n        \/\x3e\n      \x3c\/div\x3e\n    )\n  }\n}\nclass App extends React.Component {\n  handleSubmit() {\n    const formData = this.form.formData()\n    alert(`formData: ${JSON.stringify(formData)}`)\n  }\n  render() {\n    return (\n      \x3cdiv\x3e\n        \x3cUserForm ref={form =\x3e {this.form = form\x22}}\x22 \/\x3e\n        \x3cbutton onClick={() =\x3e this.handleSubmit()}\x3eSubmit\x3c\/button\x3e\n      \x3c\/div\x3e\n    )\n  }\n}\n\nReactDOM.render(\x3cApp \/\x3e, document.querySelector(\x27#root\x27))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eUserForm\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  constructor(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props)\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = {\n      name: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e,\n      age: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    }\n  }\n  formData() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state\n  }\n  handleFieldChange(e) {\n    const { name, value } = e.target\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n      [name]: value\n    })\n  }\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;div\x26gt;\n        \x26lt;input\n          \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e\n          name=\x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e\n          placeholder=\x3cspan class=\x22hljs-string\x22\x3e\x22Name\x22\x3c\/span\x3e\n          onChange={e =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleFieldChange(e)}\n        \/\x26gt;\n        \x26lt;input\n          \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e\n          name=\x3cspan class=\x22hljs-string\x22\x3e\x22age\x22\x3c\/span\x3e\n          placeholder=\x3cspan class=\x22hljs-string\x22\x3e\x22Age\x22\x3c\/span\x3e\n          onChange={e =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleFieldChange(e)}\n        \/\x26gt;\n      \x26lt;\/div\x26gt;\n    )\n  }\n}\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  handleSubmit() {\n    const formData = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.form.formData()\n    alert(`formData: ${\x3cspan class=\x22hljs-type\x22\x3eJSON\x3c\/span\x3e.stringify(formData)}`)\n  }\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;div\x26gt;\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eUserForm\x3c\/span\x3e ref={form =\x26gt; {\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.form = form\x22}}\x22 \/\x26gt;\n        \x26lt;button onClick={() =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleSubmit()}\x26gt;\x3cspan class=\x22hljs-type\x22\x3eSubmit\x3c\/span\x3e\x26lt;\/button\x26gt;\n      \x26lt;\/div\x26gt;\n    )\n  }\n}\n\n\x3cspan class=\x22hljs-type\x22\x3eReactDOM\x3c\/span\x3e.render(\x26lt;\x3cspan class=\x22hljs-type\x22\x3eApp\x3c\/span\x3e \/\x26gt;, document.querySelector(\x27#root\x27))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e演示地址：\x3ca href=\x22https:\/\/codepen.io\/Sarike\/pen\/OOKYXJ\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/codepen.io\/Sarike\/pen...\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22Sarike\/pen\/OOKYXJ\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3c\/p\x3e\n\x3cp\x3e既然通过 \x3ccode\x3eref\x3c\/code\x3e 能够获取子组件的实例，那么我们自然可以调用其成员方法，从而获取数据。\x3c\/p\x3e\n\x3cp\x3e当然，目前这确实能工作，但绝对不是一种好的方式。因为作为一个组件，是需要有一定的封装性的，它应该对外只会承诺我接受什么样的属性，而不会承诺有什么样的成员方法。换句话说，如果 JavaScript 的类支持私有成员方法，那么 React 组件类中的成员方法都应该定义成私有的。\x3c\/p\x3e\n\x3cp\x3e这应该属于一种 Hack 的使用方式，而且这样做有悖单向数据流原则。\x3c\/p\x3e\n\x3cp\x3eref 有它自己的使用场景，这里只是说明这种方式不适用于组件之间通信。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader8\x22\x3e总结\x3c\/h1\x3e\n\x3cp\x3e虽然啰嗦了这么多，实际上只希望大家知道一件事情，\x3cstrong\x3e请使用状态提升的方式在多个组件之间共享数据，切记维持应用单向数据流和数据唯一来源原则。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e文章中有些观点仁者见仁，有什么疑惑欢迎留言讨论。\x3c\/p\x3e\n\x3cp\x3e好久没更新了，但是没有放弃，感谢大家支持。欢迎加我微信好友：\x3ccode\x3eleobaba88\x3c\/code\x3e，进群交流。验证信息：\x3ccode\x3e玩转 React\x3c\/code\x3e。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>玩转 React（七）- 组件之间的数据共享</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012365876">https://segmentfault.com/a/1190000012365876</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/tdv8pbpgur/" target="_blank">https://alili.tech/archive/tdv8pbpgur/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>