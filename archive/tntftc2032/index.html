<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="DOM操作成本到底高在哪儿？"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>DOM操作成本到底高在哪儿？ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/tntftc2032/",
				"appid": "1613049289050283", 
				"title": "DOM操作成本到底高在哪儿？ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-08T02:30:30"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/pp0jna0p8p/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/377yv32o9n5/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ftntftc2032%2f&text=DOM%e6%93%8d%e4%bd%9c%e6%88%90%e6%9c%ac%e5%88%b0%e5%ba%95%e9%ab%98%e5%9c%a8%e5%93%aa%e5%84%bf%ef%bc%9f"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ftntftc2032%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ftntftc2032%2f&text=DOM%e6%93%8d%e4%bd%9c%e6%88%90%e6%9c%ac%e5%88%b0%e5%ba%95%e9%ab%98%e5%9c%a8%e5%93%aa%e5%84%bf%ef%bc%9f"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ftntftc2032%2f&title=DOM%e6%93%8d%e4%bd%9c%e6%88%90%e6%9c%ac%e5%88%b0%e5%ba%95%e9%ab%98%e5%9c%a8%e5%93%aa%e5%84%bf%ef%bc%9f"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ftntftc2032%2f&is_video=false&description=DOM%e6%93%8d%e4%bd%9c%e6%88%90%e6%9c%ac%e5%88%b0%e5%ba%95%e9%ab%98%e5%9c%a8%e5%93%aa%e5%84%bf%ef%bc%9f"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=DOM%e6%93%8d%e4%bd%9c%e6%88%90%e6%9c%ac%e5%88%b0%e5%ba%95%e9%ab%98%e5%9c%a8%e5%93%aa%e5%84%bf%ef%bc%9f&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ftntftc2032%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ftntftc2032%2f&title=DOM%e6%93%8d%e4%bd%9c%e6%88%90%e6%9c%ac%e5%88%b0%e5%ba%95%e9%ab%98%e5%9c%a8%e5%93%aa%e5%84%bf%ef%bc%9f"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftntftc2032%2f&title=DOM%e6%93%8d%e4%bd%9c%e6%88%90%e6%9c%ac%e5%88%b0%e5%ba%95%e9%ab%98%e5%9c%a8%e5%93%aa%e5%84%bf%ef%bc%9f"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftntftc2032%2f&title=DOM%e6%93%8d%e4%bd%9c%e6%88%90%e6%9c%ac%e5%88%b0%e5%ba%95%e9%ab%98%e5%9c%a8%e5%93%aa%e5%84%bf%ef%bc%9f"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftntftc2032%2f&title=DOM%e6%93%8d%e4%bd%9c%e6%88%90%e6%9c%ac%e5%88%b0%e5%ba%95%e9%ab%98%e5%9c%a8%e5%93%aa%e5%84%bf%ef%bc%9f"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">DOM操作成本到底高在哪儿？</h1><div class="meta"><div class="postdate"><time datetime="2018-12-08" itemprop="datePublished">2018-12-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e从我接触前端到现在，一直听到的一句话：操作DOM的成本很高，不要轻易去操作DOM。尤其是React、vue等MV*框架的出现，数据驱动视图的模式越发深入人心，jQuery时代提供的强大便利地操作DOM的API在前端工程里用的越来越少。刨根问底，这里说的成本，到底高在哪儿呢？\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e什么是DOM\x3c\/h2\x3e\n\x3cblockquote\x3eDocument Object Model 文档对象模型\x3c\/blockquote\x3e\n\x3cp\x3e什么是DOM？可能很多人第一反应就是div、p、span等html标签（至少我是），但要知道，DOM是Model，是Object Model，对象模型，是为HTML（and XML）提供的API。HTML(Hyper Text Markup Language)是一种标记语言，HTML在DOM的模型标准中被视为对象，DOM只提供编程接口，却无法实际操作HTML里面的内容。但在浏览器端，前端们可以用脚本语言（JavaScript）通过DOM去操作HTML内容。\x3c\/p\x3e\n\x3cp\x3e那么问题来了，只有JavaScript才能调用DOM这个API吗？\x3c\/p\x3e\n\x3cp\x3e答案是\x3cstrong\x3eNO\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3ePython也可以访问DOM。所以DOM不是提供给Javascript的API，也不是Javascript里的API。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3ePS: 实质上还存在\x3ca href=\x22https:\/\/developers.google.com\/web\/fundamentals\/performance\/critical-rendering-path\/constructing-the-object-model\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCSSOM\x3c\/a\x3e：CSS Object Model，浏览器将CSS代码解析成树形的数据结构，与DOM是两个独立的数据结构\x3c\/strong\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e浏览器渲染过程\x3c\/h2\x3e\n\x3cblockquote\x3e讨论DOM操作成本，肯定要先了解该成本的来源，那么就离不开浏览器渲染。\x3c\/blockquote\x3e\n\x3cp\x3e这里暂只讨论浏览器拿到HTML之后开始解析、渲染。（怎么拿到HTML资源的可能后续另开篇总结吧，什么握握握手啊挥挥挥挥手啊，万恶的flag...）\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e解析HTML，构建DOM树（这里遇到外链，此时会发起请求）\x3c\/li\x3e\n\x3cli\x3e解析CSS，生成CSS规则树\x3c\/li\x3e\n\x3cli\x3e合并DOM树和CSS规则，生成render树\x3c\/li\x3e\n\x3cli\x3e布局render树（Layout\/reflow），负责各元素尺寸、位置的计算\x3c\/li\x3e\n\x3cli\x3e绘制render树（paint），绘制页面像素信息\x3c\/li\x3e\n\x3cli\x3e浏览器会将各层的信息发送给GPU，GPU将各层合成（composite），显示在屏幕上\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e1.构建DOM树\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3chtml\x3e\n  \x3chead\x3e\n    \x3cmeta name=\x26quot;viewport\x26quot; content=\x26quot;width=device-width,initial-scale=1\x26quot;\x3e\n    \x3clink href=\x26quot;style.css\x26quot; rel=\x26quot;stylesheet\x26quot;\x3e\n    \x3ctitle\x3eCritical Path\x3c\/title\x3e\n  \x3c\/head\x3e\n  \x3cbody\x3e\n    \x3cp\x3eHello \x3cspan\x3eweb performance\x3c\/span\x3e students!\x3c\/p\x3e\n    \x3cdiv\x3e\x3cimg src=\x26quot;awesome-photo.jpg\x26quot;\x3e\x3c\/div\x3e\n  \x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22viewport\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22width=device-width,initial-scale=1\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22style.css\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3eCritical Path\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3eHello \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3eweb performance\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e students!\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22awesome-photo.jpg\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e无论是DOM还是CSSOM，都是要经过\x3ccode\x3eBytes → characters → tokens → nodes → object model\x3c\/code\x3e这个过程。\x3c\/blockquote\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014070244?w=800\x26amp;h=443\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014070244?w=800\x26amp;h=443\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3eDOM树构建过程：当前节点的所有子节点都构建好后才会去构建当前节点的下一个兄弟节点。\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e2.构建CSSOM树\x3c\/h3\x3e\n\x3cp\x3e上述也提到了CSSOM的构建过程，也是树的结构，在最终计算各个节点的样式时，浏览器都会先从该节点的普遍属性（比如body里设置的全局样式）开始，再去应用该节点的具体属性。还有要注意的是，每个浏览器都有自己默认的样式表，因此很多时候这棵CSSOM树只是对这张默认样式表的部分替换。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e3.生成render树\x3c\/h3\x3e\n\x3cblockquote\x3eDOM树和CSSOM树合并生成render树\x3c\/blockquote\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014070243?w=800\x26amp;h=374\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014070243?w=800\x26amp;h=374\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e简单描述这个过程：\x3c\/p\x3e\n\x3cp\x3eDOM树从根节点开始遍历\x3cstrong\x3e可见\x3c\/strong\x3e节点，这里之所以强调了“可见”，是因为如果遇到设置了类似\x3ccode\x3edisplay: none;\x3c\/code\x3e的不可见节点，在render过程中是会被跳过的（但\x3ccode\x3evisibility: hidden; opacity: 0\x3c\/code\x3e这种仍旧占据空间的节点不会被跳过render），保存各个节点的样式信息及其余节点的从属关系。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e4.Layout 布局\x3c\/h3\x3e\n\x3cp\x3e有了各个节点的样式信息和属性，但不知道各个节点的确切位置和大小，所以要通过布局将样式信息和属性转换为实际可视窗口的相对大小和位置。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e5.Paint 绘制\x3c\/h3\x3e\n\x3cp\x3e万事俱备，最后只要将确定好位置大小的各节点，通过GPU渲染到屏幕的实际像素。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e\x3cstrong\x3eTips\x3c\/strong\x3e\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e在上述渲染过程中，前3点可能要多次执行，比如js脚本去操作dom、更改css样式时，浏览器又要重新构建DOM、CSSOM树，重新render，重新layout、paint；\x3c\/li\x3e\n\x3cli\x3eLayout在Paint之前，因此每次Layout重新布局（reflow 回流）后都要重新出发Paint渲染，这时又要去消耗GPU；\x3c\/li\x3e\n\x3cli\x3ePaint不一定会触发Layout，比如改个颜色改个背景；（repaint 重绘）\x3c\/li\x3e\n\x3cli\x3e图片下载完也会重新出发Layout和Paint；\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014100657?w=800\x26amp;h=313\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014100657?w=800\x26amp;h=313\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e何时触发reflow和repaint\x3c\/h2\x3e\n\x3cblockquote\x3ereflow(回流): 根据Render Tree布局(几何属性)，意味着元素的内容、结构、位置或尺寸发生了变化，需要重新计算样式和渲染树；\x3cbr\x3erepaint(重绘): 意味着元素发生的改变只影响了节点的一些样式（背景色，边框颜色，文字颜色等），只需要应用新样式绘制这个元素就可以了；\x3cbr\x3ereflow回流的成本开销要高于repaint重绘，一个节点的回流往往回导致子节点以及同级节点的回流；\x3c\/blockquote\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/GoogleChromeLabs\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGoogleChromeLabs\x3c\/a\x3e 里面有一个\x3ca href=\x22https:\/\/csstriggers.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecsstriggers\x3c\/a\x3e，列出了各个CSS属性对浏览器执行Layout、Paint、Composite的影响。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e引起reflow回流\x3c\/h3\x3e\n\x3cblockquote\x3e现代浏览器会对回流做优化，它会等到足够数量的变化发生，再做一次批处理回流。\x3c\/blockquote\x3e\n\x3col\x3e\n\x3cli\x3e页面第一次渲染（初始化）\x3c\/li\x3e\n\x3cli\x3eDOM树变化（如：增删节点）\x3c\/li\x3e\n\x3cli\x3eRender树变化（如：padding改变）\x3c\/li\x3e\n\x3cli\x3e浏览器窗口resize\x3c\/li\x3e\n\x3cli\x3e获取元素的某些属性：\x3cbr\x3e浏览器为了获得正确的值也会\x3cstrong\x3e提前触发回流\x3c\/strong\x3e，这样就使得浏览器的优化失效了，这些属性包括offsetLeft、offsetTop、offsetWidth、offsetHeight、 scrollTop\/Left\/Width\/Height、clientTop\/Left\/Width\/Height、调用了getComputedStyle()或者IE的currentStyle\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e引起repaint重绘\x3c\/h3\x3e\n\x3col\x3e\n\x3cli\x3ereflow回流必定引起repaint重绘，重绘可以单独触发\x3c\/li\x3e\n\x3cli\x3e背景色、颜色、字体改变（注意：字体大小发生变化时，会触发回流）\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e优化reflow、repaint触发次数\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e避免逐个修改节点样式，尽量一次性修改\x3c\/li\x3e\n\x3cli\x3e使用DocumentFragment将需要多次修改的DOM元素缓存，最后一次性append到真实DOM中渲染\x3c\/li\x3e\n\x3cli\x3e可以将需要多次修改的DOM元素设置\x3ccode\x3edisplay: none\x3c\/code\x3e，操作完再显示。（因为隐藏元素不在render树内，因此修改隐藏元素不会触发回流重绘）\x3c\/li\x3e\n\x3cli\x3e避免多次读取某些属性（见上）\x3c\/li\x3e\n\x3cli\x3e将复杂的节点元素脱离文档流，降低回流成本\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e为什么一再强调将css放在头部，将js文件放在尾部\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3eDOMContentLoaded 和 load\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3eDOMContentLoaded 事件触发时，仅当DOM加载完成，不包括样式表，图片...\x3c\/li\x3e\n\x3cli\x3eload 事件触发时，页面上所有的DOM，样式表，脚本，图片都已加载完成\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3eCSS 资源阻塞渲染\x3c\/h3\x3e\n\x3cp\x3e构建Render树需要DOM和CSSOM，所以HTML和CSS都会阻塞渲染。所以需要让CSS尽早加载（如：放在头部），以缩短首次渲染的时间。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3eJS 资源\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e阻塞浏览器的解析，也就是说发现一个外链脚本时，需等待脚本下载完成并执行后才会继续解析HTML\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e这和之前文章提到的浏览器线程有关，浏览器中js引擎线程和渲染线程是互斥的，详见\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000013702430#articleHeader2\x22\x3e《从setTimeout-setInterval看JS线程》\x3c\/a\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e普通的脚本会阻塞浏览器解析，加上defer或async属性，脚本就变成异步，可等到解析完毕再执行\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3easync异步执行，异步下载完毕后就会执行，不确保执行顺序，一定在onload前，但不确定在DOMContentLoaded事件的前后\x3c\/li\x3e\n\x3cli\x3edefer延迟执行，相对于放在body最后（理论上在DOMContentLoaded事件前）\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3e举个栗子\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3chtml\x3e\n  \x3chead\x3e\n    \x3cmeta name=\x26quot;viewport\x26quot; content=\x26quot;width=device-width,initial-scale=1\x26quot;\x3e\n    \x3clink href=\x26quot;style.css\x26quot; rel=\x26quot;stylesheet\x26quot;\x3e\n  \x3c\/head\x3e\n  \x3cbody\x3e\n    \x3cp\x3eHello \x3cspan\x3eweb performance\x3c\/span\x3e students!\x3c\/p\x3e\n    \x3cdiv\x3e\x3cimg src=\x26quot;awesome-photo.jpg\x26quot;\x3e\x3c\/div\x3e\n    \x3cscript src=\x26quot;app.js\x26quot;\x3e\x3c\/script\x3e\n  \x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22viewport\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22width=device-width,initial-scale=1\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22style.css\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3eHello \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3eweb performance\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e students!\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22awesome-photo.jpg\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22app.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014075204?w=800\x26amp;h=220\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014075204?w=800\x26amp;h=220\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e浏览器拿到HTML后，从上到下顺序解析文档\x3c\/li\x3e\n\x3cli\x3e此时遇到css、js外链，则同时发起请求\x3c\/li\x3e\n\x3cli\x3e开始构建DOM树\x3c\/li\x3e\n\x3cli\x3e这里要特别注意，由于有CSS资源，CSSOM还未构建前，会阻塞js（如果有的话）\x3c\/li\x3e\n\x3cli\x3e无论JavaScript是内联还是外链，只要浏览器遇到 \x3ccode\x3escript\x3c\/code\x3e 标记，唤醒\x3ccode\x3eJavaScript解析器\x3c\/code\x3e，就会进行暂停 \x3ccode\x3eblocked\x3c\/code\x3e 浏览器解析HTML，并等到 \x3ccode\x3eCSSOM\x3c\/code\x3e 构建完毕，才执行js脚本\x3c\/li\x3e\n\x3cli\x3e渲染首屏（DOMContentLoaded 触发，其实不一定是首屏，可能在js脚本执行前DOM树和CSSOM已经构建完render树，已经paint）\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader17\x22\x3e首屏优化Tips\x3c\/h2\x3e\n\x3cblockquote\x3e说了这么多，其实可以总结几点浏览器首屏渲染优化的方向\x3c\/blockquote\x3e\n\x3cul\x3e\n\x3cli\x3e减少资源请求数量（内联亦或是延迟动态加载）\x3c\/li\x3e\n\x3cli\x3e使CSS样式表尽早加载，减少@import的使用，因为需要解析完样式表中所有import的资源才会算CSS资源下载完\x3c\/li\x3e\n\x3cli\x3e异步js：阻塞解析器的 JavaScript 会强制浏览器等待 CSSOM 并暂停 DOM 的构建，导致首次渲染的时间延迟\x3c\/li\x3e\n\x3cli\x3eso on...\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader18\x22\x3e知道操作DOM成本多高了吗?\x3c\/h2\x3e\n\x3cblockquote\x3e其实写了这么多，感觉偏题了，大量的资料参考的是chrome开发者文档。感觉js脚本资源那块还是有点乱，包括和DOMContentLoaded的关系，希望大家能多多指点，多多批评，谢谢大佬们。\x3c\/blockquote\x3e\n\x3cp\x3e操作DOM具体的成本，说到底是造成浏览器回流reflow和重绘reflow，从而消耗GPU资源。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader19\x22\x3e参考文献:\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/developers.google.com\/web\/fundamentals\/performance\/critical-rendering-path\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/developers.google.com\/web\/fundamentals\/performance\/critical-rendering-path\/\x3c\/a\x3e\x3c\/p\x3e\n\x3cblockquote\x3e已同步至个人博客-\x3ca href=\x22http:\/\/palmer.arkstack.cn\/2018\/03\/DOM%E6%93%8D%E4%BD%9C%E6%88%90%E6%9C%AC%E5%88%B0%E5%BA%95%E9%AB%98%E5%9C%A8%E5%93%AA%E5%84%BF\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e软硬皆施\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/palmerye\/palmerye.github.io\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGithub\x3c\/a\x3e 欢迎star :)\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>DOM操作成本到底高在哪儿？</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014070240">https://segmentfault.com/a/1190000014070240</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/tntftc2032/" target="_blank">https://alili.tech/archive/tntftc2032/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>