<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="浏览器和Node不同的事件循环（Event Loop）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>浏览器和Node不同的事件循环（Event Loop） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ur3w5vdls9e/",
				"appid": "1613049289050283", 
				"title": "浏览器和Node不同的事件循环（Event Loop） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-11T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/yfyf3fkxn18/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/sxmaj9ep4e/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fur3w5vdls9e%2f&text=%e6%b5%8f%e8%a7%88%e5%99%a8%e5%92%8cNode%e4%b8%8d%e5%90%8c%e7%9a%84%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%ef%bc%88Event%20Loop%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fur3w5vdls9e%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fur3w5vdls9e%2f&text=%e6%b5%8f%e8%a7%88%e5%99%a8%e5%92%8cNode%e4%b8%8d%e5%90%8c%e7%9a%84%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%ef%bc%88Event%20Loop%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fur3w5vdls9e%2f&title=%e6%b5%8f%e8%a7%88%e5%99%a8%e5%92%8cNode%e4%b8%8d%e5%90%8c%e7%9a%84%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%ef%bc%88Event%20Loop%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fur3w5vdls9e%2f&is_video=false&description=%e6%b5%8f%e8%a7%88%e5%99%a8%e5%92%8cNode%e4%b8%8d%e5%90%8c%e7%9a%84%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%ef%bc%88Event%20Loop%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%b5%8f%e8%a7%88%e5%99%a8%e5%92%8cNode%e4%b8%8d%e5%90%8c%e7%9a%84%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%ef%bc%88Event%20Loop%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fur3w5vdls9e%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fur3w5vdls9e%2f&title=%e6%b5%8f%e8%a7%88%e5%99%a8%e5%92%8cNode%e4%b8%8d%e5%90%8c%e7%9a%84%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%ef%bc%88Event%20Loop%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fur3w5vdls9e%2f&title=%e6%b5%8f%e8%a7%88%e5%99%a8%e5%92%8cNode%e4%b8%8d%e5%90%8c%e7%9a%84%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%ef%bc%88Event%20Loop%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fur3w5vdls9e%2f&title=%e6%b5%8f%e8%a7%88%e5%99%a8%e5%92%8cNode%e4%b8%8d%e5%90%8c%e7%9a%84%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%ef%bc%88Event%20Loop%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fur3w5vdls9e%2f&title=%e6%b5%8f%e8%a7%88%e5%99%a8%e5%92%8cNode%e4%b8%8d%e5%90%8c%e7%9a%84%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%ef%bc%88Event%20Loop%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">浏览器和Node不同的事件循环（Event Loop）</h1><div class="meta"><div class="postdate"><time datetime="2018-12-11" itemprop="datePublished">2018-12-11</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e背景\x3c\/h1\x3e\n\x3cp\x3eEvent Loop也是js老生常谈的一个话题了。2月底看了阮一峰老师的《Node定时器详解》一文后，发现无法完全对标之前看过的js事件循环执行机制，又查阅了一些其他资料，记为笔记，感觉不妥，总结成文。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e浏览器中与node中事件循环与执行机制不同，不可混为一谈。\x3c\/strong\x3e\x3cbr\x3e浏览器的\x3ca href=\x22https:\/\/www.w3.org\/TR\/html5\/webappapis.html#event-loops\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eEvent loop\x3c\/a\x3e是在HTML5中定义的规范，而node中则由\x3ca href=\x22http:\/\/thlorenz.com\/learnuv\/book\/history\/history_1.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3elibuv\x3c\/a\x3e库实现。同时阅读《深入浅出nodeJs》一书时发现比较当时node机制已有不同，所以本文node部分针对为此文发布时版本。强烈推荐读下参考链接中的前三篇。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e浏览器环境\x3c\/h1\x3e\n\x3cp\x3ejs执行为单线程（不考虑web worker），所有代码皆在执行线程调用栈完成执行。当执行线程任务清空后才会去轮询取任务队列中任务。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e任务队列\x3c\/h2\x3e\n\x3cp\x3e异步任务分为task（宏任务，也可称为macroTask）和microtask（微任务）两类。\x3cbr\x3e当满足执行条件时，task和microtask会被放入各自的队列中等待放入执行线程执行，我们把这两个队列称为Task Queue(也叫Macrotask Queue)和Microtask Queue。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3etask：script中代码、setTimeout、setInterval、I\/O、UI render。\x3c\/li\x3e\n\x3cli\x3emicrotask: promise、Object.observe、MutationObserver。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e具体过程\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e执行完主执行线程中的任务。\x3c\/li\x3e\n\x3cli\x3e取出Microtask Queue中任务执行直到清空。\x3c\/li\x3e\n\x3cli\x3e取出Macrotask Queue中\x3cstrong\x3e一个\x3c\/strong\x3e任务执行。\x3c\/li\x3e\n\x3cli\x3e取出Microtask Queue中任务执行直到清空。\x3c\/li\x3e\n\x3cli\x3e重复3和4。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e即为同步完成，一个宏任务，所有微任务，一个宏任务，所有微任务......\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e注意\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e在浏览器页面中可以认为初始执行线程中没有代码，每一个script标签中的代码是一个独立的task，即会执行完前面的script中创建的microtask再执行后面的script中的同步代码。\x3c\/li\x3e\n\x3cli\x3e如果microtask一直被添加，则会继续执行microtask，“卡死”macrotask。\x3c\/li\x3e\n\x3cli\x3e部分版本浏览器有执行顺序与上述不符的情况，可能是不符合标准或js与html部分标准冲突。可阅读参考文章中第一篇。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3enew Promise((resolve, reject) =\x26gt;{console.log(‘同步’);resolve()}).then(() =\x26gt; {console.log(\x27异步\x27)})\x3c\/code\x3e，即\x3ccode\x3epromise\x3c\/code\x3e的\x3ccode\x3ethen\x3c\/code\x3e和\x3ccode\x3ecatch\x3c\/code\x3e才是microtask，本身的内部代码不是。\x3c\/li\x3e\n\x3cli\x3e个别浏览器独有API未列出。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e伪代码\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22while (true) {\n  宏任务队列.shift()\n  微任务队列全部任务()\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gcode\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e(true)\x3c\/span\x3e {\n  宏任务队列.shift\x3cspan class=\x22hljs-comment\x22\x3e()\x3c\/span\x3e\n  微任务队列全部任务\x3cspan class=\x22hljs-comment\x22\x3e()\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader6\x22\x3enode环境\x3c\/h1\x3e\n\x3cp\x3ejs执行为单线程，所有代码皆在执行线程调用栈完成执行。当执行线程任务清空后才会去轮询取任务队列中任务。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e循环阶段\x3c\/h2\x3e\n\x3cp\x3e在node中事件\x3cstrong\x3e每一轮\x3c\/strong\x3e循环按照\x3cstrong\x3e顺序\x3c\/strong\x3e分为6个阶段，来自libuv的实现：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3etimers：执行满足条件的setTimeout、setInterval回调。\x3c\/li\x3e\n\x3cli\x3eI\/O callbacks：是否有已完成的I\/O操作的回调函数，来自上一轮的poll残留。\x3c\/li\x3e\n\x3cli\x3eidle，prepare：可忽略\x3c\/li\x3e\n\x3cli\x3epoll：等待还没完成的I\/O事件，会因timers和超时时间等结束等待。\x3c\/li\x3e\n\x3cli\x3echeck：执行setImmediate的回调。\x3c\/li\x3e\n\x3cli\x3eclose callbacks：关闭所有的closing handles，一些onclose事件。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e执行机制\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e几个队列\x3c\/h3\x3e\n\x3cp\x3e除上述循环阶段中的任务类型，我们还剩下浏览器和node共有的microtask和node独有的\x3ccode\x3eprocess.nextTick\x3c\/code\x3e，我们称之为Microtask Queue和NextTick Queue。\x3c\/p\x3e\n\x3cp\x3e我们把循环中的几个阶段的执行队列也分别称为Timers Queue、I\/O Queue、Check Queue、Close Queue。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e循环之前\x3c\/h3\x3e\n\x3cp\x3e在进入第一次循环之前，会先进行如下操作：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e同步任务\x3c\/li\x3e\n\x3cli\x3e发出异步请求\x3c\/li\x3e\n\x3cli\x3e规划定时器生效的时间\x3c\/li\x3e\n\x3cli\x3e执行\x3ccode\x3eprocess.nextTick()\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e开始循环\x3c\/h3\x3e\n\x3cp\x3e按照我们的循环的6个阶段依次执行，每次拿出当前阶段中的全部任务执行，清空NextTick Queue，清空Microtask Queue。再执行下一阶段，全部6个阶段执行完毕后，进入下轮循环。即：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e清空当前循环内的Timers Queue，清空NextTick Queue，清空Microtask Queue。\x3c\/li\x3e\n\x3cli\x3e清空当前循环内的I\/O Queue，清空NextTick Queue，清空Microtask Queue。\x3c\/li\x3e\n\x3cli\x3e清空当前循环内的Check Queu，清空NextTick Queue，清空Microtask Queue。\x3c\/li\x3e\n\x3cli\x3e清空当前循环内的Close Queu，清空NextTick Queue，清空Microtask Queue。\x3c\/li\x3e\n\x3cli\x3e进入下轮循环。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e可以看出，\x3ccode\x3enextTick\x3c\/code\x3e优先级比\x3ccode\x3epromise\x3c\/code\x3e等microtask高。\x3ccode\x3esetTimeout\x3c\/code\x3e和\x3ccode\x3esetInterval\x3c\/code\x3e优先级比\x3ccode\x3esetImmediate\x3c\/code\x3e高。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e注意\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e如果在timers阶段执行时创建了\x3ccode\x3esetImmediate\x3c\/code\x3e则会在此轮循环的check阶段执行，如果在timers阶段创建了\x3ccode\x3esetTimeout\x3c\/code\x3e，由于timers已取出完毕，则会进入下轮循环，check阶段创建timers任务同理。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3esetTimeout\x3c\/code\x3e优先级比\x3ccode\x3esetImmediate\x3c\/code\x3e高，但是由于\x3ccode\x3esetTimeout(fn,0)\x3c\/code\x3e的真正延迟不可能完全为0秒，可能出现先创建的\x3ccode\x3esetTimeout(fn,0)\x3c\/code\x3e而比\x3ccode\x3esetImmediate\x3c\/code\x3e的回调后执行的情况。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e伪代码\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22while (true) {\n  loop.forEach((阶段) =\x3e {\n    阶段全部任务()\n    nextTick全部任务()\n    microTask全部任务()\n  })\n  loop = loop.next\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eloop\x3c\/span\x3e.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(阶段)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    阶段全部任务()\n    nextTick全部任务()\n    microTask全部任务()\n  })\n  \x3cspan class=\x22hljs-keyword\x22\x3eloop\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eloop\x3c\/span\x3e.next\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader14\x22\x3e测试代码\x3c\/h1\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function sleep(time) {\n  let startTime = new Date()\n  while (new Date() - startTime \x3c time) {}\n  console.log(\x271s over\x27)\n}\nsetTimeout(() =\x3e {\n  console.log(\x27setTimeout - 1\x27)\n  setTimeout(() =\x3e {\n      console.log(\x27setTimeout - 1 - 1\x27)\n      sleep(1000)\n  })\n  new Promise(resolve =\x3e resolve()).then(() =\x3e {\n      console.log(\x27setTimeout - 1 - then\x27)\n      new Promise(resolve =\x3e resolve()).then(() =\x3e {\n          console.log(\x27setTimeout - 1 - then - then\x27)\n      })\n  })\n  sleep(1000)\n})\n\nsetTimeout(() =\x3e {\n  console.log(\x27setTimeout - 2\x27)\n  setTimeout(() =\x3e {\n      console.log(\x27setTimeout - 2 - 1\x27)\n      sleep(1000)\n  })\n  new Promise(resolve =\x3e resolve()).then(() =\x3e {\n      console.log(\x27setTimeout - 2 - then\x27)\n      new Promise(resolve =\x3e resolve()).then(() =\x3e {\n          console.log(\x27setTimeout - 2 - then - then\x27)\n      })\n  })\n  sleep(1000)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esleep\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etime\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e startTime = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e()\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e() - startTime \x26lt; time) {}\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x271s over\x27\x3c\/span\x3e)\n}\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27setTimeout - 1\x27\x3c\/span\x3e)\n  setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27setTimeout - 1 - 1\x27\x3c\/span\x3e)\n      sleep(\x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n  })\n  \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e resolve()).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27setTimeout - 1 - then\x27\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e resolve()).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27setTimeout - 1 - then - then\x27\x3c\/span\x3e)\n      })\n  })\n  sleep(\x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n})\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27setTimeout - 2\x27\x3c\/span\x3e)\n  setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27setTimeout - 2 - 1\x27\x3c\/span\x3e)\n      sleep(\x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n  })\n  \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e resolve()).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27setTimeout - 2 - then\x27\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e resolve()).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27setTimeout - 2 - then - then\x27\x3c\/span\x3e)\n      })\n  })\n  sleep(\x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e浏览器输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22setTimeout - 1 \/\/1为单个task\n1s over\nsetTimeout - 1 - then\nsetTimeout - 1 - then - then \nsetTimeout - 2 \/\/2为单个task\n1s over\nsetTimeout - 2 - then\nsetTimeout - 2 - then - then\nsetTimeout - 1 - 1\n1s over\nsetTimeout - 2 - 1\n1s over\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3esetTimeout - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/1为单个task\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3es over\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e - then\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e - then - then \nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/2为单个task\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3es over\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e - then\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e - then - then\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3es over\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3es over\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3enode输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22setTimeout - 1 \n1s over\nsetTimeout - 2 \/\/1、2为单阶段task\n1s over\nsetTimeout - 1 - then\nsetTimeout - 2 - then\nsetTimeout - 1 - then - then\nsetTimeout - 2 - then - then\nsetTimeout - 1 - 1\n1s over\nsetTimeout - 2 - 1\n1s over\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3esetTimeout - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3es over\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/1、2为单阶段task\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3es over\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e - then\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e - then\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e - then - then\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e - then - then\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3es over\nsetTimeout - \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3es over\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e由此也可看出事件循环在浏览器和node中的不同。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader15\x22\x3e参考文章\x3c\/h1\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ca href=\x22https:\/\/jakearchibald.com\/2015\/tasks-microtasks-queues-and-schedules\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTasks, microtasks, queues and schedules\x3c\/a\x3e 强烈推荐\x3c\/li\x3e\n\x3cli\x3e\n\x3ca href=\x22https:\/\/cnodejs.org\/topic\/5a9108d78d6e16e56bb80882\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e不要混淆nodejs和浏览器中的event loop\x3c\/a\x3e 强烈推荐\x3c\/li\x3e\n\x3cli\x3e\n\x3ca href=\x22https:\/\/github.com\/SunShinewyf\/issue-blog\/issues\/34#issuecomment-371106502\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enode中的Event模块\x3c\/a\x3e 强烈推荐\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/ccforward\/cc\/issues\/47\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e理解事件循环一(浅析)\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2018\/02\/node-event-loop.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNode 定时器详解\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e???\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>浏览器和Node不同的事件循环（Event Loop）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013660033">https://segmentfault.com/a/1190000013660033</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ur3w5vdls9e/" target="_blank">https://alili.tech/archive/ur3w5vdls9e/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>