<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="H5拖放&#43;FormData接口&#43;NodeJS，完整异步文件上传（一）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>H5拖放&#43;FormData接口&#43;NodeJS，完整异步文件上传（一） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/var0cd7g6u/",
				"appid": "1613049289050283", 
				"title": "H5拖放&#43;FormData接口&#43;NodeJS，完整异步文件上传（一） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-07T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/soz5oc6jww/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/dtup9svmqyt/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fvar0cd7g6u%2f&text=H5%e6%8b%96%e6%94%be%2bFormData%e6%8e%a5%e5%8f%a3%2bNodeJS%ef%bc%8c%e5%ae%8c%e6%95%b4%e5%bc%82%e6%ad%a5%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fvar0cd7g6u%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fvar0cd7g6u%2f&text=H5%e6%8b%96%e6%94%be%2bFormData%e6%8e%a5%e5%8f%a3%2bNodeJS%ef%bc%8c%e5%ae%8c%e6%95%b4%e5%bc%82%e6%ad%a5%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fvar0cd7g6u%2f&title=H5%e6%8b%96%e6%94%be%2bFormData%e6%8e%a5%e5%8f%a3%2bNodeJS%ef%bc%8c%e5%ae%8c%e6%95%b4%e5%bc%82%e6%ad%a5%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fvar0cd7g6u%2f&is_video=false&description=H5%e6%8b%96%e6%94%be%2bFormData%e6%8e%a5%e5%8f%a3%2bNodeJS%ef%bc%8c%e5%ae%8c%e6%95%b4%e5%bc%82%e6%ad%a5%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=H5%e6%8b%96%e6%94%be%2bFormData%e6%8e%a5%e5%8f%a3%2bNodeJS%ef%bc%8c%e5%ae%8c%e6%95%b4%e5%bc%82%e6%ad%a5%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%ef%bc%88%e4%b8%80%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fvar0cd7g6u%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fvar0cd7g6u%2f&title=H5%e6%8b%96%e6%94%be%2bFormData%e6%8e%a5%e5%8f%a3%2bNodeJS%ef%bc%8c%e5%ae%8c%e6%95%b4%e5%bc%82%e6%ad%a5%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvar0cd7g6u%2f&title=H5%e6%8b%96%e6%94%be%2bFormData%e6%8e%a5%e5%8f%a3%2bNodeJS%ef%bc%8c%e5%ae%8c%e6%95%b4%e5%bc%82%e6%ad%a5%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvar0cd7g6u%2f&title=H5%e6%8b%96%e6%94%be%2bFormData%e6%8e%a5%e5%8f%a3%2bNodeJS%ef%bc%8c%e5%ae%8c%e6%95%b4%e5%bc%82%e6%ad%a5%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvar0cd7g6u%2f&title=H5%e6%8b%96%e6%94%be%2bFormData%e6%8e%a5%e5%8f%a3%2bNodeJS%ef%bc%8c%e5%ae%8c%e6%95%b4%e5%bc%82%e6%ad%a5%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">H5拖放&#43;FormData接口&#43;NodeJS，完整异步文件上传（一）</h1><div class="meta"><div class="postdate"><time datetime="2018-12-07" itemprop="datePublished">2018-12-07</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e  前段时间面试过程中，频繁遇到H5异步文件上传的相关问题。还遇到过一个\x22通过H5拖放功能实现文件异步上传\x22的问题，大概知道H5有新增拖拽功能可以接收文件，如何异步上传文件就母鸡了(摊手)。面试结束后，特意去看了相关知识点，了解到\x3cstrong\x3eH5拖放\x2bFormData接口\x3c\/strong\x3e可以实现异步上传。为了测试文件上传是否成功，还去看了Node.js如何接收异步文件上传。所以，这会是一个\x3cstrong\x3eH5拖放\x2bFormData接口\x2bNode.js\x3c\/strong\x3e实现文件异步上传的完整Demo。  \x3cbr\x3e  先简单介绍一下这几个知识点，贴上详细介绍的链接，有兴趣的同学可以点进去多了解一些。\x3c\/p\x3e\n\x3ch4\x3eHTML5 拖放\x3c\/h4\x3e\n\x3cp\x3e  拖放（Drag 和 drop）是 HTML5 标准的组成部分。拖放是一种常见的特性，即抓取对象以后拖到另一个位置。抓取的对象可以是页面中DOM元素（需要设置draggable=\x22true\x22）或者系统文件。监听放置元素的drop事件，通过DataTransfer对象可以获得拖拽事件的状态及数据。详情可查阅\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/HTML_Drag_and_Drop_API\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMDN的HTML5 拖放 API文档\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch4\x3eFormData 接口\x3c\/h4\x3e\n\x3cp\x3e  XMLHttpRequest Level 2添加了一个新的接口FormData。利用FormData对象，我们可以通过JavaScript用一些键值对来模拟一系列表单控件，我们还可以使用XMLHttpRequest的send()方法来异步的提交这个\x22表单\x22。比起普通的ajax，使用FormData的最大优点就是我们可以异步上传一个二进制文件。详情可查阅\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/FormData\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMDN的FormData接口文档\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch4\x3e后端文件接收\x26amp;保存\x3c\/h4\x3e\n\x3cp\x3e  后端使用Node.js\x2bExpress\x2bMulter实现文件上传。\x3ca href=\x22http:\/\/www.expressjs.com.cn\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eExpress\x3c\/a\x3e基于 Node.js平台，快速、开放、极简的web开发框架。\x3ca href=\x22https:\/\/github.com\/expressjs\/multer\/blob\/master\/doc\/README-zh-cn.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMulter\x3c\/a\x3e 是一个 node.js 中间件，用于处理 multipart\/form-data 类型的表单数据，它主要用于上传文件。\x3c\/p\x3e\n\x3ch4\x3e小二，上代码\x3c\/h4\x3e\n\x3cp\x3e\x3cstrong\x3e新建drop.html,插入以下代码\x3c\/strong\x3e   \x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eHTML代码:\x3c\/strong\x3e 先添加一个放置的div,并且监听ondrop和ondragover事件。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv class=\x26quot;drop-area\x26quot;  ondrop=\x26quot;drop_hander(event)\x26quot; ondragover = \x26quot;dragover_hander(event)\x26quot;\x3e\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22drop-area\x22\x3c\/span\x3e  \x3cspan class=\x22hljs-attr\x22\x3eondrop\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22drop_hander(event)\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eondragover\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x22dragover_hander(event)\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e样式代码:\x3c\/strong\x3e 加个边框，设置一下大小。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.drop-area{\n    margin:auto;\n    width: 500px;\n    height: 500px;\n    border:1px pink dashed;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22css hljs\x22\x3e\x3ccode class=\x22css\x22\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.drop-area\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e:auto;\n    \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e500px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e500px\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-attribute\x22\x3eborder\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e1px\x3c\/span\x3e pink dashed;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3eJavaScript代码:\x3c\/strong\x3e 监听拖放事件，获取文件，创建XHR实例并发送请求\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 拖动到放置区域时 *\/\nfunction dragover_hander (event) {\n    \/* 必须同时阻止dragover和drop的默认事件\n       否则会响应浏览器默认行为\n       浏览器能显示的文件会直接显示，例如html文件、图片文件\n       浏览器不能显示的文件会出现文件下载弹窗\n    *\/\n    event.preventDefault(); \n}\n\n\/*拖放完成事件*\/\nfunction drop_hander (event) {\n\n    event.preventDefault(); \/\/阻止默认事件\n\n    var files = event.dataTransfer.files; \/\/通过dataTransfer对象获取文件对象数组\n    var formData = new FormData(); \/\/声明一个FormData实例\n\n    for(var i = 0, len = files.length; i \x3c len; i\x2b\x2b) {\n        \/\/使用append方法添加文件到file键\n        formData.append(\x27file\x27,  files[i]);\n    }\n\n    var request = new XMLHttpRequest(); \/\/创建XHR实例\n    request.open(\x27POST\x27, \x27\/process_post\x27); \/\/初始化请求\n    request.send(formData);\/\/发送请求\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 拖动到放置区域时 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edragover_hander\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/* 必须同时阻止dragover和drop的默认事件\n       否则会响应浏览器默认行为\n       浏览器能显示的文件会直接显示，例如html文件、图片文件\n       浏览器不能显示的文件会出现文件下载弹窗\n    *\/\x3c\/span\x3e\n    event.preventDefault(); \n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/*拖放完成事件*\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edrop_hander\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n\n    event.preventDefault(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/阻止默认事件\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e files = event.dataTransfer.files; \x3cspan class=\x22hljs-comment\x22\x3e\/\/通过dataTransfer对象获取文件对象数组\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e formData = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FormData(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/声明一个FormData实例\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, len = files.length; i \x26lt; len; i\x2b\x2b) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/使用append方法添加文件到file键\x3c\/span\x3e\n        formData.append(\x3cspan class=\x22hljs-string\x22\x3e\x27file\x27\x3c\/span\x3e,  files[i]);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e request = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e XMLHttpRequest(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/创建XHR实例\x3c\/span\x3e\n    request.open(\x3cspan class=\x22hljs-string\x22\x3e\x27POST\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\/process_post\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/初始化请求\x3c\/span\x3e\n    request.send(formData);\x3cspan class=\x22hljs-comment\x22\x3e\/\/发送请求\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e新建formupload.js,写服务端代码\x3c\/strong\x3e：使用express创建服务，使用multer中间保存文件。 \x3cstrong\x3e这里需要安装express和multer依赖包\x3c\/strong\x3e。这里默认你已经有简单了解Node.js，会使用npm安装依赖包。如果还没接触过，可以看看菜鸟教程的\x3ca href=\x22http:\/\/www.runoob.com\/nodejs\/nodejs-tutorial.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNode.js 教程\x3c\/a\x3e,看完前四节就行。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const express = require(\x27express\x27); \/\/引入express模块\nconst app = express(); \/\/创建一个express应用\nconst multer = require(\x27multer\x27); \/\/ 引入multer模块\n\n\/*\n 新建一个multer中间件，设置文件保存路径\n 路径必须存在，否则会报错\n*\/\nconst upload = multer({ dest: \x27uploads\/\x27 }); \n\n\/* 请求\/drop.html，返回文件 *\/\napp.get(\x27\/drop.html\x27, function (req, res) {\n   res.sendFile( __dirname \x2b \x26quot;\/\x26quot; \x2b \x26quot;drop.html\x26quot; );\n})\n\n\/* \n创建提交接口\n使用中间件处理\nupload.array(\x27file\x27)表示上传一个名为file文件数组\n *\/\napp.post(\x27\/process_post\x27, upload.array(\x27file\x27), function (req, res,next) {\n \n  if (!req.files) { \/\/ 末上传文件的返回\n    res.json({ ok: false });\n    return;\n  }\n  \/\/有上传文件,返回文件列表\n  res.json(req.files) \n  return;\n})\n\n\/\/启动服务，监听8081端口\nvar server = app.listen(8081, function () {\n \n  var host = server.address().address\n  var port = server.address().port\n \n  console.log(\x26quot;应用实例，访问地址为 http:\/\/%s:%s\x26quot;, host, port)\n \n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/引入express模块\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e app = express(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/创建一个express应用\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e multer = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27multer\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 引入multer模块\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/*\n 新建一个multer中间件，设置文件保存路径\n 路径必须存在，否则会报错\n*\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e upload = multer({ \x3cspan class=\x22hljs-attr\x22\x3edest\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27uploads\/\x27\x3c\/span\x3e }); \n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* 请求\/drop.html，返回文件 *\/\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/drop.html\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ereq, res\x3c\/span\x3e) \x3c\/span\x3e{\n   res.sendFile( __dirname \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22\/\x22\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22drop.html\x22\x3c\/span\x3e );\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* \n创建提交接口\n使用中间件处理\nupload.array(\x27file\x27)表示上传一个名为file文件数组\n *\/\x3c\/span\x3e\napp.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/process_post\x27\x3c\/span\x3e, upload.array(\x3cspan class=\x22hljs-string\x22\x3e\x27file\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ereq, res,next\x3c\/span\x3e) \x3c\/span\x3e{\n \n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!req.files) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 末上传文件的返回\x3c\/span\x3e\n    res.json({ \x3cspan class=\x22hljs-attr\x22\x3eok\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e });\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/有上传文件,返回文件列表\x3c\/span\x3e\n  res.json(req.files) \n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/启动服务，监听8081端口\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e server = app.listen(\x3cspan class=\x22hljs-number\x22\x3e8081\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n \n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e host = server.address().address\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e port = server.address().port\n \n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22应用实例，访问地址为 http:\/\/%s:%s\x22\x3c\/span\x3e, host, port)\n \n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e到这里代码就结束了，下面是目录结构。完整代码可以查看\x3ca href=\x22https:\/\/github.com\/Fatty-Shu\/h5-drop-upload\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e项目github地址\x3c\/a\x3e。\x3cstrong\x3e注意：uploads文件夹一定要存在，否则服务会报错\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22h5-drop-upload\n|- \/uploads\n|- drop.html\n|- formupload\n|- package.json\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eh5-drop-upload\n|- \x3cspan class=\x22hljs-regexp\x22\x3e\/uploads\n|- drop.html\n|- formupload\n|- package.json\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e打开命令行，在h5-drop-upload目录下执行：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node formupload.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3enode formupload.js\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果没报错，会输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22应用实例，访问地址为 http:\/\/:::8081\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e应用实例，访问地址为 http:\x3cspan class=\x22hljs-comment\x22\x3e\/\/:::8081\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e打开浏览器，输入：127.0.0.1:8081\/drap.html。然后拖动文件到粉红色的框中，查看upload文件夹，你上传的文件就会这里（为了避免命名冲突，Multer 会修改上传的文件名）。到了这里还没报错，就表示整个“H5拖放\x2bFormData接口\x2bNode.js”文件上传的Demo已经跑通了，可以结自己鼓掌了。 \x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV7qtP?w=264\x26amp;h=220\x22 src=\x22https:\/\/static.alili.tech\/img\/bV7qtP?w=264\x26amp;h=220\x22 alt=\x22鼓掌\x22 title=\x22鼓掌\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e \x3c\/p\x3e\n\x3ch4\x3e结束语\x3c\/h4\x3e\n\x3cp\x3e  我们已经简单实现文件异步上传功能，但离实际使用场景还有差距。实际使用中，肯定不能拖放完成就马上上传，至少应该显示一个文件列表，用户可以增删文件，最后确认再开始上传。更进一步，最好可以给个进度条，显示文件上传进度。接下来，让我们继续完善，敬请期待下篇。  \x3c\/p\x3e\n\x3cp\x3e  如果你已经看这里，麻烦顺便点个赞咯。。。。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>H5拖放+FormData接口+NodeJS，完整异步文件上传（一）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014124076">https://segmentfault.com/a/1190000014124076</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/var0cd7g6u/" target="_blank">https://alili.tech/archive/var0cd7g6u/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>