<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="PHP基于Thinkphp5的砍价活动相关设计"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>PHP基于Thinkphp5的砍价活动相关设计 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/vgsff9du7jm/",
				"appid": "1613049289050283", 
				"title": "PHP基于Thinkphp5的砍价活动相关设计 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-16T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ao5xap2wzcq/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/gpzfy8zgkm9/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fvgsff9du7jm%2f&text=PHP%e5%9f%ba%e4%ba%8eThinkphp5%e7%9a%84%e7%a0%8d%e4%bb%b7%e6%b4%bb%e5%8a%a8%e7%9b%b8%e5%85%b3%e8%ae%be%e8%ae%a1"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fvgsff9du7jm%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fvgsff9du7jm%2f&text=PHP%e5%9f%ba%e4%ba%8eThinkphp5%e7%9a%84%e7%a0%8d%e4%bb%b7%e6%b4%bb%e5%8a%a8%e7%9b%b8%e5%85%b3%e8%ae%be%e8%ae%a1"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fvgsff9du7jm%2f&title=PHP%e5%9f%ba%e4%ba%8eThinkphp5%e7%9a%84%e7%a0%8d%e4%bb%b7%e6%b4%bb%e5%8a%a8%e7%9b%b8%e5%85%b3%e8%ae%be%e8%ae%a1"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fvgsff9du7jm%2f&is_video=false&description=PHP%e5%9f%ba%e4%ba%8eThinkphp5%e7%9a%84%e7%a0%8d%e4%bb%b7%e6%b4%bb%e5%8a%a8%e7%9b%b8%e5%85%b3%e8%ae%be%e8%ae%a1"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=PHP%e5%9f%ba%e4%ba%8eThinkphp5%e7%9a%84%e7%a0%8d%e4%bb%b7%e6%b4%bb%e5%8a%a8%e7%9b%b8%e5%85%b3%e8%ae%be%e8%ae%a1&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fvgsff9du7jm%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fvgsff9du7jm%2f&title=PHP%e5%9f%ba%e4%ba%8eThinkphp5%e7%9a%84%e7%a0%8d%e4%bb%b7%e6%b4%bb%e5%8a%a8%e7%9b%b8%e5%85%b3%e8%ae%be%e8%ae%a1"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvgsff9du7jm%2f&title=PHP%e5%9f%ba%e4%ba%8eThinkphp5%e7%9a%84%e7%a0%8d%e4%bb%b7%e6%b4%bb%e5%8a%a8%e7%9b%b8%e5%85%b3%e8%ae%be%e8%ae%a1"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvgsff9du7jm%2f&title=PHP%e5%9f%ba%e4%ba%8eThinkphp5%e7%9a%84%e7%a0%8d%e4%bb%b7%e6%b4%bb%e5%8a%a8%e7%9b%b8%e5%85%b3%e8%ae%be%e8%ae%a1"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvgsff9du7jm%2f&title=PHP%e5%9f%ba%e4%ba%8eThinkphp5%e7%9a%84%e7%a0%8d%e4%bb%b7%e6%b4%bb%e5%8a%a8%e7%9b%b8%e5%85%b3%e8%ae%be%e8%ae%a1"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">PHP基于Thinkphp5的砍价活动相关设计</h1><div class="meta"><div class="postdate"><time datetime="2018-12-16" itemprop="datePublished">2018-12-16</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e近期我们公司项目里陆陆续续有很多为了招引新用户的活动推出，砍价的活动由我来负责，我们的项目是在微信浏览器里供用户浏览访问。\x3c\/p\x3e\n\x3cp\x3e大概描述：进入砍价活动列表页选择有意向的商品，用户点击商品图片可以看到WEB商城中所卖的商品价格与详细参数等信息，点击列表中对应商品标识下的\x27马上抢购\x27可以进入砍价页面，该页面有两个主要按钮，一个是\x27请土豪帮忙\x27（点击之后起引导分享作用）、\x27买买买\x27（砍到一定价位后可以购买），其次包括价格的进度条等信息，用户分享到朋友圈引来朋友帮忙砍价，在触发砍价按钮的同时，如果帮忙的朋友不是本站用户，那么帮忙的朋友会成为本站的会员，同时会是该分享用户的下级，然后根据产品运营采购针对每个商品的讨论，会给商品定义好要砍价的活动价和最低价，以及每砍一次所能砍掉的价格区间和要参与的人数做计算，比如（商品原价3000，最低价1000，那么所能砍掉的价格是2000，规定参与的人数是500人，那么平均一个人砍掉4块钱，可以设定区间为1~7元，来设定砍价的起伏大小，来提高用户的参与兴趣），当用户砍到规定的价格区间内购买时，跳转到订单确认页面，然后下单支付一系列流程。\x3c\/p\x3e\n\x3cp\x3e页面截图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV2EGi?w=682\x26amp;h=576\x22 src=\x22https:\/\/static.alili.tech\/img\/bV2EGi?w=682\x26amp;h=576\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV2EGn?w=663\x26amp;h=568\x22 src=\x22https:\/\/static.alili.tech\/img\/bV2EGn?w=663\x26amp;h=568\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV2EGr?w=677\x26amp;h=571\x22 src=\x22https:\/\/static.alili.tech\/img\/bV2EGr?w=677\x26amp;h=571\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e实现相关：\x3c\/p\x3e\n\x3cp\x3e通过看到几张图片大概我想大家也会考虑到所涉及的相关信息。\x3c\/p\x3e\n\x3cp\x3e想要发布参与活动的商品就有一个商品区分表示，在数据库的设计当中，我没有修改商品表来增加一个区分的字段，而是新创建了一个数据表作为专门放置砍价活动的相关信息。\x3c\/p\x3e\n\x3cp\x3e来看一下后台的前台展示我是这么设计的，没有经过专业前端之手，仅仅在复制了后台商品列表模块代码的基础上自己简单的做了一下布局。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV2EGx?w=679\x26amp;h=184\x22 src=\x22https:\/\/static.alili.tech\/img\/bV2EGx?w=679\x26amp;h=184\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e我的数据表设计：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22#活动商品设置表：\nCREATE TABLE `hp_activity_bargain` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT \x27主键\x27,\n  `product_id` int(10) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27商品ID\x27,\n  `product_name` varchar(200) COLLATE utf8_unicode_ci NOT NULL COMMENT \x27商品名称\x27,\n  `activity_money` decimal(7,2) unsigned NOT NULL DEFAULT \x270.00\x27 COMMENT \x27活动价\x27,\n  `bargain_section` varchar(20) COLLATE utf8_unicode_ci NOT NULL DEFAULT \x27\x27 COMMENT \x27砍价区间\x27,\n  `bargain_section2` varchar(20) COLLATE utf8_unicode_ci NOT NULL DEFAULT \x27\x27 COMMENT \x27砍价区间2【用户线上砍价(新用户砍价区间)】\x27,   #忽略，此处是迭代后期地推而加上的\n  `join_count` smallint(3) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27参与人数\x27,\n  `product_desc` varchar(80) COLLATE utf8_unicode_ci NOT NULL COMMENT \x27活动商品描述\x27,\n  `attr1_id` smallint(5) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27attr1属性\x27,\n  `attr2_id` smallint(5) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27attr2属性\x27,\n  `type` tinyint(1) NOT NULL DEFAULT \x270\x27 COMMENT \x270是线上，1是地推\x27,\n  PRIMARY KEY (`id`),\n  KEY `product_id` (`product_id`),\n  KEY `attr2_id` (`attr2_id`),\n  KEY `attr1_id` (`attr1_id`),\n  KEY `type` (`type`)\n) ENGINE=MyISAM AUTO_INCREMENT=7 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs n1ql\x22\x3e\x3ccode\x3e#活动商品设置表：\n\x3cspan class=\x22hljs-keyword\x22\x3eCREATE\x3c\/span\x3e TABLE \x3cspan class=\x22hljs-symbol\x22\x3e`hp_activity_bargain`\x3c\/span\x3e (\n  \x3cspan class=\x22hljs-symbol\x22\x3e`id`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e AUTO_INCREMENT COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27主键\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`product_id`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27商品ID\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`product_name`\x3c\/span\x3e varchar(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3eCOLLATE\x3c\/span\x3e utf8_unicode_ci \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27商品名称\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`activity_money`\x3c\/span\x3e decimal(\x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270.00\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27活动价\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`bargain_section`\x3c\/span\x3e varchar(\x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3eCOLLATE\x3c\/span\x3e utf8_unicode_ci \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27砍价区间\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`bargain_section2`\x3c\/span\x3e varchar(\x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3eCOLLATE\x3c\/span\x3e utf8_unicode_ci \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27砍价区间2【用户线上砍价(新用户砍价区间)】\x27\x3c\/span\x3e,   #忽略，此处是迭代后期地推而加上的\n  \x3cspan class=\x22hljs-symbol\x22\x3e`join_count`\x3c\/span\x3e smallint(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27参与人数\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`product_desc`\x3c\/span\x3e varchar(\x3cspan class=\x22hljs-number\x22\x3e80\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3eCOLLATE\x3c\/span\x3e utf8_unicode_ci \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27活动商品描述\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`attr1_id`\x3c\/span\x3e smallint(\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27attr1属性\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`attr2_id`\x3c\/span\x3e smallint(\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27attr2属性\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`type`\x3c\/span\x3e tinyint(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x270是线上，1是地推\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-keyword\x22\x3ePRIMARY\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`product_id`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`product_id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`attr2_id`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`attr2_id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`attr1_id`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`attr1_id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`type`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`type`\x3c\/span\x3e)\n) ENGINE=MyISAM AUTO_INCREMENT=\x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e DEFAULT CHARSET=utf8 \x3cspan class=\x22hljs-keyword\x22\x3eCOLLATE\x3c\/span\x3e=utf8_unicode_ci;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22#用户参与进度信息表\nCREATE TABLE `hp_activity_bargainirg` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT \x27主键ID\x27,\n  `activity_bargain_id` int(10) unsigned NOT NULL COMMENT \x27activity_prodcuts主键id\x27,\n  `product_id` int(10) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27参与活动的商品\x27,\n  `attr1_id` smallint(5) unsigned NOT NULL COMMENT \x27attr1属性id\x27,\n  `attr2_id` smallint(5) unsigned NOT NULL COMMENT \x27attr2属性id\x27,\n  `user_id` int(10) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27砍价商品发起的用户ID\x27,\n  `bargain_count` smallint(5) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27被砍价次数\x27,\n  `deal_money` decimal(7,2) unsigned NOT NULL DEFAULT \x270.00\x27 COMMENT \x27最终交易价格\x27,\n  `create_time` int(11) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27发起时间\x27,\n  `is_addorder` tinyint(1) NOT NULL DEFAULT \x270\x27 COMMENT \x27是否下单(0:未下单，1已下单)\x27,\n  `type` tinyint(1) NOT NULL DEFAULT \x270\x27 COMMENT \x270是线上，1是地推\x27,    #可以忽略，后期地推加上去的\n  PRIMARY KEY (`id`),\n  KEY `activity_bargain_id` (`activity_bargain_id`),\n  KEY `attr1_id` (`attr1_id`),\n  KEY `attr2_id` (`attr2_id`),\n  KEY `product_id` (`product_id`),\n  KEY `user_id` (`user_id`),\n  KEY `is_addorder` (`is_addorder`)\n) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs n1ql\x22\x3e\x3ccode\x3e#用户参与进度信息表\n\x3cspan class=\x22hljs-keyword\x22\x3eCREATE\x3c\/span\x3e TABLE \x3cspan class=\x22hljs-symbol\x22\x3e`hp_activity_bargainirg`\x3c\/span\x3e (\n  \x3cspan class=\x22hljs-symbol\x22\x3e`id`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e AUTO_INCREMENT COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27主键ID\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`activity_bargain_id`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27activity_prodcuts主键id\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`product_id`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27参与活动的商品\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`attr1_id`\x3c\/span\x3e smallint(\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27attr1属性id\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`attr2_id`\x3c\/span\x3e smallint(\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27attr2属性id\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`user_id`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27砍价商品发起的用户ID\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`bargain_count`\x3c\/span\x3e smallint(\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27被砍价次数\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`deal_money`\x3c\/span\x3e decimal(\x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270.00\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27最终交易价格\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`create_time`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e11\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27发起时间\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`is_addorder`\x3c\/span\x3e tinyint(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27是否下单(0:未下单，1已下单)\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`type`\x3c\/span\x3e tinyint(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x270是线上，1是地推\x27\x3c\/span\x3e,    #可以忽略，后期地推加上去的\n  \x3cspan class=\x22hljs-keyword\x22\x3ePRIMARY\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`activity_bargain_id`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`activity_bargain_id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`attr1_id`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`attr1_id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`attr2_id`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`attr2_id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`product_id`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`product_id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`user_id`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`user_id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`is_addorder`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`is_addorder`\x3c\/span\x3e)\n) ENGINE=InnoDB AUTO_INCREMENT=\x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e DEFAULT CHARSET=utf8 \x3cspan class=\x22hljs-keyword\x22\x3eCOLLATE\x3c\/span\x3e=utf8_unicode_ci;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22#参与砍价详情表\nCREATE TABLE `hp_activity_bargain_list` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT \x27主键ID\x27,\n  `bargain_id` int(10) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27activity_bargainirg表主键id\x27,\n  `assistor_id` int(10) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27帮助者ID\x27,\n  `create_time` int(10) unsigned NOT NULL DEFAULT \x270\x27 COMMENT \x27参与时间\x27,\n  `bargain_money` decimal(5,2) unsigned NOT NULL DEFAULT \x270.00\x27 COMMENT \x27砍掉价格\x27,\n  PRIMARY KEY (`id`),\n  KEY `assistor_id` (`assistor_id`),\n  KEY `bargain_id` (`bargain_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs n1ql\x22\x3e\x3ccode\x3e#参与砍价详情表\n\x3cspan class=\x22hljs-keyword\x22\x3eCREATE\x3c\/span\x3e TABLE \x3cspan class=\x22hljs-symbol\x22\x3e`hp_activity_bargain_list`\x3c\/span\x3e (\n  \x3cspan class=\x22hljs-symbol\x22\x3e`id`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e AUTO_INCREMENT COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27主键ID\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`bargain_id`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27activity_bargainirg表主键id\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`assistor_id`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27帮助者ID\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`create_time`\x3c\/span\x3e int(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27参与时间\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-symbol\x22\x3e`bargain_money`\x3c\/span\x3e decimal(\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) unsigned \x3cspan class=\x22hljs-keyword\x22\x3eNOT\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3eNULL\x3c\/span\x3e DEFAULT \x3cspan class=\x22hljs-string\x22\x3e\x270.00\x27\x3c\/span\x3e COMMENT \x3cspan class=\x22hljs-string\x22\x3e\x27砍掉价格\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-keyword\x22\x3ePRIMARY\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`assistor_id`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`assistor_id`\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-keyword\x22\x3eKEY\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e`bargain_id`\x3c\/span\x3e (\x3cspan class=\x22hljs-symbol\x22\x3e`bargain_id`\x3c\/span\x3e)\n) ENGINE=InnoDB AUTO_INCREMENT=\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e DEFAULT CHARSET=utf8 \x3cspan class=\x22hljs-keyword\x22\x3eCOLLATE\x3c\/span\x3e=utf8_unicode_ci;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e控制器几个方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 \/\/线上砍价活动列表\n    public function bargainirgAction() \n    {\n        $type = 0;\n        $way = input(\x27param.way\x27, \x27\x27,\x27string\x27);\n        if (is_not_empty_string($way) \x26amp;\x26amp; $way == \x27live\x27) {\n            $type = 1;\n        }\n        $pageSize = 10;\n        if (Request::isAjax()) {\n            $page = input(\x27post.page\x27, 0, \x27intval\x27);\n            $product_list = Hmodel\\Activity::getActivityBargainProducts($type, $pageSize,  $page * $pageSize);\n            if (is_not_empty_array($product_list)) {\n                return json_encode([\x27status\x27 =\x3e 1, \x27info\x27 =\x3e $product_list]);    \n            } else {\n                return json_encode([\x27status\x27 =\x3e 0]);\n            }\n        }\n        $product_list = Hmodel\\Activity::getActivityBargainProducts($type, 10, 0);\n        $view = new view();\n        $view-\x3eassign(\x27bargainirgList\x27,$product_list);\n        if ($type == 0) {\n            return $view-\x3efetch(\x27bargainirg\x27);\n        } else {\n            return $view-\x3efetch(\x27bargainirg_live\x27);\n        }\n        \n    }\n\n    \/\/砍价活动\\商品详情\\查看贡献度\\请帮忙\n    public function bargaindetailAction() \n    {\n\n        $this-\x3echeckUserLogin();\n        $uid = session(\x27userinfo.uid\x27);\n        \/\/ $uid = 3;\n        $seting_id = input(\x27param.id\x27,0,\x27int\x27);\n        $seting_info = Hmodel\\Activity::getActivityProductsSeting($seting_id);  \/\/砍价活动商品设置\n        $bargain_section2 = !empty($seting_info[\x27bargain_section2\x27]) ? $seting_info[\x27bargain_section2\x27] : \x27no seting\x27;\n        if (!is_not_empty_array($seting_info)) notFund(); \n\n        $bargain_progress = Hmodel\\Activity::returnProgressData( $seting_id, $seting_info[\x27product_id\x27], $uid, $seting_info[\x27attr1_id\x27],$seting_info[\x27attr2_id\x27], \n$seting_info[\x27add_money\x27],$seting_info[\x27type\x27]);\n    \n        if (!is_not_empty_array($bargain_progress) || $bargain_progress[\x27user_id\x27] != $uid) notFund();\n      \n        $username       = session(\x27userinfo.username\x27);\n        $user_info      = Hmodel\\User::getuser_info($uid);\n        $invite_code    = $user_info[\x27invite_code\x27];\n        $encrypt_code   = encrypt_hopeband($bargain_progress[\x27id\x27] . \x27(\x26amp;)\x27 .$bargain_progress[\x27activity_bargain_id\x27] . \x27(\x26amp;)\x27 .$uid . \x27(\x26amp;)\x27 . $invite_code . \x27(\x26amp;)\x27 \n. $seting_info[\x27product_id\x27] . \x27(\x26amp;)\x27 . $seting_info[\x27activity_money\x27] . \x27(\x26amp;)\x27 . $seting_info[\x27bargain_section\x27] .  \x27(\x26amp;)\x27 . $seting_info[\x27bargain_section2\x27] .\x27(\x26amp;)\x27 \n. $seting_info[\x27join_count\x27] . \x27(\x26amp;)\x27. $bargain_progress[\x27type\x27], \x27E\x27, \x27Hp_HopeBand_Bargainirg\x27);\n\n        \/\/是否已经下单\n        \/\/ $is_addorder    = Hmodel\\Activity::checkIsAddorder($bargain_progress[\x27id\x27]);\n        $is_addorder    = $bargain_progress[\x27is_addorder\x27];\n\n        \/\/帮助列表\n        $assistor_list = Hmodel\\Activity::getAssistorList($bargain_progress[\x27id\x27]);\n\n        $view = new view();\n        $view-\x3eassign([\n            \x27bar_code\x27           =\x3e $encrypt_code,\n            \x27seting_info\x27        =\x3e $seting_info,\n            \x27bargain_progress\x27   =\x3e $bargain_progress,\n            \x27assistor_list\x27      =\x3e $assistor_list,\n            \x27seting\x27             =\x3e $seting_id,\n            \x27is_addorder\x27        =\x3e $is_addorder\n        ]);\n        $view-\x3eassign();\n        return $view-\x3efetch();\n\n    }\n\n    \/\/帮忙砍价\\进度\\底部砍价商品列表\n    public function bargainirgingAction ()\n    {\n        $url = $_SERVER[\x27REQUEST_URI\x27];\n        $encrypt_code = substr(substr($url,29),0,strpos(substr($url,29), \x27?invite_code\x27));\n\n        $bargain_param = self::retrunBargainCode($encrypt_code);\n        $bargain_id          = $bargain_param[\x27bargain_id\x27];\n        $bargainInfo         = Hmodel\\Activity::getBargainirgProgress($bargain_id);\n        if ( !is_not_empty_array($bargain_param) || !is_not_empty_array($bargainInfo)) {\n            notFund();\n        }\n\n        $is_addorder = $bargainInfo[\x27is_addorder\x27] == 1 ? true : false;\n  \n        $uid = session(\x27userinfo.uid\x27);\n        $activity_product_id = $bargain_param[\x27activity_product_id\x27];\n\n         if ($bargain_param[\x27sponsor_uid\x27] == $uid) {\n            $this-\x3eredirect(\x27bargaindetail\x27,[\x27id\x27 =\x3e $activity_product_id]);\n        }\n        $product_id          = $bargain_param[\x27product_id\x27];\n        \n        $bargain_list        = Hmodel\\Activity::getActivityBargainProducts($bargain_param[\x27type\x27], 999); \/\/所有参与砍价活动的商品\n\n        foreach ($bargain_list as $v) {\n            if ( $v[\x27id\x27] == $activity_product_id) {\n                $product_info = $v;\n            }\n        }\n\n        if (!is_not_empty_array($product_info)) notFund();\n        $type = $bargain_param[\x27type\x27];\n        $activity_bargain_url = url(\x27activity\/bargainirg\x27) ;\n\n        $view = new view();\n        $view-\x3eassign([\n            \x27bar_code\x27      =\x3e $encrypt_code,   \/\/邀请码\n            \x27bargainInfo\x27   =\x3e $bargainInfo,    \/\/当前砍价进度\n            \x27product_info\x27  =\x3e $product_info,   \/\/商品详情\n            \x27bargain_list\x27  =\x3e $bargain_list,   \/\/底部相关推荐 \n            \x27is_addorder\x27   =\x3e $is_addorder,     \/\/是否入库\n            \x27activity_bargain_url\x27 =\x3e $activity_bargain_url\n        ]);\n        \n        return $view-\x3efetch();\n\n\n    }\n\n    \/\/ajax砍价\n    public function goBargainAction () \n    {\n        if (Request::isAjax()) {\n\n            $uid = session(\x27userinfo.uid\x27);\n            $username = session(\x27userinfo.username\x27);\n            $encrypt_code  = input(\x27post.bar_code\x27, \x27\x27, \x27string\x27);\n            if (empty($uid) || empty($username)) {\n                $this-\x3echeckUserLogin();\n            }\n            $bargain_param = self::retrunBargainCode($encrypt_code);\n            if (!is_not_empty_array($bargain_param)) {\n                echo json_encode(array(\x27status\x27 =\x3e -3, \x27info\x27 =\x3e \x27不明错误,请联系客服\x27));die;\n            }\n\n            $seting_info = Hmodel\\Activity::getActivityProductsSeting($bargain_param[\x27activity_product_id\x27]);  \/\/砍价活动商品设置\n            $stock = Hmodel\\CategoryAttr::getproductstockbyidsonattr($seting_info[\x27product_id\x27],$seting_info[\x27attr1_id\x27],$seting_info[\x27attr2_id\x27]);\n\n            if ($stock[\x27category_sum\x27] \x3c 1) {\n                echo json_encode([\x27status\x27 =\x3e -1, \x27info\x27 =\x3e \x27已抢光!\x27]);die;\n            }\n\n            \n            $userinfo = Hmodel\\User::getuser_info($uid);\n            $register_time = $userinfo[\x27create_time\x27]; \n            $is_new_user = false;           \/\/用户状态[default:老用户]\n            if (($register_time \x2b (60 * 60 * 8)) \x3e time() \x26amp;\x26amp; Hmodel\\Activity::checkUserIsbargainEd($uid) === false) {\n                $is_new_user  = true;       \/\/是新用户\n            }\n    \n            $sponsor_uid   = $bargain_param[\x27sponsor_uid\x27];              \/\/发起者id\n            $bargain_id    = $bargain_param[\x27bargain_id\x27];               \/\/[activity_bargainirg]表主键id\n            $join_count    = $bargain_param[\x27join_count\x27];               \/\/设置砍价次数 \n            $section       = $bargain_param[\x27bargain_section\x27];          \/\/砍价区间（老用户）\n            $section2      = $bargain_param[\x27bargain_section2\x27];         \/\/砍价区间（新用户）\n            $type          = $bargain_param[\x27type\x27] == $seting_info[\x27type\x27] ? $bargain_param[\x27type\x27] : \x27\x27; \/\/0：线上；  1：地推\n            $activity_money= $bargain_param[\x27activity_money\x27];           \/\/活动最低价\n           \n            if (!is_not_empty_string($type)) {\n                echo json_encode(array(\x27status\x27 =\x3e -3, \x27info\x27 =\x3e \x27不明错误,请联系客服\x27));die;\n            }\n\n            if ($uid == $sponsor_uid) {\n                echo json_encode(array(\x27status\x27 =\x3e -1, \x27info\x27 =\x3e \x27不能给自己砍价\x27));die;\n            }\n\n            $state = Hmodel\\Activity::checkPartBargain($bargain_id, $uid);  \/\/是否帮伙伴砍过当前参与的进度\n\n            if ( $state !== false) {\n                echo  json_encode(array(\x27status\x27 =\x3e -2, \x27info\x27 =\x3e \x27您已帮伙伴砍掉\x27 . $state . \x27元啦，不要再砍啦!\x27));die;\n            }\n            if ($type == 1 \x26amp;\x26amp; $is_new_user === false) {\n                echo json_encode(array(\x27status\x27 =\x3e -4, \x27info\x27 =\x3e \x27抱歉，该活动仅限新用户参加！\x27));die;\n            }\n           \n            $state = Hmodel\\Activity::givePartBargain($bargain_id, $sponsor_uid, $uid, $section, $section2, $join_count, $is_new_user,\n            $activity_money, $type);\n            if ($state == -1) {\n                 echo json_encode(array(\x27status\x27 =\x3e -3, \x27info\x27 =\x3e \x27已经最低价啦，不能再砍啦！\x27));die;\n            }\n            if ($state === false) {\n                echo json_encode(array(\x27status\x27 =\x3e -3, \x27info\x27 =\x3e \x27哎呀，失败了！稍后帮我砍一次！\x27));die;\n            } else {\n                if ($is_new_user === true) {\n                    echo json_encode(array(\x27status\x27 =\x3e 2, \x27info\x27 =\x3e \x27砍掉了\x27 . $state .\x27元\x27, \x27deal_money\x27 =\x3e $state));die;\n                } else {\n                    echo json_encode(array(\x27status\x27 =\x3e 1, \x27info\x27 =\x3e \x27成功帮伙伴砍掉\x27 . $state .\x27元!\x27, \x27deal_money\x27 =\x3e $state));die; \n                }\n            }\n\n        }\n    }\n   \n    \/\/返回砍价活动相关数据\n    public static function retrunBargainCode( $encrypt_str = \x27\x27) \n    {\n        $data   = [];\n        $code_str     = encrypt_hopeband($encrypt_str, \x27D\x27, \x27Hp_HopeBand_Bargainirg\x27);\n\n        $code_arr     = explode(\x27(\x26amp;)\x27, $code_str);\n  \n   \n        if (is_not_empty_array($code_arr) \x26amp;\x26amp; count($code_arr) == 10) {\n            $data[\x27bargain_id\x27]             = $code_arr[0];             \/\/砍价活动表主键id\n            $data[\x27activity_product_id\x27]    = $code_arr[1];\n            $data[\x27sponsor_uid\x27]            = $code_arr[2];             \/\/砍价活动发起者uid\n            $data[\x27sponsor_invite_code\x27]    = $code_arr[3];             \/\/砍价活动发起者邀请码\n            $data[\x27product_id\x27]             = $code_arr[4];             \/\/砍价活动发起的商品id\n            $data[\x27activity_money\x27]         = $code_arr[5];             \/\/活动最低价格\n            $data[\x27bargain_section\x27]        = $code_arr[6];             \/\/老用户砍价区间\n            $data[\x27bargain_section2\x27]       = $code_arr[7];             \/\/新用户砍价区间\n            $data[\x27join_count\x27]             = $code_arr[8];             \/\/设置砍价次数\n            $data[\x27type\x27]                   = $code_arr[9];             \/\/设置砍价次数\n\n        }\n\n        return $data;\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/线上砍价活动列表\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ebargainirgAction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \n    \x3c\/span\x3e{\n        $type = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        $way = input(\x3cspan class=\x22hljs-string\x22\x3e\x27param.way\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27string\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (is_not_empty_string($way) \x26amp;\x26amp; $way == \x3cspan class=\x22hljs-string\x22\x3e\x27live\x27\x3c\/span\x3e) {\n            $type = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n        }\n        $pageSize = \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (Request::isAjax()) {\n            $page = input(\x3cspan class=\x22hljs-string\x22\x3e\x27post.page\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27intval\x27\x3c\/span\x3e);\n            $product_list = Hmodel\\Activity::getActivityBargainProducts($type, $pageSize,  $page * $pageSize);\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (is_not_empty_array($product_list)) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e json_encode([\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; $product_list]);    \n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e json_encode([\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]);\n            }\n        }\n        $product_list = Hmodel\\Activity::getActivityBargainProducts($type, \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n        $view = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e view();\n        $view-\x26gt;assign(\x3cspan class=\x22hljs-string\x22\x3e\x27bargainirgList\x27\x3c\/span\x3e,$product_list);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($type == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $view-\x26gt;fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27bargainirg\x27\x3c\/span\x3e);\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $view-\x26gt;fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27bargainirg_live\x27\x3c\/span\x3e);\n        }\n        \n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/砍价活动\\商品详情\\查看贡献度\\请帮忙\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ebargaindetailAction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \n    \x3c\/span\x3e{\n\n        \x3cspan class=\x22hljs-keyword\x22\x3e$this\x3c\/span\x3e-\x26gt;checkUserLogin();\n        $uid = session(\x3cspan class=\x22hljs-string\x22\x3e\x27userinfo.uid\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ $uid = 3;\x3c\/span\x3e\n        $seting_id = input(\x3cspan class=\x22hljs-string\x22\x3e\x27param.id\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27int\x27\x3c\/span\x3e);\n        $seting_info = Hmodel\\Activity::getActivityProductsSeting($seting_id);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/砍价活动商品设置\x3c\/span\x3e\n        $bargain_section2 = !\x3cspan class=\x22hljs-keyword\x22\x3eempty\x3c\/span\x3e($seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_section2\x27\x3c\/span\x3e]) ? $seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_section2\x27\x3c\/span\x3e] : \x3cspan class=\x22hljs-string\x22\x3e\x27no seting\x27\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!is_not_empty_array($seting_info)) notFund(); \n\n        $bargain_progress = Hmodel\\Activity::returnProgressData( $seting_id, $seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27product_id\x27\x3c\/span\x3e], $uid, $seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27attr1_id\x27\x3c\/span\x3e],$seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27attr2_id\x27\x3c\/span\x3e], \n$seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27add_money\x27\x3c\/span\x3e],$seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e]);\n    \n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!is_not_empty_array($bargain_progress) || $bargain_progress[\x3cspan class=\x22hljs-string\x22\x3e\x27user_id\x27\x3c\/span\x3e] != $uid) notFund();\n      \n        $username       = session(\x3cspan class=\x22hljs-string\x22\x3e\x27userinfo.username\x27\x3c\/span\x3e);\n        $user_info      = Hmodel\\User::getuser_info($uid);\n        $invite_code    = $user_info[\x3cspan class=\x22hljs-string\x22\x3e\x27invite_code\x27\x3c\/span\x3e];\n        $encrypt_code   = encrypt_hopeband($bargain_progress[\x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e] . \x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e .$bargain_progress[\x3cspan class=\x22hljs-string\x22\x3e\x27activity_bargain_id\x27\x3c\/span\x3e] . \x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e .$uid . \x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e . $invite_code . \x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e \n. $seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27product_id\x27\x3c\/span\x3e] . \x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e . $seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27activity_money\x27\x3c\/span\x3e] . \x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e . $seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_section\x27\x3c\/span\x3e] .  \x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e . $seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_section2\x27\x3c\/span\x3e] .\x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e \n. $seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27join_count\x27\x3c\/span\x3e] . \x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e. $bargain_progress[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e], \x3cspan class=\x22hljs-string\x22\x3e\x27E\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27Hp_HopeBand_Bargainirg\x27\x3c\/span\x3e);\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/是否已经下单\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ $is_addorder    = Hmodel\\Activity::checkIsAddorder($bargain_progress[\x27id\x27]);\x3c\/span\x3e\n        $is_addorder    = $bargain_progress[\x3cspan class=\x22hljs-string\x22\x3e\x27is_addorder\x27\x3c\/span\x3e];\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/帮助列表\x3c\/span\x3e\n        $assistor_list = Hmodel\\Activity::getAssistorList($bargain_progress[\x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e]);\n\n        $view = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e view();\n        $view-\x26gt;assign([\n            \x3cspan class=\x22hljs-string\x22\x3e\x27bar_code\x27\x3c\/span\x3e           =\x26gt; $encrypt_code,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27seting_info\x27\x3c\/span\x3e        =\x26gt; $seting_info,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27bargain_progress\x27\x3c\/span\x3e   =\x26gt; $bargain_progress,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27assistor_list\x27\x3c\/span\x3e      =\x26gt; $assistor_list,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27seting\x27\x3c\/span\x3e             =\x26gt; $seting_id,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27is_addorder\x27\x3c\/span\x3e        =\x26gt; $is_addorder\n        ]);\n        $view-\x26gt;assign();\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $view-\x26gt;fetch();\n\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/帮忙砍价\\进度\\底部砍价商品列表\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ebargainirgingAction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\n    \x3c\/span\x3e{\n        $url = $_SERVER[\x3cspan class=\x22hljs-string\x22\x3e\x27REQUEST_URI\x27\x3c\/span\x3e];\n        $encrypt_code = substr(substr($url,\x3cspan class=\x22hljs-number\x22\x3e29\x3c\/span\x3e),\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,strpos(substr($url,\x3cspan class=\x22hljs-number\x22\x3e29\x3c\/span\x3e), \x3cspan class=\x22hljs-string\x22\x3e\x27?invite_code\x27\x3c\/span\x3e));\n\n        $bargain_param = \x3cspan class=\x22hljs-keyword\x22\x3eself\x3c\/span\x3e::retrunBargainCode($encrypt_code);\n        $bargain_id          = $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_id\x27\x3c\/span\x3e];\n        $bargainInfo         = Hmodel\\Activity::getBargainirgProgress($bargain_id);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( !is_not_empty_array($bargain_param) || !is_not_empty_array($bargainInfo)) {\n            notFund();\n        }\n\n        $is_addorder = $bargainInfo[\x3cspan class=\x22hljs-string\x22\x3e\x27is_addorder\x27\x3c\/span\x3e] == \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e ? \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e : \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e;\n  \n        $uid = session(\x3cspan class=\x22hljs-string\x22\x3e\x27userinfo.uid\x27\x3c\/span\x3e);\n        $activity_product_id = $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27activity_product_id\x27\x3c\/span\x3e];\n\n         \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27sponsor_uid\x27\x3c\/span\x3e] == $uid) {\n            \x3cspan class=\x22hljs-keyword\x22\x3e$this\x3c\/span\x3e-\x26gt;redirect(\x3cspan class=\x22hljs-string\x22\x3e\x27bargaindetail\x27\x3c\/span\x3e,[\x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e =\x26gt; $activity_product_id]);\n        }\n        $product_id          = $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27product_id\x27\x3c\/span\x3e];\n        \n        $bargain_list        = Hmodel\\Activity::getActivityBargainProducts($bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e], \x3cspan class=\x22hljs-number\x22\x3e999\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/所有参与砍价活动的商品\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eforeach\x3c\/span\x3e ($bargain_list \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e $v) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( $v[\x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e] == $activity_product_id) {\n                $product_info = $v;\n            }\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!is_not_empty_array($product_info)) notFund();\n        $type = $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e];\n        $activity_bargain_url = url(\x3cspan class=\x22hljs-string\x22\x3e\x27activity\/bargainirg\x27\x3c\/span\x3e) ;\n\n        $view = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e view();\n        $view-\x26gt;assign([\n            \x3cspan class=\x22hljs-string\x22\x3e\x27bar_code\x27\x3c\/span\x3e      =\x26gt; $encrypt_code,   \x3cspan class=\x22hljs-comment\x22\x3e\/\/邀请码\x3c\/span\x3e\n            \x3cspan class=\x22hljs-string\x22\x3e\x27bargainInfo\x27\x3c\/span\x3e   =\x26gt; $bargainInfo,    \x3cspan class=\x22hljs-comment\x22\x3e\/\/当前砍价进度\x3c\/span\x3e\n            \x3cspan class=\x22hljs-string\x22\x3e\x27product_info\x27\x3c\/span\x3e  =\x26gt; $product_info,   \x3cspan class=\x22hljs-comment\x22\x3e\/\/商品详情\x3c\/span\x3e\n            \x3cspan class=\x22hljs-string\x22\x3e\x27bargain_list\x27\x3c\/span\x3e  =\x26gt; $bargain_list,   \x3cspan class=\x22hljs-comment\x22\x3e\/\/底部相关推荐 \x3c\/span\x3e\n            \x3cspan class=\x22hljs-string\x22\x3e\x27is_addorder\x27\x3c\/span\x3e   =\x26gt; $is_addorder,     \x3cspan class=\x22hljs-comment\x22\x3e\/\/是否入库\x3c\/span\x3e\n            \x3cspan class=\x22hljs-string\x22\x3e\x27activity_bargain_url\x27\x3c\/span\x3e =\x26gt; $activity_bargain_url\n        ]);\n        \n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $view-\x26gt;fetch();\n\n\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ajax砍价\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egoBargainAction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \n    \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (Request::isAjax()) {\n\n            $uid = session(\x3cspan class=\x22hljs-string\x22\x3e\x27userinfo.uid\x27\x3c\/span\x3e);\n            $username = session(\x3cspan class=\x22hljs-string\x22\x3e\x27userinfo.username\x27\x3c\/span\x3e);\n            $encrypt_code  = input(\x3cspan class=\x22hljs-string\x22\x3e\x27post.bar_code\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27string\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3eempty\x3c\/span\x3e($uid) || \x3cspan class=\x22hljs-keyword\x22\x3eempty\x3c\/span\x3e($username)) {\n                \x3cspan class=\x22hljs-keyword\x22\x3e$this\x3c\/span\x3e-\x26gt;checkUserLogin();\n            }\n            $bargain_param = \x3cspan class=\x22hljs-keyword\x22\x3eself\x3c\/span\x3e::retrunBargainCode($encrypt_code);\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!is_not_empty_array($bargain_param)) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e json_encode(\x3cspan class=\x22hljs-keyword\x22\x3earray\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-3\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27不明错误,请联系客服\x27\x3c\/span\x3e));\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n            }\n\n            $seting_info = Hmodel\\Activity::getActivityProductsSeting($bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27activity_product_id\x27\x3c\/span\x3e]);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/砍价活动商品设置\x3c\/span\x3e\n            $stock = Hmodel\\CategoryAttr::getproductstockbyidsonattr($seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27product_id\x27\x3c\/span\x3e],$seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27attr1_id\x27\x3c\/span\x3e],$seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27attr2_id\x27\x3c\/span\x3e]);\n\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($stock[\x3cspan class=\x22hljs-string\x22\x3e\x27category_sum\x27\x3c\/span\x3e] \x26lt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e json_encode([\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27已抢光!\x27\x3c\/span\x3e]);\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n            }\n\n            \n            $userinfo = Hmodel\\User::getuser_info($uid);\n            $register_time = $userinfo[\x3cspan class=\x22hljs-string\x22\x3e\x27create_time\x27\x3c\/span\x3e]; \n            $is_new_user = \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e;           \x3cspan class=\x22hljs-comment\x22\x3e\/\/用户状态[default:老用户]\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (($register_time \x2b (\x3cspan class=\x22hljs-number\x22\x3e60\x3c\/span\x3e * \x3cspan class=\x22hljs-number\x22\x3e60\x3c\/span\x3e * \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e)) \x26gt; time() \x26amp;\x26amp; Hmodel\\Activity::checkUserIsbargainEd($uid) === \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e) {\n                $is_new_user  = \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e;       \x3cspan class=\x22hljs-comment\x22\x3e\/\/是新用户\x3c\/span\x3e\n            }\n    \n            $sponsor_uid   = $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27sponsor_uid\x27\x3c\/span\x3e];              \x3cspan class=\x22hljs-comment\x22\x3e\/\/发起者id\x3c\/span\x3e\n            $bargain_id    = $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_id\x27\x3c\/span\x3e];               \x3cspan class=\x22hljs-comment\x22\x3e\/\/[activity_bargainirg]表主键id\x3c\/span\x3e\n            $join_count    = $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27join_count\x27\x3c\/span\x3e];               \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置砍价次数 \x3c\/span\x3e\n            $section       = $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_section\x27\x3c\/span\x3e];          \x3cspan class=\x22hljs-comment\x22\x3e\/\/砍价区间（老用户）\x3c\/span\x3e\n            $section2      = $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_section2\x27\x3c\/span\x3e];         \x3cspan class=\x22hljs-comment\x22\x3e\/\/砍价区间（新用户）\x3c\/span\x3e\n            $type          = $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e] == $seting_info[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e] ? $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e] : \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/0：线上；  1：地推\x3c\/span\x3e\n            $activity_money= $bargain_param[\x3cspan class=\x22hljs-string\x22\x3e\x27activity_money\x27\x3c\/span\x3e];           \x3cspan class=\x22hljs-comment\x22\x3e\/\/活动最低价\x3c\/span\x3e\n           \n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!is_not_empty_string($type)) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e json_encode(\x3cspan class=\x22hljs-keyword\x22\x3earray\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-3\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27不明错误,请联系客服\x27\x3c\/span\x3e));\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n            }\n\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($uid == $sponsor_uid) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e json_encode(\x3cspan class=\x22hljs-keyword\x22\x3earray\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27不能给自己砍价\x27\x3c\/span\x3e));\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n            }\n\n            $state = Hmodel\\Activity::checkPartBargain($bargain_id, $uid);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/是否帮伙伴砍过当前参与的进度\x3c\/span\x3e\n\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( $state !== \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e  json_encode(\x3cspan class=\x22hljs-keyword\x22\x3earray\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-2\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27您已帮伙伴砍掉\x27\x3c\/span\x3e . $state . \x3cspan class=\x22hljs-string\x22\x3e\x27元啦，不要再砍啦!\x27\x3c\/span\x3e));\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n            }\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($type == \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x26amp;\x26amp; $is_new_user === \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e json_encode(\x3cspan class=\x22hljs-keyword\x22\x3earray\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-4\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27抱歉，该活动仅限新用户参加！\x27\x3c\/span\x3e));\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n            }\n           \n            $state = Hmodel\\Activity::givePartBargain($bargain_id, $sponsor_uid, $uid, $section, $section2, $join_count, $is_new_user,\n            $activity_money, $type);\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($state == \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n                 \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e json_encode(\x3cspan class=\x22hljs-keyword\x22\x3earray\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-3\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27已经最低价啦，不能再砍啦！\x27\x3c\/span\x3e));\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n            }\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($state === \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e json_encode(\x3cspan class=\x22hljs-keyword\x22\x3earray\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-3\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27哎呀，失败了！稍后帮我砍一次！\x27\x3c\/span\x3e));\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($is_new_user === \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e json_encode(\x3cspan class=\x22hljs-keyword\x22\x3earray\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27砍掉了\x27\x3c\/span\x3e . $state .\x3cspan class=\x22hljs-string\x22\x3e\x27元\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27deal_money\x27\x3c\/span\x3e =\x26gt; $state));\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n                } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e json_encode(\x3cspan class=\x22hljs-keyword\x22\x3earray\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27成功帮伙伴砍掉\x27\x3c\/span\x3e . $state .\x3cspan class=\x22hljs-string\x22\x3e\x27元!\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27deal_money\x27\x3c\/span\x3e =\x26gt; $state));\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e; \n                }\n            }\n\n        }\n    }\n   \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/返回砍价活动相关数据\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eretrunBargainCode\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e( $encrypt_str = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)\x3c\/span\x3e \n    \x3c\/span\x3e{\n        $data   = [];\n        $code_str     = encrypt_hopeband($encrypt_str, \x3cspan class=\x22hljs-string\x22\x3e\x27D\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27Hp_HopeBand_Bargainirg\x27\x3c\/span\x3e);\n\n        $code_arr     = explode(\x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e, $code_str);\n  \n   \n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (is_not_empty_array($code_arr) \x26amp;\x26amp; count($code_arr) == \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) {\n            $data[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_id\x27\x3c\/span\x3e]             = $code_arr[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];             \x3cspan class=\x22hljs-comment\x22\x3e\/\/砍价活动表主键id\x3c\/span\x3e\n            $data[\x3cspan class=\x22hljs-string\x22\x3e\x27activity_product_id\x27\x3c\/span\x3e]    = $code_arr[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n            $data[\x3cspan class=\x22hljs-string\x22\x3e\x27sponsor_uid\x27\x3c\/span\x3e]            = $code_arr[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e];             \x3cspan class=\x22hljs-comment\x22\x3e\/\/砍价活动发起者uid\x3c\/span\x3e\n            $data[\x3cspan class=\x22hljs-string\x22\x3e\x27sponsor_invite_code\x27\x3c\/span\x3e]    = $code_arr[\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e];             \x3cspan class=\x22hljs-comment\x22\x3e\/\/砍价活动发起者邀请码\x3c\/span\x3e\n            $data[\x3cspan class=\x22hljs-string\x22\x3e\x27product_id\x27\x3c\/span\x3e]             = $code_arr[\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e];             \x3cspan class=\x22hljs-comment\x22\x3e\/\/砍价活动发起的商品id\x3c\/span\x3e\n            $data[\x3cspan class=\x22hljs-string\x22\x3e\x27activity_money\x27\x3c\/span\x3e]         = $code_arr[\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e];             \x3cspan class=\x22hljs-comment\x22\x3e\/\/活动最低价格\x3c\/span\x3e\n            $data[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_section\x27\x3c\/span\x3e]        = $code_arr[\x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e];             \x3cspan class=\x22hljs-comment\x22\x3e\/\/老用户砍价区间\x3c\/span\x3e\n            $data[\x3cspan class=\x22hljs-string\x22\x3e\x27bargain_section2\x27\x3c\/span\x3e]       = $code_arr[\x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e];             \x3cspan class=\x22hljs-comment\x22\x3e\/\/新用户砍价区间\x3c\/span\x3e\n            $data[\x3cspan class=\x22hljs-string\x22\x3e\x27join_count\x27\x3c\/span\x3e]             = $code_arr[\x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e];             \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置砍价次数\x3c\/span\x3e\n            $data[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e]                   = $code_arr[\x3cspan class=\x22hljs-number\x22\x3e9\x3c\/span\x3e];             \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置砍价次数\x3c\/span\x3e\n\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $data;\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22public function checkOrder2PayAction()\n    {\n        $this-\x3echeckUserLogin();\n        if (!Request::isAjax()) { notFund(); }\n        $seting_id = input(\x27post.seting\x27,0,\x27intval\x27);\n        $user_id   = session(\x27userinfo.uid\x27);\n        \/\/拿付款的额度和商品id\n        $BargainPayData = Hmodel\\Activity::getBargainResult2Pay($seting_id, $user_id);\n        $stock = Hmodel\\CategoryAttr::getproductstockbyidsonattr($BargainPayData[\x27product_id\x27],$BargainPayData[\x27attr1_id\x27],$BargainPayData[\x27attr2_id\x27]);\n        if ($stock[\x27category_sum\x27] \x3c 1) {\n            return json_encode([\x27status\x27 =\x3e -2, \x27info\x27 =\x3e \x27已抢光!\x27]);die;\n        }\n        if ($BargainPayData[\x27is_addorder\x27] == 1) {\n             return json_encode([\x27status\x27 =\x3e -2, \x27info\x27 =\x3e \x27此商品已经购买过，不能重复购买！\x27]);die;\n        }\n        if (!is_not_empty_array( $BargainPayData)) {\n            return json_encode([\x27status\x27 =\x3e -1, \x27info\x27 =\x3e \x27不明错误,请联系客服!\x27]);die;\n        }\n\n        $product_id = $BargainPayData[\x27product_id\x27];\n\n        $attr1_name = \x27\x27;\n        $attr2_name = \x27\x27;\n        if (is_not_empty_array($attr1_info = Hmodel\\Activity::getAttr1NameByAttrId($BargainPayData[\x27attr1_id\x27], $product_id))){\n            $attr1_name = $attr1_info[\x27attr\x27];\n        }\n        if (is_not_empty_array($attr2_info = Hmodel\\Activity::getAttr2NameByAttrId($BargainPayData[\x27attr2_id\x27], $product_id))){\n            $attr2_name = $attr2_info[\x27attr\x27];\n        }\n        $data = [\n            \x27product_id\x27  =\x3e $product_id,\n            \x27prodcut_num\x27 =\x3e 1,\n            \x27attr1\x27       =\x3e $attr1_name,\n            \x27attr2\x27       =\x3e $attr2_name,\n            \x27seting_id\x27   =\x3e $seting_id\n        ];\n        return json_encode([\x27status\x27 =\x3e 1, \x27info\x27 =\x3e $data]);\n    \n    }\n\n     \/\/查看砍价后的预付款订单信息\n    public function createActivityOrderAction ()\n    {\n        $this-\x3echeckUserLogin();\n\n        $uid = session(\x27userinfo.uid\x27);\n\n        $product_num = 1;\n        $attr1 = input(\x26quot;param.attr1\x26quot;, \x26quot;\x26quot; , \x26quot;trim,string\x26quot;);\n        $attr2 = input(\x26quot;param.attr2\x26quot;, \x26quot;\x26quot; , \x26quot;trim,string\x26quot;);\n        $seting_id = intval(input(\x27param.seting_id\x27, 0, \x27intval\x27));\n        $product_id  = intval(input(\x26quot;param.product_id\x26quot;, \x26quot;\x26quot; , \x26quot;intval\x26quot;));\n\n        $pay_price_money = Hmodel\\Activity::returnPayMoney($product_id, $seting_id, $uid);\n\n        $type = $pay_price_money[\x27type\x27];\n\n        if (!is_not_empty_array($pay_price_money)) notFund();\n        Cookie::set(\x27ready_finish_bargain\x27, encrypt_hopeband($pay_price_money[\x27id\x27] . \x27(\x26amp;)\x27, \x27E\x27, \x27hp_ready_bargain_pay\x27));\n        $pay_info = $this-\x3ecalculateFromProduct($product_id, $product_num, $attr1, $attr2, $uid , $pay_price_money[\x27deal_money\x27], $type);\n        $def_address = Hmodel\\UserAddress::getDefAddress($uid);\n        $view = new View();\n        $view-\x3eassign(\x27def_address\x27,$def_address);\n        $view-\x3eassign(\x27product_carlist_bymerchantid\x27,$pay_info[\x27product_carlist_bymerchantid\x27]);\n        $view-\x3eassign(\x27total_price\x27,sprintf(\x26quot;%.2f\x26quot;,$pay_info[\x27total_price\x27]));\n\n        $view-\x3eassign(\x27total_delivery\x27,$pay_info[\x27total_delivery\x27]);\n        $view-\x3eassign(\x27seting_id\x27,$seting_id);\n\n\n        \n\n        return $view-\x3efetch(\x27createorder\x27);\n    }\n    \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3echeckOrder2PayAction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\n    \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3e$this\x3c\/span\x3e-\x26gt;checkUserLogin();\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!Request::isAjax()) { notFund(); }\n        $seting_id = input(\x3cspan class=\x22hljs-string\x22\x3e\x27post.seting\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27intval\x27\x3c\/span\x3e);\n        $user_id   = session(\x3cspan class=\x22hljs-string\x22\x3e\x27userinfo.uid\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/拿付款的额度和商品id\x3c\/span\x3e\n        $BargainPayData = Hmodel\\Activity::getBargainResult2Pay($seting_id, $user_id);\n        $stock = Hmodel\\CategoryAttr::getproductstockbyidsonattr($BargainPayData[\x3cspan class=\x22hljs-string\x22\x3e\x27product_id\x27\x3c\/span\x3e],$BargainPayData[\x3cspan class=\x22hljs-string\x22\x3e\x27attr1_id\x27\x3c\/span\x3e],$BargainPayData[\x3cspan class=\x22hljs-string\x22\x3e\x27attr2_id\x27\x3c\/span\x3e]);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($stock[\x3cspan class=\x22hljs-string\x22\x3e\x27category_sum\x27\x3c\/span\x3e] \x26lt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e json_encode([\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-2\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27已抢光!\x27\x3c\/span\x3e]);\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($BargainPayData[\x3cspan class=\x22hljs-string\x22\x3e\x27is_addorder\x27\x3c\/span\x3e] == \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n             \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e json_encode([\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-2\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27此商品已经购买过，不能重复购买！\x27\x3c\/span\x3e]);\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!is_not_empty_array( $BargainPayData)) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e json_encode([\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27不明错误,请联系客服!\x27\x3c\/span\x3e]);\x3cspan class=\x22hljs-keyword\x22\x3edie\x3c\/span\x3e;\n        }\n\n        $product_id = $BargainPayData[\x3cspan class=\x22hljs-string\x22\x3e\x27product_id\x27\x3c\/span\x3e];\n\n        $attr1_name = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n        $attr2_name = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (is_not_empty_array($attr1_info = Hmodel\\Activity::getAttr1NameByAttrId($BargainPayData[\x3cspan class=\x22hljs-string\x22\x3e\x27attr1_id\x27\x3c\/span\x3e], $product_id))){\n            $attr1_name = $attr1_info[\x3cspan class=\x22hljs-string\x22\x3e\x27attr\x27\x3c\/span\x3e];\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (is_not_empty_array($attr2_info = Hmodel\\Activity::getAttr2NameByAttrId($BargainPayData[\x3cspan class=\x22hljs-string\x22\x3e\x27attr2_id\x27\x3c\/span\x3e], $product_id))){\n            $attr2_name = $attr2_info[\x3cspan class=\x22hljs-string\x22\x3e\x27attr\x27\x3c\/span\x3e];\n        }\n        $data = [\n            \x3cspan class=\x22hljs-string\x22\x3e\x27product_id\x27\x3c\/span\x3e  =\x26gt; $product_id,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27prodcut_num\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27attr1\x27\x3c\/span\x3e       =\x26gt; $attr1_name,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27attr2\x27\x3c\/span\x3e       =\x26gt; $attr2_name,\n            \x3cspan class=\x22hljs-string\x22\x3e\x27seting_id\x27\x3c\/span\x3e   =\x26gt; $seting_id\n        ];\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e json_encode([\x3cspan class=\x22hljs-string\x22\x3e\x27status\x27\x3c\/span\x3e =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27info\x27\x3c\/span\x3e =\x26gt; $data]);\n    \n    }\n\n     \x3cspan class=\x22hljs-comment\x22\x3e\/\/查看砍价后的预付款订单信息\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateActivityOrderAction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\n    \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3e$this\x3c\/span\x3e-\x26gt;checkUserLogin();\n\n        $uid = session(\x3cspan class=\x22hljs-string\x22\x3e\x27userinfo.uid\x27\x3c\/span\x3e);\n\n        $product_num = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n        $attr1 = input(\x3cspan class=\x22hljs-string\x22\x3e\x22param.attr1\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e , \x3cspan class=\x22hljs-string\x22\x3e\x22trim,string\x22\x3c\/span\x3e);\n        $attr2 = input(\x3cspan class=\x22hljs-string\x22\x3e\x22param.attr2\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e , \x3cspan class=\x22hljs-string\x22\x3e\x22trim,string\x22\x3c\/span\x3e);\n        $seting_id = intval(input(\x3cspan class=\x22hljs-string\x22\x3e\x27param.seting_id\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27intval\x27\x3c\/span\x3e));\n        $product_id  = intval(input(\x3cspan class=\x22hljs-string\x22\x3e\x22param.product_id\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e , \x3cspan class=\x22hljs-string\x22\x3e\x22intval\x22\x3c\/span\x3e));\n\n        $pay_price_money = Hmodel\\Activity::returnPayMoney($product_id, $seting_id, $uid);\n\n        $type = $pay_price_money[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e];\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!is_not_empty_array($pay_price_money)) notFund();\n        Cookie::set(\x3cspan class=\x22hljs-string\x22\x3e\x27ready_finish_bargain\x27\x3c\/span\x3e, encrypt_hopeband($pay_price_money[\x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e] . \x3cspan class=\x22hljs-string\x22\x3e\x27(\x26amp;)\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27E\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27hp_ready_bargain_pay\x27\x3c\/span\x3e));\n        $pay_info = \x3cspan class=\x22hljs-keyword\x22\x3e$this\x3c\/span\x3e-\x26gt;calculateFromProduct($product_id, $product_num, $attr1, $attr2, $uid , $pay_price_money[\x3cspan class=\x22hljs-string\x22\x3e\x27deal_money\x27\x3c\/span\x3e], $type);\n        $def_address = Hmodel\\UserAddress::getDefAddress($uid);\n        $view = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e View();\n        $view-\x26gt;assign(\x3cspan class=\x22hljs-string\x22\x3e\x27def_address\x27\x3c\/span\x3e,$def_address);\n        $view-\x26gt;assign(\x3cspan class=\x22hljs-string\x22\x3e\x27product_carlist_bymerchantid\x27\x3c\/span\x3e,$pay_info[\x3cspan class=\x22hljs-string\x22\x3e\x27product_carlist_bymerchantid\x27\x3c\/span\x3e]);\n        $view-\x26gt;assign(\x3cspan class=\x22hljs-string\x22\x3e\x27total_price\x27\x3c\/span\x3e,sprintf(\x3cspan class=\x22hljs-string\x22\x3e\x22%.2f\x22\x3c\/span\x3e,$pay_info[\x3cspan class=\x22hljs-string\x22\x3e\x27total_price\x27\x3c\/span\x3e]));\n\n        $view-\x26gt;assign(\x3cspan class=\x22hljs-string\x22\x3e\x27total_delivery\x27\x3c\/span\x3e,$pay_info[\x3cspan class=\x22hljs-string\x22\x3e\x27total_delivery\x27\x3c\/span\x3e]);\n        $view-\x26gt;assign(\x3cspan class=\x22hljs-string\x22\x3e\x27seting_id\x27\x3c\/span\x3e,$seting_id);\n\n\n        \n\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $view-\x26gt;fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27createorder\x27\x3c\/span\x3e);\n    }\n    \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eModel层部分方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/根据主键id查询活动产品相关属性设置\n    public static function getActivityProductsSeting( $id = 0) {\n        $data = [];\n        if (!is_positive_integer($id)) {\n            return $data;\n        }\n        $sql = \x26quot;SELECT a.`id`,a.`product_id`,a.`activity_money`,a.`bargain_section`,a.`join_count`,a.`product_desc`,a.`product_name`,\n                a.`attr1_id`,a.`attr2_id`,\n                b.`give_score`,b.`category_img`,b.`add_money`,b.`category_sum`\n                FROM `hp_activity_bargain` AS a\n                LEFT JOIN `hp_category_attr` AS b\n                ON a.`attr1_id` = b.`attr1_son_id` AND a.`attr2_id` = b.`attr2_son_id` AND a.`product_id` = b.`category_id`\n                WHERE a.`id` = $id\n                LIMIT 1\x26quot;;\n        $res = Db::query($sql);\n        if (is_not_empty_array($res)) {\n            $data = $res[0];\n        }\n        return $data;\n    }\n    \/\/通过主键id拿砍价活动表的相关信息\n    public static function getBargainirgProgress($id = 0) {\n        $data = [];\n        $sql = \x26quot;SELECT `id`,`activity_bargain_id`,`product_id`,`attr1_id`,`attr2_id`,`user_id`,`bargain_count`,`deal_money`,`is_addorder` \n                FROM `hp_activity_bargainirg` \n                WHERE `id` = $id LIMIT 1\x26quot;;\n        $res = self::query($sql);\n        if (is_not_empty_array($res)) {\n            $data = $res[0];\n        }\n        return $data;\n    }\n    \/\/返回要砍\n    public static function returnProgressData($a_b_id = 0, $product_id = 0, $user_id = 0, $attr1_son_id = 0, $attr2_son_id = 0, $deal_money= 0){\n        $data = [];\n        $sql = \x26quot;SELECT `id`,`activity_bargain_id`,`product_id`,`attr1_id`,`attr2_id`,`user_id`,`bargain_count`,`deal_money`,`is_addorder`\n                FROM `hp_activity_bargainirg` \n                WHERE `activity_bargain_id` = $a_b_id AND `attr1_id` = $attr1_son_id AND `attr2_id` = $attr2_son_id AND `product_id` = $product_id AND `user_id` = $user_id \n                LIMIT 1\x26quot;;\n\n        $res = self::query($sql);\n        if (is_not_empty_array($res)) {\n            $data = $res[0];\n        } else {\n            $data[\x27activity_bargain_id\x27] = $a_b_id;\n            $data[\x27product_id\x27]          = $product_id;\n            $data[\x27user_id\x27]             = $user_id;\n            $data[\x27deal_money\x27]          = $deal_money; \n            $data[\x27attr1_id\x27]            = $attr1_son_id; \n            $data[\x27attr2_id\x27]            = $attr2_son_id;   \n            $data[\x27create_time\x27]         = time(); \n            $data[\x27bargain_count\x27]       = 0; \n            Db::name(\x27activity_bargainirg\x27)-\x3einsert($data);\n            $insertId =  Db::name(\x27activity_bargainirg\x27)-\x3egetLastInsID();\n            $data[\x27id\x27]                  = $insertId;\n            \/\/ $data = self::getBargainirgProgress($insert_id);\n        }\n        return $data;\n    }\n    \/\/通过 表[activity_products] 主键id 和 user_id 拿到用户购买前要付款的额度和购买商品\n    public static function getBargainResult2Pay($a_b_id = 0, $user_id = 0) {\n        $data  = [];\n        if ( !is_positive_integer($a_b_id) || !is_positive_integer($user_id)) {\n            return $data;\n        }\n        $sql = \x26quot;SELECT `id`,`deal_money`,`product_id`,`attr1_id`,`attr2_id` FROM `hp_activity_bargainirg`\n                WHERE `activity_bargain_id` = $a_b_id AND `user_id` = $user_id\n                LIMIT 1\x26quot;;\n        $res = Db::query($sql);\n        if (is_not_empty_array($res)) {\n            $data = $res[0];\n        }\n        return $data;\n    }\n\n    \/\/检测是否帮助伙伴砍价\n    \/\/$bargain_id       [activity_bargainirg]表主键id\n    \/\/$assistor_id      帮助砍价者用户id\n    public static function checkPartBargain ($bargain_id = 0, $assistor_id = 0) {\n        $state = false;\n        if (!is_positive_integer($bargain_id) || !is_positive_integer($assistor_id)) {\n            return $state;\n        }\n        $sql = \x26quot;SELECT `bargain_money` FROM `hp_activity_bargain_list`\n                WHERE  `bargain_id` = $bargain_id AND  `assistor_id` = $assistor_id \n                LIMIT 1\x26quot;;\n\n        $res = self::query($sql);\n\n        if (is_not_empty_array($res)) {\n\n            return $res[0][\x27bargain_money\x27];\n        }\n        return $state;\n\n    }\n\n    \/\/查询帮忙砍价的伙伴列表\n    public static function getAssistorList ( $bargain_id = 0){\n        $data = [];\n        if (is_positive_integer($bargain_id) \x26amp;\x26amp; is_positive_integer($assistor_id)) \n            return $data;\n        $sql = \x26quot;SELECT a.`create_time`, a.`bargain_money`, b.`nickname`, b.`headimgurl` \n                FROM `hp_activity_bargain_list` AS a\n                LEFT JOIN `hp_user_auths` AS b\n                ON a.`assistor_id` = b.`user_id`\n                WHERE a.`bargain_id` = $bargain_id\n                ORDER BY a.`id` DESC\x26quot;;\n\n        $data = self::query($sql);\n        return $data;\n    }\n\n    \/\/拿到上次所砍掉的价格\n    public static function getBeforeMoney ( $bargain_id = 0, $limit = 1) {\n        $beforemoney_sum = 0;\n        $sql = \x26quot;SELECT SUM(`bargain_money`) AS beforemoney_sum FROM \n                (SELECT `bargain_money` FROM `hp_activity_bargain_list` \n                WHERE `bargain_id` = $bargain_id\n                ORDER BY `id` DESC\n                LIMIT $limit) sum\x26quot;;\n         \n        $res = Db::query($sql);\n        if (is_not_empty_array($res)) {\n            $beforemoney_sum = $res[0][\x27beforemoney_sum\x27];\n        }\n        return $beforemoney_sum;\n    }\n    \n     \/**\n     * 砍价相关数据操作\n     *$bargain_id    [activity_bargainirg] 表主键id\n     *$sponsor_id    砍价发起者id\n     *$assistor_id   帮助砍价者id\n     *$min           最小值\n     *$max           最大值\n     *$join_count    设置要参与砍价的人数\n     *return bool\n     *\/\n    public static function givePartBargain($bargain_id = 0, $sponsor_id = 0, $assistor_id = 0, $min = 0, $max = 0,$join_count = 0) {\n        $state = false;\n        if (is_positive_integer($assistor_id) \x26amp;\x26amp; $bargain_id \x3e 0 \x26amp;\x26amp; is_positive_integer($sponsor_id)) {\n            $bargainirg_info = Db::name(\x27activity_bargainirg\x27)-\x3efind($bargain_id);\n\n            if ( !$bargainirg_info ) {\n                return $state;\n            }\n\n            $fp = fopen(\x27.\/bargain_lock.txt\x27,\x27r\x27);\n            $try = 5; \n            do {\n                $lock = flock($fp,LOCK_EX);\n                if(!$lock)\n                    usleep(5000); \n            } while (!$lock \x26amp;\x26amp; --$try \x3e= 0) ;\n            if ($lock) {\n                Db::startTrans();\n                try {\n                    $bargain_money = self::returnRandMoney($bargain_id, $min, $max, $join_count);\n                    \/*-------------*\/\n                    $id  = 0;\n                    $sql = \x26quot;UPDATE `hp_activity_bargainirg` \n                            SET `deal_money` = `deal_money` - $bargain_money,`bargain_count` = `bargain_count`\x2b 1 \n                            WHERE `id` = $bargain_id AND `user_id` = $sponsor_id AND `deal_money` \x3e $bargain_money\n                            AND `bargain_count` \x3c $join_count\x26quot;;\n                    $row = self::execute($sql);\n                    if ( $row \x3e 0) {\n                        $insert_data = [];\n                        $insert_data[\x27bargain_id\x27]      = $bargain_id;\n                        $insert_data[\x27assistor_id\x27]     = $assistor_id;\n                        $insert_data[\x27bargain_money\x27]   = $bargain_money;\n                        $insert_data[\x27create_time\x27]     = time();\n                        $id = Db::name(\x27activity_bargain_list\x27)-\x3einsert($insert_data);\n                    }\n                    \/*-------------*\/\n                    if ($id \x3e 0) \n                        $state = true; \n                    Db::commit();\n                }catch(\\Exception $e){\n                    $state = false;\n                    Db::rollback();\n                }\n　　　　　　　　flock($lock,LOCK_UN);\n　　　　　　　　fclose($lock);\n\n            } \n        }\n        if ($state !== false ) {\n            return $bargain_money;\n        }\n        return $state;\n    }\n\n    \/\/返回要砍的价格\n    public static function returnRandMoney ($bargain_id = 0, $min = 0 ,$max = 0, $join_count = 0 ){\n        $randMoney       = self::randomFloat( $min, $max);                  \/\/返回随机价格  \n        $prev_Progress   = self::getBargainirgProgress($bargain_id);            \n        $prev_bargain_count = $prev_Progress[\x27bargain_count\x27];              \/\/返回已经被砍价的次数  \n        $remainder = $prev_bargain_count % 3; \n\n        $bout_count = floor($join_count \/ 3) * 3;  \/\/最后一轮结束的刀数       39\n        $last_num = $join_count - $bout_count;\n        $avg = ($min \x2b $max) \/ 2;\n        $before_sum  = self::getBeforeMoney($bargain_id, $remainder);\n\n        if ($prev_bargain_count \x3e= $bout_count) {\n            if ($last_num == 1){\n                return $avg;\n            } elseif ($last_num == 2) {\n                $end = $join_count - $prev_Progress[\x27bargain_count\x27] ;\n                if ($end == 2) {\n                    return $randMoney;\n                } elseif($end == 1) {\n                    return $avg * 2 - $before_sum;\n                }\n            }  \n        }\n        \/\/ $remainder_num   = $join_count % 3;         \/\/总回合数的余数\n        if ($remainder \x3e 0) {\n            if ( $remainder == 1) { \n                $point      = $max * 0.8;    \/\/最大额度的80%\n                $bout_sum   = 3 * $avg;\n                if ($before_sum \x3e= $point) {\n                    $randMoney = self::randomFloat($min, ($bout_sum - $before_sum) \/ 2);\n                } else {\n                    $randMoney = self::randomFloat(($bout_sum - $before_sum) \/ 2 , $point);\n                }\n            }\n            if ($remainder == 2) {\n                $round_sum_money = 3 * $avg;            \n                $randMoney       = $round_sum_money - $before_sum;\n            }\n        } \n        return $randMoney;\n                \n    }\n    \/\/拿随机价格\n    public static function randomFloat($min = 0, $max = 1) {\n         return round($min \x2b mt_rand() \/ mt_getrandmax() * ($max - $min),2);\n    }\n\n\n\n   \/\/拿砍价活动下所有商品\n    public static function getActivityBargainProducts ( $limit = 0, $offset = 0) {\n        $data = [];\n        $sql = \x26quot;SELECT a.`id`,a.`product_id`,a.`activity_money`,a.`bargain_section`,a.`join_count`,a.`product_desc`,a.`product_name`,\n                a.`attr1_id`,a.`attr2_id`,\n                b.`give_score`,b.`category_img`,b.`add_money`,b.`category_sum`\n                FROM `hp_activity_bargain` AS a\n                LEFT JOIN `hp_category_attr` AS b\n                ON a.`attr1_id` = b.`attr1_son_id` AND a.`attr2_id` = b.`attr2_son_id` AND a.`product_id` = b.`category_id`\n                WHERE 1 = 1\n                ORDER BY a.`id` DESC\n                LIMIT $limit OFFSET $offset\x26quot;;\n        $data = self::query($sql);        \n        return $data;\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre\x3e\x3ccode\x3e\/\/根据主键id查询活动产品相关属性设置\n    public static function getActivityProductsSeting( $id = 0) {\n        $data = [];\n        if (!is_positive_integer($id)) {\n            return $data;\n        }\n        $sql = \x22SELECT a.`id`,a.`product_id`,a.`activity_money`,a.`bargain_section`,a.`join_count`,a.`product_desc`,a.`product_name`,\n                a.`attr1_id`,a.`attr2_id`,\n                b.`give_score`,b.`category_img`,b.`add_money`,b.`category_sum`\n                FROM `hp_activity_bargain` AS a\n                LEFT JOIN `hp_category_attr` AS b\n                ON a.`attr1_id` = b.`attr1_son_id` AND a.`attr2_id` = b.`attr2_son_id` AND a.`product_id` = b.`category_id`\n                WHERE a.`id` = $id\n                LIMIT 1\x22;\n        $res = Db::query($sql);\n        if (is_not_empty_array($res)) {\n            $data = $res[0];\n        }\n        return $data;\n    }\n    \/\/通过主键id拿砍价活动表的相关信息\n    public static function getBargainirgProgress($id = 0) {\n        $data = [];\n        $sql = \x22SELECT `id`,`activity_bargain_id`,`product_id`,`attr1_id`,`attr2_id`,`user_id`,`bargain_count`,`deal_money`,`is_addorder` \n                FROM `hp_activity_bargainirg` \n                WHERE `id` = $id LIMIT 1\x22;\n        $res = self::query($sql);\n        if (is_not_empty_array($res)) {\n            $data = $res[0];\n        }\n        return $data;\n    }\n    \/\/返回要砍\n    public static function returnProgressData($a_b_id = 0, $product_id = 0, $user_id = 0, $attr1_son_id = 0, $attr2_son_id = 0, $deal_money= 0){\n        $data = [];\n        $sql = \x22SELECT `id`,`activity_bargain_id`,`product_id`,`attr1_id`,`attr2_id`,`user_id`,`bargain_count`,`deal_money`,`is_addorder`\n                FROM `hp_activity_bargainirg` \n                WHERE `activity_bargain_id` = $a_b_id AND `attr1_id` = $attr1_son_id AND `attr2_id` = $attr2_son_id AND `product_id` = $product_id AND `user_id` = $user_id \n                LIMIT 1\x22;\n\n        $res = self::query($sql);\n        if (is_not_empty_array($res)) {\n            $data = $res[0];\n        } else {\n            $data[\x27activity_bargain_id\x27] = $a_b_id;\n            $data[\x27product_id\x27]          = $product_id;\n            $data[\x27user_id\x27]             = $user_id;\n            $data[\x27deal_money\x27]          = $deal_money; \n            $data[\x27attr1_id\x27]            = $attr1_son_id; \n            $data[\x27attr2_id\x27]            = $attr2_son_id;   \n            $data[\x27create_time\x27]         = time(); \n            $data[\x27bargain_count\x27]       = 0; \n            Db::name(\x27activity_bargainirg\x27)-\x26gt;insert($data);\n            $insertId =  Db::name(\x27activity_bargainirg\x27)-\x26gt;getLastInsID();\n            $data[\x27id\x27]                  = $insertId;\n            \/\/ $data = self::getBargainirgProgress($insert_id);\n        }\n        return $data;\n    }\n    \/\/通过 表[activity_products] 主键id 和 user_id 拿到用户购买前要付款的额度和购买商品\n    public static function getBargainResult2Pay($a_b_id = 0, $user_id = 0) {\n        $data  = [];\n        if ( !is_positive_integer($a_b_id) || !is_positive_integer($user_id)) {\n            return $data;\n        }\n        $sql = \x22SELECT `id`,`deal_money`,`product_id`,`attr1_id`,`attr2_id` FROM `hp_activity_bargainirg`\n                WHERE `activity_bargain_id` = $a_b_id AND `user_id` = $user_id\n                LIMIT 1\x22;\n        $res = Db::query($sql);\n        if (is_not_empty_array($res)) {\n            $data = $res[0];\n        }\n        return $data;\n    }\n\n    \/\/检测是否帮助伙伴砍价\n    \/\/$bargain_id       [activity_bargainirg]表主键id\n    \/\/$assistor_id      帮助砍价者用户id\n    public static function checkPartBargain ($bargain_id = 0, $assistor_id = 0) {\n        $state = false;\n        if (!is_positive_integer($bargain_id) || !is_positive_integer($assistor_id)) {\n            return $state;\n        }\n        $sql = \x22SELECT `bargain_money` FROM `hp_activity_bargain_list`\n                WHERE  `bargain_id` = $bargain_id AND  `assistor_id` = $assistor_id \n                LIMIT 1\x22;\n\n        $res = self::query($sql);\n\n        if (is_not_empty_array($res)) {\n\n            return $res[0][\x27bargain_money\x27];\n        }\n        return $state;\n\n    }\n\n    \/\/查询帮忙砍价的伙伴列表\n    public static function getAssistorList ( $bargain_id = 0){\n        $data = [];\n        if (is_positive_integer($bargain_id) \x26amp;\x26amp; is_positive_integer($assistor_id)) \n            return $data;\n        $sql = \x22SELECT a.`create_time`, a.`bargain_money`, b.`nickname`, b.`headimgurl` \n                FROM `hp_activity_bargain_list` AS a\n                LEFT JOIN `hp_user_auths` AS b\n                ON a.`assistor_id` = b.`user_id`\n                WHERE a.`bargain_id` = $bargain_id\n                ORDER BY a.`id` DESC\x22;\n\n        $data = self::query($sql);\n        return $data;\n    }\n\n    \/\/拿到上次所砍掉的价格\n    public static function getBeforeMoney ( $bargain_id = 0, $limit = 1) {\n        $beforemoney_sum = 0;\n        $sql = \x22SELECT SUM(`bargain_money`) AS beforemoney_sum FROM \n                (SELECT `bargain_money` FROM `hp_activity_bargain_list` \n                WHERE `bargain_id` = $bargain_id\n                ORDER BY `id` DESC\n                LIMIT $limit) sum\x22;\n         \n        $res = Db::query($sql);\n        if (is_not_empty_array($res)) {\n            $beforemoney_sum = $res[0][\x27beforemoney_sum\x27];\n        }\n        return $beforemoney_sum;\n    }\n    \n     \/**\n     * 砍价相关数据操作\n     *$bargain_id    [activity_bargainirg] 表主键id\n     *$sponsor_id    砍价发起者id\n     *$assistor_id   帮助砍价者id\n     *$min           最小值\n     *$max           最大值\n     *$join_count    设置要参与砍价的人数\n     *return bool\n     *\/\n    public static function givePartBargain($bargain_id = 0, $sponsor_id = 0, $assistor_id = 0, $min = 0, $max = 0,$join_count = 0) {\n        $state = false;\n        if (is_positive_integer($assistor_id) \x26amp;\x26amp; $bargain_id \x26gt; 0 \x26amp;\x26amp; is_positive_integer($sponsor_id)) {\n            $bargainirg_info = Db::name(\x27activity_bargainirg\x27)-\x26gt;find($bargain_id);\n\n            if ( !$bargainirg_info ) {\n                return $state;\n            }\n\n            $fp = fopen(\x27.\/bargain_lock.txt\x27,\x27r\x27);\n            $try = 5; \n            do {\n                $lock = flock($fp,LOCK_EX);\n                if(!$lock)\n                    usleep(5000); \n            } while (!$lock \x26amp;\x26amp; --$try \x26gt;= 0) ;\n            if ($lock) {\n                Db::startTrans();\n                try {\n                    $bargain_money = self::returnRandMoney($bargain_id, $min, $max, $join_count);\n                    \/*-------------*\/\n                    $id  = 0;\n                    $sql = \x22UPDATE `hp_activity_bargainirg` \n                            SET `deal_money` = `deal_money` - $bargain_money,`bargain_count` = `bargain_count`\x2b 1 \n                            WHERE `id` = $bargain_id AND `user_id` = $sponsor_id AND `deal_money` \x26gt; $bargain_money\n                            AND `bargain_count` \x26lt; $join_count\x22;\n                    $row = self::execute($sql);\n                    if ( $row \x26gt; 0) {\n                        $insert_data = [];\n                        $insert_data[\x27bargain_id\x27]      = $bargain_id;\n                        $insert_data[\x27assistor_id\x27]     = $assistor_id;\n                        $insert_data[\x27bargain_money\x27]   = $bargain_money;\n                        $insert_data[\x27create_time\x27]     = time();\n                        $id = Db::name(\x27activity_bargain_list\x27)-\x26gt;insert($insert_data);\n                    }\n                    \/*-------------*\/\n                    if ($id \x26gt; 0) \n                        $state = true; \n                    Db::commit();\n                }catch(\\Exception $e){\n                    $state = false;\n                    Db::rollback();\n                }\n　　　　　　　　flock($lock,LOCK_UN);\n　　　　　　　　fclose($lock);\n\n            } \n        }\n        if ($state !== false ) {\n            return $bargain_money;\n        }\n        return $state;\n    }\n\n    \/\/返回要砍的价格\n    public static function returnRandMoney ($bargain_id = 0, $min = 0 ,$max = 0, $join_count = 0 ){\n        $randMoney       = self::randomFloat( $min, $max);                  \/\/返回随机价格  \n        $prev_Progress   = self::getBargainirgProgress($bargain_id);            \n        $prev_bargain_count = $prev_Progress[\x27bargain_count\x27];              \/\/返回已经被砍价的次数  \n        $remainder = $prev_bargain_count % 3; \n\n        $bout_count = floor($join_count \/ 3) * 3;  \/\/最后一轮结束的刀数       39\n        $last_num = $join_count - $bout_count;\n        $avg = ($min \x2b $max) \/ 2;\n        $before_sum  = self::getBeforeMoney($bargain_id, $remainder);\n\n        if ($prev_bargain_count \x26gt;= $bout_count) {\n            if ($last_num == 1){\n                return $avg;\n            } elseif ($last_num == 2) {\n                $end = $join_count - $prev_Progress[\x27bargain_count\x27] ;\n                if ($end == 2) {\n                    return $randMoney;\n                } elseif($end == 1) {\n                    return $avg * 2 - $before_sum;\n                }\n            }  \n        }\n        \/\/ $remainder_num   = $join_count % 3;         \/\/总回合数的余数\n        if ($remainder \x26gt; 0) {\n            if ( $remainder == 1) { \n                $point      = $max * 0.8;    \/\/最大额度的80%\n                $bout_sum   = 3 * $avg;\n                if ($before_sum \x26gt;= $point) {\n                    $randMoney = self::randomFloat($min, ($bout_sum - $before_sum) \/ 2);\n                } else {\n                    $randMoney = self::randomFloat(($bout_sum - $before_sum) \/ 2 , $point);\n                }\n            }\n            if ($remainder == 2) {\n                $round_sum_money = 3 * $avg;            \n                $randMoney       = $round_sum_money - $before_sum;\n            }\n        } \n        return $randMoney;\n                \n    }\n    \/\/拿随机价格\n    public static function randomFloat($min = 0, $max = 1) {\n         return round($min \x2b mt_rand() \/ mt_getrandmax() * ($max - $min),2);\n    }\n\n\n\n   \/\/拿砍价活动下所有商品\n    public static function getActivityBargainProducts ( $limit = 0, $offset = 0) {\n        $data = [];\n        $sql = \x22SELECT a.`id`,a.`product_id`,a.`activity_money`,a.`bargain_section`,a.`join_count`,a.`product_desc`,a.`product_name`,\n                a.`attr1_id`,a.`attr2_id`,\n                b.`give_score`,b.`category_img`,b.`add_money`,b.`category_sum`\n                FROM `hp_activity_bargain` AS a\n                LEFT JOIN `hp_category_attr` AS b\n                ON a.`attr1_id` = b.`attr1_son_id` AND a.`attr2_id` = b.`attr2_son_id` AND a.`product_id` = b.`category_id`\n                WHERE 1 = 1\n                ORDER BY a.`id` DESC\n                LIMIT $limit OFFSET $offset\x22;\n        $data = self::query($sql);        \n        return $data;\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>PHP基于Thinkphp5的砍价活动相关设计</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012987076">https://segmentfault.com/a/1190000012987076</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/vgsff9du7jm/" target="_blank">https://alili.tech/archive/vgsff9du7jm/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>