<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React同构总结"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React同构总结 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/w08f4x7fdkc/",
				"appid": "1613049289050283", 
				"title": "React同构总结 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-11T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/fbx4urfzive/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/x2dkitoefk8/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fw08f4x7fdkc%2f&text=React%e5%90%8c%e6%9e%84%e6%80%bb%e7%bb%93"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fw08f4x7fdkc%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fw08f4x7fdkc%2f&text=React%e5%90%8c%e6%9e%84%e6%80%bb%e7%bb%93"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fw08f4x7fdkc%2f&title=React%e5%90%8c%e6%9e%84%e6%80%bb%e7%bb%93"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fw08f4x7fdkc%2f&is_video=false&description=React%e5%90%8c%e6%9e%84%e6%80%bb%e7%bb%93"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%e5%90%8c%e6%9e%84%e6%80%bb%e7%bb%93&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fw08f4x7fdkc%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fw08f4x7fdkc%2f&title=React%e5%90%8c%e6%9e%84%e6%80%bb%e7%bb%93"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw08f4x7fdkc%2f&title=React%e5%90%8c%e6%9e%84%e6%80%bb%e7%bb%93"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw08f4x7fdkc%2f&title=React%e5%90%8c%e6%9e%84%e6%80%bb%e7%bb%93"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw08f4x7fdkc%2f&title=React%e5%90%8c%e6%9e%84%e6%80%bb%e7%bb%93"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React同构总结</h1><div class="meta"><div class="postdate"><time datetime="2018-12-11" itemprop="datePublished">2018-12-11</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e最近花了点时间研究React同构实践，赶上过年回家，心也散了，两个月没写文章。\x3c\/p\x3e\n\x3cp\x3e同构也算是前端的一个应用模式，目的是为了加速首屏显示时间和seo优化，很多公司都将同构作为前端优化的一个优化点来做，同时Raect16版本中也添加了很多对同构的支持，可以看出FB也是默认支持这一场景使用的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e同构原理\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e什么是同构\x3c\/h3\x3e\n\x3cp\x3e一套代码既可以在服务端运行又可以在客户端运行，这就是同构应用。简而言之, 就是服务端直出和客户端渲染的组合, 能够充分结合两者的优势，并有效避免两者的不足。\x3c\/p\x3e\n\x3cp\x3e概括地说，同构就是服务端（Node）替客户端请求接口，获取到数据后，将有数据和结构的页面渲染好之后返回给客户端，这样避免了客户端页面首次渲染，同时服务端RPC比客户端请求要快。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e为什么要同构\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e性能: 通过Node直出, 将传统的三次串行http请求简化成一次http请求，降低首屏渲染时间\x3c\/li\x3e\n\x3cli\x3eSEO: 服务端渲染对搜索引擎的爬取有着天然的优势，虽然阿里电商体系对SEO需求并不强，但随着国际化的推进, 越来越多的国际业务加入阿里大家庭，很多的业务依赖Google等搜索引擎的流量导入，比如Lazada.\x3c\/li\x3e\n\x3cli\x3e兼容性: 部分展示类页面能够有效规避客户端兼容性问题，比如白屏。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e同构与SPA流程对比\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV5gsU?w=740\x26amp;h=790\x22 src=\x22https:\/\/static.alili.tech\/img\/bV5gsU?w=740\x26amp;h=790\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3eSPA：服务端替客户端请求数据，完成第一次render，将render完成之后的html页面返回给客户端，相对于客户端渲染，客户端第一次获取的html是个有数据有结构的html，结合样式文件下载客户端可以较快的看到首屏内容。\x3c\/p\x3e\n\x3cp\x3eSSR：服务端Node也可以运行React解析出页面内容，并且要比客户端更快；客户端通常要在render一次之后请求数据，数据返回之后再render一次，服务端渲染可以解决客户端重复渲染问题。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e同构与SPA时间对比\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV5gtH?w=920\x26amp;h=680\x22 src=\x22https:\/\/static.alili.tech\/img\/bV5gtH?w=920\x26amp;h=680\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e以一个常见的场景为例：\x3c\/p\x3e\n\x3cp\x3e进入页面，componentDidMount中请求数据，同时页面loading，请求返回后，取消loading，页面可交互。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eSPA\x3c\/strong\x3e：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e客户端请求页面，服务端返回SPA的html，此html不可视；（request\x26amp;response）\x3c\/li\x3e\n\x3cli\x3ehtml加载完之后，去加载页面中的js；（processing）\x3c\/li\x3e\n\x3cli\x3ejs加载完成之后开始执行；（rendering）\x3c\/li\x3e\n\x3cli\x3e页面首次渲染完毕，向后端请求数据（loading）\x3c\/li\x3e\n\x3cli\x3e请求返回，页面再次渲染，用户可交互（useing）\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e\x3cstrong\x3eSSR\x3c\/strong\x3e：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e客户端请求页面，服务端去请求数据，请求返回后渲染页面，将渲染好的html返回给客户端，此时页面可视；（request\x26amp;response）\x3c\/li\x3e\n\x3cli\x3ehtml加载完之后，去加载页面中的js；（processing）\x3c\/li\x3e\n\x3cli\x3ejs加载完成之后开始执行；（rendering）\x3c\/li\x3e\n\x3cli\x3ejs解析完毕，用户可交互；（useing）\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e通过上述流程图可发现，理论上同构要比客户端渲染要快，而且体验要好。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e预期问题\x3c\/h2\x3e\n\x3cp\x3e原理了解之后，动手之前思考一些可能出现的问题：\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e1. Node服务器如何识别es6以及React\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3eNode识别ES6可以使用\x3ccode\x3ebabel-register\x3c\/code\x3e插件，该插件使用起来跟\x3ccode\x3e.babelrc\x3c\/code\x3e一样简便。\x3c\/p\x3e\n\x3cp\x3eReact中有一个\x3ccode\x3erenderToString\x3c\/code\x3e方法，该方法将解析好的jsx片段以html字符串形式输出，就是为了同构而诞生。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e2. 服务端如何引入js，css，图片，字体等静态资源\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e实现方法有多种，我这里使用\x3ccode\x3ewebpack-isomorphic-tools\x3c\/code\x3e插件来实现，之后会做介绍。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e3. 服务端如何路由匹配\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e通常我们只做首页，或者关键页面的服务端渲染，相当于从首页进去是服务端渲染，但是从项目其他页面进入就跟正常的SPA一样。所以在服务端将要ssr的路由匹配出来，其他的路由仍交给SPA。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e4. SSR的Redux怎么办\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e通常来讲，我们从接口获取数据，都要将一些数据放到store中，便于其他页面共享。\x3c\/p\x3e\n\x3cp\x3eSSR中，服务端跟SPA公用一部分action和reducer，相同的reducer生成的store是一样的，之后再通过createStore时候将store注入进入，返回给客户端。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e5. SSR的开发流程怎样\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e实际上SSR开发通常是在一个项目基础上改，而不是重新搭建一个项目，比较很多人拿它当做优化，而不是重构。\x3c\/p\x3e\n\x3cp\x3e通常来说我们一个项目按照SPA模式开发，针对特定页面做SSR的修改，修改之后的项目既可以SPA也可以SSR，只不过SPA模式时对应页面获取不到数据，因为获取数据的方法均被修改。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e6. SSR之后，项目的JS体积是否会减小\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e不会减小，所谓同构，其实就是服务端借助客户端的JS去渲染页面，没有影响到客户端的JS，还是正常打包，客户端做代码分割也不会受影响。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e同构实现\x3c\/h2\x3e\n\x3cp\x3e带着上面的问题来看同构如何实现。\x3c\/p\x3e\n\x3cp\x3eReact实现同构方法有多重，而且都较为成熟，这里选用的\x3ccode\x3ewebpack-isomorphic-tools\x3c\/code\x3e插件来实现。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eNext.js\x3c\/h3\x3e\n\x3cp\x3e先插一嘴，现在有个叫\x3ca href=\x22https:\/\/github.com\/zeit\/next.js\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNext\x3c\/a\x3e框架，索性也试了下，真的很简便，快速搭建SSR项目，但是问题也很明显：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e框架高度封装，扩展性有限。\x3c\/li\x3e\n\x3cli\x3e适合从头搭建项目，不适合现有项目SSR迁移。\x3c\/li\x3e\n\x3cli\x3e上手很快，但是初学者不知道里面原理如何，适合熟练手玩。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e所以没有选用该框架进行尝试，不过该框架凭借着简单易上手，未来还是很有市场的。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3ewebpack-isomorphic-tools\x3c\/h3\x3e\n\x3cp\x3e上面第二个问题就提到了服务端如何处理静态资源，这里使用\x3ccode\x3ewebpack-isomorphic-tools\x3c\/code\x3e插件，该插件处理静态资源的。\x3c\/p\x3e\n\x3cp\x3e首先一个\x3ccode\x3ewebpack-isomorphic-tools-configuration.js\x3c\/code\x3e文件配置你想要处理的文件格式与处理方法，跟webpack配置loader类似：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const webpackIsomorphicToolsPlugin = require(\x27webpack-isomorphic-tools\/plugin\x27);\nconst config = require(\x27..\/config\/\x27);\n\nmodule.exports = {\n    webpack_assets_file_path: `${config.base_path}\/webpack-assets.json`,\n    webpack_stats_file_path: `${config.base_path}\/webpack-stats.json`,\n    assets: {\n        images: {\n            extensions: [\x27png\x27, \x27jpg\x27, \x27gif\x27, \x27ico\x27, \x27svg\x27]\n        },\n        fonts: {\n            extensions: [\x27woff\x27, \x27woff2\x27, \x27eot\x27, \x27ttf\x27, \x27swf\x27, \x27otf\x27]\n        },\n        \/\/ styles: {\n        \/\/     extensions: [\x27scss\x27, \x27css\x27],\n        \/\/     filter: function(module, regex, options, log) {\n        \/\/         if (options.development) {\n        \/\/             \/\/ in development mode there\x27s webpack \x26quot;style-loader\x26quot;,\n        \/\/             \/\/ so the module.name is not equal to module.name\n        \/\/             return webpackIsomorphicToolsPlugin.style_loader_filter(module, regex, options, log);\n        \/\/         } else {\n        \/\/             \/\/ in production mode there\x27s no webpack \x26quot;style-loader\x26quot;,\n        \/\/             \/\/ so the module.name will be equal to the asset path\n        \/\/             return regex.test(module.name);\n        \/\/         }\n        \/\/     },\n        \/\/     \/\/ How to correctly transform kinda weird `module.name`\n        \/\/     \/\/ of the `module` created by Webpack \x26quot;css-loader\x26quot;\n        \/\/     \/\/ into the correct asset path:\n        \/\/     path: webpackIsomorphicToolsPlugin.style_loader_path_extractor,\n        \/\/\n        \/\/     \/\/ How to extract these Webpack `module`s\x27 javascript `source` code.\n        \/\/     \/\/ Basically takes `module.source` and modifies its `module.exports` a little.\n        \/\/     parser: webpackIsomorphicToolsPlugin.css_loader_parser\n        \/\/ }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e webpackIsomorphicToolsPlugin = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack-isomorphic-tools\/plugin\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/config\/\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n    \x3cspan class=\x22hljs-attr\x22\x3ewebpack_assets_file_path\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${config.base_path}\x3c\/span\x3e\/webpack-assets.json`\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ewebpack_stats_file_path\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${config.base_path}\x3c\/span\x3e\/webpack-stats.json`\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eassets\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3eimages\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3eextensions\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x27png\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27jpg\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27gif\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27ico\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27svg\x27\x3c\/span\x3e]\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3efonts\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3eextensions\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x27woff\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27woff2\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27eot\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27ttf\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27swf\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27otf\x27\x3c\/span\x3e]\n        },\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ styles: {\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/     extensions: [\x27scss\x27, \x27css\x27],\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/     filter: function(module, regex, options, log) {\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/         if (options.development) {\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/             \/\/ in development mode there\x27s webpack \x22style-loader\x22,\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/             \/\/ so the module.name is not equal to module.name\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/             return webpackIsomorphicToolsPlugin.style_loader_filter(module, regex, options, log);\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/         } else {\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/             \/\/ in production mode there\x27s no webpack \x22style-loader\x22,\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/             \/\/ so the module.name will be equal to the asset path\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/             return regex.test(module.name);\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/         }\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/     },\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/     \/\/ How to correctly transform kinda weird `module.name`\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/     \/\/ of the `module` created by Webpack \x22css-loader\x22\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/     \/\/ into the correct asset path:\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/     path: webpackIsomorphicToolsPlugin.style_loader_path_extractor,\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/     \/\/ How to extract these Webpack `module`s\x27 javascript `source` code.\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/     \/\/ Basically takes `module.source` and modifies its `module.exports` a little.\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/     parser: webpackIsomorphicToolsPlugin.css_loader_parser\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ }\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该文件配置可以参考\x3ca href=\x22https:\/\/www.npmjs.com\/package\/webpack-isomorphic-tools\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e官方文档\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e然后在webpack中，配置对应的资源的时候，引入该文件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 同构处理静态资源的插件\nconst webpackIsomorphicToolsPlugin = require(\x27webpack-isomorphic-tools\/plugin\x27);\nconst webpackIsomorphicToolsPluginIns =\n    new webpackIsomorphicToolsPlugin(require(\x27.\/webpack-isomorphic-tools-configuration\x27)).development();\n...\nmodule: {\n  rules: [\n    ...\n    {\n                test: webpackIsomorphicToolsPluginIns.regular_expression(\x27images\x27),\n                loader: \x27url-loader?limit=8192\x27, \/\/ 这样在小于8K的图片将直接以base64的形式内联在代码中，可以减少一次http请求。\n                options: {\n                    name: \x27assets\/images\/[name]_[hash:8].[ext]\x27\n                }\n            },\n            {\n                test: webpackIsomorphicToolsPluginIns.regular_expression(\x27fonts\x27),\n                loader: \x27url-loader\x27,\n                options: {\n                    name: \x27assets\/fonts\/[name].[ext]\x27\n                }\n            }\n  ]\n}\nplugins: [\n  webpackIsomorphicToolsPluginIns,\n  ....\n]\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 同构处理静态资源的插件\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e webpackIsomorphicToolsPlugin = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack-isomorphic-tools\/plugin\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e webpackIsomorphicToolsPluginIns =\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpackIsomorphicToolsPlugin(\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/webpack-isomorphic-tools-configuration\x27\x3c\/span\x3e)).development();\n...\nmodule: {\n  \x3cspan class=\x22hljs-attr\x22\x3erules\x3c\/span\x3e: [\n    ...\n    {\n                \x3cspan class=\x22hljs-attr\x22\x3etest\x3c\/span\x3e: webpackIsomorphicToolsPluginIns.regular_expression(\x3cspan class=\x22hljs-string\x22\x3e\x27images\x27\x3c\/span\x3e),\n                \x3cspan class=\x22hljs-attr\x22\x3eloader\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27url-loader?limit=8192\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这样在小于8K的图片将直接以base64的形式内联在代码中，可以减少一次http请求。\x3c\/span\x3e\n                options: {\n                    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27assets\/images\/[name]_[hash:8].[ext]\x27\x3c\/span\x3e\n                }\n            },\n            {\n                \x3cspan class=\x22hljs-attr\x22\x3etest\x3c\/span\x3e: webpackIsomorphicToolsPluginIns.regular_expression(\x3cspan class=\x22hljs-string\x22\x3e\x27fonts\x27\x3c\/span\x3e),\n                \x3cspan class=\x22hljs-attr\x22\x3eloader\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27url-loader\x27\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3eoptions\x3c\/span\x3e: {\n                    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27assets\/fonts\/[name].[ext]\x27\x3c\/span\x3e\n                }\n            }\n  ]\n}\nplugins: [\n  webpackIsomorphicToolsPluginIns,\n  ....\n]\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后运行webpack，将文件打包之后，会生成一个\x3ccode\x3ewebpack-assets.json\x3c\/code\x3e文件，该文件就是存储静态资源的映射关系的json：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;javascript\x26quot;: {\n    \x26quot;app\x26quot;: \x26quot;\/assets\/js\/app_360a53bf78ee0e398bb2.js\x26quot;,\n    \x26quot;vendor\x26quot;: \x26quot;\/assets\/js\/vendor_360a53bf78ee0e398bb2.js\x26quot;\n  },\n  \x26quot;styles\x26quot;: {\n    \x26quot;app\x26quot;: \x26quot;\/assets\/css\/app_360a53bf78ee0e398bb2.css\x26quot;\n  },\n  \x26quot;assets\x26quot;: {\n    \x26quot;.\/public\/images\/react.svg\x26quot;: \x26quot;data....\x26quot;\n  },\n  \x26quot;webpack\x26quot;: {\n    \x26quot;version\x26quot;: \x26quot;2.7.0\x26quot;\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22javascript\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22app\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\/assets\/js\/app_360a53bf78ee0e398bb2.js\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22vendor\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\/assets\/js\/vendor_360a53bf78ee0e398bb2.js\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22styles\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22app\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\/assets\/css\/app_360a53bf78ee0e398bb2.css\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22assets\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22.\/public\/images\/react.svg\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22data....\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22webpack\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x222.7.0\x22\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样我们通过该json文件就可以获取到对应静态资源。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3eExpress服务\x3c\/h3\x3e\n\x3cp\x3e这里选用Express框架作为服务器，原因就是简单，很多人也选用koa，都一样。\x3c\/p\x3e\n\x3cp\x3e这里服务端启动部分跟正常的Express启动类似：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import render from \x26quot;.\/render\x26quot;;\nimport fetch from \x26quot;.\/fetch\x26quot;;\n\napp.use(\x27*\x27, (req, res, next) =\x3e {\n\n    const { promises, store } = fetch(req);\n\n    Promise.all(promises).then(data =\x3e {\n        const html = render(req, res, store);\n        res.send(html);\n    }).catch(err =\x3e{\n        console.log(\x27err\x27);\n        console.log(err);\n        res.end(\x27server error,please visit later\x27)\n    })\n\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e render \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22.\/render\x22\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e fetch \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22.\/fetch\x22\x3c\/span\x3e;\n\napp.use(\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e, (req, res, next) =\x26gt; {\n\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { promises, store } = fetch(req);\n\n    \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all(promises).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e html = render(req, res, store);\n        res.send(html);\n    }).catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27err\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(err);\n        res.end(\x3cspan class=\x22hljs-string\x22\x3e\x27server error,please visit later\x27\x3c\/span\x3e)\n    })\n\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e核心在于路由部分：这里匹配所有路由（也可以是首页路由），使用\x3ccode\x3efetch\x3c\/code\x3e方法获取到了\x3ccode\x3epromises\x3c\/code\x3e和\x3ccode\x3estore\x3c\/code\x3e，然后再用\x3ccode\x3erender\x3c\/code\x3e方法生成了html返回给客户端，这两个方法都是封装过的，\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e公用Action，Reducer\x3c\/h3\x3e\n\x3cp\x3e我们在SPA开发中，请求一般都封装成actionCreator，方便调用与修改，SSR中就共用了actionCreator和reducer。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3efetch\x3c\/code\x3e方法如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import \x27isomorphic-fetch\x27;\n\nimport { createStore } from \x26quot;redux\x26quot;;\nimport {actions} from \x27..\/src\/actions\/\x27;\n\nimport reducer from \x26quot;..\/src\/reducers\x26quot;;\n\nconst fetchHomeList = (store) =\x3e {\n    return fetch(\x27http:\/\/localhost:9000\/api\/aaa\x27)\n        .then((response)=\x3e{\n            console.log(\x27then response------\x27);\n            return response.json();\n        })\n        .then((res)=\x3e{\n            console.log(res.data.length);\n            store.dispatch(actions.updateHomeList(res.data));\n\n            return res;\n        })\n        .catch((res)=\x3e{\n            console.log(\x27catch res------\x27);\n            console.log(res);\n        });\n};\n\nexport default function (req) {\n    const store = createStore(reducer);\n\n    const promises = [\n        fetchHomeList(store)\n    ];\n\n    return {\n        promises,\n        store\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27isomorphic-fetch\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { createStore } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22redux\x22\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {actions} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/src\/actions\/\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e reducer \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22..\/src\/reducers\x22\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fetchHomeList = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/localhost:9000\/api\/aaa\x27\x3c\/span\x3e)\n        .then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27then response------\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e response.json();\n        })\n        .then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(res.data.length);\n            store.dispatch(actions.updateHomeList(res.data));\n\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res;\n        })\n        .catch(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27catch res------\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(res);\n        });\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ereq\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e store = createStore(reducer);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e promises = [\n        fetchHomeList(store)\n    ];\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        promises,\n        store\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在\x3ccode\x3efetch\x3c\/code\x3e文件中，我们将首页需要获取的数据通过\x3ccode\x3eisomorphic-fetch\x3c\/code\x3e来获取，然后跟SPA一样，\x3ccode\x3edispatch\x3c\/code\x3e到\x3ccode\x3estore\x3c\/code\x3e中，然后暴露出去。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3eRender页面\x3c\/h3\x3e\n\x3cp\x3eSSR返回的是首次渲染过后的html，首次渲染就是在\x3ccode\x3erender\x3c\/code\x3e方法中实现的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import fs from \x27fs\x27\nimport path from \x27path\x27\n\nimport React from \x27react\x27;\n\/\/ import ReactDOM from \x27react-dom\x27;\nimport { StaticRouter as Router } from \x26quot;react-router-dom\x26quot;\nimport { renderToString } from \x26quot;react-dom\/server\x26quot;\nimport { Provider } from \x26quot;react-redux\x26quot;\nimport Routes from \x27..\/src\/route\x27;\n\nfunction getAssets() {\n    return getAssets.assets || (() =\x3e {\n            getAssets.assets = JSON.parse(fs.readFileSync(path.join(__dirname, \x27..\/webpack-assets.json\x27)));\n            return getAssets.assets\n        })()\n}\n\nexport default function render(req, res, store) {\n    const context = {};\n\n    const html = renderToString(\n        \x3cProvider store={store}\x3e\n            \x3cRouter location={req.baseUrl} context={context}\x3e\n                \x3cRoutes \/\x3e\n            \x3c\/Router\x3e\n        \x3c\/Provider\x3e\n    );\n\n    \/\/ \x3cRoute\x3e中访问\/,重定向到\/home路由时\n    if (context.url) {\n        res.redirect(\x27\/home\x27);\n        return;\n    }\n\n    const main = getAssets();\n    const app = main.javascript.app;\n    const vendor = main.javascript.vendor;\n    const style = main.styles.app;\n\n    return `\n    \x3c!DOCTYPE html\x3e\n    \x3chtml lang=\x26quot;en\x26quot;\x3e\n    \x3chead\x3e\n        \x3cmeta charset=\x26quot;utf-8\x26quot;\x3e\n        \x3cmeta name=\x26quot;viewport\x26quot; content=\x26quot;width=device-width, initial-scale=1, shrink-to-fit=no\x26quot;\x3e\n        \x3clink href=${style} rel=\x26quot;stylesheet\x26quot;\x3e\x3c\/link\x3e\n        \x3ctitle\x3eSSR\x3c\/title\x3e\n    \x3c\/head\x3e\n    \x3cbody\x3e\n        \x3cdiv id=\x26quot;root\x26quot;\x3e\n            ${html}\n        \x3c\/div\x3e\n    \x3c\/body\x3e\n    \x3cscript\x3e\n        window.__INITIAL_STATE__ = ${JSON.stringify(store.getState())}\n    \x3c\/script\x3e\n    \x3cscript src=${vendor}\x3e\x3c\/script\x3e\n    \x3cscript src=${app}\x3e\x3c\/script\x3e\n    \x3c\/html\x3e\n    `\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e fs \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27fs\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e path \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27path\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ import ReactDOM from \x27react-dom\x27;\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { StaticRouter \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e Router } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22react-router-dom\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { renderToString } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22react-dom\/server\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { Provider } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22react-redux\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Routes \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/src\/route\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetAssets\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e getAssets.assets || \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e(\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n            getAssets.assets = \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.parse(fs.readFileSync(path.join(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27..\/webpack-assets.json\x27\x3c\/span\x3e)));\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e getAssets.assets\n        })()\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erender\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, store\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e context = {};\n\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e html = renderToString(\n        \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eProvider\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estore\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{store}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRouter\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elocation\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{req.baseUrl}\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtext\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{context}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n                \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRoutes\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eRouter\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eProvider\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    );\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt;Route\x26gt;中访问\/,重定向到\/home路由时\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (context.url) {\n        res.redirect(\x3cspan class=\x22hljs-string\x22\x3e\x27\/home\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e main = getAssets();\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e app = main.javascript.app;\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e vendor = main.javascript.vendor;\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e style = main.styles.app;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e`\n    \x26lt;!DOCTYPE html\x26gt;\n    \x26lt;html lang=\x22en\x22\x26gt;\n    \x26lt;head\x26gt;\n        \x26lt;meta charset=\x22utf-8\x22\x26gt;\n        \x26lt;meta name=\x22viewport\x22 content=\x22width=device-width, initial-scale=1, shrink-to-fit=no\x22\x26gt;\n        \x26lt;link href=\x3cspan class=\x22hljs-subst\x22\x3e${style}\x3c\/span\x3e rel=\x22stylesheet\x22\x26gt;\x26lt;\/link\x26gt;\n        \x26lt;title\x26gt;SSR\x26lt;\/title\x26gt;\n    \x26lt;\/head\x26gt;\n    \x26lt;body\x26gt;\n        \x26lt;div id=\x22root\x22\x26gt;\n            \x3cspan class=\x22hljs-subst\x22\x3e${html}\x3c\/span\x3e\n        \x26lt;\/div\x26gt;\n    \x26lt;\/body\x26gt;\n    \x26lt;script\x26gt;\n        window.__INITIAL_STATE__ = \x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(store.getState())}\x3c\/span\x3e\n    \x26lt;\/script\x26gt;\n    \x26lt;script src=\x3cspan class=\x22hljs-subst\x22\x3e${vendor}\x3c\/span\x3e\x26gt;\x26lt;\/script\x26gt;\n    \x26lt;script src=\x3cspan class=\x22hljs-subst\x22\x3e${app}\x3c\/span\x3e\x26gt;\x26lt;\/script\x26gt;\n    \x26lt;\/html\x26gt;\n    `\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里显而易见，我们准备一段html模板，跟SPA那个html模板类似，将\x3ccode\x3erenderToString\x3c\/code\x3e的片段塞进去，同时根据\x3ccode\x3ewebpack-assets.json\x3c\/code\x3e获取到打包好的js和css，塞进去；最后，将上面刚刚配置好的store注入进去。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e效果\x3c\/h2\x3e\n\x3cp\x3e我们制作一个接口，使用setTimeout 500ms模拟网络开销，效果如下：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV5UXn?w=840\x26amp;h=540\x22 src=\x22https:\/\/static.alili.tech\/img\/bV5UXn?w=840\x26amp;h=540\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e(gif上传不上去不知道为啥。。。)\x3c\/p\x3e\n\x3cp\x3e可以看到SSR要比SPA明显的更快速得到首屏效果。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e思考\x3c\/h2\x3e\n\x3cp\x3e项目完成的同时，也在思考一些问题：\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e1. 既然SSR首屏速度快，为何不所有路由全都SSR\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e所有页面SSR可以做，这样每个页面的首屏都会很快，同时js也会小很多。但是带来的问题服务器压力会很大，维护起来成本较高。而且服务端毕竟是模拟客户端环境渲染，一些地方还是不一样的比如没有Document，没有window对象，无法进行DOM操作等。所以推荐首页等重要页面进行SSR。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e2. 如果接口时间过长，是不是白屏时间较长\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e确实有这个问题，理论上讲，RPC要比客户端请求快很多，这样可以节省很多时间；但是如果接口很慢会造成白屏时间过长，得不偿失。所以接口很慢的页面不建议做SSR，同时接口也应该有严格的规范控制接口返回时间。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e3. 如果项目首页有很重的逻辑，或者Layout中有重逻辑该如何\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e页面如果有很重的逻辑比如判断很多不同条件，做出很多相应处理；依次请求很多接口，或者一起请求大量数据等情况，这些逻辑处理都需要一同写进SSR中。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e4. Node服务器带来的维护及并发压力等问题\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e使用Node服务器的话，还涉及到服务器的日常维护问题，日志收集，错误报警等问题，以及性能问题。要求前端（SA）有一定的Node服务器的维护经验，这时前端已经不是纯前端了。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e5. 什么项目适合SSR\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e这个问题才是关键的问题。并不是所有项目都适合SSR，就好像不是所有项目都适合Redux一样。根据SSR特点适合场景：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e项目要求SEO，SSR就很合适。\x3c\/li\x3e\n\x3cli\x3e需求项目某页面首屏时间要求很快，SSR可以减少白屏时间。\x3c\/li\x3e\n\x3cli\x3e一般是首页，列表页等大量数据页面使用比较常见。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e欢迎大家提出些不同意见用以讨论。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader14\x22\x3e参考\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/xiyuyizhi\/movies\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3exiyuyizhi\/movies\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/cnodejs.org\/topic\/5865a866189fd5ad6459006c\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e教你如何搭建一个超完美的React.js服务端渲染开发环境\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/web.jobbole.com\/93421\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact 同构与极致的性能优化\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/www.alloyteam.com\/2017\/01\/react-from-scratch-server-render\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e从零开始React服务端渲染\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/camsong\/blog\/issues\/8\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e精读前后端渲染之争\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e项目源码：\x3ca href=\x22https:\/\/github.com\/Aus0049\/react-redux-isomorphic-demo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/Aus0049\/re...\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React同构总结</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013609085">https://segmentfault.com/a/1190000013609085</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/w08f4x7fdkc/" target="_blank">https://alili.tech/archive/w08f4x7fdkc/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>