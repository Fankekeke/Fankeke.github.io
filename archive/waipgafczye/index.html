<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JavaScript闭包，只学这篇就够了"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JavaScript闭包，只学这篇就够了 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/waipgafczye/",
				"appid": "1613049289050283", 
				"title": "JavaScript闭包，只学这篇就够了 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-04T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/nmv5aqeu0qe/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/j2raafyvjp/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fwaipgafczye%2f&text=JavaScript%e9%97%ad%e5%8c%85%ef%bc%8c%e5%8f%aa%e5%ad%a6%e8%bf%99%e7%af%87%e5%b0%b1%e5%a4%9f%e4%ba%86"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fwaipgafczye%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fwaipgafczye%2f&text=JavaScript%e9%97%ad%e5%8c%85%ef%bc%8c%e5%8f%aa%e5%ad%a6%e8%bf%99%e7%af%87%e5%b0%b1%e5%a4%9f%e4%ba%86"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fwaipgafczye%2f&title=JavaScript%e9%97%ad%e5%8c%85%ef%bc%8c%e5%8f%aa%e5%ad%a6%e8%bf%99%e7%af%87%e5%b0%b1%e5%a4%9f%e4%ba%86"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fwaipgafczye%2f&is_video=false&description=JavaScript%e9%97%ad%e5%8c%85%ef%bc%8c%e5%8f%aa%e5%ad%a6%e8%bf%99%e7%af%87%e5%b0%b1%e5%a4%9f%e4%ba%86"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JavaScript%e9%97%ad%e5%8c%85%ef%bc%8c%e5%8f%aa%e5%ad%a6%e8%bf%99%e7%af%87%e5%b0%b1%e5%a4%9f%e4%ba%86&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fwaipgafczye%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fwaipgafczye%2f&title=JavaScript%e9%97%ad%e5%8c%85%ef%bc%8c%e5%8f%aa%e5%ad%a6%e8%bf%99%e7%af%87%e5%b0%b1%e5%a4%9f%e4%ba%86"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwaipgafczye%2f&title=JavaScript%e9%97%ad%e5%8c%85%ef%bc%8c%e5%8f%aa%e5%ad%a6%e8%bf%99%e7%af%87%e5%b0%b1%e5%a4%9f%e4%ba%86"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwaipgafczye%2f&title=JavaScript%e9%97%ad%e5%8c%85%ef%bc%8c%e5%8f%aa%e5%ad%a6%e8%bf%99%e7%af%87%e5%b0%b1%e5%a4%9f%e4%ba%86"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwaipgafczye%2f&title=JavaScript%e9%97%ad%e5%8c%85%ef%bc%8c%e5%8f%aa%e5%ad%a6%e8%bf%99%e7%af%87%e5%b0%b1%e5%a4%9f%e4%ba%86"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JavaScript闭包，只学这篇就够了</h1><div class="meta"><div class="postdate"><time datetime="2019-01-04" itemprop="datePublished">2019-01-04</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1\x3e闭包不是魔法\x3c\/h1\x3e\n\x3cp\x3e这篇文章使用一些简单的代码例子来解释JavaScript闭包的概念，即使新手也可以轻松参透闭包的含义。\x3c\/p\x3e\n\x3cp\x3e其实只要理解了核心概念，闭包并不是那么的难于理解。但是，网上充斥了太多学术性的文章，对于新手来说，看完这些文章可能会更加一头雾水。\x3c\/p\x3e\n\x3cp\x3e这篇文章面向的是使用主流开发语言的程序员，如果你能读懂下面这段代码，恭喜你，你可以开始JavaScript闭包的学习之旅了。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3efunction sayHello(name) {\n    var text = \x27Hello\x27 \x2b name;\n    var say = function() {\n        console.log(text);\n    }\n    say();\n}\nsayHello(\x27Joe\x27);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我相信你一定看懂了，那我们就开始吧！\x3cbr\x3e\x26lt;!-- more --\x26gt;\x3c\/p\x3e\n\x3ch1\x3e闭包的一个例子\x3c\/h1\x3e\n\x3cp\x3e举例之前，我们先用两句话概括一下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e闭包是支持\x3ccode\x3e一类函数\x3c\/code\x3e特性的一种方式（如果你还不知道什么是一类函数，请自行百度）；它是一个表达式，这个表达式可以在其作用域（当它被初次定义时）内引用变量，或者被赋值给一个变量，或者被当做一个变量传递给某个函数，甚至被当作一个函数的执行结果被返回出去。\x3c\/li\x3e\n\x3cli\x3e闭包也可以看作是某个函数被调用时分配的栈帧，而且当这个函数返回结果之后它也不会被回收（就好像它被分配给了堆，而不是栈）\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e下面的例子返回了对一个方法的引用：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3efunction sayHello2(name){\n    var text= \x27Hello\x27 \x2b name; \/\/局部变量\n    var say=function(){\n        console.log(text);\n    }\n    return say;\n}\nvar say2=sayHello2(\x27Bob\x27);\nsay2();\/\/logs=\x27Hello Bob\x27\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我想大多数JavaScript程序员都能理解上面代码中一个函数的引用是如何被赋值给一个变量(\x3ccode\x3esay2\x3c\/code\x3e)的。如果你不清楚的话，最好在继续了解闭包之前弄清楚。使用C语言的程序员或许会认为这个函数是指向另一个函数的指针，并且变量\x3ccode\x3esay\x3c\/code\x3e和\x3ccode\x3esay2\x3c\/code\x3e也同样是指向函数的指针。\x3c\/p\x3e\n\x3cp\x3e然而C语言中指向函数的指针和JavaScript中对一个函数的引用有很大的不同。在JavaScript中，你可以把引用函数的变量当作同时拥有两个指针：一个指向函数，另一个隐形地指向闭包。\x3c\/p\x3e\n\x3cp\x3e上面的代码中生成了一个闭包是因为匿名函数\x3ccode\x3efunction(){console.log(text);}\x3c\/code\x3e被定义在了另外一个函数\x3ccode\x3esayHello2()\x3c\/code\x3e中。在JavaScript中，如果你在一个函数中定义了另外一个函数，那么你就创建了一个闭包。\x3c\/p\x3e\n\x3cp\x3e在C语言或者其他流行的开发语言当中，函数返回之后，所有局部变量都不能再被访问，因为栈帧已经被销毁了。\x3c\/p\x3e\n\x3cp\x3e在JavaScript中，如果在一个函数中定义了另外一个函数，即使从被调用的函数中返回，局部变量依然能够被访问到。正如上面例子中我们在得到\x3ccode\x3esayHello2()\x3c\/code\x3e的返回值之后又调用了\x3ccode\x3esay2()\x3c\/code\x3e一样。需要注意到，我们调用的代码中引用了函数\x3ccode\x3esayHello2()\x3c\/code\x3e中的局部变量\x3ccode\x3etext\x3c\/code\x3e。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3efunction(){console.log(text);} \/\/say2.toString()的输出结果;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e观察\x3ccode\x3esay2.toString()\x3c\/code\x3e的输出结果，我们会发现代码指向变量\x3ccode\x3etext\x3c\/code\x3e。这个匿名函数能够引用值为\x3ccode\x3eHello Bob\x3c\/code\x3e的变量\x3ccode\x3etext\x3c\/code\x3e是因为\x3ccode\x3esayHello2()\x3c\/code\x3e的局部变量被保留在了闭包中。\x3c\/p\x3e\n\x3cp\x3e在JavaScript中神奇的地方在于引用一个函数的同时会有一个秘密的引用指向在这个函数内部创建的闭包，类似于委托一个方法指针加一个隐藏的对象引用。\x3c\/p\x3e\n\x3ch1\x3e更多例子\x3c\/h1\x3e\n\x3cp\x3e当你读到很多关于闭包的文章时，总会感觉一头雾水，但是当你看到一些应用的例子时，你就能清晰的理解闭包是如何工作的了。下面是我推荐的一些例子，希望大家能够认真研究直到真正清楚闭包是如何工作的。如果在你没有完全理解的情况下就开始使用闭包，你很快就会成为很多奇怪bug的创造者。\x3c\/p\x3e\n\x3cp\x3e下面这个例子展示了局部变量不是被复制，而是被保留在了引用当中。这是当外部函数存在的情况下将栈帧保存在内存中的方法之一。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3efunction say667(){\n\/\/处于闭包中的局部变量\nvar num=42;\nvar say=function(){console.log(num);}\nnum\x2b\x2b;\nreturn say;\n}\nvar sayNumber=say667();\nsayNumber();\/\/logs 43\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e下面例子中的三个全局函数有对同一个闭包的共同引用，因为他们都在\x3ccode\x3esetupSomeGlobals()\x3c\/code\x3e中被定义。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3evar gLogNumber, gIncreaseNumber, gSetNumber;\nfunction setupSomeGlobals() {\n  \/\/处于闭包中的局部变量\n  var num = 42;\n  \/\/ 用全局变量存储对函数的引用\n  gLogNumber = function() { console.log(num); }\n  gIncreaseNumber = function() { num\x2b\x2b; }\n  gSetNumber = function(x) { num = x; }\n}\nsetupSomeGlobals();\ngIncreaseNumber();\ngLogNumber(); \/\/ 43\ngSetNumber(5);\ngLogNumber(); \/\/ 5\n\nvar oldLog = gLogNumber;\n\nsetupSomeGlobals();\ngLogNumber(); \/\/ 42\n\noldLog() \/\/ 5    \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当这三个函数被创建时，它们能够共享对同一个闭包的访问-即对\x3ccode\x3esetupSomeGlobals()\x3c\/code\x3e中的局部变量的访问。\x3c\/p\x3e\n\x3cp\x3e需要注意到在上述例子中，如果你再次调用\x3ccode\x3esetupSomeGlobals()\x3c\/code\x3e，会创建一个新的闭包。\x3ccode\x3egLogNumber()\x3c\/code\x3e、\x3ccode\x3egSetNumber()\x3c\/code\x3e和\x3ccode\x3egLogNumber()\x3c\/code\x3e会被带有新闭包的函数重写（在JavaScript中，当在一个函数中定义另外一个函数时，重新调用外部函数会导致内部函数被重新创建）。\x3c\/p\x3e\n\x3cp\x3e下面这个例子对很多人来说都难以理解，所以你更需要真正理解它。在循环中定义函数时要格外小心：闭包中的局部变量或许不会和你的预想的一样。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3efunction buildList(list) {\n    var result = [];\n    for (var i = 0; i \x26lt; list.length; i\x2b\x2b) {\n        var item = \x27item\x27 \x2b i;\n        result.push( function() {console.log(item \x2b \x27 \x27 \x2b list[i])} );\n    }\n    return result;\n}\n\nfunction testList() {\n    var fnlist = buildList([1,2,3]);\n    for (var j = 0; j \x26lt; fnlist.length; j\x2b\x2b) {\n        fnlist[j]();\n    }\n}\n\n testList() \/\/logs \x22item2 undefined\x22 3次\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意到\x3ccode\x3eresult.push( function() {console.log(item \x2b \x27 \x27 \x2b list[i])}\x3c\/code\x3e向\x3ccode\x3eresult\x3c\/code\x3e数组中插入了三次对匿名函数的引用。如果你对匿名函数不太熟悉，可以想象成下面的代码：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22javascript\x22\x3epointer=function(){console.log(item\x2b\x27\x27\x2blist[i])};\nresult.push(pointer);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e需要注意到，当你运行上面的例子时，\x3ccode\x3eitem2 undefined\x3c\/code\x3e被打印了三次！这是因为像前一个例子中提到的，\x3ccode\x3ebuildList\x3c\/code\x3e的局部变量只有一个闭包。当在\x3ccode\x3efnlist[j]()\x3c\/code\x3e中调用匿名函数时，它们用的都是同一个闭包，而且在这个闭包中使用了\x3ccode\x3ei\x3c\/code\x3e和\x3ccode\x3eitem\x3c\/code\x3e的当前值（\x3ccode\x3ei\x3c\/code\x3e的值为3因为循环已经结束，\x3ccode\x3eitem\x3c\/code\x3e的值为\x3ccode\x3eitem2\x3c\/code\x3e）。因为我们从0开始计数所以\x3ccode\x3eitem\x3c\/code\x3e的值为\x3ccode\x3eitem2\x3c\/code\x3e，而\x3ccode\x3ei\x2b\x2b\x3c\/code\x3e会使\x3ccode\x3ei\x3c\/code\x3e的值变为\x3ccode\x3e3\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e下面这个例子展示了闭包在退出之前包含了外部函数中定义的任何局部变量。注意到变量\x3ccode\x3ealice\x3c\/code\x3e其实是在匿名函数之后定义的。匿名函数先定义，但是当它被调用时它能够访问\x3ccode\x3ealice\x3c\/code\x3e，因为\x3ccode\x3ealice\x3c\/code\x3e和匿名函数处于同一作用域（JavaScript会进行变量提升）。\x3ccode\x3esayAlice()()\x3c\/code\x3e只是直接调用了\x3ccode\x3esayAlice()\x3c\/code\x3e返回的函数引用-但结果却和之前一样，只不过没有临时变量而已。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22JavaScript\x22\x3efunction sayAlice() {\n    var say = function() { console.log(alice); }\n    var alice = \x27Hello Alice\x27;\n    return say;\n}\nsayAlice()();\/\/ logs \x22Hello Alice\x22\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意到变量\x3ccode\x3esay\x3c\/code\x3e也在闭包中，能够被任何在\x3ccode\x3esayAlice()\x3c\/code\x3e中定义的函数访问，或者在内部函数中被递归调用。\x3c\/p\x3e\n\x3cp\x3e最后一个例子展现了每次调用都为局部变量创建一个独立闭包。不是每个函数定义都会有一个闭包，而是每次函数调用产生一个闭包。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22JavaScript\x22\x3efunction newClosure(someNum, someRef) {\n    var num = someNum;\n    var anArray = [1,2,3];\n    var ref = someRef;\n    return function(x) {\n        num \x2b= x;\n        anArray.push(num);\n        console.log(\x27num: \x27 \x2b num \x2b\n            \x27; anArray: \x27 \x2b anArray.toString() \x2b\n            \x27; ref.someVar: \x27 \x2b ref.someVar \x2b \x27;\x27);\n      }\n}\nobj = {someVar: 4};\nfn1 = newClosure(4, obj);\nfn2 = newClosure(5, obj);\nfn1(1); \/\/ num: 5; anArray: 1,2,3,5; ref.someVar: 4;\nfn2(1); \/\/ num: 6; anArray: 1,2,3,6; ref.someVar: 4;\nobj.someVar\x2b\x2b;\nfn1(2); \/\/ num: 7; anArray: 1,2,3,5,7; ref.someVar: 5;\nfn2(2); \/\/ num: 8; anArray: 1,2,3,6,8; ref.someVar: 5;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1\x3e总结\x3c\/h1\x3e\n\x3cp\x3e如果你对于闭包的概念依然不清晰，那么最好的方式就是运行一下上面的例子，看看会发生什么。读懂一篇长篇大论要比理解一个例子难的多。我对与闭包和栈帧的解释在技术上并不完全正确-而是为了帮助理解而简化了。如果这些基本点都掌握之后，你就可以朝着更细微之处进发了。\x3c\/p\x3e\n\x3cp\x3e最后总结几点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e当你在一个函数中定义另外一个函数时，你就使用了闭包。\x3c\/li\x3e\n\x3cli\x3e当你在函数中使用\x3ccode\x3eeval()\x3c\/code\x3e时，你就使用了闭包。你在\x3ccode\x3eeval\x3c\/code\x3e中用到的文字可以指向外部函数的局部变量，而且在\x3ccode\x3eeval\x3c\/code\x3e中你也可以使用\x3ccode\x3eeval(\x27val foo=...\x27)\x3c\/code\x3e来创建局部变量。\x3c\/li\x3e\n\x3cli\x3e当你在函数中使用\x3ccode\x3enew Function(...)\x3c\/code\x3e时，\x3cstrong\x3e不会\x3c\/strong\x3e创建一个闭包（这个新的函数不能引用外部函数的局部变量）。\x3c\/li\x3e\n\x3cli\x3eJavaScript中的闭包就好像保存了一份局部变量的备份，他们保持在函数退出时的状态。\x3c\/li\x3e\n\x3cli\x3e最好将闭包当作是一个函数的入口创建的，而局部变量是被添加进这个闭包的。\x3c\/li\x3e\n\x3cli\x3e当一个带有闭包的函数被调用时，总会保存一组新的局部变量。\x3c\/li\x3e\n\x3cli\x3e两个看似代码相同的函数却有不同的行为，是因为\x3ccode\x3e隐藏的\x3c\/code\x3e闭包在作怪。我不认为JavaScript代码能够判断出一个函数引用是否有闭包。\x3c\/li\x3e\n\x3cli\x3e如果你尝试做任何动态代码的改动（例如：\x3ccode\x3emyFunction = Function(myFunction.toString().replace(\/Hello\/,\x27Hola\x27));\x3c\/code\x3e），如果\x3ccode\x3emyFunction\x3c\/code\x3e是个闭包，那就不会起作用（当然，你不会想在运行时里进行源代码的字符串替换，除非...）。\x3c\/li\x3e\n\x3cli\x3e在函数中定义多层函数是有可能的，这样你就可以得到多个级别的闭包。\x3c\/li\x3e\n\x3cli\x3e我认为在通常情况下，闭包是函数及被捕获的变量的术语，请注意在这篇文章里我没有用到闭包的定义。\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JavaScript闭包，只学这篇就够了</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010660305">https://segmentfault.com/a/1190000010660305</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/waipgafczye/" target="_blank">https://alili.tech/archive/waipgafczye/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>