<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="WebAssembly起步"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>WebAssembly起步 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/wfv8aj590gn/",
				"appid": "1613049289050283", 
				"title": "WebAssembly起步 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-18T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/otygbcd0mbc/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/4g7dqt8cj4b/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fwfv8aj590gn%2f&text=WebAssembly%e8%b5%b7%e6%ad%a5"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fwfv8aj590gn%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fwfv8aj590gn%2f&text=WebAssembly%e8%b5%b7%e6%ad%a5"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fwfv8aj590gn%2f&title=WebAssembly%e8%b5%b7%e6%ad%a5"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fwfv8aj590gn%2f&is_video=false&description=WebAssembly%e8%b5%b7%e6%ad%a5"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=WebAssembly%e8%b5%b7%e6%ad%a5&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fwfv8aj590gn%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fwfv8aj590gn%2f&title=WebAssembly%e8%b5%b7%e6%ad%a5"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwfv8aj590gn%2f&title=WebAssembly%e8%b5%b7%e6%ad%a5"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwfv8aj590gn%2f&title=WebAssembly%e8%b5%b7%e6%ad%a5"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwfv8aj590gn%2f&title=WebAssembly%e8%b5%b7%e6%ad%a5"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">WebAssembly起步</h1><div class="meta"><div class="postdate"><time datetime="2018-12-18" itemprop="datePublished">2018-12-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e了解WebAssembly原理\x3c\/h1\x3e\n\x3cp\x3eWebAssembly是一种可以在浏览器上运行的二进制可执行格式文件。它将成为浏览器进化史上又一次革命。\x3c\/p\x3e\n\x3cp\x3e自从浏览器问世以来，javascript就成为浏览器上执行程序的唯一标准，越来越多的应用程序通过javascript开发，并运行于浏览器上；而随着浏览器上h5程序功能的丰富，也对浏览器提出了更多的挑战。其中一条最为重要的就是性能问题。javascript是一种弱类型，解释性的脚本语言。它天生运行速度慢，成为了很多h5应用的软肋。虽然2008年google V8引入了即时编译等技术使js的运行速度提升了一大截，但是一些大型应用程序，比如游戏，视频编辑，压缩，算法等依然不适合运行在浏览器上。\x3c\/p\x3e\n\x3cp\x3eWebAssembly的到来解决了这个问题，并给开发基于浏览器的应用程序提供了另外的编程语言选择。2017年三大浏览器同时增加了WebAssembly支持，标志着WebAssembly已经达到生产实用标准。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e为什么WebAssembly比javascript快\x3c\/h2\x3e\n\x3cp\x3e回答这个问题需要洞悉浏览器执行javascript代码的各个环节。\x3cbr\x3e浏览器加载并执行javascript大概可分为如下几个环节： 下载，解析，执行和优化，垃圾回收。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e下载\x3c\/h3\x3e\n\x3cp\x3ejavascript是以纯文本格式下载的。相比，webassembly使用二进制格式存储，结构更精简，更小。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e解析\x3c\/h3\x3e\n\x3cp\x3ejavascript下载后，需要js引擎经过tokenize, parse两个阶段转换成AST(abstract syntax tree)，然后再转换为浏览器需要的中间字节码。由于js是比较高级的语言，解析js也相对要做更多的事情。webassembly的格式类似于汇编语言，本来就是中间字节码，和需要运行的机器码更相近，需要简单的转换工作即可转化为CPU可以直接执行的机器码。\x3c\/p\x3e\n\x3cp\x3e下图是一个真实运行的webassembly（它是文本的，只是为了方便调试），可以看出它和汇编是很相似的，更易转化为机器码。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV1REn?w=177\x26amp;h=393\x22 src=\x22https:\/\/static.alili.tech\/img\/bV1REn?w=177\x26amp;h=393\x22 alt=\x22WebAssembly源码\x22 title=\x22WebAssembly源码\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e执行和优化\x3c\/h3\x3e\n\x3cp\x3e在执行阶段，js普遍采用解释执行策略，相当于每一次执行javascript指令都要通过js引擎中转给cpu。现代的js引擎同时采用了即时编译的策略。这需要同时运行一个profiler，关注每个函数的调用情况。当profiler发现一个函数调用的比较多的时候，会把这个函数抛给编译器，为它生成一个更快的编译版本。某些情况下，参数类型会发生变化。这时，需要删除之前的编译版本，对新参数类型编译新的版本。而webassembly由于类汇编的结构，只需简单的编译即可转换为可直接运行在cpu上的机器码，执行更快。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e垃圾回收\x3c\/h3\x3e\n\x3cp\x3ejavascript运行期间需要同时间歇的运行一个垃圾回收器，扫描堆上的垃圾、释放内存。垃圾回收器的运行又和js引擎的执行是互斥的，导致js执行间歇性的被垃圾回收器打断。webassembly不负责垃圾回收，只能编程语言自行解决。于是不同的编程语言又有所不同。C\/C\x2b\x2b是手动管理内存(\x3ccode\x3emalloc\x3c\/code\x3e\/\x3ccode\x3efree\x3c\/code\x3e, \x3ccode\x3enew\x3c\/code\x3e\/\x3ccode\x3edelete\x3c\/code\x3e)，rust则是基于生命周期的自动内存管理。所有这些内存管理方法都不需要间歇的全局暂停。因此性能更好。\x3c\/p\x3e\n\x3cp\x3e从以上各个角度看WebAssembly确实比javascript性能高。事实上，目前阶段WebAssembly执行时间大概等于原生程序执行时间X1.2。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3eWebAssembly的加载与执行\x3c\/h2\x3e\n\x3cp\x3ewasm是WebAssembly格式的浏览器可执行文件。它是二进制的，但是它并不像桌面win32程序一样，可以随便使用系统资源，调用操作系统api。事实上，所有与外界相关的操作都必须由javascript传入。比如：要申请一段内存，必须由javascript申请了并传给他。 \x3cstrong\x3e浏览器上，javascript做不到的，它也做不到；javascript能做到的，它能做的更快。\x3c\/strong\x3e 这个就是它的价值。\x3c\/p\x3e\n\x3cp\x3e目前必须要js启动WebAssembly的加载和实例化（后面可能会有单独的加载机制）。\x3c\/p\x3e\n\x3cp\x3e如下函数，使用\x3ccode\x3efetch\x3c\/code\x3eAPI加载wasm文件，并实例化wasm模块。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function fetchAndInstantiate(url, importObject) {\n  return fetch(url).then(response =\x3e\n    response.arrayBuffer()\n  ).then(bytes =\x3e\n    WebAssembly.instantiate(bytes, importObject)\n  ).then(results =\x3e\n    results.instance\n  );\n}\n\nfetchAndInstantiate(\x27module.wasm\x27, importObject).then(function(instance) {\n  ...\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efetchAndInstantiate\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, importObject\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fetch(url).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n    response.arrayBuffer()\n  ).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ebytes\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n    WebAssembly.instantiate(bytes, importObject)\n  ).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresults\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n    results.instance\n  );\n}\n\nfetchAndInstantiate(\x3cspan class=\x22hljs-string\x22\x3e\x27module.wasm\x27\x3c\/span\x3e, importObject).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3einstance\x3c\/span\x3e) \x3c\/span\x3e{\n  ...\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eimportObject即浏览器需要向webassembly注入的交互api。\x3c\/p\x3e\n\x3cp\x3e如下，是一个真实运行的importObject包括很多js函数。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV1REm?w=989\x26amp;h=378\x22 src=\x22https:\/\/static.alili.tech\/img\/bV1REm?w=989\x26amp;h=378\x22 alt=\x22importObject示例\x22 title=\x22importObject示例\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e注意\x3ccode\x3eglobal.memory\x3c\/code\x3e就是webassembly程序执行用到的内存，是js申请的一个大的ArrayBuffer。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader7\x22\x3e学会WebAssembly开发\x3c\/h1\x3e\n\x3cp\x3e讲了这么多WebAssembly的优点，接下就讲下WebAssembly的开发。\x3c\/p\x3e\n\x3cp\x3e开发WebAssembly并不意味着需要手写WebAssembly汇编程序。一个开源项目\x3ca href=\x22http:\/\/kripken.github.io\/emscripten-site\/index.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eemscripten\x3c\/a\x3e已经提供了sdk可以编译C\/C\x2b\x2b，并输出WebAssembly的wasm文件。目前，rust也已经支持编译到wasm。未来所有支持编译到LLVM字节码的编程语言，理论上都可以输出wasm。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e安装emscripten\x3c\/h2\x3e\n\x3cp\x3e下载emscripten sdk后，是个压缩文件，其实是sdk包管理器。\x3cbr\x3e需要执行如下命令，完成sdk的安装。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\/emsdk update\n.\/emsdk install latest\n.\/emsdk activate latest\nsource .\/emsdk_env.sh\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sql\x22\x3e\x3ccode\x3e.\/emsdk \x3cspan class=\x22hljs-keyword\x22\x3eupdate\x3c\/span\x3e\n.\/emsdk \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e latest\n.\/emsdk \x3cspan class=\x22hljs-keyword\x22\x3eactivate\x3c\/span\x3e latest\n\x3cspan class=\x22hljs-keyword\x22\x3esource\x3c\/span\x3e .\/emsdk_env.sh\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在已经有个可用的emcc编译器了，输入：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22emcc --version\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3eemcc \x3cspan class=\x22hljs-comment\x22\x3e--version\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e查看编译器版本。\x3c\/p\x3e\n\x3cp\x3eemsdk安装后， emscripten文件内是按版本号安装的sdk内容,里面有很多C\/C\x2b\x2b用例，可以自行研究下。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e简单demo\x3c\/h2\x3e\n\x3cp\x3e这个简单的C程序可以直接编译为wasm。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22#include \x3cstdio.h\x3e\n\nint main() {\n  printf(\x26quot;hello, world!\\n\x26quot;);\n  return 0;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cpp\x22\x3e\x3ccode class=\x22C\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-meta-string\x22\x3e\x26lt;stdio.h\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emain\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3eprintf\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22hello, world!\\n\x22\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\/emcc hello_world.c\nnode a.out.js\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e.\/emcc hello_world\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e\nnode \x3cspan class=\x22hljs-selector-tag\x22\x3ea\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.out\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e默认情况下，emcc只输出了一个js（asmjs）。asmjs是webassembly的一个早期原型，可提供webassembly在旧版本浏览器上的兼容。按如下命令输出webassembly二进制wasm。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\/emcc hello_world.c -s WASM=1 -o index.html\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e.\/emcc hello_world\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e -s WASM=\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e -o index\x3cspan class=\x22hljs-selector-class\x22\x3e.html\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这次编译输出了\x3cem\x3eindex.html\x3c\/em\x3e, \x3cem\x3eindex.js\x3c\/em\x3e, \x3cem\x3eindex.wasm\x3c\/em\x3e三个文件。通过一个静态服务器打开index.html，可以看到console里的输出。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV1REk?w=674\x26amp;h=717\x22 src=\x22https:\/\/static.alili.tech\/img\/bV1REk?w=674\x26amp;h=717\x22 alt=\x22hello world示例\x22 title=\x22hello world示例\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这个index.html是一个调试页面。生产上加载webassembly一般都需要自己写index.html，只保留js和wasm文件就够了。\x3c\/p\x3e\n\x3cp\x3e以上的例子中，\x3ccode\x3eprintf\x3c\/code\x3e的标准输出被定向到了浏览器的console里面。 \x3cstrong\x3e系统API调用被换成了js实现。\x3c\/strong\x3e 事实上很多libc里面的函数被emscripten实现成了浏览器上的兼容方案，从而更好的和浏览器结合。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e环境\x3c\/h2\x3e\n\x3cp\x3e所有编程语言都要和它的运行环境打交道，否则除了把cpu跑满，没什么实用价值。跑在浏览器上的webassembly则是通过和js相互调用发挥它的作用。\x3c\/p\x3e\n\x3cp\x3eEmscripten sdk提供了很多API与js运行环境／浏览器交互。定义在其中两个头文件中：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3eemscripten.h\x3c\/code\x3e： 中定义了一些基础功能相关API，包括调用js，文件读写，网络请求等，这些API在node中也可以用。\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ehtml5.h\x3c\/code\x3e中定义了浏览器中与DOM相关的各种操作，包括DOM，事件，设备相关等。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e下面，抽出一些关键的API讲下webassembly是如何与浏览器协同工作的。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e调用js\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3eEM_ASM\x3c\/code\x3e宏，让webassembly可以直接调用js。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22EM_ASM(alert(\x27hai\x27); alert(\x27bai\x27));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode class=\x22C\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3eEM_ASM\x3c\/span\x3e(alert(\x3cspan class=\x22hljs-string\x22\x3e\x27hai\x27\x3c\/span\x3e); alert(\x3cspan class=\x22hljs-string\x22\x3e\x27bai\x27\x3c\/span\x3e));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果需要从js获取执行结果，可以用\x3ccode\x3eEM_ASM_INT\x3c\/code\x3e， \x3ccode\x3eEM_ASM_DOUBLE\x3c\/code\x3e两个版本分别获取\x3ccode\x3eint\x3c\/code\x3e和\x3ccode\x3edouble\x3c\/code\x3e类型的数值。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22int x = EM_ASM_INT({\n  return $0 \x2b 42;\n}, 100);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs autoit\x22\x3e\x3ccode class=\x22C\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3eint\x3c\/span\x3e x = EM_ASM_INT({\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $0 \x2b \x3cspan class=\x22hljs-number\x22\x3e42\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n}, \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果需要传递字符串给js，可以传递一个字符串起始的指针给js。由于js可以访问整个wasm程序的内存区域,js用这个指针就可以从内存读出字符串。Module对象上的\x3ccode\x3eUTF8ToString(ptr)\x3c\/code\x3e, \x3ccode\x3eUTF16ToString(ptr)\x3c\/code\x3e, \x3ccode\x3eUTF32ToString(ptr)\x3c\/code\x3e, \x3ccode\x3ePointer_stringify(ptr, length)\x3c\/code\x3e这几个函数可获得指针处的字符串。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22char* sample = \x26quot;This is a string\x26quot;;\n  EM_ASM_({\n      console.log(\x26quot;js got string:\x26quot;, Module.UTF8ToString($0));\n  }, sample);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode class=\x22C\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3echar\x3c\/span\x3e* \x3cspan class=\x22hljs-keyword\x22\x3esample\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x22This is a string\x22\x3c\/span\x3e;\n  EM_ASM_({\n      console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22js got string:\x22\x3c\/span\x3e, Module.UTF8ToString(\x3cspan class=\x22hljs-variable\x22\x3e$0\x3c\/span\x3e));\n  }, \x3cspan class=\x22hljs-keyword\x22\x3esample\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e标准输入输出\x3c\/h3\x3e\n\x3cp\x3e标准输出我们之前看过，printf最终被转到\x3ccode\x3eModule.print\x3c\/code\x3e，默认是\x3ccode\x3econsole.log\x3c\/code\x3e实现。\x3cbr\x3e标准错误输出最终会被转到\x3ccode\x3eModule.printErr\x3c\/code\x3e，默认是\x3ccode\x3econsole.error\x3c\/code\x3e实现。\x3cbr\x3e对标准输入的读取在浏览器上变成了一个prompt框。体验不好，尽量不要读。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e显示\x3c\/h3\x3e\n\x3cp\x3eEmscripten支持两种GUI展示方法。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eDOM： wasm是可以调用js的，而js又可以操作DOM。因此，wasm可以通过js操作DOM，创建程序的GUI。\x3c\/li\x3e\n\x3cli\x3eWebgl Canvas: 除了DOM，emscripten还可以提供了opengl es的浏览器实现。通过操作一个Webgl Canvas，把显示内容画在Canvas上。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e事件循环\x3c\/h3\x3e\n\x3cp\x3eC\x2b\x2b GUI程序一般都有个事件循环，其实就是个死循环，反复获取并处理GUI层面上的各种事件。这样程序不会跑完main函数直接退出。webassembly程序跑在浏览器上，而浏览器本来就是事件驱动，已经有了一个事件循环。假如不改动直接上浏览器，就会卡死浏览器的GUI进程。因此webassembly程序需要由浏览器控制事件循环。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eemscripten_set_main_loop(em_callback_func func, int fps, int simulate_infinite_loop)\x3c\/code\x3e函数接受一个函数的指针后，浏览器会根据fps按时调用传入的函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22#include \x3cstdio.h\x3e\n#include \x3cemscripten.h\x3e\n\nint frame = 0;\nvoid main_loop(void) {\n  printf(\x26quot;frame: %d\\n\x26quot;, frame);\n  frame\x2b\x2b;\n}\n\nint main(void) {\n  emscripten_set_main_loop(main_loop, 0, 1);\n  return 0;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cpp\x22\x3e\x3ccode class=\x22C\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-meta-string\x22\x3e\x26lt;stdio.h\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-meta-string\x22\x3e\x26lt;emscripten.h\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e frame = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emain_loop\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3eprintf\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22frame: %d\\n\x22\x3c\/span\x3e, frame);\n  frame\x2b\x2b;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emain\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e)\x3c\/span\x3e \x3c\/span\x3e{\n  emscripten_set_main_loop(main_loop, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e存储\x3c\/h3\x3e\n\x3cp\x3e浏览器隔离了程序直接操作存储的权限，因而webapp是安全的，但很多C代码都有同步操作文件的API，如\x3ccode\x3eopen\x3c\/code\x3e, \x3ccode\x3ewrite\x3c\/code\x3e, \x3ccode\x3eclose\x3c\/code\x3e。为了兼容，emscripten实现了一个内存文件系统，可以通过全局对象\x3ccode\x3eFS\x3c\/code\x3e访问。\x3c\/p\x3e\n\x3cp\x3e下图，是FS对象下的函数。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV1REj?w=592\x26amp;h=828\x22 src=\x22https:\/\/static.alili.tech\/img\/bV1REj?w=592\x26amp;h=828\x22 alt=\x22FS的函数\x22 title=\x22FS的函数\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e另外，emcc还提供了\x3ccode\x3e--preload-file\x3c\/code\x3e参数，在webassembly程序加载的过程中，预加载文件放到虚拟文件系统中。\x3c\/p\x3e\n\x3cp\x3ewasm中的文件虽然是内存的，但是支持通过indexDB持久化。\x3cbr\x3e如下js，\x3ccode\x3emount\x3c\/code\x3e一个indexdb的文件夹到\/data目录，然后\x3ccode\x3eFS.syncfs\x3c\/code\x3e把indexdb中的文件同步到内存。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22FS.mkdir(\x27\/data\x27);\nFS.mount(IDBFS, {}, \x27\/data\x27);\nFS.syncfs(true, function (err) {\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eFS.mkdir(\x3cspan class=\x22hljs-string\x22\x3e\x27\/data\x27\x3c\/span\x3e);\nFS.mount(IDBFS, {}, \x3cspan class=\x22hljs-string\x22\x3e\x27\/data\x27\x3c\/span\x3e);\nFS.syncfs(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来，所有，\/data目录下的读写，都在内存中的同步读写。当程序关闭的时候，需要调用\x3ccode\x3eFS.syncfs（false, function(err){}）\x3c\/code\x3e把内存中的文件反方向同步回indexdb。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3e库\x3c\/h3\x3e\n\x3cp\x3eemsdk提供了一些常用的C\x2b\x2b库的webassembly兼容版本。用\x3ccode\x3eemcc --show-ports\x3c\/code\x3e命令显示。如果要用SDL2，需要给emcc加入选项\x3ccode\x3e-s USE_SDL=2\x3c\/code\x3e，链接SDL2库。\x3c\/p\x3e\n\x3cp\x3e目前，emcc内置支持这些库。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ emcc --show-ports\nAvailable ports:\n    zlib (USE_ZLIB=1; zlib license)\n    libpng (USE_LIBPNG=1; zlib license)\n    SDL2 (USE_SDL=2; zlib license)\n    SDL2_image (USE_SDL_IMAGE=2; zlib license)\n    ogg (USE_OGG=1; zlib license)\n    vorbis (USE_VORBIS=1; zlib license)\n    bullet (USE_BULLET=1; zlib license)\n    freetype (USE_FREETYPE=1; freetype license)\n    SDL2_ttf (USE_SDL_TTF=2; zlib license)\n    SDL2_net (zlib license)\n    Binaryen (Apache 2.0 license)\n    cocos2d\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs elm\x22\x3e\x3ccode\x3e$ emcc \x3cspan class=\x22hljs-comment\x22\x3e--show-ports\x3c\/span\x3e\n\x3cspan class=\x22hljs-type\x22\x3eAvailable\x3c\/span\x3e ports:\n    zlib (\x3cspan class=\x22hljs-type\x22\x3eUSE_ZLIB\x3c\/span\x3e=1; zlib license)\n    libpng (\x3cspan class=\x22hljs-type\x22\x3eUSE_LIBPNG\x3c\/span\x3e=1; zlib license)\n    SDL2 (\x3cspan class=\x22hljs-type\x22\x3eUSE_SDL\x3c\/span\x3e=2; zlib license)\n    SDL2_image (\x3cspan class=\x22hljs-type\x22\x3eUSE_SDL_IMAGE\x3c\/span\x3e=2; zlib license)\n    ogg (\x3cspan class=\x22hljs-type\x22\x3eUSE_OGG\x3c\/span\x3e=1; zlib license)\n    vorbis (\x3cspan class=\x22hljs-type\x22\x3eUSE_VORBIS\x3c\/span\x3e=1; zlib license)\n    bullet (\x3cspan class=\x22hljs-type\x22\x3eUSE_BULLET\x3c\/span\x3e=1; zlib license)\n    freetype (\x3cspan class=\x22hljs-type\x22\x3eUSE_FREETYPE\x3c\/span\x3e=1; freetype license)\n    SDL2_ttf (\x3cspan class=\x22hljs-type\x22\x3eUSE_SDL_TTF\x3c\/span\x3e=2; zlib license)\n    SDL2_net (zlib license)\n    Binaryen (\x3cspan class=\x22hljs-type\x22\x3eApache\x3c\/span\x3e 2.0 license)\n    cocos2d\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果所需要的库没在列表里，需要先用emsdk编译所需要的库（可能涉及到库的改动）。再编译并链接，输出最终目标。emcc不支持动态链接。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader17\x22\x3e展望\x3c\/h1\x3e\n\x3cp\x3e目前,webassembly已经完成MVP最小功能版本开发，有非常注目的性能。可以遇见，未来将有更多h5 app\/游戏通过webassembly获得更好的体验。使用C\/C\x2b\x2b\/rust进行webapp开发,混合编程，也会有很多不错的探索。\x3c\/p\x3e\n\x3cp\x3e未来h5能否通过webassembly撼动原生的大门，让我们拭目以待。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>WebAssembly起步</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012798495">https://segmentfault.com/a/1190000012798495</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/wfv8aj590gn/" target="_blank">https://alili.tech/archive/wfv8aj590gn/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>