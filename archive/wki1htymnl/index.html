<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="【mongoDB查询进阶】聚合管道(二) -- 阶段操作符"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>【mongoDB查询进阶】聚合管道(二) -- 阶段操作符 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/wki1htymnl/",
				"appid": "1613049289050283", 
				"title": "【mongoDB查询进阶】聚合管道(二) -- 阶段操作符 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-03T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/btchnsqfmua/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/b0gvhpsem1c/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fwki1htymnl%2f&text=%e3%80%90mongoDB%e6%9f%a5%e8%af%a2%e8%bf%9b%e9%98%b6%e3%80%91%e8%81%9a%e5%90%88%e7%ae%a1%e9%81%93%28%e4%ba%8c%29%20--%20%e9%98%b6%e6%ae%b5%e6%93%8d%e4%bd%9c%e7%ac%a6"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fwki1htymnl%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fwki1htymnl%2f&text=%e3%80%90mongoDB%e6%9f%a5%e8%af%a2%e8%bf%9b%e9%98%b6%e3%80%91%e8%81%9a%e5%90%88%e7%ae%a1%e9%81%93%28%e4%ba%8c%29%20--%20%e9%98%b6%e6%ae%b5%e6%93%8d%e4%bd%9c%e7%ac%a6"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fwki1htymnl%2f&title=%e3%80%90mongoDB%e6%9f%a5%e8%af%a2%e8%bf%9b%e9%98%b6%e3%80%91%e8%81%9a%e5%90%88%e7%ae%a1%e9%81%93%28%e4%ba%8c%29%20--%20%e9%98%b6%e6%ae%b5%e6%93%8d%e4%bd%9c%e7%ac%a6"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fwki1htymnl%2f&is_video=false&description=%e3%80%90mongoDB%e6%9f%a5%e8%af%a2%e8%bf%9b%e9%98%b6%e3%80%91%e8%81%9a%e5%90%88%e7%ae%a1%e9%81%93%28%e4%ba%8c%29%20--%20%e9%98%b6%e6%ae%b5%e6%93%8d%e4%bd%9c%e7%ac%a6"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e3%80%90mongoDB%e6%9f%a5%e8%af%a2%e8%bf%9b%e9%98%b6%e3%80%91%e8%81%9a%e5%90%88%e7%ae%a1%e9%81%93%28%e4%ba%8c%29%20--%20%e9%98%b6%e6%ae%b5%e6%93%8d%e4%bd%9c%e7%ac%a6&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fwki1htymnl%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fwki1htymnl%2f&title=%e3%80%90mongoDB%e6%9f%a5%e8%af%a2%e8%bf%9b%e9%98%b6%e3%80%91%e8%81%9a%e5%90%88%e7%ae%a1%e9%81%93%28%e4%ba%8c%29%20--%20%e9%98%b6%e6%ae%b5%e6%93%8d%e4%bd%9c%e7%ac%a6"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwki1htymnl%2f&title=%e3%80%90mongoDB%e6%9f%a5%e8%af%a2%e8%bf%9b%e9%98%b6%e3%80%91%e8%81%9a%e5%90%88%e7%ae%a1%e9%81%93%28%e4%ba%8c%29%20--%20%e9%98%b6%e6%ae%b5%e6%93%8d%e4%bd%9c%e7%ac%a6"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwki1htymnl%2f&title=%e3%80%90mongoDB%e6%9f%a5%e8%af%a2%e8%bf%9b%e9%98%b6%e3%80%91%e8%81%9a%e5%90%88%e7%ae%a1%e9%81%93%28%e4%ba%8c%29%20--%20%e9%98%b6%e6%ae%b5%e6%93%8d%e4%bd%9c%e7%ac%a6"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwki1htymnl%2f&title=%e3%80%90mongoDB%e6%9f%a5%e8%af%a2%e8%bf%9b%e9%98%b6%e3%80%91%e8%81%9a%e5%90%88%e7%ae%a1%e9%81%93%28%e4%ba%8c%29%20--%20%e9%98%b6%e6%ae%b5%e6%93%8d%e4%bd%9c%e7%ac%a6"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">【mongoDB查询进阶】聚合管道(二) -- 阶段操作符</h1><div class="meta"><div class="postdate"><time datetime="2019-01-03" itemprop="datePublished">2019-01-03</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e上篇最后说到管道操作符，本篇文章将详细说一下管道操作符。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000010618355\x22\x3emongoDB查询进阶--聚合管道(一)回顾\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3e什么是管道操作符(Aggregation Pipeline Operators)\x3c\/h1\x3e\n\x3cp\x3emongoDB有4类操作符用于文档的操作，例如find查询里面会用到的$gte，$in等。操作符以$开头，分为查询操作符，更新操作符，管道操作符，查询修饰符4大类。其中管道操作符是用于聚合管道中的操作符。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e管道操作符的分类\x3c\/h1\x3e\n\x3cp\x3e管道操作符可以分为三类：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e阶段操作符（Stage Operators）\x3c\/li\x3e\n\x3cli\x3e表达式操作符（Expression Operators）\x3c\/li\x3e\n\x3cli\x3e累加器（Accumulators）\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3e\x3cp\x3e此处中文勉强翻译，以英文为准，欢迎大神给意见，谢谢。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/docs.mongodb.com\/manual\/reference\/operator\/aggregation\/#accumulators\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e参考MongoDB官网:https:\/\/docs.mongodb.com\/manual\/reference\/operator\/aggregation\/#accumulators\x3c\/a\x3e\x3c\/p\x3e\n\x3ch5\x3e阶段操作符（Stage Operators）\x3c\/h5\x3e\n\x3cp\x3e阶段操作符是使用于db.collection.aggregate方法里面，数组参数中的第一层。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.collection.aggregate( [ { 阶段操作符：表述 }, { 阶段操作符：表述 }, ... ] )\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.collection\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e( \x3cspan class=\x22hljs-selector-attr\x22\x3e[ { 阶段操作符：表述 }, { 阶段操作符：表述 }, ... ]\x3c\/span\x3e )\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e表达式操作符（Expression Operators）\x3c\/h5\x3e\n\x3cp\x3e表达式操作符主要用于在管道中构建表达式时使用，使用类似于函数那样需要参数，主要用于$project操作符中，用于构建表达式，使用方法一般如下：\x3c\/p\x3e\n\x3cp\x3e方法1：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ \x3coperator\x3e: [ \x3cargument1\x3e, \x3cargument2\x3e ... ] }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e{ \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eoperator\x3c\/span\x3e\x26gt;\x3c\/span\x3e: [ \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eargument1\x3c\/span\x3e\x26gt;\x3c\/span\x3e, \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eargument2\x3c\/span\x3e\x26gt;\x3c\/span\x3e ... ] }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e方法2：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ \x3coperator\x3e: \x3cargument\x3e }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eoperator\x3c\/span\x3e\x26gt;\x3c\/span\x3e: \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eargument\x3c\/span\x3e\x26gt;\x3c\/span\x3e }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e累加器（Accumulators）\x3c\/h5\x3e\n\x3cp\x3e累加器本来只能使用与$groud下，但是版本3.2或以上，部分累加器还能使用于$project。当在$group中使用时，累加器是针对每个分组使用的；当在$project中使用时，累加器则是针对每个字面量起作用，具体用法下一篇文章阐述。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e由于操作符比较多，本篇文章先说第一类阶段操作符，后面两类在下一篇再说。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3e常用阶段操作符\x3c\/h1\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth align=\x22left\x22\x3e操作符\x3c\/th\x3e\n\x3cth align=\x22left\x22\x3e简述\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e$match\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e匹配操作符，用于对文档集合进行筛选\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e$project\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e投射操作符，用于重构每一个文档的字段，可以提取字段，重命名字段，甚至可以对原有字段进行操作后新增字段\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e$sort\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e排序操作符，用于根据一个或多个字段对文档进行排序\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e$limit\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e限制操作符，用于限制返回文档的数量\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e$skip\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e跳过操作符，用于跳过指定数量的文档\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e$count\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e统计操作符，用于统计文档的数量\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e$group\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e分组操作符，用于对文档集合进行分组\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e$unwind\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e拆分操作符，用于将数组中的每一个值拆分为单独的文档\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e$lookup\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e连接操作符，用于连接同一个数据库中另一个集合，并获取指定的文档，类似于populate\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/docs.mongodb.com\/manual\/reference\/operator\/aggregation\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e更多操作符介绍详见官网：https:\/\/docs.mongodb.com\/manual\/reference\/operator\/aggregation\/\x3c\/a\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3e阶段操作符详解\x3c\/h1\x3e\n\x3cp\x3e假设有一个保存用户的集合Users，一个文章的集合Articles，数据大致如下：\x3cbr\x3eusers:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n    { name: \x27John\x27, age: 16, sex: male, city: guangzhou, _id: 1, ...},\n    { name: \x27Rose\x27, age: 18, sex: female, city: beijing, _id: 2, ...},\n    { name: \x27Jack\x27, age: 29, sex: male, city: guangzhou, _id: 3, ...},\n    { name: \x27Allen\x27, age: 18, sex: female, city: beijing, _id: 4, ...},\n    { name: \x27Cruz\x27, age: 22, sex: male, city: guangzhou, _id: 5, ...},\n    { name: \x27Peter\x27, age: 18, sex: male, city: guangzhou, _id: 6, ...},\n    { name: \x27Kelly\x27, age: 23, sex: female, city: shanghai, _id: 7, ...},\n    ...\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e[\n    { \x3cspan class=\x22hljs-string\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eage:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3esex:\x3c\/span\x3e male, \x3cspan class=\x22hljs-string\x22\x3ecity:\x3c\/span\x3e guangzhou, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, ...},\n    { \x3cspan class=\x22hljs-string\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Rose\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eage:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3esex:\x3c\/span\x3e female, \x3cspan class=\x22hljs-string\x22\x3ecity:\x3c\/span\x3e beijing, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, ...},\n    { \x3cspan class=\x22hljs-string\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Jack\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eage:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e29\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3esex:\x3c\/span\x3e male, \x3cspan class=\x22hljs-string\x22\x3ecity:\x3c\/span\x3e guangzhou, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, ...},\n    { \x3cspan class=\x22hljs-string\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Allen\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eage:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3esex:\x3c\/span\x3e female, \x3cspan class=\x22hljs-string\x22\x3ecity:\x3c\/span\x3e beijing, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e, ...},\n    { \x3cspan class=\x22hljs-string\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Cruz\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eage:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3esex:\x3c\/span\x3e male, \x3cspan class=\x22hljs-string\x22\x3ecity:\x3c\/span\x3e guangzhou, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e, ...},\n    { \x3cspan class=\x22hljs-string\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Peter\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eage:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3esex:\x3c\/span\x3e male, \x3cspan class=\x22hljs-string\x22\x3ecity:\x3c\/span\x3e guangzhou, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e, ...},\n    { \x3cspan class=\x22hljs-string\x22\x3ename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Kelly\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eage:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e23\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3esex:\x3c\/span\x3e female, \x3cspan class=\x22hljs-string\x22\x3ecity:\x3c\/span\x3e shanghai, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e, ...},\n    ...\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3earticles:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, ... },\n    { title: \x27this is article B\x27, author: \x27Jack\x27, _id: 2, ... },\n    { title: \x27this is article C\x27, author: \x27Rose\x27, _id: 3, ... },\n    { title: \x27this is article D\x27, author: \x27John\x27, _id: 4, ... },\n    { title: \x27this is article E\x27, author: \x27John\x27, _id: 5, ... },\n    ...\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e[\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article A\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, ... },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article B\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Jack\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, ... },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article C\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Rose\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, ... },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article D\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e, ... },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article E\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e, ... },\n    ...\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e$match 匹配操作符\x3c\/h2\x3e\n\x3ch5\x3e说明：\x3c\/h5\x3e\n\x3cblockquote\x3e\x3cp\x3e用于重构每一个文档的字段，可以提取字段，重命名字段，甚至可以对原有字段进行操作后新增字段\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e用法:\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ $match: { \x3cquery\x3e } }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xquery\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ $match: { \x26lt;query\x26gt; } }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e示例：\x3c\/h5\x3e\n\x3cul\x3e\x3cli\x3e查询用户年龄是18岁的用户\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.users.aggregate([{ $match : { age : \x26quot;18\x26quot; } }]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.users\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e([{ $\x3cspan class=\x22hljs-attribute\x22\x3ematch \x3c\/span\x3e: { \x3cspan class=\x22hljs-attribute\x22\x3eage \x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x2218\x22\x3c\/span\x3e } }]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e$project 投射操作符\x3c\/h2\x3e\n\x3ch5\x3e说明：\x3c\/h5\x3e\n\x3cblockquote\x3e\x3cp\x3e用于对文档集合进行筛选\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e用法:\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ $project: { \x3cspecification(s)\x3e } }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clojure\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ $project: { \x26lt;specification(\x3cspan class=\x22hljs-name\x22\x3es\x3c\/span\x3e)\x26gt; } }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3especification的规则\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth align=\x22left\x22\x3e规则\x3c\/th\x3e\n\x3cth align=\x22left\x22\x3e描述\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e\x26lt;字段名\x26gt;: 1 or true\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e选择需要返回什么字段\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e_id: 0 or false\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e不返回_id(默认返回)\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e\x26lt;字段名\x26gt;: 表达式\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e使用表达式，可以用于重命名字段，或对其值进行操作，或新增字段\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3e\x26lt;字段名\x26gt;: 0 or false\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e选择需要不返回什么字段，注意：当使用这种用法时，就不要用上面的方法\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3ch5\x3e示例1：\x3c\/h5\x3e\n\x3cul\x3e\n\x3cli\x3e用户集合投射用户姓名\x3c\/li\x3e\n\x3cli\x3e不返回_id\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.users.aggregate([{ $project : { name: 1 } }]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.users\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e([{ $\x3cspan class=\x22hljs-attribute\x22\x3eproject \x3c\/span\x3e: { \x3cspan class=\x22hljs-attribute\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e } }]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e示例2：\x3c\/h5\x3e\n\x3cul\x3e\n\x3cli\x3e将_id重命名为userId\x3c\/li\x3e\n\x3cli\x3e不返回_id_\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.users.aggregate([{ $project : { ueserId: \x27$_id\x27, _id: 0 } }]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.users\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e([{ $\x3cspan class=\x22hljs-attribute\x22\x3eproject \x3c\/span\x3e: { \x3cspan class=\x22hljs-attribute\x22\x3eueserId\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27$_id\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attribute\x22\x3e_id\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e } }]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e示例3：\x3c\/h5\x3e\n\x3cul\x3e\x3cli\x3e返回新字段username,并使用表达式让它的值为name的大写。\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.users.aggregate([ \n    { \n        $project : {\n            name: 1, \n            username: { $toUpper: \x27$name\x27 }, \n            _id: 0 \n        } \n    } \n]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xquery\x22\x3e\x3ccode\x3edb.users.aggregate([ \n    { \n        $project : {\n            name: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \n            username: { $toUpper: \x3cspan class=\x22hljs-string\x22\x3e\x27$name\x27\x3c\/span\x3e }, \n            _id: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \n        } \n    } \n]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e关于管道表达式：最简单的“$project”表达式是包含和排除字段(如: { name: 1 })，以及字段名称$fieldname(如: { userId: \x27$_id\x27 })。除此以外，还可以使用表达式操作符(如: $toUpper)构成更丰富的表达式，将多个字面量和变量组合在一起使用，得到更多有意思的值，更多表达式操作符的说明及使用在另外的篇章中详细阐述。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e$sort   排序操作符\x3c\/h2\x3e\n\x3ch5\x3e说明：\x3c\/h5\x3e\n\x3cblockquote\x3e\x3cp\x3e用于根据一个或多个字段对文档进行排序\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e用法：\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ $sort: { \x3cfield1\x3e: \x3csort order\x3e, \x3cfield2\x3e: \x3csort order\x3e ... } }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs vim\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ $\x3cspan class=\x22hljs-keyword\x22\x3esor\x3c\/span\x3e\x3cspan class=\x22hljs-variable\x22\x3et:\x3c\/span\x3e { \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;field1\x26gt;\x3c\/span\x3e: \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3esort\x3c\/span\x3e order\x26gt;, \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;field2\x26gt;\x3c\/span\x3e: \x26lt;\x3cspan class=\x22hljs-keyword\x22\x3esort\x3c\/span\x3e order\x26gt; ... } }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e示例：\x3c\/h5\x3e\n\x3cul\x3e\x3cli\x3eusers集合按照年龄age从低到高排序\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.users.aggregate([{ $sort : { age: 1 } }]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.users\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e([{ $\x3cspan class=\x22hljs-attribute\x22\x3esort \x3c\/span\x3e: { \x3cspan class=\x22hljs-attribute\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e } }]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e$limit  限制操作符\x3c\/h2\x3e\n\x3ch5\x3e说明：\x3c\/h5\x3e\n\x3cblockquote\x3e\x3cp\x3e用于限制返回文档的数量\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e用法：\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ $limit: \x3cpositive integer\x3e }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs bash\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ \x3cspan class=\x22hljs-variable\x22\x3e$limit\x3c\/span\x3e: \x26lt;positive \x3cspan class=\x22hljs-built_in\x22\x3einteger\x3c\/span\x3e\x26gt; }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e示例：\x3c\/h5\x3e\n\x3cul\x3e\x3cli\x3e返回5篇article\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.articles.aggregate({ $limit : 3 });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scss\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3edb\x3cspan class=\x22hljs-selector-class\x22\x3e.articles\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e({ \x3cspan class=\x22hljs-variable\x22\x3e$limit\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e });\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e$skip   跳过操作符\x3c\/h2\x3e\n\x3ch5\x3e说明：\x3c\/h5\x3e\n\x3cblockquote\x3e\x3cp\x3e用于跳过指定数量的文档\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e用法：\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ $skip: \x3cpositive integer\x3e }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs bash\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ \x3cspan class=\x22hljs-variable\x22\x3e$skip\x3c\/span\x3e: \x26lt;positive \x3cspan class=\x22hljs-built_in\x22\x3einteger\x3c\/span\x3e\x26gt; }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e示例：\x3c\/h5\x3e\n\x3cul\x3e\x3cli\x3e跳过1个文档\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.users.aggregate([{ $skip : 1 }]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.users\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e(\x3cspan class=\x22hljs-selector-attr\x22\x3e[{ $skip : 1 }]\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e$count  统计操作符\x3c\/h2\x3e\n\x3ch5\x3e说明：\x3c\/h5\x3e\n\x3cblockquote\x3e\x3cp\x3e用于统计文档的数量\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e用法：\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ $count: \x3cstring\x3e }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs applescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ $\x3cspan class=\x22hljs-built_in\x22\x3ecount\x3c\/span\x3e: \x26lt;\x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e\x26gt; }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3estring是统计之后输出统计结果的字段名\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e示例：\x3c\/h5\x3e\n\x3cul\x3e\x3cli\x3e统计文章的总数，以totalArticle返回\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.articles.aggregate([{ totalArticle : 1 }]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.articles\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e(\x3cspan class=\x22hljs-selector-attr\x22\x3e[{ totalArticle : 1 }]\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e$group  分组操作符\x3c\/h2\x3e\n\x3ch5\x3e说明：\x3c\/h5\x3e\n\x3cblockquote\x3e\x3cp\x3e用于对文档集合进行分组\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e用法：\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ $group: { _id: \x3cexpression\x3e, \x3cfield1\x3e: { \x3caccumulator1\x3e : \x3cexpression1\x3e }, ... } }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ \x3cspan class=\x22hljs-variable\x22\x3e$group\x3c\/span\x3e: { _id: \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;expression\x26gt;\x3c\/span\x3e, \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;field1\x26gt;\x3c\/span\x3e: { \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;accumulator1\x26gt;\x3c\/span\x3e : \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;expression1\x26gt;\x3c\/span\x3e }, ... } }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e_id是必须的，用作分组的依据条件\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e示例：\x3c\/h5\x3e\n\x3cul\x3e\x3cli\x3e将用户(users)按性别（sex）分组\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.users.aggregate([{ $group : { _id: \x27$sex\x27 } }]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.users\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e([{ $\x3cspan class=\x22hljs-attribute\x22\x3egroup \x3c\/span\x3e: { \x3cspan class=\x22hljs-attribute\x22\x3e_id\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27$sex\x27\x3c\/span\x3e } }]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e返回结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n  { _id: \x27male\x27 },\n  { _id: \x27female\x27 }\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scheme\x22\x3e\x3ccode\x3e[\n  { _id: \x3cspan class=\x22hljs-symbol\x22\x3e\x27male\x3c\/span\x3e\x27 },\n  { _id: \x3cspan class=\x22hljs-symbol\x22\x3e\x27female\x3c\/span\x3e\x27 }\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e进阶示例：\x3c\/h5\x3e\n\x3cul\x3e\n\x3cli\x3e将用户(users)按性别（sex）分组\x3c\/li\x3e\n\x3cli\x3e分组后使用计算各自性别的平均年龄\x3c\/li\x3e\n\x3cli\x3e统计不同的性别的人数，并以count返回\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.users.aggregate([\n    { \n        $group : {\n            _id: \x27$sex\x27, \n            avgAge: { $avg: \x27$age\x27 }, \n            conut: { $sum: 1 } \n        } \n    }\n]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xquery\x22\x3e\x3ccode\x3edb.users.aggregate([\n    { \n        $group : {\n            _id: \x3cspan class=\x22hljs-string\x22\x3e\x27$sex\x27\x3c\/span\x3e, \n            avgAge: { $avg: \x3cspan class=\x22hljs-string\x22\x3e\x27$age\x27\x3c\/span\x3e }, \n            conut: { $sum: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e } \n        } \n    }\n]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e返回结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n  { _id: \x27male\x27, avgAge: \x3c男性平均年龄\x3e, count: \x3c男性人数\x3e },\n  { _id: \x27female\x27, avgAge: \x3c女性平均年龄\x3e, count: \x3c女性人数\x3e }\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e[\n  { \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27male\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eavgAge:\x3c\/span\x3e \x26lt;男性平均年龄\x26gt;, \x3cspan class=\x22hljs-string\x22\x3ecount:\x3c\/span\x3e \x26lt;男性人数\x26gt; },\n  { \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27female\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eavgAge:\x3c\/span\x3e \x26lt;女性平均年龄\x26gt;, \x3cspan class=\x22hljs-string\x22\x3ecount:\x3c\/span\x3e \x26lt;女性人数\x26gt; }\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e此处用到的表达式 { $avg: \x27$age\x27 } 用于求平均年龄，$avg是求均值的操作符，$sum用于汇总， 都只能在$group中使用的累加器，mongoDB3.2以上版本则还可以在$project中使用，详细会在另外的篇章中阐述。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e$unwind 拆分操作符\x3c\/h2\x3e\n\x3ch5\x3e说明：\x3c\/h5\x3e\n\x3cblockquote\x3e\x3cp\x3e用于将数组中的每一个值拆分为单独的文档\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e用法：\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ $unwind: \x3cfield path\x3e }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ \x3cspan class=\x22hljs-variable\x22\x3e$unwind\x3c\/span\x3e: \x3cspan class=\x22hljs-variable\x22\x3e\x26lt;field path\x26gt;\x3c\/span\x3e }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e3.2\x2b版本的用法：\x3c\/h5\x3e\n\x3cblockquote\x3e\x3cp\x3e增加icludeArrayIndex,preserveNullAndEmptyArrays两个可选配置\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  $unwind:\n    {\n      path: \x3cfield path\x3e,\n      includeArrayIndex: \x3cstring\x3e,\n      preserveNullAndEmptyArrays: \x3cboolean\x3e\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dts\x22\x3e\x3ccode\x3e{\n  $unwind:\n    {\n\x3cspan class=\x22hljs-symbol\x22\x3e      path:\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e\x26lt;field path\x26gt;\x3c\/span\x3e,\n\x3cspan class=\x22hljs-symbol\x22\x3e      includeArrayIndex:\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e\x26lt;string\x26gt;\x3c\/span\x3e,\n\x3cspan class=\x22hljs-symbol\x22\x3e      preserveNullAndEmptyArrays:\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e\x26lt;boolean\x26gt;\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e字段\x3c\/th\x3e\n\x3cth\x3e类型\x3c\/th\x3e\n\x3cth\x3e描述\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3epath\x3c\/td\x3e\n\x3ctd\x3estring\x3c\/td\x3e\n\x3ctd\x3e必填，数组的字段名，指定需要拆分的字段\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eincludeArrayIndex\x3c\/td\x3e\n\x3ctd\x3estring\x3c\/td\x3e\n\x3ctd\x3e可选，定义返回的字段名，返回的值是拆分前值在原数组的位置\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3epreserveNullAndEmptyArrays\x3c\/td\x3e\n\x3ctd\x3eboolean\x3c\/td\x3e\n\x3ctd\x3e可选，配置在path的值为空或缺失的情况下是否拆分， 默认false\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3ch5\x3e示例：\x3c\/h5\x3e\n\x3cp\x3e假设articles文档集合是这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: [\x27a\x27, \x27b\x27, \x27c\x27]}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e{ \x3cspan class=\x22hljs-attribute\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27this is article A\x27\x3c\/span\x3e, author: \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, _id: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, comments: [\x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27b\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27c\x27\x3c\/span\x3e]}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.articles.aggregate([{ $unwind: \x27$comments\x27 }]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.articles\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e(\x3cspan class=\x22hljs-selector-attr\x22\x3e[{ $unwind: \x27$comments\x27 }]\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: \x27a\x27},\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: \x27b\x27},\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: \x27c\x27},\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e[\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article A\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ecomments:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e},\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article A\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ecomments:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27b\x27\x3c\/span\x3e},\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article A\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ecomments:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27c\x27\x3c\/span\x3e},\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e进阶示例（v3.2\x2b）：\x3c\/h5\x3e\n\x3cp\x3e假设articles文档集合是这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: [\x27a\x27, \x27b\x27, \x27c\x27] }\n    { title: \x27this is article B\x27, author: \x27Jack\x27, _id: 2 },\n    { title: \x27this is article C\x27, author: \x27Amy\x27, _id: 3, comments: [] },\n    { title: \x27this is article D\x27, author: \x27Lam\x27, _id: 4, comments: null },\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e[\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article A\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ecomments:\x3c\/span\x3e [\x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27b\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27c\x27\x3c\/span\x3e] }\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article B\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Jack\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article C\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Amy\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ecomments:\x3c\/span\x3e [] },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article D\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Lam\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ecomments:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e },\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e操作：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.articles.aggregate([\n    { \n        $unwind: {\n            path: \x27$comments\x27,\n            includeArrayIndex: \x27arrayIndex\x27,\n        }\n    }\n]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.articles\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e([\n    { \n        $\x3cspan class=\x22hljs-attribute\x22\x3eunwind\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attribute\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27$comments\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attribute\x22\x3eincludeArrayIndex\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27arrayIndex\x27\x3c\/span\x3e,\n        }\n    }\n]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: \x27a\x27, arrayIndex: NumberLong(0) },\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: \x27b\x27, arrayIndex: NumberLong(1) },\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: \x27c\x27, arrayIndex: NumberLong(2) },\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scheme\x22\x3e\x3ccode\x3e[\n    { title: \x3cspan class=\x22hljs-symbol\x22\x3e\x27this\x3c\/span\x3e is article A\x27, author: \x3cspan class=\x22hljs-symbol\x22\x3e\x27John\x3c\/span\x3e\x27, _id: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, comments: \x3cspan class=\x22hljs-symbol\x22\x3e\x27a\x3c\/span\x3e\x27, arrayIndex: NumberLong(\x3cspan class=\x22hljs-name\x22\x3e0\x3c\/span\x3e) },\n    { title: \x3cspan class=\x22hljs-symbol\x22\x3e\x27this\x3c\/span\x3e is article A\x27, author: \x3cspan class=\x22hljs-symbol\x22\x3e\x27John\x3c\/span\x3e\x27, _id: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, comments: \x3cspan class=\x22hljs-symbol\x22\x3e\x27b\x3c\/span\x3e\x27, arrayIndex: NumberLong(\x3cspan class=\x22hljs-name\x22\x3e1\x3c\/span\x3e) },\n    { title: \x3cspan class=\x22hljs-symbol\x22\x3e\x27this\x3c\/span\x3e is article A\x27, author: \x3cspan class=\x22hljs-symbol\x22\x3e\x27John\x3c\/span\x3e\x27, _id: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, comments: \x3cspan class=\x22hljs-symbol\x22\x3e\x27c\x3c\/span\x3e\x27, arrayIndex: NumberLong(\x3cspan class=\x22hljs-name\x22\x3e2\x3c\/span\x3e) },\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e操作：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.articles.aggregate([\n    { \n        $unwind: {\n            path: \x27$comments\x27,\n            preserveNullAndEmptyArrays: true,\n        }\n    }\n]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.articles\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e([\n    { \n        $\x3cspan class=\x22hljs-attribute\x22\x3eunwind\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attribute\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27$comments\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attribute\x22\x3epreserveNullAndEmptyArrays\x3c\/span\x3e: true,\n        }\n    }\n]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: \x27a\x27 },\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: \x27b\x27 },\n    { title: \x27this is article A\x27, author: \x27John\x27, _id: 1, comments: \x27c\x27 },\n    { title: \x27this is article B\x27, author: \x27Jack\x27, _id: 2 },\n    { title: \x27this is article C\x27, author: \x27Amy\x27, _id: 3 },\n    { title: \x27this is article C\x27, author: \x27Amy\x27, _id: 3, comments: null }\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e[\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article A\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ecomments:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article A\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ecomments:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27b\x27\x3c\/span\x3e },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article A\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27John\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ecomments:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27c\x27\x3c\/span\x3e },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article B\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Jack\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article C\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Amy\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e },\n    { \x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27this is article C\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Amy\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e_id:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3ecomments:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e }\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e$lookup 连接操作符\x3c\/h2\x3e\n\x3ch5\x3e说明：\x3c\/h5\x3e\n\x3cblockquote\x3e\x3cp\x3e用于连接同一个数据库中另一个集合，并获取指定的文档，类似于populate\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e用法：\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n   $lookup:\n     {\n       from: \x3ccollection to join\x3e,\n       localField: \x3cfield from the input documents\x3e,\n       foreignField: \x3cfield from the documents of the \x26quot;from\x26quot; collection\x3e,\n       as: \x3coutput array field\x3e\n     }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs smali\x22\x3e\x3ccode\x3e{\n   $lookup:\n     {\n       from: \x26lt;collection to join\x26gt;,\n       localField: \x26lt;field from the input documents\x26gt;,\n       foreignField: \x26lt;field from the documents of the \x3cspan class=\x22hljs-string\x22\x3e\x22from\x22\x3c\/span\x3e collection\x26gt;,\n       as: \x26lt;output\x3cspan class=\x22hljs-built_in\x22\x3e array \x3c\/span\x3efield\x26gt;\n     }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e字段\x3c\/th\x3e\n\x3cth\x3e描述\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3efrom\x3c\/td\x3e\n\x3ctd\x3e需要关联的集合名\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3elocalField\x3c\/td\x3e\n\x3ctd\x3e本集合中需要查找的字段\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eforeignField\x3c\/td\x3e\n\x3ctd\x3e另外一个集合中需要关联的字段\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eas\x3c\/td\x3e\n\x3ctd\x3e输出的字段名\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3ch5\x3e示例：\x3c\/h5\x3e\n\x3cul\x3e\n\x3cli\x3eariticles中的author关联到user表\x3c\/li\x3e\n\x3cli\x3eauthoer字段返回详细的用户的信息\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.articles.aggregate([\n  {\n    $lookup:\n      {\n        from: \x26quot;users\x26quot;,\n        localField: \x26quot;author\x26quot;,\n        foreignField: \x26quot;name\x26quot;,\n        as: \x26quot;author\x26quot;\n      }\n  }\n])\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.articles\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.aggregate\x3c\/span\x3e([\n  {\n    $\x3cspan class=\x22hljs-attribute\x22\x3elookup\x3c\/span\x3e:\n      {\n        \x3cspan class=\x22hljs-attribute\x22\x3efrom\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22users\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attribute\x22\x3elocalField\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22author\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attribute\x22\x3eforeignField\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attribute\x22\x3eas\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22author\x22\x3c\/span\x3e\n      }\n  }\n])\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n    { \n        title: \x27this is article A\x27, \n        author: { \n            name: \x27John\x27,\n            age: 16,\n            sex: male,\n            city: guangzhou,\n            _id: 1, \n            ...\n        }, \n        _id: 1, \n        ... \n    },\n    { \n        title: \x27this is article B\x27, \n        author: { \n            name: \x27Jack\x27,\n            age: 29,\n            sex: male,\n            city: guangzhou,\n            _id: 3, \n            ...\n        }, \n        _id: 2, \n        ... \n    },\n    { \n        title: \x27this is article C\x27, \n        author: { \n            name: \x27Rose\x27,\n            age: 18,\n            sex: male,\n            city: beijing,\n            _id: 2, \n            ...\n        }, \n        _id: 3, \n        ... \n    },\n    { \n        title: \x27this is article D\x27, \n        author: { \n            name: \x27John\x27,\n            age: 16,\n            sex: male,\n            city: guangzhou,\n            _id: 1, \n            ...\n        },\n        _id: 4, \n        ... \n    },\n    { \n        title: \x27this is article E\x27, \n        author: { \n            name: \x27John\x27,\n            age: 16,\n            sex: male,\n            city: guangzhou,\n            _id: 1,\n            ...\n        },\n        _id: 5, \n        ... \n    },\n    ...\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e[\n    { \n        title: \x27this is article A\x27, \n        author: { \n            name: \x27John\x27,\n            age: \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e,\n            sex: male,\n            city: guangzhou,\n            _id: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \n            ...\n        }, \n        _id: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \n        ... \n    },\n    { \n        title: \x27this is article B\x27, \n        author: { \n            name: \x27Jack\x27,\n            age: \x3cspan class=\x22hljs-number\x22\x3e29\x3c\/span\x3e,\n            sex: male,\n            city: guangzhou,\n            _id: \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \n            ...\n        }, \n        _id: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \n        ... \n    },\n    { \n        title: \x27this is article C\x27, \n        author: { \n            name: \x27Rose\x27,\n            age: \x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e,\n            sex: male,\n            city: beijing,\n            _id: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \n            ...\n        }, \n        _id: \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \n        ... \n    },\n    { \n        title: \x27this is article D\x27, \n        author: { \n            name: \x27John\x27,\n            age: \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e,\n            sex: male,\n            city: guangzhou,\n            _id: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \n            ...\n        },\n        _id: \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e, \n        ... \n    },\n    { \n        title: \x27this is article E\x27, \n        author: { \n            name: \x27John\x27,\n            age: \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e,\n            sex: male,\n            city: guangzhou,\n            _id: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n            ...\n        },\n        _id: \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e, \n        ... \n    },\n    ...\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader13\x22\x3e综合示例\x3c\/h1\x3e\n\x3ch5\x3e需求\x3c\/h5\x3e\n\x3cp\x3e找出发表文章最多的5位作者，按发表文章排序，显示他的发表文章的总次数，和他自己的信息\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e文章按照作者分组,统计次数\x3c\/li\x3e\n\x3cli\x3e按照次数从高到低排序\x3c\/li\x3e\n\x3cli\x3e截取头5名\x3c\/li\x3e\n\x3cli\x3e关联用户信息\x3c\/li\x3e\n\x3cli\x3e不输出文章_id\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch5\x3e操作\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.articles.aggregate([\n  {\n    $group:\n      {\n        _id: \x26quot;$author\x26quot;,\n        count: { $sum: 1 },\n      }\n  }, \n  {\n        $sort: { count: -1 }\n  },\n  {\n      $skip: 5\n  },\n  {\n      $lookup:\n        {\n          from: \x26quot;users\x26quot;,\n          localField: \x26quot;author\x26quot;,\n          foreignField: \x26quot;name\x26quot;,\n          as: \x26quot;author\x26quot;\n        }\n  },\n  {\n      $project: {\n          _id: 0,\n      }\n  }\n])\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xquery\x22\x3e\x3ccode\x3edb.articles.aggregate([\n  {\n    $group:\n      {\n        _id: \x3cspan class=\x22hljs-string\x22\x3e\x22$author\x22\x3c\/span\x3e,\n        count: { $sum: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e },\n      }\n  }, \n  {\n        $sort: { count: -\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e }\n  },\n  {\n      $skip: \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e\n  },\n  {\n      $lookup:\n        {\n          from: \x3cspan class=\x22hljs-string\x22\x3e\x22users\x22\x3c\/span\x3e,\n          localField: \x3cspan class=\x22hljs-string\x22\x3e\x22author\x22\x3c\/span\x3e,\n          foreignField: \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e,\n          as: \x3cspan class=\x22hljs-string\x22\x3e\x22author\x22\x3c\/span\x3e\n        }\n  },\n  {\n      $project: {\n          _id: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n      }\n  }\n])\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader14\x22\x3e总结\x3c\/h1\x3e\n\x3cp\x3e本文介绍了几个使用聚合管道查询时常用的管道操作符的用法，熟练地综合使用以上操作符可以对数据进行多样的处理，组合，统计，得出多样化的数据。另外再加以配合表达式操作符(Expression Operators)组成的表达式, 或者在$project或$group中使用累加器(Accumulators)能查询统计的内容会更加的多样化。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e感谢阅读~\x3c\/p\x3e\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>【mongoDB查询进阶】聚合管道(二) &ndash; 阶段操作符</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010826809">https://segmentfault.com/a/1190000010826809</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/wki1htymnl/" target="_blank">https://alili.tech/archive/wki1htymnl/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>