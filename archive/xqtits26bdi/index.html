<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="vue 微信授权解决方案"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>vue 微信授权解决方案 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/xqtits26bdi/",
				"appid": "1613049289050283", 
				"title": "vue 微信授权解决方案 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-06T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/stsg80za0a9/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/0mljifcwjlaf/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fxqtits26bdi%2f&text=vue%20%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fxqtits26bdi%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fxqtits26bdi%2f&text=vue%20%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fxqtits26bdi%2f&title=vue%20%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fxqtits26bdi%2f&is_video=false&description=vue%20%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=vue%20%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fxqtits26bdi%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fxqtits26bdi%2f&title=vue%20%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fxqtits26bdi%2f&title=vue%20%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fxqtits26bdi%2f&title=vue%20%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fxqtits26bdi%2f&title=vue%20%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">vue 微信授权解决方案</h1><div class="meta"><div class="postdate"><time datetime="2018-12-06" itemprop="datePublished">2018-12-06</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e背景\x3c\/h2\x3e\n\x3cp\x3evue前后端分离开发微信授权\x3cbr\x3e2018-08-14更新\x3cbr\x3e时隔四个月第一次更新，因为项目重构有一次接触到了微信授权，思路已经比原来清晰的多了，将重新修改一下整个文章\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e场景\x3c\/h2\x3e\n\x3cp\x3eapp将商品分享到微信朋友圈或者分享给微信好友，用户点击页面时进行微信授权登陆，获取用户信息。\x3cbr\x3e问题：\x3cstrong\x3e没有固定的h5应用首页，回调不能到index。授权后重定向url带参数并且很长\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e本人愚钝，开发过程中，尝试过很多方法，踩坑不足以形容我的心情，可以说每一次都是一次跳井的体验啊。\x3c\/p\x3e\n\x3cp\x3e1.一开始尝试的方式是前端请求微信连接，返回code，然后code作为再去请求后台接口获取token，后面看到别人的博客说这个方法不好，最好就是直接请求后台接口，然后后台返回url做跳转，所以就采用了最传统的方法，后台返回url，前台跳转。\x3c\/p\x3e\n\x3cp\x3e2.这个时候就出现一个问题，微信授权要跳跳跳，最终想回到第一次点进来时候的链接就蛋疼了，从网上查了一下解决方法，将链接本身作为redirect_uri参数，大概就是这个样子\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22https:\/\/open.weixin.qq.com\/connect\/oauth2\/authorizeappid=xxxxxxxxxxxxxxxxxx\x26amp;redirect_uri=*www.admin?http:\/\/www.xxx.com\/h5\/product*\x26amp;response_type=code\x26amp;scope=snsapi_userinfo\x26amp;state=STATE\x26amp;connect_redirect=1#wechat_redirect\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3ehttps:\/\/open.weixin.qq.com\/connect\/oauth2\/authorizeappid=xxxxxxxxxxxxxxxxxx\x26amp;redirect_uri=*www.admin?http:\/\/www.xxx.com\/h5\/product*\x26amp;response_type=code\x26amp;scope=snsapi_userinfo\x26amp;\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e=STATE\x26amp;connect_redirect=\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e#wechat_redirect\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然而我们的前台链接是这个鬼样子的，本身带参数，而且超长，what？微信可能不会接受我长这么丑。\/(ㄒoㄒ)\/~~\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 http:\/\/www.xxx.com\/h5\/product?id=6RedfM5O4xeyl0AmOwmyipkHr8AQCv-hYXZVAIFTwDXOsWSKqgu3VaCmaKSerBnacvWuzO3Zwdf8y%2F2K2lvqkluV6Ane4LCAKyPU2tPAPj%2FMF6F6xkzp27GqqpNya7HbdEA34qGQJvHIA9tlIMkeEWid1112b8oZuP3FQBwU%2F%2FMaSrovzQP6LlzWamyPnv0vMizu8uh0ItpJOQUV1m%2FtemF3U9KuHo8rXCw%3D\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs apache\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e \x3cspan class=\x22hljs-attribute\x22\x3ehttp\x3c\/span\x3e:\/\/www.xxx.com\/h5\/product?id=6RedfM5O4xeyl0AmOwmyipkHr8AQCv-hYXZVAIFTwDXOsWSKqgu3VaCmaKSerBnacvWuzO3Zwdf8y\x3cspan class=\x22hljs-number\x22\x3e%2\x3c\/span\x3eF2K2lvqkluV6Ane4LCAKyPU2tPAPj\x3cspan class=\x22hljs-number\x22\x3e%2\x3c\/span\x3eFMF6F6xkzp27GqqpNya7HbdEA34qGQJvHIA9tlIMkeEWid1112b8oZuP3FQBwU\x3cspan class=\x22hljs-number\x22\x3e%2\x3c\/span\x3eF\x3cspan class=\x22hljs-number\x22\x3e%2\x3c\/span\x3eFMaSrovzQP6LlzWamyPnv0vMizu8uh0ItpJOQUV1m\x3cspan class=\x22hljs-number\x22\x3e%2\x3c\/span\x3eFtemF3U9KuHo8rXCw\x3cspan class=\x22hljs-number\x22\x3e%3\x3c\/span\x3eD\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最终放弃了这个方案\x3c\/p\x3e\n\x3cp\x3e3.考虑如何重定向我的前台地址，并且获取token\x3c\/p\x3e\n\x3cp\x3e接下来就是我现在用的方法，bug还有很多，先分享一下我的方法，后期优化或有更好的方法再做修改\x3cbr\x3e在main.js中路由全局钩子判断本地是不是有user_token，也就是微信授权后返回的token，如果没有token，并且当前的路由不是author（专门为了授权而生的页面），那就保存当前的url，比如www.xxx.com\/h5\/product?id=6RedfM5O4xeyl0AmOwm，然后进入author。那如果本地有token，就是用户之前授权拿到过token并且vuex里没有用户信息，那我就获取用户信息并保存在vuex中，这里遇到一个问题就是token会出现过期的情况，那我就删除了本地的user_token，window.localStorage.removeItem(\x22user_token\x22);刷新页面 router.go(0);这个时候就重新走了一遍如果没有token的情况。\x3cbr\x3e第一版方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 router.beforeEach((to, from, next) =\x3e {\n      \/\/   第一次进入项目\n      let token = window.localStorage.getItem(\x26quot;user_token\x26quot;);\n      \n      if (!token \x26amp;\x26amp; to.path != \x26quot;\/author\x26quot;) {\n        window.localStorage.setItem(\x26quot;beforeLoginUrl\x26quot;, to.fullPath); \/\/ 保存用户进入的url\n        next(\x26quot;\/author\x26quot;);\n        return false;\n      } else if (token \x26amp;\x26amp; !store.getters.userInfo) {\n      \/\/获取用户信息接口\n        store\n          .dispatch(\x26quot;GetUserInfo\x26quot;, {\n            user_token: token\n          })\n          .catch(err =\x3e {\n            window.localStorage.removeItem(\x26quot;user_token\x26quot;);\n            router.go(0);\n            return false;\n          });\n      }\n      next();\n    });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e router.beforeEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eto, \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e, next\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/   第一次进入项目\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e token = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.getItem(\x3cspan class=\x22hljs-string\x22\x3e\x22user_token\x22\x3c\/span\x3e);\n      \n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!token \x26amp;\x26amp; to.path != \x3cspan class=\x22hljs-string\x22\x3e\x22\/author\x22\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.setItem(\x3cspan class=\x22hljs-string\x22\x3e\x22beforeLoginUrl\x22\x3c\/span\x3e, to.fullPath); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存用户进入的url\x3c\/span\x3e\n        next(\x3cspan class=\x22hljs-string\x22\x3e\x22\/author\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token \x26amp;\x26amp; !store.getters.userInfo) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/获取用户信息接口\x3c\/span\x3e\n        store\n          .dispatch(\x3cspan class=\x22hljs-string\x22\x3e\x22GetUserInfo\x22\x3c\/span\x3e, {\n            \x3cspan class=\x22hljs-attr\x22\x3euser_token\x3c\/span\x3e: token\n          })\n          .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.removeItem(\x3cspan class=\x22hljs-string\x22\x3e\x22user_token\x22\x3c\/span\x3e);\n            router.go(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n          });\n      }\n      next();\n    });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e2018-08-14第二版方法\x3cbr\x3e不同的地方是将跳转判断从author.vue里拿出来放这里了逻辑其实很简单，有token获取信息，没token跳转授权\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22router.beforeEach((to, from, next) =\x3e {\n  \n  const token = window.localStorage.getItem(\x27user_token\x27)\n  if (token) {\n    if (to.path === \x27\/author\x27) {\n      next({\n        path: \x27\/\x27\n      })\n    } else {\n      store\n        .dispatch(\x27GetUserInfo\x27, {\n          user_token: token\n        })\n        .then(res =\x3e {\n          \/\/ 拉取用户信息\n          next()\n        })\n    }\n  } else {\n    if (to.path !== \x27\/author\x27) {\n      \/\/ 保存用户进入的url\n      if (to.path === \x27\/shop\x27 || to.path === \x27\/product\x27) {\n        window.localStorage.setItem(\x27authUrl\x27, to.fullPath) \/\/ 保存用户进入的url\n      }\n      store.dispatch(\x27GetAuthUrl\x27).then(res =\x3e {\n        \/\/ 此处返回的是后台拼接的微信授权地址，前台也是可以拼接的，跳转到微信授权\n        window.location.href = res.data.url \/\/https:\/\/open.weixin.qq.com\/connect\/oauth2\/authorize?appid=aaaaa\x26amp;redirect_uri=后端java或php地址\x26amp;response_type=code\x26amp;scope=snsapi_userinfo\x26amp;state=STATE\x26amp;connect_redirect=1#wechat_redirect\n      })\n    } else {\n      next()\n    }\n  }\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3erouter.beforeEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eto, \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e, next\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e token = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.getItem(\x3cspan class=\x22hljs-string\x22\x3e\x27user_token\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (to.path === \x3cspan class=\x22hljs-string\x22\x3e\x27\/author\x27\x3c\/span\x3e) {\n      next({\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e\n      })\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      store\n        .dispatch(\x3cspan class=\x22hljs-string\x22\x3e\x27GetUserInfo\x27\x3c\/span\x3e, {\n          \x3cspan class=\x22hljs-attr\x22\x3euser_token\x3c\/span\x3e: token\n        })\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 拉取用户信息\x3c\/span\x3e\n          next()\n        })\n    }\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (to.path !== \x3cspan class=\x22hljs-string\x22\x3e\x27\/author\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存用户进入的url\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (to.path === \x3cspan class=\x22hljs-string\x22\x3e\x27\/shop\x27\x3c\/span\x3e || to.path === \x3cspan class=\x22hljs-string\x22\x3e\x27\/product\x27\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.setItem(\x3cspan class=\x22hljs-string\x22\x3e\x27authUrl\x27\x3c\/span\x3e, to.fullPath) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存用户进入的url\x3c\/span\x3e\n      }\n      store.dispatch(\x3cspan class=\x22hljs-string\x22\x3e\x27GetAuthUrl\x27\x3c\/span\x3e).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 此处返回的是后台拼接的微信授权地址，前台也是可以拼接的，跳转到微信授权\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = res.data.url \x3cspan class=\x22hljs-comment\x22\x3e\/\/https:\/\/open.weixin.qq.com\/connect\/oauth2\/authorize?appid=aaaaa\x26amp;redirect_uri=后端java或php地址\x26amp;response_type=code\x26amp;scope=snsapi_userinfo\x26amp;state=STATE\x26amp;connect_redirect=1#wechat_redirect\x3c\/span\x3e\n      })\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      next()\n    }\n  }\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e下面就是进入author.vue的逻辑,第一次进入author， www.xxxx.com\/h5\/author，判断链接有没有token参数，如果没有就跳微信授权，然后后台会重定向回来并携带token，如： www.xxxx.com\/h5\/author?token=xxxxxxxxx\x26amp;msg=200\x3c\/p\x3e\n\x3cp\x3e第一版\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 \n\x3ctemplate\x3e\n   \x3cdiv\x3e\n授权中。。。\n   \x3c\/div\x3e\n\x3c\/template\x3e\n\n\x3cscript\x3e\n  \n   import {\n      getWxAuth\n   } from \x27@\/service\/getData\x27\n   import {\n      GetQueryString \n   } from \x27@\/utils\/mixin\x27;\n   export default {\n      data() {\n         return {\n            token: \x27\x27,\n         };\n      },\n      computed: {\n       \n      },\n      created() {\n         this.token =  window.localStorage.getItem(\x26quot;user_token\x26quot;);\n         \/\/判断当前的url有没有token参数,如果不存在那就跳转到微信授权的url\n         \/\/就是前面说的ReturnGetCodeUrl方法\n  \n         if (!GetQueryString(\x26quot;token\x26quot;)) {\n            this.ReturnGetCodeUrl();\n         } else {\n           \/\/如果有token，如http:\/\/www.xxxx.com\/h5\/author?token=xxxxxxxxx\x26amp;msg=200，这里的参数就是后台重定向到前台http:\/\/www.xxxx.com\/h5\/author，并携带的参数。这样就可以拿到我们想要的token了\n           \/\/判断一下后台返回的状态码msg，因为可能出现微信拿不到token的情况\n            let msg = GetQueryString(\x26quot;msg\x26quot;)\n            if (msg = 200) {\n               this.token = GetQueryString(\x26quot;token\x26quot;);\n               \/\/存储token到本地\n                window.localStorage.setItem(\x26quot;user_token\x26quot;, this.token);\n                \/\/获取beforeLoginUrl，我们的前端页面\n               let url =  window.localStorage.getItem(\x26quot;beforeLoginUrl\x26quot;);\n               \/\/跳转\n               this.$router.push(url);\n               \/\/删除本地beforeLoginUrl\n               removeLocalStorage(\x26quot;beforeLoginUrl\x26quot;);\n            }else{\n            \/\/msg不是200的情况，可能跳到404的错误页面\n            }\n         }\n      },\n      methods: {\n       \n         async ReturnGetCodeUrl() {\n            let {\n               data\n            } = await getWxAuth({});\n            if (data.status == 200) {\n              \n               window.location.href = data.url;\n            }\n         },\n\n         \n      },\n      watch: {},\n\n      components: {},\n\n\n      mounted: function () {}\n   }\n\x3c\/script\x3e\n\x3cstyle lang=\x27scss\x27 scoped\x3e\n\n\x3c\/style\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e \n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n   \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n授权中。。。\n   \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n  \n   \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {\n      getWxAuth\n   } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@\/service\/getData\x27\x3c\/span\x3e\n   \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {\n      GetQueryString \n   } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@\/utils\/mixin\x27\x3c\/span\x3e;\n   \x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n      data() {\n         \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-attr\x22\x3etoken\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n         };\n      },\n      \x3cspan class=\x22hljs-attr\x22\x3ecomputed\x3c\/span\x3e: {\n       \n      },\n      created() {\n         \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.token =  \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.getItem(\x3cspan class=\x22hljs-string\x22\x3e\x22user_token\x22\x3c\/span\x3e);\n         \x3cspan class=\x22hljs-comment\x22\x3e\/\/判断当前的url有没有token参数,如果不存在那就跳转到微信授权的url\x3c\/span\x3e\n         \x3cspan class=\x22hljs-comment\x22\x3e\/\/就是前面说的ReturnGetCodeUrl方法\x3c\/span\x3e\n  \n         \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!GetQueryString(\x3cspan class=\x22hljs-string\x22\x3e\x22token\x22\x3c\/span\x3e)) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ReturnGetCodeUrl();\n         } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n           \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果有token，如http:\/\/www.xxxx.com\/h5\/author?token=xxxxxxxxx\x26amp;msg=200，这里的参数就是后台重定向到前台http:\/\/www.xxxx.com\/h5\/author，并携带的参数。这样就可以拿到我们想要的token了\x3c\/span\x3e\n           \x3cspan class=\x22hljs-comment\x22\x3e\/\/判断一下后台返回的状态码msg，因为可能出现微信拿不到token的情况\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e msg = GetQueryString(\x3cspan class=\x22hljs-string\x22\x3e\x22msg\x22\x3c\/span\x3e)\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (msg = \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e) {\n               \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.token = GetQueryString(\x3cspan class=\x22hljs-string\x22\x3e\x22token\x22\x3c\/span\x3e);\n               \x3cspan class=\x22hljs-comment\x22\x3e\/\/存储token到本地\x3c\/span\x3e\n                \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.setItem(\x3cspan class=\x22hljs-string\x22\x3e\x22user_token\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.token);\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/获取beforeLoginUrl，我们的前端页面\x3c\/span\x3e\n               \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e url =  \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.getItem(\x3cspan class=\x22hljs-string\x22\x3e\x22beforeLoginUrl\x22\x3c\/span\x3e);\n               \x3cspan class=\x22hljs-comment\x22\x3e\/\/跳转\x3c\/span\x3e\n               \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$router.push(url);\n               \x3cspan class=\x22hljs-comment\x22\x3e\/\/删除本地beforeLoginUrl\x3c\/span\x3e\n               removeLocalStorage(\x3cspan class=\x22hljs-string\x22\x3e\x22beforeLoginUrl\x22\x3c\/span\x3e);\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/msg不是200的情况，可能跳到404的错误页面\x3c\/span\x3e\n            }\n         }\n      },\n      \x3cspan class=\x22hljs-attr\x22\x3emethods\x3c\/span\x3e: {\n       \n         \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e ReturnGetCodeUrl() {\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {\n               data\n            } = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e getWxAuth({});\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (data.status == \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e) {\n              \n               \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = data.url;\n            }\n         },\n\n         \n      },\n      \x3cspan class=\x22hljs-attr\x22\x3ewatch\x3c\/span\x3e: {},\n\n      \x3cspan class=\x22hljs-attr\x22\x3ecomponents\x3c\/span\x3e: {},\n\n\n      \x3cspan class=\x22hljs-attr\x22\x3emounted\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{}\n   }\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elang\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27scss\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3escoped\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eGetQueryString方法\x3c\/p\x3e\n\x3cp\x3emixin.js\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export const GetQueryString = name =\x3e {\n  var url = new RegExp(\x26quot;(^|\x26amp;)\x26quot; \x2b name \x2b \x26quot;=([^\x26amp;]*)(\x26amp;|$)\x26quot;);\n  var newUrl = window.location.search.substr(1).match(url);\n  if (newUrl != null) {\n    return unescape(newUrl[2]);\n  } else {\n    return false;\n  }\n};\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3eexport const GetQueryString = name =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eRegExp\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22(^|\x26amp;)\x22\x3c\/span\x3e \x2b name \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22=([^\x26amp;]*)(\x26amp;|$)\x22\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eUrl\x3c\/span\x3e = window.location.search.substr(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e).match(url);\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eUrl\x3c\/span\x3e != \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e unescape(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eUrl\x3c\/span\x3e[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]);\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n  }\n};\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第二版\x3cbr\x3e只用来后台拿到参数返回到author页面后的携带的参数如果获取成功则跳转到授权之前保存的url如果失败提示用户关闭网页重新授权，另外有一点值得注意，微信名里有特殊字符的需要转码要不授权会失败\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!-- author --\x3e\n\x3ctemplate\x3e\n  \x3cdiv\x3e\n    授权中。。。\n  \x3c\/div\x3e\n\x3c\/template\x3e\n\n\x3cscript\x3e\n  import {\n    mapGetters\n  } from \x27vuex\x27\n  import {\n    Toast\n  } from \x27mint-ui\x27\n  import {\n    GetQueryString,\n    setLocalStorage,\n    getLocalStorage,\n    removeLocalStorage\n  } from \x27@\/utils\x27\n  export default {\n    data() {\n      return {\n        token: \x27\x27\n      }\n    },\n    computed: {\n      ...mapGetters([\n        \x27userInfo\x27\n      ])\n    },\n    created() {\n      const wxtoken = GetQueryString(\x27token\x27)\n      const code = GetQueryString(\x27msg\x27)\n      if (wxtoken \x26amp;\x26amp; Number(code) === 200) {\n        setLocalStorage(\x27user_token\x27, wxtoken)\n        const historyUrl = getLocalStorage(\x27authUrl\x27)\n        this.$router.replace(historyUrl)\n        \/\/  removeLocalStorage(\x27authUrl\x27)\n      } else {\n        \/\/ 没有拿到后台访问微信返回的token\n        Toast(\x27授权失败请关闭网页重新进入\x27)\n        removeLocalStorage(\x27share_token\x27)\n        removeLocalStorage(\x27authUrl\x27)\n      }\n    }\n  }\n\n\x3c\/script\x3e\n\x3cstyle lang=\x27scss\x27 scoped\x3e\n\n\n\x3c\/style\x3e\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- author --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    授权中。。。\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {\n    mapGetters\n  } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27vuex\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {\n    Toast\n  } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27mint-ui\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {\n    GetQueryString,\n    setLocalStorage,\n    getLocalStorage,\n    removeLocalStorage\n  } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@\/utils\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n    data() {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-attr\x22\x3etoken\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e\n      }\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3ecomputed\x3c\/span\x3e: {\n      ...mapGetters([\n        \x3cspan class=\x22hljs-string\x22\x3e\x27userInfo\x27\x3c\/span\x3e\n      ])\n    },\n    created() {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e wxtoken = GetQueryString(\x3cspan class=\x22hljs-string\x22\x3e\x27token\x27\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e code = GetQueryString(\x3cspan class=\x22hljs-string\x22\x3e\x27msg\x27\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (wxtoken \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e(code) === \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e) {\n        setLocalStorage(\x3cspan class=\x22hljs-string\x22\x3e\x27user_token\x27\x3c\/span\x3e, wxtoken)\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e historyUrl = getLocalStorage(\x3cspan class=\x22hljs-string\x22\x3e\x27authUrl\x27\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$router.replace(historyUrl)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/  removeLocalStorage(\x27authUrl\x27)\x3c\/span\x3e\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 没有拿到后台访问微信返回的token\x3c\/span\x3e\n        Toast(\x3cspan class=\x22hljs-string\x22\x3e\x27授权失败请关闭网页重新进入\x27\x3c\/span\x3e)\n        removeLocalStorage(\x3cspan class=\x22hljs-string\x22\x3e\x27share_token\x27\x3c\/span\x3e)\n        removeLocalStorage(\x3cspan class=\x22hljs-string\x22\x3e\x27authUrl\x27\x3c\/span\x3e)\n      }\n    }\n  }\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elang\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27scss\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3escoped\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\n\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e整个过程是可以实现授权，但是觉得代码写得不好，以后的开发中希望能够有更优的方法。希望能和大家交流学习。\x3cbr\x3e2018-08-14更新，总结一下，第二次开发流程做了简化，但是整个思路还是一样，我之前想到过另外一种方法，是将我的那串长参数先保存在本地，然后去授权的时候就可以让后台帮我跳转到固定页面如\/product我在从本地拿参数解析，这个方法应该也是可行的，下次尝试后更新\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>vue 微信授权解决方案</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014255151">https://segmentfault.com/a/1190000014255151</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/xqtits26bdi/" target="_blank">https://alili.tech/archive/xqtits26bdi/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>