<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="你不知道的前端算法之文字避让"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>你不知道的前端算法之文字避让 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/xybrssyaidr/",
				"appid": "1613049289050283", 
				"title": "你不知道的前端算法之文字避让 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-18T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ru2gmfukaah/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/2a42xeu1s7p/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fxybrssyaidr%2f&text=%e4%bd%a0%e4%b8%8d%e7%9f%a5%e9%81%93%e7%9a%84%e5%89%8d%e7%ab%af%e7%ae%97%e6%b3%95%e4%b9%8b%e6%96%87%e5%ad%97%e9%81%bf%e8%ae%a9"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fxybrssyaidr%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fxybrssyaidr%2f&text=%e4%bd%a0%e4%b8%8d%e7%9f%a5%e9%81%93%e7%9a%84%e5%89%8d%e7%ab%af%e7%ae%97%e6%b3%95%e4%b9%8b%e6%96%87%e5%ad%97%e9%81%bf%e8%ae%a9"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fxybrssyaidr%2f&title=%e4%bd%a0%e4%b8%8d%e7%9f%a5%e9%81%93%e7%9a%84%e5%89%8d%e7%ab%af%e7%ae%97%e6%b3%95%e4%b9%8b%e6%96%87%e5%ad%97%e9%81%bf%e8%ae%a9"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fxybrssyaidr%2f&is_video=false&description=%e4%bd%a0%e4%b8%8d%e7%9f%a5%e9%81%93%e7%9a%84%e5%89%8d%e7%ab%af%e7%ae%97%e6%b3%95%e4%b9%8b%e6%96%87%e5%ad%97%e9%81%bf%e8%ae%a9"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bd%a0%e4%b8%8d%e7%9f%a5%e9%81%93%e7%9a%84%e5%89%8d%e7%ab%af%e7%ae%97%e6%b3%95%e4%b9%8b%e6%96%87%e5%ad%97%e9%81%bf%e8%ae%a9&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fxybrssyaidr%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fxybrssyaidr%2f&title=%e4%bd%a0%e4%b8%8d%e7%9f%a5%e9%81%93%e7%9a%84%e5%89%8d%e7%ab%af%e7%ae%97%e6%b3%95%e4%b9%8b%e6%96%87%e5%ad%97%e9%81%bf%e8%ae%a9"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fxybrssyaidr%2f&title=%e4%bd%a0%e4%b8%8d%e7%9f%a5%e9%81%93%e7%9a%84%e5%89%8d%e7%ab%af%e7%ae%97%e6%b3%95%e4%b9%8b%e6%96%87%e5%ad%97%e9%81%bf%e8%ae%a9"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fxybrssyaidr%2f&title=%e4%bd%a0%e4%b8%8d%e7%9f%a5%e9%81%93%e7%9a%84%e5%89%8d%e7%ab%af%e7%ae%97%e6%b3%95%e4%b9%8b%e6%96%87%e5%ad%97%e9%81%bf%e8%ae%a9"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fxybrssyaidr%2f&title=%e4%bd%a0%e4%b8%8d%e7%9f%a5%e9%81%93%e7%9a%84%e5%89%8d%e7%ab%af%e7%ae%97%e6%b3%95%e4%b9%8b%e6%96%87%e5%ad%97%e9%81%bf%e8%ae%a9"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">你不知道的前端算法之文字避让</h1><div class="meta"><div class="postdate"><time datetime="2018-12-18" itemprop="datePublished">2018-12-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e本文作者：TalkingData 可视化工程师李凤禄\x3cbr\x3e编辑：Aresn\x3c\/blockquote\x3e\n\x3cp\x3einMap 是一款基于 canvas 的大数据可视化库，专注于大数据方向点线面的可视化效果展示。目前支持散点、围栏、热力、网格、聚合等方式；致力于让大数据可视化变得简单易用。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eGitHub 地址：\x3ca href=\x22https:\/\/github.com\/TalkingData\/inmap\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/TalkingData\/inmap\x3c\/a\x3e\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e文档地址：\x3ca href=\x22http:\/\/inmap.talkingdata.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/inmap.talkingdata.com\/\x3c\/a\x3e\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e在地理信息可视化中，我们经常会遇到在地图上标记文字的需求，下面展示的是某流行 chart 图表框架的效果：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV1Mq7?w=1374\x26amp;h=1140\x22 src=\x22https:\/\/static.alili.tech\/img\/bV1Mq7?w=1374\x26amp;h=1140\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e要显示的文字空间不够时，就会造成文字重叠显示混乱，用户体验很不友好。\x3c\/p\x3e\n\x3cp\x3e怎么解决这个问题呢？我们采用文字避让算法，解决这种坑爹的问题。\x3c\/p\x3e\n\x3cp\x3e下面展示的是 inMap 文字避让效果：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012777734?w=1596\x26amp;h=1434\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012777734?w=1596\x26amp;h=1434\x22 alt=\x22image\x22 title=\x22image\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e文字标注算法是 GIS 中最复杂的问题之一（属于 NP 复杂度问题，所以通常不能找到最优解，只能找到较优解）。\x3c\/p\x3e\n\x3cp\x3einMap 避让算法采用的是四分位模型算法，接下来手把手教你写避让算法，老司机带你装逼带你飞。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e准备数据\x3c\/h2\x3e\n\x3cp\x3einMap 接收的是经纬度数据，需要把它映射到 canvas 的像素坐标，这就用到了墨卡托转换，墨卡托算法很复杂，以后我们会有单独的一篇文章来讲讲他的原理。经过转换，你得到的数据应该是这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[\n  {\n    \x26quot;name\x26quot;: \x26quot;海门\x26quot;,\/\/要显示的文字\n    \x26quot;lng\x26quot;: 121.15,\n    \x26quot;lat\x26quot;: 31.89,\n    \x26quot;count\x26quot;: 7,\n    \x26quot;pixel\x26quot;: { \/\/像素坐标\n      \x26quot;x\x26quot;: 968,\n      \x26quot;y\x26quot;: 736\n    }\n  },\n  {\n    \x26quot;name\x26quot;: \x26quot;鄂尔多斯\x26quot;,\n    \x26quot;lng\x26quot;: 109.781327,\n    \x26quot;lat\x26quot;: 39.608266,\n    \x26quot;count\x26quot;: 5,\n    \x26quot;pixel\x26quot;: {\n      \x26quot;x\x26quot;: 659,\n      \x26quot;y\x26quot;: 478\n    }\n  },\n...\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clojure\x22\x3e\x3ccode\x3e[\n  {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22海门\x22\x3c\/span\x3e,\/\/要显示的文字\n    \x3cspan class=\x22hljs-string\x22\x3e\x22lng\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e121.15\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22lat\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e31.89\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22count\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22pixel\x22\x3c\/span\x3e: { \/\/像素坐标\n      \x3cspan class=\x22hljs-string\x22\x3e\x22x\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e968\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22y\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e736\x3c\/span\x3e\n    }\n  },\n  {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22鄂尔多斯\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22lng\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e109.781327\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22lat\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e39.608266\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22count\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22pixel\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x22x\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e659\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x22y\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e478\x3c\/span\x3e\n    }\n  },\n...\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e好了，我们得到转换后的像素坐标数据(x、y)，就可以做下面的事情了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e求出每段文字矩形的实际大小\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3emeasureText()\x3c\/code\x3e 是 canvas 内置的方法，返回字体宽度的像素单位：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let ctx = this.container.getContext(\x272d\x27); \/\/ canvas 上下文\nlet width= ctx.measureText(name).width;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ctx = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.container.getContext(\x3cspan class=\x22hljs-string\x22\x3e\x272d\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ canvas 上下文\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e width= ctx.measureText(name).width;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们通过 measureText 得到每个文字的宽度，canvas 并没有直接获取文字的方法，那文字的高度如何的得到呢？\x3c\/p\x3e\n\x3cp\x3e我们通过反复测试发现 canvas 的 font 等于 “13px Arial” 字体（别的字体不敢保证）的时候，文字的高度大概是 fontSize 的 1.1 倍。\x3c\/p\x3e\n\x3cp\x3e所以代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let fontSize = parseInt(ctx.font);\nlet height = fontSize * 1.1;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e fontSize = \x3cspan class=\x22hljs-built_in\x22\x3eparseInt\x3c\/span\x3e(ctx.font);\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e height = fontSize * \x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e文字的宽度和高度得到后，我们就可以创建文字矩形的坐标系了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e创建四分位模型\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012777735?w=503\x26amp;h=329\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012777735?w=503\x26amp;h=329\x22 alt=\x22image\x22 title=\x22image\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e所谓四分位模型，每一个标记点都有上下左右四个放文字的位子，如果左边放不下，那就放右边试试，还不行就放到下面试试，以此类推，原理就这么简单，哈哈。\x3c\/p\x3e\n\x3cp\x3e创建右侧虚拟矩形坐标描述：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012777736?w=441\x26amp;h=250\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012777736?w=441\x26amp;h=250\x22 alt=\x22image\x22 title=\x22image\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e右侧虚拟矩形坐标的描述把圆点也包含在内了，是为了防止文字和圆点重叠。\x3c\/p\x3e\n\x3cp\x3e在计算虚拟矩形的高度时有些坑，圆点大小不是固定的，是根据用户动态配置的，圆点的直径可能大于文字的高度，我们就设定虚拟矩形的高度永远都是最大的那个，需要做一些特殊处理。\x3c\/p\x3e\n\x3cp\x3e代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22_getLeftAnchor() {\n    let x = this.center.x - this.radius - this.textReact.width,\n        y = this.center.y - this.textReact.height \/ 2,\n        diam = this.radius * 2,\n        maxH = diam \x3e this.textReact.height ? diam : this.textReact.height; \/\/矩形的高度\n    return {\n        x,\n        y,\n        minX: x,\n        maxX: this.center.x \x2b this.radius,\n        minY: this.center.y - maxH \/ 2,\n        maxY: this.center.y \x2b maxH \/ 2\n    };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e_getLeftAnchor() {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e x = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.center.x - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.radius - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.textReact.width,\n        y = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.center.y - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.textReact.height \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\n        diam = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.radius * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\n        maxH = diam \x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.textReact.height ? diam : \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.textReact.height; \x3cspan class=\x22hljs-comment\x22\x3e\/\/矩形的高度\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        x,\n        y,\n        \x3cspan class=\x22hljs-attr\x22\x3eminX\x3c\/span\x3e: x,\n        \x3cspan class=\x22hljs-attr\x22\x3emaxX\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.center.x \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.radius,\n        \x3cspan class=\x22hljs-attr\x22\x3eminY\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.center.y - maxH \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3emaxY\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.center.y \x2b maxH \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n    };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以此类推，描述下面、左面、上面的虚拟矩形坐标。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e判断碰撞\x3c\/h2\x3e\n\x3cp\x3e判断两个矩形是否覆盖相交，根据矩形的 minX,maxX,minY,maxY 判断相交，原理比较简单，代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 判断分位是否相交\n * @param {*} target \n *\/\n \nisAnchorMeet(target) {\n    let react = this.getCurrentRect(),\n        targetReact = target.getCurrentRect();\n    if ((react.minX \x3c targetReact.maxX) \x26amp;\x26amp; (targetReact.minX \x3c react.maxX) \x26amp;\x26amp;\n        (react.minY \x3c targetReact.maxY) \x26amp;\x26amp; (targetReact.minY \x3c react.maxY)) {\n        return true;\n    }\n    return false;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 判断分位是否相交\n * @param {*} target \n *\/\x3c\/span\x3e\n \nisAnchorMeet(target) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e react = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getCurrentRect(),\n        targetReact = target.getCurrentRect();\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((react.minX \x26lt; targetReact.maxX) \x26amp;\x26amp; (targetReact.minX \x26lt; react.maxX) \x26amp;\x26amp;\n        (react.minY \x26lt; targetReact.maxY) \x26amp;\x26amp; (targetReact.minY \x26lt; react.maxY)) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e创建虚拟文字集合对象\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let labels = pixels.map((val) =\x3e {\n    let radius = val.pixel.radius \x2b this.style.normal.borderWidth; \/\/圆点半径\n    return new Label(val.pixel.x, val.pixel.y, radius, fontSize, byteWidth, val.name);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e labels = pixels.map(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eval\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e radius = val.pixel.radius \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.style.normal.borderWidth; \x3cspan class=\x22hljs-comment\x22\x3e\/\/圆点半径\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Label(val.pixel.x, val.pixel.y, radius, fontSize, byteWidth, val.name);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e递归遍历虚拟文字集合、判断是否与其他相交，如果有相交就移动当前文字位子，直到不相交为止。当找不到合适位置时，就选择隐藏当前文字。\x3c\/p\x3e\n\x3cp\x3e代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22do {\n    var meet = false; \/\/本轮是否有相交\n    for (let i = 0; i \x3c labels.length; i\x2b\x2b) {\n        let temp = labels[i];\n        for (let j = 0; j \x3c labels.length; j\x2b\x2b) {\n            if (i != j \x26amp;\x26amp; temp.show \x26amp;\x26amp; temp.isAnchorMeet(labels[j])) {\n                temp.next();\n                meet = true;\n                break;\n            }\n        }\n    }\n} while (meet);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3edo\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e meet = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/本轮是否有相交\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; labels.length; i\x2b\x2b) {\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e temp = labels[i];\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e j = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; j \x26lt; labels.length; j\x2b\x2b) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (i != j \x26amp;\x26amp; temp.show \x26amp;\x26amp; temp.isAnchorMeet(labels[j])) {\n                temp.next();\n                meet = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n            }\n        }\n    }\n} \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (meet);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e绘画文字\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22labels.forEach(function (item) {\n    if (item.show) { \/\/是否显示\n        let pixel = item.getCurrentRect();\n        ctx.beginPath();\n        ctx.fillText(item.text, pixel.x, pixel.y);\n        ctx.fill();\n    }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3elabels.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (item.show) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/是否显示\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e pixel = item.getCurrentRect();\n        ctx.beginPath();\n        ctx.fillText(item.text, pixel.x, pixel.y);\n        ctx.fill();\n    }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e文字避让算法到目前介绍完了，对应的 inMap 文件地址为\x3ca href=\x22https:\/\/github.com\/TalkingData\/inmap\/blob\/master\/src\/worker\/helper\/Label.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/TalkingData\/inmap\/blob\/master\/src\/worker\/helper\/Label.js\x3c\/a\x3e，接下来还会继续给大家分享干货。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e福利\x3c\/h2\x3e\n\x3cp\x3e分享两位业内大牛的前端课程:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eAresn 大神，开源了很优秀的前端 UI 组件库 iView，出版了《Vue.js实战》一书。向大家推荐他的课程，\x3ca href=\x22https:\/\/segmentfault.com\/ls\/1650000011074057?c=173cafa9cb567d9fbd57049a7b0e1c3d\x22\x3eVue.js实战系列教程，从本链接过去的打八折优惠，先到先得。\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3eChaos WebGL 专家，擅长 web 3D 开发。 主要有被\x3ca href=\x22https:\/\/segmentfault.com\/ls\/1650000011368036\x22 target=\x22_blank\x22\x3e《玩坏的地球系列课程》\x3c\/a\x3e，很适合初学者。\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>你不知道的前端算法之文字避让</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012777727">https://segmentfault.com/a/1190000012777727</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/xybrssyaidr/" target="_blank">https://alili.tech/archive/xybrssyaidr/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>