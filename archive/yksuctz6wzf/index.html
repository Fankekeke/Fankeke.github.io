<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="从零开始构建react应用（六）同构之样式直出"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>从零开始构建react应用（六）同构之样式直出 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/yksuctz6wzf/",
				"appid": "1613049289050283", 
				"title": "从零开始构建react应用（六）同构之样式直出 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-26T02:30:14"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/wt1engtoija/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/wazkq3ymrcg/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fyksuctz6wzf%2f&text=%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%bareact%e5%ba%94%e7%94%a8%ef%bc%88%e5%85%ad%ef%bc%89%e5%90%8c%e6%9e%84%e4%b9%8b%e6%a0%b7%e5%bc%8f%e7%9b%b4%e5%87%ba"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fyksuctz6wzf%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fyksuctz6wzf%2f&text=%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%bareact%e5%ba%94%e7%94%a8%ef%bc%88%e5%85%ad%ef%bc%89%e5%90%8c%e6%9e%84%e4%b9%8b%e6%a0%b7%e5%bc%8f%e7%9b%b4%e5%87%ba"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fyksuctz6wzf%2f&title=%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%bareact%e5%ba%94%e7%94%a8%ef%bc%88%e5%85%ad%ef%bc%89%e5%90%8c%e6%9e%84%e4%b9%8b%e6%a0%b7%e5%bc%8f%e7%9b%b4%e5%87%ba"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fyksuctz6wzf%2f&is_video=false&description=%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%bareact%e5%ba%94%e7%94%a8%ef%bc%88%e5%85%ad%ef%bc%89%e5%90%8c%e6%9e%84%e4%b9%8b%e6%a0%b7%e5%bc%8f%e7%9b%b4%e5%87%ba"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%bareact%e5%ba%94%e7%94%a8%ef%bc%88%e5%85%ad%ef%bc%89%e5%90%8c%e6%9e%84%e4%b9%8b%e6%a0%b7%e5%bc%8f%e7%9b%b4%e5%87%ba&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fyksuctz6wzf%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fyksuctz6wzf%2f&title=%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%bareact%e5%ba%94%e7%94%a8%ef%bc%88%e5%85%ad%ef%bc%89%e5%90%8c%e6%9e%84%e4%b9%8b%e6%a0%b7%e5%bc%8f%e7%9b%b4%e5%87%ba"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fyksuctz6wzf%2f&title=%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%bareact%e5%ba%94%e7%94%a8%ef%bc%88%e5%85%ad%ef%bc%89%e5%90%8c%e6%9e%84%e4%b9%8b%e6%a0%b7%e5%bc%8f%e7%9b%b4%e5%87%ba"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fyksuctz6wzf%2f&title=%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%bareact%e5%ba%94%e7%94%a8%ef%bc%88%e5%85%ad%ef%bc%89%e5%90%8c%e6%9e%84%e4%b9%8b%e6%a0%b7%e5%bc%8f%e7%9b%b4%e5%87%ba"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fyksuctz6wzf%2f&title=%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%bareact%e5%ba%94%e7%94%a8%ef%bc%88%e5%85%ad%ef%bc%89%e5%90%8c%e6%9e%84%e4%b9%8b%e6%a0%b7%e5%bc%8f%e7%9b%b4%e5%87%ba"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">从零开始构建react应用（六）同构之样式直出</h1><div class="meta"><div class="postdate"><time datetime="2018-12-26" itemprop="datePublished">2018-12-26</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e前言\x3c\/h1\x3e\n\x3cp\x3e上文讲到通过同构服务端渲染，可以直出html结构，虽然讲解了样式，图片等静态资源在服务端引入问题的解决方案，但是并没有实际进行相关操作，这篇文章就讲解一下如何让样式像html一样直出。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ePS: 直出，我的理解就是输入url发起get请求访问服务端，直接得到完整响应结果，而不是同过ajax异步去获取。\x3c\/code\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e加入样式文件\x3c\/h1\x3e\n\x3cp\x3e目前我们的项目中还不存在任何样式文件，所以需要先写一个，就给组件App写一个样式文件吧。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e安装依赖\x3c\/h2\x3e\n\x3cp\x3e下面这些依赖都是后续会用到的，先安装一下，下面会详细讲解每个依赖的作用。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm install postcss-loader postcss-import postcss-cssnext postcss-nested postcss-functions css-loader style-loader isomorphic-style-loader --save-dev\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sql\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpm \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e postcss-loader postcss-\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e postcss-cssnext postcss-\x3cspan class=\x22hljs-keyword\x22\x3enested\x3c\/span\x3e postcss-functions css-loader \x3cspan class=\x22hljs-keyword\x22\x3estyle\x3c\/span\x3e-loader isomorphic-\x3cspan class=\x22hljs-keyword\x22\x3estyle\x3c\/span\x3e-loader \x3cspan class=\x22hljs-comment\x22\x3e--save-dev\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e创建.pcss文件\x3c\/h2\x3e\n\x3cp\x3ecss文件的后缀是.css，less文件的后缀是.less，这里我选择使用PostCSS配合其插件来写样式，所以我就自己定义一个后缀.pcss好了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/client\/component\/app\/style.pcss\n\n.root {\n  color: red;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/client\/component\/app\/style.pcss\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.root\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3ecolor\x3c\/span\x3e: red;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e设定一个root类，样式就是简单的设置颜色为红色。然后在App组件里引用它。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/client\/component\/app\/index.tsx\n\n...\nimport * as styles from \x27.\/style.pcss\x27;\n...\n  public render() {\n    return (\n      \x3cdiv className={styles.root}\x3ehello world\x3c\/div\x3e\n    );\n  }\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/client\/component\/app\/index.tsx\x3c\/span\x3e\n\n...\nimport * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e styles \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/style.pcss\x27\x3c\/span\x3e;\n...\n  public render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{styles.root}\x3c\/span\x3e\x26gt;\x3c\/span\x3ehello world\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    );\n  }\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个时候你会发现编辑器里是这样的：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXQZ9?w=1068\x26amp;h=150\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXQZ9?w=1068\x26amp;h=150\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e出现这个问题是因为ts不知道这种模块的类型定义，所以我们需要手动加入自定义模块类型定义。在项目根目录下新建@types文件夹，在此目录下建立index.d.ts文件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/@types\/index.d.ts\n\ndeclare module \x27*.pcss\x27 {\n  const content: any;\n  export = content;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/@types\/index.d.ts\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3edeclare\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3emodule\x3c\/span\x3e \x27*.pcss\x27 {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e content: \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e = content;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e保存之后就不会看到编辑器报错了，但是terminal里webpack打包会提示出错，因为我们还没有加对应的loader。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e配置.pcss文件的解析规则\x3c\/h2\x3e\n\x3cp\x3ejs都组件化了，css模块化也是很有必要的，不用再为避免取重复类名而烦恼。我们在base配置里新导出一个方法用以获取postcss的规则。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/webpack\/base.ts\n\n...\nexport const getPostCssRule = (styleLoader) =\x3e ({\n  test: \/\\.pcss$\/,\n  use: [\n    styleLoader,\n    {\n      loader: \x27css-loader\x27,\n      options: {\n        camelCase: true,\n        importLoaders: 1,\n        localIdentName: \x27[path][name]---[local]---[hash:base64:5]\x27,\n        modules: true,\n      },\n    },\n    {\n      loader: \x27postcss-loader\x27,\n      options: {\n        plugins: () =\x3e [\n          require(\x27postcss-import\x27)({\n            path: path.join(baseDir, \x27.\/src\/client\/style\x27),\n          }),\n          require(\x27postcss-cssnext\x27),\n          require(\x27postcss-nested\x27),\n          require(\x27postcss-functions\x27)({\n            functions: {\n              x2(v, u) {\n                return v * 2 \x2b (u ? u : \x27px\x27);\n              },\n            },\n          }),\n        ],\n      },\n    },\n  ],\n});\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/webpack\/base.ts\x3c\/span\x3e\n\n...\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e getPostCssRule = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3estyleLoader\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e ({\n  test: \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.pcss$\/\x3c\/span\x3e,\n  use: [\n    styleLoader,\n    {\n      loader: \x3cspan class=\x22hljs-string\x22\x3e\x27css-loader\x27\x3c\/span\x3e,\n      options: {\n        camelCase: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        importLoaders: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n        localIdentName: \x3cspan class=\x22hljs-string\x22\x3e\x27[path][name]---[local]---[hash:base64:5]\x27\x3c\/span\x3e,\n        modules: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n      },\n    },\n    {\n      loader: \x3cspan class=\x22hljs-string\x22\x3e\x27postcss-loader\x27\x3c\/span\x3e,\n      options: {\n        plugins: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e [\n          \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27postcss-import\x27\x3c\/span\x3e)({\n            path: path.join(baseDir, \x3cspan class=\x22hljs-string\x22\x3e\x27.\/src\/client\/style\x27\x3c\/span\x3e),\n          }),\n          \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27postcss-cssnext\x27\x3c\/span\x3e),\n          \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27postcss-nested\x27\x3c\/span\x3e),\n          \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27postcss-functions\x27\x3c\/span\x3e)({\n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3es\x3c\/span\x3e: \x3c\/span\x3e{\n              x2(v, u) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e v * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e \x2b (u ? u : \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e);\n              },\n            },\n          }),\n        ],\n      },\n    },\n  ],\n});\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们可以从上面这个方法看到，要处理\x3ccode\x3e.pcss\x3c\/code\x3e文件需要用到三个loader，按处理顺序从下往上分别是postcss-loader， css-loader， 还有一个变量styleLoader，至于这个变量是什么，我们可以看使用到该方法的地方：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/webpack\/client.ts\n\n...\n(clientDevConfig.module as webpack.NewModule).rules.push(\n  ...\n  getPostCssRule({\n    loader: \x27style-loader\x27,\n  }),\n  ...\n);\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/webpack\/client.ts\x3c\/span\x3e\n\n...\n(clientDevConfig.\x3cspan class=\x22hljs-keyword\x22\x3emodule\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e webpack.NewModule).rules.push(\n  ...\n  getPostCssRule({\n    loader: \x3cspan class=\x22hljs-string\x22\x3e\x27style-loader\x27\x3c\/span\x3e,\n  }),\n  ...\n);\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/webpack\/server.ts\n\n...\n(clientDevConfig.module as webpack.NewModule).rules.push(\n  ...\n  getPostCssRule({\n    loader: \x27isomorphic-style-loader\x27,\n  }),\n  ...\n);\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/webpack\/server.ts\x3c\/span\x3e\n\n...\n(clientDevConfig.\x3cspan class=\x22hljs-keyword\x22\x3emodule\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e webpack.NewModule).rules.push(\n  ...\n  getPostCssRule({\n    loader: \x3cspan class=\x22hljs-string\x22\x3e\x27isomorphic-style-loader\x27\x3c\/span\x3e,\n  }),\n  ...\n);\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e客户端和服务端处理样式文件需要使用到不同的styleLoader。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3ePostCSS简介\x3c\/h2\x3e\n\x3cp\x3ePostCSS是一个使用js来转换css的工具，这个是官方介绍。其配合webpack使用的loader就是postcss-loader，但是只有单个postcss-loader其实没有什么用，需要配合其插件来实现强大的功能。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3epostcss-import\x3cbr\x3e这个插件我这里使用的原因是为了在样式文件中@import时避免复杂的路径编写，我设定好path值，那么我在其它任何层级下的样式文件中要引入path对应文件夹里的公共变量样式文件(假设叫\x22variables.pcss\x22)时就非常方便，只需要写import \x27variables.pcss\x27;就可以了，当然如果找不到对应的文件，它会忽略path使用默认相对路径来查找。\x3c\/li\x3e\n\x3cli\x3epostcss-cssnext\x3cbr\x3e这个插件可以使用下一代css语法。\x3c\/li\x3e\n\x3cli\x3epostcss-nested\x3cbr\x3e这个插件可以嵌套编写样式。\x3c\/li\x3e\n\x3cli\x3epostcss-functions\x3cbr\x3e这个插件可以自定义函数，并在样式文件中调用。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e讲这么多，写代码举个栗子吧～\x3cbr\x3e我们在client目录下新增style文件夹，用于存放一些样式reset，变量文件之类的东西。然后创建两个pcss文件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/client\/style\/variables.pcss\n\n:root {\n  --fontSizeValue: 16;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs awk\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e .\x3cspan class=\x22hljs-regexp\x22\x3e\/src\/\x3c\/span\x3eclient\x3cspan class=\x22hljs-regexp\x22\x3e\/style\/\x3c\/span\x3evariables.pcss\n\n:root {\n  --fontSizeValue: \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/client\/style\/index.pcss\n\n@import \x27variables.pcss\x27;\n\nbody {\n  margin: 0;\n  font-size: x2(var(--fontSizeValue));\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scss\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/client\/style\/index.pcss\x3c\/span\x3e\n\n@\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27variables.pcss\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3efont-size\x3c\/span\x3e: x2(var(--fontSizeValue));\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e引入我们刚写的index.pcss\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/client\/index.tsx\n...\nimport \x27.\/style\/index.pcss\x27;\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/client\/index.tsx\x3c\/span\x3e\n...\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/style\/index.pcss\x27\x3c\/span\x3e;\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3eCSS Modules简介\x3c\/h2\x3e\n\x3cp\x3e简单来说就是css模块化，不用再担心全局类名的问题。我们根据上述css-loader的options来看：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3ecamelCase为true运行使用驼峰写法来写类名\x3c\/li\x3e\n\x3cli\x3eimportLoaders的值为N是因为在css-loader之前有N个loader已经处理过文件了，这里的N值是1，因为之前有一个postcss-loader，这个值一定要设置对，否则会影响@import语句，我的这个表述可能不是太正确，详细可参见\x3ca href=\x22https:\/\/github.com\/webpack-contrib\/css-loader\/issues\/228\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eClarify importLoaders documentation？\x3c\/a\x3e这个地方详细讲解了，我翻译一下大概意思是，这个属性的值N代表的是对于@import的文件要经过css-loader后面的N个loader的处理，英文不太好，大家可以自行理解。\x3c\/li\x3e\n\x3cli\x3elocalIdentName这个就是指生成的类名啦，具体看后续结果截图就一目了然了。\x3c\/li\x3e\n\x3cli\x3emodules为true即启用模块化\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3eisomorphic-style-loader\x3c\/h2\x3e\n\x3cp\x3e在客户端，使用style-loader，它会动态的往dom里插入style元素，而服务端由于缺少客户端的相关对象及API，所以需要isomorphic-style-loader，目前用到它只是为了避免报错哈哈，后续还有大作用，样式直出全靠它。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e打包运行\x3c\/h2\x3e\n\x3cp\x3e注意：打包运行之前不要忘了给tsconfig.client.json和tsconfig.server.json引入我们的自定义模块定义文件index.d.ts，不然webpack编译就会报找不到pcss这种模块啦。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/webpack\/tsconfig.client(server).json\n...\n\x26quot;include\x26quot;: [\n    ...\n    \x26quot;..\/..\/@types\/**\/*\x26quot;,\n    ...\n]\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/webpack\/tsconfig.client(server).json\x3c\/span\x3e\n...\n\x3cspan class=\x22hljs-string\x22\x3e\x22include\x22\x3c\/span\x3e: [\n    ...\n    \x3cspan class=\x22hljs-string\x22\x3e\x22..\/..\/@types\/**\/*\x22\x3c\/span\x3e,\n    ...\n]\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e运行结果如下：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXSov?w=1758\x26amp;h=634\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXSov?w=1758\x26amp;h=634\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e虽然style元素已经存在，但是这个是由style-loader生成的，并不是服务端直出的，看page source就知道了。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXSpf?w=1978\x26amp;h=392\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXSpf?w=1978\x26amp;h=392\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e而且在刷新页面的时候能很明显的看到样式变化闪烁的效果。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader9\x22\x3e直出样式\x3c\/h1\x3e\n\x3cp\x3e我们利用isomorphic-style-loader来实现服务端直出样式，原理的话根据官方介绍就是利用了react的context api来实现，在服务端渲染的过程中，利用注入的insertCss方法和高阶组件（hoc high-order component）来获取样式代码。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e安装依赖\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm install prop-types --save-dev\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs applescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpm install \x3cspan class=\x22hljs-keyword\x22\x3eprop\x3c\/span\x3e-types \x3cspan class=\x22hljs-comment\x22\x3e--save-dev\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e改写App组件\x3c\/h2\x3e\n\x3cp\x3e根据其官方介绍，我们在不使用其整合完毕的isomorphic router的情况下，需要写一个Provider给App组件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/client\/component\/app\/provider.tsx\n\nimport * as React from \x27react\x27;\n\nimport * as PropTypes from \x27prop-types\x27;\n\nclass AppProvider extends React.PureComponent\x3cany, any\x3e {\n  public static propTypes = {\n    context: PropTypes.object,\n  };\n\n  public static defaultProps = {\n    context: {\n      insertCss: () =\x3e \x27\x27,\n    },\n  };\n\n  public static childContextTypes = {\n    insertCss: PropTypes.func.isRequired,\n  };\n\n  public getChildContext() {\n    return this.props.context;\n  }\n\n  public render() {\n    return this.props.children || null;\n  }\n}\n\nexport default AppProvider;\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/client\/component\/app\/provider.tsx\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e PropTypes \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27prop-types\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e AppProvider \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e React.PureComponent\x26lt;\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e propTypes = {\n    context: PropTypes.object,\n  };\n\n  \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e defaultProps = {\n    context: {\n      insertCss: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n    },\n  };\n\n  \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e childContextTypes = {\n    insertCss: PropTypes.func.isRequired,\n  };\n\n  \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e getChildContext() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.context;\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3epublic\x3c\/span\x3e render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.children || \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e AppProvider;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e将原App组件里的具体内容迁移到AppContent组件里去：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/client\/component\/app\/content.tsx\n\nimport * as React from \x27react\x27;\n\nimport * as styles from \x27.\/style.pcss\x27;\n\n\/* tslint:disable-next-line no-submodule-imports *\/\nimport withStyles from \x27isomorphic-style-loader\/lib\/withStyles\x27;\n\n@withStyles(styles)\nclass AppContent extends React.PureComponent {\n  public render() {\n    return (\n      \x3cdiv className={styles.root}\x3ehello world\x3c\/div\x3e\n    );\n  }\n}\n\nexport default AppContent;\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/client\/component\/app\/content.tsx\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e styles \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/style.pcss\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* tslint:disable-next-line no-submodule-imports *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e withStyles \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27isomorphic-style-loader\/lib\/withStyles\x27\x3c\/span\x3e;\n\n@withStyles(styles)\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eAppContent\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3ePureComponent\x3c\/span\x3e \x3c\/span\x3e{\n  public render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{styles.root}\x3c\/span\x3e\x26gt;\x3c\/span\x3ehello world\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    );\n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e AppContent;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e新的App组件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/client\/component\/app\/index.tsx\n\nimport * as React from \x27react\x27;\n\nimport AppProvider from \x27.\/provider\x27;\n\nimport AppContent from \x27.\/content\x27;\n\nclass App extends React.PureComponent {\n  public render() {\n    return (\n      \x3cAppProvider\x3e\n        \x3cAppContent \/\x3e\n      \x3c\/AppProvider\x3e\n    );\n  }\n}\n\nexport default App;\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/client\/component\/app\/index.tsx\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e AppProvider \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/provider\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e AppContent \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/content\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3ePureComponent\x3c\/span\x3e \x3c\/span\x3e{\n  public render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eAppProvider\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eAppContent\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eAppProvider\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    );\n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e App;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e\x3ccode\x3e疑问一：AppProvider组件是做什么的？\x3c\/code\x3e\x3c\/h3\x3e\n\x3cp\x3e答：Provider的意思是\x3ccode\x3e供应者，提供者\x3c\/code\x3e。顾名思义，AppProvider为其后代组件提供了一些东西，这个东西就是context，它有一个insertCss方法。根据其定义，该方法拥有默认值，返回空字符串的函数，即默认没什么作用，但是可以通过props传入context来达到自定义的目的。通过设定childContextTypes和getChildContext，该组件后代凡是设定了contextTypes的组件都会拥有this.context对象，而这个对象正是getChildContext的返回值。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e\x3ccode\x3e疑问二：AppContent为何要独立出去？\x3c\/code\x3e\x3c\/h3\x3e\n\x3cp\x3e答：接上一疑问，AppProvider组件render其子组件，而要使得context这个api生效，其子组件必须是定义了contextTypes的，但是我们并没有看见AppContent有这个定义，这个是因为这个定义在高阶组件withStyles里面（参见其\x3ca href=\x22https:\/\/github.com\/kriasoft\/isomorphic-style-loader\/blob\/master\/src\/withStyles.js#L14-L16\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e源码\x3c\/a\x3e）。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e\x3ccode\x3e疑问三：@withStyles是什么语法？\x3c\/code\x3e\x3c\/h3\x3e\n\x3cp\x3e答：这个是装饰器，属于es7，具体概念内容可参见\x3ca href=\x22http:\/\/www.liuhaihua.cn\/archives\/115548.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eDecorators in ES7\x3c\/a\x3e。使用该语法，需要配置tsconfig:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/tsconfig.json\n\/\/ .\/src\/webpack\/tsconfig.client(server).json\n\n{\n  ...\n  \x26quot;compilerOptions\x26quot;: {\n    ...\n    \x26quot;experimentalDecorators\x26quot;: true,\n    ...\n  },\n  ...\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lasso\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/tsconfig.json\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/webpack\/tsconfig.client(server).json\x3c\/span\x3e\n\n{\n  \x3cspan class=\x22hljs-params\x22\x3e...\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22compilerOptions\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-params\x22\x3e...\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x22experimentalDecorators\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-params\x22\x3e...\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-params\x22\x3e...\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader15\x22\x3e改写服务端bundle文件\x3c\/h2\x3e\n\x3cp\x3e由于App组件的改写，服务端不能再复用该组件，但是AppProvider和AppContent目前还是可以复用的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/server\/bundle.tsx\n\nimport * as React from \x27react\x27;\n\n\/* tslint:disable-next-line no-submodule-imports *\/\nimport { renderToString } from \x27react-dom\/server\x27;\n\nimport AppProvider from \x27..\/client\/component\/app\/provider\x27;\n\nimport AppContent from \x27..\/client\/component\/app\/content\x27;\n\nexport default {\n  render() {\n    const css = [];\n    const context = { insertCss: (...styles) =\x3e styles.forEach((s) =\x3e css.push(s._getCss())) };\n    const html = renderToString(\n      \x3cAppProvider context={context}\x3e\n        \x3cAppContent \/\x3e\n      \x3c\/AppProvider\x3e,\n    );\n    const style = css.join(\x27\x27);\n    return {\n      html,\n      style,\n    };\n  },\n};\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/server\/bundle.tsx\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* tslint:disable-next-line no-submodule-imports *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { renderToString } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react-dom\/server\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e AppProvider \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/client\/component\/app\/provider\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e AppContent \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/client\/component\/app\/content\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e css = [];\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e context = { \x3cspan class=\x22hljs-attr\x22\x3einsertCss\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e...styles\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e styles.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3es\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e css.push(s._getCss())) };\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e html = renderToString(\n      \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eAppProvider\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtext\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{context}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eAppContent\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eAppProvider\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e,\n    );\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e style = css.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n      html,\n      style,\n    };\n  },\n};\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里我们传入了自定义的context对象，通过css这个变量来存储style信息。我们原先render函数直接返回renderToString的html字符串，而现在多了一个style，所以我们返回拥有html和style属性的对象。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3e\x3ccode\x3e疑问四：官方示例css是一个Set类型实例，这里怎么是一个数组类型实例？\x3c\/code\x3e\x3c\/h3\x3e\n\x3cp\x3e答：Set是es6中新的数据结构，类似数组，但可以保证无重复值，只有tsconfig的编译选项中的target为es6时，且加入es2017的lib时才不会报错，由于我们的target是es5，所以是数组，且使用数组并没有太大问题。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader17\x22\x3e处理服务端入口文件\x3c\/h2\x3e\n\x3cp\x3e由于bundle的render值变更，所以我们也要处理一下。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ .\/src\/server\/index.tsx\n\n...\nrouter.get(\x27\/*\x27, (ctx: Koa.Context, next) =\x3e { \/\/ 配置一个简单的get通配路由\n  const renderResult = bundle ? bundle.render() : {}; \/\/ 获得渲染出的结果对象\n  const { html = \x27\x27, style = \x27\x27 } = renderResult;\n  ...\n  ctx.body = `\n    ...\n    \x3chead\x3e\n      ...\n      ${style ? `\x3cstyle\x3e${style}\x3c\/style\x3e` : \x27\x27}\n      ...\n    \x3c\/head\x3e\n    ...\n  `;\n  ...\n});\n...\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ .\/src\/server\/index.tsx\x3c\/span\x3e\n\n...\nrouter.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/*\x27\x3c\/span\x3e, (ctx: Koa.Context, next) =\x26gt; { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 配置一个简单的get通配路由\x3c\/span\x3e\n  const renderResult = bundle ? bundle.render() : {}; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获得渲染出的结果对象\x3c\/span\x3e\n  const { html = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, style = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e } = renderResult;\n  ...\n  ctx.body = `\n    ...\n    \x26lt;head\x26gt;\n      ...\n      ${style ? `\x26lt;style\x26gt;${style}\x26lt;\/style\x26gt;` : \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e}\n      ...\n    \x26lt;\/head\x26gt;\n    ...\n  `;\n  ...\n});\n...\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader18\x22\x3e直出结果\x3c\/h2\x3e\n\x3cp\x3e样式直出后的page source：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVXZ8q?w=1974\x26amp;h=484\x22 src=\x22https:\/\/static.alili.tech\/img\/bVXZ8q?w=1974\x26amp;h=484\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader19\x22\x3e找回丢失的公共样式文件\x3c\/h2\x3e\n\x3cp\x3e从上面的直出结果来看，缺少.\/src\/style\/index.pcss这个样式代码，原因显而易见，它不属于任何一个组件，它是公共的，我们在客户端入口文件里引入了它。对于公共样式文件，服务端要直出这部分内容，可以这么做：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\/src\/server\/bundle.tsx\n\n...\nimport * as commonStyles from \x27..\/client\/style\/index.pcss\x27;\n...\nconst css = [commonStyles._getCss()];\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e.\/src\/server\/bundle.tsx\n\n...\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e commonStyles \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/client\/style\/index.pcss\x27\x3c\/span\x3e;\n...\nconst css = [commonStyles._getCss()];\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们利用isomorphic-style-loader提供的api可以得到这部分样式代码字符串。这样就可以得到完整的直出样式了。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader20\x22\x3eThanks\x3c\/h1\x3e\n\x3cp\x3eBy \x3ca href=\x22https:\/\/github.com\/devlee\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edevlee\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>从零开始构建react应用（六）同构之样式直出</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000011878570">https://segmentfault.com/a/1190000011878570</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/yksuctz6wzf/" target="_blank">https://alili.tech/archive/yksuctz6wzf/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>