<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="每周一点canvas动画——《支付宝价格拖动选择》"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>每周一点canvas动画——《支付宝价格拖动选择》 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/yrdj8qx49k/",
				"appid": "1613049289050283", 
				"title": "每周一点canvas动画——《支付宝价格拖动选择》 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-14T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/fva8fa69c4d/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/p0pk7ie4p3i/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fyrdj8qx49k%2f&text=%e6%af%8f%e5%91%a8%e4%b8%80%e7%82%b9canvas%e5%8a%a8%e7%94%bb%e2%80%94%e2%80%94%e3%80%8a%e6%94%af%e4%bb%98%e5%ae%9d%e4%bb%b7%e6%a0%bc%e6%8b%96%e5%8a%a8%e9%80%89%e6%8b%a9%e3%80%8b"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fyrdj8qx49k%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fyrdj8qx49k%2f&text=%e6%af%8f%e5%91%a8%e4%b8%80%e7%82%b9canvas%e5%8a%a8%e7%94%bb%e2%80%94%e2%80%94%e3%80%8a%e6%94%af%e4%bb%98%e5%ae%9d%e4%bb%b7%e6%a0%bc%e6%8b%96%e5%8a%a8%e9%80%89%e6%8b%a9%e3%80%8b"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fyrdj8qx49k%2f&title=%e6%af%8f%e5%91%a8%e4%b8%80%e7%82%b9canvas%e5%8a%a8%e7%94%bb%e2%80%94%e2%80%94%e3%80%8a%e6%94%af%e4%bb%98%e5%ae%9d%e4%bb%b7%e6%a0%bc%e6%8b%96%e5%8a%a8%e9%80%89%e6%8b%a9%e3%80%8b"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fyrdj8qx49k%2f&is_video=false&description=%e6%af%8f%e5%91%a8%e4%b8%80%e7%82%b9canvas%e5%8a%a8%e7%94%bb%e2%80%94%e2%80%94%e3%80%8a%e6%94%af%e4%bb%98%e5%ae%9d%e4%bb%b7%e6%a0%bc%e6%8b%96%e5%8a%a8%e9%80%89%e6%8b%a9%e3%80%8b"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%af%8f%e5%91%a8%e4%b8%80%e7%82%b9canvas%e5%8a%a8%e7%94%bb%e2%80%94%e2%80%94%e3%80%8a%e6%94%af%e4%bb%98%e5%ae%9d%e4%bb%b7%e6%a0%bc%e6%8b%96%e5%8a%a8%e9%80%89%e6%8b%a9%e3%80%8b&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fyrdj8qx49k%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fyrdj8qx49k%2f&title=%e6%af%8f%e5%91%a8%e4%b8%80%e7%82%b9canvas%e5%8a%a8%e7%94%bb%e2%80%94%e2%80%94%e3%80%8a%e6%94%af%e4%bb%98%e5%ae%9d%e4%bb%b7%e6%a0%bc%e6%8b%96%e5%8a%a8%e9%80%89%e6%8b%a9%e3%80%8b"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fyrdj8qx49k%2f&title=%e6%af%8f%e5%91%a8%e4%b8%80%e7%82%b9canvas%e5%8a%a8%e7%94%bb%e2%80%94%e2%80%94%e3%80%8a%e6%94%af%e4%bb%98%e5%ae%9d%e4%bb%b7%e6%a0%bc%e6%8b%96%e5%8a%a8%e9%80%89%e6%8b%a9%e3%80%8b"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fyrdj8qx49k%2f&title=%e6%af%8f%e5%91%a8%e4%b8%80%e7%82%b9canvas%e5%8a%a8%e7%94%bb%e2%80%94%e2%80%94%e3%80%8a%e6%94%af%e4%bb%98%e5%ae%9d%e4%bb%b7%e6%a0%bc%e6%8b%96%e5%8a%a8%e9%80%89%e6%8b%a9%e3%80%8b"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fyrdj8qx49k%2f&title=%e6%af%8f%e5%91%a8%e4%b8%80%e7%82%b9canvas%e5%8a%a8%e7%94%bb%e2%80%94%e2%80%94%e3%80%8a%e6%94%af%e4%bb%98%e5%ae%9d%e4%bb%b7%e6%a0%bc%e6%8b%96%e5%8a%a8%e9%80%89%e6%8b%a9%e3%80%8b"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">每周一点canvas动画——《支付宝价格拖动选择》</h1><div class="meta"><div class="postdate"><time datetime="2018-12-14" itemprop="datePublished">2018-12-14</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/supperjet\/H5-Animation\/tree\/master\/%E6%94%AF%E4%BB%98%E5%AE%9D%E4%BB%B7%E6%A0%BC%E6%8B%96%E5%8A%A8\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e效果源码\x3c\/a\x3e \x3c\/p\x3e\n\x3cp\x3e终于到年底了，再过两天我也要回家过年了，想想就激动呢！今天给大家带来一个基于移动端的canvas价格选择效果。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3QGd?w=733\x26amp;h=352\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3QGd?w=733\x26amp;h=352\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e主要功能就是拖动标尺变动价格。而且支付宝和京东金融的里也有这样的效果（果然天下设计都是你抄我我抄你啊?）。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/codepen.io\/supperjet\/pen\/paPVeM\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e效果演示地址\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22supperjet\/pen\/paPVeM\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3c\/p\x3e\n\x3ch4\x3e1.实现思路\x3c\/h4\x3e\n\x3cp\x3e整个效果的核心就是用canvas绘制的标尺。一共包括标尺主体，数字，和中间固定不变的标定轴，这几个部分都用canvas绘制。最上面的大号价格文字，因为其他地方会需要用它来计算相关的收益。所以，我们就用个DOM来呈现，这样比较方便获取。\x3c\/p\x3e\n\x3cp\x3e标尺拖动的距离与价格之间有有一个映射关系，是整个效果最不好处理的部分，在具体处理到相关问题的时候我们再做分析。现在，我们先实现基础的标尺绘制。\x3c\/p\x3e\n\x3ch4\x3e2.标尺属性定义\x3c\/h4\x3e\n\x3cp\x3e我们先定义一个类叫\x3ccode\x3eRule.js\x3c\/code\x3e, 其具体属性如下。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Phw?w=785\x26amp;h=800\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Phw?w=785\x26amp;h=800\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e现在我们来了解一下每个属性的含义：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3ccode\x3ex, y\x3c\/code\x3e:  标尺的坐标位置\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3evx\x3c\/code\x3e: 标尺的移动速度\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eax\x3c\/code\x3e: 标尺移动加速度\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ecolor\x3c\/code\x3e: 绘制标尺线条的颜色，与文字颜色\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3escaleX, scaleY\x3c\/code\x3e: 缩放比\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3emarkShort, markLong\x3c\/code\x3e: 标尺长短线的长度\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3etextHeight\x3c\/code\x3e: 文字距离标尺主体的高度\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3emin, max\x3c\/code\x3e: 要展示的最大值和最小值\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3ewidth\x3c\/code\x3e: 标尺的像素宽度\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3estep\x3c\/code\x3e: 步长\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eseg\x3c\/code\x3e: 段数\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3epxStep\x3c\/code\x3e: 在canvas上的实际步长(单位为px)\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3eminPxStep\x3c\/code\x3e: 每个pxStep分10小段，每小段的实际像素宽度\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3elineBottom\x3c\/code\x3e: 底部横线参数\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3elineRed\x3c\/code\x3e: 标定轴参数\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e参数比较多，但真正需要传入的参数其实并不是很多。这里我讲解一下（8）~（15）这几个参数的思路。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3emin， max\x3c\/strong\x3e : 参数的作用是设置需要显示的最大金额和最小金额。这两个参数是外部传入的，比如设定用户最小能存100元，最大能存100000万元。那么min和max就分别对应100和100000。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3ewidth\x3c\/strong\x3e : 是整个标尺的实际屏幕长度，比如你只想标尺绘制1000px,那这里就传1000就好了。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3estep\x3c\/strong\x3e : 步长的含义就是每隔多少分一段，比如我们设定的最大金额为10000元， 那设置step为1000就意味着，每隔1000元表示一个小段，这也是canvas上标尺刻度需要绘制的数据。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eseg\x3c\/strong\x3e : 段数等于总金额max除以step。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3epxStep\x3c\/strong\x3e : 为真正映射到canvas上的像素步长。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eminiPxStep\x3c\/strong\x3e : 每个pxStep分为10小段，每小段的像素距离。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3elineBottom\x3c\/strong\x3e : 独立出来不和标尺刻度一起绘制，在绘制标尺的底部横线时，我是这样想的。底部横线的宽度其实就是canvas的宽度，没必要从标尺的初始画到标尺的结尾。而且为了用户体验，刻度的初始位置和结束位置都位于整个canvas的中心。所以，如果合在一起绘制，你需要先绘制一段没刻度的横线，然后再绘制刻度，到最后还要绘制一段没刻度的横线。这给无疑让绘制和后续的标尺移动变得相当麻烦。所以我把它抽出来，就是一条贯穿canvas的普通横线。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3elineRed\x3c\/strong\x3e : 标定轴，始终在canvas的中间，也独立出来不和标尺刻度一起绘制。\x3c\/p\x3e\n\x3cp\x3e属性都有了，下面添加一个draw方法，把我们的标尺绘制出来。\x3c\/p\x3e\n\x3ch4\x3e2.标尺绘制\x3c\/h4\x3e\n\x3cp\x3ea) 绘制标尺刻度部分\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3PhF?w=556\x26amp;h=664\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3PhF?w=556\x26amp;h=664\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e这里有个截图错误，应该是\x3ccode\x3ei\x2b=this.miniPxStep\x3c\/code\x3e。这应该不难理解，就是每隔\x3ccode\x3eminiPxStep\x3c\/code\x3e绘制一次线段，线段的类型根据\x3ccode\x3en\x3c\/code\x3e这个变量来确定。\x3c\/p\x3e\n\x3cp\x3eb) 绘制标尺文字部分\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3PhJ?w=799\x26amp;h=282\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3PhJ?w=799\x26amp;h=282\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e文字的绘制不能以真实的屏幕像素为准，必须映射到金额上，所以，这里绘制的数字是\x3ccode\x3e（n\/10）* this.step\x3c\/code\x3e。同时，还做了一个特殊的处理，就是初始值是1，不是0。因为，我们的金额不允许输入0元。如果你不需要这个，把这里注释掉就ok了。\x3c\/p\x3e\n\x3cp\x3ec) 绘制底部横线\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3PhK?w=800\x26amp;h=495\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3PhK?w=800\x26amp;h=495\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3ed) 绘制标定轴\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3PhM?w=552\x26amp;h=399\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3PhM?w=552\x26amp;h=399\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这样整个标尺就完成了，rule.js文件在顶部的github中。现在我们调用一下这个文件，看看画出来的效果怎样。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3PhO?w=534\x26amp;h=800\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3PhO?w=534\x26amp;h=800\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这里我们设置了最大额度为100000元，最小额度为500元。整个标尺的长度为5000px，步长step为1000元。效果图如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3PhQ?w=394\x26amp;h=118\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3PhQ?w=394\x26amp;h=118\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e让标尺偏移个200px, 比如设置: \x3ccode\x3ex: ruleX - 200\x3c\/code\x3e, 效果如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3PhS?w=392\x26amp;h=121\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3PhS?w=392\x26amp;h=121\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e设置步长step为500,效果如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3PhV?w=387\x26amp;h=115\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3PhV?w=387\x26amp;h=115\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eok，现在静态标尺就绘制完成，下一步就要完成交互功能，让标尺能够跟随鼠标滚动，并且展示当前拖动的金额。\x3c\/p\x3e\n\x3ch4\x3e3.拖动标尺\x3c\/h4\x3e\n\x3cp\x3e现在我们开始实现标尺的拖动。标尺的拖动原理很简单，就是让标尺的位置跟随鼠标移动。这里为了演示方便我换成了鼠标事件，到移动端换成touch事件即可。\x3c\/p\x3e\n\x3cp\x3e首先引入我们的工具函数\x3ccode\x3eutils.js\x3c\/code\x3e文件，然后定义几个变量。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3PhW?w=429\x26amp;h=195\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3PhW?w=429\x26amp;h=195\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eisMouseDown\x3c\/code\x3e用来判断鼠标是否抬起， \x3ccode\x3eoldX\x3c\/code\x3e用来记录上一次拖动的位置，\x3ccode\x3emouse\x3c\/code\x3e是使用\x3ccode\x3ecaptureMouse\x3c\/code\x3e返回的对象，返回鼠标在canvas上的当前位置信息。\x3c\/p\x3e\n\x3cp\x3e然后，监听canvas的鼠标事件\x3ccode\x3emousedown, mouseup, mousemove\x3c\/code\x3e。并改变rule的位置。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Ph0?w=678\x26amp;h=481\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Ph0?w=678\x26amp;h=481\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e当鼠标按下时，\x3ccode\x3eisMouseDown\x3c\/code\x3e变为true, \x3ccode\x3eoffsetX\x3c\/code\x3e在上面忘记写了，它的作用是记录鼠标按下的位置与标尺位置之间的偏移量。然后在鼠标移动时标尺的位置\x3ccode\x3erule.x = mouse.x - offsetX\x3c\/code\x3e。如果不这样做，在点击canvas并拖动标尺的一瞬间，你会发现标尺的初始位置会瞬移到鼠标点击位置，这样体验很不好，我们需要不管点击哪，标尺都会在现有的位置跟随鼠标移动。如果，无法体会，动手试一试去掉回事什么效果。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eoldX\x3c\/code\x3e也很好理解，就是记录标尺上一次的位置，这里还没有用到它，后面可能会用到。\x3cbr\x3e现在我们把标尺的绘制写进动画函数中\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Ph2?w=560\x26amp;h=240\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Ph2?w=560\x26amp;h=240\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e看看动画效果如何。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Ph4?w=392\x26amp;h=112\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Ph4?w=392\x26amp;h=112\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eok，现在我们已经实现了标尺跟随鼠标的拖动。下一步，我们就把拖动的金额显示出来。\x3c\/p\x3e\n\x3ch4\x3e4.金额显示\x3c\/h4\x3e\n\x3cp\x3e首先，增加一个\x3ccode\x3einput\x3c\/code\x3e输入框，然后获取它。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Ph6?w=359\x26amp;h=215\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Ph6?w=359\x26amp;h=215\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这里设置了输入框的最小值为标尺的最小额度，这里可以先不用管它。我们主要看\x3ccode\x3eonMouseMove\x3c\/code\x3e函数\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Pib?w=569\x26amp;h=235\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Pib?w=569\x26amp;h=235\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e注意\x3ccode\x3emoney\x3c\/code\x3e的计算值，它为\x3ccode\x3e(centerX - rule.x)*rule.ratioScale\x3c\/code\x3e。 \x3ccode\x3e(centerX - rule.x)\x3c\/code\x3e比较好理解，因为，我们的标尺是从canvas的中心点绘制的。但\x3ccode\x3erule.ratioScale\x3c\/code\x3e在最开始的构造函数中并没有定义。这里需要在构造函数中加上，它的含义是每像素代表多少钱，可以认为是图形比例尺。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.ratioScale = Math.floor(this.max \/ this.width) \/\/比列尺\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ratioScale = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.max \/ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.width) \x3cspan class=\x22hljs-comment\x22\x3e\/\/比列尺\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么自然，移动距离乘以比例尺就得出钱数了。我们看看效果。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Pic?w=392\x26amp;h=112\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Pic?w=392\x26amp;h=112\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e注意到上面的效果中金额显示出现了负数，所以我们需要对移动范围做限制。让其只能在限定的最大和最小金额之间移动。\x3c\/p\x3e\n\x3ch4\x3e5.移动范围限定\x3c\/h4\x3e\n\x3cp\x3e对一定范围的限定主要分为两部分。一、标尺范围的限定。二、金额显示的限定。这两部分我们放在一起做。\x3c\/p\x3e\n\x3cp\x3e1）重设标尺的初始位置\x3cbr\x3e假设我们设置的最小金额为500元，那么初始标定轴的位置应该就是500元的位置。所以初始化标尺的位置后，我们给它重置为最小金额的位置。这时候需要把金额换算一下。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22rule.x = centerX - rule.min \/ rule.ratioScale;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3erule\x3c\/span\x3e.x = centerX - \x3cspan class=\x22hljs-keyword\x22\x3erule\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3emin\x3c\/span\x3e \/ \x3cspan class=\x22hljs-keyword\x22\x3erule\x3c\/span\x3e.ratioScale;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e就是把金额值得计算倒一下。\x3c\/p\x3e\n\x3cp\x3e2）限定标尺的移动范围\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Pif?w=460\x26amp;h=351\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Pif?w=460\x26amp;h=351\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这里定义了一个检测边界值得函数，当金额小于最小投资金额时，标尺的位置为初始位置start(注意这个初始位置是已经被重置过的), 并且设置金额为最小额度。最大位置同理。\x3cbr\x3e然后，在\x3ccode\x3eonMouseMove\x3c\/code\x3e中调用。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Pii?w=612\x26amp;h=258\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Pii?w=612\x26amp;h=258\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e看看效果图。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Pij?w=392\x26amp;h=112\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Pij?w=392\x26amp;h=112\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3e6.输入金额移动标尺\x3c\/h4\x3e\n\x3cp\x3e标尺的移动除了拖动以外，我们也希望通过金额输入框来达到。即输入金额，标尺便移动到目标金额的位置。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Pil?w=626\x26amp;h=335\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Pil?w=626\x26amp;h=335\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e同时我们也做了边界限定，当输入的金额小于或者大于设定值时会，设置标尺的位置和输入框的显示为边界值，看看效果。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Pip?w=392\x26amp;h=112\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Pip?w=392\x26amp;h=112\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3e7.来个速度吧\x3c\/h4\x3e\n\x3cp\x3e现在拖动的还比较不自然，我们想要手指离开后标尺还会继续移动，直到速度慢慢减为0。为此，新建两个变量。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var speed = 0, fl = 0.95; \/\/初始速度， 摩擦系数\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3evar speed = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, fl = \x3cspan class=\x22hljs-number\x22\x3e0.95\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/初始速度， 摩擦系数\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e新建一个\x3ccode\x3emove\x3c\/code\x3e函数，在动画循环中调用。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3Piv?w=738\x26amp;h=353\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3Piv?w=738\x26amp;h=353\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV3PiA?w=392\x26amp;h=112\x22 src=\x22https:\/\/static.alili.tech\/img\/bV3PiA?w=392\x26amp;h=112\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e至此，拖动输入的核心功能就开发完了。如果你要在项目中使用，另一个需要注意的事情是canvas在移动端的模糊问题，这个已经有了很多的解决方案，你只需要耐心调试就好。最后还是祝大家新年快乐，源码在头部地址哦。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>每周一点canvas动画——《支付宝价格拖动选择》</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000013266172">https://segmentfault.com/a/1190000013266172</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/yrdj8qx49k/" target="_blank">https://alili.tech/archive/yrdj8qx49k/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>