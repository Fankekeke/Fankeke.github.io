<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="underscore 系列之如何写自己的 underscore"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>underscore 系列之如何写自己的 underscore | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ywxyfjgumg/",
				"appid": "1613049289050283", 
				"title": "underscore 系列之如何写自己的 underscore | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-25T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ws9tivyi31j/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/3xebwu7uf/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fywxyfjgumg%2f&text=underscore%20%e7%b3%bb%e5%88%97%e4%b9%8b%e5%a6%82%e4%bd%95%e5%86%99%e8%87%aa%e5%b7%b1%e7%9a%84%20underscore"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fywxyfjgumg%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fywxyfjgumg%2f&text=underscore%20%e7%b3%bb%e5%88%97%e4%b9%8b%e5%a6%82%e4%bd%95%e5%86%99%e8%87%aa%e5%b7%b1%e7%9a%84%20underscore"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fywxyfjgumg%2f&title=underscore%20%e7%b3%bb%e5%88%97%e4%b9%8b%e5%a6%82%e4%bd%95%e5%86%99%e8%87%aa%e5%b7%b1%e7%9a%84%20underscore"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fywxyfjgumg%2f&is_video=false&description=underscore%20%e7%b3%bb%e5%88%97%e4%b9%8b%e5%a6%82%e4%bd%95%e5%86%99%e8%87%aa%e5%b7%b1%e7%9a%84%20underscore"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=underscore%20%e7%b3%bb%e5%88%97%e4%b9%8b%e5%a6%82%e4%bd%95%e5%86%99%e8%87%aa%e5%b7%b1%e7%9a%84%20underscore&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fywxyfjgumg%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fywxyfjgumg%2f&title=underscore%20%e7%b3%bb%e5%88%97%e4%b9%8b%e5%a6%82%e4%bd%95%e5%86%99%e8%87%aa%e5%b7%b1%e7%9a%84%20underscore"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fywxyfjgumg%2f&title=underscore%20%e7%b3%bb%e5%88%97%e4%b9%8b%e5%a6%82%e4%bd%95%e5%86%99%e8%87%aa%e5%b7%b1%e7%9a%84%20underscore"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fywxyfjgumg%2f&title=underscore%20%e7%b3%bb%e5%88%97%e4%b9%8b%e5%a6%82%e4%bd%95%e5%86%99%e8%87%aa%e5%b7%b1%e7%9a%84%20underscore"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fywxyfjgumg%2f&title=underscore%20%e7%b3%bb%e5%88%97%e4%b9%8b%e5%a6%82%e4%bd%95%e5%86%99%e8%87%aa%e5%b7%b1%e7%9a%84%20underscore"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">underscore 系列之如何写自己的 underscore</h1><div class="meta"><div class="postdate"><time datetime="2018-12-25" itemprop="datePublished">2018-12-25</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e在 \x3ca href=\x22https:\/\/github.com\/mqyqingfeng\/Blog\/issues\/53\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《JavaScript 专题系列》\x3c\/a\x3e 中，我们写了很多的功能函数，比如防抖、节流、去重、类型判断、扁平数组、深浅拷贝、查找数组元素、通用遍历、柯里化、函数组合、函数记忆、乱序等，可以我们该如何组织这些函数，形成自己的一个工具函数库呢？这个时候，我们就要借鉴 underscore 是怎么做的了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e自己实现\x3c\/h2\x3e\n\x3cp\x3e如果是我们自己去组织这些函数，我们该怎么做呢？我想我会这样做：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(function(){\n    var root = this;\n\n    var _ = {};\n\n    root._ = _;\n\n    \/\/ 在这里添加自己的方法\n    _.reverse = function(string){\n        return string.split(\x27\x27).reverse().join(\x27\x27);\n    }\n\n})()\n\n_.reverse(\x27hello\x27);\n=\x3e \x27olleh\x27\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e root = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _ = {};\n\n    root._ = _;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在这里添加自己的方法\x3c\/span\x3e\n    _.reverse = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estring\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e string.split(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e).reverse().join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e);\n    }\n\n})()\n\n_.reverse(\x3cspan class=\x22hljs-string\x22\x3e\x27hello\x27\x3c\/span\x3e);\n=\x26gt; \x3cspan class=\x22hljs-string\x22\x3e\x27olleh\x27\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们将所有的方法添加到一个名为 \x3ccode\x3e_\x3c\/code\x3e 的对象上，然后将该对象挂载到全局对象上。\x3c\/p\x3e\n\x3cp\x3e之所以不直接 \x3ccode\x3ewindow._ = _\x3c\/code\x3e 是因为我们写的是一个工具函数库，不仅要求可以运行在浏览器端，还可以运行在诸如 Node 等环境中。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3eroot\x3c\/h2\x3e\n\x3cp\x3e然而 underscore 可不会写得如此简单，我们从 \x3ccode\x3evar root = this\x3c\/code\x3e 开始说起。\x3c\/p\x3e\n\x3cp\x3e之所以写这一句，是因为我们要通过 this 获得全局对象，然后将 \x3ccode\x3e_\x3c\/code\x3e 对象，挂载上去。\x3c\/p\x3e\n\x3cp\x3e然而在严格模式下，this 返回 undefined，而不是指向 Window，幸运的是 underscore 并没有采用严格模式，可是即便如此，也不能避免，因为在 ES6 中模块脚本自动采用严格模式，不管有没有声明 \x3ccode\x3euse strict\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果 this 返回 undefined，代码就会报错，所以我们的思路是对环境进行检测，然后挂载到正确的对象上。我们修改一下代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var root = (typeof window == \x27object\x27 \x26amp;\x26amp; window.window == window \x26amp;\x26amp; window) ||\n           (typeof global == \x27object\x27 \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e root = (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.window == \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e) ||\n           (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e global == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这段代码中，我们判断了浏览器和 Node 环境，可是只有这两个环境吗？那我们来看看 Web Worker。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3eWeb Worker\x3c\/h2\x3e\n\x3cp\x3eWeb Worker 属于 HTML5 中的内容，引用《JavaScript权威指南》中的话就是：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e在 Web Worker 标准中，定义了解决客户端 JavaScript 无法多线程的问题。其中定义的 “worker” 是指执行代码的并行过程。不过，Web Worker 处在一个自包含的执行环境中，无法访问 Window 对象和 Document 对象，和主线程之间的通信业只能通过异步消息传递机制来实现。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e为了演示 Web Worker 的效果，我写了一个 demo，\x3ca href=\x22https:\/\/github.com\/mqyqingfeng\/Blog\/tree\/master\/demos\/web-worker\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e查看代码\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e在 Web Worker 中，是无法访问 Window 对象的，所以 \x3ccode\x3etypeof window\x3c\/code\x3e 和 \x3ccode\x3etypeof global\x3c\/code\x3e 的结果都是 \x3ccode\x3eundefined\x3c\/code\x3e，所以最终 root 的值为 false，将一个基本类型的值像对象一样添加属性和方法，自然是会报错的。\x3c\/p\x3e\n\x3cp\x3e那么我们该怎么办呢？\x3c\/p\x3e\n\x3cp\x3e虽然在 Web Worker 中不能访问到 Window 对象，但是我们却能通过 self 访问到 Worker 环境中的全局对象。我们只是要找全局变量挂载而已，所以完全可以挂到 self 中嘛。\x3c\/p\x3e\n\x3cp\x3e而且在浏览器中，除了 window 属性，我们也可以通过 self 属性直接访问到 Winow 对象。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22console.log(window.window === window); \/\/ true\nconsole.log(window.self === window); \/\/ true\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.window === \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ true\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.self === \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ true\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e考虑到使用 self 还可以额外支持 Web Worker，我们直接将代码改成 self：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var root = (typeof self == \x27object\x27 \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n           (typeof global == \x27object\x27 \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e root = (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e self == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n           (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e global == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3enode vm\x3c\/h2\x3e\n\x3cp\x3e到了这里，依然没完，让你想不到的是，在 node 的 vm 模块中，也就是沙盒模块，runInContext 方法中，是不存在 window，也不存在 global 变量的，\x3ca href=\x22https:\/\/github.com\/mqyqingfeng\/Blog\/blob\/master\/demos\/node-vm\/index.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e查看代码\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e但是我们却可以通过 this 访问到全局对象，所以就有人发起了一个 PR，代码改成了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var root = (typeof self == \x27object\x27 \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n           (typeof global == \x27object\x27 \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global) ||\n           this;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e root = (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e self == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n           (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e global == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global) ||\n           \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e微信小程序\x3c\/h2\x3e\n\x3cp\x3e到了这里，还是没完，轮到微信小程序登场了。\x3c\/p\x3e\n\x3cp\x3e因为在微信小程序中，window 和 global 都是 undefined，加上又强制使用严格模式，this 为 undefined，挂载就会发生错误，所以就有人又发了一个 PR，代码变成了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var root = (typeof self == \x27object\x27 \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n           (typeof global == \x27object\x27 \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global) ||\n           this ||\n           {};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e root = (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e self == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n           (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e global == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global) ||\n           \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e ||\n           {};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这就是现在 v1.8.3 的样子。\x3c\/p\x3e\n\x3cp\x3e虽然作者可以直接讲解最终的代码，但是作者更希望带着大家看看这看似普通的代码是如何一步步演变成这样的，也希望告诉大家，代码的健壮性，并非一蹴而就，而是汇集了很多人的经验，考虑到了很多我们意想不到的地方，这也是开源项目的好处吧。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e函数对象\x3c\/h2\x3e\n\x3cp\x3e现在我们讲第二句 \x3ccode\x3evar _ = {};\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果仅仅设置 _ 为一个空对象，我们调用方法的时候，只能使用 \x3ccode\x3e_.reverse(\x27hello\x27)\x3c\/code\x3e 的方式，实际上，underscore 也支持类似面向对象的方式调用，即：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22_(\x27hello\x27).reverse(); \/\/ \x27olleh\x27\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e_(\x3cspan class=\x22hljs-string\x22\x3e\x27hello\x27\x3c\/span\x3e).reverse(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x27olleh\x27\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e再举个例子比较下两种调用方式：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 函数式风格\n_.each([1, 2, 3], function(item){\n    console.log(item)\n});\n\n\/\/ 面向对象风格\n_([1, 2, 3]).each(function(item){\n    console.log(item)\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 函数式风格\x3c\/span\x3e\n_.each([\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e], \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(item)\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 面向对象风格\x3c\/span\x3e\n_([\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e]).each(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(item)\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可是该如何实现呢？\x3c\/p\x3e\n\x3cp\x3e既然以 \x3ccode\x3e_([1, 2, 3])\x3c\/code\x3e 的形式可以执行，就表明 \x3ccode\x3e_\x3c\/code\x3e 不是一个字面量对象，而是一个函数！\x3c\/p\x3e\n\x3cp\x3e幸运的是，在 JavaScript 中，函数也是一种对象，我们举个例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var _ = function() {};\n_.value = 1;\n_.log = function() { return this.value \x2b 1 };\n\nconsole.log(_.value); \/\/ 1\nconsole.log(_.log()); \/\/ 2\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _ = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{};\n_.value = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n_.log = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e };\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(_.value); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(_.log()); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 2\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们完全可以将自定义的函数定义在 \x3ccode\x3e_\x3c\/code\x3e 函数上！\x3c\/p\x3e\n\x3cp\x3e目前的写法为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var root = (typeof self == \x27object\x27 \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n           (typeof global == \x27object\x27 \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global) ||\n           this ||\n           {};\n\nvar _ = function() {}\n\nroot._ = _;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e root = (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e self == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n           (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e global == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global) ||\n           \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e ||\n           {};\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _ = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{}\n\nroot._ = _;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如何做到 \x3ccode\x3e_([1, 2, 3]).each(...)\x3c\/code\x3e呢？即 \x3cem\x3e 函数返回一个对象，这个对象，如何调用挂在 \x3c\/em\x3e 函数上的方法呢？ \x3c\/p\x3e\n\x3cp\x3e我们看看 underscore 是如何实现的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var _ = function(obj) {\n    if (!(this instanceof _)) return new _(obj);\n    this._wrapped = obj;\n};\n\n_([1, 2, 3]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _ = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e _)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e _(obj);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._wrapped = obj;\n};\n\n_([\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们分析下 \x3ccode\x3e_([1, 2, 3])\x3c\/code\x3e 的执行过程：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e执行 \x3ccode\x3ethis instanceof _\x3c\/code\x3e，this 指向 window ，\x3ccode\x3ewindow instanceof _\x3c\/code\x3e 为 false，\x3ccode\x3e!\x3c\/code\x3e操作符取反，所以执行 \x3ccode\x3enew _(obj)\x3c\/code\x3e。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3enew _(obj)\x3c\/code\x3e 中，this 指向实例对象，\x3ccode\x3ethis instanceof _\x3c\/code\x3e 为 true，取反后，代码接着执行\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e执行 \x3ccode\x3ethis._wrapped = obj\x3c\/code\x3e， 函数执行结束\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e总结，\x3ccode\x3e_([1, 2, 3])\x3c\/code\x3e 返回一个对象，为 \x3ccode\x3e{_wrapped: [1, 2, 3]}\x3c\/code\x3e，该对象的原型指向 _.prototype\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e示意图如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000012014189?w=1234\x26amp;h=554\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000012014189?w=1234\x26amp;h=554\x22 alt=\x22_()示意图\x22 title=\x22_()示意图\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e然后问题来了，我们是将方法挂载到 \x3cem\x3e 函数对象上，并没有挂到函数的原型上呐，所以返回了的实例，其实是无法调用 \x3c\/em\x3e 函数对象上的方法的！\x3c\/p\x3e\n\x3cp\x3e我们写个例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(function(){\n    var root = (typeof self == \x27object\x27 \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n               (typeof global == \x27object\x27 \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global) ||\n               this ||\n               {};\n\n    var _ = function(obj) {\n        if (!(this instanceof _)) return new _(obj);\n        this._wrapped = obj;\n    }\n\n    root._ = _;\n\n    _.log = function(){\n        console.log(1)\n    }\n\n})()\n\n_().log(); \/\/ _(...).log is not a function\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e root = (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e self == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n               (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e global == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global) ||\n               \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e ||\n               {};\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _ = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e _)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e _(obj);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._wrapped = obj;\n    }\n\n    root._ = _;\n\n    _.log = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\n    }\n\n})()\n\n_().log(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ _(...).log is not a function\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e确实有这个问题，所以我们还需要一个方法将 _ 上的方法复制到 \x3ccode\x3e_.prototype\x3c\/code\x3e 上，这个方法就是 \x3ccode\x3e_.mixin\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e_.functions\x3c\/h2\x3e\n\x3cp\x3e为了将 \x3cem\x3e 上的方法复制到原型上，首先我们要获得 \x3c\/em\x3e 上的方法，所以我们先写个 \x3ccode\x3e_.functions\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22_.functions = function(obj) {\n    var names = [];\n    for (var key in obj) {\n        if (_.isFunction(obj[key])) names.push(key);\n    }\n    return names.sort();\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e_.functions = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e names = [];\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e key \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e obj) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (_.isFunction(obj[key])) names.push(key);\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e names.sort();\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eisFunction 函数可以参考 \x3ca href=\x22https:\/\/github.com\/mqyqingfeng\/Blog\/issues\/28\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《JavaScript专题之类型判断(下)》\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3emixin\x3c\/h2\x3e\n\x3cp\x3e现在我们可以写 mixin 方法了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var ArrayProto = Array.prototype;\nvar push = ArrayProto.push;\n\n_.mixin = function(obj) {\n    _.each(_.functions(obj), function(name) {\n        var func = _[name] = obj[name];\n        _.prototype[name] = function() {\n            var args = [this._wrapped];\n            push.apply(args, arguments);\n            return func.apply(_, args);\n        };\n    });\n    return _;\n};\n\n_.mixin(_);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ArrayProto = \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.prototype;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e push = ArrayProto.push;\n\n_.mixin = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n    _.each(_.functions(obj), \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ename\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e func = _[name] = obj[name];\n        _.prototype[name] = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e args = [\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._wrapped];\n            push.apply(args, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e func.apply(_, args);\n        };\n    });\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e _;\n};\n\n_.mixin(_);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eeach 方法可以参考 \x3ca href=\x22https:\/\/github.com\/mqyqingfeng\/Blog\/issues\/40\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《JavaScript专题jQuery通用遍历方法each的实现》\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e值得注意的是：因为 \x3ccode\x3e_[name] = obj[name]\x3c\/code\x3e 的缘故，我们可以给 underscore 拓展自定义的方法:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22_.mixin({\n  addOne: function(num) {\n    return num \x2b 1;\n  }\n});\n\n_(2).addOne(); \/\/ 3\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e_.mixin({\n  \x3cspan class=\x22hljs-attr\x22\x3eaddOne\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enum\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n  }\n});\n\n_(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e).addOne(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 3\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e至此，我们算是实现了同时支持面向对象风格和函数风格。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e导出\x3c\/h2\x3e\n\x3cp\x3e终于到了讲最后一步 \x3ccode\x3eroot._ = _\x3c\/code\x3e，我们直接看源码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (typeof exports != \x27undefined\x27 \x26amp;\x26amp; !exports.nodeType) {\n    if (typeof module != \x27undefined\x27 \x26amp;\x26amp; !module.nodeType \x26amp;\x26amp; module.exports) {\n        exports = module.exports = _;\n    }\n    exports._ = _;\n} else {\n    root._ = _;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e exports != \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e \x26amp;\x26amp; !exports.nodeType) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e != \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e \x26amp;\x26amp; !\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.nodeType \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports) {\n        exports = \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = _;\n    }\n    exports._ = _;\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    root._ = _;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了支持模块化，我们需要将 _ 在合适的环境中作为模块导出，但是 nodejs 模块的 API 曾经发生过改变，比如在早期版本中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ add.js\nexports.addOne = function(num) {\n  return num \x2b 1\n}\n\n\/\/ index.js\nvar add = require(\x27.\/add\x27);\nadd.addOne(2);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ add.js\x3c\/span\x3e\nexports.addOne = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enum\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ index.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e add = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/add\x27\x3c\/span\x3e);\nadd.addOne(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在新版本中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ add.js\nmodule.exports = function(1){\n    return num \x2b 1\n}\n\n\/\/ index.js\nvar addOne = require(\x27.\/add.js\x27)\naddOne(2)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ add.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ index.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e addOne = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/add.js\x27\x3c\/span\x3e)\naddOne(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e所以我们根据 exports 和 module 是否存在来选择不同的导出方式，那为什么在新版本中，我们还要使用 \x3ccode\x3eexports = module.exports = _\x3c\/code\x3e 呢？\x3c\/p\x3e\n\x3cp\x3e这是因为在 nodejs 中，exports 是 module.exports 的一个引用，当你使用了 module.exports = function(){}，实际上覆盖了 module.exports，但是 exports 并未发生改变，为了避免后面再修改 exports 而导致不能正确输出，就写成这样，将两者保持统一。\x3c\/p\x3e\n\x3cp\x3e写个 demo 吧：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ exports 是 module.exports 的一个引用\nmodule.exports.num = \x271\x27\n\nconsole.log(exports.num) \/\/ 1\n\nexports.num = \x272\x27\n\nconsole.log(module.exports.num) \/\/ 2\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ exports 是 module.exports 的一个引用\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports.num = \x3cspan class=\x22hljs-string\x22\x3e\x271\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(exports.num) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1\x3c\/span\x3e\n\nexports.num = \x3cspan class=\x22hljs-string\x22\x3e\x272\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports.num) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 2\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ addOne.js\nmodule.exports = function(num){\n    return num \x2b 1\n}\n\nexports.num = \x273\x27\n\n\/\/ result.js 中引入 addOne.js\nvar addOne = require(\x27.\/addOne.js\x27);\n\nconsole.log(addOne(1)) \/\/ 2\nconsole.log(addOne.num) \/\/ undefined\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ addOne.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enum\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n}\n\nexports.num = \x3cspan class=\x22hljs-string\x22\x3e\x273\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ result.js 中引入 addOne.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e addOne = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/addOne.js\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(addOne(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 2\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(addOne.num) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ undefined\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ addOne.js\nexports = module.exports = function(num){\n    return num \x2b 1\n}\n\nexports.num = \x273\x27\n\n\/\/ result.js 中引入 addOne.js\nvar addOne = require(\x27.\/addOne.js\x27);\n\nconsole.log(addOne(1)) \/\/ 2\nconsole.log(addOne.num) \/\/ 3\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ addOne.js\x3c\/span\x3e\nexports = \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enum\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n}\n\nexports.num = \x3cspan class=\x22hljs-string\x22\x3e\x273\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ result.js 中引入 addOne.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e addOne = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/addOne.js\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(addOne(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 2\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(addOne.num) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 3\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后为什么要进行一个 exports.nodeType 判断呢？这是因为如果你在 HTML 页面中加入一个 id 为 exports 的元素，比如\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv id=\x26quot;exports\x26quot;\x3e\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22exports\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e就会生成一个 window.exports 全局变量，你可以直接在浏览器命令行中打印该变量。\x3c\/p\x3e\n\x3cp\x3e此时在浏览器中，\x3ccode\x3etypeof exports != \x27undefined\x27\x3c\/code\x3e 的判断就会生效，然后 \x3ccode\x3eexports._ = _\x3c\/code\x3e，然而在浏览器中，我们需要将 _ 挂载到全局变量上呐，所以在这里，我们还需要进行一个是否是 DOM 节点的判断。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e源码\x3c\/h2\x3e\n\x3cp\x3e最终的代码如下，有了这个基本结构，你可以自由添加你需要使用到的函数了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(function() {\n\n    var root = (typeof self == \x27object\x27 \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n        (typeof global == \x27object\x27 \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global) ||\n        this || {};\n\n    var ArrayProto = Array.prototype;\n\n    var push = ArrayProto.push;\n\n    var _ = function(obj) {\n        if (obj instanceof _) return obj;\n        if (!(this instanceof _)) return new _(obj);\n        this._wrapped = obj;\n    };\n\n    if (typeof exports != \x27undefined\x27 \x26amp;\x26amp; !exports.nodeType) {\n        if (typeof module != \x27undefined\x27 \x26amp;\x26amp; !module.nodeType \x26amp;\x26amp; module.exports) {\n            exports = module.exports = _;\n        }\n        exports._ = _;\n    } else {\n        root._ = _;\n    }\n\n    _.VERSION = \x270.1\x27;\n\n    var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;\n\n    var isArrayLike = function(collection) {\n        var length = collection.length;\n        return typeof length == \x27number\x27 \x26amp;\x26amp; length \x3e= 0 \x26amp;\x26amp; length \x3c= MAX_ARRAY_INDEX;\n    };\n\n    _.each = function(obj, callback) {\n        var length, i = 0;\n\n        if (isArrayLike(obj)) {\n            length = obj.length;\n            for (; i \x3c length; i\x2b\x2b) {\n                if (callback.call(obj[i], obj[i], i) === false) {\n                    break;\n                }\n            }\n        } else {\n            for (i in obj) {\n                if (callback.call(obj[i], obj[i], i) === false) {\n                    break;\n                }\n            }\n        }\n\n        return obj;\n    }\n\n    _.isFunction = function(obj) {\n        return typeof obj == \x27function\x27 || false;\n    };\n\n    _.functions = function(obj) {\n        var names = [];\n        for (var key in obj) {\n            if (_.isFunction(obj[key])) names.push(key);\n        }\n        return names.sort();\n    };\n\n    \/**\n     * 在 _.mixin(_) 前添加自己定义的方法\n     *\/\n    _.reverse = function(string){\n        return string.split(\x27\x27).reverse().join(\x27\x27);\n    }\n\n    _.mixin = function(obj) {\n        _.each(_.functions(obj), function(name) {\n            var func = _[name] = obj[name];\n            _.prototype[name] = function() {\n                var args = [this._wrapped];\n\n                push.apply(args, arguments);\n\n                return func.apply(_, args);\n            };\n        });\n        return _;\n    };\n\n    _.mixin(_);\n\n})()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e root = (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e self == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; self.self == self \x26amp;\x26amp; self) ||\n        (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e global == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e \x26amp;\x26amp; global.global == global \x26amp;\x26amp; global) ||\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e || {};\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ArrayProto = \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.prototype;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e push = ArrayProto.push;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _ = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (obj \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e _) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e obj;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e _)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e _(obj);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._wrapped = obj;\n    };\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e exports != \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e \x26amp;\x26amp; !exports.nodeType) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e != \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e \x26amp;\x26amp; !\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.nodeType \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports) {\n            exports = \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = _;\n        }\n        exports._ = _;\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        root._ = _;\n    }\n\n    _.VERSION = \x3cspan class=\x22hljs-string\x22\x3e\x270.1\x27\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e MAX_ARRAY_INDEX = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.pow(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e53\x3c\/span\x3e) - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isArrayLike = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecollection\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e length = collection.length;\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e length == \x3cspan class=\x22hljs-string\x22\x3e\x27number\x27\x3c\/span\x3e \x26amp;\x26amp; length \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \x26amp;\x26amp; length \x26lt;= MAX_ARRAY_INDEX;\n    };\n\n    _.each = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj, callback\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e length, i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isArrayLike(obj)) {\n            length = obj.length;\n            \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (; i \x26lt; length; i\x2b\x2b) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (callback.call(obj[i], obj[i], i) === \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                }\n            }\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (i \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e obj) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (callback.call(obj[i], obj[i], i) === \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                }\n            }\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e obj;\n    }\n\n    _.isFunction = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e obj == \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e || \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    };\n\n    _.functions = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e names = [];\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e key \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e obj) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (_.isFunction(obj[key])) names.push(key);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e names.sort();\n    };\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/**\n     * 在 _.mixin(_) 前添加自己定义的方法\n     *\/\x3c\/span\x3e\n    _.reverse = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estring\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e string.split(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e).reverse().join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e);\n    }\n\n    _.mixin = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n        _.each(_.functions(obj), \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ename\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e func = _[name] = obj[name];\n            _.prototype[name] = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e args = [\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._wrapped];\n\n                push.apply(args, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e);\n\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e func.apply(_, args);\n            };\n        });\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e _;\n    };\n\n    _.mixin(_);\n\n})()\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e相关链接\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/mqyqingfeng\/Blog\/issues\/28\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《JavaScript专题之类型判断(下)》\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/mqyqingfeng\/Blog\/issues\/40\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《JavaScript专题jQuery通用遍历方法each的实现》\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3eunderscore 系列\x3c\/h2\x3e\n\x3cp\x3eunderscore 系列目录地址：\x3ca href=\x22https:\/\/github.com\/mqyqingfeng\/Blog\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/mqyqingfeng\/Blog\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3eunderscore 系列预计写八篇左右，重点介绍 underscore 中的代码架构、链式调用、内部函数、模板引擎等内容，旨在帮助大家阅读源码，以及写出自己的 undercore。\x3c\/p\x3e\n\x3cp\x3e如果有错误或者不严谨的地方，请务必给予指正，十分感谢。如果喜欢或者有所启发，欢迎star，对作者也是一种鼓励。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>underscore 系列之如何写自己的 underscore</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000012014184">https://segmentfault.com/a/1190000012014184</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ywxyfjgumg/" target="_blank">https://alili.tech/archive/ywxyfjgumg/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>