<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="vuejs单页应用的权限管理实践"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>vuejs单页应用的权限管理实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/z3skidqyiy/",
				"appid": "1613049289050283", 
				"title": "vuejs单页应用的权限管理实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-08T02:30:30"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/b7y1prdz9p/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/k5dxkv9wlt/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fz3skidqyiy%2f&text=vuejs%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e5%ae%9e%e8%b7%b5"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fz3skidqyiy%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fz3skidqyiy%2f&text=vuejs%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e5%ae%9e%e8%b7%b5"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fz3skidqyiy%2f&title=vuejs%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e5%ae%9e%e8%b7%b5"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fz3skidqyiy%2f&is_video=false&description=vuejs%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e5%ae%9e%e8%b7%b5"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=vuejs%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e5%ae%9e%e8%b7%b5&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fz3skidqyiy%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fz3skidqyiy%2f&title=vuejs%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e5%ae%9e%e8%b7%b5"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fz3skidqyiy%2f&title=vuejs%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e5%ae%9e%e8%b7%b5"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fz3skidqyiy%2f&title=vuejs%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e5%ae%9e%e8%b7%b5"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fz3skidqyiy%2f&title=vuejs%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%e7%9a%84%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86%e5%ae%9e%e8%b7%b5"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">vuejs单页应用的权限管理实践</h1><div class="meta"><div class="postdate"><time datetime="2018-12-08" itemprop="datePublished">2018-12-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e原文发布于 \x3ca href=\x22http:\/\/blog.ahui.me\/posts\/2018-03-26\/permission-control-of-vuejs\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/blog.ahui.me\/posts\/201...\x3c\/a\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e在众多的B端应用中,简单如小型企业的管理后台,还是大型的CMS,CRM系统,权限管理都是一个重中之重的需求,过往的web应用大多采取服务端模板\x2b服务端路由的模式,权限管理自然也由服务端进行控制和过滤.但是在前后端分离的大潮下,如果采用单页应用开发模式的话,前端也无可避免要配合服务端共同进行权限管理,接下来会以vuejs开发单页应用为例,给出一些尝试方案,希望也能给大家提供一些思路.注意采用nodejs作为中间层的前后端分离不在此文讨论范围.\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e目标\x3c\/h2\x3e\n\x3cp\x3e关于权限管理,由于本人对服务端并不能算得上十分了解,我只能从我以往的项目经验中进行总结,并不一定十分准确.\x3c\/p\x3e\n\x3cp\x3e一般权限管理分为以下几部分.\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e应用使用权\x3c\/li\x3e\n\x3cli\x3e页面级别权限\x3c\/li\x3e\n\x3cli\x3e模块级别权限\x3c\/li\x3e\n\x3cli\x3e接口级别权限\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e接下来会逐一讲解上述部分.完整的实例代码托管在\x3ca href=\x22https:\/\/github.com\/funkyLover\/vue-permission-control-demo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egithub-funkyLover\/vue-permission-control-demo\x3c\/a\x3e上.\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e应用使用权-登录状态管理与保存\x3c\/h2\x3e\n\x3cp\x3e首先\x3ccode\x3e应用使用权\x3c\/code\x3e其实就是简单的判断登录状态而已.在很多C端应用,登录之后能使用更多的功能在一定程度上也可以算作权限管理的一部分.而在B端应用中一般表现为不登录则不能使用(当然还能使用类似找回密码之类的功能).\x3c\/p\x3e\n\x3cp\x3e以往登录状态的保持一般通过session\x2bcookie\/token管理,用户在打开网页时就带上cookie\/token,由后端逻辑判断并进行重定向.在SPA的模式下,页面跳转是由前端路由进行控制的,用户状态的判断则需要由前端主动发送一次\x3ccode\x3e自动登录\x3c\/code\x3e的请求,根据返回结果进行跳转.\x3c\/p\x3e\n\x3cp\x3e这个\x3ccode\x3e自动登录\x3c\/code\x3e的逻辑可以深挖做出多种实现,例如登录成功之后把用户信息加密并通过localstorage在多个tab之间公用,这样再新打开tab时就不需要再次\x3ccode\x3e自动登录\x3c\/code\x3e.这里就以最简单的实现来进行讲解,基本流程如下:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e用户请求页面资源\x3c\/li\x3e\n\x3cli\x3e检查本地cookie\/localstorage是否有token\x3c\/li\x3e\n\x3cli\x3e如果没有token,不管用户请求打开的是哪个路由,都一律跳转到login路由\x3c\/li\x3e\n\x3cli\x3e如果检查到token,先请求\x3ccode\x3e自动登录\x3c\/code\x3e的接口,根据返回的结果判断是进入用户请求的路由还是跳转到login路由\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e而关于用户状态的判断,一般应该针对\x3ccode\x3e进入login路由\x3c\/code\x3e(包括忘记密码之类的路由)和\x3ccode\x3e进入其他路由\x3c\/code\x3e进行判断,在基于vuejs@2.x的前提下,可以在router的beforeEach钩子上进行用户状态判断并切换路由即可.下面给出部分代码:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const routes = [\n  {\n    path: \x27\/\x27,\n    component: Layout,\n    children: [\n      {\n        path: \x27\x27,\n        name: \x27Dashboard\x27,\n        component: Dashboard\n      }, {\n        path: \x27page1\x27,\n        name: \x27Page1\x27,\n        component: Page1\n      }, {\n        path: \x27page2\x27,\n        name: \x27Page2\x27,\n        component: Page2\n      }\n    ]\n  }, {\n    path: \x27\/login\x27,\n    name: \x27Login\x27,\n    component: Login\n  }\n]\n\nconst router = new Router({\n  routes,\n  mode: \x27history\x27\n  \/\/ 其他配置\n})\n\nrouter.beforeEach((to, from, next) =\x3e {\n  if (to.name === \x27Login\x27) {\n    \/\/ 当进入路由为login时,判断是否已经登录\n    if (store.getters.user.isLogin) {\n      \/\/ 如果已经登录,则进入功能页面\n      return next(\x27\/\x27)\n    } else {\n      return next()\n    }\n  } else {\n    if (store.getters.user.isLogin) {\n      return next()\n    } else {\n      \/\/ 如果没有登录,则进入login路由\n      return next(\x27\/login\x27)\n    }\n  }\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e routes = [\n  {\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Layout,\n    \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: [\n      {\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Dashboard\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Dashboard\n      }, {\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27page1\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Page1\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Page1\n      }, {\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27page2\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Page2\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Page2\n      }\n    ]\n  }, {\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Login\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Login\n  }\n]\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e router = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Router({\n  routes,\n  \x3cspan class=\x22hljs-attr\x22\x3emode\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27history\x27\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 其他配置\x3c\/span\x3e\n})\n\nrouter.beforeEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eto, \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e, next\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (to.name === \x3cspan class=\x22hljs-string\x22\x3e\x27Login\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当进入路由为login时,判断是否已经登录\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (store.getters.user.isLogin) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果已经登录,则进入功能页面\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next()\n    }\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (store.getters.user.isLogin) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next()\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果没有登录,则进入login路由\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(\x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e)\n    }\n  }\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在设定好跳转逻辑后,我们则需要在login路由中检查是否有token并进行自动登录\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ Login.vue\nasync mounted () {\n  var token = Cookie.get(\x27vue-login-token\x27)\n  if (token) {\n    var { data } = await axios.post(\x27\/api\/loginByToken\x27, {\n      token: token\n    })\n    if (data.ok) {\n      this[LOGIN]()\n      Cookie.set(\x27vue-login-token\x27, data.token)\n      this.$router.push(\x27\/\x27)\n    } else {\n      \/\/ 登录失败逻辑\n    }\n  }\n},\nmethods: {\n  ...mapMutations([\n    LOGIN\n  ]),\n  async login () {\n    var { data } = await axios.post(\x27\/api\/login\x27, {\n      username: this.username,\n      password: this.password\n    })\n    if (data.ok) {\n      this[LOGIN]()\n      Cookie.set(\x27vue-login-token\x27, data.token)\n      this.$router.push(\x27\/\x27)\n    } else {\n      \/\/ 登录错误逻辑\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Login.vue\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e mounted () {\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e token = Cookie.get(\x3cspan class=\x22hljs-string\x22\x3e\x27vue-login-token\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e { data } = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e axios.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/api\/loginByToken\x27\x3c\/span\x3e, {\n      \x3cspan class=\x22hljs-attr\x22\x3etoken\x3c\/span\x3e: token\n    })\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (data.ok) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e[LOGIN]()\n      Cookie.set(\x3cspan class=\x22hljs-string\x22\x3e\x27vue-login-token\x27\x3c\/span\x3e, data.token)\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$router.push(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 登录失败逻辑\x3c\/span\x3e\n    }\n  }\n},\n\x3cspan class=\x22hljs-attr\x22\x3emethods\x3c\/span\x3e: {\n  ...mapMutations([\n    LOGIN\n  ]),\n  \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e login () {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e { data } = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e axios.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/api\/login\x27\x3c\/span\x3e, {\n      \x3cspan class=\x22hljs-attr\x22\x3eusername\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.username,\n      \x3cspan class=\x22hljs-attr\x22\x3epassword\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.password\n    })\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (data.ok) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e[LOGIN]()\n      Cookie.set(\x3cspan class=\x22hljs-string\x22\x3e\x27vue-login-token\x27\x3c\/span\x3e, data.token)\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$router.push(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 登录错误逻辑\x3c\/span\x3e\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e同理退出登录时把token置空即可.注意这里给出的逻辑实现相对粗糙,实际应该根据需求进行改动,例如在进行自动登录的时候给用户适当的提示,把读取\/存储token的逻辑放进store中进行统一管理,处理token的过时逻辑等.\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e页面级别权限-根据权限生成router对象\x3c\/h2\x3e\n\x3cp\x3e这里可以借助\x3ca href=\x22https:\/\/router.vuejs.org\/zh-cn\/advanced\/navigation-guards.html#%E8%B7%AF%E7%94%B1%E7%8B%AC%E4%BA%AB%E7%9A%84%E5%AE%88%E5%8D%AB\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3evue-router\/路由独享的守卫\x3c\/a\x3e来进行处理.基本思路为在每一个需要检查权限的路由中设置beforeEnter钩子函数,并在其中对用户的权限进行判断.\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nconst routes = [\n  {\n    path: \x27\/\x27,\n    component: Layout,\n    children: [\n      {\n        path: \x27\x27,\n        name: \x27Dashboard\x27,\n        component: Dashboard\n      }, {\n        path: \x27page1\x27,\n        name: \x27Page1\x27,\n        component: Page1,\n        beforeEnter: (to, from, next) =\x3e {\n          \/\/ 这里检查权限并进行跳转\n          next()\n        }\n      }, {\n        path: \x27page2\x27,\n        name: \x27Page2\x27,\n        component: Page2,\n        beforeEnter: (to, from, next) =\x3e {\n          \/\/ 这里检查权限并进行跳转\n          next()\n        }\n      }\n    ]\n  }, {\n    path: \x27\/login\x27,\n    name: \x27Login\x27,\n    component: Login\n  }\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e routes = [\n  {\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Layout,\n    \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: [\n      {\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Dashboard\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Dashboard\n      }, {\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27page1\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Page1\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Page1,\n        \x3cspan class=\x22hljs-attr\x22\x3ebeforeEnter\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eto, \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e, next\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里检查权限并进行跳转\x3c\/span\x3e\n          next()\n        }\n      }, {\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27page2\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Page2\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Page2,\n        \x3cspan class=\x22hljs-attr\x22\x3ebeforeEnter\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eto, \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e, next\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里检查权限并进行跳转\x3c\/span\x3e\n          next()\n        }\n      }\n    ]\n  }, {\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Login\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Login\n  }\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面代码是足以完成需求的,再配合上\x3ca href=\x22https:\/\/router.vuejs.org\/zh-cn\/advanced\/lazy-loading.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3evue-router\/路由懒加载\x3c\/a\x3e也可以实现对于没有权限的路由不会加载相应页面组件的资源.不过上述实现还是有一些问题.\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e当页面权限足够细致时,router的配置将会变得更加庞大难以维护\x3c\/li\x3e\n\x3cli\x3e每当后台更新页面权限规则时,前端的判断逻辑也要跟着改变,这就相当于前后端需要共同维护一套页面级别权限.\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e第一个问题尚且可以通过编码手段来减轻,例如把逻辑放到beforeEach钩子中,又或者借助高阶函数对权限检查逻辑进行抽象.但是第二个问题却是无可避免的,如果我们只在后端进行路由的配置,而前端根据后端返回的配置扩展router呢,这样就可以避免在前后端共同维护一套逻辑了,根据这个思路我们对之前逻辑进行一下改写.\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ Login.vue\nasync mounted () {\n  var token = Cookie.get(\x27vue-login-token\x27)\n  if (token) {\n    var { data } = await axios.post(\x27\/api\/loginByToken\x27, {\n      token: token\n    })\n    if (data.ok) {\n      this[LOGIN]()\n      Cookie.set(\x27vue-login-token\x27, data.token)\n      \/\/ 这里调用更新router的方法\n      this.updateRouter(data.routes)\n    }\n  }\n},\n\/\/ ...\nmethods: {\n  async updateRouter (routes) {\n    \/\/ routes是后台返回来的路由信息\n    const routers = [\n      {\n        path: \x27\/\x27,\n        component: Layout,\n        children: [\n          {\n            path: \x27\x27,\n            name: \x27Dashboard\x27,\n            component: Dashboard\n          }\n        ]\n      }\n    ]\n    routes.forEach(r =\x3e {\n      routers[0].children.push({\n        name: r.name,\n        path: r.path,\n        component: () =\x3e routesMap[r.component]\n      })\n    })\n    this.$router.addRoutes(routers)\n    this.$router.push(\x27\/\x27)\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Login.vue\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e mounted () {\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e token = Cookie.get(\x3cspan class=\x22hljs-string\x22\x3e\x27vue-login-token\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e { data } = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e axios.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/api\/loginByToken\x27\x3c\/span\x3e, {\n      \x3cspan class=\x22hljs-attr\x22\x3etoken\x3c\/span\x3e: token\n    })\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (data.ok) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e[LOGIN]()\n      Cookie.set(\x3cspan class=\x22hljs-string\x22\x3e\x27vue-login-token\x27\x3c\/span\x3e, data.token)\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里调用更新router的方法\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updateRouter(data.routes)\n    }\n  }\n},\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\nmethods: {\n  \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e updateRouter (routes) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ routes是后台返回来的路由信息\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e routers = [\n      {\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Layout,\n        \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: [\n          {\n            \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Dashboard\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: Dashboard\n          }\n        ]\n      }\n    ]\n    routes.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3er\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      routers[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].children.push({\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: r.name,\n        \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: r.path,\n        \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e routesMap[r.component]\n      })\n    })\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$router.addRoutes(routers)\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$router.push(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e)\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样就实现了根据后端的返回动态扩展路由,当然也可以根据后端的返回生成侧栏或顶栏的导航菜单,这样就不需要再在前端处理页面权限了.这里还是要再提醒一下,本文的例子只实现最基本的功能,省略了很多可优化的逻辑\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e每打开新的tab(非login路由)时都会重新\x3ccode\x3e自动登录\x3c\/code\x3e并重新扩展router\x3c\/li\x3e\n\x3cli\x3e每打开新的tab,自动登录之后依然会跳转到\x3ccode\x3e\/\x3c\/code\x3e路由,就算新打开的url为\x3ccode\x3e\/page1\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e解决思路是把用户登录信息和路由信息存储在localstorage中,当打开新tab时直接通过localstorage中存储的信息直接生成router对象.借助\x3ca href=\x22https:\/\/github.com\/marcuswestin\/store.js\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3estore.js\x3c\/a\x3e和\x3ca href=\x22https:\/\/github.com\/xanf\/vuex-shared-mutations\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3evuex-shared-mutations\x3c\/a\x3e一类的插件可以一定程度上简化这部分逻辑,这里不展开讨论.\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e模块级别权限-组件权限\x3c\/h2\x3e\n\x3cp\x3e模块级别的权限很好理解,其实就是带权限判断的组件.在React中借助高阶组件来定义需要过滤权限的组件是非常简单且容易理解的.请看下面的例子\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const withAuth = (Comp, auth) =\x3e {\n  return class AuthComponent extends Component {\n    constructor(props) {\n      super(props);\n      this.checkAuth = this.checkAuth.bind(this)\n    }\n\n    checkAuth () {\n      const auths = this.props;\n      return auths.indexOf(auth) !== -1;\n    }\n\n    render () {\n      if (this.checkAuth()) {\n        \x3cComp { ...this.props }\/\x3e\n      } else {\n        return null\n      }\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e withAuth = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eComp, auth\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eAuthComponent\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(props) {\n      \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.checkAuth = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.checkAuth.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n    }\n\n    checkAuth () {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e auths = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e auths.indexOf(auth) !== \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e;\n    }\n\n    render () {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.checkAuth()) {\n        \x26lt;Comp { ...this.props }\/\x26gt;\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n      }\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的例子展示的就是有权限时展示该组件,没有权限时则隐藏组件们可以根据不同权限过滤需求来定义各种高阶组件来处理.\x3c\/p\x3e\n\x3cp\x3e而在vuejs中可以使用通过render函数来实现\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ Auth.vue\nimport { mapGetters } from \x27vuex\x27\n\nexport default {\n  name: \x27Auth-Comp\x27,\n  render (h) {\n    if (this.auths.indexOf(this.auth) !== -1) {\n      return this.$slots.default\n    } else {\n      return null\n    }\n  },\n  props: {\n    auth: String\n  },\n  computed: {\n    ...mapGetters([\x27auths\x27])\n  }\n}\n\/\/ 使用\n\x3cAuth auth=\x26quot;canShowHello\x26quot;\x3e\n  \x3cHello\x3e\x3c\/Hello\x3e\n\x3c\/Auth\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Auth.vue\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { mapGetters } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27vuex\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Auth-Comp\x27\x3c\/span\x3e,\n  render (h) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.auths.indexOf(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.auth) !== \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$slots.default\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    }\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eprops\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3eauth\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3ecomputed\x3c\/span\x3e: {\n    ...mapGetters([\x3cspan class=\x22hljs-string\x22\x3e\x27auths\x27\x3c\/span\x3e])\n  }\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用\x3c\/span\x3e\n\x26lt;Auth auth=\x3cspan class=\x22hljs-string\x22\x3e\x22canShowHello\x22\x3c\/span\x3e\x26gt;\n  \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eHello\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eHello\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n\x26lt;\x3cspan class=\x22hljs-regexp\x22\x3e\/Auth\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3evuejs中的render函数提供完全编程的能力,甚至还能在render函数使用jsx语法,获得接近React的开发体验,详情参考\x3ca href=\x22https:\/\/cn.vuejs.org\/v2\/guide\/render-function.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3evuejs文档\/渲染函数\x26amp;jsx\x3c\/a\x3e.\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e接口级别权限\x3c\/h2\x3e\n\x3cp\x3e接口级别的权限一般就与UI库关联不大,这里简单讲一下如何处理.\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e首先从后端获取允许当前用户访问的Api接口的权限\x3c\/li\x3e\n\x3cli\x3e根据返回来的结果配置前端的ajax请求库(如axios)的拦截器\x3c\/li\x3e\n\x3cli\x3e在拦截器中判断权限,根据需求提示用户即可\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22axios.interceptors.request.use((config) =\x3e {\n  \/\/ 这里进行权限判断\n  if (\/* 没有权限 *\/) {\n    return Promise.reject(\x27no auth\x27)\n  } else {\n    return config\n  }\n}, err =\x3e {\n  return Promise.reject(err)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eaxios.interceptors.request.use(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3econfig\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里进行权限判断\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-comment\x22\x3e\/* 没有权限 *\/\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-string\x22\x3e\x27no auth\x27\x3c\/span\x3e)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e config\n  }\n}, err =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(err)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其实个人认为前端也不一定有必要对请求的api进行权限判断,毕竟接口不像路由,路由现在已经由前端来管理了,但是接口最终都需要通过服务器的校验.可以视需求加上.\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e后记\x3c\/h2\x3e\n\x3cp\x3e写得比较乱,像流水账似的,完整的实例代码在\x3ca href=\x22https:\/\/github.com\/funkyLover\/vue-permission-control-demo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egithub-funkyLover\/vue-permission-control-demo\x3c\/a\x3e,如有问题或者意见请评论留言,我必虚心受教.\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>vuejs单页应用的权限管理实践</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014029196">https://segmentfault.com/a/1190000014029196</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/z3skidqyiy/" target="_blank">https://alili.tech/archive/z3skidqyiy/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>