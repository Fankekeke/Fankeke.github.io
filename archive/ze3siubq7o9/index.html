<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="IndexedDB 打造靠谱 Web 离线数据库"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>IndexedDB 打造靠谱 Web 离线数据库 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ze3siubq7o9/",
				"appid": "1613049289050283", 
				"title": "IndexedDB 打造靠谱 Web 离线数据库 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-11-29T09:34:56"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/niz2dmqwstr/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/o83stw5cqqr/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fze3siubq7o9%2f&text=IndexedDB%20%e6%89%93%e9%80%a0%e9%9d%a0%e8%b0%b1%20Web%20%e7%a6%bb%e7%ba%bf%e6%95%b0%e6%8d%ae%e5%ba%93"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fze3siubq7o9%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fze3siubq7o9%2f&text=IndexedDB%20%e6%89%93%e9%80%a0%e9%9d%a0%e8%b0%b1%20Web%20%e7%a6%bb%e7%ba%bf%e6%95%b0%e6%8d%ae%e5%ba%93"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fze3siubq7o9%2f&title=IndexedDB%20%e6%89%93%e9%80%a0%e9%9d%a0%e8%b0%b1%20Web%20%e7%a6%bb%e7%ba%bf%e6%95%b0%e6%8d%ae%e5%ba%93"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fze3siubq7o9%2f&is_video=false&description=IndexedDB%20%e6%89%93%e9%80%a0%e9%9d%a0%e8%b0%b1%20Web%20%e7%a6%bb%e7%ba%bf%e6%95%b0%e6%8d%ae%e5%ba%93"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=IndexedDB%20%e6%89%93%e9%80%a0%e9%9d%a0%e8%b0%b1%20Web%20%e7%a6%bb%e7%ba%bf%e6%95%b0%e6%8d%ae%e5%ba%93&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fze3siubq7o9%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fze3siubq7o9%2f&title=IndexedDB%20%e6%89%93%e9%80%a0%e9%9d%a0%e8%b0%b1%20Web%20%e7%a6%bb%e7%ba%bf%e6%95%b0%e6%8d%ae%e5%ba%93"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fze3siubq7o9%2f&title=IndexedDB%20%e6%89%93%e9%80%a0%e9%9d%a0%e8%b0%b1%20Web%20%e7%a6%bb%e7%ba%bf%e6%95%b0%e6%8d%ae%e5%ba%93"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fze3siubq7o9%2f&title=IndexedDB%20%e6%89%93%e9%80%a0%e9%9d%a0%e8%b0%b1%20Web%20%e7%a6%bb%e7%ba%bf%e6%95%b0%e6%8d%ae%e5%ba%93"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fze3siubq7o9%2f&title=IndexedDB%20%e6%89%93%e9%80%a0%e9%9d%a0%e8%b0%b1%20Web%20%e7%a6%bb%e7%ba%bf%e6%95%b0%e6%8d%ae%e5%ba%93"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">IndexedDB 打造靠谱 Web 离线数据库</h1><div class="meta"><div class="postdate"><time datetime="2018-11-29" itemprop="datePublished">2018-11-29</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e在知乎和我在平常工作中，常常会看到一个问题：\x3c\/p\x3e\n\x3cblockquote\x3e前端现在还火吗？\x3c\/blockquote\x3e\n\x3cp\x3e这个我只想说：\x3c\/p\x3e\n\x3cblockquote\x3e隔岸观火的人永远无法明白起火的原因，只有置身风暴，才能找到风眼之所在 ——『秦时明月』\x3c\/blockquote\x3e\n\x3cp\x3e你 TM 看都不看前端现在的发展，怎么去评判前端火不火，我该不该尝试一下其他方面的内容呢？本人为啥为这么热衷于新的技术呢？主要原因在于，生怕会被某一项颠覆性的内容淘汰掉，从前沿领域掉队下来。说句人话就是：\x3ccode\x3e穷，所以只能学了...\x3c\/code\x3e。所以本文会从头剖析一下 \x3ccode\x3eIndexedDB\x3c\/code\x3e 在前端里面的应用的发展。\x3c\/p\x3e\n\x3cp\x3eindexedDB 目前在前端慢慢得到普及和应用。它正朝着前端离线数据库技术的步伐前进。以前一开始是  manifest、localStorage、cookie 再到  webSQL，现在  indexedDB 逐渐被各大浏览器认可。我们也可以针对它来进行技术上创新的开发。比如，现在小视频非常流行，那么我们可以在用户观看时，通过 cacheStorage 缓存，然后利用 WebRTC 技术实现 P2P 分发的控制，不过需要注意，一定要合理利用大小，不然后果真的很严重。\x3c\/p\x3e\n\x3cp\x3eindexedDB 的整体架构，是由一系列单独的概念串联而成，全部概念如下列表。一眼看去会发现没有任何逻辑，不过，这里我顺手画了一幅逻辑图，中间会根据 函数 的调用而相互串联起来。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eIDBRequest\x3c\/li\x3e\n\x3cli\x3eIDBFactory\x3c\/li\x3e\n\x3cli\x3eIDBDatabase\x3c\/li\x3e\n\x3cli\x3eIDBObjectStore\x3c\/li\x3e\n\x3cli\x3eIDBIndex\x3c\/li\x3e\n\x3cli\x3eIDBKeyRange\x3c\/li\x3e\n\x3cli\x3eIDBCursor\x3c\/li\x3e\n\x3cli\x3eIDBTransaction\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e整体逻辑图如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014950569?w=792\x26amp;h=800\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014950569?w=792\x26amp;h=800\x22 alt=\x22逻辑联系框图\x22 title=\x22逻辑联系框图\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eTL;DR\x3c\/h2\x3e\n\x3cp\x3e下文主要介绍了 indexedDB 的基本概念，以及在实际应用中的实操代码。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eindexedDB 基础概念。在  indexedDB 里面会根据索引  index 来进行整体数据结构的划分。\x3c\/li\x3e\n\x3cli\x3eindexedDB 数据库的更新是一个非常蛋疼的事情，因为，Web 的灵活性，你既需要做好向上版本的更新，也需要完善向下版本的容错性。\x3c\/li\x3e\n\x3cli\x3eindexedDB 高效索引机制，在内部，indexedDB 已经提供了 \x3ccode\x3eindex\x3c\/code\x3e、\x3ccode\x3ecursor\x3c\/code\x3e等高效的索引机制，推荐不要直接将所有数据都取回来，再进行筛选，而是直接利用 \x3ccode\x3ecursor\x3c\/code\x3e 进行。\x3c\/li\x3e\n\x3cli\x3e最后推荐几个常用库\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e离线存储\x3c\/h2\x3e\n\x3cp\x3eIndexedDB 可以存储非常多的数据，比如 Object,files,blobs 等，里面的存储结构是根据 Database 来进行存储的。每个 DB 里面可以有不同的 object stores。具体结构如下图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014950570?w=1392\x26amp;h=1044\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014950570?w=1392\x26amp;h=1044\x22 alt=\x22indexedDB 结构图\x22 title=\x22indexedDB 结构图\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e并且，我们可以给 \x3ccode\x3ekey\x3c\/code\x3e 设定相关特定的值，然后在索引的时候，可以直接通过 key 得到具体的内容。使用  IndexDB 需要注意，其遵循的是同域原则。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3eindexDB 基本概念\x3c\/h2\x3e\n\x3cp\x3e在 indexDB 中，有几个基本的操作对象：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3eDatabase: 通过 \x3ccode\x3eopen\x3c\/code\x3e 方法直接打开，可以得到一个实例的 DB。每个页面可以创建多个 DB，不过一般都是一个。\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22idb.open(name, version, upgradeCallback)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs applescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3eidb.open(\x3cspan class=\x22hljs-built_in\x22\x3ename\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3eversion\x3c\/span\x3e, upgradeCallback)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3eObject store: 这个就是 DB 里面具体存储的对象。这个可以对应于 SQL 里面的 table 内容。其存储的结构为：\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014950571?w=1486\x26amp;h=1068\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014950571?w=1486\x26amp;h=1068\x22 alt=\x22image.png-392.5kB\x22 title=\x22image.png-392.5kB\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3eindex: 有点类似于外链，它本身是一种 Object store，主要是用来在本体的 store 中，索引另外 object store 里面的数据。需要区别的是，key 和 index 是不一样的。可以参考： \x3ca href=\x22https:\/\/mdn.github.io\/indexeddb-examples\/idbindex\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eindex DEMO\x3c\/a\x3e，\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/IDBIndex\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emdn index\x3c\/a\x3e。如下图表示：\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000014950572?w=720\x26amp;h=408\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000014950572?w=720\x26amp;h=408\x22 alt=\x22image.png-59.8kB\x22 title=\x22image.png-59.8kB\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如下 code 为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 创建 index\nvar myIndex = objectStore.index(\x27lName\x27); \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs delphi\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建 index\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e myIndex = objectStore.\x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27lName\x27\x3c\/span\x3e); \x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3etransaction: 事务其实就是一系列 CRUD 的集合内容。如果其中一个环节失败了，那么整个事务的处理都会被取消。例如：\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var trans1 = db.transaction(\x26quot;foo\x26quot;, \x26quot;readwrite\x26quot;);\nvar trans2 = db.transaction(\x26quot;foo\x26quot;, \x26quot;readwrite\x26quot;);\nvar objectStore2 = trans2.objectStore(\x26quot;foo\x26quot;)\nvar objectStore1 = trans1.objectStore(\x26quot;foo\x26quot;)\nobjectStore2.put(\x26quot;2\x26quot;, \x26quot;key\x26quot;);\nobjectStore1.put(\x26quot;1\x26quot;, \x26quot;key\x26quot;);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs maxima\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e trans1 = db.transaction(\x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22readwrite\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e trans2 = db.transaction(\x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22readwrite\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e objectStore2 = trans2.objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e)\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e objectStore1 = trans1.objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e)\nobjectStore2.\x3cspan class=\x22hljs-built_in\x22\x3eput\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x222\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22key\x22\x3c\/span\x3e);\nobjectStore1.\x3cspan class=\x22hljs-built_in\x22\x3eput\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x221\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22key\x22\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3ecursor: 主要是用来遍历 DB 里面的数据内容。主要是通过 \x3ccode\x3eopenCursor\x3c\/code\x3e 来进行控制。\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function displayData() {\n  var transaction = db.transaction([\x27rushAlbumList\x27], \x26quot;readonly\x26quot;);\n  var objectStore = transaction.objectStore(\x27rushAlbumList\x27);\n\n  objectStore.openCursor().onsuccess = function(event) {\n    var cursor = event.target.result;\n    if(cursor) {\n      var listItem = document.createElement(\x27li\x27);\n      listItem.innerHTML = cursor.value.albumTitle \x2b \x27, \x27 \x2b cursor.value.year;\n      list.appendChild(listItem);  \n\n      cursor.continue();\n    } else {\n      console.log(\x27Entries all displayed.\x27);\n    }\n  };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edisplayData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e transaction = db.transaction([\x3cspan class=\x22hljs-string\x22\x3e\x27rushAlbumList\x27\x3c\/span\x3e], \x3cspan class=\x22hljs-string\x22\x3e\x22readonly\x22\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e objectStore = transaction.objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27rushAlbumList\x27\x3c\/span\x3e);\n\n  objectStore.openCursor().onsuccess = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cursor = event.target.result;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(cursor) {\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e listItem = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e);\n      listItem.innerHTML = cursor.value.albumTitle \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27, \x27\x3c\/span\x3e \x2b cursor.value.year;\n      list.appendChild(listItem);  \n\n      cursor.continue();\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Entries all displayed.\x27\x3c\/span\x3e);\n    }\n  };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e如何使用 IndexDB\x3c\/h2\x3e\n\x3cp\x3e上面说了几个基本的概念。那接下来我们实践一下 IndexDB。实际上入门 IndexDB 就是做几个基本的内容\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e打开数据库表\x3c\/li\x3e\n\x3cli\x3e设置指定的 primary Key\x3c\/li\x3e\n\x3cli\x3e定义好索引的 index\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e前期搭建一个 IndexedDB 很简单的代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var request = indexedDB.open(dbName, 2);\n\nrequest.onerror = function(event) {\n  \/\/ 错误处理程序在这里。\n};\nrequest.onupgradeneeded = function(event) {\n  var db = event.target.result;\n  \/\/ 设置 id 为 primaryKey 参数\n  var objectStore = db.createObjectStore(\x26quot;customers\x26quot;, { keyPath: \x26quot;id\x26quot;,{autoIncrement:true} });\n  \n  \/\/ 设置指定索引，并确保唯一性\n  objectStore.createIndex(\x26quot;name\x26quot;, \x26quot;name\x26quot;, { unique: false });\n  objectStore.createIndex(\x26quot;email\x26quot;, \x26quot;email\x26quot;, { unique: true });\n\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e request = indexedDB.open(dbName, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);\n\nrequest.onerror = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 错误处理程序在这里。\x3c\/span\x3e\n};\nrequest.onupgradeneeded = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e db = event.target.result;\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置 id 为 primaryKey 参数\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e objectStore = db.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22customers\x22\x3c\/span\x3e, { keyPath: \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e,{autoIncrement:\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e} });\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置指定索引，并确保唯一性\x3c\/span\x3e\n  objectStore.createIndex(\x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e, { unique: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e });\n  objectStore.createIndex(\x3cspan class=\x22hljs-string\x22\x3e\x22email\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22email\x22\x3c\/span\x3e, { unique: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e });\n\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面主要做了 3 件事：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e打开数据库表\x3c\/li\x3e\n\x3cli\x3e新建 Store，并设置 primary Key\x3c\/li\x3e\n\x3cli\x3e设置 index\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e打开数据库表主要就是版本号和名字，没有太多讲的，我们直接从创建 store 开始吧。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e创建 Object Store\x3c\/h3\x3e\n\x3cp\x3e使用的方法就是 IDBDatabase 上的 \x3ccode\x3ecreateObjectStore\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var objectStore = db.createObjectStore(\x26quot;customers\x26quot;, { keyPath: \x26quot;id\x26quot;,{autoIncrement:true} });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3evar objectStore = db.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22customers\x22\x3c\/span\x3e, { \x3cspan class=\x22hljs-string\x22\x3ekeyPath:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22id\x22\x3c\/span\x3e,{\x3cspan class=\x22hljs-string\x22\x3eautoIncrement:\x3c\/span\x3e\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e} });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e基本函数构造为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22IDBObjectStore createObjectStore(DOMString name,\n                                               optional IDBObjectStoreParameters options)\n                                               \ndictionary IDBObjectStoreParameters {\n  (DOMString or sequence\x3cDOMString\x3e)? keyPath = null;\n  boolean autoIncrement = false;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mipsasm\x22\x3e\x3ccode\x3eIDBObjectStore createObjectStore(DOMString name,\n                                               optional IDBObjectStoreParameters options)\n                                               \n\x3cspan class=\x22hljs-keyword\x22\x3edictionary \x3c\/span\x3eIDBObjectStoreParameters {\n  (DOMString \x3cspan class=\x22hljs-keyword\x22\x3eor \x3c\/span\x3esequence\x26lt;DOMString\x26gt;)? keyPath = null\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eboolean \x3c\/span\x3eautoIncrement = false\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n}\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\n\x3cli\x3ekeyPath: 用来设置主键的 key，具体区别可以参考下面的 keyPath 和 generator 的区别。\x3c\/li\x3e\n\x3cli\x3eautoIncrement: 是否使用自增 key 的特性。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e创建的 key 主要是为了保证，在数据插入时唯一性的标识。\x3c\/p\x3e\n\x3cp\x3e不过，往往一个主键(key)，是没办法很好的完成索引，在具体实践时，就还需要辅键 (aid-key) 来完成辅助索引工作，这个在 IndexDB 就映射为 \x3ccode\x3eindex\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e设置索引 index\x3c\/h3\x3e\n\x3cp\x3e在完成 PK(Primary key) 创建完毕后，为了更好的搜索性能我们还需要额外创建 \x3ccode\x3eindex\x3c\/code\x3e。这里可以直接使用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22objectStore.createIndex(\x27indexName\x27, \x27property\x27, options);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3eobjectStore.createIndex(\x27indexName\x27, \x27\x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e\x3c\/span\x3e\x27, options);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\n\x3cli\x3eindexName: 设置当前 index 的名字\x3c\/li\x3e\n\x3cli\x3eproperty: 从存储数据中，指明 index 所指的属性。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e其中，options 有三个选项：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eunique: 当前 key 是否能重复 (最常用)\x3c\/li\x3e\n\x3cli\x3emultiEntry: 设置当前的 property 为数组时，会给数组里面每个元素都设置一个 index 值。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# 创建一个名字叫 titleIndex 的 index，并且存储的 index 不能重复\nDB.createIndex(\x27titleIndex\x27, \x27title\x27, {unique: false});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs n1ql\x22\x3e\x3ccode\x3e# 创建一个名字叫 titleIndex 的 \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e，并且存储的 \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e 不能重复\nDB.createIndex(\x3cspan class=\x22hljs-string\x22\x3e\x27titleIndex\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27title\x27\x3c\/span\x3e, {\x3cspan class=\x22hljs-keyword\x22\x3eunique\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e具体可以参考：\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/IDBObjectStore\/createIndex#Parameters\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMDN createIndex Prop\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/developers.google.com\/web\/ilt\/pwa\/working-with-indexeddb\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egoogleDeveloper Index\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e增删数据\x3c\/h3\x3e\n\x3cp\x3e在 IndexedDB 里面进行数据的增删，都需要在 \x3ccode\x3e transaction\x3c\/code\x3e 中完成。而这个增删数据，大家可以理解为一次 \x3ccode\x3erequest\x3c\/code\x3e，相当于在一个 \x3ccode\x3etransaction\x3c\/code\x3e 里面管理所有当前逻辑操作的 \x3ccode\x3erequest\x3c\/code\x3e。所以，在正式开始进行数据操作之前，还需要给大家简单介绍一些如果创建一个事务。\x3c\/p\x3e\n\x3ch4\x3e事务的创建\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3etransaction\x3c\/code\x3e API，如下 [代码1]。在创建时，你需要手动指定当前 transaction 是那种类型的操作，基本的内容有：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x22readonly\x22：只读\x3c\/li\x3e\n\x3cli\x3e\x22readwrite\x22：读写\x3c\/li\x3e\n\x3cli\x3e\x22versionchange\x22：这个不能手动指定，会在 \x3ccode\x3eupgradeneeded\x3c\/code\x3e 回调事件里面自动创建。它可以用来修改现有 object store 的结构数据，比如 index 等。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e你可以通过在数据库打开之后，通过 \x3ccode\x3eIDBDataBase\x3c\/code\x3e 上的 \x3ccode\x3etransaction\x3c\/code\x3e 方法创建，如 [代码2]。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码1]\n  [NewObject] IDBTransaction transaction((DOMString or sequence\x3cDOMString\x3e) storeNames,\n                                         optional IDBTransactionMode mode = \x26quot;readonly\x26quot;);\n                                         \n[代码2]\nvar transaction = db.transaction([\x26quot;customers\x26quot;], \x26quot;readwrite\x26quot;);\nvar objectStore = transaction.objectStore(\x26quot;customers\x26quot;);\n# 遍历存储数据\nfor (var i in customerData) {\n  var request = objectStore.add(customerData[i]);\n  request.onsuccess = function(event) {\n    \/\/ success, done?\n  };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n  [NewObject] \x3cspan class=\x22hljs-function\x22\x3eIDBTransaction \x3cspan class=\x22hljs-title\x22\x3etransaction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e(DOMString or sequence\x26lt;DOMString\x26gt;\x3c\/span\x3e) storeNames,\n                                         optional IDBTransactionMode mode \x3c\/span\x3e= \x3cspan class=\x22hljs-string\x22\x3e\x22readonly\x22\x3c\/span\x3e);\n                                         \n[代码\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e transaction = db.transaction([\x3cspan class=\x22hljs-string\x22\x3e\x22customers\x22\x3c\/span\x3e], \x3cspan class=\x22hljs-string\x22\x3e\x22readwrite\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e objectStore = transaction.objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22customers\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-meta\x22\x3e# 遍历存储数据\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e customerData) {\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e request = objectStore.\x3cspan class=\x22hljs-keyword\x22\x3eadd\x3c\/span\x3e(customerData[i]);\n  request.onsuccess = function(\x3cspan class=\x22hljs-keyword\x22\x3eevent\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ success, done?\x3c\/span\x3e\n  };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e事务在创建的时候不仅仅可以制定执行的模式，还可以指定本次事务能够影响的 ObjectStore 范围，具体细节就是在第一个 \x3ccode\x3etransaction\x3c\/code\x3e 参数里面传入的是一个数据，然后通过 \x3ccode\x3eobjectStore()\x3c\/code\x3e 方法打开多个 OS 进行操作，如下 [代码3]。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码3]\nvar tx = db.transaction([\x26quot;books\x26quot;,\x26quot;person\x26quot;], \x26quot;readonly\x26quot;);\nvar books = tx.objectStore(\x26quot;books\x26quot;);\nvar person = tx.objectStore(\x26quot;person\x26quot;);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mipsasm\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e]\nvar tx = db.transaction([\x3cspan class=\x22hljs-string\x22\x3e\x22books\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22person\x22\x3c\/span\x3e], \x3cspan class=\x22hljs-string\x22\x3e\x22readonly\x22\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\nvar \x3cspan class=\x22hljs-keyword\x22\x3ebooks \x3c\/span\x3e= tx.objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22books\x22\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\nvar person = tx.objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22person\x22\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e操作数据\x3c\/h4\x3e\n\x3cp\x3e完成了事务的创建之后，我们就可以正式的开始进行数据的交互操作了，也就是写我们具体的业务逻辑。如下 [代码1]，一个完整数据事务的操作。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码1]\nvar tx = db.transaction(\x26quot;books\x26quot;, \x26quot;readwrite\x26quot;);\nvar store = tx.objectStore(\x26quot;books\x26quot;);\n\nstore.put({title: \x26quot;Quarry Memories\x26quot;, author: \x26quot;Fred\x26quot;, isbn: 123456});\nstore.put({title: \x26quot;Water Buffaloes\x26quot;, author: \x26quot;Fred\x26quot;, isbn: 234567});\nstore.put({title: \x26quot;Bedrock Nights\x26quot;, author: \x26quot;Barney\x26quot;, isbn: 345678});\n\ntx.oncomplete = function() {\n  \/\/ All requests have succeeded and the transaction has committed.\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\nvar tx = db.transaction(\x3cspan class=\x22hljs-string\x22\x3e\x22books\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22readwrite\x22\x3c\/span\x3e);\nvar store = tx.objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22books\x22\x3c\/span\x3e);\n\nstore.put({\x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22Quarry Memories\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22Fred\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eisbn:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e123456\x3c\/span\x3e});\nstore.put({\x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22Water Buffaloes\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22Fred\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eisbn:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e234567\x3c\/span\x3e});\nstore.put({\x3cspan class=\x22hljs-string\x22\x3etitle:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22Bedrock Nights\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eauthor:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22Barney\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eisbn:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e345678\x3c\/span\x3e});\n\ntx.oncomplete = function() {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ All requests have succeeded and the transaction has committed.\x3c\/span\x3e\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过 \x3ccode\x3eobjectStore\x3c\/code\x3e 回调得到的 IDBObjectStore 对象，我们就可以进行一些列的增删查改操作了。可以参考 [代码2]。详细的可以参考文末的 \x3ccode\x3eappendix\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码2]\n  [NewObject] IDBRequest put(any value, optional any key);\n  [NewObject] IDBRequest add(any value, optional any key);\n  [NewObject] IDBRequest delete(any query);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs q\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]\n  [NewObject] IDBRequest put(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3evalue\x3c\/span\x3e, optional \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ekey\x3c\/span\x3e);\n  [NewObject] IDBRequest add(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3evalue\x3c\/span\x3e, optional \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ekey\x3c\/span\x3e);\n  [NewObject] IDBRequest \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e索引数据\x3c\/h4\x3e\n\x3cp\x3e索引数据是所有数据库里面最重要的一个。这里，我们可以使用游标，index 来做。例如，通过 index 来快速索引  key 值，参考 [代码1]。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码1]\nvar index = objectStore.index(\x26quot;name\x26quot;);\nindex.get(\x26quot;Donna\x26quot;).onsuccess = function(event) {\n  alert(\x26quot;Donna\x27s SSN is \x26quot; \x2b event.target.result.ssn);\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e index = objectStore.index(\x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e);\nindex.get(\x3cspan class=\x22hljs-string\x22\x3e\x22Donna\x22\x3c\/span\x3e).onsuccess = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{\n  alert(\x3cspan class=\x22hljs-string\x22\x3e\x22Donna\x27s SSN is \x22\x3c\/span\x3e \x2b event.target.result.ssn);\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e更详细的内容，可以参考下文 \x3ca href=\x22#%E6%95%B0%E6%8D%AE%E7%B4%A2%E5%BC%95%E6%96%B9%E5%BC%8F\x22\x3e数据索引方式\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3ekeyPath 和 key Generator\x3c\/h3\x3e\n\x3cp\x3e何谓 keyPath 和 keyGenerator 应该算是 IndexedDB 里面比较难以理解的概念。简单来说，IndexedDB 在创建 Store 的时候，必须保证里面的数据是唯一的，那么得需要像其它数据库一样设置一个 \x3ccode\x3eprimary Key\x3c\/code\x3e 来区分不同数据。而 keyPath 和 Generator 就是两种不同的设置 key 的方式。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e设置 keyPath\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# 设置预先需要存放的数据\n\nconst customerData = [\n  { ssn: \x26quot;444-44-4444\x26quot;, name: \x26quot;Bill\x26quot;, age: 35, email: \x26quot;bill@company.com\x26quot; },\n  { ssn: \x26quot;555-55-5555\x26quot;, name: \x26quot;Donna\x26quot;, age: 32, email: \x26quot;donna@home.org\x26quot; }\n];\n\n# 通过 keyPath 设置 Primary Key\nvar objectStore = db.createObjectStore(\x26quot;customers\x26quot;, { keyPath: \x26quot;ssn\x26quot; });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs vala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e# 设置预先需要存放的数据\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e customerData = [\n  { ssn: \x3cspan class=\x22hljs-string\x22\x3e\x22444-44-4444\x22\x3c\/span\x3e, name: \x3cspan class=\x22hljs-string\x22\x3e\x22Bill\x22\x3c\/span\x3e, age: \x3cspan class=\x22hljs-number\x22\x3e35\x3c\/span\x3e, email: \x3cspan class=\x22hljs-string\x22\x3e\x22bill@company.com\x22\x3c\/span\x3e },\n  { ssn: \x3cspan class=\x22hljs-string\x22\x3e\x22555-55-5555\x22\x3c\/span\x3e, name: \x3cspan class=\x22hljs-string\x22\x3e\x22Donna\x22\x3c\/span\x3e, age: \x3cspan class=\x22hljs-number\x22\x3e32\x3c\/span\x3e, email: \x3cspan class=\x22hljs-string\x22\x3e\x22donna@home.org\x22\x3c\/span\x3e }\n];\n\n\x3cspan class=\x22hljs-meta\x22\x3e# 通过 keyPath 设置 Primary Key\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e objectStore = db.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22customers\x22\x3c\/span\x3e, { keyPath: \x3cspan class=\x22hljs-string\x22\x3e\x22ssn\x22\x3c\/span\x3e });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e因为 ssn 在该数据集是唯一的，所以，我们可以利用它来作为 \x3ccode\x3ekeyPath\x3c\/code\x3e 保证 \x3ccode\x3eunique\x3c\/code\x3e 的特性。或者，可以设置为自增的键值，比如 \x3ccode\x3eid\x2b\x2b\x3c\/code\x3e 类似的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22upgradeDb.createObjectStore(\x27logs\x27, {keyPath: \x27id\x27, autoIncrement:true});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3eupgradeDb.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27logs\x27\x3c\/span\x3e, {\x3cspan class=\x22hljs-string\x22\x3ekeyPath:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eautoIncrement:\x3c\/span\x3e\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e使用 generator\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3egenerator 会每次在添加数据时，自动创建一个 unique value。这个 unique value 是和你的实际数据是分开的。里面直接通过 \x3ccode\x3eautoIncrement:true\x3c\/code\x3e 来设置即可。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22upgradeDb.createObjectStore(\x27notes\x27, {autoIncrement:true});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3eupgradeDb.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27notes\x27\x3c\/span\x3e, {\x3cspan class=\x22hljs-string\x22\x3eautoIncrement:\x3c\/span\x3e\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3eindexDB 打开注意事项\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e检查是否支持 indexDB\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (!(\x27indexedDB\x27 in window)) {\n  console.log(\x27This browser doesn\\\x27t support IndexedDB\x27);\n  return;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(\x3cspan class=\x22hljs-string\x22\x3e\x27indexedDB\x27\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e)) {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27This browser doesn\\\x27t support IndexedDB\x27\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e版本更新: indexDB\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e在生成一个 indexDB 实例时，需要手动指定一个版本号。而最常用的\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22idb.open(\x27test-db7\x27, 2, function(upgradeDb) {})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lua\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3eidb.\x3cspan class=\x22hljs-built_in\x22\x3eopen\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27test-db7\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(upgradeDb)\x3c\/span\x3e\x3c\/span\x3e {})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样会造成一个问题，比如上线过程中，用户A第一次请求返回了新版本的网页，连接了版本2。之后又刷新网页命中了另一台未上线的机器，连接了旧版本1 出错。主要原因是：\x3c\/p\x3e\n\x3cblockquote\x3eindexedDB API 中不允许数据库中的数据仓库在同一版本中发生变化. 并且当前 DB 版本不能和低版本的 version 连接。\x3c\/blockquote\x3e\n\x3cp\x3e比如，你一开始定义的 DB 版本内容为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# 版本一定义的内容\ndb.version(1).stores({friends: \x26quot;\x2b\x2bid,name\x26quot;});\n\n# 版本二修改结构为：\ndb.version(2).stores({friends: \x26quot;\x2b\x2bid,name,shoeSize\x26quot;});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e# 版本一定义的内容\n\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.version\x3c\/span\x3e(1)\x3cspan class=\x22hljs-selector-class\x22\x3e.stores\x3c\/span\x3e({\x3cspan class=\x22hljs-attribute\x22\x3efriends\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\x2b\x2bid,name\x22\x3c\/span\x3e});\n\n# 版本二修改结构为：\n\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.version\x3c\/span\x3e(2)\x3cspan class=\x22hljs-selector-class\x22\x3e.stores\x3c\/span\x3e({\x3cspan class=\x22hljs-attribute\x22\x3efriends\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\x2b\x2bid,name,shoeSize\x22\x3c\/span\x3e});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果此时，用户先打开了 version(1)，但是后面，又得到的是 version(2) 版本的 HTML，这时就会出现 error 的错误。\x3c\/p\x3e\n\x3cp\x3e参考:\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/dexie.org\/docs\/Tutorial\/Design#database-versioning\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e版本更替\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e版本更新\x3c\/h3\x3e\n\x3cp\x3e这个在 IndexDB 是一个很重要的问题。主要原因在于\x3c\/p\x3e\n\x3cblockquote\x3eindexedDB API 中不允许数据库中的数据仓库在同一版本中发生变化. 并且当前 DB 版本不能和低版本的 version 连接。\x3c\/blockquote\x3e\n\x3cp\x3e上面就可以抽象为一个问题：\x3c\/p\x3e\n\x3cblockquote\x3e你什么情况下需要更新 IndexDB 的版本呢?\x3c\/blockquote\x3e\n\x3col\x3e\n\x3cli\x3e该表数据库里面的 \x3ccode\x3ekeyPath\x3c\/code\x3e 时。\x3c\/li\x3e\n\x3cli\x3e你需要重新设计数据库表结构时，比如新增 index\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# 版本 1 的 DB 设计，有一个主键 id 和 index-name\ndb\n.version(1)\n.stores({friends: \x27\x2b\x2bid,name\x27})\n\n# 如果直接想新增一个 key，例如 male，是无法成功的\ndb\n.version(1)\n.stores({friends: \x27\x2b\x2bid,name,male\x27})\n\n# 正确办法是直接修改版本号更新\ndb\n.version(2)\n.stores({friends: \x27\x2b\x2bid,name,male\x27})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e# 版本 1 的 \x3cspan class=\x22hljs-selector-tag\x22\x3eDB\x3c\/span\x3e 设计，有一个主键 \x3cspan class=\x22hljs-selector-tag\x22\x3eid\x3c\/span\x3e 和 \x3cspan class=\x22hljs-selector-tag\x22\x3eindex-name\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-class\x22\x3e.version\x3c\/span\x3e(1)\n\x3cspan class=\x22hljs-selector-class\x22\x3e.stores\x3c\/span\x3e({\x3cspan class=\x22hljs-attribute\x22\x3efriends\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x2b\x2bid,name\x27\x3c\/span\x3e})\n\n# 如果直接想新增一个 \x3cspan class=\x22hljs-selector-tag\x22\x3ekey\x3c\/span\x3e，例如 \x3cspan class=\x22hljs-selector-tag\x22\x3emale\x3c\/span\x3e，是无法成功的\n\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-class\x22\x3e.version\x3c\/span\x3e(1)\n\x3cspan class=\x22hljs-selector-class\x22\x3e.stores\x3c\/span\x3e({\x3cspan class=\x22hljs-attribute\x22\x3efriends\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x2b\x2bid,name,male\x27\x3c\/span\x3e})\n\n# 正确办法是直接修改版本号更新\n\x3cspan class=\x22hljs-selector-tag\x22\x3edb\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-class\x22\x3e.version\x3c\/span\x3e(2)\n\x3cspan class=\x22hljs-selector-class\x22\x3e.stores\x3c\/span\x3e({\x3cspan class=\x22hljs-attribute\x22\x3efriends\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x2b\x2bid,name,male\x27\x3c\/span\x3e})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e不过，如果直接修改版本号，会出现这样一个 case:\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e由于原始 HTML 更新问题，用户首先访问的是版本 1 的 A 页面，然后，访问更新过后的 B 页面。这时，IndexDB 成功更新为高版本。但是，用户下次又命中了老版本的 A 页面，此时 A 中还是连接低版本的 IndexDB ,就会报错，导致你访问失败。\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e解决办法就是，设置过滤，在 \x3ccode\x3eopen\x3c\/code\x3e 的时候，手动传入版本号：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# 打开版本 1 的数据库\nvar dbPromise = idb.open(\x27db1\x27, 1, function(upgradeDb){...})\n\n# 打开版本 2 的数据库\nvar dbPromise = idb.open(\x27db2\x27, 2, function(upgradeDb){...})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e# 打开版本 1 的数据库\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dbPromise = idb.open(\x27db1\x27, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, function(upgradeDb)\x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-comment\x22\x3e# 打开版本 2 的数据库\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dbPromise = idb.open(\x27db2\x27, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, function(upgradeDb)\x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e不过，这样又会造成另外一个问题，即，数据迁移（老版本数据，不可能不要吧）。这里，IndexDB 会有一个 updateCallback 给你触发，你可以直接在里面做相关的数据迁移处理。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var dbPromise = idb.open(\x27test-db7\x27, 2, function(upgradeDb) {\n  switch (upgradeDb.oldVersion) {\n    case 0:\n      upgradeDb.createObjectStore(\x27store\x27, {keyPath: \x27name\x27});\n    case 1:\n      var peopleStore = upgradeDb.transaction.objectStore(\x27store\x27);\n      peopleStore.createIndex(\x27price\x27, \x27price\x27);\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dbPromise = idb.open(\x3cspan class=\x22hljs-string\x22\x3e\x27test-db7\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(upgradeDb)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (upgradeDb.oldVersion) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e:\n      upgradeDb.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27store\x27\x3c\/span\x3e, {keyPath: \x3cspan class=\x22hljs-string\x22\x3e\x27name\x27\x3c\/span\x3e});\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e peopleStore = upgradeDb.transaction.objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27store\x27\x3c\/span\x3e);\n      peopleStore.createIndex(\x3cspan class=\x22hljs-string\x22\x3e\x27price\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27price\x27\x3c\/span\x3e);\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在使用的时候，一定要注意 DB 版本的升级处理，比如有这样一个 case，你的版本已经是 3，不过，你需要处理版本二的数据:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# 将版本二 中的 name 拆分为  firstName 和 lastName\ndb.version(3).stores({friends: \x26quot;\x2b\x2bid,shoeSize,firstName,lastName\x26quot;}).upgrade(function(t) {\n    \n    return t.friends.toCollection().modify(function(friend) {\n        \/\/ Modify each friend:\n        friend.firstName = friend.name.split(\x27 \x27)[0];\n        friend.lastName = friend.name.split(\x27 \x27)[1];\n        delete friend.name;\n    });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cpp\x22\x3e\x3ccode\x3e# 将版本二 中的 name 拆分为  firstName 和 lastName\ndb.version(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e).stores({friends: \x3cspan class=\x22hljs-string\x22\x3e\x22\x2b\x2bid,shoeSize,firstName,lastName\x22\x3c\/span\x3e}).upgrade(function(t) {\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e t.friends.toCollection().modify(function(\x3cspan class=\x22hljs-keyword\x22\x3efriend\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Modify each friend:\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efriend\x3c\/span\x3e.firstName = \x3cspan class=\x22hljs-keyword\x22\x3efriend\x3c\/span\x3e.name.split(\x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3efriend\x3c\/span\x3e.lastName = \x3cspan class=\x22hljs-keyword\x22\x3efriend\x3c\/span\x3e.name.split(\x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efriend\x3c\/span\x3e.name;\n    });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于存在版本 2 数据库的用户来说是 OK 的，但是对于某些还没有访问过你数据库的用户来说，这无疑就报错了。解决办法有：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e保留每个版本时，创建的字段和 stores\x3c\/li\x3e\n\x3cli\x3e在更新  callback 里面，对处理的数据判断是否存在即可。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e在 Dexie.js DB 数据库中，需要你保留每次 DB 创建的方法，实际上是通过 添加 swtich case ，来完成每个版本的更新：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# Dexie.js 保留 DB 数据库\ndb.version(1).stores({friends: \x26quot;\x2b\x2bid,name\x26quot;});\ndb.version(2).stores({friends: \x26quot;\x2b\x2bid,name,shoeSize\x26quot;});\ndb.version(3).stores({friends: \x26quot;\x2b\x2bid,shoeSize,firstName,lastName\x26quot;}).upgrade(...)\n\n# 内部原理，直接添加 switch case 完成版本更新\nvar dbPromise = idb.open(\x27test-db7\x27, 2, function(upgradeDb) {\n  switch (upgradeDb.oldVersion) {\n    case 0:\n      upgradeDb.createObjectStore(\x27store\x27, {keyPath: \x27name\x27});\n    case 1:\n      var peopleStore = upgradeDb.transaction.objectStore(\x27store\x27);\n      peopleStore.createIndex(\x27price\x27, \x27price\x27);\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e# Dexie.js 保留 DB 数据库\x3c\/span\x3e\ndb.version(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e).stores({friends: \x3cspan class=\x22hljs-string\x22\x3e\x22\x2b\x2bid,name\x22\x3c\/span\x3e});\ndb.version(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e).stores({friends: \x3cspan class=\x22hljs-string\x22\x3e\x22\x2b\x2bid,name,shoeSize\x22\x3c\/span\x3e});\ndb.version(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e).stores({friends: \x3cspan class=\x22hljs-string\x22\x3e\x22\x2b\x2bid,shoeSize,firstName,lastName\x22\x3c\/span\x3e}).upgrade(...)\n\n\x3cspan class=\x22hljs-comment\x22\x3e# 内部原理，直接添加 switch case 完成版本更新\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dbPromise = idb.open(\x3cspan class=\x22hljs-string\x22\x3e\x27test-db7\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(upgradeDb)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (upgradeDb.oldVersion) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e:\n      upgradeDb.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27store\x27\x3c\/span\x3e, {keyPath: \x3cspan class=\x22hljs-string\x22\x3e\x27name\x27\x3c\/span\x3e});\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e peopleStore = upgradeDb.transaction.objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27store\x27\x3c\/span\x3e);\n      peopleStore.createIndex(\x3cspan class=\x22hljs-string\x22\x3e\x27price\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27price\x27\x3c\/span\x3e);\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果遇到一个页面打开，但是另外一个页面拉取到新的代码进行更新时，这个时候还需要将低版本  indexedDB 进行显式的关闭。具体操作办法就是监听 \x3ccode\x3eonversionchange\x3c\/code\x3e 事件，当版本升级时，通知当前 DB 进行关闭，然后在新的页面进行更新操作。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22openReq.onupgradeneeded = function(event) {\n  \/\/ 所有其它数据库都已经被关掉了，直接更新代码\n  db.createObjectStore(\/* ... *\/);\n  db.onversionchange = function(event) {\n    db.close();\n  };\n\n}  \n  \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3eopenReq.onupgradeneeded = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所有其它数据库都已经被关掉了，直接更新代码\x3c\/span\x3e\n  db.createObjectStore(\x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e);\n  db.onversionchange = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{\n    db.close();\n  };\n\n}  \n  \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后，更新是还有几个注意事项：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e版本更新不能改变 primary key\x3c\/li\x3e\n\x3cli\x3e回退代码时，千万注意版本是否已经更新。否则，只能增量更新，重新修改版本号来修复。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e存储加密特性\x3c\/h2\x3e\n\x3cp\x3e有时候，我们存储时，想得到一个由一串 String 生成的 hash key，那在 Web 上应该如何实现呢？\x3c\/p\x3e\n\x3cp\x3e这里可以直接利用 Web 上已经实现的 \x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/SubtleCrypto\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebCrypto\x3c\/a\x3e，为了实现上述需求，我们可以直接利用里面的 \x3ccode\x3edigest\x3c\/code\x3e 方法即可。这里 MDN 上，已经有现成的办法，我们直接使用即可。\x3c\/p\x3e\n\x3cp\x3e参考：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/SubtleCrypto\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebCrypto 加密手段\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e存储上限值\x3c\/h2\x3e\n\x3cp\x3e基本限制为：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth align=\x22left\x22\x3e浏览器\x3c\/th\x3e\n\x3cth align=\x22left\x22\x3e限制\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eChrome\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e可用空间 \x26lt; 6%\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eFirebox\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e可用空间 \x26lt; 10%\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eSafari\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e\x26lt; 50MB\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eIE10\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e\x26lt; 250MB\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e逐出策略为:\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth align=\x22left\x22\x3e浏览器\x3c\/th\x3e\n\x3cth align=\x22left\x22\x3e逐出政策\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eChrome\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e在 Chrome 耗尽空间后采用 LRU 策略\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eFirebox\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e在整个磁盘已装满时采用 LRU 策略\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eSafari\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e无逐出\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22left\x22\x3eEdge\x3c\/td\x3e\n\x3ctd align=\x22left\x22\x3e无逐出\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e参考：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/IndexedDB_API#gloss_key_path\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e存储上限值\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/developers.google.com\/web\/fundamentals\/instant-and-offline\/web-storage\/offline-for-pwa?hl=zh-cn\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e浏览器内核存储上限值处理\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e数据索引方式\x3c\/h2\x3e\n\x3cp\x3e在数据库中除了基本的 CRUD 外，一个高效的索引架构，则是里面的重中之重。在 indexedDB 中，我们一共可以通过三种方式来索引数据：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e固定的 key 值\x3c\/li\x3e\n\x3cli\x3e索引外键（index）\x3c\/li\x3e\n\x3cli\x3e游标（cursor）\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e固定 key 索引\x3c\/h3\x3e\n\x3cp\x3eIDBObjectStore 提供给了我们直接通过 \x3ccode\x3eprimaryKey\x3c\/code\x3e 来索引数据，参考 [代码1]，这种方式需要我们一开始就知道目标的 \x3ccode\x3ekey\x3c\/code\x3e 内容。当然，也可以通过 \x3ccode\x3egetAll\x3c\/code\x3e 全部索引数据。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码1]\n  [NewObject] IDBRequest get(any query);\n  [NewObject] IDBRequest getKey(any query);\n  [NewObject] IDBRequest getAll(optional any query,\n                                optional [EnforceRange] unsigned long count);\n  [NewObject] IDBRequest getAllKeys(optional any query,\n                                    optional [EnforceRange] unsigned long count);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fortran\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n  [NewObject] IDBRequest get(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query);\n  [NewObject] IDBRequest getKey(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query);\n  [NewObject] IDBRequest getAll(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e [EnforceRange] unsigned long \x3cspan class=\x22hljs-built_in\x22\x3ecount\x3c\/span\x3e);\n  [NewObject] IDBRequest getAllKeys(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                    \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e [EnforceRange] unsigned long \x3cspan class=\x22hljs-built_in\x22\x3ecount\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e比如，我们通过 primaryKey 得到一条具体的数据：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.transaction(\x26quot;customers\x26quot;).objectStore(\x26quot;customers\x26quot;).get(\x26quot;id_card_1118899\x26quot;).onsuccess = function(event) {\n    \/\/ data is event.target.result.name\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3edb.transaction(\x3cspan class=\x22hljs-string\x22\x3e\x22customers\x22\x3c\/span\x3e).objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22customers\x22\x3c\/span\x3e).get(\x3cspan class=\x22hljs-string\x22\x3e\x22id_card_1118899\x22\x3c\/span\x3e).onsuccess = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ data is event.target.result.name\x3c\/span\x3e\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e也可以 fetch 整个 Object Store 的数据。这些场景用处比较少，这里就不过多讲解。我们主要来了解一下 index 的索引方式。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3eindex 索引\x3c\/h3\x3e\n\x3cp\x3e如果想要查询某个数据，直接通过整个对象来进行遍历的话，这样做性能耗时是非常大的。如果我们结合 \x3ccode\x3eindex\x3c\/code\x3e 来将 key 加以分类，就可以很快速的实现指定数据的索引。这里，我们可以直接利用 IDBObjectStore 上面的 \x3ccode\x3eindex()\x3c\/code\x3e 方法来获取指定 index 的值，具体方法可以参考 [代码1]。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码1]\n IDBIndex index(DOMString name);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs delphi\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n IDBIndex \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e(DOMString \x3cspan class=\x22hljs-keyword\x22\x3ename\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该方法会直接返回一个 IDBIndex 对象。这你也可以理解为一个类似 ObjectStore 的微型 index 数据内容。接着，我们可以使用 \x3ccode\x3eget()\x3c\/code\x3e 方法来获得指定 index 的数据，参考[代码2]。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码2]\nvar index = objectStore.index(\x26quot;name\x26quot;);\nindex.get(\x26quot;Donna\x26quot;).onsuccess = function(event) {\n  alert(\x26quot;Donna\x27s SSN is \x26quot; \x2b event.target.result.ssn);\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e index = objectStore.index(\x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e);\nindex.get(\x3cspan class=\x22hljs-string\x22\x3e\x22Donna\x22\x3c\/span\x3e).onsuccess = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{\n  alert(\x3cspan class=\x22hljs-string\x22\x3e\x22Donna\x27s SSN is \x22\x3c\/span\x3e \x2b event.target.result.ssn);\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用 \x3ccode\x3eget\x3c\/code\x3e 方法不管你的 index 是否是 \x3ccode\x3eunique\x3c\/code\x3e 的都会只会返回第一个数据。如果想得到多个数据的话，可以使用 \x3ccode\x3egetAll(key)\x3c\/code\x3e 来做。通过 \x3ccode\x3egetAll()\x3c\/code\x3e 得到的回调函数，直接通过 \x3ccode\x3eevent.target.result\x3c\/code\x3e 可以得到对应的 value 内容。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22objectStore.getAll().onsuccess = function(event) {\n      printf(event.target.result); \/\/ Array\n    };\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scilab\x22\x3e\x3ccode\x3eobjectStore.getAll().onsuccess = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e {\x3c\/span\x3e\n      \x3cspan class=\x22hljs-built_in\x22\x3eprintf\x3c\/span\x3e(event.target.result); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Array\x3c\/span\x3e\n    };\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e除了通过 \x3ccode\x3egetAll()\x3c\/code\x3e 得到所有数据外，还可以采用更高效的 \x3ccode\x3ecursor\x3c\/code\x3e 方法遍历得到的数据。\x3c\/p\x3e\n\x3cp\x3e参考：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/googlechrome.github.io\/samples\/idb-getall\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egetAll() 和 openCursor 实例\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e游标索引\x3c\/h3\x3e\n\x3cp\x3e所谓的游标，大家心里应该可以有一个初步的印象，就像我们物理尺子上的那个东西，可以自由的移动，来标识指向的对象内容。cursor 里面有两个核心的方法：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eadvance(count): 将当前游标位置向前移动 count 位置\x3c\/li\x3e\n\x3cli\x3econtinue(key): 将当前游标位置移动到指定 key 的位置，如果没提供 key 则代表的移动下一个位置。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e比如，我们使用 cursor 来遍历 Object Store 的具体数据。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22objectStore.openCursor().onsuccess = function(event) {\n    var cursor = event.target.result;\n    if(cursor) {\n        \/\/ cursor.key \n        \/\/ cursor.value\n      cursor.continue();\n    } else {\n      console.log(\x27Entries all displayed.\x27);\n    }\n  };\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3eobjectStore.openCursor().onsuccess = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cursor = event.target.result;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(cursor) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ cursor.key \x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ cursor.value\x3c\/span\x3e\n      cursor.continue();\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Entries all displayed.\x27\x3c\/span\x3e);\n    }\n  };\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通常，游标可以用来遍历两个类型的数据，一个是 ObjectStore、一个是 Index。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eObject.store: 如果在该对象上使用游标，那么会根据 \x3ccode\x3eprimaryKey\x3c\/code\x3e 遍历整个数据，注意，这里不会存在重复的情况，因为 \x3ccode\x3eprimaryKey\x3c\/code\x3e 是唯一的。\x3c\/li\x3e\n\x3cli\x3eindex: 在 index 上使用游标的话，会以当前的 index 来进行遍历，其中可能会存在重复的现象。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e在 IDBObjectStore 对象上有两种方法来打开游标：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eopenCursor: 遍历的对象是 具体的数据值，最常用的方法\x3c\/li\x3e\n\x3cli\x3eopenKeyCursor: 遍历的对象是 数据 key 值\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e这里，我们通过 \x3ccode\x3eopenCursor\x3c\/code\x3e 来直接打开一个 index 数据集，然后进行遍历。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22PersonIndex.openCursor().onsuccess = function(event) {\n  var cursor = event.target.result;\n  if (cursor) {\n    customers.push(cursor.value);\n    cursor.continue();\n  }\n  else {\n    alert(\x26quot;Got all customers: \x26quot; \x2b customers);\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs arduino\x22\x3e\x3ccode\x3ePersonIndex.openCursor().onsuccess = function(event) {\n  var \x3cspan class=\x22hljs-built_in\x22\x3ecursor\x3c\/span\x3e = event.target.result;\n  \x3cspan class=\x22hljs-built_in\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3ecursor\x3c\/span\x3e) {\n    customers.push(\x3cspan class=\x22hljs-built_in\x22\x3ecursor\x3c\/span\x3e.value);\n    \x3cspan class=\x22hljs-built_in\x22\x3ecursor\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3econtinue\x3c\/span\x3e();\n  }\n  \x3cspan class=\x22hljs-built_in\x22\x3eelse\x3c\/span\x3e {\n    alert(\x3cspan class=\x22hljs-string\x22\x3e\x22Got all customers: \x22\x3c\/span\x3e \x2b customers);\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在游标中，还提供给了一个 \x3ccode\x3eupdate\x3c\/code\x3e 和 \x3ccode\x3edelete\x3c\/code\x3e 方法，我们可以用它来进行数据的更新操作，否则的话就直接使用  ObjectStore 提供的 \x3ccode\x3eput\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3cp\x3e游标里面我们还可以限定其遍历的范围和方向。这个设置是我们直接在 \x3ccode\x3eopenCursor()\x3c\/code\x3e 方法里面传参完成的，该方法的构造函数参考 [代码1]。他里面可以传入两个参数，第一个用来指定范围，第二个用来指定 \x3ccode\x3ecursor\x3c\/code\x3e 移动的方向。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码1]\nIDBRequest openCursor(optional any query,\n                                    optional IDBCursorDirection direction = \x26quot;next\x26quot;);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fortran\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\nIDBRequest openCursor(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                    \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e IDBCursorDirection direction = \x3cspan class=\x22hljs-string\x22\x3e\x22next\x22\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果需要对 cursor 设置范围的话，就需要使用到 \x3ccode\x3eIDBKeyRange\x3c\/code\x3e 这个对象，使用样板可以参考 [代码2]。IDBKeyRange 里面 key 参考的对象 因使用者的不同而不同。如果是针对 ObjectStore 的话，则是针对 primaryKey，如果是针对 Index 的话，则是针对当前的 indexKey\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/ 匹配所有在 “Bill” 前面的, 但是不需要包括 \x26quot;Bill\x26quot;\nvar lowerBoundOpenKeyRange = IDBKeyRange.lowerBound(\x26quot;Bill\x26quot;, true);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\/ 匹配所有在 “Bill” 前面的, 但是不需要包括 \x3cspan class=\x22hljs-string\x22\x3e\x22Bill\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e lowerBoundOpenKeyRange = IDBKeyRange.lowerBound(\x3cspan class=\x22hljs-string\x22\x3e\x22Bill\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e比如，我们这里对 PersonIndex 设置一个 index 范围，即，索引 在 \x3ccode\x3evillainhr\x3c\/code\x3e 和 \x3ccode\x3ejimmyVV\x3c\/code\x3e 之间的数据集合。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# 都包括 villainhr 和 jimmyVV 的数据\nvar boundKeyRange = IDBKeyRange.bound(\x26quot;villainhr\x26quot;, \x26quot;jimmyVV\x26quot;, true, true);\n\n PersonIndex.openCursor(boundKeyRange).onsuccess = function(event) {\n  var cursor = event.target.result;\n  if (cursor) {\n    \/\/ Do something with the matches.\n    cursor.continue();\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e# 都包括 villainhr 和 jimmyVV 的数据\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e boundKeyRange = IDBKeyRange.bound(\x3cspan class=\x22hljs-string\x22\x3e\x22villainhr\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22jimmyVV\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e);\n\n PersonIndex.openCursor(boundKeyRange).onsuccess = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cursor = event.target.result;\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (cursor) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Do something with the matches.\x3c\/span\x3e\n    cursor.\x3cspan class=\x22hljs-keyword\x22\x3econtinue\x3c\/span\x3e();\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果你还想设置遍历的方向和是否排除重复数据，还可以根据 [代码2] 的枚举类型来设置。比如，在 [代码3] 中，我们改变默认的 cursor 遍历数据的方向为 \x3ccode\x3eprev\x3c\/code\x3e，从末尾开始。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码2]\nenum IDBCursorDirection {\n  \x26quot;next\x26quot;,\n  \x26quot;nextunique\x26quot;,\n  \x26quot;prev\x26quot;,\n  \x26quot;prevunique\x26quot;\n};\n\n[代码3]\nobjectStore.openCursor(null, IDBCursor.prev).onsuccess = function(event) {\n  var cursor = event.target.result;\n  if (cursor) {\n    \/\/ cursor.value \n    cursor.continue();\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eenum\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eIDBCursorDirection\x3c\/span\x3e {\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22next\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22nextunique\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22prev\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22prevunique\x22\x3c\/span\x3e\n};\n\n[代码\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e]\nobjectStore.openCursor(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, IDBCursor.prev).onsuccess = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(event) {\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cursor = event.target.result;\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (cursor) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ cursor.value \x3c\/span\x3e\n    cursor.\x3cspan class=\x22hljs-keyword\x22\x3econtinue\x3c\/span\x3e();\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader16\x22\x3e事务读取性能\x3c\/h2\x3e\n\x3cp\x3e在 indexDB 里面的读写全部是基于 \x3ccode\x3etransaction\x3c\/code\x3e 模式来的。也就是 IDBDataBase 里面的 \x3ccode\x3etransaction\x3c\/code\x3e 方法，如下 [代码1]。所有的读写都可以比作在 \x3ccode\x3etransaction\x3c\/code\x3e 作用域下的请求，只有当所有请求完成之后，该次 \x3ccode\x3etransaction\x3c\/code\x3e 才会生效，否则就会抛出异常或者错误。\x3ccode\x3etransaction\x3c\/code\x3e 会根据监听 error，abort，以及 complete 三个事件来完成整个事务的流程管理，参考[代码2]。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[代码1]\n  [NewObject] IDBTransaction transaction((DOMString or sequence\x3cDOMString\x3e) storeNames,\n                                         optional IDBTransactionMode mode = \x26quot;readonly\x26quot;);\n\n[代码2]\n  attribute EventHandler onabort;\n  attribute EventHandler oncomplete;\n  attribute EventHandler onerror;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mipsasm\x22\x3e\x3ccode\x3e[代码\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n  [NewObject] IDBTransaction transaction((DOMString \x3cspan class=\x22hljs-keyword\x22\x3eor \x3c\/span\x3esequence\x26lt;DOMString\x26gt;) storeNames,\n                                         optional IDBTransactionMode mode = \x3cspan class=\x22hljs-string\x22\x3e\x22readonly\x22\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n\n[代码\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e]\n  attribute EventHandler onabort\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n  attribute EventHandler oncomplete\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n  attribute EventHandler onerror\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var request = db.transaction([\x26quot;customers\x26quot;], \x26quot;readwrite\x26quot;)\n                .objectStore(\x26quot;customers\x26quot;)\n                .delete(\x26quot;gg\x26quot;);\nrequest.onsuccess = function(event) {\n  \/\/ delete, done\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e request = db.transaction([\x3cspan class=\x22hljs-string\x22\x3e\x22customers\x22\x3c\/span\x3e], \x3cspan class=\x22hljs-string\x22\x3e\x22readwrite\x22\x3c\/span\x3e)\n                .objectStore(\x3cspan class=\x22hljs-string\x22\x3e\x22customers\x22\x3c\/span\x3e)\n                .delete(\x3cspan class=\x22hljs-string\x22\x3e\x22gg\x22\x3c\/span\x3e);\nrequest.onsuccess = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ delete, done\x3c\/span\x3e\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你可以在 \x3ccode\x3etransaction\x3c\/code\x3e 方法里面手动传入 \x3ccode\x3ereadwrite\x3c\/code\x3e 或者其他表示事务的 \x3ccode\x3ereadonly\x3c\/code\x3e 参数，来表示本次事务你会进行如何的操作。IndexedDB 在初始设计时，就已经决定了它的性能问题。\x3c\/p\x3e\n\x3cblockquote\x3e只含有 readonly 模式的 transaction 可以并发进行执行\x3cbr\x3e含有 write 模式的 transaction 必须按照队列 来 执行\x3c\/blockquote\x3e\n\x3cp\x3e这就意味着，如果你使用了 \x3ccode\x3ereadwrite\x3c\/code\x3e 模式的话，那么后续不管是不是 \x3ccode\x3ereadonly\x3c\/code\x3e 都必须等待该次 transaction 完成才行。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader17\x22\x3e常用技巧\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader18\x22\x3e生成 id\x2b\x2b 的主键\x3c\/h3\x3e\n\x3cp\x3e指定 primaryKey 生成时，是通过 \x3ccode\x3ecreateObjectStore\x3c\/code\x3e 方法来操作的。有时候，我们会遇到想直接得到一个 key，并且存在于当前数据集中，可以在 options 中同时加上 \x3ccode\x3ekeyPath\x3c\/code\x3e 和 \x3ccode\x3eautoIncrement\x3c\/code\x3e 属性。该 key 的范围是 [1- $ 2^{53} $]，参考 \x3ca href=\x22https:\/\/www.w3.org\/TR\/IndexedDB\/#key-generator-construct\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ekeygenerator key 的大小\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.createObjectStore(\x27table1\x27, {keyPath: \x27id\x27, autoIncrement: true});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3edb.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27table1\x27\x3c\/span\x3e, {\x3cspan class=\x22hljs-string\x22\x3ekeyPath:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3eautoIncrement:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader19\x22\x3e推荐\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e阅读推荐\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.w3.org\/TR\/IndexedDB\/#cursor-interface\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eindexedDB W3C 文档 \x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/developers.google.com\/web\/ilt\/pwa\/working-with-indexeddb#data_storage_limits\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eindexedDB 入门\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/IndexedDB_API\/Using_IndexedDB\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMDN indexedDB 入门\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e好用库推荐\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/jakearchibald\/idb\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eidb: 一个  promise 的 DB 库\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader20\x22\x3eIndexed Appendix\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3eIndexedDB 数据库使用key-value键值对储存数据.你可以对对象的某个属性创建索引（index）以实现快速查询和列举排序。.key可以使二进制对象\x3c\/li\x3e\n\x3cli\x3eIndexedDB 是事务模式的数据库.  IndexedDB API提供了索引(indexes), 表(tables), 指针(cursors)等等, 但是所有这些必须是依赖于某种事务的。\x3c\/li\x3e\n\x3cli\x3eThe IndexedDB API 基本上是异步的.\x3c\/li\x3e\n\x3cli\x3eIndexedDB 数据库的请求都会包含 onsuccess和onerror事件属性。\x3c\/li\x3e\n\x3cli\x3eIndexedDB 在结果准备好之后通过DOM事件通知用户\x3c\/li\x3e\n\x3cli\x3eIndexedDB是面向对象的。indexedDB不是用二维表来表示集合的关系型数据库。这一点非常重要，将影响你设计和建立你的应用程序。\x3c\/li\x3e\n\x3cli\x3eindexedDB不使用结构化查询语言（SQL）。它通过索引(index)所产生的指针(cursor)来完成查询操作，从而使你可以迭代遍历到结果集合。\x3c\/li\x3e\n\x3cli\x3eIndexedDB遵循同源（same-origin）策略\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader21\x22\x3e局限和移除 case\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e全球多种语言混合存储。国际化支持不好。需要自己处理。\x3c\/li\x3e\n\x3cli\x3e和服务器端数据库同步。你得自己写同步代码。\x3c\/li\x3e\n\x3cli\x3e全文搜索。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e在以下情况下，数据库可能被清除:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e用户请求清除数据。\x3c\/li\x3e\n\x3cli\x3e浏览器处于隐私模式。最后退出浏览器的时候，数据会被清除。\x3c\/li\x3e\n\x3cli\x3e硬盘等存储设备的容量到限。\x3c\/li\x3e\n\x3cli\x3e不正确的\x3c\/li\x3e\n\x3cli\x3e不完整的改变.\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader22\x22\x3e常规概念\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e数据库\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e数据库: 通常包含一个或多个 object stores. 每个数据库必须包含以下内容：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e名字(Name)： 它标识了一个特定源中的数据库，并且在数据库的整个生命周期内保持不变.  此名字可以为任意字符串值（包括空字符串）.\x3c\/li\x3e\n\x3cli\x3e当前版本(version). 当一个数据库首次创建时，它的 version 为1，除非另外指定. 每个数据库在任意时刻只能有一个 version\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e对象存储(object store): 用来承载数据的一个分区.数据以键值对形式被对象存储永久持有。在 OS 中，创建一个 key 可以使用 \x3ccode\x3ekey generator\x3c\/code\x3e 和 \x3ccode\x3ekey path\x3c\/code\x3e。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3ekey generator: 简单来说就是在存储数据时，主动生成一个 id\x2b\x2b 来区分每条记录。这种情况下 存储数据的 key 是和 value 分开进行存储的，也就是 （out of line）。\x3c\/li\x3e\n\x3cli\x3ekey path: 需要用户主动来设置储存数据的 key 内容，\x3c\/li\x3e\n\x3cli\x3erequest: 每次读写操作，可以当做一次 request.\x3c\/li\x3e\n\x3cli\x3etransaction: 一系列读写请求的集合。\x3c\/li\x3e\n\x3cli\x3eindex: 一个特殊的 Object Store，用来索引另外一个 Store 的数据。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e具体数据 key\/value\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\n\x3cp\x3ekey: 这个 key 的值，可以通过三种方式生成。 a key generator, a key path, 用户指定的值。并且，这个 key 在当前的 Object Store 是唯一的。一个 key 类型可以是  string, date, float, and array 类型。不过，在老版本的时候，一般只支持 string or integer。（现在，版本应该都 OK 了）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22- key generator: 相当于以一种 `id\x2b\x2b` 的形式来生成一个 key 值。\n- key path: 当前指定的 key 可以根据 value 里面的内容来指定。里面可以为一些分隔符。\n- 指定的 key：这个就是需要用户手动来指定生成。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haml\x22\x3e\x3ccode\x3e-\x3cspan class=\x22ruby\x22\x3e key \x3cspan class=\x22hljs-symbol\x22\x3egenerator:\x3c\/span\x3e 相当于以一种 \x3cspan class=\x22hljs-string\x22\x3e`id\x2b\x2b`\x3c\/span\x3e 的形式来生成一个 key 值。\n\x3c\/span\x3e-\x3cspan class=\x22ruby\x22\x3e key \x3cspan class=\x22hljs-symbol\x22\x3epath:\x3c\/span\x3e 当前指定的 key 可以根据 value 里面的内容来指定。里面可以为一些分隔符。\n\x3c\/span\x3e-\x3cspan class=\x22ruby\x22\x3e 指定的 key：这个就是需要用户手动来指定生成。\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3evalue: 可以存储  boolean, number, string, date, object, array, regexp, undefined, and null。现在还可以存储 files and blob 对象。\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e操作作用域\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3escope：这可以比作 transaction 的作用域，即，一系列 transaction 执行的顺序。该规定，多个 reading transaction 能够同时执行。但是 writing 则只能排队进行。\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ekey range: 用来设置取出数据的  key 的范围内容。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e参考：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/IndexedDB_API\/Basic_Concepts_Behind_IndexedDB\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e原生概念 IndexedDB\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader23\x22\x3eIDBFactory\x3c\/h3\x3e\n\x3cp\x3e这其实就是 \x3ccode\x3eindexDB\x3c\/code\x3e 上面挂载的对象。主要 API 如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[Exposed=(Window,Worker)]\ninterface IDBFactory {\n  [NewObject] IDBOpenDBRequest open(DOMString name,\n                                    optional [EnforceRange] unsigned long long version);\n  [NewObject] IDBOpenDBRequest deleteDatabase(DOMString name);\n\n  short cmp(any first, any second);\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e[Exposed=(Window,Worker)]\n\x3cspan class=\x22hljs-keyword\x22\x3einterface\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eIDBFactory\x3c\/span\x3e {\n  [NewObject] \x3cspan class=\x22hljs-function\x22\x3eIDBOpenDBRequest \x3cspan class=\x22hljs-title\x22\x3eopen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eDOMString name,\n                                    optional [EnforceRange] unsigned \x3cspan class=\x22hljs-keyword\x22\x3elong\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3elong\x3c\/span\x3e version\x3c\/span\x3e)\x3c\/span\x3e;\n  [NewObject] \x3cspan class=\x22hljs-function\x22\x3eIDBOpenDBRequest \x3cspan class=\x22hljs-title\x22\x3edeleteDatabase\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eDOMString name\x3c\/span\x3e)\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eshort\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecmp\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eany first, any second\x3c\/span\x3e)\x3c\/span\x3e;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你可以直接通过 \x3ccode\x3eopen\x3c\/code\x3e 来打开一个数据库。通过 返回一个 Request 对象，来进行结果监听的回调：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var request = indexedDB.open(\x27AddressBook\x27, 15);\nrequest.onsuccess = function(evt) {...};\nrequest.onerror = function(evt) {...};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nimrod\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e request = indexedDB.open(\x27\x3cspan class=\x22hljs-type\x22\x3eAddressBook\x3c\/span\x3e\x27, \x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e);\nrequest.onsuccess = function(evt) \x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e;\nrequest.onerror = function(evt) \x3cspan class=\x22hljs-meta\x22\x3e{...}\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e参考：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.w3.org\/TR\/IndexedDB\/#factory-interface\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eIndexDB Factory API\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader24\x22\x3eIDBRequest\x3c\/h3\x3e\n\x3cp\x3e当你通过 \x3ccode\x3eopen\x3c\/code\x3e 方法处理过后，就会得到一个 Request 回调对象。这个就是 IDBRequest 的实例。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[Exposed=(Window,Worker)]\ninterface IDBRequest : EventTarget {\n  readonly attribute any result; \/\/ 通过 open 打开过后的 IDBObjectStore 实例 \n  readonly attribute DOMException? error;\n  readonly attribute (IDBObjectStore or IDBIndex or IDBCursor)? source;\n  readonly attribute IDBTransaction? transaction;\n  readonly attribute IDBRequestReadyState readyState;\n\n  \/\/ Event handlers:\n  attribute EventHandler onsuccess;\n  attribute EventHandler onerror;\n};\n\nenum IDBRequestReadyState {\n  \x26quot;pending\x26quot;,\n  \x26quot;done\x26quot;\n};\n\n[Exposed=(Window,Worker)]\ninterface IDBOpenDBRequest : IDBRequest {\n  \/\/ Event handlers:\n  attribute EventHandler onblocked;\n  attribute EventHandler onupgradeneeded;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e[Exposed=(Window,Worker)]\n\x3cspan class=\x22hljs-keyword\x22\x3einterface\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eIDBRequest\x3c\/span\x3e : \x3cspan class=\x22hljs-title\x22\x3eEventTarget\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereadonly\x3c\/span\x3e attribute any result; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过 open 打开过后的 IDBObjectStore 实例 \x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereadonly\x3c\/span\x3e attribute DOMException? error;\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ereadonly\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eattribute\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eIDBObjectStore or IDBIndex or IDBCursor\x3c\/span\x3e)? source\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereadonly\x3c\/span\x3e attribute IDBTransaction? transaction;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereadonly\x3c\/span\x3e attribute IDBRequestReadyState readyState;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Event handlers:\x3c\/span\x3e\n  attribute EventHandler onsuccess;\n  attribute EventHandler onerror;\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3eenum\x3c\/span\x3e IDBRequestReadyState {\n  \x3cspan class=\x22hljs-string\x22\x3e\x22pending\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22done\x22\x3c\/span\x3e\n};\n\n[Exposed=(Window,Worker)]\n\x3cspan class=\x22hljs-keyword\x22\x3einterface\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eIDBOpenDBRequest\x3c\/span\x3e : \x3cspan class=\x22hljs-title\x22\x3eIDBRequest\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Event handlers:\x3c\/span\x3e\n  attribute EventHandler onblocked;\n  attribute EventHandler onupgradeneeded;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你可以通过 \x3ccode\x3eresult\x3c\/code\x3e 得到当前数据库操作的结果。如果你打开更新后的版本号的话，还需要监听 \x3ccode\x3eonupgradeneeded\x3c\/code\x3e 事件来实现。最常通过 indexedDB.open 遇见的错误就是 \x3ccode\x3eVER_ERR\x3c\/code\x3e 版本错误。这表明存储在磁盘上的数据库的版本高于你试图打开的版本。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22db.onerror = function(event) {\n  \/\/ Generic error handler for all errors targeted at this database\x27s\n  \/\/ requests!\n  alert(\x26quot;Database error: \x26quot; \x2b event.target.errorCode);\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3edb.onerror = \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(event) {\n  \/\/ \x3cspan class=\x22hljs-keyword\x22\x3eGeneric\x3c\/span\x3e error handler \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eall\x3c\/span\x3e errors targeted \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e this database\x3cspan class=\x22hljs-symbol\x22\x3e\x27s\x3c\/span\x3e\n  \/\/ requests!\n  alert(\x3cspan class=\x22hljs-string\x22\x3e\x22Database error: \x22\x3c\/span\x3e \x2b event.target.errorCode);\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e所以，一般在创建 IndexDB 时，还需要管理它版本的更新操作，这里就需要监听 onupgradeneeded 来是实现。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22request.onupgradeneeded = function(event) { \n   \/\/ 更新对象存储空间和索引 .... \n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3erequest.onupgradeneeded = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{ \n   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新对象存储空间和索引 .... \x3c\/span\x3e\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e或者我们可以直接使用 \x3ccode\x3eidb\x3c\/code\x3e 微型库来实现读取操作。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  var dbPromise = idb.open(\x27test-db3\x27, 1, function(upgradeDb) {\n    if (!upgradeDb.objectStoreNames.contains(\x27people\x27)) {\n      upgradeDb.createObjectStore(\x27people\x27, {keyPath: \x27email\x27});\n    }\n    if (!upgradeDb.objectStoreNames.contains(\x27notes\x27)) {\n      upgradeDb.createObjectStore(\x27notes\x27, {autoIncrement: true});\n    }\n    if (!upgradeDb.objectStoreNames.contains(\x27logs\x27)) {\n      upgradeDb.createObjectStore(\x27logs\x27, {keyPath: \x27id\x27, autoIncrement: true});\n    }\n  });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dbPromise = idb.open(\x3cspan class=\x22hljs-string\x22\x3e\x27test-db3\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(upgradeDb)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!upgradeDb.objectStoreNames.contains(\x3cspan class=\x22hljs-string\x22\x3e\x27people\x27\x3c\/span\x3e)) {\n      upgradeDb.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27people\x27\x3c\/span\x3e, {keyPath: \x3cspan class=\x22hljs-string\x22\x3e\x27email\x27\x3c\/span\x3e});\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!upgradeDb.objectStoreNames.contains(\x3cspan class=\x22hljs-string\x22\x3e\x27notes\x27\x3c\/span\x3e)) {\n      upgradeDb.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27notes\x27\x3c\/span\x3e, {autoIncrement: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e});\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!upgradeDb.objectStoreNames.contains(\x3cspan class=\x22hljs-string\x22\x3e\x27logs\x27\x3c\/span\x3e)) {\n      upgradeDb.createObjectStore(\x3cspan class=\x22hljs-string\x22\x3e\x27logs\x27\x3c\/span\x3e, {keyPath: \x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e, autoIncrement: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e});\n    }\n  });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中通过 \x3ccode\x3eonupgradeneeded\x3c\/code\x3e 回调得到的 event.result 就是 \x3ccode\x3eIDBDatabase\x3c\/code\x3e 的实例，常常用来设置 index 和插入数据。参考下面内容。\x3c\/p\x3e\n\x3cp\x3e参考：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.w3.org\/TR\/IndexedDB\/#request-api\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eIDBRequest API\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader25\x22\x3eIDBDatabase\x3c\/h3\x3e\n\x3cp\x3e该对象常常用来做 Object Store 和 transaction 的创建和删除。该部分是 \x3ccode\x3eonupgradeneeded\x3c\/code\x3e 事件获得的 \x3ccode\x3eevent.target.result\x3c\/code\x3e 对象：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22request.onupgradeneeded = function(event) { \n   \/\/ 更新对象存储空间和索引 .... \n   \/\/ event.target.result 对象\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3erequest.onupgradeneeded = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(event)\x3c\/span\x3e \x3c\/span\x3e{ \n   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新对象存储空间和索引 .... \x3c\/span\x3e\n   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ event.target.result 对象\x3c\/span\x3e\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e具体 API 内容如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[Exposed=(Window,Worker)]\ninterface IDBDatabase : EventTarget {\n  readonly attribute DOMString name;\n  readonly attribute unsigned long long version;\n  readonly attribute DOMStringList objectStoreNames;\n\n  [NewObject] IDBTransaction transaction((DOMString or sequence\x3cDOMString\x3e) storeNames,\n                                         optional IDBTransactionMode mode = \x26quot;readonly\x26quot;);\n  void close();\n\n  [NewObject] IDBObjectStore createObjectStore(DOMString name,\n                                               optional IDBObjectStoreParameters options);\n  void deleteObjectStore(DOMString name);\n\n  \/\/ Event handlers:\n  attribute EventHandler onabort;\n  attribute EventHandler onclose;\n  attribute EventHandler onerror;\n  attribute EventHandler onversionchange;\n};\n\ndictionary IDBObjectStoreParameters {\n  (DOMString or sequence\x3cDOMString\x3e)? keyPath = null;\n  boolean autoIncrement = false;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e[Exposed=(Window,Worker)]\n\x3cspan class=\x22hljs-keyword\x22\x3einterface\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eIDBDatabase\x3c\/span\x3e : \x3cspan class=\x22hljs-title\x22\x3eEventTarget\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereadonly\x3c\/span\x3e attribute DOMString name;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereadonly\x3c\/span\x3e attribute unsigned \x3cspan class=\x22hljs-keyword\x22\x3elong\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3elong\x3c\/span\x3e version;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereadonly\x3c\/span\x3e attribute DOMStringList objectStoreNames;\n\n  [NewObject] \x3cspan class=\x22hljs-function\x22\x3eIDBTransaction \x3cspan class=\x22hljs-title\x22\x3etransaction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e(DOMString or sequence\x26lt;DOMString\x26gt;\x3c\/span\x3e) storeNames,\n                                         optional IDBTransactionMode mode \x3c\/span\x3e= \x3cspan class=\x22hljs-string\x22\x3e\x22readonly\x22\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eclose\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e;\n\n  [NewObject] \x3cspan class=\x22hljs-function\x22\x3eIDBObjectStore \x3cspan class=\x22hljs-title\x22\x3ecreateObjectStore\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eDOMString name,\n                                               optional IDBObjectStoreParameters options\x3c\/span\x3e)\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edeleteObjectStore\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eDOMString name\x3c\/span\x3e)\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Event handlers:\x3c\/span\x3e\n  attribute EventHandler onabort;\n  attribute EventHandler onclose;\n  attribute EventHandler onerror;\n  attribute EventHandler onversionchange;\n};\n\ndictionary IDBObjectStoreParameters {\n  (DOMString or sequence\x26lt;DOMString\x26gt;)? keyPath = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n  boolean autoIncrement = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果它通过 createObjectStore 方法，那么得到的就是一个 \x3ccode\x3eIDBObjectStore\x3c\/code\x3e 实例对象。如果是 transaction 方法，那么就是 \x3ccode\x3eIDBTransaction\x3c\/code\x3e 对象。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader26\x22\x3eIDBObjectStore\x3c\/h3\x3e\n\x3cp\x3e该对象一般是用来创建  index 和插入数据使用。\x3c\/p\x3e\n\x3cp\x3e可以参考：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[Exposed=(Window,Worker)]\ninterface IDBObjectStore {\n  attribute DOMString name;\n  readonly attribute any keyPath;\n  readonly attribute DOMStringList indexNames;\n  [SameObject] readonly attribute IDBTransaction transaction;\n  readonly attribute boolean autoIncrement;\n\n  [NewObject] IDBRequest put(any value, optional any key);\n  [NewObject] IDBRequest add(any value, optional any key);\n  [NewObject] IDBRequest delete(any query);\n  [NewObject] IDBRequest clear();\n  [NewObject] IDBRequest get(any query);\n  [NewObject] IDBRequest getKey(any query);\n  [NewObject] IDBRequest getAll(optional any query,\n                                optional [EnforceRange] unsigned long count);\n  [NewObject] IDBRequest getAllKeys(optional any query,\n                                    optional [EnforceRange] unsigned long count);\n  [NewObject] IDBRequest count(optional any query);\n\n  [NewObject] IDBRequest openCursor(optional any query,\n                                    optional IDBCursorDirection direction = \x26quot;next\x26quot;);\n  [NewObject] IDBRequest openKeyCursor(optional any query,\n                                       optional IDBCursorDirection direction = \x26quot;next\x26quot;);\n\n  IDBIndex index(DOMString name);\n\n  [NewObject] IDBIndex createIndex(DOMString name,\n                                   (DOMString or sequence\x3cDOMString\x3e) keyPath,\n                                   optional IDBIndexParameters options);\n  void deleteIndex(DOMString name);\n};\n\ndictionary IDBIndexParameters {\n  boolean unique = false;\n  boolean multiEntry = false;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fortran\x22\x3e\x3ccode\x3e[Exposed=(Window,Worker)]\n\x3cspan class=\x22hljs-keyword\x22\x3einterface\x3c\/span\x3e IDBObjectStore {\n  attribute DOMString \x3cspan class=\x22hljs-keyword\x22\x3ename\x3c\/span\x3e;\n  readonly attribute \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e keyPath;\n  readonly attribute DOMStringList indexNames;\n  [SameObject] readonly attribute IDBTransaction transaction;\n  readonly attribute boolean autoIncrement;\n\n  [NewObject] IDBRequest put(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e key);\n  [NewObject] IDBRequest add(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e key);\n  [NewObject] IDBRequest delete(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query);\n  [NewObject] IDBRequest clear();\n  [NewObject] IDBRequest get(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query);\n  [NewObject] IDBRequest getKey(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query);\n  [NewObject] IDBRequest getAll(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e [EnforceRange] unsigned long \x3cspan class=\x22hljs-built_in\x22\x3ecount\x3c\/span\x3e);\n  [NewObject] IDBRequest getAllKeys(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                    \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e [EnforceRange] unsigned long \x3cspan class=\x22hljs-built_in\x22\x3ecount\x3c\/span\x3e);\n  [NewObject] IDBRequest \x3cspan class=\x22hljs-built_in\x22\x3ecount\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query);\n\n  [NewObject] IDBRequest openCursor(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                    \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e IDBCursorDirection direction = \x3cspan class=\x22hljs-string\x22\x3e\x22next\x22\x3c\/span\x3e);\n  [NewObject] IDBRequest openKeyCursor(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                       \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e IDBCursorDirection direction = \x3cspan class=\x22hljs-string\x22\x3e\x22next\x22\x3c\/span\x3e);\n\n  IDBIndex \x3cspan class=\x22hljs-built_in\x22\x3eindex\x3c\/span\x3e(DOMString \x3cspan class=\x22hljs-keyword\x22\x3ename\x3c\/span\x3e);\n\n  [NewObject] IDBIndex createIndex(DOMString \x3cspan class=\x22hljs-keyword\x22\x3ename\x3c\/span\x3e,\n                                   (DOMString or \x3cspan class=\x22hljs-keyword\x22\x3esequence\x3c\/span\x3e\x26lt;DOMString\x26gt;) keyPath,\n                                   \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e IDBIndexParameters options);\n  void deleteIndex(DOMString \x3cspan class=\x22hljs-keyword\x22\x3ename\x3c\/span\x3e);\n};\n\ndictionary IDBIndexParameters {\n  boolean unique = false;\n  boolean multiEntry = false;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader27\x22\x3eIDBIndex\x3c\/h3\x3e\n\x3cp\x3e该对象是用来进行 Index 索引的操作对象，里面也会存在 \x3ccode\x3eget\x3c\/code\x3e 和 \x3ccode\x3egetAll\x3c\/code\x3e 等方法。详细内容如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[Exposed=(Window,Worker)]\ninterface IDBIndex {\n  attribute DOMString name;\n  [SameObject] readonly attribute IDBObjectStore objectStore;\n  readonly attribute any keyPath;\n  readonly attribute boolean multiEntry;\n  readonly attribute boolean unique;\n\n  [NewObject] IDBRequest get(any query);\n  [NewObject] IDBRequest getKey(any query);\n  [NewObject] IDBRequest getAll(optional any query,\n                                optional [EnforceRange] unsigned long count);\n  [NewObject] IDBRequest getAllKeys(optional any query,\n                                    optional [EnforceRange] unsigned long count);\n  [NewObject] IDBRequest count(optional any query);\n\n  [NewObject] IDBRequest openCursor(optional any query,\n                                    optional IDBCursorDirection direction = \x26quot;next\x26quot;);\n  [NewObject] IDBRequest openKeyCursor(optional any query,\n                                       optional IDBCursorDirection direction = \x26quot;next\x26quot;);\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fortran\x22\x3e\x3ccode\x3e[Exposed=(Window,Worker)]\n\x3cspan class=\x22hljs-keyword\x22\x3einterface\x3c\/span\x3e IDBIndex {\n  attribute DOMString \x3cspan class=\x22hljs-keyword\x22\x3ename\x3c\/span\x3e;\n  [SameObject] readonly attribute IDBObjectStore objectStore;\n  readonly attribute \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e keyPath;\n  readonly attribute boolean multiEntry;\n  readonly attribute boolean unique;\n\n  [NewObject] IDBRequest get(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query);\n  [NewObject] IDBRequest getKey(\x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query);\n  [NewObject] IDBRequest getAll(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e [EnforceRange] unsigned long \x3cspan class=\x22hljs-built_in\x22\x3ecount\x3c\/span\x3e);\n  [NewObject] IDBRequest getAllKeys(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                    \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e [EnforceRange] unsigned long \x3cspan class=\x22hljs-built_in\x22\x3ecount\x3c\/span\x3e);\n  [NewObject] IDBRequest \x3cspan class=\x22hljs-built_in\x22\x3ecount\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query);\n\n  [NewObject] IDBRequest openCursor(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                    \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e IDBCursorDirection direction = \x3cspan class=\x22hljs-string\x22\x3e\x22next\x22\x3c\/span\x3e);\n  [NewObject] IDBRequest openKeyCursor(\x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e query,\n                                       \x3cspan class=\x22hljs-keyword\x22\x3eoptional\x3c\/span\x3e IDBCursorDirection direction = \x3cspan class=\x22hljs-string\x22\x3e\x22next\x22\x3c\/span\x3e);\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e参考：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/jakearchibald\/idb\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eidb 开源库，微型代码库\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/treojs\/treo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3etreo 开源库\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/dfahlander\/Dexie.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edexie.js 开源库\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/IndexedDB_API\/Basic_Concepts_Behind_IndexedDB\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eindexeddb\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/IndexedDB_API\/Basic_Concepts_Behind_IndexedDB\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e原生概念 IndexedDB\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e也欢迎大家关注我的公众号：前端小吉米  获得一手的技术文章以及未来技术的发展内容。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVbaTtX?w=1280\x26amp;h=1280\x22 src=\x22https:\/\/static.alili.tech\/img\/bVbaTtX?w=1280\x26amp;h=1280\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>IndexedDB 打造靠谱 Web 离线数据库</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014950564">https://segmentfault.com/a/1190000014950564</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ze3siubq7o9/" target="_blank">https://alili.tech/archive/ze3siubq7o9/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>