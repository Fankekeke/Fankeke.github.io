<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="canvas实现 漂亮的下雨效果"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>canvas实现 漂亮的下雨效果 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/zkvkv2tdprq/",
				"appid": "1613049289050283", 
				"title": "canvas实现 漂亮的下雨效果 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-12-05T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/tvs2yx7ha1/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/sqgul1pgw8/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fzkvkv2tdprq%2f&text=canvas%e5%ae%9e%e7%8e%b0%20%e6%bc%82%e4%ba%ae%e7%9a%84%e4%b8%8b%e9%9b%a8%e6%95%88%e6%9e%9c"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fzkvkv2tdprq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fzkvkv2tdprq%2f&text=canvas%e5%ae%9e%e7%8e%b0%20%e6%bc%82%e4%ba%ae%e7%9a%84%e4%b8%8b%e9%9b%a8%e6%95%88%e6%9e%9c"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fzkvkv2tdprq%2f&title=canvas%e5%ae%9e%e7%8e%b0%20%e6%bc%82%e4%ba%ae%e7%9a%84%e4%b8%8b%e9%9b%a8%e6%95%88%e6%9e%9c"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fzkvkv2tdprq%2f&is_video=false&description=canvas%e5%ae%9e%e7%8e%b0%20%e6%bc%82%e4%ba%ae%e7%9a%84%e4%b8%8b%e9%9b%a8%e6%95%88%e6%9e%9c"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=canvas%e5%ae%9e%e7%8e%b0%20%e6%bc%82%e4%ba%ae%e7%9a%84%e4%b8%8b%e9%9b%a8%e6%95%88%e6%9e%9c&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fzkvkv2tdprq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fzkvkv2tdprq%2f&title=canvas%e5%ae%9e%e7%8e%b0%20%e6%bc%82%e4%ba%ae%e7%9a%84%e4%b8%8b%e9%9b%a8%e6%95%88%e6%9e%9c"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzkvkv2tdprq%2f&title=canvas%e5%ae%9e%e7%8e%b0%20%e6%bc%82%e4%ba%ae%e7%9a%84%e4%b8%8b%e9%9b%a8%e6%95%88%e6%9e%9c"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzkvkv2tdprq%2f&title=canvas%e5%ae%9e%e7%8e%b0%20%e6%bc%82%e4%ba%ae%e7%9a%84%e4%b8%8b%e9%9b%a8%e6%95%88%e6%9e%9c"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzkvkv2tdprq%2f&title=canvas%e5%ae%9e%e7%8e%b0%20%e6%bc%82%e4%ba%ae%e7%9a%84%e4%b8%8b%e9%9b%a8%e6%95%88%e6%9e%9c"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">canvas实现 漂亮的下雨效果</h1><div class="meta"><div class="postdate"><time datetime="2018-12-05" itemprop="datePublished">2018-12-05</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch3 id=\x22articleHeader0\x22\x3e说明\x3c\/h3\x3e\n\x3cp\x3e这篇文章说如何用canvas画出漂亮的下雨效果，先看看最后实现的效果吧。  \x3cbr\x3e\x3ca href=\x22https:\/\/codepen.io\/FEWY\/pen\/Ovevmw\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e效果图\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22FEWY\/pen\/Ovevmw\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8ITm?w=936\x26amp;h=532\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8ITm?w=936\x26amp;h=532\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e解释\x3c\/h3\x3e\n\x3cp\x3e看图来分析下，我们需要实现哪些效果。\x3cbr\x3e1、雨滴下落效果，移动鼠标控制下落方向 \x3cbr\x3e2、雨滴下落散成小水珠，小水珠的移动方向和鼠标移动方向相同\x3cbr\x3e3、雨滴下落到鼠标坐标一定范围内，散成小水珠，同样的，小水珠的移动方向也和鼠标移动方向相同\x3c\/p\x3e\n\x3cp\x3e好的，我们把整个效果大致拆分成三个效果，实现这三个效果，就完成了。\x3cbr\x3e我们一步一步来实现。\x3c\/p\x3e\n\x3ch4\x3e1、雨滴下落效果，移动鼠标控制下落方向\x3c\/h4\x3e\n\x3cp\x3e实现整个效果的思路就是，\x3cbr\x3e\x3cstrong\x3e初始时\x3c\/strong\x3e\x3cbr\x3e用一个数组保存雨滴对象。\x3cbr\x3e一个雨滴对象里面有各个属性用来表示，雨滴的x坐标，y坐标，长度，下落速度，颜色，判断是否删除的标志位\x3cbr\x3e\x3cstrong\x3e更新动画时\x3c\/strong\x3e\x3cbr\x3e往数组中添加一定数量的雨滴对象，然后遍历数组，修改每个雨滴对象的x坐标和y坐标，用canvas根据雨滴对象的坐标，画出两个点，连起来就是一个雨滴了。\x3c\/p\x3e\n\x3cp\x3e所以实现效果的重点就在坐标上\x3cbr\x3e\x3cstrong\x3e初始化一个雨滴的时候\x3c\/strong\x3e\x3cbr\x3e雨滴x坐标：一个随机数\x3cbr\x3e雨滴y坐标：-100，这样是为了让雨滴从可视区域外进来\x3cbr\x3e\x3cstrong\x3e更新动画时\x3c\/strong\x3e\x3cbr\x3e雨滴x坐标：\x3ccode\x3e原x坐标的值 \x2b speed * speedx\x3c\/code\x3e\x3cbr\x3espeed 是一个固定的值，表示雨滴下落速度，\x3cbr\x3espeedx 是一个和鼠标移动方向有关系的变量，\x3cbr\x3e\x3ccode\x3espeedx = speedx \x2b (maxspeedx - speedx) \/ 50\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e而maxspeedx 是根据鼠标移动方向得到的一个值\x3cbr\x3e\x3ccode\x3emaxspeedx = (e.clientX - canvasEl.clientWidth \/ 2) \/ (canvasEl.clientWidth \/ 2)\x3c\/code\x3e，\x3cbr\x3e\x3cstrong\x3ee.clientX：鼠标距离可视区域左边的值\x3c\/strong\x3e\x3cbr\x3e\x3cstrong\x3ecanvasEl.clientWidth：整个可视区域的宽度\x3c\/strong\x3e\x3cbr\x3e也就是说 speedx 是一个逐渐接近maxspeedx 的值 \x3cbr\x3emaxspeedx 的取值范围是 -1 到 1，他的值越接近 -1，说明方向越向左，值越接近1，说明方向越向右。\x3cbr\x3e为什么不直接用maxspeedx ？\x3cbr\x3e这是为了让雨滴变化方向的速度不要那么快，不要跟随鼠标变化方向立即改变，要有点点的延迟，看上去更好些。\x3cbr\x3e如果用maxspeedx ，是这样的效果\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8ITB?w=825\x26amp;h=454\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8ITB?w=825\x26amp;h=454\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如果用speedx ，是这样的效果\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8ITJ?w=827\x26amp;h=456\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8ITJ?w=827\x26amp;h=456\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e雨滴y坐标：\x3ccode\x3e原y坐标的值 \x2b speed\x3c\/code\x3e\x3cbr\x3espeed 和上面x坐标中提到的一样，是一个固定值，表示雨滴下落速度，\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e好的，最后就是用canvas根据雨滴对象的坐标，画两个点了，然后连起来，雨滴就画出来了\x3c\/strong\x3e\x3cbr\x3e第一个点坐标比较简单，直接获取雨滴对象的x坐标和y坐标，就是这个点的坐标\x3cbr\x3e第二个点的坐标：  \x3cbr\x3e\x3ccode\x3ex坐标 = 雨滴x坐标的值 \x2b 雨滴长度 * speedx\x3c\/code\x3e\x3cbr\x3e\x3ccode\x3ey坐标 = 雨滴y坐标的值 \x2b 雨滴长度\x3c\/code\x3e\x3cbr\x3e最后把这两个点连起来，就有一条线了，就是一个雨滴了\x3c\/p\x3e\n\x3cp\x3e当设置x坐标时，又用上了变量 speedx，这是为了让 雨滴方向 和 雨滴下落方向相同，\x3cbr\x3e当不用 speedx时，是这样\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8IUe?w=647\x26amp;h=421\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8IUe?w=647\x26amp;h=421\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e当用上speedx时，是这样\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8ITJ?w=827\x26amp;h=456\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8ITJ?w=827\x26amp;h=456\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3e2、雨滴下落散成小水珠，小水珠的移动方向和鼠标移动方向相同\x3c\/h4\x3e\n\x3cp\x3e这里的思路其实，和上面的效果有些相似\x3cbr\x3e\x3cstrong\x3e初始时\x3c\/strong\x3e\x3cbr\x3e用一个数组保存小水珠对象。\x3cbr\x3e一个小水珠，其实就是画一个圆弧。\x3cbr\x3e一个小水珠对象里面有各个属性用来表示，小水珠的坐标，x轴移动速度，y轴移动速度，圆的半径，判断是否删除的标志位。\x3cbr\x3e\x3cstrong\x3e更新动画时\x3c\/strong\x3e\x3cbr\x3e 往数组中添加一定数量的小水珠对象，然后遍历数组，修改每个小水珠对象的x坐标和y坐标，用canvas根据小水珠对象的坐标属性 和 半径属性，画一个圆弧。\x3c\/p\x3e\n\x3cp\x3e所以实现效果的重点还在坐标上\x3cbr\x3e\x3cstrong\x3e初始化一个小水珠的时候\x3c\/strong\x3e   \x3cbr\x3e小水珠是雨滴消失的时候出现的，所以小水珠的坐标也是根据雨滴的坐标来的，删除一个雨滴，就出现一些小水珠，而且小水珠的移动方向也是和雨滴下落方向，鼠标移动方向一样，所以还是会需要上面提到的变量 speedx，\x3cbr\x3e\x3ccode\x3e小水珠x坐标： 删除的雨滴x坐标 \x2b 删除的雨滴长度 * speedx\x3c\/code\x3e\x3cbr\x3e\x3ccode\x3e小水珠y坐标：删除的雨滴y坐标 \x2b 删除的雨滴长度\x3c\/code\x3e\x3cbr\x3e\x3cstrong\x3e更新动画时\x3c\/strong\x3e\x3cbr\x3e这里要用到小水珠对象的两个属性 vx（x轴的值 的变化速度） 和vy（y轴的值 的变化速度），\x3cbr\x3e\x3cstrong\x3e小水珠的x坐标\x3c\/strong\x3e\x3cbr\x3e\x3ccode\x3evx = vx \x2b speedx \/ 2\x3c\/code\x3e\x3cbr\x3e\x3ccode\x3e小水珠的x坐标  =原x坐标 \x2b vx\x3c\/code\x3e，\x3c\/p\x3e\n\x3cp\x3espeedx：上面提到的和鼠标移动方向相关的一个变量，这里的作用就是用来控制小水珠的移动方向和其他方向相同\x3cbr\x3e\x3ccode\x3espeedx \/ 2\x3c\/code\x3e，除2是为了使 让小水珠 在x轴的移动距离短一点，看上去更真实点\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e小水珠的y坐标\x3c\/strong\x3e\x3cbr\x3e\x3ccode\x3evy = vy \x2b gravity\x3c\/code\x3e\x3cbr\x3e\x3ccode\x3e小水珠的y坐标  =  原y坐标 \x2b vy;\x3c\/code\x3e，\x3cbr\x3evy：一个负数\x3cbr\x3egravity：重力，一个正数，完整代码里设置的是0.5\x3cbr\x3e因为 原y坐标 是一个正数，这样小水珠y坐标的值，就会先减小后增大，这是为了实现小水珠会先上升后下降的效果，看图\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8IUH?w=456\x26amp;h=335\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8IUH?w=456\x26amp;h=335\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e最后就是用canvas根据小水珠的坐标属性和半径属性画圆弧就可以了，弧度是随机的\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch4\x3e3、雨滴下落到鼠标坐标一定范围内，散成小水珠，同样的，小水珠的移动方向也和鼠标移动方向相同\x3c\/h4\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8IUP?w=534\x26amp;h=369\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8IUP?w=534\x26amp;h=369\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e确定图中圆的大小容易，假设圆的半径是35，我们能获取到鼠标的坐标，以鼠标的坐标为圆心，35为半径，就确定了圆的大小。\x3cbr\x3e重点在于如何判断，雨滴是不是进入了这个范围，这就要用勾股定理了，看图。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV8IUX?w=682\x26amp;h=431\x22 src=\x22https:\/\/static.alili.tech\/img\/bV8IUX?w=682\x26amp;h=431\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e因为雨滴是两个点连起来的一条线，要看雨滴是不是进入了这个范围内， 就是看雨滴靠下边的点的坐标，到鼠标的直线距离是多少，就是图中AB线段的长度。\x3c\/p\x3e\n\x3cblockquote\x3e勾股定理：直角三角形的两条直角边的平方和等于斜边的平方。\x3c\/blockquote\x3e\n\x3cp\x3e\x3ccode\x3eAB =  Math.sqrt(BC*BC \x2b AC * AC)\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3eBC = 雨滴x坐标 - 鼠标x坐标\x3cbr\x3eAC = 雨滴y坐标 - 鼠标y坐标\x3cbr\x3eMath.sqrt()方法用来计算一个数的平方根\x3c\/p\x3e\n\x3cp\x3e我们知道雨滴到鼠标的直线距离后，和圆的半径比较下，大于半径就不在范围内，否则就是在了。  \x3cbr\x3e如果在范围内，就删除雨滴，画一些小水珠。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e总结\x3c\/h3\x3e\n\x3cp\x3e要实现这个效果，麻烦的地方在于方向，雨滴方向，雨滴下落方向，小水珠移动方向，而这些都和鼠标移动方向相关，确定各种方向后，根据距离，用canvas不断的画线，画圆弧就行了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e完整代码\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!doctype html\x3e\n\x3chtml lang=\x26quot;en\x26quot;\x3e\n\x3chead\x3e\n  \x3cmeta charset=\x26quot;UTF-8\x26quot;\x3e\n  \x3cstyle\x3e\n    * {\n      margin: 0;\n      padding: 0;\n    }\n  \x3c\/style\x3e\n\x3c\/head\x3e\n\x3cbody\x3e\n  \x3ccanvas id=\x26quot;canvas\x26quot; style=\x26quot;position: absolute; height: 100%; width:100%;\x26quot;\x3e\x3c\/canvas\x3e\n  \x3cscript\x3e\n    window.onload = main;\n    function main() {\n      \/\/ 获取canvas元素\n      var canvasEl = document.getElementById(\x27canvas\x27);\n      var ctx = canvasEl.getContext(\x272d\x27);\n      \/\/ canvas画布的 背景颜色\n      var backgroundColor = \x27#000\x27;\n\n      \/\/ canvas画布的宽 等于 可视区域的宽\n      canvasEl.width = canvasEl.clientWidth;\n      \/\/ canvas画布的高 等于 可视区域的高\n      canvasEl.height = canvasEl.clientHeight;\n\n      \/\/ 保存小水珠的数组\n      \/\/ 雨滴下落后散成小水珠，小水珠就是一些圆弧\n      var dropList = [];\n\n      \/\/ 重力\n      \/\/ 雨滴下落后散成小水珠，小水珠会先上升后下降，主要是因为 gravity 这个变量的缘故\n      var gravity = 0.5;\n\n      \/\/ 保存雨滴的数组\n      \/\/ 每个雨滴 都是 画的一条线 \n      var linelist = [];\n\n      \/\/ 保存鼠标的坐标 \n      \/\/ mousePos[0] 代表x轴的值，mousePos[1] 代表y轴的值 \n      var mousePos = [0, 0];\n\n      \/\/ 跟随鼠标， mouseDis 大小区域内的雨滴会消失，形成散落效果\n      \/\/ 以mousePos为圆心，mouseDis为半径，这个范围内的雨滴 都会散开，形成许多小水珠\n      var mouseDis = 35;\n\n      \/\/ 更新一次动画，画lineNum 条雨滴，lineNum 值越大，下雨就越密集\n      var lineNum = 3;\n\n      \/\/ 跟随鼠标方向 变化下雨方向的 速度\n      \/\/ 鼠标移动后，下雨的方向 会慢慢改变，主要靠speedx 这个变量\n      var speedx = 0;\n\n      \/\/ maxspeedx 为 speedx 可以取的最大值\n      \/\/ 当 speedx = maxspeedx时，下雨方向 会 随鼠标移动方向立即改变\n      var maxspeedx = 0;\n\n      \/\/ 页面大小发生变化时，重置canvas画布大小\n      window.onresize = function () {\n        canvasEl.width = canvasEl.clientWidth;\n        canvasEl.height = canvasEl.clientHeight;\n      }\n\n      \/\/移动鼠标触发事件\n      window.onmousemove = function (e) {\n        \/\/  设置mousePos 等于 鼠标坐标\n        \/\/  e.clientX 为距离 浏览器窗口可视区域 左边的距离\n        \/\/  e.clientY 为距离 浏览器窗口可视区域 上边的距离\n        mousePos[0] = e.clientX;\n        mousePos[1] = e.clientY;\n\n        \/\/ 通过鼠标位置，设置 maxspeedx的值，取值范围是 -1 到 1\n        \/\/ maxspeedx的值，关系到 \n        \/\/ 1、雨滴的方向\n        \/\/ 2、雨滴下落的方向\n        \/\/ 3、雨滴下落方向 跟随 鼠标移动方向变化的速度\n        \/\/ 4、小水珠的移动方向\n        \/\/ 值越接近1，表示方向越向右\n        \/\/ 值越接近-1，表示方向越向左\n        maxspeedx = (e.clientX - canvasEl.clientWidth \/ 2) \/ (canvasEl.clientWidth \/ 2);\n      }\n\n      \/\/ 根据参数，返回一个rgb颜色，用于给雨滴设置颜色\n      function getRgb(r, g, b) {\n        return \x26quot;rgb(\x26quot; \x2b r \x2b \x26quot;,\x26quot; \x2b g \x2b \x26quot;,\x26quot; \x2b b \x2b \x26quot;)\x26quot;;\n      }\n\n      \/\/ 画 一滴雨（一条线）\n      function createLine(e) {\n        \/\/ 随机生成 雨滴的长度\n        var temp = 0.25 * (50 \x2b Math.random() * 100);\n        \/\/ 一个 line 对象，代表一个雨滴\n        var line = {\n          \/\/ 雨滴下落速度  \n          speed: 5.5 * (Math.random() * 6 \x2b 3),\n          \/\/ 判断是否删除，值为true就删除\n          die: false,\n          \/\/ 雨滴x坐标 \n          posx: e,\n          \/\/ 雨滴y坐标 \n          posy: -50,\n          \/\/ 雨滴的长度\n          h: temp,\n          \/\/ 雨滴的颜色\n          color: getRgb(Math.floor(temp * 255 \/ 75), Math.floor(temp * 255 \/ 75), Math.floor(temp * 255 \/ 75))\n        };\n        \/\/ 把创建好的line（雨滴）对象，添加到保存雨滴的数组\n        linelist.push(line);\n      }\n\n      \/\/ 画一个小水珠（雨滴散开后的小水珠就是一个个的圆弧）\n      function createDrop(x, y) {\n        \/\/ 一个 drop 对象，代表一个圆弧\n        var drop = {\n          \/\/ 判断是否删除，值为true就删除\n          die: false,\n          \/\/ 圆弧圆心的x坐标 \n          posx: x,\n          \/\/ 圆弧圆心的y坐标 \n          posy: y,\n          \/\/ vx 表示 x轴的值 变化的速度\n          vx: (Math.random() - 0.5) * 8,\n          \/\/ vy 表示 y轴的值 变化的速度 取值范围：-3 到 -9\n          vy: Math.random() * (-6) - 3,\n          \/\/ 圆弧的半径\n          radius: Math.random() * 1.5 \x2b 1\n        };\n        return drop;\n      }\n\n      \/\/ 画一定数量的小水珠\n      function madedrops(x, y) {\n        \/\/ 随机生成一个数 maxi\n        \/\/ maxi 代表要画小水珠的数量\n        var maxi = Math.floor(Math.random() * 5 \x2b 5);\n        for (var i = 0; i \x3c maxi; i\x2b\x2b) {\n          dropList.push(createDrop(x, y));\n        }\n      }\n\n      \/\/ 开始调用update函数，更新动画\n      window.requestAnimationFrame(update);\n      \/\/ 更新动画\n      function update() {\n        \/\/ 如果保存小水珠的数组有内容\n        if (dropList.length \x3e 0) {\n          \/\/ 遍历保存小水珠的数组\n          dropList.forEach(function (e) {\n            \/\/设置e.vx，vx表示x坐标变化的速度\n            \/\/ (speedx)\/2 是为了，让小水珠 在x轴的移动距离短一点，看上去更真实点\n            \/\/ 也使 小水珠的移动方向 和 雨滴方向，雨滴下落方向，鼠标移动方向相同\n            e.vx = e.vx \x2b (speedx \/ 2);\n            e.posx = e.posx \x2b e.vx;\n            \n            \/\/设置e.vy，vy表示y坐标变化的速度\n            \/\/ e.vy的范围是-3 到 -9，而这时e.posy（y坐标）一定是正值，所以 e.posy的值会先减小后增大\n            \/\/ 也就是实现 雨滴散成小水珠，小水珠会先上升后下降的效果\n            e.vy = e.vy \x2b gravity;\n            e.posy = e.posy \x2b e.vy;\n\n            \/\/ 如果 小水珠y坐标 大于 可视区域的高度，设置die属性为true\n            \/\/ 小水珠如果超出可视区域就删除掉\n            if (e.posy \x3e canvasEl.clientHeight) {\n              e.die = true;\n            }\n          });\n        }\n\n        \/\/ 删除 die属性为ture 的数组成员\n        \/\/ 可视区域外的小水珠删除掉\n        for (var i = dropList.length - 1; i \x3e= 0; i--) {\n          if (dropList[i].die) {\n            dropList.splice(i, 1);\n          }\n        }\n\n        \/\/ 设置下雨方向变换的速度，取值范围： -1 到 1\n        \/\/ 当 speedx = maxspeedx时，下雨方向 会 随鼠标移动方向立即改变\n        speedx = speedx \x2b (maxspeedx - speedx) \/ 50;\n\n        \/\/ 根据lineNum的值，画一定数量雨滴\n        for (var i = 0; i \x3c lineNum; i\x2b\x2b) {\n          \/\/ 调用createLine 函数，参数是雨滴x坐标\n          createLine(Math.random() * 2 * canvasEl.width - (0.5 * canvasEl.width));\n        }\n\n        \/\/ 设置结束线，也就是雨滴散开 形成许多小水珠的位置\n        var endLine = canvasEl.clientHeight - Math.random() * canvasEl.clientHeight \/ 5;\n\n        \/\/ 遍历保存雨滴的数组\n        linelist.forEach(function (e) {\n\n          \/\/ 利用勾股定理 确定一个范围，在这个范围内雨滴会散开形成小水珠\n          \/\/ e.posx \x2b speedx * e.h 是雨滴x坐标\n          \/\/ e.posy \x2b e.h 是雨滴y坐标\n          var dis = Math.sqrt(((e.posx \x2b speedx * e.h) - mousePos[0]) * ((e.posx \x2b speedx * e.h) - mousePos[0]) \x2b (e.posy \x2b e.h - mousePos[1]) * (e.posy \x2b e.h - mousePos[1]));\n\n          \/\/ 如果在mouseDis区域内，就删除雨滴，画一些小水珠（圆弧）\n          \/\/ 实现鼠标碰到雨滴，雨滴散成小水珠的效果\n          if (dis \x3c mouseDis) {\n            \/\/ 删除 雨滴\n            e.die = true;\n            \/\/ 画一些小水珠（圆弧）\n            madedrops(e.posx \x2b speedx * e.h, e.posy \x2b e.h);\n          }\n\n          \/\/ 如果雨滴超过 结束线，删除雨滴，画一些小水珠（圆弧）\n          if ((e.posy \x2b e.h) \x3e endLine) {\n            e.die = true;\n            madedrops(e.posx \x2b speedx * e.h, e.posy \x2b e.h);\n          }\n\n          \/\/ 如果 雨滴 y坐标 大于 可视区域的高度，设置die属性为true\n          \/\/ 如果 雨滴 超出可视区域就删除掉\n          if (e.posy \x3e= canvasEl.clientHeight) {\n            e.die = true;\n          } else {\n            \/\/ 逐渐增加 雨滴 y坐标的值\n            e.posy = e.posy \x2b e.speed;\n\n            \/\/ 变化雨滴 x坐标\n            \/\/ * speedx 用来控制雨滴 下落 方向\n            \/\/ 使 雨滴下落方向 和 鼠标移动方向相同\n            e.posx = e.posx \x2b e.speed * speedx;\n          }\n        });\n\n        \/\/ 删除 die属性为ture 的数组成员\n        \/\/ 鼠标区域内的，超过结束线的，可视区域外的雨滴删除掉\n        for (var i = linelist.length - 1; i \x3e= 0; i--) {\n          if (linelist[i].die) {\n            linelist.splice(i, 1);\n          }\n        }\n\n        \/\/ 渲染\n        render();\n        \/\/ 递归调用 update，实现动画效果\n        window.requestAnimationFrame(update);\n      }\n\n      \/\/ 渲染\n      function render() {\n        \/\/ 画一个和可视区域一样大的矩形\n        ctx.fillStyle = backgroundColor;\n        ctx.fillRect(0, 0, canvasEl.width, canvasEl.height);\n\n        \/\/ 画雨滴效果\n        ctx.lineWidth = 5;\n        linelist.forEach(function (line) {\n          ctx.strokeStyle = line.color;\n          ctx.beginPath();\n          ctx.moveTo(line.posx, line.posy);\n\n          \/\/ * speedx 用来控制雨滴方向\n          \/\/ 使 雨滴方向 和 鼠标移动方向相同\n          ctx.lineTo(line.posx \x2b line.h * speedx, line.posy \x2b line.h);\n          ctx.stroke();\n        });\n\n        \/\/ 画雨滴散开形成小水珠效果\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = \x26quot;#fff\x26quot;;\n        dropList.forEach(function (e) {\n          ctx.beginPath();\n          ctx.arc(e.posx, e.posy, e.radius, Math.random() * Math.PI * 2, 1 * Math.PI);\n          ctx.stroke();\n        });\n\n        \/\/ 解开注释，可看见鼠标范围\n        \/*\n          ctx.beginPath();\n          ctx.arc(mousePos[0], mousePos[1], mouseDis, 0, 2 * Math.PI);\n          ctx.stroke();\n        *\/\n      }\n    }\n  \x3c\/script\x3e\n\x3c\/body\x3e\n\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!doctype html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elang\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22en\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22UTF-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n    * {\n      \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attribute\x22\x3epadding\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    }\n  \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ecanvas\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22canvas\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22position: absolute; height: 100%; width:100%;\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ecanvas\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.onload = main;\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emain\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取canvas元素\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e canvasEl = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27canvas\x27\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ctx = canvasEl.getContext(\x3cspan class=\x22hljs-string\x22\x3e\x272d\x27\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ canvas画布的 背景颜色\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e backgroundColor = \x3cspan class=\x22hljs-string\x22\x3e\x27#000\x27\x3c\/span\x3e;\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ canvas画布的宽 等于 可视区域的宽\x3c\/span\x3e\n      canvasEl.width = canvasEl.clientWidth;\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ canvas画布的高 等于 可视区域的高\x3c\/span\x3e\n      canvasEl.height = canvasEl.clientHeight;\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存小水珠的数组\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 雨滴下落后散成小水珠，小水珠就是一些圆弧\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dropList = [];\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重力\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 雨滴下落后散成小水珠，小水珠会先上升后下降，主要是因为 gravity 这个变量的缘故\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e gravity = \x3cspan class=\x22hljs-number\x22\x3e0.5\x3c\/span\x3e;\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存雨滴的数组\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 每个雨滴 都是 画的一条线 \x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e linelist = [];\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存鼠标的坐标 \x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ mousePos[0] 代表x轴的值，mousePos[1] 代表y轴的值 \x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e mousePos = [\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 跟随鼠标， mouseDis 大小区域内的雨滴会消失，形成散落效果\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 以mousePos为圆心，mouseDis为半径，这个范围内的雨滴 都会散开，形成许多小水珠\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e mouseDis = \x3cspan class=\x22hljs-number\x22\x3e35\x3c\/span\x3e;\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新一次动画，画lineNum 条雨滴，lineNum 值越大，下雨就越密集\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e lineNum = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e;\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 跟随鼠标方向 变化下雨方向的 速度\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 鼠标移动后，下雨的方向 会慢慢改变，主要靠speedx 这个变量\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e speedx = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ maxspeedx 为 speedx 可以取的最大值\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当 speedx = maxspeedx时，下雨方向 会 随鼠标移动方向立即改变\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e maxspeedx = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 页面大小发生变化时，重置canvas画布大小\x3c\/span\x3e\n      \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.onresize = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        canvasEl.width = canvasEl.clientWidth;\n        canvasEl.height = canvasEl.clientHeight;\n      }\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/移动鼠标触发事件\x3c\/span\x3e\n      \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.onmousemove = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/  设置mousePos 等于 鼠标坐标\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/  e.clientX 为距离 浏览器窗口可视区域 左边的距离\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/  e.clientY 为距离 浏览器窗口可视区域 上边的距离\x3c\/span\x3e\n        mousePos[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] = e.clientX;\n        mousePos[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e] = e.clientY;\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过鼠标位置，设置 maxspeedx的值，取值范围是 -1 到 1\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ maxspeedx的值，关系到 \x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1、雨滴的方向\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 2、雨滴下落的方向\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 3、雨滴下落方向 跟随 鼠标移动方向变化的速度\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 4、小水珠的移动方向\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 值越接近1，表示方向越向右\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 值越接近-1，表示方向越向左\x3c\/span\x3e\n        maxspeedx = (e.clientX - canvasEl.clientWidth \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) \/ (canvasEl.clientWidth \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);\n      }\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 根据参数，返回一个rgb颜色，用于给雨滴设置颜色\x3c\/span\x3e\n      \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetRgb\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3er, g, b\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22rgb(\x22\x3c\/span\x3e \x2b r \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22,\x22\x3c\/span\x3e \x2b g \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22,\x22\x3c\/span\x3e \x2b b \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22)\x22\x3c\/span\x3e;\n      }\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画 一滴雨（一条线）\x3c\/span\x3e\n      \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateLine\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 随机生成 雨滴的长度\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e temp = \x3cspan class=\x22hljs-number\x22\x3e0.25\x3c\/span\x3e * (\x3cspan class=\x22hljs-number\x22\x3e50\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 一个 line 对象，代表一个雨滴\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e line = {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 雨滴下落速度  \x3c\/span\x3e\n          speed: \x3cspan class=\x22hljs-number\x22\x3e5.5\x3c\/span\x3e * (\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e),\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断是否删除，值为true就删除\x3c\/span\x3e\n          die: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 雨滴x坐标 \x3c\/span\x3e\n          posx: e,\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 雨滴y坐标 \x3c\/span\x3e\n          posy: \x3cspan class=\x22hljs-number\x22\x3e-50\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 雨滴的长度\x3c\/span\x3e\n          h: temp,\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 雨滴的颜色\x3c\/span\x3e\n          color: getRgb(\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(temp * \x3cspan class=\x22hljs-number\x22\x3e255\x3c\/span\x3e \/ \x3cspan class=\x22hljs-number\x22\x3e75\x3c\/span\x3e), \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(temp * \x3cspan class=\x22hljs-number\x22\x3e255\x3c\/span\x3e \/ \x3cspan class=\x22hljs-number\x22\x3e75\x3c\/span\x3e), \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(temp * \x3cspan class=\x22hljs-number\x22\x3e255\x3c\/span\x3e \/ \x3cspan class=\x22hljs-number\x22\x3e75\x3c\/span\x3e))\n        };\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 把创建好的line（雨滴）对象，添加到保存雨滴的数组\x3c\/span\x3e\n        linelist.push(line);\n      }\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画一个小水珠（雨滴散开后的小水珠就是一个个的圆弧）\x3c\/span\x3e\n      \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateDrop\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ex, y\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 一个 drop 对象，代表一个圆弧\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e drop = {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断是否删除，值为true就删除\x3c\/span\x3e\n          die: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 圆弧圆心的x坐标 \x3c\/span\x3e\n          posx: x,\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 圆弧圆心的y坐标 \x3c\/span\x3e\n          posy: y,\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ vx 表示 x轴的值 变化的速度\x3c\/span\x3e\n          vx: (\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() - \x3cspan class=\x22hljs-number\x22\x3e0.5\x3c\/span\x3e) * \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ vy 表示 y轴的值 变化的速度 取值范围：-3 到 -9\x3c\/span\x3e\n          vy: \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * (\x3cspan class=\x22hljs-number\x22\x3e-6\x3c\/span\x3e) - \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 圆弧的半径\x3c\/span\x3e\n          radius: \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n        };\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e drop;\n      }\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画一定数量的小水珠\x3c\/span\x3e\n      \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emadedrops\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ex, y\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 随机生成一个数 maxi\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ maxi 代表要画小水珠的数量\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e maxi = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; maxi; i\x2b\x2b) {\n          dropList.push(createDrop(x, y));\n        }\n      }\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 开始调用update函数，更新动画\x3c\/span\x3e\n      \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.requestAnimationFrame(update);\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新动画\x3c\/span\x3e\n      \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eupdate\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果保存小水珠的数组有内容\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dropList.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 遍历保存小水珠的数组\x3c\/span\x3e\n          dropList.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置e.vx，vx表示x坐标变化的速度\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ (speedx)\/2 是为了，让小水珠 在x轴的移动距离短一点，看上去更真实点\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 也使 小水珠的移动方向 和 雨滴方向，雨滴下落方向，鼠标移动方向相同\x3c\/span\x3e\n            e.vx = e.vx \x2b (speedx \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);\n            e.posx = e.posx \x2b e.vx;\n            \n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置e.vy，vy表示y坐标变化的速度\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ e.vy的范围是-3 到 -9，而这时e.posy（y坐标）一定是正值，所以 e.posy的值会先减小后增大\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 也就是实现 雨滴散成小水珠，小水珠会先上升后下降的效果\x3c\/span\x3e\n            e.vy = e.vy \x2b gravity;\n            e.posy = e.posy \x2b e.vy;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果 小水珠y坐标 大于 可视区域的高度，设置die属性为true\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 小水珠如果超出可视区域就删除掉\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (e.posy \x26gt; canvasEl.clientHeight) {\n              e.die = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n            }\n          });\n        }\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 删除 die属性为ture 的数组成员\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 可视区域外的小水珠删除掉\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = dropList.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e; i \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i--) {\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dropList[i].die) {\n            dropList.splice(i, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n          }\n        }\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置下雨方向变换的速度，取值范围： -1 到 1\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当 speedx = maxspeedx时，下雨方向 会 随鼠标移动方向立即改变\x3c\/span\x3e\n        speedx = speedx \x2b (maxspeedx - speedx) \/ \x3cspan class=\x22hljs-number\x22\x3e50\x3c\/span\x3e;\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 根据lineNum的值，画一定数量雨滴\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; lineNum; i\x2b\x2b) {\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用createLine 函数，参数是雨滴x坐标\x3c\/span\x3e\n          createLine(\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * canvasEl.width - (\x3cspan class=\x22hljs-number\x22\x3e0.5\x3c\/span\x3e * canvasEl.width));\n        }\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置结束线，也就是雨滴散开 形成许多小水珠的位置\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e endLine = canvasEl.clientHeight - \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * canvasEl.clientHeight \/ \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e;\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 遍历保存雨滴的数组\x3c\/span\x3e\n        linelist.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 利用勾股定理 确定一个范围，在这个范围内雨滴会散开形成小水珠\x3c\/span\x3e\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ e.posx \x2b speedx * e.h 是雨滴x坐标\x3c\/span\x3e\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ e.posy \x2b e.h 是雨滴y坐标\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dis = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.sqrt(((e.posx \x2b speedx * e.h) - mousePos[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]) * ((e.posx \x2b speedx * e.h) - mousePos[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]) \x2b (e.posy \x2b e.h - mousePos[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]) * (e.posy \x2b e.h - mousePos[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]));\n\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果在mouseDis区域内，就删除雨滴，画一些小水珠（圆弧）\x3c\/span\x3e\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实现鼠标碰到雨滴，雨滴散成小水珠的效果\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dis \x26lt; mouseDis) {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 删除 雨滴\x3c\/span\x3e\n            e.die = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画一些小水珠（圆弧）\x3c\/span\x3e\n            madedrops(e.posx \x2b speedx * e.h, e.posy \x2b e.h);\n          }\n\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果雨滴超过 结束线，删除雨滴，画一些小水珠（圆弧）\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((e.posy \x2b e.h) \x26gt; endLine) {\n            e.die = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n            madedrops(e.posx \x2b speedx * e.h, e.posy \x2b e.h);\n          }\n\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果 雨滴 y坐标 大于 可视区域的高度，设置die属性为true\x3c\/span\x3e\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果 雨滴 超出可视区域就删除掉\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (e.posy \x26gt;= canvasEl.clientHeight) {\n            e.die = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n          } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 逐渐增加 雨滴 y坐标的值\x3c\/span\x3e\n            e.posy = e.posy \x2b e.speed;\n\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 变化雨滴 x坐标\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ * speedx 用来控制雨滴 下落 方向\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使 雨滴下落方向 和 鼠标移动方向相同\x3c\/span\x3e\n            e.posx = e.posx \x2b e.speed * speedx;\n          }\n        });\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 删除 die属性为ture 的数组成员\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 鼠标区域内的，超过结束线的，可视区域外的雨滴删除掉\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = linelist.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e; i \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i--) {\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (linelist[i].die) {\n            linelist.splice(i, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n          }\n        }\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染\x3c\/span\x3e\n        render();\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 递归调用 update，实现动画效果\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.requestAnimationFrame(update);\n      }\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染\x3c\/span\x3e\n      \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erender\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画一个和可视区域一样大的矩形\x3c\/span\x3e\n        ctx.fillStyle = backgroundColor;\n        ctx.fillRect(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, canvasEl.width, canvasEl.height);\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画雨滴效果\x3c\/span\x3e\n        ctx.lineWidth = \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e;\n        linelist.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eline\x3c\/span\x3e) \x3c\/span\x3e{\n          ctx.strokeStyle = line.color;\n          ctx.beginPath();\n          ctx.moveTo(line.posx, line.posy);\n\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ * speedx 用来控制雨滴方向\x3c\/span\x3e\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使 雨滴方向 和 鼠标移动方向相同\x3c\/span\x3e\n          ctx.lineTo(line.posx \x2b line.h * speedx, line.posy \x2b line.h);\n          ctx.stroke();\n        });\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 画雨滴散开形成小水珠效果\x3c\/span\x3e\n        ctx.lineWidth = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n        ctx.strokeStyle = \x3cspan class=\x22hljs-string\x22\x3e\x22#fff\x22\x3c\/span\x3e;\n        dropList.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n          ctx.beginPath();\n          ctx.arc(e.posx, e.posy, e.radius, \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI);\n          ctx.stroke();\n        });\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 解开注释，可看见鼠标范围\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*\n          ctx.beginPath();\n          ctx.arc(mousePos[0], mousePos[1], mouseDis, 0, 2 * Math.PI);\n          ctx.stroke();\n        *\/\x3c\/span\x3e\n      }\n    }\n  \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e最后说一句\x3c\/strong\x3e   \x3cbr\x3e这个特效的作者是 \x3ca href=\x22https:\/\/juejin.im\/user\/59db13d5518825350f42507a\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esxq111本尊\x3c\/a\x3e 大神，我只是站在巨人的肩膀上，喜欢的小伙伴们可以去\x3ca href=\x22https:\/\/github.com\/sxq111\/sxq111.github.io\/tree\/master\/my_canvas_rain\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egithub\x3c\/a\x3e上给个小\x3ca href=\x22https:\/\/github.com\/sxq111\/sxq111.github.io\/tree\/master\/my_canvas_rain\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3estar\x3c\/a\x3e哦。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000016248923?w=600\x26amp;h=342\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000016248923?w=600\x26amp;h=342\x22 alt=\x22前端简单说\x22 title=\x22前端简单说\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>canvas实现 漂亮的下雨效果</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000014433283">https://segmentfault.com/a/1190000014433283</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/zkvkv2tdprq/" target="_blank">https://alili.tech/archive/zkvkv2tdprq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/hvvo3rmt3dj/">JS打包工具rollup——完全入门指南<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/semhn25oasq/">Spring Boot [基于Spring Boot 与 Vue的后台脚手架] SanJi Boot Security<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/t1iml4tjj7r/">WebGL入门demo<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/8gbs1y0r0ns/">[面试专题]一线互联网大厂面试总结<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/4os59l0zeel/">react&#43;react-router4&#43;redux最新版构建分享<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/dznv6a9ewcj/">react虚拟dom机制与diff算法<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/myiqarfowok/">一套Vue的单页模板：N3-admin<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/2eeweuxgjbk/">使用 json-server 搭建 api mock 服务 (一)<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/h7cszygcoqq/">使用Ionic3框架开始第一个混合开发APP<aside class="dates">2019-01-04</aside></a></li><li><a href="/archive/g8by6kv9q8t/">如何只用 CSS 完成漂亮的加载<aside class="dates">2019-01-04</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>